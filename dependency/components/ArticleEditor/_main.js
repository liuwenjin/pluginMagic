webCpu.regComponent("ArticleEditor", {
  html: '<div class="toolbar-container"></div>\
  <div class="editor-container" style="height: calc( 100% - 120px ); overflow: auto;"></div>',
  css: {
    editor: "data:text/css;base64,OnJvb3QsCjpob3N0IHsKICAtLXctZS10ZXh0YXJlYS1iZy1jb2xvcjogI2ZmZjsKICAtLXctZS10ZXh0YXJlYS1jb2xvcjogIzMzMzsKICAtLXctZS10ZXh0YXJlYS1ib3JkZXItY29sb3I6ICNjY2M7CiAgLS13LWUtdGV4dGFyZWEtc2xpZ2h0LWJvcmRlci1jb2xvcjogI2U4ZThlODsKICAtLXctZS10ZXh0YXJlYS1zbGlnaHQtY29sb3I6ICNkNGQ0ZDQ7CiAgLS13LWUtdGV4dGFyZWEtc2xpZ2h0LWJnLWNvbG9yOiAjZjVmMmYwOwogIC0tdy1lLXRleHRhcmVhLXNlbGVjdGVkLWJvcmRlci1jb2xvcjogI0I0RDVGRjsKICAtLXctZS10ZXh0YXJlYS1oYW5kbGVyLWJnLWNvbG9yOiAjNDI5MGY3OwogIC0tdy1lLXRvb2xiYXItY29sb3I6ICM1OTU5NTk7CiAgLS13LWUtdG9vbGJhci1iZy1jb2xvcjogI2ZmZjsKICAtLXctZS10b29sYmFyLWFjdGl2ZS1jb2xvcjogIzMzMzsKICAtLXctZS10b29sYmFyLWFjdGl2ZS1iZy1jb2xvcjogI2YxZjFmMTsKICAtLXctZS10b29sYmFyLWRpc2FibGVkLWNvbG9yOiAjOTk5OwogIC0tdy1lLXRvb2xiYXItYm9yZGVyLWNvbG9yOiAjZThlOGU4OwogIC0tdy1lLW1vZGFsLWJ1dHRvbi1iZy1jb2xvcjogI2ZhZmFmYTsKICAtLXctZS1tb2RhbC1idXR0b24tYm9yZGVyLWNvbG9yOiAjZDlkOWQ5Owp9Cgoudy1lLXRleHQtY29udGFpbmVyICosCi53LWUtdG9vbGJhciAqIHsKICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogIG1hcmdpbjogMDsKICBvdXRsaW5lOiBub25lOwogIHBhZGRpbmc6IDAKfQoKLnctZS10ZXh0LWNvbnRhaW5lciBibG9ja3F1b3RlLAoudy1lLXRleHQtY29udGFpbmVyIGxpLAoudy1lLXRleHQtY29udGFpbmVyIHAsCi53LWUtdGV4dC1jb250YWluZXIgdGQsCi53LWUtdGV4dC1jb250YWluZXIgdGgsCi53LWUtdG9vbGJhciAqIHsKICBsaW5lLWhlaWdodDogMS41Cn0KCi53LWUtdGV4dC1jb250YWluZXIgewogIGJhY2tncm91bmQtY29sb3I6IHZhcigtLXctZS10ZXh0YXJlYS1iZy1jb2xvcik7CiAgY29sb3I6IHZhcigtLXctZS10ZXh0YXJlYS1jb2xvcik7CiAgaGVpZ2h0OiAxMDAlOwogIHBvc2l0aW9uOiByZWxhdGl2ZQp9Cgoudy1lLXRleHQtY29udGFpbmVyIC53LWUtc2Nyb2xsIHsKICAtd2Via2l0LW92ZXJmbG93LXNjcm9sbGluZzogdG91Y2g7CiAgaGVpZ2h0OiAxMDAlCn0KCi53LWUtdGV4dC1jb250YWluZXIgW2RhdGEtc2xhdGUtZWRpdG9yXSB7CiAgd29yZC13cmFwOiBicmVhay13b3JkOwogIGJvcmRlci10b3A6IDFweCBzb2xpZCB0cmFuc3BhcmVudDsKICBtaW4taGVpZ2h0OiAxMDAlOwogIG91dGxpbmU6IDA7CiAgcGFkZGluZzogMCAxMHB4OwogIHdoaXRlLXNwYWNlOiBwcmUtd3JhcAp9Cgoudy1lLXRleHQtY29udGFpbmVyIFtkYXRhLXNsYXRlLWVkaXRvcl0gcCB7CiAgbWFyZ2luOiAxNXB4IDAKfQoKLnctZS10ZXh0LWNvbnRhaW5lciBbZGF0YS1zbGF0ZS1lZGl0b3JdIGgxLAoudy1lLXRleHQtY29udGFpbmVyIFtkYXRhLXNsYXRlLWVkaXRvcl0gaDIsCi53LWUtdGV4dC1jb250YWluZXIgW2RhdGEtc2xhdGUtZWRpdG9yXSBoMywKLnctZS10ZXh0LWNvbnRhaW5lciBbZGF0YS1zbGF0ZS1lZGl0b3JdIGg0LAoudy1lLXRleHQtY29udGFpbmVyIFtkYXRhLXNsYXRlLWVkaXRvcl0gaDUgewogIG1hcmdpbjogMjBweCAwCn0KCi53LWUtdGV4dC1jb250YWluZXIgW2RhdGEtc2xhdGUtZWRpdG9yXSBpbWcgewogIGN1cnNvcjogZGVmYXVsdDsKICBkaXNwbGF5OiBpbmxpbmUgIWltcG9ydGFudDsKICBtYXgtd2lkdGg6IDEwMCU7CiAgbWluLWhlaWdodDogMjBweDsKICBtaW4td2lkdGg6IDIwcHgKfQoKLnctZS10ZXh0LWNvbnRhaW5lciBbZGF0YS1zbGF0ZS1lZGl0b3JdIHNwYW4gewogIHRleHQtaW5kZW50OiAwCn0KCi53LWUtdGV4dC1jb250YWluZXIgW2RhdGEtc2xhdGUtZWRpdG9yXSBbZGF0YS1zZWxlY3RlZD10cnVlXSB7CiAgYm94LXNoYWRvdzogMCAwIDAgMnB4IHZhcigtLXctZS10ZXh0YXJlYS1zZWxlY3RlZC1ib3JkZXItY29sb3IpCn0KCi53LWUtdGV4dC1wbGFjZWhvbGRlciB7CiAgbGVmdDogMTBweDsKICB0b3A6IDE3cHg7CiAgd2lkdGg6IDkwJQp9Cgoudy1lLW1heC1sZW5ndGgtaW5mbywKLnctZS10ZXh0LXBsYWNlaG9sZGVyIHsKICBjb2xvcjogdmFyKC0tdy1lLXRleHRhcmVhLXNsaWdodC1jb2xvcik7CiAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgcG9zaXRpb246IGFic29sdXRlOwogIC13ZWJraXQtdXNlci1zZWxlY3Q6IG5vbmU7CiAgLW1vei11c2VyLXNlbGVjdDogbm9uZTsKICB1c2VyLXNlbGVjdDogbm9uZQp9Cgoudy1lLW1heC1sZW5ndGgtaW5mbyB7CiAgYm90dG9tOiAuNWVtOwogIHJpZ2h0OiAxZW0KfQoKLnctZS1iYXIgewogIGJhY2tncm91bmQtY29sb3I6IHZhcigtLXctZS10b29sYmFyLWJnLWNvbG9yKTsKICBjb2xvcjogdmFyKC0tdy1lLXRvb2xiYXItY29sb3IpOwogIGZvbnQtc2l6ZTogMTRweDsKICBwYWRkaW5nOiAwIDVweAp9Cgoudy1lLWJhciBzdmcgewogIGZpbGw6IHZhcigtLXctZS10b29sYmFyLWNvbG9yKTsKICBoZWlnaHQ6IDE0cHg7CiAgd2lkdGg6IDE0cHgKfQoKLnctZS1iYXItc2hvdyB7CiAgZGlzcGxheTogZmxleAp9Cgoudy1lLWJhci1oaWRkZW4gewogIGRpc3BsYXk6IG5vbmUKfQoKLnctZS1ob3Zlci1iYXIgewogIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLXctZS10b29sYmFyLWJvcmRlci1jb2xvcik7CiAgYm9yZGVyLXJhZGl1czogM3B4OwogIGJveC1zaGFkb3c6IDAgMnB4IDVweCAjMDAwMDAwMWY7CiAgcG9zaXRpb246IGFic29sdXRlOwogIGJhY2tncm91bmQ6ICNmZmYgIWltcG9ydGFudDsKfQoKLnctZS10b29sYmFyIHsKICBmbGV4LXdyYXA6IHdyYXA7CiAgcG9zaXRpb246IHJlbGF0aXZlCn0KCi53LWUtYmFyLWRpdmlkZXIgewogIGJhY2tncm91bmQtY29sb3I6IHZhcigtLXctZS10b29sYmFyLWJvcmRlci1jb2xvcik7CiAgZGlzcGxheTogaW5saW5lLWZsZXg7CiAgaGVpZ2h0OiA0MHB4OwogIG1hcmdpbjogMCA1cHg7CiAgd2lkdGg6IDFweAp9Cgoudy1lLWJhci1pdGVtIHsKICBkaXNwbGF5OiBmbGV4OwogIGhlaWdodDogNDBweDsKICBwYWRkaW5nOiA0cHg7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIHRleHQtYWxpZ246IGNlbnRlcgp9Cgoudy1lLWJhci1pdGVtLAoudy1lLWJhci1pdGVtIGJ1dHRvbiB7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcgp9Cgoudy1lLWJhci1pdGVtIGJ1dHRvbiB7CiAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7CiAgYm9yZGVyOiBub25lOwogIGNvbG9yOiB2YXIoLS13LWUtdG9vbGJhci1jb2xvcik7CiAgY3Vyc29yOiBwb2ludGVyOwogIGRpc3BsYXk6IGlubGluZS1mbGV4OwogIGhlaWdodDogMzJweDsKICBvdmVyZmxvdzogaGlkZGVuOwogIHBhZGRpbmc6IDAgOHB4OwogIHdoaXRlLXNwYWNlOiBub3dyYXAKfQoKLnctZS1iYXItaXRlbSBidXR0b246aG92ZXIgewogIGJhY2tncm91bmQtY29sb3I6IHZhcigtLXctZS10b29sYmFyLWFjdGl2ZS1iZy1jb2xvcik7CiAgY29sb3I6IHZhcigtLXctZS10b29sYmFyLWFjdGl2ZS1jb2xvcikKfQoKLnctZS1iYXItaXRlbSBidXR0b24gLnRpdGxlIHsKICBtYXJnaW4tbGVmdDogNXB4Cn0KCi53LWUtYmFyLWl0ZW0gLmFjdGl2ZSB7CiAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tdy1lLXRvb2xiYXItYWN0aXZlLWJnLWNvbG9yKTsKICBjb2xvcjogdmFyKC0tdy1lLXRvb2xiYXItYWN0aXZlLWNvbG9yKQp9Cgoudy1lLWJhci1pdGVtIC5kaXNhYmxlZCB7CiAgY29sb3I6IHZhcigtLXctZS10b29sYmFyLWRpc2FibGVkLWNvbG9yKTsKICBjdXJzb3I6IG5vdC1hbGxvd2VkCn0KCi53LWUtYmFyLWl0ZW0gLmRpc2FibGVkIHN2ZyB7CiAgZmlsbDogdmFyKC0tdy1lLXRvb2xiYXItZGlzYWJsZWQtY29sb3IpCn0KCi53LWUtYmFyLWl0ZW0gLmRpc2FibGVkOmhvdmVyIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS13LWUtdG9vbGJhci1iZy1jb2xvcik7CiAgY29sb3I6IHZhcigtLXctZS10b29sYmFyLWRpc2FibGVkLWNvbG9yKQp9Cgoudy1lLWJhci1pdGVtIC5kaXNhYmxlZDpob3ZlciBzdmcgewogIGZpbGw6IHZhcigtLXctZS10b29sYmFyLWRpc2FibGVkLWNvbG9yKQp9Cgoudy1lLW1lbnUtdG9vbHRpcC12NTpiZWZvcmUgewogIGJhY2tncm91bmQtY29sb3I6IHZhcigtLXctZS10b29sYmFyLWFjdGl2ZS1jb2xvcik7CiAgYm9yZGVyLXJhZGl1czogNXB4OwogIGNvbG9yOiB2YXIoLS13LWUtdG9vbGJhci1iZy1jb2xvcik7CiAgY29udGVudDogYXR0cihkYXRhLXRvb2x0aXApOwogIGZvbnQtc2l6ZTogLjc1ZW07CiAgb3BhY2l0eTogMDsKICBwYWRkaW5nOiA1cHggMTBweDsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgdGV4dC1hbGlnbjogY2VudGVyOwogIHRvcDogNDBweDsKICB0cmFuc2l0aW9uOiBvcGFjaXR5IC42czsKICB2aXNpYmlsaXR5OiBoaWRkZW47CiAgd2hpdGUtc3BhY2U6IHByZTsKICB6LWluZGV4OiAxCn0KCi53LWUtbWVudS10b29sdGlwLXY1OmFmdGVyIHsKICBib3JkZXI6IDVweCBzb2xpZCB0cmFuc3BhcmVudDsKICBib3JkZXItYm90dG9tOiA1cHggc29saWQgdmFyKC0tdy1lLXRvb2xiYXItYWN0aXZlLWNvbG9yKTsKICBjb250ZW50OiAiIjsKICBvcGFjaXR5OiAwOwogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB0b3A6IDMwcHg7CiAgdHJhbnNpdGlvbjogb3BhY2l0eSAuNnM7CiAgdmlzaWJpbGl0eTogaGlkZGVuCn0KCi53LWUtbWVudS10b29sdGlwLXY1OmhvdmVyOmFmdGVyLAoudy1lLW1lbnUtdG9vbHRpcC12NTpob3ZlcjpiZWZvcmUgewogIG9wYWNpdHk6IDE7CiAgdmlzaWJpbGl0eTogdmlzaWJsZQp9Cgoudy1lLW1lbnUtdG9vbHRpcC12NS50b29sdGlwLXJpZ2h0OmJlZm9yZSB7CiAgbGVmdDogMTAwJTsKICB0b3A6IDEwcHgKfQoKLnctZS1tZW51LXRvb2x0aXAtdjUudG9vbHRpcC1yaWdodDphZnRlciB7CiAgYm9yZGVyLWJvdHRvbS1jb2xvcjogdHJhbnNwYXJlbnQ7CiAgYm9yZGVyLWxlZnQtY29sb3I6IHRyYW5zcGFyZW50OwogIGJvcmRlci1yaWdodC1jb2xvcjogdmFyKC0tdy1lLXRvb2xiYXItYWN0aXZlLWNvbG9yKTsKICBib3JkZXItdG9wLWNvbG9yOiB0cmFuc3BhcmVudDsKICBsZWZ0OiAxMDAlOwogIG1hcmdpbi1sZWZ0OiAtMTBweDsKICB0b3A6IDE2cHgKfQoKLnctZS1iYXItaXRlbS1ncm91cCAudy1lLWJhci1pdGVtLW1lbnVzLWNvbnRhaW5lciB7CiAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tdy1lLXRvb2xiYXItYmctY29sb3IpOwogIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLXctZS10b29sYmFyLWJvcmRlci1jb2xvcik7CiAgYm9yZGVyLXJhZGl1czogM3B4OwogIGJveC1zaGFkb3c6IDAgMnB4IDEwcHggIzAwMDAwMDFmOwogIGRpc3BsYXk6IG5vbmU7CiAgbGVmdDogMDsKICBtYXJnaW4tdG9wOiA0MHB4OwogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB0b3A6IDA7CiAgei1pbmRleDogMQp9Cgoudy1lLWJhci1pdGVtLWdyb3VwOmhvdmVyIC53LWUtYmFyLWl0ZW0tbWVudXMtY29udGFpbmVyIHsKICBkaXNwbGF5OiBibG9jawp9Cgoudy1lLXNlbGVjdC1saXN0IHsKICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS13LWUtdG9vbGJhci1iZy1jb2xvcik7CiAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tdy1lLXRvb2xiYXItYm9yZGVyLWNvbG9yKTsKICBib3JkZXItcmFkaXVzOiAzcHg7CiAgYm94LXNoYWRvdzogMCAycHggMTBweCAjMDAwMDAwMWY7CiAgbGVmdDogMDsKICBtYXJnaW4tdG9wOiA0MHB4OwogIG1heC1oZWlnaHQ6IDM1MHB4OwogIG1pbi13aWR0aDogMTAwcHg7CiAgb3ZlcmZsb3cteTogYXV0bzsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgdG9wOiAwOwogIHotaW5kZXg6IDEKfQoKLnctZS1zZWxlY3QtbGlzdCB1bCB7CiAgbGluZS1oZWlnaHQ6IDE7CiAgbGlzdC1zdHlsZTogbm9uZQp9Cgoudy1lLXNlbGVjdC1saXN0IHVsIC5zZWxlY3RlZCB7CiAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tdy1lLXRvb2xiYXItYWN0aXZlLWJnLWNvbG9yKQp9Cgoudy1lLXNlbGVjdC1saXN0IHVsIGxpIHsKICBjdXJzb3I6IHBvaW50ZXI7CiAgcGFkZGluZzogN3B4IDAgN3B4IDI1cHg7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIHRleHQtYWxpZ246IGxlZnQ7CiAgd2hpdGUtc3BhY2U6IG5vd3JhcAp9Cgoudy1lLXNlbGVjdC1saXN0IHVsIGxpOmhvdmVyIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS13LWUtdG9vbGJhci1hY3RpdmUtYmctY29sb3IpCn0KCi53LWUtc2VsZWN0LWxpc3QgdWwgbGkgc3ZnIHsKICBsZWZ0OiAwOwogIG1hcmdpbi1sZWZ0OiA1cHg7CiAgbWFyZ2luLXRvcDogLTdweDsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgdG9wOiA1MCUKfQoKLnctZS1iYXItYm90dG9tIC53LWUtc2VsZWN0LWxpc3QgewogIGJvdHRvbTogMDsKICBtYXJnaW4tYm90dG9tOiA0MHB4OwogIG1hcmdpbi10b3A6IDA7CiAgdG9wOiBpbmhlcml0Cn0KCi53LWUtZHJvcC1wYW5lbCB7CiAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tdy1lLXRvb2xiYXItYmctY29sb3IpOwogIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLXctZS10b29sYmFyLWJvcmRlci1jb2xvcik7CiAgYm9yZGVyLXJhZGl1czogM3B4OwogIGJveC1zaGFkb3c6IDAgMnB4IDEwcHggIzAwMDAwMDFmOwogIG1hcmdpbi10b3A6IDQwcHg7CiAgbWluLXdpZHRoOiAyMDBweDsKICBwYWRkaW5nOiAxMHB4OwogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB0b3A6IDA7CiAgei1pbmRleDogMQp9Cgoudy1lLWJhci1ib3R0b20gLnctZS1kcm9wLXBhbmVsIHsKICBib3R0b206IDA7CiAgbWFyZ2luLWJvdHRvbTogNDBweDsKICBtYXJnaW4tdG9wOiAwOwogIHRvcDogaW5oZXJpdAp9Cgoudy1lLW1vZGFsIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS13LWUtdG9vbGJhci1iZy1jb2xvcik7CiAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tdy1lLXRvb2xiYXItYm9yZGVyLWNvbG9yKTsKICBib3JkZXItcmFkaXVzOiAzcHg7CiAgYm94LXNoYWRvdzogMCAycHggMTBweCAjMDAwMDAwMWY7CiAgY29sb3I6IHZhcigtLXctZS10b29sYmFyLWNvbG9yKTsKICBmb250LXNpemU6IDE0cHg7CiAgbWluLWhlaWdodDogNDBweDsKICBtaW4td2lkdGg6IDEwMHB4OwogIHBhZGRpbmc6IDIwcHggMTVweCAwOwogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB0ZXh0LWFsaWduOiBsZWZ0OwogIHotaW5kZXg6IDEKfQoKLnctZS1tb2RhbCAuYnRuLWNsb3NlIHsKICBjdXJzb3I6IHBvaW50ZXI7CiAgbGluZS1oZWlnaHQ6IDE7CiAgcGFkZGluZzogNXB4OwogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICByaWdodDogOHB4OwogIHRvcDogN3B4Cn0KCi53LWUtbW9kYWwgLmJ0bi1jbG9zZSBzdmcgewogIGZpbGw6IHZhcigtLXctZS10b29sYmFyLWNvbG9yKTsKICBoZWlnaHQ6IDEwcHg7CiAgd2lkdGg6IDEwcHgKfQoKLnctZS1tb2RhbCAuYmFiZWwtY29udGFpbmVyIHsKICBkaXNwbGF5OiBibG9jazsKICBtYXJnaW4tYm90dG9tOiAxNXB4Cn0KCi53LWUtbW9kYWwgLmJhYmVsLWNvbnRhaW5lciBzcGFuIHsKICBkaXNwbGF5OiBibG9jazsKICBtYXJnaW4tYm90dG9tOiAxMHB4Cn0KCi53LWUtbW9kYWwgLmJ1dHRvbi1jb250YWluZXIgewogIG1hcmdpbi1ib3R0b206IDE1cHgKfQoKLnctZS1tb2RhbCBidXR0b24gewogIGJhY2tncm91bmQtY29sb3I6IHZhcigtLXctZS1tb2RhbC1idXR0b24tYmctY29sb3IpOwogIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLXctZS1tb2RhbC1idXR0b24tYm9yZGVyLWNvbG9yKTsKICBib3JkZXItcmFkaXVzOiA0cHg7CiAgY29sb3I6IHZhcigtLXctZS10b29sYmFyLWNvbG9yKTsKICBjdXJzb3I6IHBvaW50ZXI7CiAgZm9udC13ZWlnaHQ6IDQwMDsKICBoZWlnaHQ6IDMycHg7CiAgcGFkZGluZzogNC41cHggMTVweDsKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgdG91Y2gtYWN0aW9uOiBtYW5pcHVsYXRpb247CiAgdHJhbnNpdGlvbjogYWxsIC4zcyBjdWJpYy1iZXppZXIoLjY0NSwgLjA0NSwgLjM1NSwgMSk7CiAgLXdlYmtpdC11c2VyLXNlbGVjdDogbm9uZTsKICAtbW96LXVzZXItc2VsZWN0OiBub25lOwogIHVzZXItc2VsZWN0OiBub25lOwogIHdoaXRlLXNwYWNlOiBub3dyYXAKfQoKLnctZS1tb2RhbCBpbnB1dFt0eXBlPW51bWJlcl0sCi53LWUtbW9kYWwgaW5wdXRbdHlwZT10ZXh0XSwKLnctZS1tb2RhbCB0ZXh0YXJlYSB7CiAgZm9udC1mZWF0dXJlLXNldHRpbmdzOiAidG51bSI7CiAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tdy1lLXRvb2xiYXItYmctY29sb3IpOwogIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLXctZS1tb2RhbC1idXR0b24tYm9yZGVyLWNvbG9yKTsKICBib3JkZXItcmFkaXVzOiA0cHg7CiAgY29sb3I6IHZhcigtLXctZS10b29sYmFyLWNvbG9yKTsKICBmb250LXZhcmlhbnQ6IHRhYnVsYXItbnVtczsKICBwYWRkaW5nOiA0LjVweCAxMXB4OwogIHRyYW5zaXRpb246IGFsbCAuM3M7CiAgd2lkdGg6IDEwMCUKfQoKLnctZS1tb2RhbCB0ZXh0YXJlYSB7CiAgbWluLWhlaWdodDogNjBweAp9Cgpib2R5IC53LWUtbW9kYWwsCmJvZHkgLnctZS1tb2RhbCAqIHsKICBib3gtc2l6aW5nOiBib3JkZXItYm94Cn0KCi53LWUtcHJvZ3Jlc3MtYmFyIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS13LWUtdGV4dGFyZWEtaGFuZGxlci1iZy1jb2xvcik7CiAgaGVpZ2h0OiAxcHg7CiAgcG9zaXRpb246IGFic29sdXRlOwogIHRyYW5zaXRpb246IHdpZHRoIC4zczsKICB3aWR0aDogMAp9Cgoudy1lLWZ1bGwtc2NyZWVuLWNvbnRhaW5lciB7CiAgYm90dG9tOiAwICFpbXBvcnRhbnQ7CiAgZGlzcGxheTogZmxleCAhaW1wb3J0YW50OwogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW4gIWltcG9ydGFudDsKICBoZWlnaHQ6IDEwMCUgIWltcG9ydGFudDsKICBsZWZ0OiAwICFpbXBvcnRhbnQ7CiAgbWFyZ2luOiAwICFpbXBvcnRhbnQ7CiAgcGFkZGluZzogMCAhaW1wb3J0YW50OwogIHBvc2l0aW9uOiBmaXhlZDsKICByaWdodDogMCAhaW1wb3J0YW50OwogIHRvcDogMCAhaW1wb3J0YW50OwogIHdpZHRoOiAxMDAlICFpbXBvcnRhbnQKfQoKLnctZS1mdWxsLXNjcmVlbi1jb250YWluZXIgW2RhdGEtdy1lLXRleHRhcmVhPXRydWVdIHsKICBmbGV4OiAxICFpbXBvcnRhbnQKfQoKLnctZS10ZXh0LWNvbnRhaW5lciBbZGF0YS1zbGF0ZS1lZGl0b3JdIGNvZGUgewogIGJhY2tncm91bmQtY29sb3I6IHZhcigtLXctZS10ZXh0YXJlYS1zbGlnaHQtYmctY29sb3IpOwogIGJvcmRlci1yYWRpdXM6IDNweDsKICBmb250LWZhbWlseTogbW9ub3NwYWNlOwogIHBhZGRpbmc6IDNweAp9Cgoudy1lLXBhbmVsLWNvbnRlbnQtY29sb3IgewogIGxpc3Qtc3R5bGU6IG5vbmU7CiAgdGV4dC1hbGlnbjogbGVmdDsKICB3aWR0aDogMjMwcHgKfQoKLnctZS1wYW5lbC1jb250ZW50LWNvbG9yIGxpIHsKICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS13LWUtdG9vbGJhci1iZy1jb2xvcik7CiAgYm9yZGVyLXJhZGl1czogM3B4IDNweDsKICBjdXJzb3I6IHBvaW50ZXI7CiAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogIHBhZGRpbmc6IDJweAp9Cgoudy1lLXBhbmVsLWNvbnRlbnQtY29sb3IgbGk6aG92ZXIgewogIGJvcmRlci1jb2xvcjogdmFyKC0tdy1lLXRvb2xiYXItY29sb3IpCn0KCi53LWUtcGFuZWwtY29udGVudC1jb2xvciBsaSAuY29sb3ItYmxvY2sgewogIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLXctZS10b29sYmFyLWJvcmRlci1jb2xvcik7CiAgYm9yZGVyLXJhZGl1czogM3B4IDNweDsKICBoZWlnaHQ6IDE3cHg7CiAgd2lkdGg6IDE3cHgKfQoKLnctZS1wYW5lbC1jb250ZW50LWNvbG9yIC5hY3RpdmUgewogIGJvcmRlci1jb2xvcjogdmFyKC0tdy1lLXRvb2xiYXItY29sb3IpCn0KCi53LWUtcGFuZWwtY29udGVudC1jb2xvciAuY2xlYXIgewogIGxpbmUtaGVpZ2h0OiAxLjU7CiAgbWFyZ2luLWJvdHRvbTogNXB4OwogIHdpZHRoOiAxMDAlCn0KCi53LWUtcGFuZWwtY29udGVudC1jb2xvciAuY2xlYXIgc3ZnIHsKICBoZWlnaHQ6IDE2cHg7CiAgbWFyZ2luLWJvdHRvbTogLTRweDsKICB3aWR0aDogMTZweAp9Cgoudy1lLXRleHQtY29udGFpbmVyIFtkYXRhLXNsYXRlLWVkaXRvcl0gYmxvY2txdW90ZSB7CiAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tdy1lLXRleHRhcmVhLXNsaWdodC1iZy1jb2xvcik7CiAgYm9yZGVyLWxlZnQ6IDhweCBzb2xpZCB2YXIoLS13LWUtdGV4dGFyZWEtc2VsZWN0ZWQtYm9yZGVyLWNvbG9yKTsKICBkaXNwbGF5OiBibG9jazsKICBmb250LXNpemU6IDEwMCU7CiAgbGluZS1oZWlnaHQ6IDEuNTsKICBtYXJnaW46IDEwcHggMDsKICBwYWRkaW5nOiAxMHB4Cn0KCi53LWUtcGFuZWwtY29udGVudC1lbW90aW9uIHsKICBmb250LXNpemU6IDIwcHg7CiAgbGlzdC1zdHlsZTogbm9uZTsKICB0ZXh0LWFsaWduOiBsZWZ0OwogIHdpZHRoOiAzMDBweAp9Cgoudy1lLXBhbmVsLWNvbnRlbnQtZW1vdGlvbiBsaSB7CiAgYm9yZGVyLXJhZGl1czogM3B4IDNweDsKICBjdXJzb3I6IHBvaW50ZXI7CiAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogIHBhZGRpbmc6IDAgNXB4Cn0KCi53LWUtcGFuZWwtY29udGVudC1lbW90aW9uIGxpOmhvdmVyIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS13LWUtdGV4dGFyZWEtc2xpZ2h0LWJnLWNvbG9yKQp9Cgoudy1lLXRleHRhcmVhLWRpdmlkZXIgewogIGJvcmRlci1yYWRpdXM6IDNweDsKICBtYXJnaW46IDIwcHggYXV0bzsKICBwYWRkaW5nOiAwcHgKfQoKLnctZS10ZXh0YXJlYS1kaXZpZGVyIGhyIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS13LWUtdGV4dGFyZWEtYm9yZGVyLWNvbG9yKTsKICBib3JkZXI6IDA7CiAgZGlzcGxheTogYmxvY2s7CiAgaGVpZ2h0OiAxcHgKfQoKLnctZS10ZXh0LWNvbnRhaW5lciBbZGF0YS1zbGF0ZS1lZGl0b3JdIHByZT5jb2RlIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS13LWUtdGV4dGFyZWEtc2xpZ2h0LWJnLWNvbG9yKTsKICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS13LWUtdGV4dGFyZWEtc2xpZ2h0LWJvcmRlci1jb2xvcik7CiAgYm9yZGVyLXJhZGl1czogNHB4IDRweDsKICBkaXNwbGF5OiBibG9jazsKICBmb250LXNpemU6IDE0cHg7CiAgcGFkZGluZzogMTBweDsKICB0ZXh0LWluZGVudDogMAp9Cgoudy1lLXRleHQtY29udGFpbmVyIFtkYXRhLXNsYXRlLWVkaXRvcl0gLnctZS1pbWFnZS1jb250YWluZXIgewogIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICBtYXJnaW46IDAgM3B4Cn0KCi53LWUtdGV4dC1jb250YWluZXIgW2RhdGEtc2xhdGUtZWRpdG9yXSAudy1lLWltYWdlLWNvbnRhaW5lcjpob3ZlciB7CiAgYm94LXNoYWRvdzogMCAwIDAgMnB4IHZhcigtLXctZS10ZXh0YXJlYS1zZWxlY3RlZC1ib3JkZXItY29sb3IpCn0KCi53LWUtdGV4dC1jb250YWluZXIgW2RhdGEtc2xhdGUtZWRpdG9yXSAudy1lLXNlbGVjdGVkLWltYWdlLWNvbnRhaW5lciB7CiAgb3ZlcmZsb3c6IGhpZGRlbjsKICBwb3NpdGlvbjogcmVsYXRpdmUKfQoKLnctZS10ZXh0LWNvbnRhaW5lciBbZGF0YS1zbGF0ZS1lZGl0b3JdIC53LWUtc2VsZWN0ZWQtaW1hZ2UtY29udGFpbmVyIC53LWUtaW1hZ2UtZHJhZ2dlciB7CiAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tdy1lLXRleHRhcmVhLWhhbmRsZXItYmctY29sb3IpOwogIGhlaWdodDogN3B4OwogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB3aWR0aDogN3B4Cn0KCi53LWUtdGV4dC1jb250YWluZXIgW2RhdGEtc2xhdGUtZWRpdG9yXSAudy1lLXNlbGVjdGVkLWltYWdlLWNvbnRhaW5lciAubGVmdC10b3AgewogIGN1cnNvcjogbndzZS1yZXNpemU7CiAgbGVmdDogMDsKICB0b3A6IDAKfQoKLnctZS10ZXh0LWNvbnRhaW5lciBbZGF0YS1zbGF0ZS1lZGl0b3JdIC53LWUtc2VsZWN0ZWQtaW1hZ2UtY29udGFpbmVyIC5yaWdodC10b3AgewogIGN1cnNvcjogbmVzdy1yZXNpemU7CiAgcmlnaHQ6IDA7CiAgdG9wOiAwCn0KCi53LWUtdGV4dC1jb250YWluZXIgW2RhdGEtc2xhdGUtZWRpdG9yXSAudy1lLXNlbGVjdGVkLWltYWdlLWNvbnRhaW5lciAubGVmdC1ib3R0b20gewogIGJvdHRvbTogMDsKICBjdXJzb3I6IG5lc3ctcmVzaXplOwogIGxlZnQ6IDAKfQoKLnctZS10ZXh0LWNvbnRhaW5lciBbZGF0YS1zbGF0ZS1lZGl0b3JdIC53LWUtc2VsZWN0ZWQtaW1hZ2UtY29udGFpbmVyIC5yaWdodC1ib3R0b20gewogIGJvdHRvbTogMDsKICBjdXJzb3I6IG53c2UtcmVzaXplOwogIHJpZ2h0OiAwCn0KCi53LWUtdGV4dC1jb250YWluZXIgW2RhdGEtc2xhdGUtZWRpdG9yXSAudy1lLXNlbGVjdGVkLWltYWdlLWNvbnRhaW5lcjpob3ZlciB7CiAgYm94LXNoYWRvdzogbm9uZQp9Cgoudy1lLXRleHQtY29udGFpbmVyIFtjb250ZW50ZWRpdGFibGU9ZmFsc2VdIC53LWUtaW1hZ2UtY29udGFpbmVyOmhvdmVyIHsKICBib3gtc2hhZG93OiBub25lCn0KCi53LWUtdGV4dC1jb250YWluZXIgW2RhdGEtc2xhdGUtZWRpdG9yXSAudGFibGUtY29udGFpbmVyIHsKICBib3JkZXI6IDFweCBkYXNoZWQgdmFyKC0tdy1lLXRleHRhcmVhLWJvcmRlci1jb2xvcik7CiAgYm9yZGVyLXJhZGl1czogNXB4OwogIG1hcmdpbi10b3A6IDEwcHg7CiAgb3ZlcmZsb3cteDogYXV0bzsKICBwYWRkaW5nOiAxMHB4OwogIHdpZHRoOiAxMDAlCn0KCi53LWUtdGV4dC1jb250YWluZXIgW2RhdGEtc2xhdGUtZWRpdG9yXSB0YWJsZSB7CiAgYm9yZGVyLWNvbGxhcHNlOiBjb2xsYXBzZQp9Cgoudy1lLXRleHQtY29udGFpbmVyIFtkYXRhLXNsYXRlLWVkaXRvcl0gdGFibGUgdGQsCi53LWUtdGV4dC1jb250YWluZXIgW2RhdGEtc2xhdGUtZWRpdG9yXSB0YWJsZSB0aCB7CiAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tdy1lLXRleHRhcmVhLWJvcmRlci1jb2xvcik7CiAgbGluZS1oZWlnaHQ6IDEuNTsKICBtaW4td2lkdGg6IDMwcHg7CiAgcGFkZGluZzogM3B4IDVweDsKICB0ZXh0LWFsaWduOiBsZWZ0Cn0KCi53LWUtdGV4dC1jb250YWluZXIgW2RhdGEtc2xhdGUtZWRpdG9yXSB0YWJsZSB0aCB7CiAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tdy1lLXRleHRhcmVhLXNsaWdodC1iZy1jb2xvcik7CiAgZm9udC13ZWlnaHQ6IDcwMDsKICB0ZXh0LWFsaWduOiBjZW50ZXIKfQoKLnctZS1wYW5lbC1jb250ZW50LXRhYmxlIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS13LWUtdG9vbGJhci1iZy1jb2xvcikKfQoKLnctZS1wYW5lbC1jb250ZW50LXRhYmxlIHRhYmxlIHsKICBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlCn0KCi53LWUtcGFuZWwtY29udGVudC10YWJsZSB0ZCB7CiAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tdy1lLXRvb2xiYXItYm9yZGVyLWNvbG9yKTsKICBjdXJzb3I6IHBvaW50ZXI7CiAgaGVpZ2h0OiAxNXB4OwogIHBhZGRpbmc6IDNweCA1cHg7CiAgd2lkdGg6IDIwcHgKfQoKLnctZS1wYW5lbC1jb250ZW50LXRhYmxlIHRkLmFjdGl2ZSB7CiAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tdy1lLXRvb2xiYXItYWN0aXZlLWJnLWNvbG9yKQp9Cgoudy1lLXRleHRhcmVhLXZpZGVvLWNvbnRhaW5lciB7CiAgYmFja2dyb3VuZC1pbWFnZTogbGluZWFyLWdyYWRpZW50KDQ1ZGVnLCAjZWVlIDI1JSwgdHJhbnNwYXJlbnQgMCwgdHJhbnNwYXJlbnQgNzUlLCAjZWVlIDAsICNlZWUpLCBsaW5lYXItZ3JhZGllbnQoNDVkZWcsICNlZWUgMjUlLCAjZmZmIDAsICNmZmYgNzUlLCAjZWVlIDAsICNlZWUpOwogIGJhY2tncm91bmQtcG9zaXRpb246IDAgMCwgMTBweCAxMHB4OwogIGJhY2tncm91bmQtc2l6ZTogMjBweCAyMHB4OwogIGJvcmRlcjogMXB4IGRhc2hlZCB2YXIoLS13LWUtdGV4dGFyZWEtYm9yZGVyLWNvbG9yKTsKICBib3JkZXItcmFkaXVzOiA1cHg7CiAgbWFyZ2luOiAxMHB4IGF1dG8gMDsKICBwYWRkaW5nOiAxMHB4IDA7CiAgdGV4dC1hbGlnbjogY2VudGVyCn0KCi53LWUtdGV4dC1jb250YWluZXIgW2RhdGEtc2xhdGUtZWRpdG9yXSBwcmU+Y29kZSB7CiAgd29yZC13cmFwOiBub3JtYWw7CiAgZm9udC1mYW1pbHk6IENvbnNvbGFzLCBNb25hY28sIEFuZGFsZSBNb25vLCBVYnVudHUgTW9ubywgbW9ub3NwYWNlOwogIC13ZWJraXQtaHlwaGVuczogbm9uZTsKICBoeXBoZW5zOiBub25lOwogIGxpbmUtaGVpZ2h0OiAxLjU7CiAgbWFyZ2luOiAuNWVtIDA7CiAgb3ZlcmZsb3c6IGF1dG87CiAgcGFkZGluZzogMWVtOwogIC1tb3otdGFiLXNpemU6IDQ7CiAgLW8tdGFiLXNpemU6IDQ7CiAgdGFiLXNpemU6IDQ7CiAgdGV4dC1hbGlnbjogbGVmdDsKICB0ZXh0LXNoYWRvdzogMCAxcHggI2ZmZjsKICB3aGl0ZS1zcGFjZTogcHJlOwogIHdvcmQtYnJlYWs6IG5vcm1hbDsKICB3b3JkLXNwYWNpbmc6IG5vcm1hbAp9Cgoudy1lLXRleHQtY29udGFpbmVyIFtkYXRhLXNsYXRlLWVkaXRvcl0gcHJlPmNvZGUgLnRva2VuLmNkYXRhLAoudy1lLXRleHQtY29udGFpbmVyIFtkYXRhLXNsYXRlLWVkaXRvcl0gcHJlPmNvZGUgLnRva2VuLmNvbW1lbnQsCi53LWUtdGV4dC1jb250YWluZXIgW2RhdGEtc2xhdGUtZWRpdG9yXSBwcmU+Y29kZSAudG9rZW4uZG9jdHlwZSwKLnctZS10ZXh0LWNvbnRhaW5lciBbZGF0YS1zbGF0ZS1lZGl0b3JdIHByZT5jb2RlIC50b2tlbi5wcm9sb2cgewogIGNvbG9yOiAjNzA4MDkwCn0KCi53LWUtdGV4dC1jb250YWluZXIgW2RhdGEtc2xhdGUtZWRpdG9yXSBwcmU+Y29kZSAudG9rZW4ucHVuY3R1YXRpb24gewogIGNvbG9yOiAjOTk5Cn0KCi53LWUtdGV4dC1jb250YWluZXIgW2RhdGEtc2xhdGUtZWRpdG9yXSBwcmU+Y29kZSAudG9rZW4ubmFtZXNwYWNlIHsKICBvcGFjaXR5OiAuNwp9Cgoudy1lLXRleHQtY29udGFpbmVyIFtkYXRhLXNsYXRlLWVkaXRvcl0gcHJlPmNvZGUgLnRva2VuLmJvb2xlYW4sCi53LWUtdGV4dC1jb250YWluZXIgW2RhdGEtc2xhdGUtZWRpdG9yXSBwcmU+Y29kZSAudG9rZW4uY29uc3RhbnQsCi53LWUtdGV4dC1jb250YWluZXIgW2RhdGEtc2xhdGUtZWRpdG9yXSBwcmU+Y29kZSAudG9rZW4uZGVsZXRlZCwKLnctZS10ZXh0LWNvbnRhaW5lciBbZGF0YS1zbGF0ZS1lZGl0b3JdIHByZT5jb2RlIC50b2tlbi5udW1iZXIsCi53LWUtdGV4dC1jb250YWluZXIgW2RhdGEtc2xhdGUtZWRpdG9yXSBwcmU+Y29kZSAudG9rZW4ucHJvcGVydHksCi53LWUtdGV4dC1jb250YWluZXIgW2RhdGEtc2xhdGUtZWRpdG9yXSBwcmU+Y29kZSAudG9rZW4uc3ltYm9sLAoudy1lLXRleHQtY29udGFpbmVyIFtkYXRhLXNsYXRlLWVkaXRvcl0gcHJlPmNvZGUgLnRva2VuLnRhZyB7CiAgY29sb3I6ICM5MDUKfQoKLnctZS10ZXh0LWNvbnRhaW5lciBbZGF0YS1zbGF0ZS1lZGl0b3JdIHByZT5jb2RlIC50b2tlbi5hdHRyLW5hbWUsCi53LWUtdGV4dC1jb250YWluZXIgW2RhdGEtc2xhdGUtZWRpdG9yXSBwcmU+Y29kZSAudG9rZW4uYnVpbHRpbiwKLnctZS10ZXh0LWNvbnRhaW5lciBbZGF0YS1zbGF0ZS1lZGl0b3JdIHByZT5jb2RlIC50b2tlbi5jaGFyLAoudy1lLXRleHQtY29udGFpbmVyIFtkYXRhLXNsYXRlLWVkaXRvcl0gcHJlPmNvZGUgLnRva2VuLmluc2VydGVkLAoudy1lLXRleHQtY29udGFpbmVyIFtkYXRhLXNsYXRlLWVkaXRvcl0gcHJlPmNvZGUgLnRva2VuLnNlbGVjdG9yLAoudy1lLXRleHQtY29udGFpbmVyIFtkYXRhLXNsYXRlLWVkaXRvcl0gcHJlPmNvZGUgLnRva2VuLnN0cmluZyB7CiAgY29sb3I6ICM2OTAKfQoKLnctZS10ZXh0LWNvbnRhaW5lciBbZGF0YS1zbGF0ZS1lZGl0b3JdIHByZT5jb2RlIC5sYW5ndWFnZS1jc3MgLnRva2VuLnN0cmluZywKLnctZS10ZXh0LWNvbnRhaW5lciBbZGF0YS1zbGF0ZS1lZGl0b3JdIHByZT5jb2RlIC5zdHlsZSAudG9rZW4uc3RyaW5nLAoudy1lLXRleHQtY29udGFpbmVyIFtkYXRhLXNsYXRlLWVkaXRvcl0gcHJlPmNvZGUgLnRva2VuLmVudGl0eSwKLnctZS10ZXh0LWNvbnRhaW5lciBbZGF0YS1zbGF0ZS1lZGl0b3JdIHByZT5jb2RlIC50b2tlbi5vcGVyYXRvciwKLnctZS10ZXh0LWNvbnRhaW5lciBbZGF0YS1zbGF0ZS1lZGl0b3JdIHByZT5jb2RlIC50b2tlbi51cmwgewogIGNvbG9yOiAjOWE2ZTNhCn0KCi53LWUtdGV4dC1jb250YWluZXIgW2RhdGEtc2xhdGUtZWRpdG9yXSBwcmU+Y29kZSAudG9rZW4uYXRydWxlLAoudy1lLXRleHQtY29udGFpbmVyIFtkYXRhLXNsYXRlLWVkaXRvcl0gcHJlPmNvZGUgLnRva2VuLmF0dHItdmFsdWUsCi53LWUtdGV4dC1jb250YWluZXIgW2RhdGEtc2xhdGUtZWRpdG9yXSBwcmU+Y29kZSAudG9rZW4ua2V5d29yZCB7CiAgY29sb3I6ICMwN2EKfQoKLnctZS10ZXh0LWNvbnRhaW5lciBbZGF0YS1zbGF0ZS1lZGl0b3JdIHByZT5jb2RlIC50b2tlbi5jbGFzcy1uYW1lLAoudy1lLXRleHQtY29udGFpbmVyIFtkYXRhLXNsYXRlLWVkaXRvcl0gcHJlPmNvZGUgLnRva2VuLmZ1bmN0aW9uIHsKICBjb2xvcjogI2RkNGE2OAp9Cgoudy1lLXRleHQtY29udGFpbmVyIFtkYXRhLXNsYXRlLWVkaXRvcl0gcHJlPmNvZGUgLnRva2VuLmltcG9ydGFudCwKLnctZS10ZXh0LWNvbnRhaW5lciBbZGF0YS1zbGF0ZS1lZGl0b3JdIHByZT5jb2RlIC50b2tlbi5yZWdleCwKLnctZS10ZXh0LWNvbnRhaW5lciBbZGF0YS1zbGF0ZS1lZGl0b3JdIHByZT5jb2RlIC50b2tlbi52YXJpYWJsZSB7CiAgY29sb3I6ICNlOTAKfQoKLnctZS10ZXh0LWNvbnRhaW5lciBbZGF0YS1zbGF0ZS1lZGl0b3JdIHByZT5jb2RlIC50b2tlbi5ib2xkLAoudy1lLXRleHQtY29udGFpbmVyIFtkYXRhLXNsYXRlLWVkaXRvcl0gcHJlPmNvZGUgLnRva2VuLmltcG9ydGFudCB7CiAgZm9udC13ZWlnaHQ6IDcwMAp9Cgoudy1lLXRleHQtY29udGFpbmVyIFtkYXRhLXNsYXRlLWVkaXRvcl0gcHJlPmNvZGUgLnRva2VuLml0YWxpYyB7CiAgZm9udC1zdHlsZTogaXRhbGljCn0KCi53LWUtdGV4dC1jb250YWluZXIgW2RhdGEtc2xhdGUtZWRpdG9yXSBwcmU+Y29kZSAudG9rZW4uZW50aXR5IHsKICBjdXJzb3I6IGhlbHAKfQoKLkFydGljbGVFZGl0b3IgI3Rvb2xiYXItY29udGFpbmVyIHsKICBib3JkZXItYm90dG9tOiBzb2xpZCAxcHggI2YyZjJmMjsKICBwYWRkaW5nLXJpZ2h0OiAyMHB4Owp9CgouQXJ0aWNsZUVkaXRvciAudy1lLWJhci1kaXZpZGVyIHsKICBkaXNwbGF5OiBub25lOwp9"
  },
  script: {
    eidtor: "data:text/javascript;base64,KGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHsKICB0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgPyBmYWN0b3J5KGV4cG9ydHMpIDoKICB0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQgPyBkZWZpbmUoWydleHBvcnRzJ10sIGZhY3RvcnkpIDoKICAoZ2xvYmFsID0gdHlwZW9mIGdsb2JhbFRoaXMgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsVGhpcyA6IGdsb2JhbCB8fCBzZWxmLCBmYWN0b3J5KGdsb2JhbC53YW5nRWRpdG9yID0ge30pKTsKfSkodGhpcywgKGZ1bmN0aW9uIChleHBvcnRzKSB7ICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogQGRlc2NyaXB0aW9uIGJyb3dzZXIgcG9seWZpbGwKICAgKiBAYXV0aG9yIHdhbmdmdXBlbmcKICAgKi8KICB2YXIgX2E7CiAgLy8gQHRzLW5vY2hlY2sKICAvLyDlv4XpobvmmK/mtY/op4jlmajnjq/looMKICBpZiAodHlwZW9mIGdsb2JhbCA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgLy8g5qOA5p+lIElFIOa1j+iniOWZqAogICAgICBpZiAoJ0FjdGl2ZVhPYmplY3QnIGluIHdpbmRvdykgewogICAgICAgICAgdmFyIGluZm8gPSAn5oqx5q2J77yMd2FuZ0VkaXRvciBWNSsg54mI5pys5byA5aeL77yM5LiN5Zyo5pSv5oyBIElFIOa1j+iniOWZqCc7CiAgICAgICAgICBpbmZvICs9ICdcbiBTb3JyeSwgd2FuZ0VkaXRvciBWNSsgdmVyc2lvbnMgZG8gbm90IHN1cHBvcnQgSUUgYnJvd3Nlci4nOwogICAgICAgICAgY29uc29sZS5lcnJvcihpbmZvKTsKICAgICAgfQogICAgICBnbG9iYWxUaGlzUG9seWZpbGwoKTsKICAgICAgQWdncmVnYXRlRXJyb3JQb2x5ZmlsbCgpOwogIH0KICBlbHNlIGlmIChnbG9iYWwgJiYgKChfYSA9IGdsb2JhbC5uYXZpZ2F0b3IpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS51c2VyQWdlbnQubWF0Y2goJ1FRQnJvd3NlcicpKSkgewogICAgICAvLyDlhbzlrrkgUVEg5rWP6KeI5ZmoIEFnZ3JlZ2F0ZUVycm9yIOaKpemUmQogICAgICBnbG9iYWxUaGlzUG9seWZpbGwoKTsKICAgICAgQWdncmVnYXRlRXJyb3JQb2x5ZmlsbCgpOwogIH0KICBmdW5jdGlvbiBnbG9iYWxUaGlzUG9seWZpbGwoKSB7CiAgICAgIC8vIOmDqOWIhua1j+iniOWZqOS4jeaUr+aMgSBnbG9iYWxUaGlzCiAgICAgIGlmICh0eXBlb2YgZ2xvYmFsVGhpcyA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgIC8vIEB0cy1pZ25vcmUKICAgICAgICAgIHdpbmRvdy5nbG9iYWxUaGlzID0gd2luZG93OwogICAgICB9CiAgfQogIGZ1bmN0aW9uIEFnZ3JlZ2F0ZUVycm9yUG9seWZpbGwoKSB7CiAgICAgIGlmICh0eXBlb2YgQWdncmVnYXRlRXJyb3IgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICB3aW5kb3cuQWdncmVnYXRlRXJyb3IgPSBmdW5jdGlvbiAoZXJyb3JzLCBtc2cpIHsKICAgICAgICAgICAgICB2YXIgZXJyID0gbmV3IEVycm9yKG1zZyk7CiAgICAgICAgICAgICAgZXJyLmVycm9ycyA9IGVycm9yczsKICAgICAgICAgICAgICByZXR1cm4gZXJyOwogICAgICAgICAgfTsKICAgICAgfQogIH0KCiAgLyoqCiAgICogQGRlc2NyaXB0aW9uIG5vZGUgcG9seWZpbGwKICAgKiBAYXV0aG9yIHdhbmdmdXBlbmcKICAgKi8KICAvLyBAdHMtbm9jaGVjawogIC8vIOW/hemhu+aYryBub2RlIOeOr+WigwogIGlmICh0eXBlb2YgZ2xvYmFsID09PSAnb2JqZWN0JykgewogICAgICAvLyDnlKjkuo4gbm9kZWpzIO+8jOmBv+WFjeaKpemUmQogICAgICB2YXIgZ2xvYmFsUHJvcGVydHkgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGdsb2JhbCwgJ3dpbmRvdycpOwogICAgICAvLyBnbG9iYWwud2luZG93IOS4uuepuuWImeebtOaOpeWGmeWFpQogICAgICAvLyDpg6jliIbmoYbmnrbkuIvlt7Lnu4/lrprkuYnkuoZnbG9iYWwud2luZG935LiU5piv5LiN5Y+v5YaZ5bGe5oCnCiAgICAgIGlmICghZ2xvYmFsLndpbmRvdyB8fCBnbG9iYWxQcm9wZXJ0eS5zZXQpIHsKICAgICAgICAgIGdsb2JhbC53aW5kb3cgPSBnbG9iYWw7CiAgICAgICAgICBnbG9iYWwucmVxdWVzdEFuaW1hdGlvbkZyYW1lID0gZnVuY3Rpb24gKCkgeyB9OwogICAgICAgICAgZ2xvYmFsLm5hdmlnYXRvciA9IHsKICAgICAgICAgICAgICB1c2VyQWdlbnQ6ICcnLAogICAgICAgICAgfTsKICAgICAgICAgIGdsb2JhbC5sb2NhdGlvbiA9IHsKICAgICAgICAgICAgICBob3N0bmFtZTogJzAuMC4wLjAnLAogICAgICAgICAgICAgIHBvcnQ6IDAsCiAgICAgICAgICAgICAgcHJvdG9jb2w6ICdodHRwOicsCiAgICAgICAgICB9OwogICAgICAgICAgZ2xvYmFsLmJ0b2EgPSBmdW5jdGlvbiAoKSB7IH07CiAgICAgICAgICBnbG9iYWwuY3J5cHRvID0gewogICAgICAgICAgICAgIGdldFJhbmRvbVZhbHVlczogZnVuY3Rpb24gKGJ1ZmZlcikgewogICAgICAgICAgICAgICAgICByZXR1cm4gbm9kZUNyeXB0by5yYW5kb21GaWxsU3luYyhidWZmZXIpOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICB9OwogICAgICB9CiAgICAgIGlmIChnbG9iYWwuZG9jdW1lbnQgIT0gbnVsbCkgewogICAgICAgICAgLy8gU1NSIOeOr+Wig+S4i+WPr+iDveS8muaKpemUmSDvvIhpc3N1ZSA0NDA577yJCiAgICAgICAgICBpZiAoZ2xvYmFsLmRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lID09IG51bGwpIHsKICAgICAgICAgICAgICBnbG9iYWwuZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBbXTsgfTsKICAgICAgICAgIH0KICAgICAgfQogIH0KCiAgdmFyIGNvbW1vbmpzR2xvYmFsID0gdHlwZW9mIGdsb2JhbFRoaXMgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsVGhpcyA6IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gd2luZG93IDogdHlwZW9mIGdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgPyBnbG9iYWwgOiB0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgPyBzZWxmIDoge307CgogIGZ1bmN0aW9uIGdldERlZmF1bHRFeHBvcnRGcm9tQ2pzICh4KSB7CiAgCXJldHVybiB4ICYmIHguX19lc01vZHVsZSAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoeCwgJ2RlZmF1bHQnKSA/IHhbJ2RlZmF1bHQnXSA6IHg7CiAgfQoKICBmdW5jdGlvbiBjcmVhdGVDb21tb25qc01vZHVsZSQxKGZuKSB7CiAgICB2YXIgbW9kdWxlID0geyBleHBvcnRzOiB7fSB9OwogIAlyZXR1cm4gZm4obW9kdWxlLCBtb2R1bGUuZXhwb3J0cyksIG1vZHVsZS5leHBvcnRzOwogIH0KCiAgLyohCiAgICogaXMtcGxhaW4tb2JqZWN0IDxodHRwczovL2dpdGh1Yi5jb20vam9uc2NobGlua2VydC9pcy1wbGFpbi1vYmplY3Q+CiAgICoKICAgKiBDb3B5cmlnaHQgKGMpIDIwMTQtMjAxNywgSm9uIFNjaGxpbmtlcnQuCiAgICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLgogICAqLwoKICBmdW5jdGlvbiBpc09iamVjdCQ0KG8pIHsKICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykgPT09ICdbb2JqZWN0IE9iamVjdF0nOwogIH0KCiAgZnVuY3Rpb24gaXNQbGFpbk9iamVjdCQyKG8pIHsKICAgIHZhciBjdG9yLHByb3Q7CgogICAgaWYgKGlzT2JqZWN0JDQobykgPT09IGZhbHNlKSByZXR1cm4gZmFsc2U7CgogICAgLy8gSWYgaGFzIG1vZGlmaWVkIGNvbnN0cnVjdG9yCiAgICBjdG9yID0gby5jb25zdHJ1Y3RvcjsKICAgIGlmIChjdG9yID09PSB1bmRlZmluZWQpIHJldHVybiB0cnVlOwoKICAgIC8vIElmIGhhcyBtb2RpZmllZCBwcm90b3R5cGUKICAgIHByb3QgPSBjdG9yLnByb3RvdHlwZTsKICAgIGlmIChpc09iamVjdCQ0KHByb3QpID09PSBmYWxzZSkgcmV0dXJuIGZhbHNlOwoKICAgIC8vIElmIGNvbnN0cnVjdG9yIGRvZXMgbm90IGhhdmUgYW4gT2JqZWN0LXNwZWNpZmljIG1ldGhvZAogICAgaWYgKHByb3QuaGFzT3duUHJvcGVydHkoJ2lzUHJvdG90eXBlT2YnKSA9PT0gZmFsc2UpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vIE1vc3QgbGlrZWx5IGEgcGxhaW4gT2JqZWN0CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIHZhciBpc1BsYWluT2JqZWN0XzIgPSBpc1BsYWluT2JqZWN0JDI7CgogIHZhciBpc1BsYWluT2JqZWN0XzEgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAJaXNQbGFpbk9iamVjdDogaXNQbGFpbk9iamVjdF8yCiAgfSwgJ19fZXNNb2R1bGUnLCB7dmFsdWU6IHRydWV9KTsKCiAgdmFyIF9yZWY7CgogIC8vIFNob3VsZCBiZSBubyBpbXBvcnRzIGhlcmUhCiAgLy8gU29tZSB0aGluZ3MgdGhhdCBzaG91bGQgYmUgZXZhbHVhdGVkIGJlZm9yZSBhbGwgZWxzZS4uLgogIC8vIFdlIG9ubHkgd2FudCB0byBrbm93IGlmIG5vbi1wb2x5ZmlsbGVkIHN5bWJvbHMgYXJlIGF2YWlsYWJsZQogIHZhciBoYXNTeW1ib2wgPSB0eXBlb2YgU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2YKICAvKiNfX1BVUkVfXyovCiAgU3ltYm9sKCJ4IikgPT09ICJzeW1ib2wiOwogIHZhciBoYXNNYXAgPSB0eXBlb2YgTWFwICE9PSAidW5kZWZpbmVkIjsKICB2YXIgaGFzU2V0ID0gdHlwZW9mIFNldCAhPT0gInVuZGVmaW5lZCI7CiAgdmFyIGhhc1Byb3hpZXMgPSB0eXBlb2YgUHJveHkgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZiBQcm94eS5yZXZvY2FibGUgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZiBSZWZsZWN0ICE9PSAidW5kZWZpbmVkIjsKICAvKioKICAgKiBUaGUgc2VudGluZWwgdmFsdWUgcmV0dXJuZWQgYnkgcHJvZHVjZXJzIHRvIHJlcGxhY2UgdGhlIGRyYWZ0IHdpdGggdW5kZWZpbmVkLgogICAqLwoKICB2YXIgTk9USElORyA9IGhhc1N5bWJvbCA/CiAgLyojX19QVVJFX18qLwogIFN5bWJvbC5mb3IoImltbWVyLW5vdGhpbmciKSA6IChfcmVmID0ge30sIF9yZWZbImltbWVyLW5vdGhpbmciXSA9IHRydWUsIF9yZWYpOwogIC8qKgogICAqIFRvIGxldCBJbW1lciB0cmVhdCB5b3VyIGNsYXNzIGluc3RhbmNlcyBhcyBwbGFpbiBpbW11dGFibGUgb2JqZWN0cwogICAqIChhbGJlaXQgd2l0aCBhIGN1c3RvbSBwcm90b3R5cGUpLCB5b3UgbXVzdCBkZWZpbmUgZWl0aGVyIGFuIGluc3RhbmNlIHByb3BlcnR5CiAgICogb3IgYSBzdGF0aWMgcHJvcGVydHkgb24gZWFjaCBvZiB5b3VyIGN1c3RvbSBjbGFzc2VzLgogICAqCiAgICogT3RoZXJ3aXNlLCB5b3VyIGNsYXNzIGluc3RhbmNlIHdpbGwgbmV2ZXIgYmUgZHJhZnRlZCwgd2hpY2ggbWVhbnMgaXQgd29uJ3QgYmUKICAgKiBzYWZlIHRvIG11dGF0ZSBpbiBhIHByb2R1Y2UgY2FsbGJhY2suCiAgICovCgogIHZhciBEUkFGVEFCTEUgPSBoYXNTeW1ib2wgPwogIC8qI19fUFVSRV9fKi8KICBTeW1ib2wuZm9yKCJpbW1lci1kcmFmdGFibGUiKSA6ICJfXyRpbW1lcl9kcmFmdGFibGUiOwogIHZhciBEUkFGVF9TVEFURSA9IGhhc1N5bWJvbCA/CiAgLyojX19QVVJFX18qLwogIFN5bWJvbC5mb3IoImltbWVyLXN0YXRlIikgOiAiX18kaW1tZXJfc3RhdGUiOyAvLyBFdmVuIGEgcG9seWZpbGxlZCBTeW1ib2wgbWlnaHQgcHJvdmlkZSBTeW1ib2wuaXRlcmF0b3IKCiAgdmFyIGl0ZXJhdG9yU3ltYm9sJDEgPSB0eXBlb2YgU3ltYm9sICE9ICJ1bmRlZmluZWQiICYmIFN5bWJvbC5pdGVyYXRvciB8fCAiQEBpdGVyYXRvciI7CgogIHZhciBlcnJvcnMgPSB7CiAgICAwOiAiSWxsZWdhbCBzdGF0ZSIsCiAgICAxOiAiSW1tZXIgZHJhZnRzIGNhbm5vdCBoYXZlIGNvbXB1dGVkIHByb3BlcnRpZXMiLAogICAgMjogIlRoaXMgb2JqZWN0IGhhcyBiZWVuIGZyb3plbiBhbmQgc2hvdWxkIG5vdCBiZSBtdXRhdGVkIiwKICAgIDM6IGZ1bmN0aW9uIF8oZGF0YSkgewogICAgICByZXR1cm4gIkNhbm5vdCB1c2UgYSBwcm94eSB0aGF0IGhhcyBiZWVuIHJldm9rZWQuIERpZCB5b3UgcGFzcyBhbiBvYmplY3QgZnJvbSBpbnNpZGUgYW4gaW1tZXIgZnVuY3Rpb24gdG8gYW4gYXN5bmMgcHJvY2Vzcz8gIiArIGRhdGE7CiAgICB9LAogICAgNDogIkFuIGltbWVyIHByb2R1Y2VyIHJldHVybmVkIGEgbmV3IHZhbHVlICphbmQqIG1vZGlmaWVkIGl0cyBkcmFmdC4gRWl0aGVyIHJldHVybiBhIG5ldyB2YWx1ZSAqb3IqIG1vZGlmeSB0aGUgZHJhZnQuIiwKICAgIDU6ICJJbW1lciBmb3JiaWRzIGNpcmN1bGFyIHJlZmVyZW5jZXMiLAogICAgNjogIlRoZSBmaXJzdCBvciBzZWNvbmQgYXJndW1lbnQgdG8gYHByb2R1Y2VgIG11c3QgYmUgYSBmdW5jdGlvbiIsCiAgICA3OiAiVGhlIHRoaXJkIGFyZ3VtZW50IHRvIGBwcm9kdWNlYCBtdXN0IGJlIGEgZnVuY3Rpb24gb3IgdW5kZWZpbmVkIiwKICAgIDg6ICJGaXJzdCBhcmd1bWVudCB0byBgY3JlYXRlRHJhZnRgIG11c3QgYmUgYSBwbGFpbiBvYmplY3QsIGFuIGFycmF5LCBvciBhbiBpbW1lcmFibGUgb2JqZWN0IiwKICAgIDk6ICJGaXJzdCBhcmd1bWVudCB0byBgZmluaXNoRHJhZnRgIG11c3QgYmUgYSBkcmFmdCByZXR1cm5lZCBieSBgY3JlYXRlRHJhZnRgIiwKICAgIDEwOiAiVGhlIGdpdmVuIGRyYWZ0IGlzIGFscmVhZHkgZmluYWxpemVkIiwKICAgIDExOiAiT2JqZWN0LmRlZmluZVByb3BlcnR5KCkgY2Fubm90IGJlIHVzZWQgb24gYW4gSW1tZXIgZHJhZnQiLAogICAgMTI6ICJPYmplY3Quc2V0UHJvdG90eXBlT2YoKSBjYW5ub3QgYmUgdXNlZCBvbiBhbiBJbW1lciBkcmFmdCIsCiAgICAxMzogIkltbWVyIG9ubHkgc3VwcG9ydHMgZGVsZXRpbmcgYXJyYXkgaW5kaWNlcyIsCiAgICAxNDogIkltbWVyIG9ubHkgc3VwcG9ydHMgc2V0dGluZyBhcnJheSBpbmRpY2VzIGFuZCB0aGUgJ2xlbmd0aCcgcHJvcGVydHkiLAogICAgMTU6IGZ1bmN0aW9uIF8ocGF0aCkgewogICAgICByZXR1cm4gIkNhbm5vdCBhcHBseSBwYXRjaCwgcGF0aCBkb2Vzbid0IHJlc29sdmU6ICIgKyBwYXRoOwogICAgfSwKICAgIDE2OiAnU2V0cyBjYW5ub3QgaGF2ZSAicmVwbGFjZSIgcGF0Y2hlcy4nLAogICAgMTc6IGZ1bmN0aW9uIF8ob3ApIHsKICAgICAgcmV0dXJuICJVbnN1cHBvcnRlZCBwYXRjaCBvcGVyYXRpb246ICIgKyBvcDsKICAgIH0sCiAgICAxODogZnVuY3Rpb24gXyhwbHVnaW4pIHsKICAgICAgcmV0dXJuICJUaGUgcGx1Z2luIGZvciAnIiArIHBsdWdpbiArICInIGhhcyBub3QgYmVlbiBsb2FkZWQgaW50byBJbW1lci4gVG8gZW5hYmxlIHRoZSBwbHVnaW4sIGltcG9ydCBhbmQgY2FsbCBgZW5hYmxlIiArIHBsdWdpbiArICIoKWAgd2hlbiBpbml0aWFsaXppbmcgeW91ciBhcHBsaWNhdGlvbi4iOwogICAgfSwKICAgIDIwOiAiQ2Fubm90IHVzZSBwcm94aWVzIGlmIFByb3h5LCBQcm94eS5yZXZvY2FibGUgb3IgUmVmbGVjdCBhcmUgbm90IGF2YWlsYWJsZSIsCiAgICAyMTogZnVuY3Rpb24gXyh0aGluZykgewogICAgICByZXR1cm4gInByb2R1Y2UgY2FuIG9ubHkgYmUgY2FsbGVkIG9uIHRoaW5ncyB0aGF0IGFyZSBkcmFmdGFibGU6IHBsYWluIG9iamVjdHMsIGFycmF5cywgTWFwLCBTZXQgb3IgY2xhc3NlcyB0aGF0IGFyZSBtYXJrZWQgd2l0aCAnW2ltbWVyYWJsZV06IHRydWUnLiBHb3QgJyIgKyB0aGluZyArICInIjsKICAgIH0sCiAgICAyMjogZnVuY3Rpb24gXyh0aGluZykgewogICAgICByZXR1cm4gIidjdXJyZW50JyBleHBlY3RzIGEgZHJhZnQsIGdvdDogIiArIHRoaW5nOwogICAgfSwKICAgIDIzOiBmdW5jdGlvbiBfKHRoaW5nKSB7CiAgICAgIHJldHVybiAiJ29yaWdpbmFsJyBleHBlY3RzIGEgZHJhZnQsIGdvdDogIiArIHRoaW5nOwogICAgfSwKICAgIDI0OiAiUGF0Y2hpbmcgcmVzZXJ2ZWQgYXR0cmlidXRlcyBsaWtlIF9fcHJvdG9fXywgcHJvdG90eXBlIGFuZCBjb25zdHJ1Y3RvciBpcyBub3QgYWxsb3dlZCIKICB9OwogIGZ1bmN0aW9uIGRpZShlcnJvcikgewogICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbiA+IDEgPyBfbGVuIC0gMSA6IDApLCBfa2V5ID0gMTsgX2tleSA8IF9sZW47IF9rZXkrKykgewogICAgICBhcmdzW19rZXkgLSAxXSA9IGFyZ3VtZW50c1tfa2V5XTsKICAgIH0KCiAgICB7CiAgICAgIHZhciBlID0gZXJyb3JzW2Vycm9yXTsKICAgICAgdmFyIG1zZyA9ICFlID8gInVua25vd24gZXJyb3IgbnI6ICIgKyBlcnJvciA6IHR5cGVvZiBlID09PSAiZnVuY3Rpb24iID8gZS5hcHBseShudWxsLCBhcmdzKSA6IGU7CiAgICAgIHRocm93IG5ldyBFcnJvcigiW0ltbWVyXSAiICsgbXNnKTsKICAgIH0KICB9CgogIC8qKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIHZhbHVlIGlzIGFuIEltbWVyIGRyYWZ0ICovCgoKCiAgZnVuY3Rpb24gaXNEcmFmdCh2YWx1ZSkgewogICAgcmV0dXJuICEhdmFsdWUgJiYgISF2YWx1ZVtEUkFGVF9TVEFURV07CiAgfQogIC8qKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIHZhbHVlIGNhbiBiZSBkcmFmdGVkIGJ5IEltbWVyICovCgoKCiAgZnVuY3Rpb24gaXNEcmFmdGFibGUodmFsdWUpIHsKICAgIGlmICghdmFsdWUpIHJldHVybiBmYWxzZTsKICAgIHJldHVybiBpc1BsYWluT2JqZWN0JDEodmFsdWUpIHx8IEFycmF5LmlzQXJyYXkodmFsdWUpIHx8ICEhdmFsdWVbRFJBRlRBQkxFXSB8fCAhIXZhbHVlLmNvbnN0cnVjdG9yW0RSQUZUQUJMRV0gfHwgaXNNYXAodmFsdWUpIHx8IGlzU2V0KHZhbHVlKTsKICB9CiAgdmFyIG9iamVjdEN0b3JTdHJpbmcgPQogIC8qI19fUFVSRV9fKi8KICBPYmplY3QucHJvdG90eXBlLmNvbnN0cnVjdG9yLnRvU3RyaW5nKCk7CgoKICBmdW5jdGlvbiBpc1BsYWluT2JqZWN0JDEodmFsdWUpIHsKICAgIGlmICghdmFsdWUgfHwgdHlwZW9mIHZhbHVlICE9PSAib2JqZWN0IikgcmV0dXJuIGZhbHNlOwogICAgdmFyIHByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHZhbHVlKTsKCiAgICBpZiAocHJvdG8gPT09IG51bGwpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgdmFyIEN0b3IgPSBPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChwcm90bywgImNvbnN0cnVjdG9yIikgJiYgcHJvdG8uY29uc3RydWN0b3I7CiAgICBpZiAoQ3RvciA9PT0gT2JqZWN0KSByZXR1cm4gdHJ1ZTsKICAgIHJldHVybiB0eXBlb2YgQ3RvciA9PSAiZnVuY3Rpb24iICYmIEZ1bmN0aW9uLnRvU3RyaW5nLmNhbGwoQ3RvcikgPT09IG9iamVjdEN0b3JTdHJpbmc7CiAgfQogIGZ1bmN0aW9uIG9yaWdpbmFsKHZhbHVlKSB7CiAgICBpZiAoIWlzRHJhZnQodmFsdWUpKSBkaWUoMjMsIHZhbHVlKTsKICAgIHJldHVybiB2YWx1ZVtEUkFGVF9TVEFURV0uYmFzZV87CiAgfQoKCiAgdmFyIG93bktleXMkYSA9IHR5cGVvZiBSZWZsZWN0ICE9PSAidW5kZWZpbmVkIiAmJiBSZWZsZWN0Lm93bktleXMgPyBSZWZsZWN0Lm93bktleXMgOiB0eXBlb2YgT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyAhPT0gInVuZGVmaW5lZCIgPyBmdW5jdGlvbiAob2JqKSB7CiAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMob2JqKS5jb25jYXQoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmopKTsKICB9IDoKICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzOwogIHZhciBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMgfHwgZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyh0YXJnZXQpIHsKICAgIC8vIFBvbHlmaWxsIG5lZWRlZCBmb3IgSGVybWVzIGFuZCBJRSwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9oZXJtZXMvaXNzdWVzLzI3NAogICAgdmFyIHJlcyA9IHt9OwogICAgb3duS2V5cyRhKHRhcmdldCkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgIHJlc1trZXldID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSk7CiAgICB9KTsKICAgIHJldHVybiByZXM7CiAgfTsKICBmdW5jdGlvbiBlYWNoJDEob2JqLCBpdGVyLCBlbnVtZXJhYmxlT25seSkgewogICAgaWYgKGVudW1lcmFibGVPbmx5ID09PSB2b2lkIDApIHsKICAgICAgZW51bWVyYWJsZU9ubHkgPSBmYWxzZTsKICAgIH0KCiAgICBpZiAoZ2V0QXJjaHR5cGUob2JqKSA9PT0gMAogICAgLyogT2JqZWN0ICovCiAgICApIHsKICAgICAgICAoZW51bWVyYWJsZU9ubHkgPyBPYmplY3Qua2V5cyA6IG93bktleXMkYSkob2JqKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgIGlmICghZW51bWVyYWJsZU9ubHkgfHwgdHlwZW9mIGtleSAhPT0gInN5bWJvbCIpIGl0ZXIoa2V5LCBvYmpba2V5XSwgb2JqKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgb2JqLmZvckVhY2goZnVuY3Rpb24gKGVudHJ5LCBpbmRleCkgewogICAgICAgIHJldHVybiBpdGVyKGluZGV4LCBlbnRyeSwgb2JqKTsKICAgICAgfSk7CiAgICB9CiAgfQoKCiAgZnVuY3Rpb24gZ2V0QXJjaHR5cGUodGhpbmcpIHsKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICB2YXIgc3RhdGUgPSB0aGluZ1tEUkFGVF9TVEFURV07CiAgICByZXR1cm4gc3RhdGUgPyBzdGF0ZS50eXBlXyA+IDMgPyBzdGF0ZS50eXBlXyAtIDQgLy8gY2F1c2UgT2JqZWN0IGFuZCBBcnJheSBtYXAgYmFjayBmcm9tIDQgYW5kIDUKICAgIDogc3RhdGUudHlwZV8gLy8gb3RoZXJzIGFyZSB0aGUgc2FtZQogICAgOiBBcnJheS5pc0FycmF5KHRoaW5nKSA/IDEKICAgIC8qIEFycmF5ICovCiAgICA6IGlzTWFwKHRoaW5nKSA/IDIKICAgIC8qIE1hcCAqLwogICAgOiBpc1NldCh0aGluZykgPyAzCiAgICAvKiBTZXQgKi8KICAgIDogMAogICAgLyogT2JqZWN0ICovCiAgICA7CiAgfQoKCiAgZnVuY3Rpb24gaGFzKHRoaW5nLCBwcm9wKSB7CiAgICByZXR1cm4gZ2V0QXJjaHR5cGUodGhpbmcpID09PSAyCiAgICAvKiBNYXAgKi8KICAgID8gdGhpbmcuaGFzKHByb3ApIDogT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHRoaW5nLCBwcm9wKTsKICB9CgoKICBmdW5jdGlvbiBnZXQodGhpbmcsIHByb3ApIHsKICAgIC8vIEB0cy1pZ25vcmUKICAgIHJldHVybiBnZXRBcmNodHlwZSh0aGluZykgPT09IDIKICAgIC8qIE1hcCAqLwogICAgPyB0aGluZy5nZXQocHJvcCkgOiB0aGluZ1twcm9wXTsKICB9CgoKICBmdW5jdGlvbiBzZXQodGhpbmcsIHByb3BPck9sZFZhbHVlLCB2YWx1ZSkgewogICAgdmFyIHQgPSBnZXRBcmNodHlwZSh0aGluZyk7CiAgICBpZiAodCA9PT0gMgogICAgLyogTWFwICovCiAgICApIHRoaW5nLnNldChwcm9wT3JPbGRWYWx1ZSwgdmFsdWUpO2Vsc2UgaWYgKHQgPT09IDMKICAgIC8qIFNldCAqLwogICAgKSB7CiAgICAgICAgdGhpbmcuZGVsZXRlKHByb3BPck9sZFZhbHVlKTsKICAgICAgICB0aGluZy5hZGQodmFsdWUpOwogICAgICB9IGVsc2UgdGhpbmdbcHJvcE9yT2xkVmFsdWVdID0gdmFsdWU7CiAgfQoKCiAgZnVuY3Rpb24gaXMkMSh4LCB5KSB7CiAgICAvLyBGcm9tOiBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svZmJqcy9ibG9iL2M2OTkwNGE1MTFiOTAwMjY2OTM1MTY4MjIzMDYzZGQ4NzcyZGZjNDAvcGFja2FnZXMvZmJqcy9zcmMvY29yZS9zaGFsbG93RXF1YWwuanMKICAgIGlmICh4ID09PSB5KSB7CiAgICAgIHJldHVybiB4ICE9PSAwIHx8IDEgLyB4ID09PSAxIC8geTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiB4ICE9PSB4ICYmIHkgIT09IHk7CiAgICB9CiAgfQoKCiAgZnVuY3Rpb24gaXNNYXAodGFyZ2V0KSB7CiAgICByZXR1cm4gaGFzTWFwICYmIHRhcmdldCBpbnN0YW5jZW9mIE1hcDsKICB9CgoKICBmdW5jdGlvbiBpc1NldCh0YXJnZXQpIHsKICAgIHJldHVybiBoYXNTZXQgJiYgdGFyZ2V0IGluc3RhbmNlb2YgU2V0OwogIH0KCgogIGZ1bmN0aW9uIGxhdGVzdChzdGF0ZSkgewogICAgcmV0dXJuIHN0YXRlLmNvcHlfIHx8IHN0YXRlLmJhc2VfOwogIH0KCgogIGZ1bmN0aW9uIHNoYWxsb3dDb3B5KGJhc2UpIHsKICAgIGlmIChBcnJheS5pc0FycmF5KGJhc2UpKSByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYmFzZSk7CiAgICB2YXIgZGVzY3JpcHRvcnMgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKGJhc2UpOwogICAgZGVsZXRlIGRlc2NyaXB0b3JzW0RSQUZUX1NUQVRFXTsKICAgIHZhciBrZXlzID0gb3duS2V5cyRhKGRlc2NyaXB0b3JzKTsKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIGtleSA9IGtleXNbaV07CiAgICAgIHZhciBkZXNjID0gZGVzY3JpcHRvcnNba2V5XTsKCiAgICAgIGlmIChkZXNjLndyaXRhYmxlID09PSBmYWxzZSkgewogICAgICAgIGRlc2Mud3JpdGFibGUgPSB0cnVlOwogICAgICAgIGRlc2MuY29uZmlndXJhYmxlID0gdHJ1ZTsKICAgICAgfSAvLyBsaWtlIG9iamVjdC5hc3NpZ24sIHdlIHdpbGwgcmVhZCBhbnkgX293bl8sIGdldC9zZXQgYWNjZXNzb3JzLiBUaGlzIGhlbHBzIGluIGRlYWxpbmcKICAgICAgLy8gd2l0aCBsaWJyYXJpZXMgdGhhdCB0cmFwIHZhbHVlcywgbGlrZSBtb2J4IG9yIHZ1ZQogICAgICAvLyB1bmxpa2Ugb2JqZWN0LmFzc2lnbiwgbm9uLWVudW1lcmFibGVzIHdpbGwgYmUgY29waWVkIGFzIHdlbGwKCgogICAgICBpZiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpIGRlc2NyaXB0b3JzW2tleV0gPSB7CiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgIGVudW1lcmFibGU6IGRlc2MuZW51bWVyYWJsZSwKICAgICAgICB2YWx1ZTogYmFzZVtrZXldCiAgICAgIH07CiAgICB9CgogICAgcmV0dXJuIE9iamVjdC5jcmVhdGUoT2JqZWN0LmdldFByb3RvdHlwZU9mKGJhc2UpLCBkZXNjcmlwdG9ycyk7CiAgfQogIGZ1bmN0aW9uIGZyZWV6ZShvYmosIGRlZXApIHsKICAgIGlmIChkZWVwID09PSB2b2lkIDApIHsKICAgICAgZGVlcCA9IGZhbHNlOwogICAgfQoKICAgIGlmIChpc0Zyb3plbihvYmopIHx8IGlzRHJhZnQob2JqKSB8fCAhaXNEcmFmdGFibGUob2JqKSkgcmV0dXJuIG9iajsKCiAgICBpZiAoZ2V0QXJjaHR5cGUob2JqKSA+IDEKICAgIC8qIE1hcCBvciBTZXQgKi8KICAgICkgewogICAgICAgIG9iai5zZXQgPSBvYmouYWRkID0gb2JqLmNsZWFyID0gb2JqLmRlbGV0ZSA9IGRvbnRNdXRhdGVGcm96ZW5Db2xsZWN0aW9uczsKICAgICAgfQoKICAgIE9iamVjdC5mcmVlemUob2JqKTsKICAgIGlmIChkZWVwKSBlYWNoJDEob2JqLCBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkgewogICAgICByZXR1cm4gZnJlZXplKHZhbHVlLCB0cnVlKTsKICAgIH0sIHRydWUpOwogICAgcmV0dXJuIG9iajsKICB9CgogIGZ1bmN0aW9uIGRvbnRNdXRhdGVGcm96ZW5Db2xsZWN0aW9ucygpIHsKICAgIGRpZSgyKTsKICB9CgogIGZ1bmN0aW9uIGlzRnJvemVuKG9iaikgewogICAgaWYgKG9iaiA9PSBudWxsIHx8IHR5cGVvZiBvYmogIT09ICJvYmplY3QiKSByZXR1cm4gdHJ1ZTsgLy8gU2VlICM2MDAsIElFIGRpZXMgb24gbm9uLW9iamVjdHMgaW4gT2JqZWN0LmlzRnJvemVuCgogICAgcmV0dXJuIE9iamVjdC5pc0Zyb3plbihvYmopOwogIH0KCiAgLyoqIFBsdWdpbiB1dGlsaXRpZXMgKi8KCiAgdmFyIHBsdWdpbnMgPSB7fTsKICBmdW5jdGlvbiBnZXRQbHVnaW4ocGx1Z2luS2V5KSB7CiAgICB2YXIgcGx1Z2luID0gcGx1Z2luc1twbHVnaW5LZXldOwoKICAgIGlmICghcGx1Z2luKSB7CiAgICAgIGRpZSgxOCwgcGx1Z2luS2V5KTsKICAgIH0gLy8gQHRzLWlnbm9yZQoKCiAgICByZXR1cm4gcGx1Z2luOwogIH0KICBmdW5jdGlvbiBsb2FkUGx1Z2luKHBsdWdpbktleSwgaW1wbGVtZW50YXRpb24pIHsKICAgIGlmICghcGx1Z2luc1twbHVnaW5LZXldKSBwbHVnaW5zW3BsdWdpbktleV0gPSBpbXBsZW1lbnRhdGlvbjsKICB9CgogIHZhciBjdXJyZW50U2NvcGU7CiAgZnVuY3Rpb24gZ2V0Q3VycmVudFNjb3BlKCkgewogICAgaWYgKCAhY3VycmVudFNjb3BlKSBkaWUoMCk7CiAgICByZXR1cm4gY3VycmVudFNjb3BlOwogIH0KCiAgZnVuY3Rpb24gY3JlYXRlU2NvcGUocGFyZW50XywgaW1tZXJfKSB7CiAgICByZXR1cm4gewogICAgICBkcmFmdHNfOiBbXSwKICAgICAgcGFyZW50XzogcGFyZW50XywKICAgICAgaW1tZXJfOiBpbW1lcl8sCiAgICAgIC8vIFdoZW5ldmVyIHRoZSBtb2RpZmllZCBkcmFmdCBjb250YWlucyBhIGRyYWZ0IGZyb20gYW5vdGhlciBzY29wZSwgd2UKICAgICAgLy8gbmVlZCB0byBwcmV2ZW50IGF1dG8tZnJlZXppbmcgc28gdGhlIHVub3duZWQgZHJhZnQgY2FuIGJlIGZpbmFsaXplZC4KICAgICAgY2FuQXV0b0ZyZWV6ZV86IHRydWUsCiAgICAgIHVuZmluYWxpemVkRHJhZnRzXzogMAogICAgfTsKICB9CgogIGZ1bmN0aW9uIHVzZVBhdGNoZXNJblNjb3BlKHNjb3BlLCBwYXRjaExpc3RlbmVyKSB7CiAgICBpZiAocGF0Y2hMaXN0ZW5lcikgewogICAgICBnZXRQbHVnaW4oIlBhdGNoZXMiKTsgLy8gYXNzZXJ0IHdlIGhhdmUgdGhlIHBsdWdpbgoKICAgICAgc2NvcGUucGF0Y2hlc18gPSBbXTsKICAgICAgc2NvcGUuaW52ZXJzZVBhdGNoZXNfID0gW107CiAgICAgIHNjb3BlLnBhdGNoTGlzdGVuZXJfID0gcGF0Y2hMaXN0ZW5lcjsKICAgIH0KICB9CiAgZnVuY3Rpb24gcmV2b2tlU2NvcGUoc2NvcGUpIHsKICAgIGxlYXZlU2NvcGUoc2NvcGUpOwogICAgc2NvcGUuZHJhZnRzXy5mb3JFYWNoKHJldm9rZURyYWZ0KTsgLy8gQHRzLWlnbm9yZQoKICAgIHNjb3BlLmRyYWZ0c18gPSBudWxsOwogIH0KICBmdW5jdGlvbiBsZWF2ZVNjb3BlKHNjb3BlKSB7CiAgICBpZiAoc2NvcGUgPT09IGN1cnJlbnRTY29wZSkgewogICAgICBjdXJyZW50U2NvcGUgPSBzY29wZS5wYXJlbnRfOwogICAgfQogIH0KICBmdW5jdGlvbiBlbnRlclNjb3BlKGltbWVyKSB7CiAgICByZXR1cm4gY3VycmVudFNjb3BlID0gY3JlYXRlU2NvcGUoY3VycmVudFNjb3BlLCBpbW1lcik7CiAgfQoKICBmdW5jdGlvbiByZXZva2VEcmFmdChkcmFmdCkgewogICAgdmFyIHN0YXRlID0gZHJhZnRbRFJBRlRfU1RBVEVdOwogICAgaWYgKHN0YXRlLnR5cGVfID09PSAwCiAgICAvKiBQcm94eU9iamVjdCAqLwogICAgfHwgc3RhdGUudHlwZV8gPT09IDEKICAgIC8qIFByb3h5QXJyYXkgKi8KICAgICkgc3RhdGUucmV2b2tlXygpO2Vsc2Ugc3RhdGUucmV2b2tlZF8gPSB0cnVlOwogIH0KCiAgZnVuY3Rpb24gcHJvY2Vzc1Jlc3VsdChyZXN1bHQsIHNjb3BlKSB7CiAgICBzY29wZS51bmZpbmFsaXplZERyYWZ0c18gPSBzY29wZS5kcmFmdHNfLmxlbmd0aDsKICAgIHZhciBiYXNlRHJhZnQgPSBzY29wZS5kcmFmdHNfWzBdOwogICAgdmFyIGlzUmVwbGFjZWQgPSByZXN1bHQgIT09IHVuZGVmaW5lZCAmJiByZXN1bHQgIT09IGJhc2VEcmFmdDsKICAgIGlmICghc2NvcGUuaW1tZXJfLnVzZVByb3hpZXNfKSBnZXRQbHVnaW4oIkVTNSIpLndpbGxGaW5hbGl6ZUVTNV8oc2NvcGUsIHJlc3VsdCwgaXNSZXBsYWNlZCk7CgogICAgaWYgKGlzUmVwbGFjZWQpIHsKICAgICAgaWYgKGJhc2VEcmFmdFtEUkFGVF9TVEFURV0ubW9kaWZpZWRfKSB7CiAgICAgICAgcmV2b2tlU2NvcGUoc2NvcGUpOwogICAgICAgIGRpZSg0KTsKICAgICAgfQoKICAgICAgaWYgKGlzRHJhZnRhYmxlKHJlc3VsdCkpIHsKICAgICAgICAvLyBGaW5hbGl6ZSB0aGUgcmVzdWx0IGluIGNhc2UgaXQgY29udGFpbnMgKG9yIGlzKSBhIHN1YnNldCBvZiB0aGUgZHJhZnQuCiAgICAgICAgcmVzdWx0ID0gZmluYWxpemUoc2NvcGUsIHJlc3VsdCk7CiAgICAgICAgaWYgKCFzY29wZS5wYXJlbnRfKSBtYXliZUZyZWV6ZShzY29wZSwgcmVzdWx0KTsKICAgICAgfQoKICAgICAgaWYgKHNjb3BlLnBhdGNoZXNfKSB7CiAgICAgICAgZ2V0UGx1Z2luKCJQYXRjaGVzIikuZ2VuZXJhdGVSZXBsYWNlbWVudFBhdGNoZXNfKGJhc2VEcmFmdFtEUkFGVF9TVEFURV0sIHJlc3VsdCwgc2NvcGUucGF0Y2hlc18sIHNjb3BlLmludmVyc2VQYXRjaGVzXyk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIC8vIEZpbmFsaXplIHRoZSBiYXNlIGRyYWZ0LgogICAgICByZXN1bHQgPSBmaW5hbGl6ZShzY29wZSwgYmFzZURyYWZ0LCBbXSk7CiAgICB9CgogICAgcmV2b2tlU2NvcGUoc2NvcGUpOwoKICAgIGlmIChzY29wZS5wYXRjaGVzXykgewogICAgICBzY29wZS5wYXRjaExpc3RlbmVyXyhzY29wZS5wYXRjaGVzXywgc2NvcGUuaW52ZXJzZVBhdGNoZXNfKTsKICAgIH0KCiAgICByZXR1cm4gcmVzdWx0ICE9PSBOT1RISU5HID8gcmVzdWx0IDogdW5kZWZpbmVkOwogIH0KCiAgZnVuY3Rpb24gZmluYWxpemUocm9vdFNjb3BlLCB2YWx1ZSwgcGF0aCkgewogICAgLy8gRG9uJ3QgcmVjdXJzZSBpbiB0aG8gcmVjdXJzaXZlIGRhdGEgc3RydWN0dXJlcwogICAgaWYgKGlzRnJvemVuKHZhbHVlKSkgcmV0dXJuIHZhbHVlOwogICAgdmFyIHN0YXRlID0gdmFsdWVbRFJBRlRfU1RBVEVdOyAvLyBBIHBsYWluIG9iamVjdCwgbWlnaHQgbmVlZCBmcmVlemluZywgbWlnaHQgY29udGFpbiBkcmFmdHMKCiAgICBpZiAoIXN0YXRlKSB7CiAgICAgIGVhY2gkMSh2YWx1ZSwgZnVuY3Rpb24gKGtleSwgY2hpbGRWYWx1ZSkgewogICAgICAgIHJldHVybiBmaW5hbGl6ZVByb3BlcnR5KHJvb3RTY29wZSwgc3RhdGUsIHZhbHVlLCBrZXksIGNoaWxkVmFsdWUsIHBhdGgpOwogICAgICB9LCB0cnVlIC8vIFNlZSAjNTkwLCBkb24ndCByZWN1cnNlIGludG8gbm9uLWVudW1lcmFibGUgb2Ygbm9uIGRyYWZ0ZWQgb2JqZWN0cwogICAgICApOwogICAgICByZXR1cm4gdmFsdWU7CiAgICB9IC8vIE5ldmVyIGZpbmFsaXplIGRyYWZ0cyBvd25lZCBieSBhbm90aGVyIHNjb3BlLgoKCiAgICBpZiAoc3RhdGUuc2NvcGVfICE9PSByb290U2NvcGUpIHJldHVybiB2YWx1ZTsgLy8gVW5tb2RpZmllZCBkcmFmdCwgcmV0dXJuIHRoZSAoZnJvemVuKSBvcmlnaW5hbAoKICAgIGlmICghc3RhdGUubW9kaWZpZWRfKSB7CiAgICAgIG1heWJlRnJlZXplKHJvb3RTY29wZSwgc3RhdGUuYmFzZV8sIHRydWUpOwogICAgICByZXR1cm4gc3RhdGUuYmFzZV87CiAgICB9IC8vIE5vdCBmaW5hbGl6ZWQgeWV0LCBsZXQncyBkbyB0aGF0IG5vdwoKCiAgICBpZiAoIXN0YXRlLmZpbmFsaXplZF8pIHsKICAgICAgc3RhdGUuZmluYWxpemVkXyA9IHRydWU7CiAgICAgIHN0YXRlLnNjb3BlXy51bmZpbmFsaXplZERyYWZ0c18tLTsKICAgICAgdmFyIHJlc3VsdCA9IC8vIEZvciBFUzUsIGNyZWF0ZSBhIGdvb2QgY29weSBmcm9tIHRoZSBkcmFmdCBmaXJzdCwgd2l0aCBhZGRlZCBrZXlzIGFuZCB3aXRob3V0IGRlbGV0ZWQga2V5cy4KICAgICAgc3RhdGUudHlwZV8gPT09IDQKICAgICAgLyogRVM1T2JqZWN0ICovCiAgICAgIHx8IHN0YXRlLnR5cGVfID09PSA1CiAgICAgIC8qIEVTNUFycmF5ICovCiAgICAgID8gc3RhdGUuY29weV8gPSBzaGFsbG93Q29weShzdGF0ZS5kcmFmdF8pIDogc3RhdGUuY29weV87IC8vIEZpbmFsaXplIGFsbCBjaGlsZHJlbiBvZiB0aGUgY29weQogICAgICAvLyBGb3Igc2V0cyB3ZSBjbG9uZSBiZWZvcmUgaXRlcmF0aW5nLCBvdGhlcndpc2Ugd2UgY2FuIGdldCBpbiBlbmRsZXNzIGxvb3AgZHVlIHRvIG1vZGlmeWluZyBkdXJpbmcgaXRlcmF0aW9uLCBzZWUgIzYyOAogICAgICAvLyBBbHRob3VnaCB0aGUgb3JpZ2luYWwgdGVzdCBjYXNlIGRvZXNuJ3Qgc2VlbSB2YWxpZCBhbnl3YXksIHNvIGlmIHRoaXMgaW4gdGhlIHdheSB3ZSBjYW4gdHVybiB0aGUgbmV4dCBsaW5lCiAgICAgIC8vIGJhY2sgdG8gZWFjaChyZXN1bHQsIC4uLi4pCgogICAgICBlYWNoJDEoc3RhdGUudHlwZV8gPT09IDMKICAgICAgLyogU2V0ICovCiAgICAgID8gbmV3IFNldChyZXN1bHQpIDogcmVzdWx0LCBmdW5jdGlvbiAoa2V5LCBjaGlsZFZhbHVlKSB7CiAgICAgICAgcmV0dXJuIGZpbmFsaXplUHJvcGVydHkocm9vdFNjb3BlLCBzdGF0ZSwgcmVzdWx0LCBrZXksIGNoaWxkVmFsdWUsIHBhdGgpOwogICAgICB9KTsgLy8gZXZlcnl0aGluZyBpbnNpZGUgaXMgZnJvemVuLCB3ZSBjYW4gZnJlZXplIGhlcmUKCiAgICAgIG1heWJlRnJlZXplKHJvb3RTY29wZSwgcmVzdWx0LCBmYWxzZSk7IC8vIGZpcnN0IHRpbWUgZmluYWxpemluZywgbGV0J3MgY3JlYXRlIHRob3NlIHBhdGNoZXMKCiAgICAgIGlmIChwYXRoICYmIHJvb3RTY29wZS5wYXRjaGVzXykgewogICAgICAgIGdldFBsdWdpbigiUGF0Y2hlcyIpLmdlbmVyYXRlUGF0Y2hlc18oc3RhdGUsIHBhdGgsIHJvb3RTY29wZS5wYXRjaGVzXywgcm9vdFNjb3BlLmludmVyc2VQYXRjaGVzXyk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gc3RhdGUuY29weV87CiAgfQoKICBmdW5jdGlvbiBmaW5hbGl6ZVByb3BlcnR5KHJvb3RTY29wZSwgcGFyZW50U3RhdGUsIHRhcmdldE9iamVjdCwgcHJvcCwgY2hpbGRWYWx1ZSwgcm9vdFBhdGgpIHsKICAgIGlmICggY2hpbGRWYWx1ZSA9PT0gdGFyZ2V0T2JqZWN0KSBkaWUoNSk7CgogICAgaWYgKGlzRHJhZnQoY2hpbGRWYWx1ZSkpIHsKICAgICAgdmFyIHBhdGggPSByb290UGF0aCAmJiBwYXJlbnRTdGF0ZSAmJiBwYXJlbnRTdGF0ZS50eXBlXyAhPT0gMwogICAgICAvKiBTZXQgKi8KICAgICAgJiYgLy8gU2V0IG9iamVjdHMgYXJlIGF0b21pYyBzaW5jZSB0aGV5IGhhdmUgbm8ga2V5cy4KICAgICAgIWhhcyhwYXJlbnRTdGF0ZS5hc3NpZ25lZF8sIHByb3ApIC8vIFNraXAgZGVlcCBwYXRjaGVzIGZvciBhc3NpZ25lZCBrZXlzLgogICAgICA/IHJvb3RQYXRoLmNvbmNhdChwcm9wKSA6IHVuZGVmaW5lZDsgLy8gRHJhZnRzIG93bmVkIGJ5IGBzY29wZWAgYXJlIGZpbmFsaXplZCBoZXJlLgoKICAgICAgdmFyIHJlcyA9IGZpbmFsaXplKHJvb3RTY29wZSwgY2hpbGRWYWx1ZSwgcGF0aCk7CiAgICAgIHNldCh0YXJnZXRPYmplY3QsIHByb3AsIHJlcyk7IC8vIERyYWZ0cyBmcm9tIGFub3RoZXIgc2NvcGUgbXVzdCBwcmV2ZW50ZWQgdG8gYmUgZnJvemVuCiAgICAgIC8vIGlmIHdlIGdvdCBhIGRyYWZ0IGJhY2sgZnJvbSBmaW5hbGl6ZSwgd2UncmUgaW4gYSBuZXN0ZWQgcHJvZHVjZSBhbmQgc2hvdWxkbid0IGZyZWV6ZQoKICAgICAgaWYgKGlzRHJhZnQocmVzKSkgewogICAgICAgIHJvb3RTY29wZS5jYW5BdXRvRnJlZXplXyA9IGZhbHNlOwogICAgICB9IGVsc2UgcmV0dXJuOwogICAgfSAvLyBTZWFyY2ggbmV3IG9iamVjdHMgZm9yIHVuZmluYWxpemVkIGRyYWZ0cy4gRnJvemVuIG9iamVjdHMgc2hvdWxkIG5ldmVyIGNvbnRhaW4gZHJhZnRzLgoKCiAgICBpZiAoaXNEcmFmdGFibGUoY2hpbGRWYWx1ZSkgJiYgIWlzRnJvemVuKGNoaWxkVmFsdWUpKSB7CiAgICAgIGlmICghcm9vdFNjb3BlLmltbWVyXy5hdXRvRnJlZXplXyAmJiByb290U2NvcGUudW5maW5hbGl6ZWREcmFmdHNfIDwgMSkgewogICAgICAgIC8vIG9wdGltaXphdGlvbjogaWYgYW4gb2JqZWN0IGlzIG5vdCBhIGRyYWZ0LCBhbmQgd2UgZG9uJ3QgaGF2ZSB0bwogICAgICAgIC8vIGRlZXBmcmVlemUgZXZlcnl0aGluZywgYW5kIHdlIGFyZSBzdXJlIHRoYXQgbm8gZHJhZnRzIGFyZSBsZWZ0IGluIHRoZSByZW1haW5pbmcgb2JqZWN0CiAgICAgICAgLy8gY2F1c2Ugd2Ugc2F3IGFuZCBmaW5hbGl6ZWQgYWxsIGRyYWZ0cyBhbHJlYWR5OyB3ZSBjYW4gc3RvcCB2aXNpdGluZyB0aGUgcmVzdCBvZiB0aGUgdHJlZS4KICAgICAgICAvLyBUaGlzIGJlbmVmaXRzIGVzcGVjaWFsbHkgYWRkaW5nIGxhcmdlIGRhdGEgdHJlZSdzIHdpdGhvdXQgZnVydGhlciBwcm9jZXNzaW5nLgogICAgICAgIC8vIFNlZSBhZGQtZGF0YS5qcyBwZXJmIHRlc3QKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGZpbmFsaXplKHJvb3RTY29wZSwgY2hpbGRWYWx1ZSk7IC8vIGltbWVyIGRlZXAgZnJlZXplcyBwbGFpbiBvYmplY3RzLCBzbyBpZiB0aGVyZSBpcyBubyBwYXJlbnQgc3RhdGUsIHdlIGZyZWV6ZSBhcyB3ZWxsCgogICAgICBpZiAoIXBhcmVudFN0YXRlIHx8ICFwYXJlbnRTdGF0ZS5zY29wZV8ucGFyZW50XykgbWF5YmVGcmVlemUocm9vdFNjb3BlLCBjaGlsZFZhbHVlKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIG1heWJlRnJlZXplKHNjb3BlLCB2YWx1ZSwgZGVlcCkgewogICAgaWYgKGRlZXAgPT09IHZvaWQgMCkgewogICAgICBkZWVwID0gZmFsc2U7CiAgICB9CgogICAgaWYgKHNjb3BlLmltbWVyXy5hdXRvRnJlZXplXyAmJiBzY29wZS5jYW5BdXRvRnJlZXplXykgewogICAgICBmcmVlemUodmFsdWUsIGRlZXApOwogICAgfQogIH0KCiAgLyoqCiAgICogUmV0dXJucyBhIG5ldyBkcmFmdCBvZiB0aGUgYGJhc2VgIG9iamVjdC4KICAgKgogICAqIFRoZSBzZWNvbmQgYXJndW1lbnQgaXMgdGhlIHBhcmVudCBkcmFmdC1zdGF0ZSAodXNlZCBpbnRlcm5hbGx5KS4KICAgKi8KCiAgZnVuY3Rpb24gY3JlYXRlUHJveHlQcm94eShiYXNlLCBwYXJlbnQpIHsKICAgIHZhciBpc0FycmF5ID0gQXJyYXkuaXNBcnJheShiYXNlKTsKICAgIHZhciBzdGF0ZSA9IHsKICAgICAgdHlwZV86IGlzQXJyYXkgPyAxCiAgICAgIC8qIFByb3h5QXJyYXkgKi8KICAgICAgOiAwCiAgICAgIC8qIFByb3h5T2JqZWN0ICovCiAgICAgICwKICAgICAgLy8gVHJhY2sgd2hpY2ggcHJvZHVjZSBjYWxsIHRoaXMgaXMgYXNzb2NpYXRlZCB3aXRoLgogICAgICBzY29wZV86IHBhcmVudCA/IHBhcmVudC5zY29wZV8gOiBnZXRDdXJyZW50U2NvcGUoKSwKICAgICAgLy8gVHJ1ZSBmb3IgYm90aCBzaGFsbG93IGFuZCBkZWVwIGNoYW5nZXMuCiAgICAgIG1vZGlmaWVkXzogZmFsc2UsCiAgICAgIC8vIFVzZWQgZHVyaW5nIGZpbmFsaXphdGlvbi4KICAgICAgZmluYWxpemVkXzogZmFsc2UsCiAgICAgIC8vIFRyYWNrIHdoaWNoIHByb3BlcnRpZXMgaGF2ZSBiZWVuIGFzc2lnbmVkICh0cnVlKSBvciBkZWxldGVkIChmYWxzZSkuCiAgICAgIGFzc2lnbmVkXzoge30sCiAgICAgIC8vIFRoZSBwYXJlbnQgZHJhZnQgc3RhdGUuCiAgICAgIHBhcmVudF86IHBhcmVudCwKICAgICAgLy8gVGhlIGJhc2Ugc3RhdGUuCiAgICAgIGJhc2VfOiBiYXNlLAogICAgICAvLyBUaGUgYmFzZSBwcm94eS4KICAgICAgZHJhZnRfOiBudWxsLAogICAgICAvLyBUaGUgYmFzZSBjb3B5IHdpdGggYW55IHVwZGF0ZWQgdmFsdWVzLgogICAgICBjb3B5XzogbnVsbCwKICAgICAgLy8gQ2FsbGVkIGJ5IHRoZSBgcHJvZHVjZWAgZnVuY3Rpb24uCiAgICAgIHJldm9rZV86IG51bGwsCiAgICAgIGlzTWFudWFsXzogZmFsc2UKICAgIH07IC8vIHRoZSB0cmFwcyBtdXN0IHRhcmdldCBzb21ldGhpbmcsIGEgYml0IGxpa2UgdGhlICdyZWFsJyBiYXNlLgogICAgLy8gYnV0IGFsc28sIHdlIG5lZWQgdG8gYmUgYWJsZSB0byBkZXRlcm1pbmUgZnJvbSB0aGUgdGFyZ2V0IHdoYXQgdGhlIHJlbGV2YW50IHN0YXRlIGlzCiAgICAvLyAodG8gYXZvaWQgY3JlYXRpbmcgdHJhcHMgcGVyIGluc3RhbmNlIHRvIGNhcHR1cmUgdGhlIHN0YXRlIGluIGNsb3N1cmUsCiAgICAvLyBhbmQgdG8gYXZvaWQgY3JlYXRpbmcgd2VpcmQgaGlkZGVuIHByb3BlcnRpZXMgYXMgd2VsbCkKICAgIC8vIFNvIHRoZSB0cmljayBpcyB0byB1c2UgJ3N0YXRlJyBhcyB0aGUgYWN0dWFsICd0YXJnZXQnISAoYW5kIG1ha2Ugc3VyZSB3ZSBpbnRlcmNlcHQgZXZlcnl0aGluZykKICAgIC8vIE5vdGUgdGhhdCBpbiB0aGUgY2FzZSBvZiBhbiBhcnJheSwgd2UgcHV0IHRoZSBzdGF0ZSBpbiBhbiBhcnJheSB0byBoYXZlIGJldHRlciBSZWZsZWN0IGRlZmF1bHRzIG9vdGIKCiAgICB2YXIgdGFyZ2V0ID0gc3RhdGU7CiAgICB2YXIgdHJhcHMgPSBvYmplY3RUcmFwczsKCiAgICBpZiAoaXNBcnJheSkgewogICAgICB0YXJnZXQgPSBbc3RhdGVdOwogICAgICB0cmFwcyA9IGFycmF5VHJhcHM7CiAgICB9CgogICAgdmFyIF9Qcm94eSRyZXZvY2FibGUgPSBQcm94eS5yZXZvY2FibGUodGFyZ2V0LCB0cmFwcyksCiAgICAgICAgcmV2b2tlID0gX1Byb3h5JHJldm9jYWJsZS5yZXZva2UsCiAgICAgICAgcHJveHkgPSBfUHJveHkkcmV2b2NhYmxlLnByb3h5OwoKICAgIHN0YXRlLmRyYWZ0XyA9IHByb3h5OwogICAgc3RhdGUucmV2b2tlXyA9IHJldm9rZTsKICAgIHJldHVybiBwcm94eTsKICB9CiAgLyoqCiAgICogT2JqZWN0IGRyYWZ0cwogICAqLwoKICB2YXIgb2JqZWN0VHJhcHMgPSB7CiAgICBnZXQ6IGZ1bmN0aW9uIGdldChzdGF0ZSwgcHJvcCkgewogICAgICBpZiAocHJvcCA9PT0gRFJBRlRfU1RBVEUpIHJldHVybiBzdGF0ZTsKICAgICAgdmFyIHNvdXJjZSA9IGxhdGVzdChzdGF0ZSk7CgogICAgICBpZiAoIWhhcyhzb3VyY2UsIHByb3ApKSB7CiAgICAgICAgLy8gbm9uLWV4aXN0aW5nIG9yIG5vbi1vd24gcHJvcGVydHkuLi4KICAgICAgICByZXR1cm4gcmVhZFByb3BGcm9tUHJvdG8oc3RhdGUsIHNvdXJjZSwgcHJvcCk7CiAgICAgIH0KCiAgICAgIHZhciB2YWx1ZSA9IHNvdXJjZVtwcm9wXTsKCiAgICAgIGlmIChzdGF0ZS5maW5hbGl6ZWRfIHx8ICFpc0RyYWZ0YWJsZSh2YWx1ZSkpIHsKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgIH0gLy8gQ2hlY2sgZm9yIGV4aXN0aW5nIGRyYWZ0IGluIG1vZGlmaWVkIHN0YXRlLgogICAgICAvLyBBc3NpZ25lZCB2YWx1ZXMgYXJlIG5ldmVyIGRyYWZ0ZWQuIFRoaXMgY2F0Y2hlcyBhbnkgZHJhZnRzIHdlIGNyZWF0ZWQsIHRvby4KCgogICAgICBpZiAodmFsdWUgPT09IHBlZWsoc3RhdGUuYmFzZV8sIHByb3ApKSB7CiAgICAgICAgcHJlcGFyZUNvcHkoc3RhdGUpOwogICAgICAgIHJldHVybiBzdGF0ZS5jb3B5X1twcm9wXSA9IGNyZWF0ZVByb3h5KHN0YXRlLnNjb3BlXy5pbW1lcl8sIHZhbHVlLCBzdGF0ZSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0sCiAgICBoYXM6IGZ1bmN0aW9uIGhhcyhzdGF0ZSwgcHJvcCkgewogICAgICByZXR1cm4gcHJvcCBpbiBsYXRlc3Qoc3RhdGUpOwogICAgfSwKICAgIG93bktleXM6IGZ1bmN0aW9uIG93bktleXMoc3RhdGUpIHsKICAgICAgcmV0dXJuIFJlZmxlY3Qub3duS2V5cyhsYXRlc3Qoc3RhdGUpKTsKICAgIH0sCiAgICBzZXQ6IGZ1bmN0aW9uIHNldChzdGF0ZSwgcHJvcAogICAgLyogc3RyaWN0bHkgbm90LCBidXQgaGVscHMgVFMgKi8KICAgICwgdmFsdWUpIHsKICAgICAgdmFyIGRlc2MgPSBnZXREZXNjcmlwdG9yRnJvbVByb3RvKGxhdGVzdChzdGF0ZSksIHByb3ApOwoKICAgICAgaWYgKGRlc2MgPT09IG51bGwgfHwgZGVzYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGVzYy5zZXQpIHsKICAgICAgICAvLyBzcGVjaWFsIGNhc2U6IGlmIHRoaXMgd3JpdGUgaXMgY2FwdHVyZWQgYnkgYSBzZXR0ZXIsIHdlIGhhdmUKICAgICAgICAvLyB0byB0cmlnZ2VyIGl0IHdpdGggdGhlIGNvcnJlY3QgY29udGV4dAogICAgICAgIGRlc2Muc2V0LmNhbGwoc3RhdGUuZHJhZnRfLCB2YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIGlmICghc3RhdGUubW9kaWZpZWRfKSB7CiAgICAgICAgLy8gdGhlIGxhc3QgY2hlY2sgaXMgYmVjYXVzZSB3ZSBuZWVkIHRvIGJlIGFibGUgdG8gZGlzdGluZ3Vpc2ggc2V0dGluZyBhIG5vbi1leGlzdGluZyB0byB1bmRlZmluZWQgKHdoaWNoIGlzIGEgY2hhbmdlKQogICAgICAgIC8vIGZyb20gc2V0dGluZyBhbiBleGlzdGluZyBwcm9wZXJ0eSB3aXRoIHZhbHVlIHVuZGVmaW5lZCB0byB1bmRlZmluZWQgKHdoaWNoIGlzIG5vdCBhIGNoYW5nZSkKICAgICAgICB2YXIgY3VycmVudCA9IHBlZWsobGF0ZXN0KHN0YXRlKSwgcHJvcCk7IC8vIHNwZWNpYWwgY2FzZSwgaWYgd2UgYXNzaWduaW5nIHRoZSBvcmlnaW5hbCB2YWx1ZSB0byBhIGRyYWZ0LCB3ZSBjYW4gaWdub3JlIHRoZSBhc3NpZ25tZW50CgogICAgICAgIHZhciBjdXJyZW50U3RhdGUgPSBjdXJyZW50ID09PSBudWxsIHx8IGN1cnJlbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGN1cnJlbnRbRFJBRlRfU1RBVEVdOwoKICAgICAgICBpZiAoY3VycmVudFN0YXRlICYmIGN1cnJlbnRTdGF0ZS5iYXNlXyA9PT0gdmFsdWUpIHsKICAgICAgICAgIHN0YXRlLmNvcHlfW3Byb3BdID0gdmFsdWU7CiAgICAgICAgICBzdGF0ZS5hc3NpZ25lZF9bcHJvcF0gPSBmYWxzZTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzJDEodmFsdWUsIGN1cnJlbnQpICYmICh2YWx1ZSAhPT0gdW5kZWZpbmVkIHx8IGhhcyhzdGF0ZS5iYXNlXywgcHJvcCkpKSByZXR1cm4gdHJ1ZTsKICAgICAgICBwcmVwYXJlQ29weShzdGF0ZSk7CiAgICAgICAgbWFya0NoYW5nZWQoc3RhdGUpOwogICAgICB9CgogICAgICBpZiAoc3RhdGUuY29weV9bcHJvcF0gPT09IHZhbHVlICYmIC8vIHNwZWNpYWwgY2FzZTogTmFOCiAgICAgIHR5cGVvZiB2YWx1ZSAhPT0gIm51bWJlciIgJiYgKCAvLyBzcGVjaWFsIGNhc2U6IGhhbmRsZSBuZXcgcHJvcHMgd2l0aCB2YWx1ZSAndW5kZWZpbmVkJwogICAgICB2YWx1ZSAhPT0gdW5kZWZpbmVkIHx8IHByb3AgaW4gc3RhdGUuY29weV8pKSByZXR1cm4gdHJ1ZTsgLy8gQHRzLWlnbm9yZQoKICAgICAgc3RhdGUuY29weV9bcHJvcF0gPSB2YWx1ZTsKICAgICAgc3RhdGUuYXNzaWduZWRfW3Byb3BdID0gdHJ1ZTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9LAogICAgZGVsZXRlUHJvcGVydHk6IGZ1bmN0aW9uIGRlbGV0ZVByb3BlcnR5KHN0YXRlLCBwcm9wKSB7CiAgICAgIC8vIFRoZSBgdW5kZWZpbmVkYCBjaGVjayBpcyBhIGZhc3QgcGF0aCBmb3IgcHJlLWV4aXN0aW5nIGtleXMuCiAgICAgIGlmIChwZWVrKHN0YXRlLmJhc2VfLCBwcm9wKSAhPT0gdW5kZWZpbmVkIHx8IHByb3AgaW4gc3RhdGUuYmFzZV8pIHsKICAgICAgICBzdGF0ZS5hc3NpZ25lZF9bcHJvcF0gPSBmYWxzZTsKICAgICAgICBwcmVwYXJlQ29weShzdGF0ZSk7CiAgICAgICAgbWFya0NoYW5nZWQoc3RhdGUpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIGlmIGFuIG9yaWdpbmFsbHkgbm90IGFzc2lnbmVkIHByb3BlcnR5IHdhcyBkZWxldGVkCiAgICAgICAgZGVsZXRlIHN0YXRlLmFzc2lnbmVkX1twcm9wXTsKICAgICAgfSAvLyBAdHMtaWdub3JlCgoKICAgICAgaWYgKHN0YXRlLmNvcHlfKSBkZWxldGUgc3RhdGUuY29weV9bcHJvcF07CiAgICAgIHJldHVybiB0cnVlOwogICAgfSwKICAgIC8vIE5vdGU6IFdlIG5ldmVyIGNvZXJjZSBgZGVzYy52YWx1ZWAgaW50byBhbiBJbW1lciBkcmFmdCwgYmVjYXVzZSB3ZSBjYW4ndCBtYWtlCiAgICAvLyB0aGUgc2FtZSBndWFyYW50ZWUgaW4gRVM1IG1vZGUuCiAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I6IGZ1bmN0aW9uIGdldE93blByb3BlcnR5RGVzY3JpcHRvcihzdGF0ZSwgcHJvcCkgewogICAgICB2YXIgb3duZXIgPSBsYXRlc3Qoc3RhdGUpOwogICAgICB2YXIgZGVzYyA9IFJlZmxlY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG93bmVyLCBwcm9wKTsKICAgICAgaWYgKCFkZXNjKSByZXR1cm4gZGVzYzsKICAgICAgcmV0dXJuIHsKICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IHN0YXRlLnR5cGVfICE9PSAxCiAgICAgICAgLyogUHJveHlBcnJheSAqLwogICAgICAgIHx8IHByb3AgIT09ICJsZW5ndGgiLAogICAgICAgIGVudW1lcmFibGU6IGRlc2MuZW51bWVyYWJsZSwKICAgICAgICB2YWx1ZTogb3duZXJbcHJvcF0KICAgICAgfTsKICAgIH0sCiAgICBkZWZpbmVQcm9wZXJ0eTogZnVuY3Rpb24gZGVmaW5lUHJvcGVydHkoKSB7CiAgICAgIGRpZSgxMSk7CiAgICB9LAogICAgZ2V0UHJvdG90eXBlT2Y6IGZ1bmN0aW9uIGdldFByb3RvdHlwZU9mKHN0YXRlKSB7CiAgICAgIHJldHVybiBPYmplY3QuZ2V0UHJvdG90eXBlT2Yoc3RhdGUuYmFzZV8pOwogICAgfSwKICAgIHNldFByb3RvdHlwZU9mOiBmdW5jdGlvbiBzZXRQcm90b3R5cGVPZigpIHsKICAgICAgZGllKDEyKTsKICAgIH0KICB9OwogIC8qKgogICAqIEFycmF5IGRyYWZ0cwogICAqLwoKICB2YXIgYXJyYXlUcmFwcyA9IHt9OwogIGVhY2gkMShvYmplY3RUcmFwcywgZnVuY3Rpb24gKGtleSwgZm4pIHsKICAgIC8vIEB0cy1pZ25vcmUKICAgIGFycmF5VHJhcHNba2V5XSA9IGZ1bmN0aW9uICgpIHsKICAgICAgYXJndW1lbnRzWzBdID0gYXJndW1lbnRzWzBdWzBdOwogICAgICByZXR1cm4gZm4uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07CiAgfSk7CgogIGFycmF5VHJhcHMuZGVsZXRlUHJvcGVydHkgPSBmdW5jdGlvbiAoc3RhdGUsIHByb3ApIHsKICAgIGlmICggaXNOYU4ocGFyc2VJbnQocHJvcCkpKSBkaWUoMTMpOwogICAgcmV0dXJuIG9iamVjdFRyYXBzLmRlbGV0ZVByb3BlcnR5LmNhbGwodGhpcywgc3RhdGVbMF0sIHByb3ApOwogIH07CgogIGFycmF5VHJhcHMuc2V0ID0gZnVuY3Rpb24gKHN0YXRlLCBwcm9wLCB2YWx1ZSkgewogICAgaWYgKCBwcm9wICE9PSAibGVuZ3RoIiAmJiBpc05hTihwYXJzZUludChwcm9wKSkpIGRpZSgxNCk7CiAgICByZXR1cm4gb2JqZWN0VHJhcHMuc2V0LmNhbGwodGhpcywgc3RhdGVbMF0sIHByb3AsIHZhbHVlLCBzdGF0ZVswXSk7CiAgfTsgLy8gQWNjZXNzIGEgcHJvcGVydHkgd2l0aG91dCBjcmVhdGluZyBhbiBJbW1lciBkcmFmdC4KCgogIGZ1bmN0aW9uIHBlZWsoZHJhZnQsIHByb3ApIHsKICAgIHZhciBzdGF0ZSA9IGRyYWZ0W0RSQUZUX1NUQVRFXTsKICAgIHZhciBzb3VyY2UgPSBzdGF0ZSA/IGxhdGVzdChzdGF0ZSkgOiBkcmFmdDsKICAgIHJldHVybiBzb3VyY2VbcHJvcF07CiAgfQoKICBmdW5jdGlvbiByZWFkUHJvcEZyb21Qcm90byhzdGF0ZSwgc291cmNlLCBwcm9wKSB7CiAgICB2YXIgX2Rlc2MkZ2V0OwoKICAgIHZhciBkZXNjID0gZ2V0RGVzY3JpcHRvckZyb21Qcm90byhzb3VyY2UsIHByb3ApOwogICAgcmV0dXJuIGRlc2MgPyAidmFsdWUiIGluIGRlc2MgPyBkZXNjLnZhbHVlIDogLy8gVGhpcyBpcyBhIHZlcnkgc3BlY2lhbCBjYXNlLCBpZiB0aGUgcHJvcCBpcyBhIGdldHRlciBkZWZpbmVkIGJ5IHRoZQogICAgLy8gcHJvdG90eXBlLCB3ZSBzaG91bGQgaW52b2tlIGl0IHdpdGggdGhlIGRyYWZ0IGFzIGNvbnRleHQhCiAgICAoX2Rlc2MkZ2V0ID0gZGVzYy5nZXQpID09PSBudWxsIHx8IF9kZXNjJGdldCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Rlc2MkZ2V0LmNhbGwoc3RhdGUuZHJhZnRfKSA6IHVuZGVmaW5lZDsKICB9CgogIGZ1bmN0aW9uIGdldERlc2NyaXB0b3JGcm9tUHJvdG8oc291cmNlLCBwcm9wKSB7CiAgICAvLyAnaW4nIGNoZWNrcyBwcm90byEKICAgIGlmICghKHByb3AgaW4gc291cmNlKSkgcmV0dXJuIHVuZGVmaW5lZDsKICAgIHZhciBwcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihzb3VyY2UpOwoKICAgIHdoaWxlIChwcm90bykgewogICAgICB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IocHJvdG8sIHByb3ApOwogICAgICBpZiAoZGVzYykgcmV0dXJuIGRlc2M7CiAgICAgIHByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHByb3RvKTsKICAgIH0KCiAgICByZXR1cm4gdW5kZWZpbmVkOwogIH0KCiAgZnVuY3Rpb24gbWFya0NoYW5nZWQoc3RhdGUpIHsKICAgIGlmICghc3RhdGUubW9kaWZpZWRfKSB7CiAgICAgIHN0YXRlLm1vZGlmaWVkXyA9IHRydWU7CgogICAgICBpZiAoc3RhdGUucGFyZW50XykgewogICAgICAgIG1hcmtDaGFuZ2VkKHN0YXRlLnBhcmVudF8pOwogICAgICB9CiAgICB9CiAgfQogIGZ1bmN0aW9uIHByZXBhcmVDb3B5KHN0YXRlKSB7CiAgICBpZiAoIXN0YXRlLmNvcHlfKSB7CiAgICAgIHN0YXRlLmNvcHlfID0gc2hhbGxvd0NvcHkoc3RhdGUuYmFzZV8pOwogICAgfQogIH0KCiAgdmFyIEltbWVyID0KICAvKiNfX1BVUkVfXyovCiAgZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gSW1tZXIoY29uZmlnKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB0aGlzLnVzZVByb3hpZXNfID0gaGFzUHJveGllczsKICAgICAgdGhpcy5hdXRvRnJlZXplXyA9IHRydWU7CiAgICAgIC8qKgogICAgICAgKiBUaGUgYHByb2R1Y2VgIGZ1bmN0aW9uIHRha2VzIGEgdmFsdWUgYW5kIGEgInJlY2lwZSBmdW5jdGlvbiIgKHdob3NlCiAgICAgICAqIHJldHVybiB2YWx1ZSBvZnRlbiBkZXBlbmRzIG9uIHRoZSBiYXNlIHN0YXRlKS4gVGhlIHJlY2lwZSBmdW5jdGlvbiBpcwogICAgICAgKiBmcmVlIHRvIG11dGF0ZSBpdHMgZmlyc3QgYXJndW1lbnQgaG93ZXZlciBpdCB3YW50cy4gQWxsIG11dGF0aW9ucyBhcmUKICAgICAgICogb25seSBldmVyIGFwcGxpZWQgdG8gYSBfX2NvcHlfXyBvZiB0aGUgYmFzZSBzdGF0ZS4KICAgICAgICoKICAgICAgICogUGFzcyBvbmx5IGEgZnVuY3Rpb24gdG8gY3JlYXRlIGEgImN1cnJpZWQgcHJvZHVjZXIiIHdoaWNoIHJlbGlldmVzIHlvdQogICAgICAgKiBmcm9tIHBhc3NpbmcgdGhlIHJlY2lwZSBmdW5jdGlvbiBldmVyeSB0aW1lLgogICAgICAgKgogICAgICAgKiBPbmx5IHBsYWluIG9iamVjdHMgYW5kIGFycmF5cyBhcmUgbWFkZSBtdXRhYmxlLiBBbGwgb3RoZXIgb2JqZWN0cyBhcmUKICAgICAgICogY29uc2lkZXJlZCB1bmNvcHlhYmxlLgogICAgICAgKgogICAgICAgKiBOb3RlOiBUaGlzIGZ1bmN0aW9uIGlzIF9fYm91bmRfXyB0byBpdHMgYEltbWVyYCBpbnN0YW5jZS4KICAgICAgICoKICAgICAgICogQHBhcmFtIHthbnl9IGJhc2UgLSB0aGUgaW5pdGlhbCBzdGF0ZQogICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBwcm9kdWNlciAtIGZ1bmN0aW9uIHRoYXQgcmVjZWl2ZXMgYSBwcm94eSBvZiB0aGUgYmFzZSBzdGF0ZSBhcyBmaXJzdCBhcmd1bWVudCBhbmQgd2hpY2ggY2FuIGJlIGZyZWVseSBtb2RpZmllZAogICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBwYXRjaExpc3RlbmVyIC0gb3B0aW9uYWwgZnVuY3Rpb24gdGhhdCB3aWxsIGJlIGNhbGxlZCB3aXRoIGFsbCB0aGUgcGF0Y2hlcyBwcm9kdWNlZCBoZXJlCiAgICAgICAqIEByZXR1cm5zIHthbnl9IGEgbmV3IHN0YXRlLCBvciB0aGUgaW5pdGlhbCBzdGF0ZSBpZiBub3RoaW5nIHdhcyBtb2RpZmllZAogICAgICAgKi8KCiAgICAgIHRoaXMucHJvZHVjZSA9IGZ1bmN0aW9uIChiYXNlLCByZWNpcGUsIHBhdGNoTGlzdGVuZXIpIHsKICAgICAgICAvLyBjdXJyaWVkIGludm9jYXRpb24KICAgICAgICBpZiAodHlwZW9mIGJhc2UgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIHJlY2lwZSAhPT0gImZ1bmN0aW9uIikgewogICAgICAgICAgdmFyIGRlZmF1bHRCYXNlID0gcmVjaXBlOwogICAgICAgICAgcmVjaXBlID0gYmFzZTsKICAgICAgICAgIHZhciBzZWxmID0gX3RoaXM7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gY3VycmllZFByb2R1Y2UoYmFzZSkgewogICAgICAgICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgICAgICAgIGlmIChiYXNlID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBiYXNlID0gZGVmYXVsdEJhc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4gPiAxID8gX2xlbiAtIDEgOiAwKSwgX2tleSA9IDE7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsKICAgICAgICAgICAgICBhcmdzW19rZXkgLSAxXSA9IGFyZ3VtZW50c1tfa2V5XTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHNlbGYucHJvZHVjZShiYXNlLCBmdW5jdGlvbiAoZHJhZnQpIHsKICAgICAgICAgICAgICB2YXIgX3JlY2lwZTsKCiAgICAgICAgICAgICAgcmV0dXJuIChfcmVjaXBlID0gcmVjaXBlKS5jYWxsLmFwcGx5KF9yZWNpcGUsIFtfdGhpczIsIGRyYWZ0XS5jb25jYXQoYXJncykpOwogICAgICAgICAgICB9KTsgLy8gcHJldHRpZXItaWdub3JlCiAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgaWYgKHR5cGVvZiByZWNpcGUgIT09ICJmdW5jdGlvbiIpIGRpZSg2KTsKICAgICAgICBpZiAocGF0Y2hMaXN0ZW5lciAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBwYXRjaExpc3RlbmVyICE9PSAiZnVuY3Rpb24iKSBkaWUoNyk7CiAgICAgICAgdmFyIHJlc3VsdDsgLy8gT25seSBwbGFpbiBvYmplY3RzLCBhcnJheXMsIGFuZCAiaW1tZXJhYmxlIGNsYXNzZXMiIGFyZSBkcmFmdGVkLgoKICAgICAgICBpZiAoaXNEcmFmdGFibGUoYmFzZSkpIHsKICAgICAgICAgIHZhciBzY29wZSA9IGVudGVyU2NvcGUoX3RoaXMpOwogICAgICAgICAgdmFyIHByb3h5ID0gY3JlYXRlUHJveHkoX3RoaXMsIGJhc2UsIHVuZGVmaW5lZCk7CiAgICAgICAgICB2YXIgaGFzRXJyb3IgPSB0cnVlOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJlc3VsdCA9IHJlY2lwZShwcm94eSk7CiAgICAgICAgICAgIGhhc0Vycm9yID0gZmFsc2U7CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAvLyBmaW5hbGx5IGluc3RlYWQgb2YgY2F0Y2ggKyByZXRocm93IGJldHRlciBwcmVzZXJ2ZXMgb3JpZ2luYWwgc3RhY2sKICAgICAgICAgICAgaWYgKGhhc0Vycm9yKSByZXZva2VTY29wZShzY29wZSk7ZWxzZSBsZWF2ZVNjb3BlKHNjb3BlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodHlwZW9mIFByb21pc2UgIT09ICJ1bmRlZmluZWQiICYmIHJlc3VsdCBpbnN0YW5jZW9mIFByb21pc2UpIHsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICB1c2VQYXRjaGVzSW5TY29wZShzY29wZSwgcGF0Y2hMaXN0ZW5lcik7CiAgICAgICAgICAgICAgcmV0dXJuIHByb2Nlc3NSZXN1bHQocmVzdWx0LCBzY29wZSk7CiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgICAgICAgIHJldm9rZVNjb3BlKHNjb3BlKTsKICAgICAgICAgICAgICB0aHJvdyBlcnJvcjsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgdXNlUGF0Y2hlc0luU2NvcGUoc2NvcGUsIHBhdGNoTGlzdGVuZXIpOwogICAgICAgICAgcmV0dXJuIHByb2Nlc3NSZXN1bHQocmVzdWx0LCBzY29wZSk7CiAgICAgICAgfSBlbHNlIGlmICghYmFzZSB8fCB0eXBlb2YgYmFzZSAhPT0gIm9iamVjdCIpIHsKICAgICAgICAgIHJlc3VsdCA9IHJlY2lwZShiYXNlKTsKICAgICAgICAgIGlmIChyZXN1bHQgPT09IE5PVEhJTkcpIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgICBpZiAocmVzdWx0ID09PSB1bmRlZmluZWQpIHJlc3VsdCA9IGJhc2U7CiAgICAgICAgICBpZiAoX3RoaXMuYXV0b0ZyZWV6ZV8pIGZyZWV6ZShyZXN1bHQsIHRydWUpOwogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9IGVsc2UgZGllKDIxLCBiYXNlKTsKICAgICAgfTsKCiAgICAgIHRoaXMucHJvZHVjZVdpdGhQYXRjaGVzID0gZnVuY3Rpb24gKGFyZzEsIGFyZzIsIGFyZzMpIHsKICAgICAgICBpZiAodHlwZW9mIGFyZzEgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoc3RhdGUpIHsKICAgICAgICAgICAgZm9yICh2YXIgX2xlbjIgPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4yID4gMSA/IF9sZW4yIC0gMSA6IDApLCBfa2V5MiA9IDE7IF9rZXkyIDwgX2xlbjI7IF9rZXkyKyspIHsKICAgICAgICAgICAgICBhcmdzW19rZXkyIC0gMV0gPSBhcmd1bWVudHNbX2tleTJdOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gX3RoaXMucHJvZHVjZVdpdGhQYXRjaGVzKHN0YXRlLCBmdW5jdGlvbiAoZHJhZnQpIHsKICAgICAgICAgICAgICByZXR1cm4gYXJnMS5hcHBseSh2b2lkIDAsIFtkcmFmdF0uY29uY2F0KGFyZ3MpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgdmFyIHBhdGNoZXMsIGludmVyc2VQYXRjaGVzOwoKICAgICAgICB2YXIgbmV4dFN0YXRlID0gX3RoaXMucHJvZHVjZShhcmcxLCBhcmcyLCBmdW5jdGlvbiAocCwgaXApIHsKICAgICAgICAgIHBhdGNoZXMgPSBwOwogICAgICAgICAgaW52ZXJzZVBhdGNoZXMgPSBpcDsKICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIFtuZXh0U3RhdGUsIHBhdGNoZXMsIGludmVyc2VQYXRjaGVzXTsKICAgICAgfTsKCiAgICAgIGlmICh0eXBlb2YgKGNvbmZpZyA9PT0gbnVsbCB8fCBjb25maWcgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbmZpZy51c2VQcm94aWVzKSA9PT0gImJvb2xlYW4iKSB0aGlzLnNldFVzZVByb3hpZXMoY29uZmlnLnVzZVByb3hpZXMpOwogICAgICBpZiAodHlwZW9mIChjb25maWcgPT09IG51bGwgfHwgY29uZmlnID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWcuYXV0b0ZyZWV6ZSkgPT09ICJib29sZWFuIikgdGhpcy5zZXRBdXRvRnJlZXplKGNvbmZpZy5hdXRvRnJlZXplKTsKICAgIH0KCiAgICB2YXIgX3Byb3RvID0gSW1tZXIucHJvdG90eXBlOwoKICAgIF9wcm90by5jcmVhdGVEcmFmdCA9IGZ1bmN0aW9uIGNyZWF0ZURyYWZ0KGJhc2UpIHsKICAgICAgaWYgKCFpc0RyYWZ0YWJsZShiYXNlKSkgZGllKDgpOwogICAgICBpZiAoaXNEcmFmdChiYXNlKSkgYmFzZSA9IGN1cnJlbnQoYmFzZSk7CiAgICAgIHZhciBzY29wZSA9IGVudGVyU2NvcGUodGhpcyk7CiAgICAgIHZhciBwcm94eSA9IGNyZWF0ZVByb3h5KHRoaXMsIGJhc2UsIHVuZGVmaW5lZCk7CiAgICAgIHByb3h5W0RSQUZUX1NUQVRFXS5pc01hbnVhbF8gPSB0cnVlOwogICAgICBsZWF2ZVNjb3BlKHNjb3BlKTsKICAgICAgcmV0dXJuIHByb3h5OwogICAgfTsKCiAgICBfcHJvdG8uZmluaXNoRHJhZnQgPSBmdW5jdGlvbiBmaW5pc2hEcmFmdChkcmFmdCwgcGF0Y2hMaXN0ZW5lcikgewogICAgICB2YXIgc3RhdGUgPSBkcmFmdCAmJiBkcmFmdFtEUkFGVF9TVEFURV07CgogICAgICB7CiAgICAgICAgaWYgKCFzdGF0ZSB8fCAhc3RhdGUuaXNNYW51YWxfKSBkaWUoOSk7CiAgICAgICAgaWYgKHN0YXRlLmZpbmFsaXplZF8pIGRpZSgxMCk7CiAgICAgIH0KCiAgICAgIHZhciBzY29wZSA9IHN0YXRlLnNjb3BlXzsKICAgICAgdXNlUGF0Y2hlc0luU2NvcGUoc2NvcGUsIHBhdGNoTGlzdGVuZXIpOwogICAgICByZXR1cm4gcHJvY2Vzc1Jlc3VsdCh1bmRlZmluZWQsIHNjb3BlKTsKICAgIH0KICAgIC8qKgogICAgICogUGFzcyB0cnVlIHRvIGF1dG9tYXRpY2FsbHkgZnJlZXplIGFsbCBjb3BpZXMgY3JlYXRlZCBieSBJbW1lci4KICAgICAqCiAgICAgKiBCeSBkZWZhdWx0LCBhdXRvLWZyZWV6aW5nIGlzIGVuYWJsZWQuCiAgICAgKi8KICAgIDsKCiAgICBfcHJvdG8uc2V0QXV0b0ZyZWV6ZSA9IGZ1bmN0aW9uIHNldEF1dG9GcmVlemUodmFsdWUpIHsKICAgICAgdGhpcy5hdXRvRnJlZXplXyA9IHZhbHVlOwogICAgfQogICAgLyoqCiAgICAgKiBQYXNzIHRydWUgdG8gdXNlIHRoZSBFUzIwMTUgYFByb3h5YCBjbGFzcyB3aGVuIGNyZWF0aW5nIGRyYWZ0cywgd2hpY2ggaXMKICAgICAqIGFsd2F5cyBmYXN0ZXIgdGhhbiB1c2luZyBFUzUgcHJveGllcy4KICAgICAqCiAgICAgKiBCeSBkZWZhdWx0LCBmZWF0dXJlIGRldGVjdGlvbiBpcyB1c2VkLCBzbyBjYWxsaW5nIHRoaXMgaXMgcmFyZWx5IG5lY2Vzc2FyeS4KICAgICAqLwogICAgOwoKICAgIF9wcm90by5zZXRVc2VQcm94aWVzID0gZnVuY3Rpb24gc2V0VXNlUHJveGllcyh2YWx1ZSkgewogICAgICBpZiAodmFsdWUgJiYgIWhhc1Byb3hpZXMpIHsKICAgICAgICBkaWUoMjApOwogICAgICB9CgogICAgICB0aGlzLnVzZVByb3hpZXNfID0gdmFsdWU7CiAgICB9OwoKICAgIF9wcm90by5hcHBseVBhdGNoZXMgPSBmdW5jdGlvbiBhcHBseVBhdGNoZXMoYmFzZSwgcGF0Y2hlcykgewogICAgICAvLyBJZiBhIHBhdGNoIHJlcGxhY2VzIHRoZSBlbnRpcmUgc3RhdGUsIHRha2UgdGhhdCByZXBsYWNlbWVudCBhcyBiYXNlCiAgICAgIC8vIGJlZm9yZSBhcHBseWluZyBwYXRjaGVzCiAgICAgIHZhciBpOwoKICAgICAgZm9yIChpID0gcGF0Y2hlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgIHZhciBwYXRjaCA9IHBhdGNoZXNbaV07CgogICAgICAgIGlmIChwYXRjaC5wYXRoLmxlbmd0aCA9PT0gMCAmJiBwYXRjaC5vcCA9PT0gInJlcGxhY2UiKSB7CiAgICAgICAgICBiYXNlID0gcGF0Y2gudmFsdWU7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0gLy8gSWYgdGhlcmUgd2FzIGEgcGF0Y2ggdGhhdCByZXBsYWNlZCB0aGUgZW50aXJlIHN0YXRlLCBzdGFydCBmcm9tIHRoZQogICAgICAvLyBwYXRjaCBhZnRlciB0aGF0LgoKCiAgICAgIGlmIChpID4gLTEpIHsKICAgICAgICBwYXRjaGVzID0gcGF0Y2hlcy5zbGljZShpICsgMSk7CiAgICAgIH0KCiAgICAgIHZhciBhcHBseVBhdGNoZXNJbXBsID0gZ2V0UGx1Z2luKCJQYXRjaGVzIikuYXBwbHlQYXRjaGVzXzsKCiAgICAgIGlmIChpc0RyYWZ0KGJhc2UpKSB7CiAgICAgICAgLy8gTi5COiBuZXZlciBoaXRzIGlmIHNvbWUgcGF0Y2ggYSByZXBsYWNlbWVudCwgcGF0Y2hlcyBhcmUgbmV2ZXIgZHJhZnRzCiAgICAgICAgcmV0dXJuIGFwcGx5UGF0Y2hlc0ltcGwoYmFzZSwgcGF0Y2hlcyk7CiAgICAgIH0gLy8gT3RoZXJ3aXNlLCBwcm9kdWNlIGEgY29weSBvZiB0aGUgYmFzZSBzdGF0ZS4KCgogICAgICByZXR1cm4gdGhpcy5wcm9kdWNlKGJhc2UsIGZ1bmN0aW9uIChkcmFmdCkgewogICAgICAgIHJldHVybiBhcHBseVBhdGNoZXNJbXBsKGRyYWZ0LCBwYXRjaGVzKTsKICAgICAgfSk7CiAgICB9OwoKICAgIHJldHVybiBJbW1lcjsKICB9KCk7CiAgZnVuY3Rpb24gY3JlYXRlUHJveHkoaW1tZXIsIHZhbHVlLCBwYXJlbnQpIHsKICAgIC8vIHByZWNvbmRpdGlvbjogY3JlYXRlUHJveHkgc2hvdWxkIGJlIGd1YXJkZWQgYnkgaXNEcmFmdGFibGUsIHNvIHdlIGtub3cgd2UgY2FuIHNhZmVseSBkcmFmdAogICAgdmFyIGRyYWZ0ID0gaXNNYXAodmFsdWUpID8gZ2V0UGx1Z2luKCJNYXBTZXQiKS5wcm94eU1hcF8odmFsdWUsIHBhcmVudCkgOiBpc1NldCh2YWx1ZSkgPyBnZXRQbHVnaW4oIk1hcFNldCIpLnByb3h5U2V0Xyh2YWx1ZSwgcGFyZW50KSA6IGltbWVyLnVzZVByb3hpZXNfID8gY3JlYXRlUHJveHlQcm94eSh2YWx1ZSwgcGFyZW50KSA6IGdldFBsdWdpbigiRVM1IikuY3JlYXRlRVM1UHJveHlfKHZhbHVlLCBwYXJlbnQpOwogICAgdmFyIHNjb3BlID0gcGFyZW50ID8gcGFyZW50LnNjb3BlXyA6IGdldEN1cnJlbnRTY29wZSgpOwogICAgc2NvcGUuZHJhZnRzXy5wdXNoKGRyYWZ0KTsKICAgIHJldHVybiBkcmFmdDsKICB9CgogIGZ1bmN0aW9uIGN1cnJlbnQodmFsdWUpIHsKICAgIGlmICghaXNEcmFmdCh2YWx1ZSkpIGRpZSgyMiwgdmFsdWUpOwogICAgcmV0dXJuIGN1cnJlbnRJbXBsKHZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIGN1cnJlbnRJbXBsKHZhbHVlKSB7CiAgICBpZiAoIWlzRHJhZnRhYmxlKHZhbHVlKSkgcmV0dXJuIHZhbHVlOwogICAgdmFyIHN0YXRlID0gdmFsdWVbRFJBRlRfU1RBVEVdOwogICAgdmFyIGNvcHk7CiAgICB2YXIgYXJjaFR5cGUgPSBnZXRBcmNodHlwZSh2YWx1ZSk7CgogICAgaWYgKHN0YXRlKSB7CiAgICAgIGlmICghc3RhdGUubW9kaWZpZWRfICYmIChzdGF0ZS50eXBlXyA8IDQgfHwgIWdldFBsdWdpbigiRVM1IikuaGFzQ2hhbmdlc18oc3RhdGUpKSkgcmV0dXJuIHN0YXRlLmJhc2VfOyAvLyBPcHRpbWl6YXRpb246IGF2b2lkIGdlbmVyYXRpbmcgbmV3IGRyYWZ0cyBkdXJpbmcgY29weWluZwoKICAgICAgc3RhdGUuZmluYWxpemVkXyA9IHRydWU7CiAgICAgIGNvcHkgPSBjb3B5SGVscGVyKHZhbHVlLCBhcmNoVHlwZSk7CiAgICAgIHN0YXRlLmZpbmFsaXplZF8gPSBmYWxzZTsKICAgIH0gZWxzZSB7CiAgICAgIGNvcHkgPSBjb3B5SGVscGVyKHZhbHVlLCBhcmNoVHlwZSk7CiAgICB9CgogICAgZWFjaCQxKGNvcHksIGZ1bmN0aW9uIChrZXksIGNoaWxkVmFsdWUpIHsKICAgICAgaWYgKHN0YXRlICYmIGdldChzdGF0ZS5iYXNlXywga2V5KSA9PT0gY2hpbGRWYWx1ZSkgcmV0dXJuOyAvLyBubyBuZWVkIHRvIGNvcHkgb3Igc2VhcmNoIGluIHNvbWV0aGluZyB0aGF0IGRpZG4ndCBjaGFuZ2UKCiAgICAgIHNldChjb3B5LCBrZXksIGN1cnJlbnRJbXBsKGNoaWxkVmFsdWUpKTsKICAgIH0pOyAvLyBJbiB0aGUgZnV0dXJlLCB3ZSBtaWdodCBjb25zaWRlciBmcmVlemluZyBoZXJlLCBiYXNlZCBvbiB0aGUgY3VycmVudCBzZXR0aW5ncwoKICAgIHJldHVybiBhcmNoVHlwZSA9PT0gMwogICAgLyogU2V0ICovCiAgICA/IG5ldyBTZXQoY29weSkgOiBjb3B5OwogIH0KCiAgZnVuY3Rpb24gY29weUhlbHBlcih2YWx1ZSwgYXJjaFR5cGUpIHsKICAgIC8vIGNyZWF0ZXMgYSBzaGFsbG93IGNvcHksIGV2ZW4gaWYgaXQgaXMgYSBtYXAgb3Igc2V0CiAgICBzd2l0Y2ggKGFyY2hUeXBlKSB7CiAgICAgIGNhc2UgMgogICAgICAvKiBNYXAgKi8KICAgICAgOgogICAgICAgIHJldHVybiBuZXcgTWFwKHZhbHVlKTsKCiAgICAgIGNhc2UgMwogICAgICAvKiBTZXQgKi8KICAgICAgOgogICAgICAgIC8vIFNldCB3aWxsIGJlIGNsb25lZCBhcyBhcnJheSB0ZW1wb3JhcmlseSwgc28gdGhhdCB3ZSBjYW4gcmVwbGFjZSBpbmRpdmlkdWFsIGl0ZW1zCiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20odmFsdWUpOwogICAgfQoKICAgIHJldHVybiBzaGFsbG93Q29weSh2YWx1ZSk7CiAgfQoKICBmdW5jdGlvbiBlbmFibGVFUzUoKSB7CiAgICBmdW5jdGlvbiB3aWxsRmluYWxpemVFUzVfKHNjb3BlLCByZXN1bHQsIGlzUmVwbGFjZWQpIHsKICAgICAgaWYgKCFpc1JlcGxhY2VkKSB7CiAgICAgICAgaWYgKHNjb3BlLnBhdGNoZXNfKSB7CiAgICAgICAgICBtYXJrQ2hhbmdlc1JlY3Vyc2l2ZWx5KHNjb3BlLmRyYWZ0c19bMF0pOwogICAgICAgIH0gLy8gVGhpcyBpcyBmYXN0ZXIgd2hlbiB3ZSBkb24ndCBjYXJlIGFib3V0IHdoaWNoIGF0dHJpYnV0ZXMgY2hhbmdlZC4KCgogICAgICAgIG1hcmtDaGFuZ2VzU3dlZXAoc2NvcGUuZHJhZnRzXyk7CiAgICAgIH0gLy8gV2hlbiBhIGNoaWxkIGRyYWZ0IGlzIHJldHVybmVkLCBsb29rIGZvciBjaGFuZ2VzLgogICAgICBlbHNlIGlmIChpc0RyYWZ0KHJlc3VsdCkgJiYgcmVzdWx0W0RSQUZUX1NUQVRFXS5zY29wZV8gPT09IHNjb3BlKSB7CiAgICAgICAgICBtYXJrQ2hhbmdlc1N3ZWVwKHNjb3BlLmRyYWZ0c18pOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVFUzVEcmFmdChpc0FycmF5LCBiYXNlKSB7CiAgICAgIGlmIChpc0FycmF5KSB7CiAgICAgICAgdmFyIGRyYWZ0ID0gbmV3IEFycmF5KGJhc2UubGVuZ3RoKTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiYXNlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZHJhZnQsICIiICsgaSwgcHJveHlQcm9wZXJ0eShpLCB0cnVlKSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZHJhZnQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIF9kZXNjcmlwdG9ycyA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoYmFzZSk7CgogICAgICAgIGRlbGV0ZSBfZGVzY3JpcHRvcnNbRFJBRlRfU1RBVEVdOwogICAgICAgIHZhciBrZXlzID0gb3duS2V5cyRhKF9kZXNjcmlwdG9ycyk7CgogICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBrZXlzLmxlbmd0aDsgX2krKykgewogICAgICAgICAgdmFyIGtleSA9IGtleXNbX2ldOwogICAgICAgICAgX2Rlc2NyaXB0b3JzW2tleV0gPSBwcm94eVByb3BlcnR5KGtleSwgaXNBcnJheSB8fCAhIV9kZXNjcmlwdG9yc1trZXldLmVudW1lcmFibGUpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIE9iamVjdC5jcmVhdGUoT2JqZWN0LmdldFByb3RvdHlwZU9mKGJhc2UpLCBfZGVzY3JpcHRvcnMpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlRVM1UHJveHlfKGJhc2UsIHBhcmVudCkgewogICAgICB2YXIgaXNBcnJheSA9IEFycmF5LmlzQXJyYXkoYmFzZSk7CiAgICAgIHZhciBkcmFmdCA9IGNyZWF0ZUVTNURyYWZ0KGlzQXJyYXksIGJhc2UpOwogICAgICB2YXIgc3RhdGUgPSB7CiAgICAgICAgdHlwZV86IGlzQXJyYXkgPyA1CiAgICAgICAgLyogRVM1QXJyYXkgKi8KICAgICAgICA6IDQKICAgICAgICAvKiBFUzVPYmplY3QgKi8KICAgICAgICAsCiAgICAgICAgc2NvcGVfOiBwYXJlbnQgPyBwYXJlbnQuc2NvcGVfIDogZ2V0Q3VycmVudFNjb3BlKCksCiAgICAgICAgbW9kaWZpZWRfOiBmYWxzZSwKICAgICAgICBmaW5hbGl6ZWRfOiBmYWxzZSwKICAgICAgICBhc3NpZ25lZF86IHt9LAogICAgICAgIHBhcmVudF86IHBhcmVudCwKICAgICAgICAvLyBiYXNlIGlzIHRoZSBvYmplY3Qgd2UgYXJlIGRyYWZ0aW5nCiAgICAgICAgYmFzZV86IGJhc2UsCiAgICAgICAgLy8gZHJhZnQgaXMgdGhlIGRyYWZ0IG9iamVjdCBpdHNlbGYsIHRoYXQgdHJhcHMgYWxsIHJlYWRzIGFuZCByZWFkcyBmcm9tIGVpdGhlciB0aGUgYmFzZSAoaWYgdW5tb2RpZmllZCkgb3IgY29weSAoaWYgbW9kaWZpZWQpCiAgICAgICAgZHJhZnRfOiBkcmFmdCwKICAgICAgICBjb3B5XzogbnVsbCwKICAgICAgICByZXZva2VkXzogZmFsc2UsCiAgICAgICAgaXNNYW51YWxfOiBmYWxzZQogICAgICB9OwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZHJhZnQsIERSQUZUX1NUQVRFLCB7CiAgICAgICAgdmFsdWU6IHN0YXRlLAogICAgICAgIC8vIGVudW1lcmFibGU6IGZhbHNlIDwtIHRoZSBkZWZhdWx0CiAgICAgICAgd3JpdGFibGU6IHRydWUKICAgICAgfSk7CiAgICAgIHJldHVybiBkcmFmdDsKICAgIH0gLy8gcHJvcGVydHkgZGVzY3JpcHRvcnMgYXJlIHJlY3ljbGVkIHRvIG1ha2Ugc3VyZSB3ZSBkb24ndCBjcmVhdGUgYSBnZXQgYW5kIHNldCBjbG9zdXJlIHBlciBwcm9wZXJ0eSwKICAgIC8vIGJ1dCBzaGFyZSB0aGVtIGFsbCBpbnN0ZWFkCgoKICAgIHZhciBkZXNjcmlwdG9ycyA9IHt9OwoKICAgIGZ1bmN0aW9uIHByb3h5UHJvcGVydHkocHJvcCwgZW51bWVyYWJsZSkgewogICAgICB2YXIgZGVzYyA9IGRlc2NyaXB0b3JzW3Byb3BdOwoKICAgICAgaWYgKGRlc2MpIHsKICAgICAgICBkZXNjLmVudW1lcmFibGUgPSBlbnVtZXJhYmxlOwogICAgICB9IGVsc2UgewogICAgICAgIGRlc2NyaXB0b3JzW3Byb3BdID0gZGVzYyA9IHsKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICAgIGVudW1lcmFibGU6IGVudW1lcmFibGUsCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgdmFyIHN0YXRlID0gdGhpc1tEUkFGVF9TVEFURV07CiAgICAgICAgICAgIGFzc2VydFVucmV2b2tlZChzdGF0ZSk7IC8vIEB0cy1pZ25vcmUKCiAgICAgICAgICAgIHJldHVybiBvYmplY3RUcmFwcy5nZXQoc3RhdGUsIHByb3ApOwogICAgICAgICAgfSwKICAgICAgICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbHVlKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHRoaXNbRFJBRlRfU1RBVEVdOwogICAgICAgICAgICBhc3NlcnRVbnJldm9rZWQoc3RhdGUpOyAvLyBAdHMtaWdub3JlCgogICAgICAgICAgICBvYmplY3RUcmFwcy5zZXQoc3RhdGUsIHByb3AsIHZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9CgogICAgICByZXR1cm4gZGVzYzsKICAgIH0gLy8gVGhpcyBsb29rcyBleHBlbnNpdmUsIGJ1dCBvbmx5IHByb3hpZXMgYXJlIHZpc2l0ZWQsIGFuZCBvbmx5IG9iamVjdHMgd2l0aG91dCBrbm93biBjaGFuZ2VzIGFyZSBzY2FubmVkLgoKCiAgICBmdW5jdGlvbiBtYXJrQ2hhbmdlc1N3ZWVwKGRyYWZ0cykgewogICAgICAvLyBUaGUgbmF0dXJhbCBvcmRlciBvZiBkcmFmdHMgaW4gdGhlIGBzY29wZWAgYXJyYXkgaXMgYmFzZWQgb24gd2hlbiB0aGV5CiAgICAgIC8vIHdlcmUgYWNjZXNzZWQuIEJ5IHByb2Nlc3NpbmcgZHJhZnRzIGluIHJldmVyc2UgbmF0dXJhbCBvcmRlciwgd2UgaGF2ZSBhCiAgICAgIC8vIGJldHRlciBjaGFuY2Ugb2YgcHJvY2Vzc2luZyBsZWFmIG5vZGVzIGZpcnN0LiBXaGVuIGEgbGVhZiBub2RlIGlzIGtub3duIHRvCiAgICAgIC8vIGhhdmUgY2hhbmdlZCwgd2UgY2FuIGF2b2lkIGFueSB0cmF2ZXJzYWwgb2YgaXRzIGFuY2VzdG9yIG5vZGVzLgogICAgICBmb3IgKHZhciBpID0gZHJhZnRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgdmFyIHN0YXRlID0gZHJhZnRzW2ldW0RSQUZUX1NUQVRFXTsKCiAgICAgICAgaWYgKCFzdGF0ZS5tb2RpZmllZF8pIHsKICAgICAgICAgIHN3aXRjaCAoc3RhdGUudHlwZV8pIHsKICAgICAgICAgICAgY2FzZSA1CiAgICAgICAgICAgIC8qIEVTNUFycmF5ICovCiAgICAgICAgICAgIDoKICAgICAgICAgICAgICBpZiAoaGFzQXJyYXlDaGFuZ2VzKHN0YXRlKSkgbWFya0NoYW5nZWQoc3RhdGUpOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSA0CiAgICAgICAgICAgIC8qIEVTNU9iamVjdCAqLwogICAgICAgICAgICA6CiAgICAgICAgICAgICAgaWYgKGhhc09iamVjdENoYW5nZXMoc3RhdGUpKSBtYXJrQ2hhbmdlZChzdGF0ZSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gbWFya0NoYW5nZXNSZWN1cnNpdmVseShvYmplY3QpIHsKICAgICAgaWYgKCFvYmplY3QgfHwgdHlwZW9mIG9iamVjdCAhPT0gIm9iamVjdCIpIHJldHVybjsKICAgICAgdmFyIHN0YXRlID0gb2JqZWN0W0RSQUZUX1NUQVRFXTsKICAgICAgaWYgKCFzdGF0ZSkgcmV0dXJuOwogICAgICB2YXIgYmFzZV8gPSBzdGF0ZS5iYXNlXywKICAgICAgICAgIGRyYWZ0XyA9IHN0YXRlLmRyYWZ0XywKICAgICAgICAgIGFzc2lnbmVkXyA9IHN0YXRlLmFzc2lnbmVkXywKICAgICAgICAgIHR5cGVfID0gc3RhdGUudHlwZV87CgogICAgICBpZiAodHlwZV8gPT09IDQKICAgICAgLyogRVM1T2JqZWN0ICovCiAgICAgICkgewogICAgICAgICAgLy8gTG9vayBmb3IgYWRkZWQga2V5cy4KICAgICAgICAgIC8vIHByb2JhYmx5IHRoZXJlIGlzIGEgZmFzdGVyIHdheSB0byBkZXRlY3QgY2hhbmdlcywgYXMgc3dlZXAgKyByZWN1cnNlIHNlZW1zIHRvIGRvIHNvbWUKICAgICAgICAgIC8vIHVubmVjZXNzYXJ5IHdvcmsuCiAgICAgICAgICAvLyBhbHNvOiBwcm9iYWJseSB3ZSBjYW4gc3RvcmUgdGhlIGluZm9ybWF0aW9uIHdlIGRldGVjdCBoZXJlLCB0byBzcGVlZCB1cCB0cmVlIGZpbmFsaXphdGlvbiEKICAgICAgICAgIGVhY2gkMShkcmFmdF8sIGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgICAgaWYgKGtleSA9PT0gRFJBRlRfU1RBVEUpIHJldHVybjsgLy8gVGhlIGB1bmRlZmluZWRgIGNoZWNrIGlzIGEgZmFzdCBwYXRoIGZvciBwcmUtZXhpc3Rpbmcga2V5cy4KCiAgICAgICAgICAgIGlmIChiYXNlX1trZXldID09PSB1bmRlZmluZWQgJiYgIWhhcyhiYXNlXywga2V5KSkgewogICAgICAgICAgICAgIGFzc2lnbmVkX1trZXldID0gdHJ1ZTsKICAgICAgICAgICAgICBtYXJrQ2hhbmdlZChzdGF0ZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIWFzc2lnbmVkX1trZXldKSB7CiAgICAgICAgICAgICAgLy8gT25seSB1bnRvdWNoZWQgcHJvcGVydGllcyB0cmlnZ2VyIHJlY3Vyc2lvbi4KICAgICAgICAgICAgICBtYXJrQ2hhbmdlc1JlY3Vyc2l2ZWx5KGRyYWZ0X1trZXldKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7IC8vIExvb2sgZm9yIHJlbW92ZWQga2V5cy4KCiAgICAgICAgICBlYWNoJDEoYmFzZV8sIGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgICAgLy8gVGhlIGB1bmRlZmluZWRgIGNoZWNrIGlzIGEgZmFzdCBwYXRoIGZvciBwcmUtZXhpc3Rpbmcga2V5cy4KICAgICAgICAgICAgaWYgKGRyYWZ0X1trZXldID09PSB1bmRlZmluZWQgJiYgIWhhcyhkcmFmdF8sIGtleSkpIHsKICAgICAgICAgICAgICBhc3NpZ25lZF9ba2V5XSA9IGZhbHNlOwogICAgICAgICAgICAgIG1hcmtDaGFuZ2VkKHN0YXRlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlXyA9PT0gNQogICAgICAvKiBFUzVBcnJheSAqLwogICAgICApIHsKICAgICAgICAgIGlmIChoYXNBcnJheUNoYW5nZXMoc3RhdGUpKSB7CiAgICAgICAgICAgIG1hcmtDaGFuZ2VkKHN0YXRlKTsKICAgICAgICAgICAgYXNzaWduZWRfLmxlbmd0aCA9IHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGRyYWZ0Xy5sZW5ndGggPCBiYXNlXy5sZW5ndGgpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IGRyYWZ0Xy5sZW5ndGg7IGkgPCBiYXNlXy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGFzc2lnbmVkX1tpXSA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmb3IgKHZhciBfaTIgPSBiYXNlXy5sZW5ndGg7IF9pMiA8IGRyYWZ0Xy5sZW5ndGg7IF9pMisrKSB7CiAgICAgICAgICAgICAgYXNzaWduZWRfW19pMl0gPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vIE1pbmltdW0gY291bnQgaXMgZW5vdWdoLCB0aGUgb3RoZXIgcGFydHMgaGFzIGJlZW4gcHJvY2Vzc2VkLgoKCiAgICAgICAgICB2YXIgbWluID0gTWF0aC5taW4oZHJhZnRfLmxlbmd0aCwgYmFzZV8ubGVuZ3RoKTsKCiAgICAgICAgICBmb3IgKHZhciBfaTMgPSAwOyBfaTMgPCBtaW47IF9pMysrKSB7CiAgICAgICAgICAgIC8vIE9ubHkgdW50b3VjaGVkIGluZGljZXMgdHJpZ2dlciByZWN1cnNpb24uCiAgICAgICAgICAgIGlmIChhc3NpZ25lZF9bX2kzXSA9PT0gdW5kZWZpbmVkKSBtYXJrQ2hhbmdlc1JlY3Vyc2l2ZWx5KGRyYWZ0X1tfaTNdKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gaGFzT2JqZWN0Q2hhbmdlcyhzdGF0ZSkgewogICAgICB2YXIgYmFzZV8gPSBzdGF0ZS5iYXNlXywKICAgICAgICAgIGRyYWZ0XyA9IHN0YXRlLmRyYWZ0XzsgLy8gU2VhcmNoIGZvciBhZGRlZCBrZXlzIGFuZCBjaGFuZ2VkIGtleXMuIFN0YXJ0IGF0IHRoZSBiYWNrLCBiZWNhdXNlCiAgICAgIC8vIG5vbi1udW1lcmljIGtleXMgYXJlIG9yZGVyZWQgYnkgdGltZSBvZiBkZWZpbml0aW9uIG9uIHRoZSBvYmplY3QuCgogICAgICB2YXIga2V5cyA9IG93bktleXMkYShkcmFmdF8pOwoKICAgICAgZm9yICh2YXIgaSA9IGtleXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICB2YXIga2V5ID0ga2V5c1tpXTsKICAgICAgICBpZiAoa2V5ID09PSBEUkFGVF9TVEFURSkgY29udGludWU7CiAgICAgICAgdmFyIGJhc2VWYWx1ZSA9IGJhc2VfW2tleV07IC8vIFRoZSBgdW5kZWZpbmVkYCBjaGVjayBpcyBhIGZhc3QgcGF0aCBmb3IgcHJlLWV4aXN0aW5nIGtleXMuCgogICAgICAgIGlmIChiYXNlVmFsdWUgPT09IHVuZGVmaW5lZCAmJiAhaGFzKGJhc2VfLCBrZXkpKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IC8vIE9uY2UgYSBiYXNlIGtleSBpcyBkZWxldGVkLCBmdXR1cmUgY2hhbmdlcyBnbyB1bmRldGVjdGVkLCBiZWNhdXNlIGl0cwogICAgICAgIC8vIGRlc2NyaXB0b3IgaXMgZXJhc2VkLiBUaGlzIGJyYW5jaCBkZXRlY3RzIGFueSBtaXNzZWQgY2hhbmdlcy4KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdmFyIHZhbHVlID0gZHJhZnRfW2tleV07CgogICAgICAgICAgICB2YXIgX3N0YXRlID0gdmFsdWUgJiYgdmFsdWVbRFJBRlRfU1RBVEVdOwoKICAgICAgICAgICAgaWYgKF9zdGF0ZSA/IF9zdGF0ZS5iYXNlXyAhPT0gYmFzZVZhbHVlIDogIWlzJDEodmFsdWUsIGJhc2VWYWx1ZSkpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICB9IC8vIEF0IHRoaXMgcG9pbnQsIG5vIGtleXMgd2VyZSBhZGRlZCBvciBjaGFuZ2VkLgogICAgICAvLyBDb21wYXJlIGtleSBjb3VudCB0byBkZXRlcm1pbmUgaWYga2V5cyB3ZXJlIGRlbGV0ZWQuCgoKICAgICAgdmFyIGJhc2VJc0RyYWZ0ID0gISFiYXNlX1tEUkFGVF9TVEFURV07CiAgICAgIHJldHVybiBrZXlzLmxlbmd0aCAhPT0gb3duS2V5cyRhKGJhc2VfKS5sZW5ndGggKyAoYmFzZUlzRHJhZnQgPyAwIDogMSk7IC8vICsgMSB0byBjb3JyZWN0IGZvciBEUkFGVF9TVEFURQogICAgfQoKICAgIGZ1bmN0aW9uIGhhc0FycmF5Q2hhbmdlcyhzdGF0ZSkgewogICAgICB2YXIgZHJhZnRfID0gc3RhdGUuZHJhZnRfOwogICAgICBpZiAoZHJhZnRfLmxlbmd0aCAhPT0gc3RhdGUuYmFzZV8ubGVuZ3RoKSByZXR1cm4gdHJ1ZTsgLy8gU2VlICMxMTYKICAgICAgLy8gSWYgd2UgZmlyc3Qgc2hvcnRlbiB0aGUgbGVuZ3RoLCBvdXIgYXJyYXkgaW50ZXJjZXB0b3JzIHdpbGwgYmUgcmVtb3ZlZC4KICAgICAgLy8gSWYgYWZ0ZXIgdGhhdCBuZXcgaXRlbXMgYXJlIGFkZGVkLCByZXN1bHQgaW4gdGhlIHNhbWUgb3JpZ2luYWwgbGVuZ3RoLAogICAgICAvLyB0aG9zZSBsYXN0IGl0ZW1zIHdpbGwgaGF2ZSBubyBpbnRlcmNlcHRpbmcgcHJvcGVydHkuCiAgICAgIC8vIFNvIGlmIHRoZXJlIGlzIG5vIG93biBkZXNjcmlwdG9yIG9uIHRoZSBsYXN0IHBvc2l0aW9uLCB3ZSBrbm93IHRoYXQgaXRlbXMgd2VyZSByZW1vdmVkIGFuZCBhZGRlZAogICAgICAvLyBOLkIuOiBzcGxpY2UsIHVuc2hpZnQsIGV0YyBvbmx5IHNoaWZ0IHZhbHVlcyBhcm91bmQsIGJ1dCBub3QgcHJvcCBkZXNjcmlwdG9ycywgc28gd2Ugb25seSBoYXZlIHRvIGNoZWNrCiAgICAgIC8vIHRoZSBsYXN0IG9uZQoKICAgICAgdmFyIGRlc2NyaXB0b3IgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGRyYWZ0XywgZHJhZnRfLmxlbmd0aCAtIDEpOyAvLyBkZXNjcmlwdG9yIGNhbiBiZSBudWxsLCBidXQgb25seSBmb3IgbmV3bHkgY3JlYXRlZCBzcGFyc2UgYXJyYXlzLCBlZy4gbmV3IEFycmF5KDEwKQoKICAgICAgaWYgKGRlc2NyaXB0b3IgJiYgIWRlc2NyaXB0b3IuZ2V0KSByZXR1cm4gdHJ1ZTsgLy8gRm9yIGFsbCBvdGhlciBjYXNlcywgd2UgZG9uJ3QgaGF2ZSB0byBjb21wYXJlLCBhcyB0aGV5IHdvdWxkIGhhdmUgYmVlbiBwaWNrZWQgdXAgYnkgdGhlIGluZGV4IHNldHRlcnMKCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBoYXNDaGFuZ2VzXyhzdGF0ZSkgewogICAgICByZXR1cm4gc3RhdGUudHlwZV8gPT09IDQKICAgICAgLyogRVM1T2JqZWN0ICovCiAgICAgID8gaGFzT2JqZWN0Q2hhbmdlcyhzdGF0ZSkgOiBoYXNBcnJheUNoYW5nZXMoc3RhdGUpOwogICAgfQoKICAgIGZ1bmN0aW9uIGFzc2VydFVucmV2b2tlZChzdGF0ZQogICAgLypFUzVTdGF0ZSB8IE1hcFN0YXRlIHwgU2V0U3RhdGUqLwogICAgKSB7CiAgICAgIGlmIChzdGF0ZS5yZXZva2VkXykgZGllKDMsIEpTT04uc3RyaW5naWZ5KGxhdGVzdChzdGF0ZSkpKTsKICAgIH0KCiAgICBsb2FkUGx1Z2luKCJFUzUiLCB7CiAgICAgIGNyZWF0ZUVTNVByb3h5XzogY3JlYXRlRVM1UHJveHlfLAogICAgICB3aWxsRmluYWxpemVFUzVfOiB3aWxsRmluYWxpemVFUzVfLAogICAgICBoYXNDaGFuZ2VzXzogaGFzQ2hhbmdlc18KICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gZW5hYmxlUGF0Y2hlcygpIHsKICAgIHZhciBSRVBMQUNFID0gInJlcGxhY2UiOwogICAgdmFyIEFERCA9ICJhZGQiOwogICAgdmFyIFJFTU9WRSA9ICJyZW1vdmUiOwoKICAgIGZ1bmN0aW9uIGdlbmVyYXRlUGF0Y2hlc18oc3RhdGUsIGJhc2VQYXRoLCBwYXRjaGVzLCBpbnZlcnNlUGF0Y2hlcykgewogICAgICBzd2l0Y2ggKHN0YXRlLnR5cGVfKSB7CiAgICAgICAgY2FzZSAwCiAgICAgICAgLyogUHJveHlPYmplY3QgKi8KICAgICAgICA6CiAgICAgICAgY2FzZSA0CiAgICAgICAgLyogRVM1T2JqZWN0ICovCiAgICAgICAgOgogICAgICAgIGNhc2UgMgogICAgICAgIC8qIE1hcCAqLwogICAgICAgIDoKICAgICAgICAgIHJldHVybiBnZW5lcmF0ZVBhdGNoZXNGcm9tQXNzaWduZWQoc3RhdGUsIGJhc2VQYXRoLCBwYXRjaGVzLCBpbnZlcnNlUGF0Y2hlcyk7CgogICAgICAgIGNhc2UgNQogICAgICAgIC8qIEVTNUFycmF5ICovCiAgICAgICAgOgogICAgICAgIGNhc2UgMQogICAgICAgIC8qIFByb3h5QXJyYXkgKi8KICAgICAgICA6CiAgICAgICAgICByZXR1cm4gZ2VuZXJhdGVBcnJheVBhdGNoZXMoc3RhdGUsIGJhc2VQYXRoLCBwYXRjaGVzLCBpbnZlcnNlUGF0Y2hlcyk7CgogICAgICAgIGNhc2UgMwogICAgICAgIC8qIFNldCAqLwogICAgICAgIDoKICAgICAgICAgIHJldHVybiBnZW5lcmF0ZVNldFBhdGNoZXMoc3RhdGUsIGJhc2VQYXRoLCBwYXRjaGVzLCBpbnZlcnNlUGF0Y2hlcyk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBnZW5lcmF0ZUFycmF5UGF0Y2hlcyhzdGF0ZSwgYmFzZVBhdGgsIHBhdGNoZXMsIGludmVyc2VQYXRjaGVzKSB7CiAgICAgIHZhciBiYXNlXyA9IHN0YXRlLmJhc2VfLAogICAgICAgICAgYXNzaWduZWRfID0gc3RhdGUuYXNzaWduZWRfOwogICAgICB2YXIgY29weV8gPSBzdGF0ZS5jb3B5XzsgLy8gUmVkdWNlIGNvbXBsZXhpdHkgYnkgZW5zdXJpbmcgYGJhc2VgIGlzIG5ldmVyIGxvbmdlci4KCiAgICAgIGlmIChjb3B5Xy5sZW5ndGggPCBiYXNlXy5sZW5ndGgpIHsKICAgICAgICB2YXIgX3JlZiA9IFtjb3B5XywgYmFzZV9dOwogICAgICAgIGJhc2VfID0gX3JlZlswXTsKICAgICAgICBjb3B5XyA9IF9yZWZbMV07CiAgICAgICAgdmFyIF9yZWYyID0gW2ludmVyc2VQYXRjaGVzLCBwYXRjaGVzXTsKICAgICAgICBwYXRjaGVzID0gX3JlZjJbMF07CiAgICAgICAgaW52ZXJzZVBhdGNoZXMgPSBfcmVmMlsxXTsKICAgICAgfSAvLyBQcm9jZXNzIHJlcGxhY2VkIGluZGljZXMuCgoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiYXNlXy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmIChhc3NpZ25lZF9baV0gJiYgY29weV9baV0gIT09IGJhc2VfW2ldKSB7CiAgICAgICAgICB2YXIgcGF0aCA9IGJhc2VQYXRoLmNvbmNhdChbaV0pOwogICAgICAgICAgcGF0Y2hlcy5wdXNoKHsKICAgICAgICAgICAgb3A6IFJFUExBQ0UsCiAgICAgICAgICAgIHBhdGg6IHBhdGgsCiAgICAgICAgICAgIC8vIE5lZWQgdG8gbWF5YmUgY2xvbmUgaXQsIGFzIGl0IGNhbiBpbiBmYWN0IGJlIHRoZSBvcmlnaW5hbCB2YWx1ZQogICAgICAgICAgICAvLyBkdWUgdG8gdGhlIGJhc2UvY29weSBpbnZlcnNpb24gYXQgdGhlIHN0YXJ0IG9mIHRoaXMgZnVuY3Rpb24KICAgICAgICAgICAgdmFsdWU6IGNsb25lUGF0Y2hWYWx1ZUlmTmVlZGVkKGNvcHlfW2ldKQogICAgICAgICAgfSk7CiAgICAgICAgICBpbnZlcnNlUGF0Y2hlcy5wdXNoKHsKICAgICAgICAgICAgb3A6IFJFUExBQ0UsCiAgICAgICAgICAgIHBhdGg6IHBhdGgsCiAgICAgICAgICAgIHZhbHVlOiBjbG9uZVBhdGNoVmFsdWVJZk5lZWRlZChiYXNlX1tpXSkKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSAvLyBQcm9jZXNzIGFkZGVkIGluZGljZXMuCgoKICAgICAgZm9yICh2YXIgX2kgPSBiYXNlXy5sZW5ndGg7IF9pIDwgY29weV8ubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgdmFyIF9wYXRoID0gYmFzZVBhdGguY29uY2F0KFtfaV0pOwoKICAgICAgICBwYXRjaGVzLnB1c2goewogICAgICAgICAgb3A6IEFERCwKICAgICAgICAgIHBhdGg6IF9wYXRoLAogICAgICAgICAgLy8gTmVlZCB0byBtYXliZSBjbG9uZSBpdCwgYXMgaXQgY2FuIGluIGZhY3QgYmUgdGhlIG9yaWdpbmFsIHZhbHVlCiAgICAgICAgICAvLyBkdWUgdG8gdGhlIGJhc2UvY29weSBpbnZlcnNpb24gYXQgdGhlIHN0YXJ0IG9mIHRoaXMgZnVuY3Rpb24KICAgICAgICAgIHZhbHVlOiBjbG9uZVBhdGNoVmFsdWVJZk5lZWRlZChjb3B5X1tfaV0pCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGlmIChiYXNlXy5sZW5ndGggPCBjb3B5Xy5sZW5ndGgpIHsKICAgICAgICBpbnZlcnNlUGF0Y2hlcy5wdXNoKHsKICAgICAgICAgIG9wOiBSRVBMQUNFLAogICAgICAgICAgcGF0aDogYmFzZVBhdGguY29uY2F0KFsibGVuZ3RoIl0pLAogICAgICAgICAgdmFsdWU6IGJhc2VfLmxlbmd0aAogICAgICAgIH0pOwogICAgICB9CiAgICB9IC8vIFRoaXMgaXMgdXNlZCBmb3IgYm90aCBNYXAgb2JqZWN0cyBhbmQgbm9ybWFsIG9iamVjdHMuCgoKICAgIGZ1bmN0aW9uIGdlbmVyYXRlUGF0Y2hlc0Zyb21Bc3NpZ25lZChzdGF0ZSwgYmFzZVBhdGgsIHBhdGNoZXMsIGludmVyc2VQYXRjaGVzKSB7CiAgICAgIHZhciBiYXNlXyA9IHN0YXRlLmJhc2VfLAogICAgICAgICAgY29weV8gPSBzdGF0ZS5jb3B5XzsKICAgICAgZWFjaCQxKHN0YXRlLmFzc2lnbmVkXywgZnVuY3Rpb24gKGtleSwgYXNzaWduZWRWYWx1ZSkgewogICAgICAgIHZhciBvcmlnVmFsdWUgPSBnZXQoYmFzZV8sIGtleSk7CiAgICAgICAgdmFyIHZhbHVlID0gZ2V0KGNvcHlfLCBrZXkpOwogICAgICAgIHZhciBvcCA9ICFhc3NpZ25lZFZhbHVlID8gUkVNT1ZFIDogaGFzKGJhc2VfLCBrZXkpID8gUkVQTEFDRSA6IEFERDsKICAgICAgICBpZiAob3JpZ1ZhbHVlID09PSB2YWx1ZSAmJiBvcCA9PT0gUkVQTEFDRSkgcmV0dXJuOwogICAgICAgIHZhciBwYXRoID0gYmFzZVBhdGguY29uY2F0KGtleSk7CiAgICAgICAgcGF0Y2hlcy5wdXNoKG9wID09PSBSRU1PVkUgPyB7CiAgICAgICAgICBvcDogb3AsCiAgICAgICAgICBwYXRoOiBwYXRoCiAgICAgICAgfSA6IHsKICAgICAgICAgIG9wOiBvcCwKICAgICAgICAgIHBhdGg6IHBhdGgsCiAgICAgICAgICB2YWx1ZTogdmFsdWUKICAgICAgICB9KTsKICAgICAgICBpbnZlcnNlUGF0Y2hlcy5wdXNoKG9wID09PSBBREQgPyB7CiAgICAgICAgICBvcDogUkVNT1ZFLAogICAgICAgICAgcGF0aDogcGF0aAogICAgICAgIH0gOiBvcCA9PT0gUkVNT1ZFID8gewogICAgICAgICAgb3A6IEFERCwKICAgICAgICAgIHBhdGg6IHBhdGgsCiAgICAgICAgICB2YWx1ZTogY2xvbmVQYXRjaFZhbHVlSWZOZWVkZWQob3JpZ1ZhbHVlKQogICAgICAgIH0gOiB7CiAgICAgICAgICBvcDogUkVQTEFDRSwKICAgICAgICAgIHBhdGg6IHBhdGgsCiAgICAgICAgICB2YWx1ZTogY2xvbmVQYXRjaFZhbHVlSWZOZWVkZWQob3JpZ1ZhbHVlKQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZW5lcmF0ZVNldFBhdGNoZXMoc3RhdGUsIGJhc2VQYXRoLCBwYXRjaGVzLCBpbnZlcnNlUGF0Y2hlcykgewogICAgICB2YXIgYmFzZV8gPSBzdGF0ZS5iYXNlXywKICAgICAgICAgIGNvcHlfID0gc3RhdGUuY29weV87CiAgICAgIHZhciBpID0gMDsKICAgICAgYmFzZV8uZm9yRWFjaChmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICBpZiAoIWNvcHlfLmhhcyh2YWx1ZSkpIHsKICAgICAgICAgIHZhciBwYXRoID0gYmFzZVBhdGguY29uY2F0KFtpXSk7CiAgICAgICAgICBwYXRjaGVzLnB1c2goewogICAgICAgICAgICBvcDogUkVNT1ZFLAogICAgICAgICAgICBwYXRoOiBwYXRoLAogICAgICAgICAgICB2YWx1ZTogdmFsdWUKICAgICAgICAgIH0pOwogICAgICAgICAgaW52ZXJzZVBhdGNoZXMudW5zaGlmdCh7CiAgICAgICAgICAgIG9wOiBBREQsCiAgICAgICAgICAgIHBhdGg6IHBhdGgsCiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpKys7CiAgICAgIH0pOwogICAgICBpID0gMDsKICAgICAgY29weV8uZm9yRWFjaChmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICBpZiAoIWJhc2VfLmhhcyh2YWx1ZSkpIHsKICAgICAgICAgIHZhciBwYXRoID0gYmFzZVBhdGguY29uY2F0KFtpXSk7CiAgICAgICAgICBwYXRjaGVzLnB1c2goewogICAgICAgICAgICBvcDogQURELAogICAgICAgICAgICBwYXRoOiBwYXRoLAogICAgICAgICAgICB2YWx1ZTogdmFsdWUKICAgICAgICAgIH0pOwogICAgICAgICAgaW52ZXJzZVBhdGNoZXMudW5zaGlmdCh7CiAgICAgICAgICAgIG9wOiBSRU1PVkUsCiAgICAgICAgICAgIHBhdGg6IHBhdGgsCiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpKys7CiAgICAgIH0pOwogICAgfQoKICAgIGZ1bmN0aW9uIGdlbmVyYXRlUmVwbGFjZW1lbnRQYXRjaGVzXyhyb290U3RhdGUsIHJlcGxhY2VtZW50LCBwYXRjaGVzLCBpbnZlcnNlUGF0Y2hlcykgewogICAgICBwYXRjaGVzLnB1c2goewogICAgICAgIG9wOiBSRVBMQUNFLAogICAgICAgIHBhdGg6IFtdLAogICAgICAgIHZhbHVlOiByZXBsYWNlbWVudCA9PT0gTk9USElORyA/IHVuZGVmaW5lZCA6IHJlcGxhY2VtZW50CiAgICAgIH0pOwogICAgICBpbnZlcnNlUGF0Y2hlcy5wdXNoKHsKICAgICAgICBvcDogUkVQTEFDRSwKICAgICAgICBwYXRoOiBbXSwKICAgICAgICB2YWx1ZTogcm9vdFN0YXRlLmJhc2VfCiAgICAgIH0pOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcGx5UGF0Y2hlc18oZHJhZnQsIHBhdGNoZXMpIHsKICAgICAgcGF0Y2hlcy5mb3JFYWNoKGZ1bmN0aW9uIChwYXRjaCkgewogICAgICAgIHZhciBwYXRoID0gcGF0Y2gucGF0aCwKICAgICAgICAgICAgb3AgPSBwYXRjaC5vcDsKICAgICAgICB2YXIgYmFzZSA9IGRyYWZ0OwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhdGgubGVuZ3RoIC0gMTsgaSsrKSB7CiAgICAgICAgICB2YXIgcGFyZW50VHlwZSA9IGdldEFyY2h0eXBlKGJhc2UpOwogICAgICAgICAgdmFyIHAgPSAiIiArIHBhdGhbaV07IC8vIFNlZSAjNzM4LCBhdm9pZCBwcm90b3R5cGUgcG9sbHV0aW9uCgogICAgICAgICAgaWYgKChwYXJlbnRUeXBlID09PSAwCiAgICAgICAgICAvKiBPYmplY3QgKi8KICAgICAgICAgIHx8IHBhcmVudFR5cGUgPT09IDEKICAgICAgICAgIC8qIEFycmF5ICovCiAgICAgICAgICApICYmIChwID09PSAiX19wcm90b19fIiB8fCBwID09PSAiY29uc3RydWN0b3IiKSkgZGllKDI0KTsKICAgICAgICAgIGlmICh0eXBlb2YgYmFzZSA9PT0gImZ1bmN0aW9uIiAmJiBwID09PSAicHJvdG90eXBlIikgZGllKDI0KTsKICAgICAgICAgIGJhc2UgPSBnZXQoYmFzZSwgcCk7CiAgICAgICAgICBpZiAodHlwZW9mIGJhc2UgIT09ICJvYmplY3QiKSBkaWUoMTUsIHBhdGguam9pbigiLyIpKTsKICAgICAgICB9CgogICAgICAgIHZhciB0eXBlID0gZ2V0QXJjaHR5cGUoYmFzZSk7CiAgICAgICAgdmFyIHZhbHVlID0gZGVlcENsb25lUGF0Y2hWYWx1ZShwYXRjaC52YWx1ZSk7IC8vIHVzZWQgdG8gY2xvbmUgcGF0Y2ggdG8gZW5zdXJlIG9yaWdpbmFsIHBhdGNoIGlzIG5vdCBtb2RpZmllZCwgc2VlICM0MTEKCiAgICAgICAgdmFyIGtleSA9IHBhdGhbcGF0aC5sZW5ndGggLSAxXTsKCiAgICAgICAgc3dpdGNoIChvcCkgewogICAgICAgICAgY2FzZSBSRVBMQUNFOgogICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgICBjYXNlIDIKICAgICAgICAgICAgICAvKiBNYXAgKi8KICAgICAgICAgICAgICA6CiAgICAgICAgICAgICAgICByZXR1cm4gYmFzZS5zZXQoa2V5LCB2YWx1ZSk7CgogICAgICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCgogICAgICAgICAgICAgIGNhc2UgMwogICAgICAgICAgICAgIC8qIFNldCAqLwogICAgICAgICAgICAgIDoKICAgICAgICAgICAgICAgIGRpZSgxNik7CgogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAvLyBpZiB2YWx1ZSBpcyBhbiBvYmplY3QsIHRoZW4gaXQncyBhc3NpZ25lZCBieSByZWZlcmVuY2UKICAgICAgICAgICAgICAgIC8vIGluIHRoZSBmb2xsb3dpbmcgYWRkIG9yIHJlbW92ZSBvcHMsIHRoZSB2YWx1ZSBmaWVsZCBpbnNpZGUgdGhlIHBhdGNoIHdpbGwgYWxzbyBiZSBtb2RpZnllZAogICAgICAgICAgICAgICAgLy8gc28gd2UgdXNlIHZhbHVlIGZyb20gdGhlIGNsb25lZCBwYXRjaAogICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZQogICAgICAgICAgICAgICAgcmV0dXJuIGJhc2Vba2V5XSA9IHZhbHVlOwogICAgICAgICAgICB9CgogICAgICAgICAgY2FzZSBBREQ6CiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgICAgIGNhc2UgMQogICAgICAgICAgICAgIC8qIEFycmF5ICovCiAgICAgICAgICAgICAgOgogICAgICAgICAgICAgICAgcmV0dXJuIGtleSA9PT0gIi0iID8gYmFzZS5wdXNoKHZhbHVlKSA6IGJhc2Uuc3BsaWNlKGtleSwgMCwgdmFsdWUpOwoKICAgICAgICAgICAgICBjYXNlIDIKICAgICAgICAgICAgICAvKiBNYXAgKi8KICAgICAgICAgICAgICA6CiAgICAgICAgICAgICAgICByZXR1cm4gYmFzZS5zZXQoa2V5LCB2YWx1ZSk7CgogICAgICAgICAgICAgIGNhc2UgMwogICAgICAgICAgICAgIC8qIFNldCAqLwogICAgICAgICAgICAgIDoKICAgICAgICAgICAgICAgIHJldHVybiBiYXNlLmFkZCh2YWx1ZSk7CgogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gYmFzZVtrZXldID0gdmFsdWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICBjYXNlIFJFTU9WRToKICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICAgICAgY2FzZSAxCiAgICAgICAgICAgICAgLyogQXJyYXkgKi8KICAgICAgICAgICAgICA6CiAgICAgICAgICAgICAgICByZXR1cm4gYmFzZS5zcGxpY2Uoa2V5LCAxKTsKCiAgICAgICAgICAgICAgY2FzZSAyCiAgICAgICAgICAgICAgLyogTWFwICovCiAgICAgICAgICAgICAgOgogICAgICAgICAgICAgICAgcmV0dXJuIGJhc2UuZGVsZXRlKGtleSk7CgogICAgICAgICAgICAgIGNhc2UgMwogICAgICAgICAgICAgIC8qIFNldCAqLwogICAgICAgICAgICAgIDoKICAgICAgICAgICAgICAgIHJldHVybiBiYXNlLmRlbGV0ZShwYXRjaC52YWx1ZSk7CgogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gZGVsZXRlIGJhc2Vba2V5XTsKICAgICAgICAgICAgfQoKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGRpZSgxNywgb3ApOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybiBkcmFmdDsKICAgIH0KCiAgICBmdW5jdGlvbiBkZWVwQ2xvbmVQYXRjaFZhbHVlKG9iaikgewogICAgICBpZiAoIWlzRHJhZnRhYmxlKG9iaikpIHJldHVybiBvYmo7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHJldHVybiBvYmoubWFwKGRlZXBDbG9uZVBhdGNoVmFsdWUpOwogICAgICBpZiAoaXNNYXAob2JqKSkgcmV0dXJuIG5ldyBNYXAoQXJyYXkuZnJvbShvYmouZW50cmllcygpKS5tYXAoZnVuY3Rpb24gKF9yZWYzKSB7CiAgICAgICAgdmFyIGsgPSBfcmVmM1swXSwKICAgICAgICAgICAgdiA9IF9yZWYzWzFdOwogICAgICAgIHJldHVybiBbaywgZGVlcENsb25lUGF0Y2hWYWx1ZSh2KV07CiAgICAgIH0pKTsKICAgICAgaWYgKGlzU2V0KG9iaikpIHJldHVybiBuZXcgU2V0KEFycmF5LmZyb20ob2JqKS5tYXAoZGVlcENsb25lUGF0Y2hWYWx1ZSkpOwogICAgICB2YXIgY2xvbmVkID0gT2JqZWN0LmNyZWF0ZShPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqKSk7CgogICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgICAgY2xvbmVkW2tleV0gPSBkZWVwQ2xvbmVQYXRjaFZhbHVlKG9ialtrZXldKTsKICAgICAgfQoKICAgICAgaWYgKGhhcyhvYmosIERSQUZUQUJMRSkpIGNsb25lZFtEUkFGVEFCTEVdID0gb2JqW0RSQUZUQUJMRV07CiAgICAgIHJldHVybiBjbG9uZWQ7CiAgICB9CgogICAgZnVuY3Rpb24gY2xvbmVQYXRjaFZhbHVlSWZOZWVkZWQob2JqKSB7CiAgICAgIGlmIChpc0RyYWZ0KG9iaikpIHsKICAgICAgICByZXR1cm4gZGVlcENsb25lUGF0Y2hWYWx1ZShvYmopOwogICAgICB9IGVsc2UgcmV0dXJuIG9iajsKICAgIH0KCiAgICBsb2FkUGx1Z2luKCJQYXRjaGVzIiwgewogICAgICBhcHBseVBhdGNoZXNfOiBhcHBseVBhdGNoZXNfLAogICAgICBnZW5lcmF0ZVBhdGNoZXNfOiBnZW5lcmF0ZVBhdGNoZXNfLAogICAgICBnZW5lcmF0ZVJlcGxhY2VtZW50UGF0Y2hlc186IGdlbmVyYXRlUmVwbGFjZW1lbnRQYXRjaGVzXwogICAgfSk7CiAgfQoKICAvLyB0eXBlcyBvbmx5IQogIGZ1bmN0aW9uIGVuYWJsZU1hcFNldCgpIHsKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICB2YXIgX2V4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiBleHRlbmRTdGF0aWNzKGQsIGIpIHsKICAgICAgX2V4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgewogICAgICAgIF9fcHJvdG9fXzogW10KICAgICAgfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7CiAgICAgICAgZC5fX3Byb3RvX18gPSBiOwogICAgICB9IHx8IGZ1bmN0aW9uIChkLCBiKSB7CiAgICAgICAgZm9yICh2YXIgcCBpbiBiKSB7CiAgICAgICAgICBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07CiAgICAgICAgfQogICAgICB9OwoKICAgICAgcmV0dXJuIF9leHRlbmRTdGF0aWNzKGQsIGIpOwogICAgfTsgLy8gVWdseSBoYWNrIHRvIHJlc29sdmUgIzUwMiBhbmQgaW5oZXJpdCBidWlsdCBpbiBNYXAgLyBTZXQKCgogICAgZnVuY3Rpb24gX19leHRlbmRzKGQsIGIpIHsKICAgICAgX2V4dGVuZFN0YXRpY3MoZCwgYik7CgogICAgICBmdW5jdGlvbiBfXygpIHsKICAgICAgICB0aGlzLmNvbnN0cnVjdG9yID0gZDsKICAgICAgfQoKICAgICAgZC5wcm90b3R5cGUgPSAoIC8vIEB0cy1pZ25vcmUKICAgICAgX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKICAgIH0KCiAgICB2YXIgRHJhZnRNYXAgPSBmdW5jdGlvbiAoX3N1cGVyKSB7CiAgICAgIF9fZXh0ZW5kcyhEcmFmdE1hcCwgX3N1cGVyKTsgLy8gQ3JlYXRlIGNsYXNzIG1hbnVhbGx5LCBjYXVzZSAjNTAyCgoKICAgICAgZnVuY3Rpb24gRHJhZnRNYXAodGFyZ2V0LCBwYXJlbnQpIHsKICAgICAgICB0aGlzW0RSQUZUX1NUQVRFXSA9IHsKICAgICAgICAgIHR5cGVfOiAyCiAgICAgICAgICAvKiBNYXAgKi8KICAgICAgICAgICwKICAgICAgICAgIHBhcmVudF86IHBhcmVudCwKICAgICAgICAgIHNjb3BlXzogcGFyZW50ID8gcGFyZW50LnNjb3BlXyA6IGdldEN1cnJlbnRTY29wZSgpLAogICAgICAgICAgbW9kaWZpZWRfOiBmYWxzZSwKICAgICAgICAgIGZpbmFsaXplZF86IGZhbHNlLAogICAgICAgICAgY29weV86IHVuZGVmaW5lZCwKICAgICAgICAgIGFzc2lnbmVkXzogdW5kZWZpbmVkLAogICAgICAgICAgYmFzZV86IHRhcmdldCwKICAgICAgICAgIGRyYWZ0XzogdGhpcywKICAgICAgICAgIGlzTWFudWFsXzogZmFsc2UsCiAgICAgICAgICByZXZva2VkXzogZmFsc2UKICAgICAgICB9OwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CgogICAgICB2YXIgcCA9IERyYWZ0TWFwLnByb3RvdHlwZTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHAsICJzaXplIiwgewogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIGxhdGVzdCh0aGlzW0RSQUZUX1NUQVRFXSkuc2l6ZTsKICAgICAgICB9IC8vIGVudW1lcmFibGU6IGZhbHNlLAogICAgICAgIC8vIGNvbmZpZ3VyYWJsZTogdHJ1ZQoKICAgICAgfSk7CgogICAgICBwLmhhcyA9IGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICByZXR1cm4gbGF0ZXN0KHRoaXNbRFJBRlRfU1RBVEVdKS5oYXMoa2V5KTsKICAgICAgfTsKCiAgICAgIHAuc2V0ID0gZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgICAgICB2YXIgc3RhdGUgPSB0aGlzW0RSQUZUX1NUQVRFXTsKICAgICAgICBhc3NlcnRVbnJldm9rZWQoc3RhdGUpOwoKICAgICAgICBpZiAoIWxhdGVzdChzdGF0ZSkuaGFzKGtleSkgfHwgbGF0ZXN0KHN0YXRlKS5nZXQoa2V5KSAhPT0gdmFsdWUpIHsKICAgICAgICAgIHByZXBhcmVNYXBDb3B5KHN0YXRlKTsKICAgICAgICAgIG1hcmtDaGFuZ2VkKHN0YXRlKTsKICAgICAgICAgIHN0YXRlLmFzc2lnbmVkXy5zZXQoa2V5LCB0cnVlKTsKICAgICAgICAgIHN0YXRlLmNvcHlfLnNldChrZXksIHZhbHVlKTsKICAgICAgICAgIHN0YXRlLmFzc2lnbmVkXy5zZXQoa2V5LCB0cnVlKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9OwoKICAgICAgcC5kZWxldGUgPSBmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgaWYgKCF0aGlzLmhhcyhrZXkpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICB2YXIgc3RhdGUgPSB0aGlzW0RSQUZUX1NUQVRFXTsKICAgICAgICBhc3NlcnRVbnJldm9rZWQoc3RhdGUpOwogICAgICAgIHByZXBhcmVNYXBDb3B5KHN0YXRlKTsKICAgICAgICBtYXJrQ2hhbmdlZChzdGF0ZSk7CiAgICAgICAgc3RhdGUuYXNzaWduZWRfLnNldChrZXksIGZhbHNlKTsKICAgICAgICBzdGF0ZS5jb3B5Xy5kZWxldGUoa2V5KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfTsKCiAgICAgIHAuY2xlYXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHN0YXRlID0gdGhpc1tEUkFGVF9TVEFURV07CiAgICAgICAgYXNzZXJ0VW5yZXZva2VkKHN0YXRlKTsKCiAgICAgICAgaWYgKGxhdGVzdChzdGF0ZSkuc2l6ZSkgewogICAgICAgICAgcHJlcGFyZU1hcENvcHkoc3RhdGUpOwogICAgICAgICAgbWFya0NoYW5nZWQoc3RhdGUpOwogICAgICAgICAgc3RhdGUuYXNzaWduZWRfID0gbmV3IE1hcCgpOwogICAgICAgICAgZWFjaCQxKHN0YXRlLmJhc2VfLCBmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgIHN0YXRlLmFzc2lnbmVkXy5zZXQoa2V5LCBmYWxzZSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHN0YXRlLmNvcHlfLmNsZWFyKCk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgcC5mb3JFYWNoID0gZnVuY3Rpb24gKGNiLCB0aGlzQXJnKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgdmFyIHN0YXRlID0gdGhpc1tEUkFGVF9TVEFURV07CiAgICAgICAgbGF0ZXN0KHN0YXRlKS5mb3JFYWNoKGZ1bmN0aW9uIChfdmFsdWUsIGtleSwgX21hcCkgewogICAgICAgICAgY2IuY2FsbCh0aGlzQXJnLCBfdGhpcy5nZXQoa2V5KSwga2V5LCBfdGhpcyk7CiAgICAgICAgfSk7CiAgICAgIH07CgogICAgICBwLmdldCA9IGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICB2YXIgc3RhdGUgPSB0aGlzW0RSQUZUX1NUQVRFXTsKICAgICAgICBhc3NlcnRVbnJldm9rZWQoc3RhdGUpOwogICAgICAgIHZhciB2YWx1ZSA9IGxhdGVzdChzdGF0ZSkuZ2V0KGtleSk7CgogICAgICAgIGlmIChzdGF0ZS5maW5hbGl6ZWRfIHx8ICFpc0RyYWZ0YWJsZSh2YWx1ZSkpIHsKICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICB9CgogICAgICAgIGlmICh2YWx1ZSAhPT0gc3RhdGUuYmFzZV8uZ2V0KGtleSkpIHsKICAgICAgICAgIHJldHVybiB2YWx1ZTsgLy8gZWl0aGVyIGFscmVhZHkgZHJhZnRlZCBvciByZWFzc2lnbmVkCiAgICAgICAgfSAvLyBkZXNwaXRlIHdoYXQgaXQgbG9va3MsIHRoaXMgY3JlYXRlcyBhIGRyYWZ0IG9ubHkgb25jZSwgc2VlIGFib3ZlIGNvbmRpdGlvbgoKCiAgICAgICAgdmFyIGRyYWZ0ID0gY3JlYXRlUHJveHkoc3RhdGUuc2NvcGVfLmltbWVyXywgdmFsdWUsIHN0YXRlKTsKICAgICAgICBwcmVwYXJlTWFwQ29weShzdGF0ZSk7CiAgICAgICAgc3RhdGUuY29weV8uc2V0KGtleSwgZHJhZnQpOwogICAgICAgIHJldHVybiBkcmFmdDsKICAgICAgfTsKCiAgICAgIHAua2V5cyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gbGF0ZXN0KHRoaXNbRFJBRlRfU1RBVEVdKS5rZXlzKCk7CiAgICAgIH07CgogICAgICBwLnZhbHVlcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgX3RoaXMyID0gdGhpcywKICAgICAgICAgICAgX3JlZjsKCiAgICAgICAgdmFyIGl0ZXJhdG9yID0gdGhpcy5rZXlzKCk7CiAgICAgICAgcmV0dXJuIF9yZWYgPSB7fSwgX3JlZltpdGVyYXRvclN5bWJvbCQxXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBfdGhpczIudmFsdWVzKCk7CiAgICAgICAgfSwgX3JlZi5uZXh0ID0gZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgICAgIHZhciByID0gaXRlcmF0b3IubmV4dCgpOwogICAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KCiAgICAgICAgICBpZiAoci5kb25lKSByZXR1cm4gcjsKCiAgICAgICAgICB2YXIgdmFsdWUgPSBfdGhpczIuZ2V0KHIudmFsdWUpOwoKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGRvbmU6IGZhbHNlLAogICAgICAgICAgICB2YWx1ZTogdmFsdWUKICAgICAgICAgIH07CiAgICAgICAgfSwgX3JlZjsKICAgICAgfTsKCiAgICAgIHAuZW50cmllcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgX3RoaXMzID0gdGhpcywKICAgICAgICAgICAgX3JlZjI7CgogICAgICAgIHZhciBpdGVyYXRvciA9IHRoaXMua2V5cygpOwogICAgICAgIHJldHVybiBfcmVmMiA9IHt9LCBfcmVmMltpdGVyYXRvclN5bWJvbCQxXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBfdGhpczMuZW50cmllcygpOwogICAgICAgIH0sIF9yZWYyLm5leHQgPSBmdW5jdGlvbiBuZXh0KCkgewogICAgICAgICAgdmFyIHIgPSBpdGVyYXRvci5uZXh0KCk7CiAgICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwoKICAgICAgICAgIGlmIChyLmRvbmUpIHJldHVybiByOwoKICAgICAgICAgIHZhciB2YWx1ZSA9IF90aGlzMy5nZXQoci52YWx1ZSk7CgogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgZG9uZTogZmFsc2UsCiAgICAgICAgICAgIHZhbHVlOiBbci52YWx1ZSwgdmFsdWVdCiAgICAgICAgICB9OwogICAgICAgIH0sIF9yZWYyOwogICAgICB9OwoKICAgICAgcFtpdGVyYXRvclN5bWJvbCQxXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcy5lbnRyaWVzKCk7CiAgICAgIH07CgogICAgICByZXR1cm4gRHJhZnRNYXA7CiAgICB9KE1hcCk7CgogICAgZnVuY3Rpb24gcHJveHlNYXBfKHRhcmdldCwgcGFyZW50KSB7CiAgICAgIC8vIEB0cy1pZ25vcmUKICAgICAgcmV0dXJuIG5ldyBEcmFmdE1hcCh0YXJnZXQsIHBhcmVudCk7CiAgICB9CgogICAgZnVuY3Rpb24gcHJlcGFyZU1hcENvcHkoc3RhdGUpIHsKICAgICAgaWYgKCFzdGF0ZS5jb3B5XykgewogICAgICAgIHN0YXRlLmFzc2lnbmVkXyA9IG5ldyBNYXAoKTsKICAgICAgICBzdGF0ZS5jb3B5XyA9IG5ldyBNYXAoc3RhdGUuYmFzZV8pOwogICAgICB9CiAgICB9CgogICAgdmFyIERyYWZ0U2V0ID0gZnVuY3Rpb24gKF9zdXBlcikgewogICAgICBfX2V4dGVuZHMoRHJhZnRTZXQsIF9zdXBlcik7IC8vIENyZWF0ZSBjbGFzcyBtYW51YWxseSwgY2F1c2UgIzUwMgoKCiAgICAgIGZ1bmN0aW9uIERyYWZ0U2V0KHRhcmdldCwgcGFyZW50KSB7CiAgICAgICAgdGhpc1tEUkFGVF9TVEFURV0gPSB7CiAgICAgICAgICB0eXBlXzogMwogICAgICAgICAgLyogU2V0ICovCiAgICAgICAgICAsCiAgICAgICAgICBwYXJlbnRfOiBwYXJlbnQsCiAgICAgICAgICBzY29wZV86IHBhcmVudCA/IHBhcmVudC5zY29wZV8gOiBnZXRDdXJyZW50U2NvcGUoKSwKICAgICAgICAgIG1vZGlmaWVkXzogZmFsc2UsCiAgICAgICAgICBmaW5hbGl6ZWRfOiBmYWxzZSwKICAgICAgICAgIGNvcHlfOiB1bmRlZmluZWQsCiAgICAgICAgICBiYXNlXzogdGFyZ2V0LAogICAgICAgICAgZHJhZnRfOiB0aGlzLAogICAgICAgICAgZHJhZnRzXzogbmV3IE1hcCgpLAogICAgICAgICAgcmV2b2tlZF86IGZhbHNlLAogICAgICAgICAgaXNNYW51YWxfOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIHZhciBwID0gRHJhZnRTZXQucHJvdG90eXBlOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocCwgInNpemUiLCB7CiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gbGF0ZXN0KHRoaXNbRFJBRlRfU1RBVEVdKS5zaXplOwogICAgICAgIH0gLy8gZW51bWVyYWJsZTogdHJ1ZSwKCiAgICAgIH0pOwoKICAgICAgcC5oYXMgPSBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICB2YXIgc3RhdGUgPSB0aGlzW0RSQUZUX1NUQVRFXTsKICAgICAgICBhc3NlcnRVbnJldm9rZWQoc3RhdGUpOyAvLyBiaXQgb2YgdHJpY2tlcnkgaGVyZSwgdG8gYmUgYWJsZSB0byByZWNvZ25pemUgYm90aCB0aGUgdmFsdWUsIGFuZCB0aGUgZHJhZnQgb2YgaXRzIHZhbHVlCgogICAgICAgIGlmICghc3RhdGUuY29weV8pIHsKICAgICAgICAgIHJldHVybiBzdGF0ZS5iYXNlXy5oYXModmFsdWUpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHN0YXRlLmNvcHlfLmhhcyh2YWx1ZSkpIHJldHVybiB0cnVlOwogICAgICAgIGlmIChzdGF0ZS5kcmFmdHNfLmhhcyh2YWx1ZSkgJiYgc3RhdGUuY29weV8uaGFzKHN0YXRlLmRyYWZ0c18uZ2V0KHZhbHVlKSkpIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfTsKCiAgICAgIHAuYWRkID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgdmFyIHN0YXRlID0gdGhpc1tEUkFGVF9TVEFURV07CiAgICAgICAgYXNzZXJ0VW5yZXZva2VkKHN0YXRlKTsKCiAgICAgICAgaWYgKCF0aGlzLmhhcyh2YWx1ZSkpIHsKICAgICAgICAgIHByZXBhcmVTZXRDb3B5KHN0YXRlKTsKICAgICAgICAgIG1hcmtDaGFuZ2VkKHN0YXRlKTsKICAgICAgICAgIHN0YXRlLmNvcHlfLmFkZCh2YWx1ZSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfTsKCiAgICAgIHAuZGVsZXRlID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgaWYgKCF0aGlzLmhhcyh2YWx1ZSkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHZhciBzdGF0ZSA9IHRoaXNbRFJBRlRfU1RBVEVdOwogICAgICAgIGFzc2VydFVucmV2b2tlZChzdGF0ZSk7CiAgICAgICAgcHJlcGFyZVNldENvcHkoc3RhdGUpOwogICAgICAgIG1hcmtDaGFuZ2VkKHN0YXRlKTsKICAgICAgICByZXR1cm4gc3RhdGUuY29weV8uZGVsZXRlKHZhbHVlKSB8fCAoc3RhdGUuZHJhZnRzXy5oYXModmFsdWUpID8gc3RhdGUuY29weV8uZGVsZXRlKHN0YXRlLmRyYWZ0c18uZ2V0KHZhbHVlKSkgOgogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICAgICAgZmFsc2UpOwogICAgICB9OwoKICAgICAgcC5jbGVhciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgc3RhdGUgPSB0aGlzW0RSQUZUX1NUQVRFXTsKICAgICAgICBhc3NlcnRVbnJldm9rZWQoc3RhdGUpOwoKICAgICAgICBpZiAobGF0ZXN0KHN0YXRlKS5zaXplKSB7CiAgICAgICAgICBwcmVwYXJlU2V0Q29weShzdGF0ZSk7CiAgICAgICAgICBtYXJrQ2hhbmdlZChzdGF0ZSk7CiAgICAgICAgICBzdGF0ZS5jb3B5Xy5jbGVhcigpOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIHAudmFsdWVzID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBzdGF0ZSA9IHRoaXNbRFJBRlRfU1RBVEVdOwogICAgICAgIGFzc2VydFVucmV2b2tlZChzdGF0ZSk7CiAgICAgICAgcHJlcGFyZVNldENvcHkoc3RhdGUpOwogICAgICAgIHJldHVybiBzdGF0ZS5jb3B5Xy52YWx1ZXMoKTsKICAgICAgfTsKCiAgICAgIHAuZW50cmllcyA9IGZ1bmN0aW9uIGVudHJpZXMoKSB7CiAgICAgICAgdmFyIHN0YXRlID0gdGhpc1tEUkFGVF9TVEFURV07CiAgICAgICAgYXNzZXJ0VW5yZXZva2VkKHN0YXRlKTsKICAgICAgICBwcmVwYXJlU2V0Q29weShzdGF0ZSk7CiAgICAgICAgcmV0dXJuIHN0YXRlLmNvcHlfLmVudHJpZXMoKTsKICAgICAgfTsKCiAgICAgIHAua2V5cyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcy52YWx1ZXMoKTsKICAgICAgfTsKCiAgICAgIHBbaXRlcmF0b3JTeW1ib2wkMV0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudmFsdWVzKCk7CiAgICAgIH07CgogICAgICBwLmZvckVhY2ggPSBmdW5jdGlvbiBmb3JFYWNoKGNiLCB0aGlzQXJnKSB7CiAgICAgICAgdmFyIGl0ZXJhdG9yID0gdGhpcy52YWx1ZXMoKTsKICAgICAgICB2YXIgcmVzdWx0ID0gaXRlcmF0b3IubmV4dCgpOwoKICAgICAgICB3aGlsZSAoIXJlc3VsdC5kb25lKSB7CiAgICAgICAgICBjYi5jYWxsKHRoaXNBcmcsIHJlc3VsdC52YWx1ZSwgcmVzdWx0LnZhbHVlLCB0aGlzKTsKICAgICAgICAgIHJlc3VsdCA9IGl0ZXJhdG9yLm5leHQoKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICByZXR1cm4gRHJhZnRTZXQ7CiAgICB9KFNldCk7CgogICAgZnVuY3Rpb24gcHJveHlTZXRfKHRhcmdldCwgcGFyZW50KSB7CiAgICAgIC8vIEB0cy1pZ25vcmUKICAgICAgcmV0dXJuIG5ldyBEcmFmdFNldCh0YXJnZXQsIHBhcmVudCk7CiAgICB9CgogICAgZnVuY3Rpb24gcHJlcGFyZVNldENvcHkoc3RhdGUpIHsKICAgICAgaWYgKCFzdGF0ZS5jb3B5XykgewogICAgICAgIC8vIGNyZWF0ZSBkcmFmdHMgZm9yIGFsbCBlbnRyaWVzIHRvIHByZXNlcnZlIGluc2VydGlvbiBvcmRlcgogICAgICAgIHN0YXRlLmNvcHlfID0gbmV3IFNldCgpOwogICAgICAgIHN0YXRlLmJhc2VfLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICBpZiAoaXNEcmFmdGFibGUodmFsdWUpKSB7CiAgICAgICAgICAgIHZhciBkcmFmdCA9IGNyZWF0ZVByb3h5KHN0YXRlLnNjb3BlXy5pbW1lcl8sIHZhbHVlLCBzdGF0ZSk7CiAgICAgICAgICAgIHN0YXRlLmRyYWZ0c18uc2V0KHZhbHVlLCBkcmFmdCk7CiAgICAgICAgICAgIHN0YXRlLmNvcHlfLmFkZChkcmFmdCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdGF0ZS5jb3B5Xy5hZGQodmFsdWUpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gYXNzZXJ0VW5yZXZva2VkKHN0YXRlCiAgICAvKkVTNVN0YXRlIHwgTWFwU3RhdGUgfCBTZXRTdGF0ZSovCiAgICApIHsKICAgICAgaWYgKHN0YXRlLnJldm9rZWRfKSBkaWUoMywgSlNPTi5zdHJpbmdpZnkobGF0ZXN0KHN0YXRlKSkpOwogICAgfQoKICAgIGxvYWRQbHVnaW4oIk1hcFNldCIsIHsKICAgICAgcHJveHlNYXBfOiBwcm94eU1hcF8sCiAgICAgIHByb3h5U2V0XzogcHJveHlTZXRfCiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGVuYWJsZUFsbFBsdWdpbnMoKSB7CiAgICBlbmFibGVFUzUoKTsKICAgIGVuYWJsZU1hcFNldCgpOwogICAgZW5hYmxlUGF0Y2hlcygpOwogIH0KCiAgdmFyIGltbWVyJDEgPQogIC8qI19fUFVSRV9fKi8KICBuZXcgSW1tZXIoKTsKICAvKioKICAgKiBUaGUgYHByb2R1Y2VgIGZ1bmN0aW9uIHRha2VzIGEgdmFsdWUgYW5kIGEgInJlY2lwZSBmdW5jdGlvbiIgKHdob3NlCiAgICogcmV0dXJuIHZhbHVlIG9mdGVuIGRlcGVuZHMgb24gdGhlIGJhc2Ugc3RhdGUpLiBUaGUgcmVjaXBlIGZ1bmN0aW9uIGlzCiAgICogZnJlZSB0byBtdXRhdGUgaXRzIGZpcnN0IGFyZ3VtZW50IGhvd2V2ZXIgaXQgd2FudHMuIEFsbCBtdXRhdGlvbnMgYXJlCiAgICogb25seSBldmVyIGFwcGxpZWQgdG8gYSBfX2NvcHlfXyBvZiB0aGUgYmFzZSBzdGF0ZS4KICAgKgogICAqIFBhc3Mgb25seSBhIGZ1bmN0aW9uIHRvIGNyZWF0ZSBhICJjdXJyaWVkIHByb2R1Y2VyIiB3aGljaCByZWxpZXZlcyB5b3UKICAgKiBmcm9tIHBhc3NpbmcgdGhlIHJlY2lwZSBmdW5jdGlvbiBldmVyeSB0aW1lLgogICAqCiAgICogT25seSBwbGFpbiBvYmplY3RzIGFuZCBhcnJheXMgYXJlIG1hZGUgbXV0YWJsZS4gQWxsIG90aGVyIG9iamVjdHMgYXJlCiAgICogY29uc2lkZXJlZCB1bmNvcHlhYmxlLgogICAqCiAgICogTm90ZTogVGhpcyBmdW5jdGlvbiBpcyBfX2JvdW5kX18gdG8gaXRzIGBJbW1lcmAgaW5zdGFuY2UuCiAgICoKICAgKiBAcGFyYW0ge2FueX0gYmFzZSAtIHRoZSBpbml0aWFsIHN0YXRlCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gcHJvZHVjZXIgLSBmdW5jdGlvbiB0aGF0IHJlY2VpdmVzIGEgcHJveHkgb2YgdGhlIGJhc2Ugc3RhdGUgYXMgZmlyc3QgYXJndW1lbnQgYW5kIHdoaWNoIGNhbiBiZSBmcmVlbHkgbW9kaWZpZWQKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBwYXRjaExpc3RlbmVyIC0gb3B0aW9uYWwgZnVuY3Rpb24gdGhhdCB3aWxsIGJlIGNhbGxlZCB3aXRoIGFsbCB0aGUgcGF0Y2hlcyBwcm9kdWNlZCBoZXJlCiAgICogQHJldHVybnMge2FueX0gYSBuZXcgc3RhdGUsIG9yIHRoZSBpbml0aWFsIHN0YXRlIGlmIG5vdGhpbmcgd2FzIG1vZGlmaWVkCiAgICovCgogIHZhciBwcm9kdWNlID0gaW1tZXIkMS5wcm9kdWNlOwogIC8qKgogICAqIExpa2UgYHByb2R1Y2VgLCBidXQgYHByb2R1Y2VXaXRoUGF0Y2hlc2AgYWx3YXlzIHJldHVybnMgYSB0dXBsZQogICAqIFtuZXh0U3RhdGUsIHBhdGNoZXMsIGludmVyc2VQYXRjaGVzXSAoaW5zdGVhZCBvZiBqdXN0IHRoZSBuZXh0IHN0YXRlKQogICAqLwoKICB2YXIgcHJvZHVjZVdpdGhQYXRjaGVzID0KICAvKiNfX1BVUkVfXyovCiAgaW1tZXIkMS5wcm9kdWNlV2l0aFBhdGNoZXMuYmluZChpbW1lciQxKTsKICAvKioKICAgKiBQYXNzIHRydWUgdG8gYXV0b21hdGljYWxseSBmcmVlemUgYWxsIGNvcGllcyBjcmVhdGVkIGJ5IEltbWVyLgogICAqCiAgICogQWx3YXlzIGZyZWV6ZSBieSBkZWZhdWx0LCBldmVuIGluIHByb2R1Y3Rpb24gbW9kZQogICAqLwoKICB2YXIgc2V0QXV0b0ZyZWV6ZSA9CiAgLyojX19QVVJFX18qLwogIGltbWVyJDEuc2V0QXV0b0ZyZWV6ZS5iaW5kKGltbWVyJDEpOwogIC8qKgogICAqIFBhc3MgdHJ1ZSB0byB1c2UgdGhlIEVTMjAxNSBgUHJveHlgIGNsYXNzIHdoZW4gY3JlYXRpbmcgZHJhZnRzLCB3aGljaCBpcwogICAqIGFsd2F5cyBmYXN0ZXIgdGhhbiB1c2luZyBFUzUgcHJveGllcy4KICAgKgogICAqIEJ5IGRlZmF1bHQsIGZlYXR1cmUgZGV0ZWN0aW9uIGlzIHVzZWQsIHNvIGNhbGxpbmcgdGhpcyBpcyByYXJlbHkgbmVjZXNzYXJ5LgogICAqLwoKICB2YXIgc2V0VXNlUHJveGllcyA9CiAgLyojX19QVVJFX18qLwogIGltbWVyJDEuc2V0VXNlUHJveGllcy5iaW5kKGltbWVyJDEpOwogIC8qKgogICAqIEFwcGx5IGFuIGFycmF5IG9mIEltbWVyIHBhdGNoZXMgdG8gdGhlIGZpcnN0IGFyZ3VtZW50LgogICAqCiAgICogVGhpcyBmdW5jdGlvbiBpcyBhIHByb2R1Y2VyLCB3aGljaCBtZWFucyBjb3B5LW9uLXdyaXRlIGlzIGluIGVmZmVjdC4KICAgKi8KCiAgdmFyIGFwcGx5UGF0Y2hlcyA9CiAgLyojX19QVVJFX18qLwogIGltbWVyJDEuYXBwbHlQYXRjaGVzLmJpbmQoaW1tZXIkMSk7CiAgLyoqCiAgICogQ3JlYXRlIGFuIEltbWVyIGRyYWZ0IGZyb20gdGhlIGdpdmVuIGJhc2Ugc3RhdGUsIHdoaWNoIG1heSBiZSBhIGRyYWZ0IGl0c2VsZi4KICAgKiBUaGUgZHJhZnQgY2FuIGJlIG1vZGlmaWVkIHVudGlsIHlvdSBmaW5hbGl6ZSBpdCB3aXRoIHRoZSBgZmluaXNoRHJhZnRgIGZ1bmN0aW9uLgogICAqLwoKICB2YXIgY3JlYXRlRHJhZnQgPQogIC8qI19fUFVSRV9fKi8KICBpbW1lciQxLmNyZWF0ZURyYWZ0LmJpbmQoaW1tZXIkMSk7CiAgLyoqCiAgICogRmluYWxpemUgYW4gSW1tZXIgZHJhZnQgZnJvbSBhIGBjcmVhdGVEcmFmdGAgY2FsbCwgcmV0dXJuaW5nIHRoZSBiYXNlIHN0YXRlCiAgICogKGlmIG5vIGNoYW5nZXMgd2VyZSBtYWRlKSBvciBhIG1vZGlmaWVkIGNvcHkuIFRoZSBkcmFmdCBtdXN0ICpub3QqIGJlCiAgICogbXV0YXRlZCBhZnRlcndhcmRzLgogICAqCiAgICogUGFzcyBhIGZ1bmN0aW9uIGFzIHRoZSAybmQgYXJndW1lbnQgdG8gZ2VuZXJhdGUgSW1tZXIgcGF0Y2hlcyBiYXNlZCBvbiB0aGUKICAgKiBjaGFuZ2VzIHRoYXQgd2VyZSBtYWRlLgogICAqLwoKICB2YXIgZmluaXNoRHJhZnQgPQogIC8qI19fUFVSRV9fKi8KICBpbW1lciQxLmZpbmlzaERyYWZ0LmJpbmQoaW1tZXIkMSk7CiAgLyoqCiAgICogVGhpcyBmdW5jdGlvbiBpcyBhY3R1YWxseSBhIG5vLW9wLCBidXQgY2FuIGJlIHVzZWQgdG8gY2FzdCBhbiBpbW11dGFibGUgdHlwZQogICAqIHRvIGFuIGRyYWZ0IHR5cGUgYW5kIG1ha2UgVHlwZVNjcmlwdCBoYXBweQogICAqCiAgICogQHBhcmFtIHZhbHVlCiAgICovCgogIGZ1bmN0aW9uIGNhc3REcmFmdCh2YWx1ZSkgewogICAgcmV0dXJuIHZhbHVlOwogIH0KICAvKioKICAgKiBUaGlzIGZ1bmN0aW9uIGlzIGFjdHVhbGx5IGEgbm8tb3AsIGJ1dCBjYW4gYmUgdXNlZCB0byBjYXN0IGEgbXV0YWJsZSB0eXBlCiAgICogdG8gYW4gaW1tdXRhYmxlIHR5cGUgYW5kIG1ha2UgVHlwZVNjcmlwdCBoYXBweQogICAqIEBwYXJhbSB2YWx1ZQogICAqLwoKICBmdW5jdGlvbiBjYXN0SW1tdXRhYmxlKHZhbHVlKSB7CiAgICByZXR1cm4gdmFsdWU7CiAgfQoKICB2YXIgSW1tZXJfMSA9IEltbWVyOwogIHZhciBhcHBseVBhdGNoZXNfMSA9IGFwcGx5UGF0Y2hlczsKICB2YXIgY2FzdERyYWZ0XzEgPSBjYXN0RHJhZnQ7CiAgdmFyIGNhc3RJbW11dGFibGVfMSA9IGNhc3RJbW11dGFibGU7CiAgdmFyIGNyZWF0ZURyYWZ0XzEgPSBjcmVhdGVEcmFmdDsKICB2YXIgY3VycmVudF8xID0gY3VycmVudDsKICB2YXIgX2RlZmF1bHQkMiA9IHByb2R1Y2U7CiAgdmFyIGVuYWJsZUFsbFBsdWdpbnNfMSA9IGVuYWJsZUFsbFBsdWdpbnM7CiAgdmFyIGVuYWJsZUVTNV8xID0gZW5hYmxlRVM1OwogIHZhciBlbmFibGVNYXBTZXRfMSA9IGVuYWJsZU1hcFNldDsKICB2YXIgZW5hYmxlUGF0Y2hlc18xID0gZW5hYmxlUGF0Y2hlczsKICB2YXIgZmluaXNoRHJhZnRfMSA9IGZpbmlzaERyYWZ0OwogIHZhciBmcmVlemVfMSA9IGZyZWV6ZTsKICB2YXIgaW1tZXJhYmxlID0gRFJBRlRBQkxFOwogIHZhciBpc0RyYWZ0XzEgPSBpc0RyYWZ0OwogIHZhciBpc0RyYWZ0YWJsZV8xID0gaXNEcmFmdGFibGU7CiAgdmFyIG5vdGhpbmcgPSBOT1RISU5HOwogIHZhciBvcmlnaW5hbF8xID0gb3JpZ2luYWw7CiAgdmFyIHByb2R1Y2VfMSA9IHByb2R1Y2U7CiAgdmFyIHByb2R1Y2VXaXRoUGF0Y2hlc18xID0gcHJvZHVjZVdpdGhQYXRjaGVzOwogIHZhciBzZXRBdXRvRnJlZXplXzEgPSBzZXRBdXRvRnJlZXplOwogIHZhciBzZXRVc2VQcm94aWVzXzEgPSBzZXRVc2VQcm94aWVzOwoKCiAgdmFyIGltbWVyX2Nqc19kZXZlbG9wbWVudCA9IC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogIAlJbW1lcjogSW1tZXJfMSwKICAJYXBwbHlQYXRjaGVzOiBhcHBseVBhdGNoZXNfMSwKICAJY2FzdERyYWZ0OiBjYXN0RHJhZnRfMSwKICAJY2FzdEltbXV0YWJsZTogY2FzdEltbXV0YWJsZV8xLAogIAljcmVhdGVEcmFmdDogY3JlYXRlRHJhZnRfMSwKICAJY3VycmVudDogY3VycmVudF8xLAogIAlkZWZhdWx0OiBfZGVmYXVsdCQyLAogIAllbmFibGVBbGxQbHVnaW5zOiBlbmFibGVBbGxQbHVnaW5zXzEsCiAgCWVuYWJsZUVTNTogZW5hYmxlRVM1XzEsCiAgCWVuYWJsZU1hcFNldDogZW5hYmxlTWFwU2V0XzEsCiAgCWVuYWJsZVBhdGNoZXM6IGVuYWJsZVBhdGNoZXNfMSwKICAJZmluaXNoRHJhZnQ6IGZpbmlzaERyYWZ0XzEsCiAgCWZyZWV6ZTogZnJlZXplXzEsCiAgCWltbWVyYWJsZTogaW1tZXJhYmxlLAogIAlpc0RyYWZ0OiBpc0RyYWZ0XzEsCiAgCWlzRHJhZnRhYmxlOiBpc0RyYWZ0YWJsZV8xLAogIAlub3RoaW5nOiBub3RoaW5nLAogIAlvcmlnaW5hbDogb3JpZ2luYWxfMSwKICAJcHJvZHVjZTogcHJvZHVjZV8xLAogIAlwcm9kdWNlV2l0aFBhdGNoZXM6IHByb2R1Y2VXaXRoUGF0Y2hlc18xLAogIAlzZXRBdXRvRnJlZXplOiBzZXRBdXRvRnJlZXplXzEsCiAgCXNldFVzZVByb3hpZXM6IHNldFVzZVByb3hpZXNfMQogIH0sICdfX2VzTW9kdWxlJywge3ZhbHVlOiB0cnVlfSk7CgogIHZhciByZXF1aXJlJCQxJDEgPSBpbW1lcl9janNfZGV2ZWxvcG1lbnQ7CgogIHZhciBkaXN0JDggPSBjcmVhdGVDb21tb25qc01vZHVsZSQxKGZ1bmN0aW9uIChtb2R1bGUpIHsKCiAgewogICAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlJCQxJDE7CiAgfQogIH0pOwoKICB2YXIgaXNQbGFpbk9iamVjdCA9IGlzUGxhaW5PYmplY3RfMTsKCiAgdmFyIGltbWVyID0gZGlzdCQ4OwoKICBmdW5jdGlvbiB1bndyYXBFeHBvcnRzICh4KSB7CiAgCXJldHVybiB4ICYmIHguX19lc01vZHVsZSAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoeCwgJ2RlZmF1bHQnKSA/IHhbJ2RlZmF1bHQnXSA6IHg7CiAgfQoKICBmdW5jdGlvbiBjcmVhdGVDb21tb25qc01vZHVsZShmbiwgbW9kdWxlKSB7CiAgCXJldHVybiBtb2R1bGUgPSB7IGV4cG9ydHM6IHt9IH0sIGZuKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMpLCBtb2R1bGUuZXhwb3J0czsKICB9CgogIHZhciBhcnJheUxpa2VUb0FycmF5ID0gY3JlYXRlQ29tbW9uanNNb2R1bGUoZnVuY3Rpb24gKG1vZHVsZSkgewogIGZ1bmN0aW9uIF9hcnJheUxpa2VUb0FycmF5KGFyciwgbGVuKSB7CiAgICBpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkgbGVuID0gYXJyLmxlbmd0aDsKCiAgICBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIHsKICAgICAgYXJyMltpXSA9IGFycltpXTsKICAgIH0KCiAgICByZXR1cm4gYXJyMjsKICB9CgogIG1vZHVsZS5leHBvcnRzID0gX2FycmF5TGlrZVRvQXJyYXk7CiAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICB9KTsKCiAgdW53cmFwRXhwb3J0cyhhcnJheUxpa2VUb0FycmF5KTsKCiAgdmFyIGFycmF5V2l0aG91dEhvbGVzID0gY3JlYXRlQ29tbW9uanNNb2R1bGUoZnVuY3Rpb24gKG1vZHVsZSkgewogIGZ1bmN0aW9uIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHsKICAgIGlmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnJheUxpa2VUb0FycmF5KGFycik7CiAgfQoKICBtb2R1bGUuZXhwb3J0cyA9IF9hcnJheVdpdGhvdXRIb2xlczsKICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogIH0pOwoKICB1bndyYXBFeHBvcnRzKGFycmF5V2l0aG91dEhvbGVzKTsKCiAgdmFyIGl0ZXJhYmxlVG9BcnJheSA9IGNyZWF0ZUNvbW1vbmpzTW9kdWxlKGZ1bmN0aW9uIChtb2R1bGUpIHsKICBmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5KGl0ZXIpIHsKICAgIGlmICh0eXBlb2YgU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBpdGVyW1N5bWJvbC5pdGVyYXRvcl0gIT0gbnVsbCB8fCBpdGVyWyJAQGl0ZXJhdG9yIl0gIT0gbnVsbCkgcmV0dXJuIEFycmF5LmZyb20oaXRlcik7CiAgfQoKICBtb2R1bGUuZXhwb3J0cyA9IF9pdGVyYWJsZVRvQXJyYXk7CiAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICB9KTsKCiAgdW53cmFwRXhwb3J0cyhpdGVyYWJsZVRvQXJyYXkpOwoKICB2YXIgdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkgPSBjcmVhdGVDb21tb25qc01vZHVsZShmdW5jdGlvbiAobW9kdWxlKSB7CiAgZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikgewogICAgaWYgKCFvKSByZXR1cm47CiAgICBpZiAodHlwZW9mIG8gPT09ICJzdHJpbmciKSByZXR1cm4gYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pOwogICAgdmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpOwogICAgaWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7CiAgICBpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pOwogICAgaWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pOwogIH0KCiAgbW9kdWxlLmV4cG9ydHMgPSBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXk7CiAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICB9KTsKCiAgdW53cmFwRXhwb3J0cyh1bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheSk7CgogIHZhciBub25JdGVyYWJsZVNwcmVhZCA9IGNyZWF0ZUNvbW1vbmpzTW9kdWxlKGZ1bmN0aW9uIChtb2R1bGUpIHsKICBmdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTsKICB9CgogIG1vZHVsZS5leHBvcnRzID0gX25vbkl0ZXJhYmxlU3ByZWFkOwogIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgfSk7CgogIHVud3JhcEV4cG9ydHMobm9uSXRlcmFibGVTcHJlYWQpOwoKICB2YXIgdG9Db25zdW1hYmxlQXJyYXkgPSBjcmVhdGVDb21tb25qc01vZHVsZShmdW5jdGlvbiAobW9kdWxlKSB7CiAgZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgewogICAgcmV0dXJuIGFycmF5V2l0aG91dEhvbGVzKGFycikgfHwgaXRlcmFibGVUb0FycmF5KGFycikgfHwgdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBub25JdGVyYWJsZVNwcmVhZCgpOwogIH0KCiAgbW9kdWxlLmV4cG9ydHMgPSBfdG9Db25zdW1hYmxlQXJyYXk7CiAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICB9KTsKCiAgdmFyIF90b0NvbnN1bWFibGVBcnJheSA9IHVud3JhcEV4cG9ydHModG9Db25zdW1hYmxlQXJyYXkpOwoKICB2YXIgYXJyYXlXaXRoSG9sZXMgPSBjcmVhdGVDb21tb25qc01vZHVsZShmdW5jdGlvbiAobW9kdWxlKSB7CiAgZnVuY3Rpb24gX2FycmF5V2l0aEhvbGVzKGFycikgewogICAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjsKICB9CgogIG1vZHVsZS5leHBvcnRzID0gX2FycmF5V2l0aEhvbGVzOwogIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgfSk7CgogIHVud3JhcEV4cG9ydHMoYXJyYXlXaXRoSG9sZXMpOwoKICB2YXIgaXRlcmFibGVUb0FycmF5TGltaXQgPSBjcmVhdGVDb21tb25qc01vZHVsZShmdW5jdGlvbiAobW9kdWxlKSB7CiAgZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgewogICAgdmFyIF9pID0gYXJyID09IG51bGwgPyBudWxsIDogdHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgYXJyW1N5bWJvbC5pdGVyYXRvcl0gfHwgYXJyWyJAQGl0ZXJhdG9yIl07CgogICAgaWYgKF9pID09IG51bGwpIHJldHVybjsKICAgIHZhciBfYXJyID0gW107CiAgICB2YXIgX24gPSB0cnVlOwogICAgdmFyIF9kID0gZmFsc2U7CgogICAgdmFyIF9zLCBfZTsKCiAgICB0cnkgewogICAgICBmb3IgKF9pID0gX2kuY2FsbChhcnIpOyAhKF9uID0gKF9zID0gX2kubmV4dCgpKS5kb25lKTsgX24gPSB0cnVlKSB7CiAgICAgICAgX2Fyci5wdXNoKF9zLnZhbHVlKTsKCiAgICAgICAgaWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrOwogICAgICB9CiAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgX2QgPSB0cnVlOwogICAgICBfZSA9IGVycjsKICAgIH0gZmluYWxseSB7CiAgICAgIHRyeSB7CiAgICAgICAgaWYgKCFfbiAmJiBfaVsicmV0dXJuIl0gIT0gbnVsbCkgX2lbInJldHVybiJdKCk7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgaWYgKF9kKSB0aHJvdyBfZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBfYXJyOwogIH0KCiAgbW9kdWxlLmV4cG9ydHMgPSBfaXRlcmFibGVUb0FycmF5TGltaXQ7CiAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICB9KTsKCiAgdW53cmFwRXhwb3J0cyhpdGVyYWJsZVRvQXJyYXlMaW1pdCk7CgogIHZhciBub25JdGVyYWJsZVJlc3QgPSBjcmVhdGVDb21tb25qc01vZHVsZShmdW5jdGlvbiAobW9kdWxlKSB7CiAgZnVuY3Rpb24gX25vbkl0ZXJhYmxlUmVzdCgpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7CiAgfQoKICBtb2R1bGUuZXhwb3J0cyA9IF9ub25JdGVyYWJsZVJlc3Q7CiAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICB9KTsKCiAgdW53cmFwRXhwb3J0cyhub25JdGVyYWJsZVJlc3QpOwoKICB2YXIgc2xpY2VkVG9BcnJheSA9IGNyZWF0ZUNvbW1vbmpzTW9kdWxlKGZ1bmN0aW9uIChtb2R1bGUpIHsKICBmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHsKICAgIHJldHVybiBhcnJheVdpdGhIb2xlcyhhcnIpIHx8IGl0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyLCBpKSB8fCBub25JdGVyYWJsZVJlc3QoKTsKICB9CgogIG1vZHVsZS5leHBvcnRzID0gX3NsaWNlZFRvQXJyYXk7CiAgbW9kdWxlLmV4cG9ydHNbImRlZmF1bHQiXSA9IG1vZHVsZS5leHBvcnRzLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKICB9KTsKCiAgdmFyIF9zbGljZWRUb0FycmF5ID0gdW53cmFwRXhwb3J0cyhzbGljZWRUb0FycmF5KTsKCiAgdmFyIGRlZmluZVByb3BlcnR5ID0gY3JlYXRlQ29tbW9uanNNb2R1bGUoZnVuY3Rpb24gKG1vZHVsZSkgewogIGZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsKICAgIGlmIChrZXkgaW4gb2JqKSB7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICB3cml0YWJsZTogdHJ1ZQogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIG9ialtrZXldID0gdmFsdWU7CiAgICB9CgogICAgcmV0dXJuIG9iajsKICB9CgogIG1vZHVsZS5leHBvcnRzID0gX2RlZmluZVByb3BlcnR5OwogIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgfSk7CgogIHZhciBfZGVmaW5lUHJvcGVydHkgPSB1bndyYXBFeHBvcnRzKGRlZmluZVByb3BlcnR5KTsKCiAgdmFyIERJUlRZX1BBVEhTID0gbmV3IFdlYWtNYXAoKTsKICB2YXIgRkxVU0hJTkcgPSBuZXcgV2Vha01hcCgpOwogIHZhciBOT1JNQUxJWklORyA9IG5ldyBXZWFrTWFwKCk7CiAgdmFyIFBBVEhfUkVGUyA9IG5ldyBXZWFrTWFwKCk7CiAgdmFyIFBPSU5UX1JFRlMgPSBuZXcgV2Vha01hcCgpOwogIHZhciBSQU5HRV9SRUZTID0gbmV3IFdlYWtNYXAoKTsKCiAgZnVuY3Rpb24gb3duS2V5cyQ5KG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOyBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgeyB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsgaWYgKGVudW1lcmFibGVPbmx5KSB7IHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsgfSBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCiAgZnVuY3Rpb24gX29iamVjdFNwcmVhZCQ5KHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMkOShPYmplY3Qoc291cmNlKSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyBvd25LZXlzJDkoT2JqZWN0KHNvdXJjZSkpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsgfSk7IH0gfSByZXR1cm4gdGFyZ2V0OyB9CgogIGZ1bmN0aW9uIF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyJDcobywgYWxsb3dBcnJheUxpa2UpIHsgdmFyIGl0ID0gdHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgb1tTeW1ib2wuaXRlcmF0b3JdIHx8IG9bIkBAaXRlcmF0b3IiXTsgaWYgKCFpdCkgeyBpZiAoQXJyYXkuaXNBcnJheShvKSB8fCAoaXQgPSBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkkNyhvKSkgfHwgYWxsb3dBcnJheUxpa2UgJiYgbyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSB7IGlmIChpdCkgbyA9IGl0OyB2YXIgaSA9IDA7IHZhciBGID0gZnVuY3Rpb24gRigpIHt9OyByZXR1cm4geyBzOiBGLCBuOiBmdW5jdGlvbiBuKCkgeyBpZiAoaSA+PSBvLmxlbmd0aCkgcmV0dXJuIHsgZG9uZTogdHJ1ZSB9OyByZXR1cm4geyBkb25lOiBmYWxzZSwgdmFsdWU6IG9baSsrXSB9OyB9LCBlOiBmdW5jdGlvbiBlKF9lKSB7IHRocm93IF9lOyB9LCBmOiBGIH07IH0gdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGl0ZXJhdGUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpOyB9IHZhciBub3JtYWxDb21wbGV0aW9uID0gdHJ1ZSwgZGlkRXJyID0gZmFsc2UsIGVycjsgcmV0dXJuIHsgczogZnVuY3Rpb24gcygpIHsgaXQgPSBpdC5jYWxsKG8pOyB9LCBuOiBmdW5jdGlvbiBuKCkgeyB2YXIgc3RlcCA9IGl0Lm5leHQoKTsgbm9ybWFsQ29tcGxldGlvbiA9IHN0ZXAuZG9uZTsgcmV0dXJuIHN0ZXA7IH0sIGU6IGZ1bmN0aW9uIGUoX2UyKSB7IGRpZEVyciA9IHRydWU7IGVyciA9IF9lMjsgfSwgZjogZnVuY3Rpb24gZigpIHsgdHJ5IHsgaWYgKCFub3JtYWxDb21wbGV0aW9uICYmIGl0WyJyZXR1cm4iXSAhPSBudWxsKSBpdFsicmV0dXJuIl0oKTsgfSBmaW5hbGx5IHsgaWYgKGRpZEVycikgdGhyb3cgZXJyOyB9IH0gfTsgfQoKICBmdW5jdGlvbiBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkkNyhvLCBtaW5MZW4pIHsgaWYgKCFvKSByZXR1cm47IGlmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheSQ3KG8sIG1pbkxlbik7IHZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTsgaWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7IGlmIChuID09PSAiTWFwIiB8fCBuID09PSAiU2V0IikgcmV0dXJuIEFycmF5LmZyb20obyk7IGlmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5JDcobywgbWluTGVuKTsgfQoKICBmdW5jdGlvbiBfYXJyYXlMaWtlVG9BcnJheSQ3KGFyciwgbGVuKSB7IGlmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoOyBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfQogIC8qKgogICAqIENyZWF0ZSBhIG5ldyBTbGF0ZSBgRWRpdG9yYCBvYmplY3QuCiAgICovCgogIHZhciBjcmVhdGVFZGl0b3IkMSA9IGZ1bmN0aW9uIGNyZWF0ZUVkaXRvcigpIHsKICAgIHZhciBlZGl0b3IgPSB7CiAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgb3BlcmF0aW9uczogW10sCiAgICAgIHNlbGVjdGlvbjogbnVsbCwKICAgICAgbWFya3M6IG51bGwsCiAgICAgIGlzSW5saW5lOiBmdW5jdGlvbiBpc0lubGluZSgpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0sCiAgICAgIGlzVm9pZDogZnVuY3Rpb24gaXNWb2lkKCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSwKICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKCkge30sCiAgICAgIGFwcGx5OiBmdW5jdGlvbiBhcHBseShvcCkgewogICAgICAgIHZhciBfaXRlcmF0b3IgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciQ3KEVkaXRvci5wYXRoUmVmcyhlZGl0b3IpKSwKICAgICAgICAgICAgX3N0ZXA7CgogICAgICAgIHRyeSB7CiAgICAgICAgICBmb3IgKF9pdGVyYXRvci5zKCk7ICEoX3N0ZXAgPSBfaXRlcmF0b3IubigpKS5kb25lOykgewogICAgICAgICAgICB2YXIgcmVmID0gX3N0ZXAudmFsdWU7CiAgICAgICAgICAgIFBhdGhSZWYudHJhbnNmb3JtKHJlZiwgb3ApOwogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgX2l0ZXJhdG9yLmUoZXJyKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgX2l0ZXJhdG9yLmYoKTsKICAgICAgICB9CgogICAgICAgIHZhciBfaXRlcmF0b3IyID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIkNyhFZGl0b3IucG9pbnRSZWZzKGVkaXRvcikpLAogICAgICAgICAgICBfc3RlcDI7CgogICAgICAgIHRyeSB7CiAgICAgICAgICBmb3IgKF9pdGVyYXRvcjIucygpOyAhKF9zdGVwMiA9IF9pdGVyYXRvcjIubigpKS5kb25lOykgewogICAgICAgICAgICB2YXIgX3JlZiA9IF9zdGVwMi52YWx1ZTsKICAgICAgICAgICAgUG9pbnRSZWYudHJhbnNmb3JtKF9yZWYsIG9wKTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgIF9pdGVyYXRvcjIuZShlcnIpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICBfaXRlcmF0b3IyLmYoKTsKICAgICAgICB9CgogICAgICAgIHZhciBfaXRlcmF0b3IzID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIkNyhFZGl0b3IucmFuZ2VSZWZzKGVkaXRvcikpLAogICAgICAgICAgICBfc3RlcDM7CgogICAgICAgIHRyeSB7CiAgICAgICAgICBmb3IgKF9pdGVyYXRvcjMucygpOyAhKF9zdGVwMyA9IF9pdGVyYXRvcjMubigpKS5kb25lOykgewogICAgICAgICAgICB2YXIgX3JlZjIgPSBfc3RlcDMudmFsdWU7CiAgICAgICAgICAgIFJhbmdlUmVmLnRyYW5zZm9ybShfcmVmMiwgb3ApOwogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgX2l0ZXJhdG9yMy5lKGVycik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIF9pdGVyYXRvcjMuZigpOwogICAgICAgIH0KCiAgICAgICAgdmFyIHNldCA9IG5ldyBTZXQoKTsKICAgICAgICB2YXIgZGlydHlQYXRocyA9IFtdOwoKICAgICAgICB2YXIgYWRkID0gZnVuY3Rpb24gYWRkKHBhdGgpIHsKICAgICAgICAgIGlmIChwYXRoKSB7CiAgICAgICAgICAgIHZhciBrZXkgPSBwYXRoLmpvaW4oJywnKTsKCiAgICAgICAgICAgIGlmICghc2V0LmhhcyhrZXkpKSB7CiAgICAgICAgICAgICAgc2V0LmFkZChrZXkpOwogICAgICAgICAgICAgIGRpcnR5UGF0aHMucHVzaChwYXRoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHZhciBvbGREaXJ0eVBhdGhzID0gRElSVFlfUEFUSFMuZ2V0KGVkaXRvcikgfHwgW107CiAgICAgICAgdmFyIG5ld0RpcnR5UGF0aHMgPSBnZXREaXJ0eVBhdGhzKG9wKTsKCiAgICAgICAgdmFyIF9pdGVyYXRvcjQgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciQ3KG9sZERpcnR5UGF0aHMpLAogICAgICAgICAgICBfc3RlcDQ7CgogICAgICAgIHRyeSB7CiAgICAgICAgICBmb3IgKF9pdGVyYXRvcjQucygpOyAhKF9zdGVwNCA9IF9pdGVyYXRvcjQubigpKS5kb25lOykgewogICAgICAgICAgICB2YXIgcGF0aCA9IF9zdGVwNC52YWx1ZTsKICAgICAgICAgICAgdmFyIG5ld1BhdGggPSBQYXRoLnRyYW5zZm9ybShwYXRoLCBvcCk7CiAgICAgICAgICAgIGFkZChuZXdQYXRoKTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgIF9pdGVyYXRvcjQuZShlcnIpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICBfaXRlcmF0b3I0LmYoKTsKICAgICAgICB9CgogICAgICAgIHZhciBfaXRlcmF0b3I1ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIkNyhuZXdEaXJ0eVBhdGhzKSwKICAgICAgICAgICAgX3N0ZXA1OwoKICAgICAgICB0cnkgewogICAgICAgICAgZm9yIChfaXRlcmF0b3I1LnMoKTsgIShfc3RlcDUgPSBfaXRlcmF0b3I1Lm4oKSkuZG9uZTspIHsKICAgICAgICAgICAgdmFyIF9wYXRoID0gX3N0ZXA1LnZhbHVlOwogICAgICAgICAgICBhZGQoX3BhdGgpOwogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgX2l0ZXJhdG9yNS5lKGVycik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIF9pdGVyYXRvcjUuZigpOwogICAgICAgIH0KCiAgICAgICAgRElSVFlfUEFUSFMuc2V0KGVkaXRvciwgZGlydHlQYXRocyk7CiAgICAgICAgVHJhbnNmb3Jtcy50cmFuc2Zvcm0oZWRpdG9yLCBvcCk7CiAgICAgICAgZWRpdG9yLm9wZXJhdGlvbnMucHVzaChvcCk7CiAgICAgICAgRWRpdG9yLm5vcm1hbGl6ZShlZGl0b3IpOyAvLyBDbGVhciBhbnkgZm9ybWF0cyBhcHBsaWVkIHRvIHRoZSBjdXJzb3IgaWYgdGhlIHNlbGVjdGlvbiBjaGFuZ2VzLgoKICAgICAgICBpZiAob3AudHlwZSA9PT0gJ3NldF9zZWxlY3Rpb24nKSB7CiAgICAgICAgICBlZGl0b3IubWFya3MgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFGTFVTSElORy5nZXQoZWRpdG9yKSkgewogICAgICAgICAgRkxVU0hJTkcuc2V0KGVkaXRvciwgdHJ1ZSk7CiAgICAgICAgICBQcm9taXNlLnJlc29sdmUoKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgRkxVU0hJTkcuc2V0KGVkaXRvciwgZmFsc2UpOwogICAgICAgICAgICBlZGl0b3Iub25DaGFuZ2UoKTsKICAgICAgICAgICAgZWRpdG9yLm9wZXJhdGlvbnMgPSBbXTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgYWRkTWFyazogZnVuY3Rpb24gYWRkTWFyayhrZXksIHZhbHVlKSB7CiAgICAgICAgdmFyIHNlbGVjdGlvbiA9IGVkaXRvci5zZWxlY3Rpb247CgogICAgICAgIGlmIChzZWxlY3Rpb24pIHsKICAgICAgICAgIGlmIChSYW5nZS5pc0V4cGFuZGVkKHNlbGVjdGlvbikpIHsKICAgICAgICAgICAgVHJhbnNmb3Jtcy5zZXROb2RlcyhlZGl0b3IsIF9kZWZpbmVQcm9wZXJ0eSh7fSwga2V5LCB2YWx1ZSksIHsKICAgICAgICAgICAgICBtYXRjaDogVGV4dC5pc1RleHQsCiAgICAgICAgICAgICAgc3BsaXQ6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgbWFya3MgPSBfb2JqZWN0U3ByZWFkJDkoX29iamVjdFNwcmVhZCQ5KHt9LCBFZGl0b3IubWFya3MoZWRpdG9yKSB8fCB7fSksIHt9LCBfZGVmaW5lUHJvcGVydHkoe30sIGtleSwgdmFsdWUpKTsKCiAgICAgICAgICAgIGVkaXRvci5tYXJrcyA9IG1hcmtzOwoKICAgICAgICAgICAgaWYgKCFGTFVTSElORy5nZXQoZWRpdG9yKSkgewogICAgICAgICAgICAgIGVkaXRvci5vbkNoYW5nZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICBkZWxldGVCYWNrd2FyZDogZnVuY3Rpb24gZGVsZXRlQmFja3dhcmQodW5pdCkgewogICAgICAgIHZhciBzZWxlY3Rpb24gPSBlZGl0b3Iuc2VsZWN0aW9uOwoKICAgICAgICBpZiAoc2VsZWN0aW9uICYmIFJhbmdlLmlzQ29sbGFwc2VkKHNlbGVjdGlvbikpIHsKICAgICAgICAgIFRyYW5zZm9ybXNbImRlbGV0ZSJdKGVkaXRvciwgewogICAgICAgICAgICB1bml0OiB1bml0LAogICAgICAgICAgICByZXZlcnNlOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGRlbGV0ZUZvcndhcmQ6IGZ1bmN0aW9uIGRlbGV0ZUZvcndhcmQodW5pdCkgewogICAgICAgIHZhciBzZWxlY3Rpb24gPSBlZGl0b3Iuc2VsZWN0aW9uOwoKICAgICAgICBpZiAoc2VsZWN0aW9uICYmIFJhbmdlLmlzQ29sbGFwc2VkKHNlbGVjdGlvbikpIHsKICAgICAgICAgIFRyYW5zZm9ybXNbImRlbGV0ZSJdKGVkaXRvciwgewogICAgICAgICAgICB1bml0OiB1bml0CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGRlbGV0ZUZyYWdtZW50OiBmdW5jdGlvbiBkZWxldGVGcmFnbWVudChkaXJlY3Rpb24pIHsKICAgICAgICB2YXIgc2VsZWN0aW9uID0gZWRpdG9yLnNlbGVjdGlvbjsKCiAgICAgICAgaWYgKHNlbGVjdGlvbiAmJiBSYW5nZS5pc0V4cGFuZGVkKHNlbGVjdGlvbikpIHsKICAgICAgICAgIFRyYW5zZm9ybXNbImRlbGV0ZSJdKGVkaXRvciwgewogICAgICAgICAgICByZXZlcnNlOiBkaXJlY3Rpb24gPT09ICdiYWNrd2FyZCcKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgZ2V0RnJhZ21lbnQ6IGZ1bmN0aW9uIGdldEZyYWdtZW50KCkgewogICAgICAgIHZhciBzZWxlY3Rpb24gPSBlZGl0b3Iuc2VsZWN0aW9uOwoKICAgICAgICBpZiAoc2VsZWN0aW9uKSB7CiAgICAgICAgICByZXR1cm4gTm9kZSQxLmZyYWdtZW50KGVkaXRvciwgc2VsZWN0aW9uKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBbXTsKICAgICAgfSwKICAgICAgaW5zZXJ0QnJlYWs6IGZ1bmN0aW9uIGluc2VydEJyZWFrKCkgewogICAgICAgIFRyYW5zZm9ybXMuc3BsaXROb2RlcyhlZGl0b3IsIHsKICAgICAgICAgIGFsd2F5czogdHJ1ZQogICAgICAgIH0pOwogICAgICB9LAogICAgICBpbnNlcnRGcmFnbWVudDogZnVuY3Rpb24gaW5zZXJ0RnJhZ21lbnQoZnJhZ21lbnQpIHsKICAgICAgICBUcmFuc2Zvcm1zLmluc2VydEZyYWdtZW50KGVkaXRvciwgZnJhZ21lbnQpOwogICAgICB9LAogICAgICBpbnNlcnROb2RlOiBmdW5jdGlvbiBpbnNlcnROb2RlKG5vZGUpIHsKICAgICAgICBUcmFuc2Zvcm1zLmluc2VydE5vZGVzKGVkaXRvciwgbm9kZSk7CiAgICAgIH0sCiAgICAgIGluc2VydFRleHQ6IGZ1bmN0aW9uIGluc2VydFRleHQodGV4dCkgewogICAgICAgIHZhciBzZWxlY3Rpb24gPSBlZGl0b3Iuc2VsZWN0aW9uLAogICAgICAgICAgICBtYXJrcyA9IGVkaXRvci5tYXJrczsKCiAgICAgICAgaWYgKHNlbGVjdGlvbikgewogICAgICAgICAgaWYgKG1hcmtzKSB7CiAgICAgICAgICAgIHZhciBub2RlID0gX29iamVjdFNwcmVhZCQ5KHsKICAgICAgICAgICAgICB0ZXh0OiB0ZXh0CiAgICAgICAgICAgIH0sIG1hcmtzKTsKCiAgICAgICAgICAgIFRyYW5zZm9ybXMuaW5zZXJ0Tm9kZXMoZWRpdG9yLCBub2RlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFRyYW5zZm9ybXMuaW5zZXJ0VGV4dChlZGl0b3IsIHRleHQpOwogICAgICAgICAgfQoKICAgICAgICAgIGVkaXRvci5tYXJrcyA9IG51bGw7CiAgICAgICAgfQogICAgICB9LAogICAgICBub3JtYWxpemVOb2RlOiBmdW5jdGlvbiBub3JtYWxpemVOb2RlKGVudHJ5KSB7CiAgICAgICAgdmFyIF9lbnRyeSA9IF9zbGljZWRUb0FycmF5KGVudHJ5LCAyKSwKICAgICAgICAgICAgbm9kZSA9IF9lbnRyeVswXSwKICAgICAgICAgICAgcGF0aCA9IF9lbnRyeVsxXTsgLy8gVGhlcmUgYXJlIG5vIGNvcmUgbm9ybWFsaXphdGlvbnMgZm9yIHRleHQgbm9kZXMuCgoKICAgICAgICBpZiAoVGV4dC5pc1RleHQobm9kZSkpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9IC8vIEVuc3VyZSB0aGF0IGJsb2NrIGFuZCBpbmxpbmUgbm9kZXMgaGF2ZSBhdCBsZWFzdCBvbmUgdGV4dCBjaGlsZC4KCgogICAgICAgIGlmIChFbGVtZW50JDEuaXNFbGVtZW50KG5vZGUpICYmIG5vZGUuY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICB2YXIgY2hpbGQgPSB7CiAgICAgICAgICAgIHRleHQ6ICcnCiAgICAgICAgICB9OwogICAgICAgICAgVHJhbnNmb3Jtcy5pbnNlcnROb2RlcyhlZGl0b3IsIGNoaWxkLCB7CiAgICAgICAgICAgIGF0OiBwYXRoLmNvbmNhdCgwKSwKICAgICAgICAgICAgdm9pZHM6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gLy8gRGV0ZXJtaW5lIHdoZXRoZXIgdGhlIG5vZGUgc2hvdWxkIGhhdmUgYmxvY2sgb3IgaW5saW5lIGNoaWxkcmVuLgoKCiAgICAgICAgdmFyIHNob3VsZEhhdmVJbmxpbmVzID0gRWRpdG9yLmlzRWRpdG9yKG5vZGUpID8gZmFsc2UgOiBFbGVtZW50JDEuaXNFbGVtZW50KG5vZGUpICYmIChlZGl0b3IuaXNJbmxpbmUobm9kZSkgfHwgbm9kZS5jaGlsZHJlbi5sZW5ndGggPT09IDAgfHwgVGV4dC5pc1RleHQobm9kZS5jaGlsZHJlblswXSkgfHwgZWRpdG9yLmlzSW5saW5lKG5vZGUuY2hpbGRyZW5bMF0pKTsgLy8gU2luY2Ugd2UnbGwgYmUgYXBwbHlpbmcgb3BlcmF0aW9ucyB3aGlsZSBpdGVyYXRpbmcsIGtlZXAgdHJhY2sgb2YgYW4KICAgICAgICAvLyBpbmRleCB0aGF0IGFjY291bnRzIGZvciBhbnkgYWRkZWQvcmVtb3ZlZCBub2Rlcy4KCiAgICAgICAgdmFyIG4gPSAwOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGUuY2hpbGRyZW4ubGVuZ3RoOyBpKyssIG4rKykgewogICAgICAgICAgdmFyIGN1cnJlbnROb2RlID0gTm9kZSQxLmdldChlZGl0b3IsIHBhdGgpOwogICAgICAgICAgaWYgKFRleHQuaXNUZXh0KGN1cnJlbnROb2RlKSkgY29udGludWU7CiAgICAgICAgICB2YXIgX2NoaWxkID0gbm9kZS5jaGlsZHJlbltpXTsKICAgICAgICAgIHZhciBwcmV2ID0gY3VycmVudE5vZGUuY2hpbGRyZW5bbiAtIDFdOwogICAgICAgICAgdmFyIGlzTGFzdCA9IGkgPT09IG5vZGUuY2hpbGRyZW4ubGVuZ3RoIC0gMTsKICAgICAgICAgIHZhciBpc0lubGluZU9yVGV4dCA9IFRleHQuaXNUZXh0KF9jaGlsZCkgfHwgRWxlbWVudCQxLmlzRWxlbWVudChfY2hpbGQpICYmIGVkaXRvci5pc0lubGluZShfY2hpbGQpOyAvLyBPbmx5IGFsbG93IGJsb2NrIG5vZGVzIGluIHRoZSB0b3AtbGV2ZWwgY2hpbGRyZW4gYW5kIHBhcmVudCBibG9ja3MKICAgICAgICAgIC8vIHRoYXQgb25seSBjb250YWluIGJsb2NrIG5vZGVzLiBTaW1pbGFybHksIG9ubHkgYWxsb3cgaW5saW5lIG5vZGVzIGluCiAgICAgICAgICAvLyBvdGhlciBpbmxpbmUgbm9kZXMsIG9yIHBhcmVudCBibG9ja3MgdGhhdCBvbmx5IGNvbnRhaW4gaW5saW5lcyBhbmQKICAgICAgICAgIC8vIHRleHQuCgogICAgICAgICAgaWYgKGlzSW5saW5lT3JUZXh0ICE9PSBzaG91bGRIYXZlSW5saW5lcykgewogICAgICAgICAgICBUcmFuc2Zvcm1zLnJlbW92ZU5vZGVzKGVkaXRvciwgewogICAgICAgICAgICAgIGF0OiBwYXRoLmNvbmNhdChuKSwKICAgICAgICAgICAgICB2b2lkczogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgbi0tOwogICAgICAgICAgfSBlbHNlIGlmIChFbGVtZW50JDEuaXNFbGVtZW50KF9jaGlsZCkpIHsKICAgICAgICAgICAgLy8gRW5zdXJlIHRoYXQgaW5saW5lIG5vZGVzIGFyZSBzdXJyb3VuZGVkIGJ5IHRleHQgbm9kZXMuCiAgICAgICAgICAgIGlmIChlZGl0b3IuaXNJbmxpbmUoX2NoaWxkKSkgewogICAgICAgICAgICAgIGlmIChwcmV2ID09IG51bGwgfHwgIVRleHQuaXNUZXh0KHByZXYpKSB7CiAgICAgICAgICAgICAgICB2YXIgbmV3Q2hpbGQgPSB7CiAgICAgICAgICAgICAgICAgIHRleHQ6ICcnCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgVHJhbnNmb3Jtcy5pbnNlcnROb2RlcyhlZGl0b3IsIG5ld0NoaWxkLCB7CiAgICAgICAgICAgICAgICAgIGF0OiBwYXRoLmNvbmNhdChuKSwKICAgICAgICAgICAgICAgICAgdm9pZHM6IHRydWUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgbisrOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNMYXN0KSB7CiAgICAgICAgICAgICAgICB2YXIgX25ld0NoaWxkID0gewogICAgICAgICAgICAgICAgICB0ZXh0OiAnJwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIFRyYW5zZm9ybXMuaW5zZXJ0Tm9kZXMoZWRpdG9yLCBfbmV3Q2hpbGQsIHsKICAgICAgICAgICAgICAgICAgYXQ6IHBhdGguY29uY2F0KG4gKyAxKSwKICAgICAgICAgICAgICAgICAgdm9pZHM6IHRydWUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgbisrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gTWVyZ2UgYWRqYWNlbnQgdGV4dCBub2RlcyB0aGF0IGFyZSBlbXB0eSBvciBtYXRjaC4KICAgICAgICAgICAgaWYgKHByZXYgIT0gbnVsbCAmJiBUZXh0LmlzVGV4dChwcmV2KSkgewogICAgICAgICAgICAgIGlmIChUZXh0LmVxdWFscyhfY2hpbGQsIHByZXYsIHsKICAgICAgICAgICAgICAgIGxvb3NlOiB0cnVlCiAgICAgICAgICAgICAgfSkpIHsKICAgICAgICAgICAgICAgIFRyYW5zZm9ybXMubWVyZ2VOb2RlcyhlZGl0b3IsIHsKICAgICAgICAgICAgICAgICAgYXQ6IHBhdGguY29uY2F0KG4pLAogICAgICAgICAgICAgICAgICB2b2lkczogdHJ1ZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBuLS07CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChwcmV2LnRleHQgPT09ICcnKSB7CiAgICAgICAgICAgICAgICBUcmFuc2Zvcm1zLnJlbW92ZU5vZGVzKGVkaXRvciwgewogICAgICAgICAgICAgICAgICBhdDogcGF0aC5jb25jYXQobiAtIDEpLAogICAgICAgICAgICAgICAgICB2b2lkczogdHJ1ZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBuLS07CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChfY2hpbGQudGV4dCA9PT0gJycpIHsKICAgICAgICAgICAgICAgIFRyYW5zZm9ybXMucmVtb3ZlTm9kZXMoZWRpdG9yLCB7CiAgICAgICAgICAgICAgICAgIGF0OiBwYXRoLmNvbmNhdChuKSwKICAgICAgICAgICAgICAgICAgdm9pZHM6IHRydWUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgbi0tOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgcmVtb3ZlTWFyazogZnVuY3Rpb24gcmVtb3ZlTWFyayhrZXkpIHsKICAgICAgICB2YXIgc2VsZWN0aW9uID0gZWRpdG9yLnNlbGVjdGlvbjsKCiAgICAgICAgaWYgKHNlbGVjdGlvbikgewogICAgICAgICAgaWYgKFJhbmdlLmlzRXhwYW5kZWQoc2VsZWN0aW9uKSkgewogICAgICAgICAgICBUcmFuc2Zvcm1zLnVuc2V0Tm9kZXMoZWRpdG9yLCBrZXksIHsKICAgICAgICAgICAgICBtYXRjaDogVGV4dC5pc1RleHQsCiAgICAgICAgICAgICAgc3BsaXQ6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgbWFya3MgPSBfb2JqZWN0U3ByZWFkJDkoe30sIEVkaXRvci5tYXJrcyhlZGl0b3IpIHx8IHt9KTsKCiAgICAgICAgICAgIGRlbGV0ZSBtYXJrc1trZXldOwogICAgICAgICAgICBlZGl0b3IubWFya3MgPSBtYXJrczsKCiAgICAgICAgICAgIGlmICghRkxVU0hJTkcuZ2V0KGVkaXRvcikpIHsKICAgICAgICAgICAgICBlZGl0b3Iub25DaGFuZ2UoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIHJldHVybiBlZGl0b3I7CiAgfTsKICAvKioKICAgKiBHZXQgdGhlICJkaXJ0eSIgcGF0aHMgZ2VuZXJhdGVkIGZyb20gYW4gb3BlcmF0aW9uLgogICAqLwoKICB2YXIgZ2V0RGlydHlQYXRocyA9IGZ1bmN0aW9uIGdldERpcnR5UGF0aHMob3ApIHsKICAgIHN3aXRjaCAob3AudHlwZSkgewogICAgICBjYXNlICdpbnNlcnRfdGV4dCc6CiAgICAgIGNhc2UgJ3JlbW92ZV90ZXh0JzoKICAgICAgY2FzZSAnc2V0X25vZGUnOgogICAgICAgIHsKICAgICAgICAgIHZhciBwYXRoID0gb3AucGF0aDsKICAgICAgICAgIHJldHVybiBQYXRoLmxldmVscyhwYXRoKTsKICAgICAgICB9CgogICAgICBjYXNlICdpbnNlcnRfbm9kZSc6CiAgICAgICAgewogICAgICAgICAgdmFyIG5vZGUgPSBvcC5ub2RlLAogICAgICAgICAgICAgIF9wYXRoMiA9IG9wLnBhdGg7CiAgICAgICAgICB2YXIgbGV2ZWxzID0gUGF0aC5sZXZlbHMoX3BhdGgyKTsKICAgICAgICAgIHZhciBkZXNjZW5kYW50cyA9IFRleHQuaXNUZXh0KG5vZGUpID8gW10gOiBBcnJheS5mcm9tKE5vZGUkMS5ub2Rlcyhub2RlKSwgZnVuY3Rpb24gKF9yZWYzKSB7CiAgICAgICAgICAgIHZhciBfcmVmNCA9IF9zbGljZWRUb0FycmF5KF9yZWYzLCAyKSwKICAgICAgICAgICAgICAgIHAgPSBfcmVmNFsxXTsKCiAgICAgICAgICAgIHJldHVybiBfcGF0aDIuY29uY2F0KHApOwogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShsZXZlbHMpLCBfdG9Db25zdW1hYmxlQXJyYXkoZGVzY2VuZGFudHMpKTsKICAgICAgICB9CgogICAgICBjYXNlICdtZXJnZV9ub2RlJzoKICAgICAgICB7CiAgICAgICAgICB2YXIgX3BhdGgzID0gb3AucGF0aDsKICAgICAgICAgIHZhciBhbmNlc3RvcnMgPSBQYXRoLmFuY2VzdG9ycyhfcGF0aDMpOwogICAgICAgICAgdmFyIHByZXZpb3VzUGF0aCA9IFBhdGgucHJldmlvdXMoX3BhdGgzKTsKICAgICAgICAgIHJldHVybiBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KGFuY2VzdG9ycyksIFtwcmV2aW91c1BhdGhdKTsKICAgICAgICB9CgogICAgICBjYXNlICdtb3ZlX25vZGUnOgogICAgICAgIHsKICAgICAgICAgIHZhciBfcGF0aDQgPSBvcC5wYXRoLAogICAgICAgICAgICAgIG5ld1BhdGggPSBvcC5uZXdQYXRoOwoKICAgICAgICAgIGlmIChQYXRoLmVxdWFscyhfcGF0aDQsIG5ld1BhdGgpKSB7CiAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgb2xkQW5jZXN0b3JzID0gW107CiAgICAgICAgICB2YXIgbmV3QW5jZXN0b3JzID0gW107CgogICAgICAgICAgdmFyIF9pdGVyYXRvcjYgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciQ3KFBhdGguYW5jZXN0b3JzKF9wYXRoNCkpLAogICAgICAgICAgICAgIF9zdGVwNjsKCiAgICAgICAgICB0cnkgewogICAgICAgICAgICBmb3IgKF9pdGVyYXRvcjYucygpOyAhKF9zdGVwNiA9IF9pdGVyYXRvcjYubigpKS5kb25lOykgewogICAgICAgICAgICAgIHZhciBhbmNlc3RvciA9IF9zdGVwNi52YWx1ZTsKICAgICAgICAgICAgICB2YXIgcCA9IFBhdGgudHJhbnNmb3JtKGFuY2VzdG9yLCBvcCk7CiAgICAgICAgICAgICAgb2xkQW5jZXN0b3JzLnB1c2gocCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBfaXRlcmF0b3I2LmUoZXJyKTsKICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIF9pdGVyYXRvcjYuZigpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBfaXRlcmF0b3I3ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIkNyhQYXRoLmFuY2VzdG9ycyhuZXdQYXRoKSksCiAgICAgICAgICAgICAgX3N0ZXA3OwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yNy5zKCk7ICEoX3N0ZXA3ID0gX2l0ZXJhdG9yNy5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgICAgdmFyIF9hbmNlc3RvciA9IF9zdGVwNy52YWx1ZTsKCiAgICAgICAgICAgICAgdmFyIF9wID0gUGF0aC50cmFuc2Zvcm0oX2FuY2VzdG9yLCBvcCk7CgogICAgICAgICAgICAgIG5ld0FuY2VzdG9ycy5wdXNoKF9wKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIF9pdGVyYXRvcjcuZShlcnIpOwogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgX2l0ZXJhdG9yNy5mKCk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIG5ld1BhcmVudCA9IG5ld0FuY2VzdG9yc1tuZXdBbmNlc3RvcnMubGVuZ3RoIC0gMV07CiAgICAgICAgICB2YXIgbmV3SW5kZXggPSBuZXdQYXRoW25ld1BhdGgubGVuZ3RoIC0gMV07CiAgICAgICAgICB2YXIgcmVzdWx0UGF0aCA9IG5ld1BhcmVudC5jb25jYXQobmV3SW5kZXgpOwogICAgICAgICAgcmV0dXJuIFtdLmNvbmNhdChvbGRBbmNlc3RvcnMsIG5ld0FuY2VzdG9ycywgW3Jlc3VsdFBhdGhdKTsKICAgICAgICB9CgogICAgICBjYXNlICdyZW1vdmVfbm9kZSc6CiAgICAgICAgewogICAgICAgICAgdmFyIF9wYXRoNSA9IG9wLnBhdGg7CgogICAgICAgICAgdmFyIF9hbmNlc3RvcnMgPSBQYXRoLmFuY2VzdG9ycyhfcGF0aDUpOwoKICAgICAgICAgIHJldHVybiBfdG9Db25zdW1hYmxlQXJyYXkoX2FuY2VzdG9ycyk7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc3BsaXRfbm9kZSc6CiAgICAgICAgewogICAgICAgICAgdmFyIF9wYXRoNiA9IG9wLnBhdGg7CgogICAgICAgICAgdmFyIF9sZXZlbHMgPSBQYXRoLmxldmVscyhfcGF0aDYpOwoKICAgICAgICAgIHZhciBuZXh0UGF0aCA9IFBhdGgubmV4dChfcGF0aDYpOwogICAgICAgICAgcmV0dXJuIFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoX2xldmVscyksIFtuZXh0UGF0aF0pOwogICAgICAgIH0KCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgewogICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgIH0KICAgIH0KICB9OwoKICB2YXIgb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZSA9IGNyZWF0ZUNvbW1vbmpzTW9kdWxlKGZ1bmN0aW9uIChtb2R1bGUpIHsKICBmdW5jdGlvbiBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZShzb3VyY2UsIGV4Y2x1ZGVkKSB7CiAgICBpZiAoc291cmNlID09IG51bGwpIHJldHVybiB7fTsKICAgIHZhciB0YXJnZXQgPSB7fTsKICAgIHZhciBzb3VyY2VLZXlzID0gT2JqZWN0LmtleXMoc291cmNlKTsKICAgIHZhciBrZXksIGk7CgogICAgZm9yIChpID0gMDsgaSA8IHNvdXJjZUtleXMubGVuZ3RoOyBpKyspIHsKICAgICAga2V5ID0gc291cmNlS2V5c1tpXTsKICAgICAgaWYgKGV4Y2x1ZGVkLmluZGV4T2Yoa2V5KSA+PSAwKSBjb250aW51ZTsKICAgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsKICAgIH0KCiAgICByZXR1cm4gdGFyZ2V0OwogIH0KCiAgbW9kdWxlLmV4cG9ydHMgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZTsKICBtb2R1bGUuZXhwb3J0c1siZGVmYXVsdCJdID0gbW9kdWxlLmV4cG9ydHMsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlOwogIH0pOwoKICB1bndyYXBFeHBvcnRzKG9iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UpOwoKICB2YXIgb2JqZWN0V2l0aG91dFByb3BlcnRpZXMgPSBjcmVhdGVDb21tb25qc01vZHVsZShmdW5jdGlvbiAobW9kdWxlKSB7CiAgZnVuY3Rpb24gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKHNvdXJjZSwgZXhjbHVkZWQpIHsKICAgIGlmIChzb3VyY2UgPT0gbnVsbCkgcmV0dXJuIHt9OwogICAgdmFyIHRhcmdldCA9IG9iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2Uoc291cmNlLCBleGNsdWRlZCk7CiAgICB2YXIga2V5LCBpOwoKICAgIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICAgIHZhciBzb3VyY2VTeW1ib2xLZXlzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhzb3VyY2UpOwoKICAgICAgZm9yIChpID0gMDsgaSA8IHNvdXJjZVN5bWJvbEtleXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBrZXkgPSBzb3VyY2VTeW1ib2xLZXlzW2ldOwogICAgICAgIGlmIChleGNsdWRlZC5pbmRleE9mKGtleSkgPj0gMCkgY29udGludWU7CiAgICAgICAgaWYgKCFPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwoc291cmNlLCBrZXkpKSBjb250aW51ZTsKICAgICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRhcmdldDsKICB9CgogIG1vZHVsZS5leHBvcnRzID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzOwogIG1vZHVsZS5leHBvcnRzWyJkZWZhdWx0Il0gPSBtb2R1bGUuZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7CiAgfSk7CgogIHZhciBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMgPSB1bndyYXBFeHBvcnRzKG9iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKTsKCiAgZnVuY3Rpb24gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIkNihvLCBhbGxvd0FycmF5TGlrZSkgeyB2YXIgaXQgPSB0eXBlb2YgU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl0gfHwgb1siQEBpdGVyYXRvciJdOyBpZiAoIWl0KSB7IGlmIChBcnJheS5pc0FycmF5KG8pIHx8IChpdCA9IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheSQ2KG8pKSB8fCBhbGxvd0FycmF5TGlrZSAmJiBvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHsgaWYgKGl0KSBvID0gaXQ7IHZhciBpID0gMDsgdmFyIEYgPSBmdW5jdGlvbiBGKCkge307IHJldHVybiB7IHM6IEYsIG46IGZ1bmN0aW9uIG4oKSB7IGlmIChpID49IG8ubGVuZ3RoKSByZXR1cm4geyBkb25lOiB0cnVlIH07IHJldHVybiB7IGRvbmU6IGZhbHNlLCB2YWx1ZTogb1tpKytdIH07IH0sIGU6IGZ1bmN0aW9uIGUoX2UpIHsgdGhyb3cgX2U7IH0sIGY6IEYgfTsgfSB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gaXRlcmF0ZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7IH0gdmFyIG5vcm1hbENvbXBsZXRpb24gPSB0cnVlLCBkaWRFcnIgPSBmYWxzZSwgZXJyOyByZXR1cm4geyBzOiBmdW5jdGlvbiBzKCkgeyBpdCA9IGl0LmNhbGwobyk7IH0sIG46IGZ1bmN0aW9uIG4oKSB7IHZhciBzdGVwID0gaXQubmV4dCgpOyBub3JtYWxDb21wbGV0aW9uID0gc3RlcC5kb25lOyByZXR1cm4gc3RlcDsgfSwgZTogZnVuY3Rpb24gZShfZTIpIHsgZGlkRXJyID0gdHJ1ZTsgZXJyID0gX2UyOyB9LCBmOiBmdW5jdGlvbiBmKCkgeyB0cnkgeyBpZiAoIW5vcm1hbENvbXBsZXRpb24gJiYgaXRbInJldHVybiJdICE9IG51bGwpIGl0WyJyZXR1cm4iXSgpOyB9IGZpbmFsbHkgeyBpZiAoZGlkRXJyKSB0aHJvdyBlcnI7IH0gfSB9OyB9CgogIGZ1bmN0aW9uIF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheSQ2KG8sIG1pbkxlbikgeyBpZiAoIW8pIHJldHVybjsgaWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5JDYobywgbWluTGVuKTsgdmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpOyBpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTsgaWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKSByZXR1cm4gQXJyYXkuZnJvbShvKTsgaWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkkNihvLCBtaW5MZW4pOyB9CgogIGZ1bmN0aW9uIF9hcnJheUxpa2VUb0FycmF5JDYoYXJyLCBsZW4pIHsgaWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykgeyBhcnIyW2ldID0gYXJyW2ldOyB9IHJldHVybiBhcnIyOyB9CgogIC8vIENoYXJhY3RlciAoZ3JhcGhlbWUgY2x1c3RlcikgYm91bmRhcmllcyBhcmUgZGV0ZXJtaW5lZCBhY2NvcmRpbmcgdG8KICAvLyB0aGUgZGVmYXVsdCBncmFwaGVtZSBjbHVzdGVyIGJvdW5kYXJ5IHNwZWNpZmljYXRpb24sIGV4dGVuZGVkIGdyYXBoZW1lIGNsdXN0ZXJzIHZhcmlhbnRbMV0uCiAgLy8KICAvLyBSZWZlcmVuY2VzOgogIC8vCiAgLy8gWzFdIGh0dHBzOi8vd3d3LnVuaWNvZGUub3JnL3JlcG9ydHMvdHIyOS8jRGVmYXVsdF9HcmFwaGVtZV9DbHVzdGVyX1RhYmxlCiAgLy8gWzJdIGh0dHBzOi8vd3d3LnVuaWNvZGUub3JnL1B1YmxpYy9VQ0QvbGF0ZXN0L3VjZC9hdXhpbGlhcnkvR3JhcGhlbWVCcmVha1Byb3BlcnR5LnR4dAogIC8vIFszXSBodHRwczovL3d3dy51bmljb2RlLm9yZy9QdWJsaWMvVUNEL2xhdGVzdC91Y2QvYXV4aWxpYXJ5L0dyYXBoZW1lQnJlYWtUZXN0Lmh0bWwKICAvLyBbNF0gaHR0cHM6Ly93d3cudW5pY29kZS5vcmcvUHVibGljL1VDRC9sYXRlc3QvdWNkL2F1eGlsaWFyeS9HcmFwaGVtZUJyZWFrVGVzdC50eHQKCiAgLyoqCiAgICogR2V0IHRoZSBkaXN0YW5jZSB0byB0aGUgZW5kIG9mIHRoZSBmaXJzdCBjaGFyYWN0ZXIgaW4gYSBzdHJpbmcgb2YgdGV4dC4KICAgKi8KICB2YXIgZ2V0Q2hhcmFjdGVyRGlzdGFuY2UgPSBmdW5jdGlvbiBnZXRDaGFyYWN0ZXJEaXN0YW5jZShzdHIpIHsKICAgIHZhciBpc1JUTCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CiAgICB2YXIgaXNMVFIgPSAhaXNSVEw7CiAgICB2YXIgY29kZXBvaW50cyA9IGlzUlRMID8gY29kZXBvaW50c0l0ZXJhdG9yUlRMKHN0cikgOiBzdHI7CiAgICB2YXIgbGVmdCA9IENvZGVwb2ludFR5cGUuTm9uZTsKICAgIHZhciByaWdodCA9IENvZGVwb2ludFR5cGUuTm9uZTsKICAgIHZhciBkaXN0YW5jZSA9IDA7IC8vIEV2YWx1YXRpb24gb2YgdGhlc2UgY29uZGl0aW9ucyBhcmUgZGVmZXJyZWQuCgogICAgdmFyIGdiMTEgPSBudWxsOyAvLyBJcyBHQjExIGFwcGxpY2FibGU/CgogICAgdmFyIGdiMTJPcjEzID0gbnVsbDsgLy8gSXMgR0IxMiBvciBHQjEzIGFwcGxpY2FibGU/CgogICAgdmFyIF9pdGVyYXRvciA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyJDYoY29kZXBvaW50cyksCiAgICAgICAgX3N0ZXA7CgogICAgdHJ5IHsKICAgICAgZm9yIChfaXRlcmF0b3IucygpOyAhKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZTspIHsKICAgICAgICB2YXIgX2NoYXIgPSBfc3RlcC52YWx1ZTsKCiAgICAgICAgdmFyIGNvZGUgPSBfY2hhci5jb2RlUG9pbnRBdCgwKTsKCiAgICAgICAgaWYgKCFjb2RlKSBicmVhazsKICAgICAgICB2YXIgdHlwZSA9IGdldENvZGVwb2ludFR5cGUoX2NoYXIsIGNvZGUpOwoKICAgICAgICB2YXIgX3JlZiA9IGlzTFRSID8gW3JpZ2h0LCB0eXBlXSA6IFt0eXBlLCBsZWZ0XTsKCiAgICAgICAgdmFyIF9yZWYyID0gX3NsaWNlZFRvQXJyYXkoX3JlZiwgMik7CgogICAgICAgIGxlZnQgPSBfcmVmMlswXTsKICAgICAgICByaWdodCA9IF9yZWYyWzFdOwoKICAgICAgICBpZiAoaW50ZXJzZWN0cyhsZWZ0LCBDb2RlcG9pbnRUeXBlLlpXSikgJiYgaW50ZXJzZWN0cyhyaWdodCwgQ29kZXBvaW50VHlwZS5FeHRQaWN0KSkgewogICAgICAgICAgaWYgKGlzTFRSKSB7CiAgICAgICAgICAgIGdiMTEgPSBlbmRzV2l0aEVtb2ppWldKKHN0ci5zdWJzdHJpbmcoMCwgZGlzdGFuY2UpKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGdiMTEgPSBlbmRzV2l0aEVtb2ppWldKKHN0ci5zdWJzdHJpbmcoMCwgc3RyLmxlbmd0aCAtIGRpc3RhbmNlKSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCFnYjExKSBicmVhazsKICAgICAgICB9CgogICAgICAgIGlmIChpbnRlcnNlY3RzKGxlZnQsIENvZGVwb2ludFR5cGUuUkkpICYmIGludGVyc2VjdHMocmlnaHQsIENvZGVwb2ludFR5cGUuUkkpKSB7CiAgICAgICAgICBpZiAoZ2IxMk9yMTMgIT09IG51bGwpIHsKICAgICAgICAgICAgZ2IxMk9yMTMgPSAhZ2IxMk9yMTM7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoaXNMVFIpIHsKICAgICAgICAgICAgICBnYjEyT3IxMyA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZ2IxMk9yMTMgPSBlbmRzV2l0aE9kZE51bWJlck9mUklzKHN0ci5zdWJzdHJpbmcoMCwgc3RyLmxlbmd0aCAtIGRpc3RhbmNlKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWdiMTJPcjEzKSBicmVhazsKICAgICAgICB9CgogICAgICAgIGlmIChsZWZ0ICE9PSBDb2RlcG9pbnRUeXBlLk5vbmUgJiYgcmlnaHQgIT09IENvZGVwb2ludFR5cGUuTm9uZSAmJiBpc0JvdW5kYXJ5UGFpcihsZWZ0LCByaWdodCkpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgZGlzdGFuY2UgKz0gX2NoYXIubGVuZ3RoOwogICAgICB9CiAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgX2l0ZXJhdG9yLmUoZXJyKTsKICAgIH0gZmluYWxseSB7CiAgICAgIF9pdGVyYXRvci5mKCk7CiAgICB9CgogICAgcmV0dXJuIGRpc3RhbmNlIHx8IDE7CiAgfTsKICB2YXIgU1BBQ0UgPSAvXHMvOwogIHZhciBQVU5DVFVBVElPTiA9IC9bXHUwMDIxLVx1MDAyM1x1MDAyNS1cdTAwMkFcdTAwMkMtXHUwMDJGXHUwMDNBXHUwMDNCXHUwMDNGXHUwMDQwXHUwMDVCLVx1MDA1RFx1MDA1Rlx1MDA3Qlx1MDA3RFx1MDBBMVx1MDBBN1x1MDBBQlx1MDBCNlx1MDBCN1x1MDBCQlx1MDBCRlx1MDM3RVx1MDM4N1x1MDU1QS1cdTA1NUZcdTA1ODlcdTA1OEFcdTA1QkVcdTA1QzBcdTA1QzNcdTA1QzZcdTA1RjNcdTA1RjRcdTA2MDlcdTA2MEFcdTA2MENcdTA2MERcdTA2MUJcdTA2MUVcdTA2MUZcdTA2NkEtXHUwNjZEXHUwNkQ0XHUwNzAwLVx1MDcwRFx1MDdGNy1cdTA3RjlcdTA4MzAtXHUwODNFXHUwODVFXHUwOTY0XHUwOTY1XHUwOTcwXHUwQUYwXHUwREY0XHUwRTRGXHUwRTVBXHUwRTVCXHUwRjA0LVx1MEYxMlx1MEYxNFx1MEYzQS1cdTBGM0RcdTBGODVcdTBGRDAtXHUwRkQ0XHUwRkQ5XHUwRkRBXHUxMDRBLVx1MTA0Rlx1MTBGQlx1MTM2MC1cdTEzNjhcdTE0MDBcdTE2NkRcdTE2NkVcdTE2OUJcdTE2OUNcdTE2RUItXHUxNkVEXHUxNzM1XHUxNzM2XHUxN0Q0LVx1MTdENlx1MTdEOC1cdTE3REFcdTE4MDAtXHUxODBBXHUxOTQ0XHUxOTQ1XHUxQTFFXHUxQTFGXHUxQUEwLVx1MUFBNlx1MUFBOC1cdTFBQURcdTFCNUEtXHUxQjYwXHUxQkZDLVx1MUJGRlx1MUMzQi1cdTFDM0ZcdTFDN0VcdTFDN0ZcdTFDQzAtXHUxQ0M3XHUxQ0QzXHUyMDEwLVx1MjAyN1x1MjAzMC1cdTIwNDNcdTIwNDUtXHUyMDUxXHUyMDUzLVx1MjA1RVx1MjA3RFx1MjA3RVx1MjA4RFx1MjA4RVx1MjMyOVx1MjMyQVx1Mjc2OC1cdTI3NzVcdTI3QzVcdTI3QzZcdTI3RTYtXHUyN0VGXHUyOTgzLVx1Mjk5OFx1MjlEOC1cdTI5REJcdTI5RkNcdTI5RkRcdTJDRjktXHUyQ0ZDXHUyQ0ZFXHUyQ0ZGXHUyRDcwXHUyRTAwLVx1MkUyRVx1MkUzMC1cdTJFM0JcdTMwMDEtXHUzMDAzXHUzMDA4LVx1MzAxMVx1MzAxNC1cdTMwMUZcdTMwMzBcdTMwM0RcdTMwQTBcdTMwRkJcdUE0RkVcdUE0RkZcdUE2MEQtXHVBNjBGXHVBNjczXHVBNjdFXHVBNkYyLVx1QTZGN1x1QTg3NC1cdUE4NzdcdUE4Q0VcdUE4Q0ZcdUE4RjgtXHVBOEZBXHVBOTJFXHVBOTJGXHVBOTVGXHVBOUMxLVx1QTlDRFx1QTlERVx1QTlERlx1QUE1Qy1cdUFBNUZcdUFBREVcdUFBREZcdUFBRjBcdUFBRjFcdUFCRUJcdUZEM0VcdUZEM0ZcdUZFMTAtXHVGRTE5XHVGRTMwLVx1RkU1Mlx1RkU1NC1cdUZFNjFcdUZFNjNcdUZFNjhcdUZFNkFcdUZFNkJcdUZGMDEtXHVGRjAzXHVGRjA1LVx1RkYwQVx1RkYwQy1cdUZGMEZcdUZGMUFcdUZGMUJcdUZGMUZcdUZGMjBcdUZGM0ItXHVGRjNEXHVGRjNGXHVGRjVCXHVGRjVEXHVGRjVGLVx1RkY2NV0vOwogIHZhciBDSEFNRUxFT04gPSAvWydcdTIwMThcdTIwMTldLzsKICAvKioKICAgKiBHZXQgdGhlIGRpc3RhbmNlIHRvIHRoZSBlbmQgb2YgdGhlIGZpcnN0IHdvcmQgaW4gYSBzdHJpbmcgb2YgdGV4dC4KICAgKi8KCiAgdmFyIGdldFdvcmREaXN0YW5jZSA9IGZ1bmN0aW9uIGdldFdvcmREaXN0YW5jZSh0ZXh0KSB7CiAgICB2YXIgaXNSVEwgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwogICAgdmFyIGRpc3QgPSAwOwogICAgdmFyIHN0YXJ0ZWQgPSBmYWxzZTsKCiAgICB3aGlsZSAodGV4dC5sZW5ndGggPiAwKSB7CiAgICAgIHZhciBjaGFyRGlzdCA9IGdldENoYXJhY3RlckRpc3RhbmNlKHRleHQsIGlzUlRMKTsKCiAgICAgIHZhciBfc3BsaXRCeUNoYXJhY3RlckRpc3QgPSBzcGxpdEJ5Q2hhcmFjdGVyRGlzdGFuY2UodGV4dCwgY2hhckRpc3QsIGlzUlRMKSwKICAgICAgICAgIF9zcGxpdEJ5Q2hhcmFjdGVyRGlzdDIgPSBfc2xpY2VkVG9BcnJheShfc3BsaXRCeUNoYXJhY3RlckRpc3QsIDIpLAogICAgICAgICAgX2NoYXIyID0gX3NwbGl0QnlDaGFyYWN0ZXJEaXN0MlswXSwKICAgICAgICAgIHJlbWFpbmluZyA9IF9zcGxpdEJ5Q2hhcmFjdGVyRGlzdDJbMV07CgogICAgICBpZiAoaXNXb3JkQ2hhcmFjdGVyKF9jaGFyMiwgcmVtYWluaW5nLCBpc1JUTCkpIHsKICAgICAgICBzdGFydGVkID0gdHJ1ZTsKICAgICAgICBkaXN0ICs9IGNoYXJEaXN0OwogICAgICB9IGVsc2UgaWYgKCFzdGFydGVkKSB7CiAgICAgICAgZGlzdCArPSBjaGFyRGlzdDsKICAgICAgfSBlbHNlIHsKICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgdGV4dCA9IHJlbWFpbmluZzsKICAgIH0KCiAgICByZXR1cm4gZGlzdDsKICB9OwogIC8qKgogICAqIFNwbGl0IGEgc3RyaW5nIGluIHR3byBwYXJ0cyBhdCBhIGdpdmVuIGRpc3RhbmNlIHN0YXJ0aW5nIGZyb20gdGhlIGVuZCB3aGVuCiAgICogYGlzUlRMYCBpcyBzZXQgdG8gYHRydWVgLgogICAqLwoKICB2YXIgc3BsaXRCeUNoYXJhY3RlckRpc3RhbmNlID0gZnVuY3Rpb24gc3BsaXRCeUNoYXJhY3RlckRpc3RhbmNlKHN0ciwgZGlzdCwgaXNSVEwpIHsKICAgIGlmIChpc1JUTCkgewogICAgICB2YXIgYXQgPSBzdHIubGVuZ3RoIC0gZGlzdDsKICAgICAgcmV0dXJuIFtzdHIuc2xpY2UoYXQsIHN0ci5sZW5ndGgpLCBzdHIuc2xpY2UoMCwgYXQpXTsKICAgIH0KCiAgICByZXR1cm4gW3N0ci5zbGljZSgwLCBkaXN0KSwgc3RyLnNsaWNlKGRpc3QpXTsKICB9OwogIC8qKgogICAqIENoZWNrIGlmIGEgY2hhcmFjdGVyIGlzIGEgd29yZCBjaGFyYWN0ZXIuIFRoZSBgcmVtYWluaW5nYCBhcmd1bWVudCBpcyB1c2VkCiAgICogYmVjYXVzZSBzb21ldGltZXMgeW91IG11c3QgcmVhZCBzdWJzZXF1ZW50IGNoYXJhY3RlcnMgdG8gdHJ1bHkgZGV0ZXJtaW5lIGl0LgogICAqLwoKICB2YXIgaXNXb3JkQ2hhcmFjdGVyID0gZnVuY3Rpb24gaXNXb3JkQ2hhcmFjdGVyKF9jaGFyMywgcmVtYWluaW5nKSB7CiAgICB2YXIgaXNSVEwgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IGZhbHNlOwoKICAgIGlmIChTUEFDRS50ZXN0KF9jaGFyMykpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSAvLyBDaGFtZWxlb25zIGNvdW50IGFzIHdvcmQgY2hhcmFjdGVycyBhcyBsb25nIGFzIHRoZXkncmUgaW4gYSB3b3JkLCBzbwogICAgLy8gcmVjdXJzZSB0byBzZWUgaWYgdGhlIG5leHQgb25lIGlzIGEgd29yZCBjaGFyYWN0ZXIgb3Igbm90LgoKCiAgICBpZiAoQ0hBTUVMRU9OLnRlc3QoX2NoYXIzKSkgewogICAgICB2YXIgY2hhckRpc3QgPSBnZXRDaGFyYWN0ZXJEaXN0YW5jZShyZW1haW5pbmcsIGlzUlRMKTsKCiAgICAgIHZhciBfc3BsaXRCeUNoYXJhY3RlckRpc3QzID0gc3BsaXRCeUNoYXJhY3RlckRpc3RhbmNlKHJlbWFpbmluZywgY2hhckRpc3QsIGlzUlRMKSwKICAgICAgICAgIF9zcGxpdEJ5Q2hhcmFjdGVyRGlzdDQgPSBfc2xpY2VkVG9BcnJheShfc3BsaXRCeUNoYXJhY3RlckRpc3QzLCAyKSwKICAgICAgICAgIG5leHRDaGFyID0gX3NwbGl0QnlDaGFyYWN0ZXJEaXN0NFswXSwKICAgICAgICAgIG5leHRSZW1haW5pbmcgPSBfc3BsaXRCeUNoYXJhY3RlckRpc3Q0WzFdOwoKICAgICAgaWYgKGlzV29yZENoYXJhY3RlcihuZXh0Q2hhciwgbmV4dFJlbWFpbmluZywgaXNSVEwpKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgIH0KCiAgICBpZiAoUFVOQ1RVQVRJT04udGVzdChfY2hhcjMpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKICB9OwogIC8qKgogICAqIEl0ZXJhdGUgb24gY29kZXBvaW50cyBmcm9tIHJpZ2h0IHRvIGxlZnQuCiAgICovCgoKICB2YXIgY29kZXBvaW50c0l0ZXJhdG9yUlRMID0gZnVuY3Rpb24qIGNvZGVwb2ludHNJdGVyYXRvclJUTChzdHIpIHsKICAgIHZhciBlbmQgPSBzdHIubGVuZ3RoIC0gMTsKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykgewogICAgICB2YXIgY2hhcjEgPSBzdHIuY2hhckF0KGVuZCAtIGkpOwoKICAgICAgaWYgKGlzTG93U3Vycm9nYXRlKGNoYXIxLmNoYXJDb2RlQXQoMCkpKSB7CiAgICAgICAgdmFyIGNoYXIyID0gc3RyLmNoYXJBdChlbmQgLSBpIC0gMSk7CgogICAgICAgIGlmIChpc0hpZ2hTdXJyb2dhdGUoY2hhcjIuY2hhckNvZGVBdCgwKSkpIHsKICAgICAgICAgIHlpZWxkIGNoYXIyICsgY2hhcjE7CiAgICAgICAgICBpKys7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHlpZWxkIGNoYXIxOwogICAgfQogIH07CiAgLyoqCiAgICogSXMgYGNoYXJDb2RlYCBhIGhpZ2ggc3Vycm9nYXRlLgogICAqCiAgICogaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvVW5pdmVyc2FsX0NoYXJhY3Rlcl9TZXRfY2hhcmFjdGVycyNTdXJyb2dhdGVzCiAgICovCgogIHZhciBpc0hpZ2hTdXJyb2dhdGUgPSBmdW5jdGlvbiBpc0hpZ2hTdXJyb2dhdGUoY2hhckNvZGUpIHsKICAgIHJldHVybiBjaGFyQ29kZSA+PSAweGQ4MDAgJiYgY2hhckNvZGUgPD0gMHhkYmZmOwogIH07CiAgLyoqCiAgICogSXMgYGNoYXJDb2RlYCBhIGxvdyBzdXJyb2dhdGUuCiAgICoKICAgKiBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Vbml2ZXJzYWxfQ2hhcmFjdGVyX1NldF9jaGFyYWN0ZXJzI1N1cnJvZ2F0ZXMKICAgKi8KCgogIHZhciBpc0xvd1N1cnJvZ2F0ZSA9IGZ1bmN0aW9uIGlzTG93U3Vycm9nYXRlKGNoYXJDb2RlKSB7CiAgICByZXR1cm4gY2hhckNvZGUgPj0gMHhkYzAwICYmIGNoYXJDb2RlIDw9IDB4ZGZmZjsKICB9OwoKICB2YXIgQ29kZXBvaW50VHlwZTsKCiAgKGZ1bmN0aW9uIChDb2RlcG9pbnRUeXBlKSB7CiAgICBDb2RlcG9pbnRUeXBlW0NvZGVwb2ludFR5cGVbIk5vbmUiXSA9IDBdID0gIk5vbmUiOwogICAgQ29kZXBvaW50VHlwZVtDb2RlcG9pbnRUeXBlWyJFeHRlbmQiXSA9IDFdID0gIkV4dGVuZCI7CiAgICBDb2RlcG9pbnRUeXBlW0NvZGVwb2ludFR5cGVbIlpXSiJdID0gMl0gPSAiWldKIjsKICAgIENvZGVwb2ludFR5cGVbQ29kZXBvaW50VHlwZVsiUkkiXSA9IDRdID0gIlJJIjsKICAgIENvZGVwb2ludFR5cGVbQ29kZXBvaW50VHlwZVsiUHJlcGVuZCJdID0gOF0gPSAiUHJlcGVuZCI7CiAgICBDb2RlcG9pbnRUeXBlW0NvZGVwb2ludFR5cGVbIlNwYWNpbmdNYXJrIl0gPSAxNl0gPSAiU3BhY2luZ01hcmsiOwogICAgQ29kZXBvaW50VHlwZVtDb2RlcG9pbnRUeXBlWyJMIl0gPSAzMl0gPSAiTCI7CiAgICBDb2RlcG9pbnRUeXBlW0NvZGVwb2ludFR5cGVbIlYiXSA9IDY0XSA9ICJWIjsKICAgIENvZGVwb2ludFR5cGVbQ29kZXBvaW50VHlwZVsiVCJdID0gMTI4XSA9ICJUIjsKICAgIENvZGVwb2ludFR5cGVbQ29kZXBvaW50VHlwZVsiTFYiXSA9IDI1Nl0gPSAiTFYiOwogICAgQ29kZXBvaW50VHlwZVtDb2RlcG9pbnRUeXBlWyJMVlQiXSA9IDUxMl0gPSAiTFZUIjsKICAgIENvZGVwb2ludFR5cGVbQ29kZXBvaW50VHlwZVsiRXh0UGljdCJdID0gMTAyNF0gPSAiRXh0UGljdCI7CiAgICBDb2RlcG9pbnRUeXBlW0NvZGVwb2ludFR5cGVbIkFueSJdID0gMjA0OF0gPSAiQW55IjsKICB9KShDb2RlcG9pbnRUeXBlIHx8IChDb2RlcG9pbnRUeXBlID0ge30pKTsKCiAgdmFyIHJlRXh0ZW5kID0gL14oPzpbXHUwMzAwLVx1MDM2Rlx1MDQ4My1cdTA0ODlcdTA1OTEtXHUwNUJEXHUwNUJGXHUwNUMxXHUwNUMyXHUwNUM0XHUwNUM1XHUwNUM3XHUwNjEwLVx1MDYxQVx1MDY0Qi1cdTA2NUZcdTA2NzBcdTA2RDYtXHUwNkRDXHUwNkRGLVx1MDZFNFx1MDZFN1x1MDZFOFx1MDZFQS1cdTA2RURcdTA3MTFcdTA3MzAtXHUwNzRBXHUwN0E2LVx1MDdCMFx1MDdFQi1cdTA3RjNcdTA3RkRcdTA4MTYtXHUwODE5XHUwODFCLVx1MDgyM1x1MDgyNS1cdTA4MjdcdTA4MjktXHUwODJEXHUwODU5LVx1MDg1Qlx1MDhEMy1cdTA4RTFcdTA4RTMtXHUwOTAyXHUwOTNBXHUwOTNDXHUwOTQxLVx1MDk0OFx1MDk0RFx1MDk1MS1cdTA5NTdcdTA5NjJcdTA5NjNcdTA5ODFcdTA5QkNcdTA5QkVcdTA5QzEtXHUwOUM0XHUwOUNEXHUwOUQ3XHUwOUUyXHUwOUUzXHUwOUZFXHUwQTAxXHUwQTAyXHUwQTNDXHUwQTQxXHUwQTQyXHUwQTQ3XHUwQTQ4XHUwQTRCLVx1MEE0RFx1MEE1MVx1MEE3MFx1MEE3MVx1MEE3NVx1MEE4MVx1MEE4Mlx1MEFCQ1x1MEFDMS1cdTBBQzVcdTBBQzdcdTBBQzhcdTBBQ0RcdTBBRTJcdTBBRTNcdTBBRkEtXHUwQUZGXHUwQjAxXHUwQjNDXHUwQjNFXHUwQjNGXHUwQjQxLVx1MEI0NFx1MEI0RFx1MEI1NS1cdTBCNTdcdTBCNjJcdTBCNjNcdTBCODJcdTBCQkVcdTBCQzBcdTBCQ0RcdTBCRDdcdTBDMDBcdTBDMDRcdTBDM0UtXHUwQzQwXHUwQzQ2LVx1MEM0OFx1MEM0QS1cdTBDNERcdTBDNTVcdTBDNTZcdTBDNjJcdTBDNjNcdTBDODFcdTBDQkNcdTBDQkZcdTBDQzJcdTBDQzZcdTBDQ0NcdTBDQ0RcdTBDRDVcdTBDRDZcdTBDRTJcdTBDRTNcdTBEMDBcdTBEMDFcdTBEM0JcdTBEM0NcdTBEM0VcdTBENDEtXHUwRDQ0XHUwRDREXHUwRDU3XHUwRDYyXHUwRDYzXHUwRDgxXHUwRENBXHUwRENGXHUwREQyLVx1MERENFx1MERENlx1MERERlx1MEUzMVx1MEUzNC1cdTBFM0FcdTBFNDctXHUwRTRFXHUwRUIxXHUwRUI0LVx1MEVCQ1x1MEVDOC1cdTBFQ0RcdTBGMThcdTBGMTlcdTBGMzVcdTBGMzdcdTBGMzlcdTBGNzEtXHUwRjdFXHUwRjgwLVx1MEY4NFx1MEY4Nlx1MEY4N1x1MEY4RC1cdTBGOTdcdTBGOTktXHUwRkJDXHUwRkM2XHUxMDJELVx1MTAzMFx1MTAzMi1cdTEwMzdcdTEwMzlcdTEwM0FcdTEwM0RcdTEwM0VcdTEwNThcdTEwNTlcdTEwNUUtXHUxMDYwXHUxMDcxLVx1MTA3NFx1MTA4Mlx1MTA4NVx1MTA4Nlx1MTA4RFx1MTA5RFx1MTM1RC1cdTEzNUZcdTE3MTItXHUxNzE0XHUxNzMyLVx1MTczNFx1MTc1Mlx1MTc1M1x1MTc3Mlx1MTc3M1x1MTdCNFx1MTdCNVx1MTdCNy1cdTE3QkRcdTE3QzZcdTE3QzktXHUxN0QzXHUxN0REXHUxODBCLVx1MTgwRFx1MTg4NVx1MTg4Nlx1MThBOVx1MTkyMC1cdTE5MjJcdTE5MjdcdTE5MjhcdTE5MzJcdTE5MzktXHUxOTNCXHUxQTE3XHUxQTE4XHUxQTFCXHUxQTU2XHUxQTU4LVx1MUE1RVx1MUE2MFx1MUE2Mlx1MUE2NS1cdTFBNkNcdTFBNzMtXHUxQTdDXHUxQTdGXHUxQUIwLVx1MUFDMFx1MUIwMC1cdTFCMDNcdTFCMzQtXHUxQjNBXHUxQjNDXHUxQjQyXHUxQjZCLVx1MUI3M1x1MUI4MFx1MUI4MVx1MUJBMi1cdTFCQTVcdTFCQThcdTFCQTlcdTFCQUItXHUxQkFEXHUxQkU2XHUxQkU4XHUxQkU5XHUxQkVEXHUxQkVGLVx1MUJGMVx1MUMyQy1cdTFDMzNcdTFDMzZcdTFDMzdcdTFDRDAtXHUxQ0QyXHUxQ0Q0LVx1MUNFMFx1MUNFMi1cdTFDRThcdTFDRURcdTFDRjRcdTFDRjhcdTFDRjlcdTFEQzAtXHUxREY5XHUxREZCLVx1MURGRlx1MjAwQ1x1MjBEMC1cdTIwRjBcdTJDRUYtXHUyQ0YxXHUyRDdGXHUyREUwLVx1MkRGRlx1MzAyQS1cdTMwMkZcdTMwOTlcdTMwOUFcdUE2NkYtXHVBNjcyXHVBNjc0LVx1QTY3RFx1QTY5RVx1QTY5Rlx1QTZGMFx1QTZGMVx1QTgwMlx1QTgwNlx1QTgwQlx1QTgyNVx1QTgyNlx1QTgyQ1x1QThDNFx1QThDNVx1QThFMC1cdUE4RjFcdUE4RkZcdUE5MjYtXHVBOTJEXHVBOTQ3LVx1QTk1MVx1QTk4MC1cdUE5ODJcdUE5QjNcdUE5QjYtXHVBOUI5XHVBOUJDXHVBOUJEXHVBOUU1XHVBQTI5LVx1QUEyRVx1QUEzMVx1QUEzMlx1QUEzNVx1QUEzNlx1QUE0M1x1QUE0Q1x1QUE3Q1x1QUFCMFx1QUFCMi1cdUFBQjRcdUFBQjdcdUFBQjhcdUFBQkVcdUFBQkZcdUFBQzFcdUFBRUNcdUFBRURcdUFBRjZcdUFCRTVcdUFCRThcdUFCRURcdUZCMUVcdUZFMDAtXHVGRTBGXHVGRTIwLVx1RkUyRlx1RkY5RVx1RkY5Rl18XHVEODAwW1x1RERGRFx1REVFMFx1REY3Ni1cdURGN0FdfFx1RDgwMltcdURFMDEtXHVERTAzXHVERTA1XHVERTA2XHVERTBDLVx1REUwRlx1REUzOC1cdURFM0FcdURFM0ZcdURFRTVcdURFRTZdfFx1RDgwM1tcdUREMjQtXHVERDI3XHVERUFCXHVERUFDXHVERjQ2LVx1REY1MF18XHVEODA0W1x1REMwMVx1REMzOC1cdURDNDZcdURDN0YtXHVEQzgxXHVEQ0IzLVx1RENCNlx1RENCOVx1RENCQVx1REQwMC1cdUREMDJcdUREMjctXHVERDJCXHVERDJELVx1REQzNFx1REQ3M1x1REQ4MFx1REQ4MVx1RERCNi1cdUREQkVcdUREQzktXHVERENDXHVERENGXHVERTJGLVx1REUzMVx1REUzNFx1REUzNlx1REUzN1x1REUzRVx1REVERlx1REVFMy1cdURFRUFcdURGMDBcdURGMDFcdURGM0JcdURGM0NcdURGM0VcdURGNDBcdURGNTdcdURGNjYtXHVERjZDXHVERjcwLVx1REY3NF18XHVEODA1W1x1REMzOC1cdURDM0ZcdURDNDItXHVEQzQ0XHVEQzQ2XHVEQzVFXHVEQ0IwXHVEQ0IzLVx1RENCOFx1RENCQVx1RENCRFx1RENCRlx1RENDMFx1RENDMlx1RENDM1x1RERBRlx1RERCMi1cdUREQjVcdUREQkNcdUREQkRcdUREQkZcdUREQzBcdURERENcdURERERcdURFMzMtXHVERTNBXHVERTNEXHVERTNGXHVERTQwXHVERUFCXHVERUFEXHVERUIwLVx1REVCNVx1REVCN1x1REYxRC1cdURGMUZcdURGMjItXHVERjI1XHVERjI3LVx1REYyQl18XHVEODA2W1x1REMyRi1cdURDMzdcdURDMzlcdURDM0FcdUREMzBcdUREM0JcdUREM0NcdUREM0VcdURENDNcdURERDQtXHVEREQ3XHVERERBXHVERERCXHVEREUwXHVERTAxLVx1REUwQVx1REUzMy1cdURFMzhcdURFM0ItXHVERTNFXHVERTQ3XHVERTUxLVx1REU1Nlx1REU1OS1cdURFNUJcdURFOEEtXHVERTk2XHVERTk4XHVERTk5XXxcdUQ4MDdbXHVEQzMwLVx1REMzNlx1REMzOC1cdURDM0RcdURDM0ZcdURDOTItXHVEQ0E3XHVEQ0FBLVx1RENCMFx1RENCMlx1RENCM1x1RENCNVx1RENCNlx1REQzMS1cdUREMzZcdUREM0FcdUREM0NcdUREM0RcdUREM0YtXHVERDQ1XHVERDQ3XHVERDkwXHVERDkxXHVERDk1XHVERDk3XHVERUYzXHVERUY0XXxcdUQ4MUFbXHVERUYwLVx1REVGNFx1REYzMC1cdURGMzZdfFx1RDgxQltcdURGNEZcdURGOEYtXHVERjkyXHVERkU0XXxcdUQ4MkZbXHVEQzlEXHVEQzlFXXxcdUQ4MzRbXHVERDY1XHVERDY3LVx1REQ2OVx1REQ2RS1cdURENzJcdUREN0ItXHVERDgyXHVERDg1LVx1REQ4Qlx1RERBQS1cdUREQURcdURFNDItXHVERTQ0XXxcdUQ4MzZbXHVERTAwLVx1REUzNlx1REUzQi1cdURFNkNcdURFNzVcdURFODRcdURFOUItXHVERTlGXHVERUExLVx1REVBRl18XHVEODM4W1x1REMwMC1cdURDMDZcdURDMDgtXHVEQzE4XHVEQzFCLVx1REMyMVx1REMyM1x1REMyNFx1REMyNi1cdURDMkFcdUREMzAtXHVERDM2XHVERUVDLVx1REVFRl18XHVEODNBW1x1RENEMC1cdURDRDZcdURENDQtXHVERDRBXXxcdUQ4M0NbXHVERkZCLVx1REZGRl18XHVEQjQwW1x1REMyMC1cdURDN0ZcdUREMDAtXHVEREVGXSkkLzsKICB2YXIgcmVQcmVwZW5kID0gL14oPzpbXHUwNjAwLVx1MDYwNVx1MDZERFx1MDcwRlx1MDg5MFx1MDg5MVx1MDhFMlx1MEQ0RV18XHVEODA0W1x1RENCRFx1RENDRFx1RERDMlx1RERDM118XHVEODA2W1x1REQzRlx1REQ0MVx1REUzQVx1REU4NC1cdURFODldfFx1RDgwN1x1REQ0NikkLzsKICB2YXIgcmVTcGFjaW5nTWFyayA9IC9eKD86W1x1MDkwM1x1MDkzQlx1MDkzRS1cdTA5NDBcdTA5NDktXHUwOTRDXHUwOTRFXHUwOTRGXHUwOTgyXHUwOTgzXHUwOUJGXHUwOUMwXHUwOUM3XHUwOUM4XHUwOUNCXHUwOUNDXHUwQTAzXHUwQTNFLVx1MEE0MFx1MEE4M1x1MEFCRS1cdTBBQzBcdTBBQzlcdTBBQ0JcdTBBQ0NcdTBCMDJcdTBCMDNcdTBCNDBcdTBCNDdcdTBCNDhcdTBCNEJcdTBCNENcdTBCQkZcdTBCQzFcdTBCQzJcdTBCQzYtXHUwQkM4XHUwQkNBLVx1MEJDQ1x1MEMwMS1cdTBDMDNcdTBDNDEtXHUwQzQ0XHUwQzgyXHUwQzgzXHUwQ0JFXHUwQ0MwXHUwQ0MxXHUwQ0MzXHUwQ0M0XHUwQ0M3XHUwQ0M4XHUwQ0NBXHUwQ0NCXHUwRDAyXHUwRDAzXHUwRDNGXHUwRDQwXHUwRDQ2LVx1MEQ0OFx1MEQ0QS1cdTBENENcdTBEODJcdTBEODNcdTBERDBcdTBERDFcdTBERDgtXHUwRERFXHUwREYyXHUwREYzXHUwRTMzXHUwRUIzXHUwRjNFXHUwRjNGXHUwRjdGXHUxMDMxXHUxMDNCXHUxMDNDXHUxMDU2XHUxMDU3XHUxMDg0XHUxNzE1XHUxNzM0XHUxN0I2XHUxN0JFLVx1MTdDNVx1MTdDN1x1MTdDOFx1MTkyMy1cdTE5MjZcdTE5MjktXHUxOTJCXHUxOTMwXHUxOTMxXHUxOTMzLVx1MTkzOFx1MUExOVx1MUExQVx1MUE1NVx1MUE1N1x1MUE2RC1cdTFBNzJcdTFCMDRcdTFCM0JcdTFCM0QtXHUxQjQxXHUxQjQzXHUxQjQ0XHUxQjgyXHUxQkExXHUxQkE2XHUxQkE3XHUxQkFBXHUxQkU3XHUxQkVBLVx1MUJFQ1x1MUJFRVx1MUJGMlx1MUJGM1x1MUMyNC1cdTFDMkJcdTFDMzRcdTFDMzVcdTFDRTFcdTFDRjdcdUE4MjNcdUE4MjRcdUE4MjdcdUE4ODBcdUE4ODFcdUE4QjQtXHVBOEMzXHVBOTUyXHVBOTUzXHVBOTgzXHVBOUI0XHVBOUI1XHVBOUJBXHVBOUJCXHVBOUJFLVx1QTlDMFx1QUEyRlx1QUEzMFx1QUEzM1x1QUEzNFx1QUE0RFx1QUFFQlx1QUFFRVx1QUFFRlx1QUFGNVx1QUJFM1x1QUJFNFx1QUJFNlx1QUJFN1x1QUJFOVx1QUJFQVx1QUJFQ118XHVEODA0W1x1REMwMFx1REMwMlx1REM4Mlx1RENCMC1cdURDQjJcdURDQjdcdURDQjhcdUREMkNcdURENDVcdURENDZcdUREODJcdUREQjMtXHVEREI1XHVEREJGXHVEREMwXHVERENFXHVERTJDLVx1REUyRVx1REUzMlx1REUzM1x1REUzNVx1REVFMC1cdURFRTJcdURGMDJcdURGMDNcdURGM0ZcdURGNDEtXHVERjQ0XHVERjQ3XHVERjQ4XHVERjRCLVx1REY0RFx1REY2Mlx1REY2M118XHVEODA1W1x1REMzNS1cdURDMzdcdURDNDBcdURDNDFcdURDNDVcdURDQjFcdURDQjJcdURDQjlcdURDQkJcdURDQkNcdURDQkVcdURDQzFcdUREQjBcdUREQjFcdUREQjgtXHVEREJCXHVEREJFXHVERTMwLVx1REUzMlx1REUzQlx1REUzQ1x1REUzRVx1REVBQ1x1REVBRVx1REVBRlx1REVCNlx1REYyNl18XHVEODA2W1x1REMyQy1cdURDMkVcdURDMzhcdUREMzEtXHVERDM1XHVERDM3XHVERDM4XHVERDNEXHVERDQwXHVERDQyXHVEREQxLVx1REREM1x1REREQy1cdUREREZcdURERTRcdURFMzlcdURFNTdcdURFNThcdURFOTddfFx1RDgwN1tcdURDMkZcdURDM0VcdURDQTlcdURDQjFcdURDQjRcdUREOEEtXHVERDhFXHVERDkzXHVERDk0XHVERDk2XHVERUY1XHVERUY2XXxcdUQ4MUJbXHVERjUxLVx1REY4N1x1REZGMFx1REZGMV18XHVEODM0W1x1REQ2Nlx1REQ2RF0pJC87CiAgdmFyIHJlTCA9IC9eW1x1MTEwMC1cdTExNUZcdUE5NjAtXHVBOTdDXSQvOwogIHZhciByZVYgPSAvXltcdTExNjAtXHUxMUE3XHVEN0IwLVx1RDdDNl0kLzsKICB2YXIgcmVUID0gL15bXHUxMUE4LVx1MTFGRlx1RDdDQi1cdUQ3RkJdJC87CiAgdmFyIHJlTFYgPSAvXltcdUFDMDBcdUFDMUNcdUFDMzhcdUFDNTRcdUFDNzBcdUFDOENcdUFDQThcdUFDQzRcdUFDRTBcdUFDRkNcdUFEMThcdUFEMzRcdUFENTBcdUFENkNcdUFEODhcdUFEQTRcdUFEQzBcdUFERENcdUFERjhcdUFFMTRcdUFFMzBcdUFFNENcdUFFNjhcdUFFODRcdUFFQTBcdUFFQkNcdUFFRDhcdUFFRjRcdUFGMTBcdUFGMkNcdUFGNDhcdUFGNjRcdUFGODBcdUFGOUNcdUFGQjhcdUFGRDRcdUFGRjBcdUIwMENcdUIwMjhcdUIwNDRcdUIwNjBcdUIwN0NcdUIwOThcdUIwQjRcdUIwRDBcdUIwRUNcdUIxMDhcdUIxMjRcdUIxNDBcdUIxNUNcdUIxNzhcdUIxOTRcdUIxQjBcdUIxQ0NcdUIxRThcdUIyMDRcdUIyMjBcdUIyM0NcdUIyNThcdUIyNzRcdUIyOTBcdUIyQUNcdUIyQzhcdUIyRTRcdUIzMDBcdUIzMUNcdUIzMzhcdUIzNTRcdUIzNzBcdUIzOENcdUIzQThcdUIzQzRcdUIzRTBcdUIzRkNcdUI0MThcdUI0MzRcdUI0NTBcdUI0NkNcdUI0ODhcdUI0QTRcdUI0QzBcdUI0RENcdUI0RjhcdUI1MTRcdUI1MzBcdUI1NENcdUI1NjhcdUI1ODRcdUI1QTBcdUI1QkNcdUI1RDhcdUI1RjRcdUI2MTBcdUI2MkNcdUI2NDhcdUI2NjRcdUI2ODBcdUI2OUNcdUI2QjhcdUI2RDRcdUI2RjBcdUI3MENcdUI3MjhcdUI3NDRcdUI3NjBcdUI3N0NcdUI3OThcdUI3QjRcdUI3RDBcdUI3RUNcdUI4MDhcdUI4MjRcdUI4NDBcdUI4NUNcdUI4NzhcdUI4OTRcdUI4QjBcdUI4Q0NcdUI4RThcdUI5MDRcdUI5MjBcdUI5M0NcdUI5NThcdUI5NzRcdUI5OTBcdUI5QUNcdUI5QzhcdUI5RTRcdUJBMDBcdUJBMUNcdUJBMzhcdUJBNTRcdUJBNzBcdUJBOENcdUJBQThcdUJBQzRcdUJBRTBcdUJBRkNcdUJCMThcdUJCMzRcdUJCNTBcdUJCNkNcdUJCODhcdUJCQTRcdUJCQzBcdUJCRENcdUJCRjhcdUJDMTRcdUJDMzBcdUJDNENcdUJDNjhcdUJDODRcdUJDQTBcdUJDQkNcdUJDRDhcdUJDRjRcdUJEMTBcdUJEMkNcdUJENDhcdUJENjRcdUJEODBcdUJEOUNcdUJEQjhcdUJERDRcdUJERjBcdUJFMENcdUJFMjhcdUJFNDRcdUJFNjBcdUJFN0NcdUJFOThcdUJFQjRcdUJFRDBcdUJFRUNcdUJGMDhcdUJGMjRcdUJGNDBcdUJGNUNcdUJGNzhcdUJGOTRcdUJGQjBcdUJGQ0NcdUJGRThcdUMwMDRcdUMwMjBcdUMwM0NcdUMwNThcdUMwNzRcdUMwOTBcdUMwQUNcdUMwQzhcdUMwRTRcdUMxMDBcdUMxMUNcdUMxMzhcdUMxNTRcdUMxNzBcdUMxOENcdUMxQThcdUMxQzRcdUMxRTBcdUMxRkNcdUMyMThcdUMyMzRcdUMyNTBcdUMyNkNcdUMyODhcdUMyQTRcdUMyQzBcdUMyRENcdUMyRjhcdUMzMTRcdUMzMzBcdUMzNENcdUMzNjhcdUMzODRcdUMzQTBcdUMzQkNcdUMzRDhcdUMzRjRcdUM0MTBcdUM0MkNcdUM0NDhcdUM0NjRcdUM0ODBcdUM0OUNcdUM0QjhcdUM0RDRcdUM0RjBcdUM1MENcdUM1MjhcdUM1NDRcdUM1NjBcdUM1N0NcdUM1OThcdUM1QjRcdUM1RDBcdUM1RUNcdUM2MDhcdUM2MjRcdUM2NDBcdUM2NUNcdUM2NzhcdUM2OTRcdUM2QjBcdUM2Q0NcdUM2RThcdUM3MDRcdUM3MjBcdUM3M0NcdUM3NThcdUM3NzRcdUM3OTBcdUM3QUNcdUM3QzhcdUM3RTRcdUM4MDBcdUM4MUNcdUM4MzhcdUM4NTRcdUM4NzBcdUM4OENcdUM4QThcdUM4QzRcdUM4RTBcdUM4RkNcdUM5MThcdUM5MzRcdUM5NTBcdUM5NkNcdUM5ODhcdUM5QTRcdUM5QzBcdUM5RENcdUM5RjhcdUNBMTRcdUNBMzBcdUNBNENcdUNBNjhcdUNBODRcdUNBQTBcdUNBQkNcdUNBRDhcdUNBRjRcdUNCMTBcdUNCMkNcdUNCNDhcdUNCNjRcdUNCODBcdUNCOUNcdUNCQjhcdUNCRDRcdUNCRjBcdUNDMENcdUNDMjhcdUNDNDRcdUNDNjBcdUNDN0NcdUNDOThcdUNDQjRcdUNDRDBcdUNDRUNcdUNEMDhcdUNEMjRcdUNENDBcdUNENUNcdUNENzhcdUNEOTRcdUNEQjBcdUNEQ0NcdUNERThcdUNFMDRcdUNFMjBcdUNFM0NcdUNFNThcdUNFNzRcdUNFOTBcdUNFQUNcdUNFQzhcdUNFRTRcdUNGMDBcdUNGMUNcdUNGMzhcdUNGNTRcdUNGNzBcdUNGOENcdUNGQThcdUNGQzRcdUNGRTBcdUNGRkNcdUQwMThcdUQwMzRcdUQwNTBcdUQwNkNcdUQwODhcdUQwQTRcdUQwQzBcdUQwRENcdUQwRjhcdUQxMTRcdUQxMzBcdUQxNENcdUQxNjhcdUQxODRcdUQxQTBcdUQxQkNcdUQxRDhcdUQxRjRcdUQyMTBcdUQyMkNcdUQyNDhcdUQyNjRcdUQyODBcdUQyOUNcdUQyQjhcdUQyRDRcdUQyRjBcdUQzMENcdUQzMjhcdUQzNDRcdUQzNjBcdUQzN0NcdUQzOThcdUQzQjRcdUQzRDBcdUQzRUNcdUQ0MDhcdUQ0MjRcdUQ0NDBcdUQ0NUNcdUQ0NzhcdUQ0OTRcdUQ0QjBcdUQ0Q0NcdUQ0RThcdUQ1MDRcdUQ1MjBcdUQ1M0NcdUQ1NThcdUQ1NzRcdUQ1OTBcdUQ1QUNcdUQ1QzhcdUQ1RTRcdUQ2MDBcdUQ2MUNcdUQ2MzhcdUQ2NTRcdUQ2NzBcdUQ2OENcdUQ2QThcdUQ2QzRcdUQ2RTBcdUQ2RkNcdUQ3MThcdUQ3MzRcdUQ3NTBcdUQ3NkNcdUQ3ODhdJC87CiAgdmFyIHJlTFZUID0gL15bXHVBQzAxLVx1QUMxQlx1QUMxRC1cdUFDMzdcdUFDMzktXHVBQzUzXHVBQzU1LVx1QUM2Rlx1QUM3MS1cdUFDOEJcdUFDOEQtXHVBQ0E3XHVBQ0E5LVx1QUNDM1x1QUNDNS1cdUFDREZcdUFDRTEtXHVBQ0ZCXHVBQ0ZELVx1QUQxN1x1QUQxOS1cdUFEMzNcdUFEMzUtXHVBRDRGXHVBRDUxLVx1QUQ2Qlx1QUQ2RC1cdUFEODdcdUFEODktXHVBREEzXHVBREE1LVx1QURCRlx1QURDMS1cdUFEREJcdUFEREQtXHVBREY3XHVBREY5LVx1QUUxM1x1QUUxNS1cdUFFMkZcdUFFMzEtXHVBRTRCXHVBRTRELVx1QUU2N1x1QUU2OS1cdUFFODNcdUFFODUtXHVBRTlGXHVBRUExLVx1QUVCQlx1QUVCRC1cdUFFRDdcdUFFRDktXHVBRUYzXHVBRUY1LVx1QUYwRlx1QUYxMS1cdUFGMkJcdUFGMkQtXHVBRjQ3XHVBRjQ5LVx1QUY2M1x1QUY2NS1cdUFGN0ZcdUFGODEtXHVBRjlCXHVBRjlELVx1QUZCN1x1QUZCOS1cdUFGRDNcdUFGRDUtXHVBRkVGXHVBRkYxLVx1QjAwQlx1QjAwRC1cdUIwMjdcdUIwMjktXHVCMDQzXHVCMDQ1LVx1QjA1Rlx1QjA2MS1cdUIwN0JcdUIwN0QtXHVCMDk3XHVCMDk5LVx1QjBCM1x1QjBCNS1cdUIwQ0ZcdUIwRDEtXHVCMEVCXHVCMEVELVx1QjEwN1x1QjEwOS1cdUIxMjNcdUIxMjUtXHVCMTNGXHVCMTQxLVx1QjE1Qlx1QjE1RC1cdUIxNzdcdUIxNzktXHVCMTkzXHVCMTk1LVx1QjFBRlx1QjFCMS1cdUIxQ0JcdUIxQ0QtXHVCMUU3XHVCMUU5LVx1QjIwM1x1QjIwNS1cdUIyMUZcdUIyMjEtXHVCMjNCXHVCMjNELVx1QjI1N1x1QjI1OS1cdUIyNzNcdUIyNzUtXHVCMjhGXHVCMjkxLVx1QjJBQlx1QjJBRC1cdUIyQzdcdUIyQzktXHVCMkUzXHVCMkU1LVx1QjJGRlx1QjMwMS1cdUIzMUJcdUIzMUQtXHVCMzM3XHVCMzM5LVx1QjM1M1x1QjM1NS1cdUIzNkZcdUIzNzEtXHVCMzhCXHVCMzhELVx1QjNBN1x1QjNBOS1cdUIzQzNcdUIzQzUtXHVCM0RGXHVCM0UxLVx1QjNGQlx1QjNGRC1cdUI0MTdcdUI0MTktXHVCNDMzXHVCNDM1LVx1QjQ0Rlx1QjQ1MS1cdUI0NkJcdUI0NkQtXHVCNDg3XHVCNDg5LVx1QjRBM1x1QjRBNS1cdUI0QkZcdUI0QzEtXHVCNERCXHVCNERELVx1QjRGN1x1QjRGOS1cdUI1MTNcdUI1MTUtXHVCNTJGXHVCNTMxLVx1QjU0Qlx1QjU0RC1cdUI1NjdcdUI1NjktXHVCNTgzXHVCNTg1LVx1QjU5Rlx1QjVBMS1cdUI1QkJcdUI1QkQtXHVCNUQ3XHVCNUQ5LVx1QjVGM1x1QjVGNS1cdUI2MEZcdUI2MTEtXHVCNjJCXHVCNjJELVx1QjY0N1x1QjY0OS1cdUI2NjNcdUI2NjUtXHVCNjdGXHVCNjgxLVx1QjY5Qlx1QjY5RC1cdUI2QjdcdUI2QjktXHVCNkQzXHVCNkQ1LVx1QjZFRlx1QjZGMS1cdUI3MEJcdUI3MEQtXHVCNzI3XHVCNzI5LVx1Qjc0M1x1Qjc0NS1cdUI3NUZcdUI3NjEtXHVCNzdCXHVCNzdELVx1Qjc5N1x1Qjc5OS1cdUI3QjNcdUI3QjUtXHVCN0NGXHVCN0QxLVx1QjdFQlx1QjdFRC1cdUI4MDdcdUI4MDktXHVCODIzXHVCODI1LVx1QjgzRlx1Qjg0MS1cdUI4NUJcdUI4NUQtXHVCODc3XHVCODc5LVx1Qjg5M1x1Qjg5NS1cdUI4QUZcdUI4QjEtXHVCOENCXHVCOENELVx1QjhFN1x1QjhFOS1cdUI5MDNcdUI5MDUtXHVCOTFGXHVCOTIxLVx1QjkzQlx1QjkzRC1cdUI5NTdcdUI5NTktXHVCOTczXHVCOTc1LVx1Qjk4Rlx1Qjk5MS1cdUI5QUJcdUI5QUQtXHVCOUM3XHVCOUM5LVx1QjlFM1x1QjlFNS1cdUI5RkZcdUJBMDEtXHVCQTFCXHVCQTFELVx1QkEzN1x1QkEzOS1cdUJBNTNcdUJBNTUtXHVCQTZGXHVCQTcxLVx1QkE4Qlx1QkE4RC1cdUJBQTdcdUJBQTktXHVCQUMzXHVCQUM1LVx1QkFERlx1QkFFMS1cdUJBRkJcdUJBRkQtXHVCQjE3XHVCQjE5LVx1QkIzM1x1QkIzNS1cdUJCNEZcdUJCNTEtXHVCQjZCXHVCQjZELVx1QkI4N1x1QkI4OS1cdUJCQTNcdUJCQTUtXHVCQkJGXHVCQkMxLVx1QkJEQlx1QkJERC1cdUJCRjdcdUJCRjktXHVCQzEzXHVCQzE1LVx1QkMyRlx1QkMzMS1cdUJDNEJcdUJDNEQtXHVCQzY3XHVCQzY5LVx1QkM4M1x1QkM4NS1cdUJDOUZcdUJDQTEtXHVCQ0JCXHVCQ0JELVx1QkNEN1x1QkNEOS1cdUJDRjNcdUJDRjUtXHVCRDBGXHVCRDExLVx1QkQyQlx1QkQyRC1cdUJENDdcdUJENDktXHVCRDYzXHVCRDY1LVx1QkQ3Rlx1QkQ4MS1cdUJEOUJcdUJEOUQtXHVCREI3XHVCREI5LVx1QkREM1x1QkRENS1cdUJERUZcdUJERjEtXHVCRTBCXHVCRTBELVx1QkUyN1x1QkUyOS1cdUJFNDNcdUJFNDUtXHVCRTVGXHVCRTYxLVx1QkU3Qlx1QkU3RC1cdUJFOTdcdUJFOTktXHVCRUIzXHVCRUI1LVx1QkVDRlx1QkVEMS1cdUJFRUJcdUJFRUQtXHVCRjA3XHVCRjA5LVx1QkYyM1x1QkYyNS1cdUJGM0ZcdUJGNDEtXHVCRjVCXHVCRjVELVx1QkY3N1x1QkY3OS1cdUJGOTNcdUJGOTUtXHVCRkFGXHVCRkIxLVx1QkZDQlx1QkZDRC1cdUJGRTdcdUJGRTktXHVDMDAzXHVDMDA1LVx1QzAxRlx1QzAyMS1cdUMwM0JcdUMwM0QtXHVDMDU3XHVDMDU5LVx1QzA3M1x1QzA3NS1cdUMwOEZcdUMwOTEtXHVDMEFCXHVDMEFELVx1QzBDN1x1QzBDOS1cdUMwRTNcdUMwRTUtXHVDMEZGXHVDMTAxLVx1QzExQlx1QzExRC1cdUMxMzdcdUMxMzktXHVDMTUzXHVDMTU1LVx1QzE2Rlx1QzE3MS1cdUMxOEJcdUMxOEQtXHVDMUE3XHVDMUE5LVx1QzFDM1x1QzFDNS1cdUMxREZcdUMxRTEtXHVDMUZCXHVDMUZELVx1QzIxN1x1QzIxOS1cdUMyMzNcdUMyMzUtXHVDMjRGXHVDMjUxLVx1QzI2Qlx1QzI2RC1cdUMyODdcdUMyODktXHVDMkEzXHVDMkE1LVx1QzJCRlx1QzJDMS1cdUMyREJcdUMyREQtXHVDMkY3XHVDMkY5LVx1QzMxM1x1QzMxNS1cdUMzMkZcdUMzMzEtXHVDMzRCXHVDMzRELVx1QzM2N1x1QzM2OS1cdUMzODNcdUMzODUtXHVDMzlGXHVDM0ExLVx1QzNCQlx1QzNCRC1cdUMzRDdcdUMzRDktXHVDM0YzXHVDM0Y1LVx1QzQwRlx1QzQxMS1cdUM0MkJcdUM0MkQtXHVDNDQ3XHVDNDQ5LVx1QzQ2M1x1QzQ2NS1cdUM0N0ZcdUM0ODEtXHVDNDlCXHVDNDlELVx1QzRCN1x1QzRCOS1cdUM0RDNcdUM0RDUtXHVDNEVGXHVDNEYxLVx1QzUwQlx1QzUwRC1cdUM1MjdcdUM1MjktXHVDNTQzXHVDNTQ1LVx1QzU1Rlx1QzU2MS1cdUM1N0JcdUM1N0QtXHVDNTk3XHVDNTk5LVx1QzVCM1x1QzVCNS1cdUM1Q0ZcdUM1RDEtXHVDNUVCXHVDNUVELVx1QzYwN1x1QzYwOS1cdUM2MjNcdUM2MjUtXHVDNjNGXHVDNjQxLVx1QzY1Qlx1QzY1RC1cdUM2NzdcdUM2NzktXHVDNjkzXHVDNjk1LVx1QzZBRlx1QzZCMS1cdUM2Q0JcdUM2Q0QtXHVDNkU3XHVDNkU5LVx1QzcwM1x1QzcwNS1cdUM3MUZcdUM3MjEtXHVDNzNCXHVDNzNELVx1Qzc1N1x1Qzc1OS1cdUM3NzNcdUM3NzUtXHVDNzhGXHVDNzkxLVx1QzdBQlx1QzdBRC1cdUM3QzdcdUM3QzktXHVDN0UzXHVDN0U1LVx1QzdGRlx1QzgwMS1cdUM4MUJcdUM4MUQtXHVDODM3XHVDODM5LVx1Qzg1M1x1Qzg1NS1cdUM4NkZcdUM4NzEtXHVDODhCXHVDODhELVx1QzhBN1x1QzhBOS1cdUM4QzNcdUM4QzUtXHVDOERGXHVDOEUxLVx1QzhGQlx1QzhGRC1cdUM5MTdcdUM5MTktXHVDOTMzXHVDOTM1LVx1Qzk0Rlx1Qzk1MS1cdUM5NkJcdUM5NkQtXHVDOTg3XHVDOTg5LVx1QzlBM1x1QzlBNS1cdUM5QkZcdUM5QzEtXHVDOURCXHVDOURELVx1QzlGN1x1QzlGOS1cdUNBMTNcdUNBMTUtXHVDQTJGXHVDQTMxLVx1Q0E0Qlx1Q0E0RC1cdUNBNjdcdUNBNjktXHVDQTgzXHVDQTg1LVx1Q0E5Rlx1Q0FBMS1cdUNBQkJcdUNBQkQtXHVDQUQ3XHVDQUQ5LVx1Q0FGM1x1Q0FGNS1cdUNCMEZcdUNCMTEtXHVDQjJCXHVDQjJELVx1Q0I0N1x1Q0I0OS1cdUNCNjNcdUNCNjUtXHVDQjdGXHVDQjgxLVx1Q0I5Qlx1Q0I5RC1cdUNCQjdcdUNCQjktXHVDQkQzXHVDQkQ1LVx1Q0JFRlx1Q0JGMS1cdUNDMEJcdUNDMEQtXHVDQzI3XHVDQzI5LVx1Q0M0M1x1Q0M0NS1cdUNDNUZcdUNDNjEtXHVDQzdCXHVDQzdELVx1Q0M5N1x1Q0M5OS1cdUNDQjNcdUNDQjUtXHVDQ0NGXHVDQ0QxLVx1Q0NFQlx1Q0NFRC1cdUNEMDdcdUNEMDktXHVDRDIzXHVDRDI1LVx1Q0QzRlx1Q0Q0MS1cdUNENUJcdUNENUQtXHVDRDc3XHVDRDc5LVx1Q0Q5M1x1Q0Q5NS1cdUNEQUZcdUNEQjEtXHVDRENCXHVDRENELVx1Q0RFN1x1Q0RFOS1cdUNFMDNcdUNFMDUtXHVDRTFGXHVDRTIxLVx1Q0UzQlx1Q0UzRC1cdUNFNTdcdUNFNTktXHVDRTczXHVDRTc1LVx1Q0U4Rlx1Q0U5MS1cdUNFQUJcdUNFQUQtXHVDRUM3XHVDRUM5LVx1Q0VFM1x1Q0VFNS1cdUNFRkZcdUNGMDEtXHVDRjFCXHVDRjFELVx1Q0YzN1x1Q0YzOS1cdUNGNTNcdUNGNTUtXHVDRjZGXHVDRjcxLVx1Q0Y4Qlx1Q0Y4RC1cdUNGQTdcdUNGQTktXHVDRkMzXHVDRkM1LVx1Q0ZERlx1Q0ZFMS1cdUNGRkJcdUNGRkQtXHVEMDE3XHVEMDE5LVx1RDAzM1x1RDAzNS1cdUQwNEZcdUQwNTEtXHVEMDZCXHVEMDZELVx1RDA4N1x1RDA4OS1cdUQwQTNcdUQwQTUtXHVEMEJGXHVEMEMxLVx1RDBEQlx1RDBERC1cdUQwRjdcdUQwRjktXHVEMTEzXHVEMTE1LVx1RDEyRlx1RDEzMS1cdUQxNEJcdUQxNEQtXHVEMTY3XHVEMTY5LVx1RDE4M1x1RDE4NS1cdUQxOUZcdUQxQTEtXHVEMUJCXHVEMUJELVx1RDFEN1x1RDFEOS1cdUQxRjNcdUQxRjUtXHVEMjBGXHVEMjExLVx1RDIyQlx1RDIyRC1cdUQyNDdcdUQyNDktXHVEMjYzXHVEMjY1LVx1RDI3Rlx1RDI4MS1cdUQyOUJcdUQyOUQtXHVEMkI3XHVEMkI5LVx1RDJEM1x1RDJENS1cdUQyRUZcdUQyRjEtXHVEMzBCXHVEMzBELVx1RDMyN1x1RDMyOS1cdUQzNDNcdUQzNDUtXHVEMzVGXHVEMzYxLVx1RDM3Qlx1RDM3RC1cdUQzOTdcdUQzOTktXHVEM0IzXHVEM0I1LVx1RDNDRlx1RDNEMS1cdUQzRUJcdUQzRUQtXHVENDA3XHVENDA5LVx1RDQyM1x1RDQyNS1cdUQ0M0ZcdUQ0NDEtXHVENDVCXHVENDVELVx1RDQ3N1x1RDQ3OS1cdUQ0OTNcdUQ0OTUtXHVENEFGXHVENEIxLVx1RDRDQlx1RDRDRC1cdUQ0RTdcdUQ0RTktXHVENTAzXHVENTA1LVx1RDUxRlx1RDUyMS1cdUQ1M0JcdUQ1M0QtXHVENTU3XHVENTU5LVx1RDU3M1x1RDU3NS1cdUQ1OEZcdUQ1OTEtXHVENUFCXHVENUFELVx1RDVDN1x1RDVDOS1cdUQ1RTNcdUQ1RTUtXHVENUZGXHVENjAxLVx1RDYxQlx1RDYxRC1cdUQ2MzdcdUQ2MzktXHVENjUzXHVENjU1LVx1RDY2Rlx1RDY3MS1cdUQ2OEJcdUQ2OEQtXHVENkE3XHVENkE5LVx1RDZDM1x1RDZDNS1cdUQ2REZcdUQ2RTEtXHVENkZCXHVENkZELVx1RDcxN1x1RDcxOS1cdUQ3MzNcdUQ3MzUtXHVENzRGXHVENzUxLVx1RDc2Qlx1RDc2RC1cdUQ3ODdcdUQ3ODktXHVEN0EzXSQvOwogIHZhciByZUV4dFBpY3QgPSAvXig/OltceEE5XHhBRVx1MjAzQ1x1MjA0OVx1MjEyMlx1MjEzOVx1MjE5NC1cdTIxOTlcdTIxQTlcdTIxQUFcdTIzMUFcdTIzMUJcdTIzMjhcdTIzODhcdTIzQ0ZcdTIzRTktXHUyM0YzXHUyM0Y4LVx1MjNGQVx1MjRDMlx1MjVBQVx1MjVBQlx1MjVCNlx1MjVDMFx1MjVGQi1cdTI1RkVcdTI2MDAtXHUyNjA1XHUyNjA3LVx1MjYxMlx1MjYxNC1cdTI2ODVcdTI2OTAtXHUyNzA1XHUyNzA4LVx1MjcxMlx1MjcxNFx1MjcxNlx1MjcxRFx1MjcyMVx1MjcyOFx1MjczM1x1MjczNFx1Mjc0NFx1Mjc0N1x1Mjc0Q1x1Mjc0RVx1Mjc1My1cdTI3NTVcdTI3NTdcdTI3NjMtXHUyNzY3XHUyNzk1LVx1Mjc5N1x1MjdBMVx1MjdCMFx1MjdCRlx1MjkzNFx1MjkzNVx1MkIwNS1cdTJCMDdcdTJCMUJcdTJCMUNcdTJCNTBcdTJCNTVcdTMwMzBcdTMwM0RcdTMyOTdcdTMyOTldfFx1RDgzQ1tcdURDMDAtXHVEQ0ZGXHVERDBELVx1REQwRlx1REQyRlx1REQ2Qy1cdURENzFcdUREN0VcdUREN0ZcdUREOEVcdUREOTEtXHVERDlBXHVEREFELVx1RERFNVx1REUwMS1cdURFMEZcdURFMUFcdURFMkZcdURFMzItXHVERTNBXHVERTNDLVx1REUzRlx1REU0OS1cdURGRkFdfFx1RDgzRFtcdURDMDAtXHVERDNEXHVERDQ2LVx1REU0Rlx1REU4MC1cdURFRkZcdURGNzQtXHVERjdGXHVERkQ1LVx1REZGRl18XHVEODNFW1x1REMwQy1cdURDMEZcdURDNDgtXHVEQzRGXHVEQzVBLVx1REM1Rlx1REM4OC1cdURDOEZcdURDQUUtXHVEQ0ZGXHVERDBDLVx1REQzQVx1REQzQy1cdURENDVcdURENDctXHVERUZGXXxcdUQ4M0ZbXHVEQzAwLVx1REZGRF0pJC87CgogIHZhciBnZXRDb2RlcG9pbnRUeXBlID0gZnVuY3Rpb24gZ2V0Q29kZXBvaW50VHlwZShfY2hhcjQsIGNvZGUpIHsKICAgIHZhciB0eXBlID0gQ29kZXBvaW50VHlwZS5Bbnk7CgogICAgaWYgKF9jaGFyNC5zZWFyY2gocmVFeHRlbmQpICE9PSAtMSkgewogICAgICB0eXBlIHw9IENvZGVwb2ludFR5cGUuRXh0ZW5kOwogICAgfQoKICAgIGlmIChjb2RlID09PSAweDIwMGQpIHsKICAgICAgdHlwZSB8PSBDb2RlcG9pbnRUeXBlLlpXSjsKICAgIH0KCiAgICBpZiAoY29kZSA+PSAweDFmMWU2ICYmIGNvZGUgPD0gMHgxZjFmZikgewogICAgICB0eXBlIHw9IENvZGVwb2ludFR5cGUuUkk7CiAgICB9CgogICAgaWYgKF9jaGFyNC5zZWFyY2gocmVQcmVwZW5kKSAhPT0gLTEpIHsKICAgICAgdHlwZSB8PSBDb2RlcG9pbnRUeXBlLlByZXBlbmQ7CiAgICB9CgogICAgaWYgKF9jaGFyNC5zZWFyY2gocmVTcGFjaW5nTWFyaykgIT09IC0xKSB7CiAgICAgIHR5cGUgfD0gQ29kZXBvaW50VHlwZS5TcGFjaW5nTWFyazsKICAgIH0KCiAgICBpZiAoX2NoYXI0LnNlYXJjaChyZUwpICE9PSAtMSkgewogICAgICB0eXBlIHw9IENvZGVwb2ludFR5cGUuTDsKICAgIH0KCiAgICBpZiAoX2NoYXI0LnNlYXJjaChyZVYpICE9PSAtMSkgewogICAgICB0eXBlIHw9IENvZGVwb2ludFR5cGUuVjsKICAgIH0KCiAgICBpZiAoX2NoYXI0LnNlYXJjaChyZVQpICE9PSAtMSkgewogICAgICB0eXBlIHw9IENvZGVwb2ludFR5cGUuVDsKICAgIH0KCiAgICBpZiAoX2NoYXI0LnNlYXJjaChyZUxWKSAhPT0gLTEpIHsKICAgICAgdHlwZSB8PSBDb2RlcG9pbnRUeXBlLkxWOwogICAgfQoKICAgIGlmIChfY2hhcjQuc2VhcmNoKHJlTFZUKSAhPT0gLTEpIHsKICAgICAgdHlwZSB8PSBDb2RlcG9pbnRUeXBlLkxWVDsKICAgIH0KCiAgICBpZiAoX2NoYXI0LnNlYXJjaChyZUV4dFBpY3QpICE9PSAtMSkgewogICAgICB0eXBlIHw9IENvZGVwb2ludFR5cGUuRXh0UGljdDsKICAgIH0KCiAgICByZXR1cm4gdHlwZTsKICB9OwoKICBmdW5jdGlvbiBpbnRlcnNlY3RzKHgsIHkpIHsKICAgIHJldHVybiAoeCAmIHkpICE9PSAwOwogIH0KCiAgdmFyIE5vbkJvdW5kYXJ5UGFpcnMgPSBbLy8gR0I2CiAgW0NvZGVwb2ludFR5cGUuTCwgQ29kZXBvaW50VHlwZS5MIHwgQ29kZXBvaW50VHlwZS5WIHwgQ29kZXBvaW50VHlwZS5MViB8IENvZGVwb2ludFR5cGUuTFZUXSwgLy8gR0I3CiAgW0NvZGVwb2ludFR5cGUuTFYgfCBDb2RlcG9pbnRUeXBlLlYsIENvZGVwb2ludFR5cGUuViB8IENvZGVwb2ludFR5cGUuVF0sIC8vIEdCOAogIFtDb2RlcG9pbnRUeXBlLkxWVCB8IENvZGVwb2ludFR5cGUuVCwgQ29kZXBvaW50VHlwZS5UXSwgLy8gR0I5CiAgW0NvZGVwb2ludFR5cGUuQW55LCBDb2RlcG9pbnRUeXBlLkV4dGVuZCB8IENvZGVwb2ludFR5cGUuWldKXSwgLy8gR0I5YQogIFtDb2RlcG9pbnRUeXBlLkFueSwgQ29kZXBvaW50VHlwZS5TcGFjaW5nTWFya10sIC8vIEdCOWIKICBbQ29kZXBvaW50VHlwZS5QcmVwZW5kLCBDb2RlcG9pbnRUeXBlLkFueV0sIC8vIEdCMTEKICBbQ29kZXBvaW50VHlwZS5aV0osIENvZGVwb2ludFR5cGUuRXh0UGljdF0sIC8vIEdCMTIgYW5kIEdCMTMKICBbQ29kZXBvaW50VHlwZS5SSSwgQ29kZXBvaW50VHlwZS5SSV1dOwoKICBmdW5jdGlvbiBpc0JvdW5kYXJ5UGFpcihsZWZ0LCByaWdodCkgewogICAgcmV0dXJuIE5vbkJvdW5kYXJ5UGFpcnMuZmluZEluZGV4KGZ1bmN0aW9uIChyKSB7CiAgICAgIHJldHVybiBpbnRlcnNlY3RzKGxlZnQsIHJbMF0pICYmIGludGVyc2VjdHMocmlnaHQsIHJbMV0pOwogICAgfSkgPT09IC0xOwogIH0KCiAgdmFyIGVuZGluZ0Vtb2ppWldKID0gLyg/OltceEE5XHhBRVx1MjAzQ1x1MjA0OVx1MjEyMlx1MjEzOVx1MjE5NC1cdTIxOTlcdTIxQTlcdTIxQUFcdTIzMUFcdTIzMUJcdTIzMjhcdTIzODhcdTIzQ0ZcdTIzRTktXHUyM0YzXHUyM0Y4LVx1MjNGQVx1MjRDMlx1MjVBQVx1MjVBQlx1MjVCNlx1MjVDMFx1MjVGQi1cdTI1RkVcdTI2MDAtXHUyNjA1XHUyNjA3LVx1MjYxMlx1MjYxNC1cdTI2ODVcdTI2OTAtXHUyNzA1XHUyNzA4LVx1MjcxMlx1MjcxNFx1MjcxNlx1MjcxRFx1MjcyMVx1MjcyOFx1MjczM1x1MjczNFx1Mjc0NFx1Mjc0N1x1Mjc0Q1x1Mjc0RVx1Mjc1My1cdTI3NTVcdTI3NTdcdTI3NjMtXHUyNzY3XHUyNzk1LVx1Mjc5N1x1MjdBMVx1MjdCMFx1MjdCRlx1MjkzNFx1MjkzNVx1MkIwNS1cdTJCMDdcdTJCMUJcdTJCMUNcdTJCNTBcdTJCNTVcdTMwMzBcdTMwM0RcdTMyOTdcdTMyOTldfFx1RDgzQ1tcdURDMDAtXHVEQ0ZGXHVERDBELVx1REQwRlx1REQyRlx1REQ2Qy1cdURENzFcdUREN0VcdUREN0ZcdUREOEVcdUREOTEtXHVERDlBXHVEREFELVx1RERFNVx1REUwMS1cdURFMEZcdURFMUFcdURFMkZcdURFMzItXHVERTNBXHVERTNDLVx1REUzRlx1REU0OS1cdURGRkFdfFx1RDgzRFtcdURDMDAtXHVERDNEXHVERDQ2LVx1REU0Rlx1REU4MC1cdURFRkZcdURGNzQtXHVERjdGXHVERkQ1LVx1REZGRl18XHVEODNFW1x1REMwQy1cdURDMEZcdURDNDgtXHVEQzRGXHVEQzVBLVx1REM1Rlx1REM4OC1cdURDOEZcdURDQUUtXHVEQ0ZGXHVERDBDLVx1REQzQVx1REQzQy1cdURENDVcdURENDctXHVERUZGXXxcdUQ4M0ZbXHVEQzAwLVx1REZGRF0pKD86W1x1MDMwMC1cdTAzNkZcdTA0ODMtXHUwNDg5XHUwNTkxLVx1MDVCRFx1MDVCRlx1MDVDMVx1MDVDMlx1MDVDNFx1MDVDNVx1MDVDN1x1MDYxMC1cdTA2MUFcdTA2NEItXHUwNjVGXHUwNjcwXHUwNkQ2LVx1MDZEQ1x1MDZERi1cdTA2RTRcdTA2RTdcdTA2RThcdTA2RUEtXHUwNkVEXHUwNzExXHUwNzMwLVx1MDc0QVx1MDdBNi1cdTA3QjBcdTA3RUItXHUwN0YzXHUwN0ZEXHUwODE2LVx1MDgxOVx1MDgxQi1cdTA4MjNcdTA4MjUtXHUwODI3XHUwODI5LVx1MDgyRFx1MDg1OS1cdTA4NUJcdTA4RDMtXHUwOEUxXHUwOEUzLVx1MDkwMlx1MDkzQVx1MDkzQ1x1MDk0MS1cdTA5NDhcdTA5NERcdTA5NTEtXHUwOTU3XHUwOTYyXHUwOTYzXHUwOTgxXHUwOUJDXHUwOUJFXHUwOUMxLVx1MDlDNFx1MDlDRFx1MDlEN1x1MDlFMlx1MDlFM1x1MDlGRVx1MEEwMVx1MEEwMlx1MEEzQ1x1MEE0MVx1MEE0Mlx1MEE0N1x1MEE0OFx1MEE0Qi1cdTBBNERcdTBBNTFcdTBBNzBcdTBBNzFcdTBBNzVcdTBBODFcdTBBODJcdTBBQkNcdTBBQzEtXHUwQUM1XHUwQUM3XHUwQUM4XHUwQUNEXHUwQUUyXHUwQUUzXHUwQUZBLVx1MEFGRlx1MEIwMVx1MEIzQ1x1MEIzRVx1MEIzRlx1MEI0MS1cdTBCNDRcdTBCNERcdTBCNTUtXHUwQjU3XHUwQjYyXHUwQjYzXHUwQjgyXHUwQkJFXHUwQkMwXHUwQkNEXHUwQkQ3XHUwQzAwXHUwQzA0XHUwQzNFLVx1MEM0MFx1MEM0Ni1cdTBDNDhcdTBDNEEtXHUwQzREXHUwQzU1XHUwQzU2XHUwQzYyXHUwQzYzXHUwQzgxXHUwQ0JDXHUwQ0JGXHUwQ0MyXHUwQ0M2XHUwQ0NDXHUwQ0NEXHUwQ0Q1XHUwQ0Q2XHUwQ0UyXHUwQ0UzXHUwRDAwXHUwRDAxXHUwRDNCXHUwRDNDXHUwRDNFXHUwRDQxLVx1MEQ0NFx1MEQ0RFx1MEQ1N1x1MEQ2Mlx1MEQ2M1x1MEQ4MVx1MERDQVx1MERDRlx1MEREMi1cdTBERDRcdTBERDZcdTBEREZcdTBFMzFcdTBFMzQtXHUwRTNBXHUwRTQ3LVx1MEU0RVx1MEVCMVx1MEVCNC1cdTBFQkNcdTBFQzgtXHUwRUNEXHUwRjE4XHUwRjE5XHUwRjM1XHUwRjM3XHUwRjM5XHUwRjcxLVx1MEY3RVx1MEY4MC1cdTBGODRcdTBGODZcdTBGODdcdTBGOEQtXHUwRjk3XHUwRjk5LVx1MEZCQ1x1MEZDNlx1MTAyRC1cdTEwMzBcdTEwMzItXHUxMDM3XHUxMDM5XHUxMDNBXHUxMDNEXHUxMDNFXHUxMDU4XHUxMDU5XHUxMDVFLVx1MTA2MFx1MTA3MS1cdTEwNzRcdTEwODJcdTEwODVcdTEwODZcdTEwOERcdTEwOURcdTEzNUQtXHUxMzVGXHUxNzEyLVx1MTcxNFx1MTczMi1cdTE3MzRcdTE3NTJcdTE3NTNcdTE3NzJcdTE3NzNcdTE3QjRcdTE3QjVcdTE3QjctXHUxN0JEXHUxN0M2XHUxN0M5LVx1MTdEM1x1MTdERFx1MTgwQi1cdTE4MERcdTE4ODVcdTE4ODZcdTE4QTlcdTE5MjAtXHUxOTIyXHUxOTI3XHUxOTI4XHUxOTMyXHUxOTM5LVx1MTkzQlx1MUExN1x1MUExOFx1MUExQlx1MUE1Nlx1MUE1OC1cdTFBNUVcdTFBNjBcdTFBNjJcdTFBNjUtXHUxQTZDXHUxQTczLVx1MUE3Q1x1MUE3Rlx1MUFCMC1cdTFBQzBcdTFCMDAtXHUxQjAzXHUxQjM0LVx1MUIzQVx1MUIzQ1x1MUI0Mlx1MUI2Qi1cdTFCNzNcdTFCODBcdTFCODFcdTFCQTItXHUxQkE1XHUxQkE4XHUxQkE5XHUxQkFCLVx1MUJBRFx1MUJFNlx1MUJFOFx1MUJFOVx1MUJFRFx1MUJFRi1cdTFCRjFcdTFDMkMtXHUxQzMzXHUxQzM2XHUxQzM3XHUxQ0QwLVx1MUNEMlx1MUNENC1cdTFDRTBcdTFDRTItXHUxQ0U4XHUxQ0VEXHUxQ0Y0XHUxQ0Y4XHUxQ0Y5XHUxREMwLVx1MURGOVx1MURGQi1cdTFERkZcdTIwMENcdTIwRDAtXHUyMEYwXHUyQ0VGLVx1MkNGMVx1MkQ3Rlx1MkRFMC1cdTJERkZcdTMwMkEtXHUzMDJGXHUzMDk5XHUzMDlBXHVBNjZGLVx1QTY3Mlx1QTY3NC1cdUE2N0RcdUE2OUVcdUE2OUZcdUE2RjBcdUE2RjFcdUE4MDJcdUE4MDZcdUE4MEJcdUE4MjVcdUE4MjZcdUE4MkNcdUE4QzRcdUE4QzVcdUE4RTAtXHVBOEYxXHVBOEZGXHVBOTI2LVx1QTkyRFx1QTk0Ny1cdUE5NTFcdUE5ODAtXHVBOTgyXHVBOUIzXHVBOUI2LVx1QTlCOVx1QTlCQ1x1QTlCRFx1QTlFNVx1QUEyOS1cdUFBMkVcdUFBMzFcdUFBMzJcdUFBMzVcdUFBMzZcdUFBNDNcdUFBNENcdUFBN0NcdUFBQjBcdUFBQjItXHVBQUI0XHVBQUI3XHVBQUI4XHVBQUJFXHVBQUJGXHVBQUMxXHVBQUVDXHVBQUVEXHVBQUY2XHVBQkU1XHVBQkU4XHVBQkVEXHVGQjFFXHVGRTAwLVx1RkUwRlx1RkUyMC1cdUZFMkZcdUZGOUVcdUZGOUZdfFx1RDgwMFtcdURERkRcdURFRTBcdURGNzYtXHVERjdBXXxcdUQ4MDJbXHVERTAxLVx1REUwM1x1REUwNVx1REUwNlx1REUwQy1cdURFMEZcdURFMzgtXHVERTNBXHVERTNGXHVERUU1XHVERUU2XXxcdUQ4MDNbXHVERDI0LVx1REQyN1x1REVBQlx1REVBQ1x1REY0Ni1cdURGNTBdfFx1RDgwNFtcdURDMDFcdURDMzgtXHVEQzQ2XHVEQzdGLVx1REM4MVx1RENCMy1cdURDQjZcdURDQjlcdURDQkFcdUREMDAtXHVERDAyXHVERDI3LVx1REQyQlx1REQyRC1cdUREMzRcdURENzNcdUREODBcdUREODFcdUREQjYtXHVEREJFXHVEREM5LVx1RERDQ1x1RERDRlx1REUyRi1cdURFMzFcdURFMzRcdURFMzZcdURFMzdcdURFM0VcdURFREZcdURFRTMtXHVERUVBXHVERjAwXHVERjAxXHVERjNCXHVERjNDXHVERjNFXHVERjQwXHVERjU3XHVERjY2LVx1REY2Q1x1REY3MC1cdURGNzRdfFx1RDgwNVtcdURDMzgtXHVEQzNGXHVEQzQyLVx1REM0NFx1REM0Nlx1REM1RVx1RENCMFx1RENCMy1cdURDQjhcdURDQkFcdURDQkRcdURDQkZcdURDQzBcdURDQzJcdURDQzNcdUREQUZcdUREQjItXHVEREI1XHVEREJDXHVEREJEXHVEREJGXHVEREMwXHVERERDXHVEREREXHVERTMzLVx1REUzQVx1REUzRFx1REUzRlx1REU0MFx1REVBQlx1REVBRFx1REVCMC1cdURFQjVcdURFQjdcdURGMUQtXHVERjFGXHVERjIyLVx1REYyNVx1REYyNy1cdURGMkJdfFx1RDgwNltcdURDMkYtXHVEQzM3XHVEQzM5XHVEQzNBXHVERDMwXHVERDNCXHVERDNDXHVERDNFXHVERDQzXHVEREQ0LVx1REREN1x1REREQVx1REREQlx1RERFMFx1REUwMS1cdURFMEFcdURFMzMtXHVERTM4XHVERTNCLVx1REUzRVx1REU0N1x1REU1MS1cdURFNTZcdURFNTktXHVERTVCXHVERThBLVx1REU5Nlx1REU5OFx1REU5OV18XHVEODA3W1x1REMzMC1cdURDMzZcdURDMzgtXHVEQzNEXHVEQzNGXHVEQzkyLVx1RENBN1x1RENBQS1cdURDQjBcdURDQjJcdURDQjNcdURDQjVcdURDQjZcdUREMzEtXHVERDM2XHVERDNBXHVERDNDXHVERDNEXHVERDNGLVx1REQ0NVx1REQ0N1x1REQ5MFx1REQ5MVx1REQ5NVx1REQ5N1x1REVGM1x1REVGNF18XHVEODFBW1x1REVGMC1cdURFRjRcdURGMzAtXHVERjM2XXxcdUQ4MUJbXHVERjRGXHVERjhGLVx1REY5Mlx1REZFNF18XHVEODJGW1x1REM5RFx1REM5RV18XHVEODM0W1x1REQ2NVx1REQ2Ny1cdURENjlcdURENkUtXHVERDcyXHVERDdCLVx1REQ4Mlx1REQ4NS1cdUREOEJcdUREQUEtXHVEREFEXHVERTQyLVx1REU0NF18XHVEODM2W1x1REUwMC1cdURFMzZcdURFM0ItXHVERTZDXHVERTc1XHVERTg0XHVERTlCLVx1REU5Rlx1REVBMS1cdURFQUZdfFx1RDgzOFtcdURDMDAtXHVEQzA2XHVEQzA4LVx1REMxOFx1REMxQi1cdURDMjFcdURDMjNcdURDMjRcdURDMjYtXHVEQzJBXHVERDMwLVx1REQzNlx1REVFQy1cdURFRUZdfFx1RDgzQVtcdURDRDAtXHVEQ0Q2XHVERDQ0LVx1REQ0QV18XHVEODNDW1x1REZGQi1cdURGRkZdfFx1REI0MFtcdURDMjAtXHVEQzdGXHVERDAwLVx1RERFRl0pKlx1MjAwRCQvOwoKICB2YXIgZW5kc1dpdGhFbW9qaVpXSiA9IGZ1bmN0aW9uIGVuZHNXaXRoRW1vamlaV0ooc3RyKSB7CiAgICByZXR1cm4gc3RyLnNlYXJjaChlbmRpbmdFbW9qaVpXSikgIT09IC0xOwogIH07CgogIHZhciBlbmRpbmdSSXMgPSAvKD86XHVEODNDW1x1RERFNi1cdURERkZdKSskL2c7CgogIHZhciBlbmRzV2l0aE9kZE51bWJlck9mUklzID0gZnVuY3Rpb24gZW5kc1dpdGhPZGROdW1iZXJPZlJJcyhzdHIpIHsKICAgIHZhciBtYXRjaCA9IHN0ci5tYXRjaChlbmRpbmdSSXMpOwoKICAgIGlmIChtYXRjaCA9PT0gbnVsbCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9IGVsc2UgewogICAgICAvLyBBIFJJIGlzIHJlcHJlc2VudGVkIGJ5IGEgc3Vycm9nYXRlIHBhaXIuCiAgICAgIHZhciBudW1SSXMgPSBtYXRjaFswXS5sZW5ndGggLyAyOwogICAgICByZXR1cm4gbnVtUklzICUgMiA9PT0gMTsKICAgIH0KICB9OwoKICAvKioKICAgKiBTaGFyZWQgdGhlIGZ1bmN0aW9uIHdpdGggaXNFbGVtZW50VHlwZSB1dGlsaXR5CiAgICovCgogIHZhciBpc0VsZW1lbnQgPSBmdW5jdGlvbiBpc0VsZW1lbnQodmFsdWUpIHsKICAgIHJldHVybiBpc1BsYWluT2JqZWN0LmlzUGxhaW5PYmplY3QodmFsdWUpICYmIE5vZGUkMS5pc05vZGVMaXN0KHZhbHVlLmNoaWxkcmVuKSAmJiAhRWRpdG9yLmlzRWRpdG9yKHZhbHVlKTsKICB9OwoKICB2YXIgRWxlbWVudCQxID0gewogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIHZhbHVlIGltcGxlbWVudHMgdGhlICdBbmNlc3RvcicgaW50ZXJmYWNlLgogICAgICovCiAgICBpc0FuY2VzdG9yOiBmdW5jdGlvbiBpc0FuY2VzdG9yKHZhbHVlKSB7CiAgICAgIHJldHVybiBpc1BsYWluT2JqZWN0LmlzUGxhaW5PYmplY3QodmFsdWUpICYmIE5vZGUkMS5pc05vZGVMaXN0KHZhbHVlLmNoaWxkcmVuKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIHZhbHVlIGltcGxlbWVudHMgdGhlIGBFbGVtZW50YCBpbnRlcmZhY2UuCiAgICAgKi8KICAgIGlzRWxlbWVudDogaXNFbGVtZW50LAoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSB2YWx1ZSBpcyBhbiBhcnJheSBvZiBgRWxlbWVudGAgb2JqZWN0cy4KICAgICAqLwogICAgaXNFbGVtZW50TGlzdDogZnVuY3Rpb24gaXNFbGVtZW50TGlzdCh2YWx1ZSkgewogICAgICByZXR1cm4gQXJyYXkuaXNBcnJheSh2YWx1ZSkgJiYgdmFsdWUuZXZlcnkoZnVuY3Rpb24gKHZhbCkgewogICAgICAgIHJldHVybiBFbGVtZW50JDEuaXNFbGVtZW50KHZhbCk7CiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgc2V0IG9mIHByb3BzIGlzIGEgcGFydGlhbCBvZiBFbGVtZW50LgogICAgICovCiAgICBpc0VsZW1lbnRQcm9wczogZnVuY3Rpb24gaXNFbGVtZW50UHJvcHMocHJvcHMpIHsKICAgICAgcmV0dXJuIHByb3BzLmNoaWxkcmVuICE9PSB1bmRlZmluZWQ7CiAgICB9LAoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSB2YWx1ZSBpbXBsZW1lbnRzIHRoZSBgRWxlbWVudGAgaW50ZXJmYWNlIGFuZCBoYXMgZWxlbWVudEtleSB3aXRoIHNlbGVjdGVkIHZhbHVlLgogICAgICogRGVmYXVsdCBpdCBjaGVjayB0byBgdHlwZWAga2V5IHZhbHVlCiAgICAgKi8KICAgIGlzRWxlbWVudFR5cGU6IGZ1bmN0aW9uIGlzRWxlbWVudFR5cGUodmFsdWUsIGVsZW1lbnRWYWwpIHsKICAgICAgdmFyIGVsZW1lbnRLZXkgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6ICd0eXBlJzsKICAgICAgcmV0dXJuIGlzRWxlbWVudCh2YWx1ZSkgJiYgdmFsdWVbZWxlbWVudEtleV0gPT09IGVsZW1lbnRWYWw7CiAgICB9LAoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW4gZWxlbWVudCBtYXRjaGVzIHNldCBvZiBwcm9wZXJ0aWVzLgogICAgICoKICAgICAqIE5vdGU6IHRoaXMgY2hlY2tzIGN1c3RvbSBwcm9wZXJ0aWVzLCBhbmQgaXQgZG9lcyBub3QgZW5zdXJlIHRoYXQgYW55CiAgICAgKiBjaGlsZHJlbiBhcmUgZXF1aXZhbGVudC4KICAgICAqLwogICAgbWF0Y2hlczogZnVuY3Rpb24gbWF0Y2hlcyhlbGVtZW50LCBwcm9wcykgewogICAgICBmb3IgKHZhciBrZXkgaW4gcHJvcHMpIHsKICAgICAgICBpZiAoa2V5ID09PSAnY2hpbGRyZW4nKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIGlmIChlbGVtZW50W2tleV0gIT09IHByb3BzW2tleV0pIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQogIH07CgogIHZhciBfZXhjbHVkZWQkNCA9IFsidGV4dCJdLAogICAgICBfZXhjbHVkZWQyJDMgPSBbInRleHQiXTsKCiAgZnVuY3Rpb24gb3duS2V5cyQ4KG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOyBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgeyB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsgaWYgKGVudW1lcmFibGVPbmx5KSB7IHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsgfSBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCiAgZnVuY3Rpb24gX29iamVjdFNwcmVhZCQ4KHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMkOChPYmplY3Qoc291cmNlKSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyBvd25LZXlzJDgoT2JqZWN0KHNvdXJjZSkpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsgfSk7IH0gfSByZXR1cm4gdGFyZ2V0OyB9CgogIGZ1bmN0aW9uIF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyJDUobywgYWxsb3dBcnJheUxpa2UpIHsgdmFyIGl0ID0gdHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgb1tTeW1ib2wuaXRlcmF0b3JdIHx8IG9bIkBAaXRlcmF0b3IiXTsgaWYgKCFpdCkgeyBpZiAoQXJyYXkuaXNBcnJheShvKSB8fCAoaXQgPSBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkkNShvKSkgfHwgYWxsb3dBcnJheUxpa2UgJiYgbyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSB7IGlmIChpdCkgbyA9IGl0OyB2YXIgaSA9IDA7IHZhciBGID0gZnVuY3Rpb24gRigpIHt9OyByZXR1cm4geyBzOiBGLCBuOiBmdW5jdGlvbiBuKCkgeyBpZiAoaSA+PSBvLmxlbmd0aCkgcmV0dXJuIHsgZG9uZTogdHJ1ZSB9OyByZXR1cm4geyBkb25lOiBmYWxzZSwgdmFsdWU6IG9baSsrXSB9OyB9LCBlOiBmdW5jdGlvbiBlKF9lKSB7IHRocm93IF9lOyB9LCBmOiBGIH07IH0gdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGl0ZXJhdGUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpOyB9IHZhciBub3JtYWxDb21wbGV0aW9uID0gdHJ1ZSwgZGlkRXJyID0gZmFsc2UsIGVycjsgcmV0dXJuIHsgczogZnVuY3Rpb24gcygpIHsgaXQgPSBpdC5jYWxsKG8pOyB9LCBuOiBmdW5jdGlvbiBuKCkgeyB2YXIgc3RlcCA9IGl0Lm5leHQoKTsgbm9ybWFsQ29tcGxldGlvbiA9IHN0ZXAuZG9uZTsgcmV0dXJuIHN0ZXA7IH0sIGU6IGZ1bmN0aW9uIGUoX2UyKSB7IGRpZEVyciA9IHRydWU7IGVyciA9IF9lMjsgfSwgZjogZnVuY3Rpb24gZigpIHsgdHJ5IHsgaWYgKCFub3JtYWxDb21wbGV0aW9uICYmIGl0WyJyZXR1cm4iXSAhPSBudWxsKSBpdFsicmV0dXJuIl0oKTsgfSBmaW5hbGx5IHsgaWYgKGRpZEVycikgdGhyb3cgZXJyOyB9IH0gfTsgfQoKICBmdW5jdGlvbiBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkkNShvLCBtaW5MZW4pIHsgaWYgKCFvKSByZXR1cm47IGlmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheSQ1KG8sIG1pbkxlbik7IHZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTsgaWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7IGlmIChuID09PSAiTWFwIiB8fCBuID09PSAiU2V0IikgcmV0dXJuIEFycmF5LmZyb20obyk7IGlmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5JDUobywgbWluTGVuKTsgfQoKICBmdW5jdGlvbiBfYXJyYXlMaWtlVG9BcnJheSQ1KGFyciwgbGVuKSB7IGlmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoOyBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfQogIHZhciBJU19FRElUT1JfQ0FDSEUgPSBuZXcgV2Vha01hcCgpOwogIHZhciBFZGl0b3IgPSB7CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jZXN0b3IgYWJvdmUgYSBsb2NhdGlvbiBpbiB0aGUgZG9jdW1lbnQuCiAgICAgKi8KICAgIGFib3ZlOiBmdW5jdGlvbiBhYm92ZShlZGl0b3IpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogICAgICB2YXIgX29wdGlvbnMkdm9pZHMgPSBvcHRpb25zLnZvaWRzLAogICAgICAgICAgdm9pZHMgPSBfb3B0aW9ucyR2b2lkcyA9PT0gdm9pZCAwID8gZmFsc2UgOiBfb3B0aW9ucyR2b2lkcywKICAgICAgICAgIF9vcHRpb25zJG1vZGUgPSBvcHRpb25zLm1vZGUsCiAgICAgICAgICBtb2RlID0gX29wdGlvbnMkbW9kZSA9PT0gdm9pZCAwID8gJ2xvd2VzdCcgOiBfb3B0aW9ucyRtb2RlLAogICAgICAgICAgX29wdGlvbnMkYXQgPSBvcHRpb25zLmF0LAogICAgICAgICAgYXQgPSBfb3B0aW9ucyRhdCA9PT0gdm9pZCAwID8gZWRpdG9yLnNlbGVjdGlvbiA6IF9vcHRpb25zJGF0LAogICAgICAgICAgbWF0Y2ggPSBvcHRpb25zLm1hdGNoOwoKICAgICAgaWYgKCFhdCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHBhdGggPSBFZGl0b3IucGF0aChlZGl0b3IsIGF0KTsKICAgICAgdmFyIHJldmVyc2UgPSBtb2RlID09PSAnbG93ZXN0JzsKCiAgICAgIHZhciBfaXRlcmF0b3IgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciQ1KEVkaXRvci5sZXZlbHMoZWRpdG9yLCB7CiAgICAgICAgYXQ6IHBhdGgsCiAgICAgICAgdm9pZHM6IHZvaWRzLAogICAgICAgIG1hdGNoOiBtYXRjaCwKICAgICAgICByZXZlcnNlOiByZXZlcnNlCiAgICAgIH0pKSwKICAgICAgICAgIF9zdGVwOwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvci5zKCk7ICEoX3N0ZXAgPSBfaXRlcmF0b3IubigpKS5kb25lOykgewogICAgICAgICAgdmFyIF9zdGVwJHZhbHVlID0gX3NsaWNlZFRvQXJyYXkoX3N0ZXAudmFsdWUsIDIpLAogICAgICAgICAgICAgIG4gPSBfc3RlcCR2YWx1ZVswXSwKICAgICAgICAgICAgICBwID0gX3N0ZXAkdmFsdWVbMV07CgogICAgICAgICAgaWYgKCFUZXh0LmlzVGV4dChuKSAmJiAhUGF0aC5lcXVhbHMocGF0aCwgcCkpIHsKICAgICAgICAgICAgcmV0dXJuIFtuLCBwXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvci5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yLmYoKTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIEFkZCBhIGN1c3RvbSBwcm9wZXJ0eSB0byB0aGUgbGVhZiB0ZXh0IG5vZGVzIGluIHRoZSBjdXJyZW50IHNlbGVjdGlvbi4KICAgICAqCiAgICAgKiBJZiB0aGUgc2VsZWN0aW9uIGlzIGN1cnJlbnRseSBjb2xsYXBzZWQsIHRoZSBtYXJrcyB3aWxsIGJlIGFkZGVkIHRvIHRoZQogICAgICogYGVkaXRvci5tYXJrc2AgcHJvcGVydHkgaW5zdGVhZCwgYW5kIGFwcGxpZWQgd2hlbiB0ZXh0IGlzIGluc2VydGVkIG5leHQuCiAgICAgKi8KICAgIGFkZE1hcms6IGZ1bmN0aW9uIGFkZE1hcmsoZWRpdG9yLCBrZXksIHZhbHVlKSB7CiAgICAgIGVkaXRvci5hZGRNYXJrKGtleSwgdmFsdWUpOwogICAgfSwKCiAgICAvKioKICAgICAqIEdldCB0aGUgcG9pbnQgYWZ0ZXIgYSBsb2NhdGlvbi4KICAgICAqLwogICAgYWZ0ZXI6IGZ1bmN0aW9uIGFmdGVyKGVkaXRvciwgYXQpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IHt9OwogICAgICB2YXIgYW5jaG9yID0gRWRpdG9yLnBvaW50KGVkaXRvciwgYXQsIHsKICAgICAgICBlZGdlOiAnZW5kJwogICAgICB9KTsKICAgICAgdmFyIGZvY3VzID0gRWRpdG9yLmVuZChlZGl0b3IsIFtdKTsKICAgICAgdmFyIHJhbmdlID0gewogICAgICAgIGFuY2hvcjogYW5jaG9yLAogICAgICAgIGZvY3VzOiBmb2N1cwogICAgICB9OwogICAgICB2YXIgX29wdGlvbnMkZGlzdGFuY2UgPSBvcHRpb25zLmRpc3RhbmNlLAogICAgICAgICAgZGlzdGFuY2UgPSBfb3B0aW9ucyRkaXN0YW5jZSA9PT0gdm9pZCAwID8gMSA6IF9vcHRpb25zJGRpc3RhbmNlOwogICAgICB2YXIgZCA9IDA7CiAgICAgIHZhciB0YXJnZXQ7CgogICAgICB2YXIgX2l0ZXJhdG9yMiA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyJDUoRWRpdG9yLnBvc2l0aW9ucyhlZGl0b3IsIF9vYmplY3RTcHJlYWQkOChfb2JqZWN0U3ByZWFkJDgoe30sIG9wdGlvbnMpLCB7fSwgewogICAgICAgIGF0OiByYW5nZQogICAgICB9KSkpLAogICAgICAgICAgX3N0ZXAyOwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvcjIucygpOyAhKF9zdGVwMiA9IF9pdGVyYXRvcjIubigpKS5kb25lOykgewogICAgICAgICAgdmFyIHAgPSBfc3RlcDIudmFsdWU7CgogICAgICAgICAgaWYgKGQgPiBkaXN0YW5jZSkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCAhPT0gMCkgewogICAgICAgICAgICB0YXJnZXQgPSBwOwogICAgICAgICAgfQoKICAgICAgICAgIGQrKzsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjIuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjIuZigpOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfSwKCiAgICAvKioKICAgICAqIEdldCB0aGUgcG9pbnQgYmVmb3JlIGEgbG9jYXRpb24uCiAgICAgKi8KICAgIGJlZm9yZTogZnVuY3Rpb24gYmVmb3JlKGVkaXRvciwgYXQpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IHt9OwogICAgICB2YXIgYW5jaG9yID0gRWRpdG9yLnN0YXJ0KGVkaXRvciwgW10pOwogICAgICB2YXIgZm9jdXMgPSBFZGl0b3IucG9pbnQoZWRpdG9yLCBhdCwgewogICAgICAgIGVkZ2U6ICdzdGFydCcKICAgICAgfSk7CiAgICAgIHZhciByYW5nZSA9IHsKICAgICAgICBhbmNob3I6IGFuY2hvciwKICAgICAgICBmb2N1czogZm9jdXMKICAgICAgfTsKICAgICAgdmFyIF9vcHRpb25zJGRpc3RhbmNlMiA9IG9wdGlvbnMuZGlzdGFuY2UsCiAgICAgICAgICBkaXN0YW5jZSA9IF9vcHRpb25zJGRpc3RhbmNlMiA9PT0gdm9pZCAwID8gMSA6IF9vcHRpb25zJGRpc3RhbmNlMjsKICAgICAgdmFyIGQgPSAwOwogICAgICB2YXIgdGFyZ2V0OwoKICAgICAgdmFyIF9pdGVyYXRvcjMgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciQ1KEVkaXRvci5wb3NpdGlvbnMoZWRpdG9yLCBfb2JqZWN0U3ByZWFkJDgoX29iamVjdFNwcmVhZCQ4KHt9LCBvcHRpb25zKSwge30sIHsKICAgICAgICBhdDogcmFuZ2UsCiAgICAgICAgcmV2ZXJzZTogdHJ1ZQogICAgICB9KSkpLAogICAgICAgICAgX3N0ZXAzOwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvcjMucygpOyAhKF9zdGVwMyA9IF9pdGVyYXRvcjMubigpKS5kb25lOykgewogICAgICAgICAgdmFyIHAgPSBfc3RlcDMudmFsdWU7CgogICAgICAgICAgaWYgKGQgPiBkaXN0YW5jZSkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCAhPT0gMCkgewogICAgICAgICAgICB0YXJnZXQgPSBwOwogICAgICAgICAgfQoKICAgICAgICAgIGQrKzsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjMuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjMuZigpOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfSwKCiAgICAvKioKICAgICAqIERlbGV0ZSBjb250ZW50IGluIHRoZSBlZGl0b3IgYmFja3dhcmQgZnJvbSB0aGUgY3VycmVudCBzZWxlY3Rpb24uCiAgICAgKi8KICAgIGRlbGV0ZUJhY2t3YXJkOiBmdW5jdGlvbiBkZWxldGVCYWNrd2FyZChlZGl0b3IpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogICAgICB2YXIgX29wdGlvbnMkdW5pdCA9IG9wdGlvbnMudW5pdCwKICAgICAgICAgIHVuaXQgPSBfb3B0aW9ucyR1bml0ID09PSB2b2lkIDAgPyAnY2hhcmFjdGVyJyA6IF9vcHRpb25zJHVuaXQ7CiAgICAgIGVkaXRvci5kZWxldGVCYWNrd2FyZCh1bml0KTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBEZWxldGUgY29udGVudCBpbiB0aGUgZWRpdG9yIGZvcndhcmQgZnJvbSB0aGUgY3VycmVudCBzZWxlY3Rpb24uCiAgICAgKi8KICAgIGRlbGV0ZUZvcndhcmQ6IGZ1bmN0aW9uIGRlbGV0ZUZvcndhcmQoZWRpdG9yKSB7CiAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsKICAgICAgdmFyIF9vcHRpb25zJHVuaXQyID0gb3B0aW9ucy51bml0LAogICAgICAgICAgdW5pdCA9IF9vcHRpb25zJHVuaXQyID09PSB2b2lkIDAgPyAnY2hhcmFjdGVyJyA6IF9vcHRpb25zJHVuaXQyOwogICAgICBlZGl0b3IuZGVsZXRlRm9yd2FyZCh1bml0KTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBEZWxldGUgdGhlIGNvbnRlbnQgaW4gdGhlIGN1cnJlbnQgc2VsZWN0aW9uLgogICAgICovCiAgICBkZWxldGVGcmFnbWVudDogZnVuY3Rpb24gZGVsZXRlRnJhZ21lbnQoZWRpdG9yKSB7CiAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsKICAgICAgdmFyIF9vcHRpb25zJGRpcmVjdGlvbiA9IG9wdGlvbnMuZGlyZWN0aW9uLAogICAgICAgICAgZGlyZWN0aW9uID0gX29wdGlvbnMkZGlyZWN0aW9uID09PSB2b2lkIDAgPyAnZm9yd2FyZCcgOiBfb3B0aW9ucyRkaXJlY3Rpb247CiAgICAgIGVkaXRvci5kZWxldGVGcmFnbWVudChkaXJlY3Rpb24pOwogICAgfSwKCiAgICAvKioKICAgICAqIEdldCB0aGUgc3RhcnQgYW5kIGVuZCBwb2ludHMgb2YgYSBsb2NhdGlvbi4KICAgICAqLwogICAgZWRnZXM6IGZ1bmN0aW9uIGVkZ2VzKGVkaXRvciwgYXQpIHsKICAgICAgcmV0dXJuIFtFZGl0b3Iuc3RhcnQoZWRpdG9yLCBhdCksIEVkaXRvci5lbmQoZWRpdG9yLCBhdCldOwogICAgfSwKCiAgICAvKioKICAgICAqIEdldCB0aGUgZW5kIHBvaW50IG9mIGEgbG9jYXRpb24uCiAgICAgKi8KICAgIGVuZDogZnVuY3Rpb24gZW5kKGVkaXRvciwgYXQpIHsKICAgICAgcmV0dXJuIEVkaXRvci5wb2ludChlZGl0b3IsIGF0LCB7CiAgICAgICAgZWRnZTogJ2VuZCcKICAgICAgfSk7CiAgICB9LAoKICAgIC8qKgogICAgICogR2V0IHRoZSBmaXJzdCBub2RlIGF0IGEgbG9jYXRpb24uCiAgICAgKi8KICAgIGZpcnN0OiBmdW5jdGlvbiBmaXJzdChlZGl0b3IsIGF0KSB7CiAgICAgIHZhciBwYXRoID0gRWRpdG9yLnBhdGgoZWRpdG9yLCBhdCwgewogICAgICAgIGVkZ2U6ICdzdGFydCcKICAgICAgfSk7CiAgICAgIHJldHVybiBFZGl0b3Iubm9kZShlZGl0b3IsIHBhdGgpOwogICAgfSwKCiAgICAvKioKICAgICAqIEdldCB0aGUgZnJhZ21lbnQgYXQgYSBsb2NhdGlvbi4KICAgICAqLwogICAgZnJhZ21lbnQ6IGZ1bmN0aW9uIGZyYWdtZW50KGVkaXRvciwgYXQpIHsKICAgICAgdmFyIHJhbmdlID0gRWRpdG9yLnJhbmdlKGVkaXRvciwgYXQpOwogICAgICB2YXIgZnJhZ21lbnQgPSBOb2RlJDEuZnJhZ21lbnQoZWRpdG9yLCByYW5nZSk7CiAgICAgIHJldHVybiBmcmFnbWVudDsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIG5vZGUgaGFzIGJsb2NrIGNoaWxkcmVuLgogICAgICovCiAgICBoYXNCbG9ja3M6IGZ1bmN0aW9uIGhhc0Jsb2NrcyhlZGl0b3IsIGVsZW1lbnQpIHsKICAgICAgcmV0dXJuIGVsZW1lbnQuY2hpbGRyZW4uc29tZShmdW5jdGlvbiAobikgewogICAgICAgIHJldHVybiBFZGl0b3IuaXNCbG9jayhlZGl0b3IsIG4pOwogICAgICB9KTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIG5vZGUgaGFzIGlubGluZSBhbmQgdGV4dCBjaGlsZHJlbi4KICAgICAqLwogICAgaGFzSW5saW5lczogZnVuY3Rpb24gaGFzSW5saW5lcyhlZGl0b3IsIGVsZW1lbnQpIHsKICAgICAgcmV0dXJuIGVsZW1lbnQuY2hpbGRyZW4uc29tZShmdW5jdGlvbiAobikgewogICAgICAgIHJldHVybiBUZXh0LmlzVGV4dChuKSB8fCBFZGl0b3IuaXNJbmxpbmUoZWRpdG9yLCBuKTsKICAgICAgfSk7CiAgICB9LAoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSBub2RlIGhhcyB0ZXh0IGNoaWxkcmVuLgogICAgICovCiAgICBoYXNUZXh0czogZnVuY3Rpb24gaGFzVGV4dHMoZWRpdG9yLCBlbGVtZW50KSB7CiAgICAgIHJldHVybiBlbGVtZW50LmNoaWxkcmVuLmV2ZXJ5KGZ1bmN0aW9uIChuKSB7CiAgICAgICAgcmV0dXJuIFRleHQuaXNUZXh0KG4pOwogICAgICB9KTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBJbnNlcnQgYSBibG9jayBicmVhayBhdCB0aGUgY3VycmVudCBzZWxlY3Rpb24uCiAgICAgKgogICAgICogSWYgdGhlIHNlbGVjdGlvbiBpcyBjdXJyZW50bHkgZXhwYW5kZWQsIGl0IHdpbGwgYmUgZGVsZXRlZCBmaXJzdC4KICAgICAqLwogICAgaW5zZXJ0QnJlYWs6IGZ1bmN0aW9uIGluc2VydEJyZWFrKGVkaXRvcikgewogICAgICBlZGl0b3IuaW5zZXJ0QnJlYWsoKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBJbnNlcnQgYSBmcmFnbWVudCBhdCB0aGUgY3VycmVudCBzZWxlY3Rpb24uCiAgICAgKgogICAgICogSWYgdGhlIHNlbGVjdGlvbiBpcyBjdXJyZW50bHkgZXhwYW5kZWQsIGl0IHdpbGwgYmUgZGVsZXRlZCBmaXJzdC4KICAgICAqLwogICAgaW5zZXJ0RnJhZ21lbnQ6IGZ1bmN0aW9uIGluc2VydEZyYWdtZW50KGVkaXRvciwgZnJhZ21lbnQpIHsKICAgICAgZWRpdG9yLmluc2VydEZyYWdtZW50KGZyYWdtZW50KTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBJbnNlcnQgYSBub2RlIGF0IHRoZSBjdXJyZW50IHNlbGVjdGlvbi4KICAgICAqCiAgICAgKiBJZiB0aGUgc2VsZWN0aW9uIGlzIGN1cnJlbnRseSBleHBhbmRlZCwgaXQgd2lsbCBiZSBkZWxldGVkIGZpcnN0LgogICAgICovCiAgICBpbnNlcnROb2RlOiBmdW5jdGlvbiBpbnNlcnROb2RlKGVkaXRvciwgbm9kZSkgewogICAgICBlZGl0b3IuaW5zZXJ0Tm9kZShub2RlKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBJbnNlcnQgdGV4dCBhdCB0aGUgY3VycmVudCBzZWxlY3Rpb24uCiAgICAgKgogICAgICogSWYgdGhlIHNlbGVjdGlvbiBpcyBjdXJyZW50bHkgZXhwYW5kZWQsIGl0IHdpbGwgYmUgZGVsZXRlZCBmaXJzdC4KICAgICAqLwogICAgaW5zZXJ0VGV4dDogZnVuY3Rpb24gaW5zZXJ0VGV4dChlZGl0b3IsIHRleHQpIHsKICAgICAgZWRpdG9yLmluc2VydFRleHQodGV4dCk7CiAgICB9LAoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSB2YWx1ZSBpcyBhIGJsb2NrIGBFbGVtZW50YCBvYmplY3QuCiAgICAgKi8KICAgIGlzQmxvY2s6IGZ1bmN0aW9uIGlzQmxvY2soZWRpdG9yLCB2YWx1ZSkgewogICAgICByZXR1cm4gRWxlbWVudCQxLmlzRWxlbWVudCh2YWx1ZSkgJiYgIWVkaXRvci5pc0lubGluZSh2YWx1ZSk7CiAgICB9LAoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSB2YWx1ZSBpcyBhbiBgRWRpdG9yYCBvYmplY3QuCiAgICAgKi8KICAgIGlzRWRpdG9yOiBmdW5jdGlvbiBpc0VkaXRvcih2YWx1ZSkgewogICAgICBpZiAoIWlzUGxhaW5PYmplY3QuaXNQbGFpbk9iamVjdCh2YWx1ZSkpIHJldHVybiBmYWxzZTsKICAgICAgdmFyIGNhY2hlZElzRWRpdG9yID0gSVNfRURJVE9SX0NBQ0hFLmdldCh2YWx1ZSk7CgogICAgICBpZiAoY2FjaGVkSXNFZGl0b3IgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBjYWNoZWRJc0VkaXRvcjsKICAgICAgfQoKICAgICAgdmFyIGlzRWRpdG9yID0gdHlwZW9mIHZhbHVlLmFkZE1hcmsgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mIHZhbHVlLmFwcGx5ID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZiB2YWx1ZS5kZWxldGVCYWNrd2FyZCA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YgdmFsdWUuZGVsZXRlRm9yd2FyZCA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YgdmFsdWUuZGVsZXRlRnJhZ21lbnQgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mIHZhbHVlLmluc2VydEJyZWFrID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZiB2YWx1ZS5pbnNlcnRGcmFnbWVudCA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YgdmFsdWUuaW5zZXJ0Tm9kZSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YgdmFsdWUuaW5zZXJ0VGV4dCA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YgdmFsdWUuaXNJbmxpbmUgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mIHZhbHVlLmlzVm9pZCA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YgdmFsdWUubm9ybWFsaXplTm9kZSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YgdmFsdWUub25DaGFuZ2UgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mIHZhbHVlLnJlbW92ZU1hcmsgPT09ICdmdW5jdGlvbicgJiYgKHZhbHVlLm1hcmtzID09PSBudWxsIHx8IGlzUGxhaW5PYmplY3QuaXNQbGFpbk9iamVjdCh2YWx1ZS5tYXJrcykpICYmICh2YWx1ZS5zZWxlY3Rpb24gPT09IG51bGwgfHwgUmFuZ2UuaXNSYW5nZSh2YWx1ZS5zZWxlY3Rpb24pKSAmJiBOb2RlJDEuaXNOb2RlTGlzdCh2YWx1ZS5jaGlsZHJlbikgJiYgT3BlcmF0aW9uLmlzT3BlcmF0aW9uTGlzdCh2YWx1ZS5vcGVyYXRpb25zKTsKICAgICAgSVNfRURJVE9SX0NBQ0hFLnNldCh2YWx1ZSwgaXNFZGl0b3IpOwogICAgICByZXR1cm4gaXNFZGl0b3I7CiAgICB9LAoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSBwb2ludCBpcyB0aGUgZW5kIHBvaW50IG9mIGEgbG9jYXRpb24uCiAgICAgKi8KICAgIGlzRW5kOiBmdW5jdGlvbiBpc0VuZChlZGl0b3IsIHBvaW50LCBhdCkgewogICAgICB2YXIgZW5kID0gRWRpdG9yLmVuZChlZGl0b3IsIGF0KTsKICAgICAgcmV0dXJuIFBvaW50LmVxdWFscyhwb2ludCwgZW5kKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIHBvaW50IGlzIGFuIGVkZ2Ugb2YgYSBsb2NhdGlvbi4KICAgICAqLwogICAgaXNFZGdlOiBmdW5jdGlvbiBpc0VkZ2UoZWRpdG9yLCBwb2ludCwgYXQpIHsKICAgICAgcmV0dXJuIEVkaXRvci5pc1N0YXJ0KGVkaXRvciwgcG9pbnQsIGF0KSB8fCBFZGl0b3IuaXNFbmQoZWRpdG9yLCBwb2ludCwgYXQpOwogICAgfSwKCiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGVsZW1lbnQgaXMgZW1wdHksIGFjY291bnRpbmcgZm9yIHZvaWQgbm9kZXMuCiAgICAgKi8KICAgIGlzRW1wdHk6IGZ1bmN0aW9uIGlzRW1wdHkoZWRpdG9yLCBlbGVtZW50KSB7CiAgICAgIHZhciBjaGlsZHJlbiA9IGVsZW1lbnQuY2hpbGRyZW47CgogICAgICB2YXIgX2NoaWxkcmVuID0gX3NsaWNlZFRvQXJyYXkoY2hpbGRyZW4sIDEpLAogICAgICAgICAgZmlyc3QgPSBfY2hpbGRyZW5bMF07CgogICAgICByZXR1cm4gY2hpbGRyZW4ubGVuZ3RoID09PSAwIHx8IGNoaWxkcmVuLmxlbmd0aCA9PT0gMSAmJiBUZXh0LmlzVGV4dChmaXJzdCkgJiYgZmlyc3QudGV4dCA9PT0gJycgJiYgIWVkaXRvci5pc1ZvaWQoZWxlbWVudCk7CiAgICB9LAoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSB2YWx1ZSBpcyBhbiBpbmxpbmUgYEVsZW1lbnRgIG9iamVjdC4KICAgICAqLwogICAgaXNJbmxpbmU6IGZ1bmN0aW9uIGlzSW5saW5lKGVkaXRvciwgdmFsdWUpIHsKICAgICAgcmV0dXJuIEVsZW1lbnQkMS5pc0VsZW1lbnQodmFsdWUpICYmIGVkaXRvci5pc0lubGluZSh2YWx1ZSk7CiAgICB9LAoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGVkaXRvciBpcyBjdXJyZW50bHkgbm9ybWFsaXppbmcgYWZ0ZXIgZWFjaCBvcGVyYXRpb24uCiAgICAgKi8KICAgIGlzTm9ybWFsaXppbmc6IGZ1bmN0aW9uIGlzTm9ybWFsaXppbmcoZWRpdG9yKSB7CiAgICAgIHZhciBpc05vcm1hbGl6aW5nID0gTk9STUFMSVpJTkcuZ2V0KGVkaXRvcik7CiAgICAgIHJldHVybiBpc05vcm1hbGl6aW5nID09PSB1bmRlZmluZWQgPyB0cnVlIDogaXNOb3JtYWxpemluZzsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIHBvaW50IGlzIHRoZSBzdGFydCBwb2ludCBvZiBhIGxvY2F0aW9uLgogICAgICovCiAgICBpc1N0YXJ0OiBmdW5jdGlvbiBpc1N0YXJ0KGVkaXRvciwgcG9pbnQsIGF0KSB7CiAgICAgIC8vIFBFUkY6IElmIHRoZSBvZmZzZXQgaXNuJ3QgYDBgIHdlIGtub3cgaXQncyBub3QgdGhlIHN0YXJ0LgogICAgICBpZiAocG9pbnQub2Zmc2V0ICE9PSAwKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICB2YXIgc3RhcnQgPSBFZGl0b3Iuc3RhcnQoZWRpdG9yLCBhdCk7CiAgICAgIHJldHVybiBQb2ludC5lcXVhbHMocG9pbnQsIHN0YXJ0KTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIHZhbHVlIGlzIGEgdm9pZCBgRWxlbWVudGAgb2JqZWN0LgogICAgICovCiAgICBpc1ZvaWQ6IGZ1bmN0aW9uIGlzVm9pZChlZGl0b3IsIHZhbHVlKSB7CiAgICAgIHJldHVybiBFbGVtZW50JDEuaXNFbGVtZW50KHZhbHVlKSAmJiBlZGl0b3IuaXNWb2lkKHZhbHVlKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBHZXQgdGhlIGxhc3Qgbm9kZSBhdCBhIGxvY2F0aW9uLgogICAgICovCiAgICBsYXN0OiBmdW5jdGlvbiBsYXN0KGVkaXRvciwgYXQpIHsKICAgICAgdmFyIHBhdGggPSBFZGl0b3IucGF0aChlZGl0b3IsIGF0LCB7CiAgICAgICAgZWRnZTogJ2VuZCcKICAgICAgfSk7CiAgICAgIHJldHVybiBFZGl0b3Iubm9kZShlZGl0b3IsIHBhdGgpOwogICAgfSwKCiAgICAvKioKICAgICAqIEdldCB0aGUgbGVhZiB0ZXh0IG5vZGUgYXQgYSBsb2NhdGlvbi4KICAgICAqLwogICAgbGVhZjogZnVuY3Rpb24gbGVhZihlZGl0b3IsIGF0KSB7CiAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiB7fTsKICAgICAgdmFyIHBhdGggPSBFZGl0b3IucGF0aChlZGl0b3IsIGF0LCBvcHRpb25zKTsKICAgICAgdmFyIG5vZGUgPSBOb2RlJDEubGVhZihlZGl0b3IsIHBhdGgpOwogICAgICByZXR1cm4gW25vZGUsIHBhdGhdOwogICAgfSwKCiAgICAvKioKICAgICAqIEl0ZXJhdGUgdGhyb3VnaCBhbGwgb2YgdGhlIGxldmVscyBhdCBhIGxvY2F0aW9uLgogICAgICovCiAgICBsZXZlbHM6IGZ1bmN0aW9uKiBsZXZlbHMoZWRpdG9yKSB7CiAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsKICAgICAgdmFyIF9vcHRpb25zJGF0MiA9IG9wdGlvbnMuYXQsCiAgICAgICAgICBhdCA9IF9vcHRpb25zJGF0MiA9PT0gdm9pZCAwID8gZWRpdG9yLnNlbGVjdGlvbiA6IF9vcHRpb25zJGF0MiwKICAgICAgICAgIF9vcHRpb25zJHJldmVyc2UgPSBvcHRpb25zLnJldmVyc2UsCiAgICAgICAgICByZXZlcnNlID0gX29wdGlvbnMkcmV2ZXJzZSA9PT0gdm9pZCAwID8gZmFsc2UgOiBfb3B0aW9ucyRyZXZlcnNlLAogICAgICAgICAgX29wdGlvbnMkdm9pZHMyID0gb3B0aW9ucy52b2lkcywKICAgICAgICAgIHZvaWRzID0gX29wdGlvbnMkdm9pZHMyID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zJHZvaWRzMjsKICAgICAgdmFyIG1hdGNoID0gb3B0aW9ucy5tYXRjaDsKCiAgICAgIGlmIChtYXRjaCA9PSBudWxsKSB7CiAgICAgICAgbWF0Y2ggPSBmdW5jdGlvbiBtYXRjaCgpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGlmICghYXQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBsZXZlbHMgPSBbXTsKICAgICAgdmFyIHBhdGggPSBFZGl0b3IucGF0aChlZGl0b3IsIGF0KTsKCiAgICAgIHZhciBfaXRlcmF0b3I0ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIkNShOb2RlJDEubGV2ZWxzKGVkaXRvciwgcGF0aCkpLAogICAgICAgICAgX3N0ZXA0OwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvcjQucygpOyAhKF9zdGVwNCA9IF9pdGVyYXRvcjQubigpKS5kb25lOykgewogICAgICAgICAgdmFyIF9zdGVwNCR2YWx1ZSA9IF9zbGljZWRUb0FycmF5KF9zdGVwNC52YWx1ZSwgMiksCiAgICAgICAgICAgICAgbiA9IF9zdGVwNCR2YWx1ZVswXSwKICAgICAgICAgICAgICBwID0gX3N0ZXA0JHZhbHVlWzFdOwoKICAgICAgICAgIGlmICghbWF0Y2gobiwgcCkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgbGV2ZWxzLnB1c2goW24sIHBdKTsKCiAgICAgICAgICBpZiAoIXZvaWRzICYmIEVkaXRvci5pc1ZvaWQoZWRpdG9yLCBuKSkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjQuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjQuZigpOwogICAgICB9CgogICAgICBpZiAocmV2ZXJzZSkgewogICAgICAgIGxldmVscy5yZXZlcnNlKCk7CiAgICAgIH0KCiAgICAgIHlpZWxkKiBsZXZlbHM7CiAgICB9LAoKICAgIC8qKgogICAgICogR2V0IHRoZSBtYXJrcyB0aGF0IHdvdWxkIGJlIGFkZGVkIHRvIHRleHQgYXQgdGhlIGN1cnJlbnQgc2VsZWN0aW9uLgogICAgICovCiAgICBtYXJrczogZnVuY3Rpb24gbWFya3MoZWRpdG9yKSB7CiAgICAgIHZhciBtYXJrcyA9IGVkaXRvci5tYXJrcywKICAgICAgICAgIHNlbGVjdGlvbiA9IGVkaXRvci5zZWxlY3Rpb247CgogICAgICBpZiAoIXNlbGVjdGlvbikgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICBpZiAobWFya3MpIHsKICAgICAgICByZXR1cm4gbWFya3M7CiAgICAgIH0KCiAgICAgIGlmIChSYW5nZS5pc0V4cGFuZGVkKHNlbGVjdGlvbikpIHsKICAgICAgICB2YXIgX0VkaXRvciRub2RlcyA9IEVkaXRvci5ub2RlcyhlZGl0b3IsIHsKICAgICAgICAgIG1hdGNoOiBUZXh0LmlzVGV4dAogICAgICAgIH0pLAogICAgICAgICAgICBfRWRpdG9yJG5vZGVzMiA9IF9zbGljZWRUb0FycmF5KF9FZGl0b3Ikbm9kZXMsIDEpLAogICAgICAgICAgICBtYXRjaCA9IF9FZGl0b3Ikbm9kZXMyWzBdOwoKICAgICAgICBpZiAobWF0Y2gpIHsKICAgICAgICAgIHZhciBfbWF0Y2ggPSBfc2xpY2VkVG9BcnJheShtYXRjaCwgMSksCiAgICAgICAgICAgICAgX25vZGUgPSBfbWF0Y2hbMF07CgogICAgICAgICAgX25vZGUudGV4dDsKICAgICAgICAgICAgICB2YXIgX3Jlc3QgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMoX25vZGUsIF9leGNsdWRlZCQ0KTsKCiAgICAgICAgICByZXR1cm4gX3Jlc3Q7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiB7fTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHZhciBhbmNob3IgPSBzZWxlY3Rpb24uYW5jaG9yOwogICAgICB2YXIgcGF0aCA9IGFuY2hvci5wYXRoOwoKICAgICAgdmFyIF9FZGl0b3IkbGVhZiA9IEVkaXRvci5sZWFmKGVkaXRvciwgcGF0aCksCiAgICAgICAgICBfRWRpdG9yJGxlYWYyID0gX3NsaWNlZFRvQXJyYXkoX0VkaXRvciRsZWFmLCAxKSwKICAgICAgICAgIG5vZGUgPSBfRWRpdG9yJGxlYWYyWzBdOwoKICAgICAgaWYgKGFuY2hvci5vZmZzZXQgPT09IDApIHsKICAgICAgICB2YXIgcHJldiA9IEVkaXRvci5wcmV2aW91cyhlZGl0b3IsIHsKICAgICAgICAgIGF0OiBwYXRoLAogICAgICAgICAgbWF0Y2g6IFRleHQuaXNUZXh0CiAgICAgICAgfSk7CiAgICAgICAgdmFyIGJsb2NrID0gRWRpdG9yLmFib3ZlKGVkaXRvciwgewogICAgICAgICAgbWF0Y2g6IGZ1bmN0aW9uIG1hdGNoKG4pIHsKICAgICAgICAgICAgcmV0dXJuIEVkaXRvci5pc0Jsb2NrKGVkaXRvciwgbik7CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGlmIChwcmV2ICYmIGJsb2NrKSB7CiAgICAgICAgICB2YXIgX3ByZXYgPSBfc2xpY2VkVG9BcnJheShwcmV2LCAyKSwKICAgICAgICAgICAgICBwcmV2Tm9kZSA9IF9wcmV2WzBdLAogICAgICAgICAgICAgIHByZXZQYXRoID0gX3ByZXZbMV07CgogICAgICAgICAgdmFyIF9ibG9jayA9IF9zbGljZWRUb0FycmF5KGJsb2NrLCAyKSwKICAgICAgICAgICAgICBibG9ja1BhdGggPSBfYmxvY2tbMV07CgogICAgICAgICAgaWYgKFBhdGguaXNBbmNlc3RvcihibG9ja1BhdGgsIHByZXZQYXRoKSkgewogICAgICAgICAgICBub2RlID0gcHJldk5vZGU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgX25vZGUyID0gbm9kZTsKICAgICAgICAgIF9ub2RlMi50ZXh0OwogICAgICAgICAgdmFyIHJlc3QgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMoX25vZGUyLCBfZXhjbHVkZWQyJDMpOwoKICAgICAgcmV0dXJuIHJlc3Q7CiAgICB9LAoKICAgIC8qKgogICAgICogR2V0IHRoZSBtYXRjaGluZyBub2RlIGluIHRoZSBicmFuY2ggb2YgdGhlIGRvY3VtZW50IGFmdGVyIGEgbG9jYXRpb24uCiAgICAgKi8KICAgIG5leHQ6IGZ1bmN0aW9uIG5leHQoZWRpdG9yKSB7CiAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsKICAgICAgdmFyIF9vcHRpb25zJG1vZGUyID0gb3B0aW9ucy5tb2RlLAogICAgICAgICAgbW9kZSA9IF9vcHRpb25zJG1vZGUyID09PSB2b2lkIDAgPyAnbG93ZXN0JyA6IF9vcHRpb25zJG1vZGUyLAogICAgICAgICAgX29wdGlvbnMkdm9pZHMzID0gb3B0aW9ucy52b2lkcywKICAgICAgICAgIHZvaWRzID0gX29wdGlvbnMkdm9pZHMzID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zJHZvaWRzMzsKICAgICAgdmFyIG1hdGNoID0gb3B0aW9ucy5tYXRjaCwKICAgICAgICAgIF9vcHRpb25zJGF0MyA9IG9wdGlvbnMuYXQsCiAgICAgICAgICBhdCA9IF9vcHRpb25zJGF0MyA9PT0gdm9pZCAwID8gZWRpdG9yLnNlbGVjdGlvbiA6IF9vcHRpb25zJGF0MzsKCiAgICAgIGlmICghYXQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBwb2ludEFmdGVyTG9jYXRpb24gPSBFZGl0b3IuYWZ0ZXIoZWRpdG9yLCBhdCwgewogICAgICAgIHZvaWRzOiB2b2lkcwogICAgICB9KTsKICAgICAgaWYgKCFwb2ludEFmdGVyTG9jYXRpb24pIHJldHVybjsKCiAgICAgIHZhciBfRWRpdG9yJGxhc3QgPSBFZGl0b3IubGFzdChlZGl0b3IsIFtdKSwKICAgICAgICAgIF9FZGl0b3IkbGFzdDIgPSBfc2xpY2VkVG9BcnJheShfRWRpdG9yJGxhc3QsIDIpLAogICAgICAgICAgdG8gPSBfRWRpdG9yJGxhc3QyWzFdOwoKICAgICAgdmFyIHNwYW4gPSBbcG9pbnRBZnRlckxvY2F0aW9uLnBhdGgsIHRvXTsKCiAgICAgIGlmIChQYXRoLmlzUGF0aChhdCkgJiYgYXQubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgZ2V0IHRoZSBuZXh0IG5vZGUgZnJvbSB0aGUgcm9vdCBub2RlISIpOwogICAgICB9CgogICAgICBpZiAobWF0Y2ggPT0gbnVsbCkgewogICAgICAgIGlmIChQYXRoLmlzUGF0aChhdCkpIHsKICAgICAgICAgIHZhciBfRWRpdG9yJHBhcmVudCA9IEVkaXRvci5wYXJlbnQoZWRpdG9yLCBhdCksCiAgICAgICAgICAgICAgX0VkaXRvciRwYXJlbnQyID0gX3NsaWNlZFRvQXJyYXkoX0VkaXRvciRwYXJlbnQsIDEpLAogICAgICAgICAgICAgIHBhcmVudCA9IF9FZGl0b3IkcGFyZW50MlswXTsKCiAgICAgICAgICBtYXRjaCA9IGZ1bmN0aW9uIG1hdGNoKG4pIHsKICAgICAgICAgICAgcmV0dXJuIHBhcmVudC5jaGlsZHJlbi5pbmNsdWRlcyhuKTsKICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1hdGNoID0gZnVuY3Rpb24gbWF0Y2goKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHZhciBfRWRpdG9yJG5vZGVzMyA9IEVkaXRvci5ub2RlcyhlZGl0b3IsIHsKICAgICAgICBhdDogc3BhbiwKICAgICAgICBtYXRjaDogbWF0Y2gsCiAgICAgICAgbW9kZTogbW9kZSwKICAgICAgICB2b2lkczogdm9pZHMKICAgICAgfSksCiAgICAgICAgICBfRWRpdG9yJG5vZGVzNCA9IF9zbGljZWRUb0FycmF5KF9FZGl0b3Ikbm9kZXMzLCAxKSwKICAgICAgICAgIG5leHQgPSBfRWRpdG9yJG5vZGVzNFswXTsKCiAgICAgIHJldHVybiBuZXh0OwogICAgfSwKCiAgICAvKioKICAgICAqIEdldCB0aGUgbm9kZSBhdCBhIGxvY2F0aW9uLgogICAgICovCiAgICBub2RlOiBmdW5jdGlvbiBub2RlKGVkaXRvciwgYXQpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IHt9OwogICAgICB2YXIgcGF0aCA9IEVkaXRvci5wYXRoKGVkaXRvciwgYXQsIG9wdGlvbnMpOwogICAgICB2YXIgbm9kZSA9IE5vZGUkMS5nZXQoZWRpdG9yLCBwYXRoKTsKICAgICAgcmV0dXJuIFtub2RlLCBwYXRoXTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBJdGVyYXRlIHRocm91Z2ggYWxsIG9mIHRoZSBub2RlcyBpbiB0aGUgRWRpdG9yLgogICAgICovCiAgICBub2RlczogZnVuY3Rpb24qIG5vZGVzKGVkaXRvcikgewogICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CiAgICAgIHZhciBfb3B0aW9ucyRhdDQgPSBvcHRpb25zLmF0LAogICAgICAgICAgYXQgPSBfb3B0aW9ucyRhdDQgPT09IHZvaWQgMCA/IGVkaXRvci5zZWxlY3Rpb24gOiBfb3B0aW9ucyRhdDQsCiAgICAgICAgICBfb3B0aW9ucyRtb2RlMyA9IG9wdGlvbnMubW9kZSwKICAgICAgICAgIG1vZGUgPSBfb3B0aW9ucyRtb2RlMyA9PT0gdm9pZCAwID8gJ2FsbCcgOiBfb3B0aW9ucyRtb2RlMywKICAgICAgICAgIF9vcHRpb25zJHVuaXZlcnNhbCA9IG9wdGlvbnMudW5pdmVyc2FsLAogICAgICAgICAgdW5pdmVyc2FsID0gX29wdGlvbnMkdW5pdmVyc2FsID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zJHVuaXZlcnNhbCwKICAgICAgICAgIF9vcHRpb25zJHJldmVyc2UyID0gb3B0aW9ucy5yZXZlcnNlLAogICAgICAgICAgcmV2ZXJzZSA9IF9vcHRpb25zJHJldmVyc2UyID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zJHJldmVyc2UyLAogICAgICAgICAgX29wdGlvbnMkdm9pZHM0ID0gb3B0aW9ucy52b2lkcywKICAgICAgICAgIHZvaWRzID0gX29wdGlvbnMkdm9pZHM0ID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zJHZvaWRzNDsKICAgICAgdmFyIG1hdGNoID0gb3B0aW9ucy5tYXRjaDsKCiAgICAgIGlmICghbWF0Y2gpIHsKICAgICAgICBtYXRjaCA9IGZ1bmN0aW9uIG1hdGNoKCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfTsKICAgICAgfQoKICAgICAgaWYgKCFhdCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGZyb207CiAgICAgIHZhciB0bzsKCiAgICAgIGlmIChTcGFuLmlzU3BhbihhdCkpIHsKICAgICAgICBmcm9tID0gYXRbMF07CiAgICAgICAgdG8gPSBhdFsxXTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgZmlyc3QgPSBFZGl0b3IucGF0aChlZGl0b3IsIGF0LCB7CiAgICAgICAgICBlZGdlOiAnc3RhcnQnCiAgICAgICAgfSk7CiAgICAgICAgdmFyIGxhc3QgPSBFZGl0b3IucGF0aChlZGl0b3IsIGF0LCB7CiAgICAgICAgICBlZGdlOiAnZW5kJwogICAgICAgIH0pOwogICAgICAgIGZyb20gPSByZXZlcnNlID8gbGFzdCA6IGZpcnN0OwogICAgICAgIHRvID0gcmV2ZXJzZSA/IGZpcnN0IDogbGFzdDsKICAgICAgfQoKICAgICAgdmFyIG5vZGVFbnRyaWVzID0gTm9kZSQxLm5vZGVzKGVkaXRvciwgewogICAgICAgIHJldmVyc2U6IHJldmVyc2UsCiAgICAgICAgZnJvbTogZnJvbSwKICAgICAgICB0bzogdG8sCiAgICAgICAgcGFzczogZnVuY3Rpb24gcGFzcyhfcmVmKSB7CiAgICAgICAgICB2YXIgX3JlZjIgPSBfc2xpY2VkVG9BcnJheShfcmVmLCAxKSwKICAgICAgICAgICAgICBuID0gX3JlZjJbMF07CgogICAgICAgICAgcmV0dXJuIHZvaWRzID8gZmFsc2UgOiBFZGl0b3IuaXNWb2lkKGVkaXRvciwgbik7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdmFyIG1hdGNoZXMgPSBbXTsKICAgICAgdmFyIGhpdDsKCiAgICAgIHZhciBfaXRlcmF0b3I1ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIkNShub2RlRW50cmllcyksCiAgICAgICAgICBfc3RlcDU7CgogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yNS5zKCk7ICEoX3N0ZXA1ID0gX2l0ZXJhdG9yNS5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgX3N0ZXA1JHZhbHVlID0gX3NsaWNlZFRvQXJyYXkoX3N0ZXA1LnZhbHVlLCAyKSwKICAgICAgICAgICAgICBub2RlID0gX3N0ZXA1JHZhbHVlWzBdLAogICAgICAgICAgICAgIHBhdGggPSBfc3RlcDUkdmFsdWVbMV07CgogICAgICAgICAgdmFyIGlzTG93ZXIgPSBoaXQgJiYgUGF0aC5jb21wYXJlKHBhdGgsIGhpdFsxXSkgPT09IDA7IC8vIEluIGhpZ2hlc3QgbW9kZSBhbnkgbm9kZSBsb3dlciB0aGFuIHRoZSBsYXN0IGhpdCBpcyBub3QgYSBtYXRjaC4KCiAgICAgICAgICBpZiAobW9kZSA9PT0gJ2hpZ2hlc3QnICYmIGlzTG93ZXIpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCFtYXRjaChub2RlLCBwYXRoKSkgewogICAgICAgICAgICAvLyBJZiB3ZSd2ZSBhcnJpdmVkIGF0IGEgbGVhZiB0ZXh0IG5vZGUgdGhhdCBpcyBub3QgbG93ZXIgdGhhbiB0aGUgbGFzdAogICAgICAgICAgICAvLyBoaXQsIHRoZW4gd2UndmUgZm91bmQgYSBicmFuY2ggdGhhdCBkb2Vzbid0IGluY2x1ZGUgYSBtYXRjaCwgd2hpY2gKICAgICAgICAgICAgLy8gbWVhbnMgdGhlIG1hdGNoIGlzIG5vdCB1bml2ZXJzYWwuCiAgICAgICAgICAgIGlmICh1bml2ZXJzYWwgJiYgIWlzTG93ZXIgJiYgVGV4dC5pc1RleHQobm9kZSkpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gLy8gSWYgdGhlcmUncyBhIG1hdGNoIGFuZCBpdCdzIGxvd2VyIHRoYW4gdGhlIGxhc3QsIHVwZGF0ZSB0aGUgaGl0LgoKCiAgICAgICAgICBpZiAobW9kZSA9PT0gJ2xvd2VzdCcgJiYgaXNMb3dlcikgewogICAgICAgICAgICBoaXQgPSBbbm9kZSwgcGF0aF07CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfSAvLyBJbiBsb3dlc3QgbW9kZSB3ZSBlbWl0IHRoZSBsYXN0IGhpdCwgb25jZSBpdCdzIGd1YXJhbnRlZWQgbG93ZXN0LgoKCiAgICAgICAgICB2YXIgZW1pdCA9IG1vZGUgPT09ICdsb3dlc3QnID8gaGl0IDogW25vZGUsIHBhdGhdOwoKICAgICAgICAgIGlmIChlbWl0KSB7CiAgICAgICAgICAgIGlmICh1bml2ZXJzYWwpIHsKICAgICAgICAgICAgICBtYXRjaGVzLnB1c2goZW1pdCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgeWllbGQgZW1pdDsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGhpdCA9IFtub2RlLCBwYXRoXTsKICAgICAgICB9IC8vIFNpbmNlIGxvd2VzdCBpcyBhbHdheXMgZW1pdHRpbmcgb25lIGJlaGluZCwgY2F0Y2ggdXAgYXQgdGhlIGVuZC4KCiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjUuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjUuZigpOwogICAgICB9CgogICAgICBpZiAobW9kZSA9PT0gJ2xvd2VzdCcgJiYgaGl0KSB7CiAgICAgICAgaWYgKHVuaXZlcnNhbCkgewogICAgICAgICAgbWF0Y2hlcy5wdXNoKGhpdCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHlpZWxkIGhpdDsKICAgICAgICB9CiAgICAgIH0gLy8gVW5pdmVyc2FsIGRlZmVycyB0byBlbnN1cmUgdGhhdCB0aGUgbWF0Y2ggb2NjdXJzIGluIGV2ZXJ5IGJyYW5jaCwgc28gd2UKICAgICAgLy8geWllbGQgYWxsIG9mIHRoZSBtYXRjaGVzIGFmdGVyIGl0ZXJhdGluZy4KCgogICAgICBpZiAodW5pdmVyc2FsKSB7CiAgICAgICAgeWllbGQqIG1hdGNoZXM7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBOb3JtYWxpemUgYW55IGRpcnR5IG9iamVjdHMgaW4gdGhlIGVkaXRvci4KICAgICAqLwogICAgbm9ybWFsaXplOiBmdW5jdGlvbiBub3JtYWxpemUoZWRpdG9yKSB7CiAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsKICAgICAgdmFyIF9vcHRpb25zJGZvcmNlID0gb3B0aW9ucy5mb3JjZSwKICAgICAgICAgIGZvcmNlID0gX29wdGlvbnMkZm9yY2UgPT09IHZvaWQgMCA/IGZhbHNlIDogX29wdGlvbnMkZm9yY2U7CgogICAgICB2YXIgZ2V0RGlydHlQYXRocyA9IGZ1bmN0aW9uIGdldERpcnR5UGF0aHMoZWRpdG9yKSB7CiAgICAgICAgcmV0dXJuIERJUlRZX1BBVEhTLmdldChlZGl0b3IpIHx8IFtdOwogICAgICB9OwoKICAgICAgaWYgKCFFZGl0b3IuaXNOb3JtYWxpemluZyhlZGl0b3IpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoZm9yY2UpIHsKICAgICAgICB2YXIgYWxsUGF0aHMgPSBBcnJheS5mcm9tKE5vZGUkMS5ub2RlcyhlZGl0b3IpLCBmdW5jdGlvbiAoX3JlZjMpIHsKICAgICAgICAgIHZhciBfcmVmNCA9IF9zbGljZWRUb0FycmF5KF9yZWYzLCAyKSwKICAgICAgICAgICAgICBwID0gX3JlZjRbMV07CgogICAgICAgICAgcmV0dXJuIHA7CiAgICAgICAgfSk7CiAgICAgICAgRElSVFlfUEFUSFMuc2V0KGVkaXRvciwgYWxsUGF0aHMpOwogICAgICB9CgogICAgICBpZiAoZ2V0RGlydHlQYXRocyhlZGl0b3IpLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgRWRpdG9yLndpdGhvdXROb3JtYWxpemluZyhlZGl0b3IsIGZ1bmN0aW9uICgpIHsKICAgICAgICAvKgogICAgICAgICAgRml4IGRpcnR5IGVsZW1lbnRzIHdpdGggbm8gY2hpbGRyZW4uCiAgICAgICAgICBlZGl0b3Iubm9ybWFsaXplTm9kZSgpIGRvZXMgZml4IHRoaXMsIGJ1dCBzb21lIG5vcm1hbGl6YXRpb24gZml4ZXMgYWxzbyByZXF1aXJlIGl0IHRvIHdvcmsuCiAgICAgICAgICBSdW5uaW5nIGFuIGluaXRpYWwgcGFzcyBhdm9pZHMgdGhlIGNhdGNoLTIyIHJhY2UgY29uZGl0aW9uLgogICAgICAgICovCiAgICAgICAgdmFyIF9pdGVyYXRvcjYgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciQ1KGdldERpcnR5UGF0aHMoZWRpdG9yKSksCiAgICAgICAgICAgIF9zdGVwNjsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGZvciAoX2l0ZXJhdG9yNi5zKCk7ICEoX3N0ZXA2ID0gX2l0ZXJhdG9yNi5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgIHZhciBfZGlydHlQYXRoID0gX3N0ZXA2LnZhbHVlOwoKICAgICAgICAgICAgaWYgKE5vZGUkMS5oYXMoZWRpdG9yLCBfZGlydHlQYXRoKSkgewogICAgICAgICAgICAgIHZhciBfZW50cnkgPSBFZGl0b3Iubm9kZShlZGl0b3IsIF9kaXJ0eVBhdGgpOwoKICAgICAgICAgICAgICB2YXIgX2VudHJ5MiA9IF9zbGljZWRUb0FycmF5KF9lbnRyeSwgMiksCiAgICAgICAgICAgICAgICAgIG5vZGUgPSBfZW50cnkyWzBdLAogICAgICAgICAgICAgICAgICBfID0gX2VudHJ5MlsxXTsKICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgVGhlIGRlZmF1bHQgbm9ybWFsaXplciBpbnNlcnRzIGFuIGVtcHR5IHRleHQgbm9kZSBpbiB0aGlzIHNjZW5hcmlvLCBidXQgaXQgY2FuIGJlIGN1c3RvbWlzZWQuCiAgICAgICAgICAgICAgICBTbyB0aGVyZSBpcyBzb21lIHJpc2sgaGVyZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgQXMgbG9uZyBhcyB0aGUgbm9ybWFsaXplciBvbmx5IGluc2VydHMgY2hpbGQgbm9kZXMgZm9yIHRoaXMgY2FzZSBpdCBpcyBzYWZlIHRvIGRvIGluIGFueSBvcmRlcjsKICAgICAgICAgICAgICAgIGJ5IGRlZmluaXRpb24gYWRkaW5nIGNoaWxkcmVuIHRvIGFuIGVtcHR5IG5vZGUgY2FuJ3QgY2F1c2Ugb3RoZXIgcGF0aHMgdG8gY2hhbmdlLgogICAgICAgICAgICAgICovCgoKICAgICAgICAgICAgICBpZiAoRWxlbWVudCQxLmlzRWxlbWVudChub2RlKSAmJiBub2RlLmNoaWxkcmVuLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgZWRpdG9yLm5vcm1hbGl6ZU5vZGUoX2VudHJ5KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgIF9pdGVyYXRvcjYuZShlcnIpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICBfaXRlcmF0b3I2LmYoKTsKICAgICAgICB9CgogICAgICAgIHZhciBtYXggPSBnZXREaXJ0eVBhdGhzKGVkaXRvcikubGVuZ3RoICogNDI7IC8vIEhBQ0s6IGJldHRlciB3YXk/CgogICAgICAgIHZhciBtID0gMDsKCiAgICAgICAgd2hpbGUgKGdldERpcnR5UGF0aHMoZWRpdG9yKS5sZW5ndGggIT09IDApIHsKICAgICAgICAgIGlmIChtID4gbWF4KSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiXG4gICAgICAgICAgICBDb3VsZCBub3QgY29tcGxldGVseSBub3JtYWxpemUgdGhlIGVkaXRvciBhZnRlciAiLmNvbmNhdChtYXgsICIgaXRlcmF0aW9ucyEgVGhpcyBpcyB1c3VhbGx5IGR1ZSB0byBpbmNvcnJlY3Qgbm9ybWFsaXphdGlvbiBsb2dpYyB0aGF0IGxlYXZlcyBhIG5vZGUgaW4gYW4gaW52YWxpZCBzdGF0ZS5cbiAgICAgICAgICAiKSk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGRpcnR5UGF0aCA9IGdldERpcnR5UGF0aHMoZWRpdG9yKS5wb3AoKTsgLy8gSWYgdGhlIG5vZGUgZG9lc24ndCBleGlzdCBpbiB0aGUgdHJlZSwgaXQgZG9lcyBub3QgbmVlZCB0byBiZSBub3JtYWxpemVkLgoKICAgICAgICAgIGlmIChOb2RlJDEuaGFzKGVkaXRvciwgZGlydHlQYXRoKSkgewogICAgICAgICAgICB2YXIgZW50cnkgPSBFZGl0b3Iubm9kZShlZGl0b3IsIGRpcnR5UGF0aCk7CiAgICAgICAgICAgIGVkaXRvci5ub3JtYWxpemVOb2RlKGVudHJ5KTsKICAgICAgICAgIH0KCiAgICAgICAgICBtKys7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBHZXQgdGhlIHBhcmVudCBub2RlIG9mIGEgbG9jYXRpb24uCiAgICAgKi8KICAgIHBhcmVudDogZnVuY3Rpb24gcGFyZW50KGVkaXRvciwgYXQpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IHt9OwogICAgICB2YXIgcGF0aCA9IEVkaXRvci5wYXRoKGVkaXRvciwgYXQsIG9wdGlvbnMpOwogICAgICB2YXIgcGFyZW50UGF0aCA9IFBhdGgucGFyZW50KHBhdGgpOwogICAgICB2YXIgZW50cnkgPSBFZGl0b3Iubm9kZShlZGl0b3IsIHBhcmVudFBhdGgpOwogICAgICByZXR1cm4gZW50cnk7CiAgICB9LAoKICAgIC8qKgogICAgICogR2V0IHRoZSBwYXRoIG9mIGEgbG9jYXRpb24uCiAgICAgKi8KICAgIHBhdGg6IGZ1bmN0aW9uIHBhdGgoZWRpdG9yLCBhdCkgewogICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDoge307CiAgICAgIHZhciBkZXB0aCA9IG9wdGlvbnMuZGVwdGgsCiAgICAgICAgICBlZGdlID0gb3B0aW9ucy5lZGdlOwoKICAgICAgaWYgKFBhdGguaXNQYXRoKGF0KSkgewogICAgICAgIGlmIChlZGdlID09PSAnc3RhcnQnKSB7CiAgICAgICAgICB2YXIgX05vZGUkZmlyc3QgPSBOb2RlJDEuZmlyc3QoZWRpdG9yLCBhdCksCiAgICAgICAgICAgICAgX05vZGUkZmlyc3QyID0gX3NsaWNlZFRvQXJyYXkoX05vZGUkZmlyc3QsIDIpLAogICAgICAgICAgICAgIGZpcnN0UGF0aCA9IF9Ob2RlJGZpcnN0MlsxXTsKCiAgICAgICAgICBhdCA9IGZpcnN0UGF0aDsKICAgICAgICB9IGVsc2UgaWYgKGVkZ2UgPT09ICdlbmQnKSB7CiAgICAgICAgICB2YXIgX05vZGUkbGFzdCA9IE5vZGUkMS5sYXN0KGVkaXRvciwgYXQpLAogICAgICAgICAgICAgIF9Ob2RlJGxhc3QyID0gX3NsaWNlZFRvQXJyYXkoX05vZGUkbGFzdCwgMiksCiAgICAgICAgICAgICAgbGFzdFBhdGggPSBfTm9kZSRsYXN0MlsxXTsKCiAgICAgICAgICBhdCA9IGxhc3RQYXRoOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKFJhbmdlLmlzUmFuZ2UoYXQpKSB7CiAgICAgICAgaWYgKGVkZ2UgPT09ICdzdGFydCcpIHsKICAgICAgICAgIGF0ID0gUmFuZ2Uuc3RhcnQoYXQpOwogICAgICAgIH0gZWxzZSBpZiAoZWRnZSA9PT0gJ2VuZCcpIHsKICAgICAgICAgIGF0ID0gUmFuZ2UuZW5kKGF0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYXQgPSBQYXRoLmNvbW1vbihhdC5hbmNob3IucGF0aCwgYXQuZm9jdXMucGF0aCk7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoUG9pbnQuaXNQb2ludChhdCkpIHsKICAgICAgICBhdCA9IGF0LnBhdGg7CiAgICAgIH0KCiAgICAgIGlmIChkZXB0aCAhPSBudWxsKSB7CiAgICAgICAgYXQgPSBhdC5zbGljZSgwLCBkZXB0aCk7CiAgICAgIH0KCiAgICAgIHJldHVybiBhdDsKICAgIH0sCiAgICBoYXNQYXRoOiBmdW5jdGlvbiBoYXNQYXRoKGVkaXRvciwgcGF0aCkgewogICAgICByZXR1cm4gTm9kZSQxLmhhcyhlZGl0b3IsIHBhdGgpOwogICAgfSwKCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG11dGFibGUgcmVmIGZvciBhIGBQYXRoYCBvYmplY3QsIHdoaWNoIHdpbGwgc3RheSBpbiBzeW5jIGFzIG5ldwogICAgICogb3BlcmF0aW9ucyBhcmUgYXBwbGllZCB0byB0aGUgZWRpdG9yLgogICAgICovCiAgICBwYXRoUmVmOiBmdW5jdGlvbiBwYXRoUmVmKGVkaXRvciwgcGF0aCkgewogICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDoge307CiAgICAgIHZhciBfb3B0aW9ucyRhZmZpbml0eSA9IG9wdGlvbnMuYWZmaW5pdHksCiAgICAgICAgICBhZmZpbml0eSA9IF9vcHRpb25zJGFmZmluaXR5ID09PSB2b2lkIDAgPyAnZm9yd2FyZCcgOiBfb3B0aW9ucyRhZmZpbml0eTsKICAgICAgdmFyIHJlZiA9IHsKICAgICAgICBjdXJyZW50OiBwYXRoLAogICAgICAgIGFmZmluaXR5OiBhZmZpbml0eSwKICAgICAgICB1bnJlZjogZnVuY3Rpb24gdW5yZWYoKSB7CiAgICAgICAgICB2YXIgY3VycmVudCA9IHJlZi5jdXJyZW50OwogICAgICAgICAgdmFyIHBhdGhSZWZzID0gRWRpdG9yLnBhdGhSZWZzKGVkaXRvcik7CiAgICAgICAgICBwYXRoUmVmc1siZGVsZXRlIl0ocmVmKTsKICAgICAgICAgIHJlZi5jdXJyZW50ID0gbnVsbDsKICAgICAgICAgIHJldHVybiBjdXJyZW50OwogICAgICAgIH0KICAgICAgfTsKICAgICAgdmFyIHJlZnMgPSBFZGl0b3IucGF0aFJlZnMoZWRpdG9yKTsKICAgICAgcmVmcy5hZGQocmVmKTsKICAgICAgcmV0dXJuIHJlZjsKICAgIH0sCgogICAgLyoqCiAgICAgKiBHZXQgdGhlIHNldCBvZiBjdXJyZW50bHkgdHJhY2tlZCBwYXRoIHJlZnMgb2YgdGhlIGVkaXRvci4KICAgICAqLwogICAgcGF0aFJlZnM6IGZ1bmN0aW9uIHBhdGhSZWZzKGVkaXRvcikgewogICAgICB2YXIgcmVmcyA9IFBBVEhfUkVGUy5nZXQoZWRpdG9yKTsKCiAgICAgIGlmICghcmVmcykgewogICAgICAgIHJlZnMgPSBuZXcgU2V0KCk7CiAgICAgICAgUEFUSF9SRUZTLnNldChlZGl0b3IsIHJlZnMpOwogICAgICB9CgogICAgICByZXR1cm4gcmVmczsKICAgIH0sCgogICAgLyoqCiAgICAgKiBHZXQgdGhlIHN0YXJ0IG9yIGVuZCBwb2ludCBvZiBhIGxvY2F0aW9uLgogICAgICovCiAgICBwb2ludDogZnVuY3Rpb24gcG9pbnQoZWRpdG9yLCBhdCkgewogICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDoge307CiAgICAgIHZhciBfb3B0aW9ucyRlZGdlID0gb3B0aW9ucy5lZGdlLAogICAgICAgICAgZWRnZSA9IF9vcHRpb25zJGVkZ2UgPT09IHZvaWQgMCA/ICdzdGFydCcgOiBfb3B0aW9ucyRlZGdlOwoKICAgICAgaWYgKFBhdGguaXNQYXRoKGF0KSkgewogICAgICAgIHZhciBwYXRoOwoKICAgICAgICBpZiAoZWRnZSA9PT0gJ2VuZCcpIHsKICAgICAgICAgIHZhciBfTm9kZSRsYXN0MyA9IE5vZGUkMS5sYXN0KGVkaXRvciwgYXQpLAogICAgICAgICAgICAgIF9Ob2RlJGxhc3Q0ID0gX3NsaWNlZFRvQXJyYXkoX05vZGUkbGFzdDMsIDIpLAogICAgICAgICAgICAgIGxhc3RQYXRoID0gX05vZGUkbGFzdDRbMV07CgogICAgICAgICAgcGF0aCA9IGxhc3RQYXRoOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgX05vZGUkZmlyc3QzID0gTm9kZSQxLmZpcnN0KGVkaXRvciwgYXQpLAogICAgICAgICAgICAgIF9Ob2RlJGZpcnN0NCA9IF9zbGljZWRUb0FycmF5KF9Ob2RlJGZpcnN0MywgMiksCiAgICAgICAgICAgICAgZmlyc3RQYXRoID0gX05vZGUkZmlyc3Q0WzFdOwoKICAgICAgICAgIHBhdGggPSBmaXJzdFBhdGg7CiAgICAgICAgfQoKICAgICAgICB2YXIgbm9kZSA9IE5vZGUkMS5nZXQoZWRpdG9yLCBwYXRoKTsKCiAgICAgICAgaWYgKCFUZXh0LmlzVGV4dChub2RlKSkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgZ2V0IHRoZSAiLmNvbmNhdChlZGdlLCAiIHBvaW50IGluIHRoZSBub2RlIGF0IHBhdGggWyIpLmNvbmNhdChhdCwgIl0gYmVjYXVzZSBpdCBoYXMgbm8gIikuY29uY2F0KGVkZ2UsICIgdGV4dCBub2RlLiIpKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICBwYXRoOiBwYXRoLAogICAgICAgICAgb2Zmc2V0OiBlZGdlID09PSAnZW5kJyA/IG5vZGUudGV4dC5sZW5ndGggOiAwCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgaWYgKFJhbmdlLmlzUmFuZ2UoYXQpKSB7CiAgICAgICAgdmFyIF9SYW5nZSRlZGdlcyA9IFJhbmdlLmVkZ2VzKGF0KSwKICAgICAgICAgICAgX1JhbmdlJGVkZ2VzMiA9IF9zbGljZWRUb0FycmF5KF9SYW5nZSRlZGdlcywgMiksCiAgICAgICAgICAgIHN0YXJ0ID0gX1JhbmdlJGVkZ2VzMlswXSwKICAgICAgICAgICAgZW5kID0gX1JhbmdlJGVkZ2VzMlsxXTsKCiAgICAgICAgcmV0dXJuIGVkZ2UgPT09ICdzdGFydCcgPyBzdGFydCA6IGVuZDsKICAgICAgfQoKICAgICAgcmV0dXJuIGF0OwogICAgfSwKCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG11dGFibGUgcmVmIGZvciBhIGBQb2ludGAgb2JqZWN0LCB3aGljaCB3aWxsIHN0YXkgaW4gc3luYyBhcyBuZXcKICAgICAqIG9wZXJhdGlvbnMgYXJlIGFwcGxpZWQgdG8gdGhlIGVkaXRvci4KICAgICAqLwogICAgcG9pbnRSZWY6IGZ1bmN0aW9uIHBvaW50UmVmKGVkaXRvciwgcG9pbnQpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IHt9OwogICAgICB2YXIgX29wdGlvbnMkYWZmaW5pdHkyID0gb3B0aW9ucy5hZmZpbml0eSwKICAgICAgICAgIGFmZmluaXR5ID0gX29wdGlvbnMkYWZmaW5pdHkyID09PSB2b2lkIDAgPyAnZm9yd2FyZCcgOiBfb3B0aW9ucyRhZmZpbml0eTI7CiAgICAgIHZhciByZWYgPSB7CiAgICAgICAgY3VycmVudDogcG9pbnQsCiAgICAgICAgYWZmaW5pdHk6IGFmZmluaXR5LAogICAgICAgIHVucmVmOiBmdW5jdGlvbiB1bnJlZigpIHsKICAgICAgICAgIHZhciBjdXJyZW50ID0gcmVmLmN1cnJlbnQ7CiAgICAgICAgICB2YXIgcG9pbnRSZWZzID0gRWRpdG9yLnBvaW50UmVmcyhlZGl0b3IpOwogICAgICAgICAgcG9pbnRSZWZzWyJkZWxldGUiXShyZWYpOwogICAgICAgICAgcmVmLmN1cnJlbnQgPSBudWxsOwogICAgICAgICAgcmV0dXJuIGN1cnJlbnQ7CiAgICAgICAgfQogICAgICB9OwogICAgICB2YXIgcmVmcyA9IEVkaXRvci5wb2ludFJlZnMoZWRpdG9yKTsKICAgICAgcmVmcy5hZGQocmVmKTsKICAgICAgcmV0dXJuIHJlZjsKICAgIH0sCgogICAgLyoqCiAgICAgKiBHZXQgdGhlIHNldCBvZiBjdXJyZW50bHkgdHJhY2tlZCBwb2ludCByZWZzIG9mIHRoZSBlZGl0b3IuCiAgICAgKi8KICAgIHBvaW50UmVmczogZnVuY3Rpb24gcG9pbnRSZWZzKGVkaXRvcikgewogICAgICB2YXIgcmVmcyA9IFBPSU5UX1JFRlMuZ2V0KGVkaXRvcik7CgogICAgICBpZiAoIXJlZnMpIHsKICAgICAgICByZWZzID0gbmV3IFNldCgpOwogICAgICAgIFBPSU5UX1JFRlMuc2V0KGVkaXRvciwgcmVmcyk7CiAgICAgIH0KCiAgICAgIHJldHVybiByZWZzOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybiBhbGwgdGhlIHBvc2l0aW9ucyBpbiBgYXRgIHJhbmdlIHdoZXJlIGEgYFBvaW50YCBjYW4gYmUgcGxhY2VkLgogICAgICoKICAgICAqIEJ5IGRlZmF1bHQsIG1vdmVzIGZvcndhcmQgYnkgaW5kaXZpZHVhbCBvZmZzZXRzIGF0IGEgdGltZSwgYnV0CiAgICAgKiB0aGUgYHVuaXRgIG9wdGlvbiBjYW4gYmUgdXNlZCB0byB0byBtb3ZlIGJ5IGNoYXJhY3Rlciwgd29yZCwgbGluZSwgb3IgYmxvY2suCiAgICAgKgogICAgICogVGhlIGByZXZlcnNlYCBvcHRpb24gY2FuIGJlIHVzZWQgdG8gY2hhbmdlIGl0ZXJhdGlvbiBkaXJlY3Rpb24uCiAgICAgKgogICAgICogTm90ZTogQnkgZGVmYXVsdCB2b2lkIG5vZGVzIGFyZSB0cmVhdGVkIGFzIGEgc2luZ2xlIHBvaW50IGFuZCBpdGVyYXRpb24KICAgICAqIHdpbGwgbm90IGhhcHBlbiBpbnNpZGUgdGhlaXIgY29udGVudCB1bmxlc3MgeW91IHBhc3MgaW4gdHJ1ZSBmb3IgdGhlCiAgICAgKiBgdm9pZHNgIG9wdGlvbiwgdGhlbiBpdGVyYXRpb24gd2lsbCBvY2N1ci4KICAgICAqLwogICAgcG9zaXRpb25zOiBmdW5jdGlvbiogcG9zaXRpb25zKGVkaXRvcikgewogICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CiAgICAgIHZhciBfb3B0aW9ucyRhdDUgPSBvcHRpb25zLmF0LAogICAgICAgICAgYXQgPSBfb3B0aW9ucyRhdDUgPT09IHZvaWQgMCA/IGVkaXRvci5zZWxlY3Rpb24gOiBfb3B0aW9ucyRhdDUsCiAgICAgICAgICBfb3B0aW9ucyR1bml0MyA9IG9wdGlvbnMudW5pdCwKICAgICAgICAgIHVuaXQgPSBfb3B0aW9ucyR1bml0MyA9PT0gdm9pZCAwID8gJ29mZnNldCcgOiBfb3B0aW9ucyR1bml0MywKICAgICAgICAgIF9vcHRpb25zJHJldmVyc2UzID0gb3B0aW9ucy5yZXZlcnNlLAogICAgICAgICAgcmV2ZXJzZSA9IF9vcHRpb25zJHJldmVyc2UzID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zJHJldmVyc2UzLAogICAgICAgICAgX29wdGlvbnMkdm9pZHM1ID0gb3B0aW9ucy52b2lkcywKICAgICAgICAgIHZvaWRzID0gX29wdGlvbnMkdm9pZHM1ID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zJHZvaWRzNTsKCiAgICAgIGlmICghYXQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgLyoqCiAgICAgICAqIEFsZ29yaXRobSBub3RlczoKICAgICAgICoKICAgICAgICogRWFjaCBzdGVwIGBkaXN0YW5jZWAgaXMgZHluYW1pYyBkZXBlbmRpbmcgb24gdGhlIHVuZGVybHlpbmcgdGV4dAogICAgICAgKiBhbmQgdGhlIGB1bml0YCBzcGVjaWZpZWQuICBFYWNoIHN0ZXAsIGUuZy4sIGEgbGluZSBvciB3b3JkLCBtYXkKICAgICAgICogc3BhbiBtdWx0aXBsZSB0ZXh0IG5vZGVzLCBzbyB3ZSBpdGVyYXRlIHRocm91Z2ggdGhlIHRleHQgYm90aCBvbgogICAgICAgKiB0d28gbGV2ZWxzIGluIHN0ZXAtc3luYzoKICAgICAgICoKICAgICAgICogYGxlYWZUZXh0YCBzdG9yZXMgdGhlIHRleHQgb24gYSB0ZXh0IGxlYWYgbGV2ZWwsIGFuZCBpcyBhZHZhbmNlZAogICAgICAgKiB0aHJvdWdoIHVzaW5nIHRoZSBjb3VudGVycyBgbGVhZlRleHRPZmZzZXRgIGFuZCBgbGVhZlRleHRSZW1haW5pbmdgLgogICAgICAgKgogICAgICAgKiBgYmxvY2tUZXh0YCBzdG9yZXMgdGhlIHRleHQgb24gYSBibG9jayBsZXZlbCwgYW5kIGlzIHNob3J0ZW5lZAogICAgICAgKiBieSBgZGlzdGFuY2VgIGV2ZXJ5IHRpbWUgaXQgaXMgYWR2YW5jZWQuCiAgICAgICAqCiAgICAgICAqIFdlIG9ubHkgbWFpbnRhaW4gYSB3aW5kb3cgb2Ygb25lIGJsb2NrVGV4dCBhbmQgb25lIGxlYWZUZXh0IGJlY2F1c2UKICAgICAgICogYSBibG9jayBub2RlIGFsd2F5cyBhcHBlYXJzIGJlZm9yZSBhbGwgb2YgaXRzIGxlYWYgbm9kZXMuCiAgICAgICAqLwoKCiAgICAgIHZhciByYW5nZSA9IEVkaXRvci5yYW5nZShlZGl0b3IsIGF0KTsKCiAgICAgIHZhciBfUmFuZ2UkZWRnZXMzID0gUmFuZ2UuZWRnZXMocmFuZ2UpLAogICAgICAgICAgX1JhbmdlJGVkZ2VzNCA9IF9zbGljZWRUb0FycmF5KF9SYW5nZSRlZGdlczMsIDIpLAogICAgICAgICAgc3RhcnQgPSBfUmFuZ2UkZWRnZXM0WzBdLAogICAgICAgICAgZW5kID0gX1JhbmdlJGVkZ2VzNFsxXTsKCiAgICAgIHZhciBmaXJzdCA9IHJldmVyc2UgPyBlbmQgOiBzdGFydDsKICAgICAgdmFyIGlzTmV3QmxvY2sgPSBmYWxzZTsKICAgICAgdmFyIGJsb2NrVGV4dCA9ICcnOwogICAgICB2YXIgZGlzdGFuY2UgPSAwOyAvLyBEaXN0YW5jZSBmb3IgbGVhZlRleHQgdG8gY2F0Y2ggdXAgdG8gYmxvY2tUZXh0LgoKICAgICAgdmFyIGxlYWZUZXh0UmVtYWluaW5nID0gMDsKICAgICAgdmFyIGxlYWZUZXh0T2Zmc2V0ID0gMDsgLy8gSXRlcmF0ZSB0aHJvdWdoIGFsbCBub2RlcyBpbiByYW5nZSwgZ3JhYmJpbmcgZW50aXJlIHRleHR1YWwgY29udGVudAogICAgICAvLyBvZiBibG9jayBub2RlcyBpbiBibG9ja1RleHQsIGFuZCB0ZXh0IG5vZGVzIGluIGxlYWZUZXh0LgogICAgICAvLyBFeHBsb2l0cyB0aGUgZmFjdCB0aGF0IG5vZGVzIGFyZSBzZXF1ZW5jZWQgaW4gc3VjaCBhIHdheSB0aGF0IHdlIGZpcnN0CiAgICAgIC8vIGVuY291bnRlciB0aGUgYmxvY2sgbm9kZSwgdGhlbiBhbGwgb2YgaXRzIHRleHQgbm9kZXMsIHNvIHdoZW4gaXRlcmF0aW5nCiAgICAgIC8vIHRocm91Z2ggdGhlIGJsb2NrVGV4dCBhbmQgbGVhZlRleHQgd2UganVzdCBuZWVkIHRvIHJlbWVtYmVyIGEgd2luZG93IG9mCiAgICAgIC8vIG9uZSBibG9jayBub2RlIGFuZCBsZWFmIG5vZGUsIHJlc3BlY3RpdmVseS4KCiAgICAgIHZhciBfaXRlcmF0b3I3ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIkNShFZGl0b3Iubm9kZXMoZWRpdG9yLCB7CiAgICAgICAgYXQ6IGF0LAogICAgICAgIHJldmVyc2U6IHJldmVyc2UsCiAgICAgICAgdm9pZHM6IHZvaWRzCiAgICAgIH0pKSwKICAgICAgICAgIF9zdGVwNzsKCiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3I3LnMoKTsgIShfc3RlcDcgPSBfaXRlcmF0b3I3Lm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBfc3RlcDckdmFsdWUgPSBfc2xpY2VkVG9BcnJheShfc3RlcDcudmFsdWUsIDIpLAogICAgICAgICAgICAgIG5vZGUgPSBfc3RlcDckdmFsdWVbMF0sCiAgICAgICAgICAgICAgcGF0aCA9IF9zdGVwNyR2YWx1ZVsxXTsKCiAgICAgICAgICAvKgogICAgICAgICAgICogRUxFTUVOVCBOT0RFIC0gWWllbGQgcG9zaXRpb24ocykgZm9yIHZvaWRzLCBjb2xsZWN0IGJsb2NrVGV4dCBmb3IgYmxvY2tzCiAgICAgICAgICAgKi8KICAgICAgICAgIGlmIChFbGVtZW50JDEuaXNFbGVtZW50KG5vZGUpKSB7CiAgICAgICAgICAgIC8vIFZvaWQgbm9kZXMgYXJlIGEgc3BlY2lhbCBjYXNlLCBzbyBieSBkZWZhdWx0IHdlIHdpbGwgYWx3YXlzCiAgICAgICAgICAgIC8vIHlpZWxkIHRoZWlyIGZpcnN0IHBvaW50LiBJZiB0aGUgYHZvaWRzYCBvcHRpb24gaXMgc2V0IHRvIHRydWUsCiAgICAgICAgICAgIC8vIHRoZW4gd2Ugd2lsbCBpdGVyYXRlIG92ZXIgdGhlaXIgY29udGVudC4KICAgICAgICAgICAgaWYgKCF2b2lkcyAmJiBlZGl0b3IuaXNWb2lkKG5vZGUpKSB7CiAgICAgICAgICAgICAgeWllbGQgRWRpdG9yLnN0YXJ0KGVkaXRvciwgcGF0aCk7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0gLy8gSW5saW5lIGVsZW1lbnQgbm9kZXMgYXJlIGlnbm9yZWQgYXMgdGhleSBkb24ndCB0aGVtc2VsdmVzCiAgICAgICAgICAgIC8vIGNvbnRyaWJ1dGUgdG8gYGJsb2NrVGV4dGAgb3IgYGxlYWZUZXh0YCAtIHRoZWlyIHBhcmVudCBhbmQKICAgICAgICAgICAgLy8gY2hpbGRyZW4gZG8uCgoKICAgICAgICAgICAgaWYgKGVkaXRvci5pc0lubGluZShub2RlKSkgY29udGludWU7IC8vIEJsb2NrIGVsZW1lbnQgbm9kZSAtIHNldCBgYmxvY2tUZXh0YCB0byBpdHMgdGV4dCBjb250ZW50LgoKICAgICAgICAgICAgaWYgKEVkaXRvci5oYXNJbmxpbmVzKGVkaXRvciwgbm9kZSkpIHsKICAgICAgICAgICAgICAvLyBXZSBhbHdheXMgZXhoYXVzdCBibG9jayBub2RlcyBiZWZvcmUgZW5jb3VudGVyaW5nIGEgbmV3IG9uZToKICAgICAgICAgICAgICAvLyAgIGNvbnNvbGUuYXNzZXJ0KGJsb2NrVGV4dCA9PT0gJycsCiAgICAgICAgICAgICAgLy8gICAgIGBibG9ja1RleHQ9JyR7YmxvY2tUZXh0fScgLSBgKwogICAgICAgICAgICAgIC8vICAgICBgbm90IGV4aGF1c3RlZCBiZWZvcmUgbmV3IGJsb2NrIG5vZGVgLCBwYXRoKQogICAgICAgICAgICAgIC8vIEVuc3VyZSByYW5nZSBjb25zaWRlcmVkIGlzIGNhcHBlZCB0byBgcmFuZ2VgLCBpbiB0aGUKICAgICAgICAgICAgICAvLyBzdGFydC9lbmQgZWRnZSBjYXNlcyB3aGVyZSBibG9jayBleHRlbmRzIGJleW9uZCByYW5nZS4KICAgICAgICAgICAgICAvLyBFcXVpdmFsZW50IHRvIHRoaXMsIGJ1dCBwcmVzdW1hYmx5IG1vcmUgcGVyZm9ybWFudDoKICAgICAgICAgICAgICAvLyAgIGJsb2NrUmFuZ2UgPSBFZGl0b3IucmFuZ2UoZWRpdG9yLCAuLi5FZGl0b3IuZWRnZXMoZWRpdG9yLCBwYXRoKSkKICAgICAgICAgICAgICAvLyAgIGJsb2NrUmFuZ2UgPSBSYW5nZS5pbnRlcnNlY3Rpb24ocmFuZ2UsIGJsb2NrUmFuZ2UpIC8vIGludGVyc2VjdAogICAgICAgICAgICAgIC8vICAgYmxvY2tUZXh0ID0gRWRpdG9yLnN0cmluZyhlZGl0b3IsIGJsb2NrUmFuZ2UsIHsgdm9pZHMgfSkKICAgICAgICAgICAgICB2YXIgZSA9IFBhdGguaXNBbmNlc3RvcihwYXRoLCBlbmQucGF0aCkgPyBlbmQgOiBFZGl0b3IuZW5kKGVkaXRvciwgcGF0aCk7CiAgICAgICAgICAgICAgdmFyIHMgPSBQYXRoLmlzQW5jZXN0b3IocGF0aCwgc3RhcnQucGF0aCkgPyBzdGFydCA6IEVkaXRvci5zdGFydChlZGl0b3IsIHBhdGgpOwogICAgICAgICAgICAgIGJsb2NrVGV4dCA9IEVkaXRvci5zdHJpbmcoZWRpdG9yLCB7CiAgICAgICAgICAgICAgICBhbmNob3I6IHMsCiAgICAgICAgICAgICAgICBmb2N1czogZQogICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIHZvaWRzOiB2b2lkcwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGlzTmV3QmxvY2sgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAvKgogICAgICAgICAgICogVEVYVCBMRUFGIE5PREUgLSBJdGVyYXRlIHRocm91Z2ggdGV4dCBjb250ZW50LCB5aWVsZGluZwogICAgICAgICAgICogcG9zaXRpb25zIGV2ZXJ5IGBkaXN0YW5jZWAgb2Zmc2V0IGFjY29yZGluZyB0byBgdW5pdGAuCiAgICAgICAgICAgKi8KCgogICAgICAgICAgaWYgKFRleHQuaXNUZXh0KG5vZGUpKSB7CiAgICAgICAgICAgIHZhciBpc0ZpcnN0ID0gUGF0aC5lcXVhbHMocGF0aCwgZmlyc3QucGF0aCk7IC8vIFByb29mIHRoYXQgd2UgYWx3YXlzIGV4aGF1c3QgdGV4dCBub2RlcyBiZWZvcmUgZW5jb3VudGVyaW5nIGEgbmV3IG9uZToKICAgICAgICAgICAgLy8gICBjb25zb2xlLmFzc2VydChsZWFmVGV4dFJlbWFpbmluZyA8PSAwLAogICAgICAgICAgICAvLyAgICAgYGxlYWZUZXh0UmVtYWluaW5nPSR7bGVhZlRleHRSZW1haW5pbmd9IC0gYCsKICAgICAgICAgICAgLy8gICAgIGBub3QgZXhoYXVzdGVkIGJlZm9yZSBuZXcgbGVhZiB0ZXh0IG5vZGVgLCBwYXRoKQogICAgICAgICAgICAvLyBSZXNldCBgbGVhZlRleHRgIGNvdW50ZXJzIGZvciBuZXcgdGV4dCBub2RlLgoKICAgICAgICAgICAgaWYgKGlzRmlyc3QpIHsKICAgICAgICAgICAgICBsZWFmVGV4dFJlbWFpbmluZyA9IHJldmVyc2UgPyBmaXJzdC5vZmZzZXQgOiBub2RlLnRleHQubGVuZ3RoIC0gZmlyc3Qub2Zmc2V0OwogICAgICAgICAgICAgIGxlYWZUZXh0T2Zmc2V0ID0gZmlyc3Qub2Zmc2V0OyAvLyBXb3JrcyBmb3IgcmV2ZXJzZSB0b28uCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbGVhZlRleHRSZW1haW5pbmcgPSBub2RlLnRleHQubGVuZ3RoOwogICAgICAgICAgICAgIGxlYWZUZXh0T2Zmc2V0ID0gcmV2ZXJzZSA/IGxlYWZUZXh0UmVtYWluaW5nIDogMDsKICAgICAgICAgICAgfSAvLyBZaWVsZCBwb3NpdGlvbiBhdCB0aGUgc3RhcnQgb2Ygbm9kZSAocG90ZW50aWFsbHkpLgoKCiAgICAgICAgICAgIGlmIChpc0ZpcnN0IHx8IGlzTmV3QmxvY2sgfHwgdW5pdCA9PT0gJ29mZnNldCcpIHsKICAgICAgICAgICAgICB5aWVsZCB7CiAgICAgICAgICAgICAgICBwYXRoOiBwYXRoLAogICAgICAgICAgICAgICAgb2Zmc2V0OiBsZWFmVGV4dE9mZnNldAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgaXNOZXdCbG9jayA9IGZhbHNlOwogICAgICAgICAgICB9IC8vIFlpZWxkIHBvc2l0aW9ucyBldmVyeSAoZHluYW1pY2FsbHkgY2FsY3VsYXRlZCkgYGRpc3RhbmNlYCBvZmZzZXQuCgoKICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgICAvLyBJZiBgbGVhZlRleHRgIGhhcyBjYXVnaHQgdXAgd2l0aCBgYmxvY2tUZXh0YCAoZGlzdGFuY2U9MCksCiAgICAgICAgICAgICAgLy8gYW5kIGlmIGJsb2NrVGV4dCBpcyBleGhhdXN0ZWQsIGJyZWFrIHRvIGdldCBhbm90aGVyIGJsb2NrIG5vZGUsCiAgICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIGFkdmFuY2UgYmxvY2tUZXh0IGZvcndhcmQgYnkgdGhlIG5ldyBgZGlzdGFuY2VgLgogICAgICAgICAgICAgIGlmIChkaXN0YW5jZSA9PT0gMCkgewogICAgICAgICAgICAgICAgaWYgKGJsb2NrVGV4dCA9PT0gJycpIGJyZWFrOwogICAgICAgICAgICAgICAgZGlzdGFuY2UgPSBjYWxjRGlzdGFuY2UoYmxvY2tUZXh0LCB1bml0LCByZXZlcnNlKTsgLy8gU3BsaXQgdGhlIHN0cmluZyBhdCB0aGUgcHJldmlvdXNseSBmb3VuZCBkaXN0YW5jZSBhbmQgdXNlIHRoZQogICAgICAgICAgICAgICAgLy8gcmVtYWluaW5nIHN0cmluZyBmb3IgdGhlIG5leHQgaXRlcmF0aW9uLgoKICAgICAgICAgICAgICAgIGJsb2NrVGV4dCA9IHNwbGl0QnlDaGFyYWN0ZXJEaXN0YW5jZShibG9ja1RleHQsIGRpc3RhbmNlLCByZXZlcnNlKVsxXTsKICAgICAgICAgICAgICB9IC8vIEFkdmFuY2UgYGxlYWZUZXh0YCBieSB0aGUgY3VycmVudCBgZGlzdGFuY2VgLgoKCiAgICAgICAgICAgICAgbGVhZlRleHRPZmZzZXQgPSByZXZlcnNlID8gbGVhZlRleHRPZmZzZXQgLSBkaXN0YW5jZSA6IGxlYWZUZXh0T2Zmc2V0ICsgZGlzdGFuY2U7CiAgICAgICAgICAgICAgbGVhZlRleHRSZW1haW5pbmcgPSBsZWFmVGV4dFJlbWFpbmluZyAtIGRpc3RhbmNlOyAvLyBJZiBgbGVhZlRleHRgIGlzIGV4aGF1c3RlZCwgYnJlYWsgdG8gZ2V0IGEgbmV3IGxlYWYgbm9kZQogICAgICAgICAgICAgIC8vIGFuZCBzZXQgZGlzdGFuY2UgdG8gdGhlIG92ZXJmbG93IGFtb3VudCwgc28gd2UnbGwgKG1heWJlKQogICAgICAgICAgICAgIC8vIGNhdGNoIHVwIHRvIGJsb2NrVGV4dCBpbiB0aGUgbmV4dCBsZWFmIHRleHQgbm9kZS4KCiAgICAgICAgICAgICAgaWYgKGxlYWZUZXh0UmVtYWluaW5nIDwgMCkgewogICAgICAgICAgICAgICAgZGlzdGFuY2UgPSAtbGVhZlRleHRSZW1haW5pbmc7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9IC8vIFN1Y2Nlc3NmdWxseSB3YWxrZWQgYGRpc3RhbmNlYCBvZmZzZXRzIHRocm91Z2ggYGxlYWZUZXh0YAogICAgICAgICAgICAgIC8vIHRvIGNhdGNoIHVwIHdpdGggYGJsb2NrVGV4dGAsIHNvIHdlIGNhbiByZXNldCBgZGlzdGFuY2VgCiAgICAgICAgICAgICAgLy8gYW5kIHlpZWxkIHRoaXMgcG9zaXRpb24gaW4gdGhpcyBub2RlLgoKCiAgICAgICAgICAgICAgZGlzdGFuY2UgPSAwOwogICAgICAgICAgICAgIHlpZWxkIHsKICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgsCiAgICAgICAgICAgICAgICBvZmZzZXQ6IGxlYWZUZXh0T2Zmc2V0CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gLy8gUHJvb2YgdGhhdCB1cG9uIGNvbXBsZXRpb24sIHdlJ3ZlIGV4YWh1c3RlZCBib3RoIGxlYWYgYW5kIGJsb2NrIHRleHQ6CiAgICAgICAgLy8gICBjb25zb2xlLmFzc2VydChsZWFmVGV4dFJlbWFpbmluZyA8PSAwLCAibGVhZlRleHQgd2Fzbid0IGV4aGF1c3RlZCIpCiAgICAgICAgLy8gICBjb25zb2xlLmFzc2VydChibG9ja1RleHQgPT09ICcnLCAiYmxvY2tUZXh0IHdhc24ndCBleGhhdXN0ZWQiKQogICAgICAgIC8vIEhlbHBlcjoKICAgICAgICAvLyBSZXR1cm4gdGhlIGRpc3RhbmNlIGluIG9mZnNldHMgZm9yIGEgc3RlcCBvZiBzaXplIGB1bml0YCBvbiBnaXZlbiBzdHJpbmcuCgogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3I3LmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3I3LmYoKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gY2FsY0Rpc3RhbmNlKHRleHQsIHVuaXQsIHJldmVyc2UpIHsKICAgICAgICBpZiAodW5pdCA9PT0gJ2NoYXJhY3RlcicpIHsKICAgICAgICAgIHJldHVybiBnZXRDaGFyYWN0ZXJEaXN0YW5jZSh0ZXh0LCByZXZlcnNlKTsKICAgICAgICB9IGVsc2UgaWYgKHVuaXQgPT09ICd3b3JkJykgewogICAgICAgICAgcmV0dXJuIGdldFdvcmREaXN0YW5jZSh0ZXh0LCByZXZlcnNlKTsKICAgICAgICB9IGVsc2UgaWYgKHVuaXQgPT09ICdsaW5lJyB8fCB1bml0ID09PSAnYmxvY2snKSB7CiAgICAgICAgICByZXR1cm4gdGV4dC5sZW5ndGg7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gMTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIEdldCB0aGUgbWF0Y2hpbmcgbm9kZSBpbiB0aGUgYnJhbmNoIG9mIHRoZSBkb2N1bWVudCBiZWZvcmUgYSBsb2NhdGlvbi4KICAgICAqLwogICAgcHJldmlvdXM6IGZ1bmN0aW9uIHByZXZpb3VzKGVkaXRvcikgewogICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CiAgICAgIHZhciBfb3B0aW9ucyRtb2RlNCA9IG9wdGlvbnMubW9kZSwKICAgICAgICAgIG1vZGUgPSBfb3B0aW9ucyRtb2RlNCA9PT0gdm9pZCAwID8gJ2xvd2VzdCcgOiBfb3B0aW9ucyRtb2RlNCwKICAgICAgICAgIF9vcHRpb25zJHZvaWRzNiA9IG9wdGlvbnMudm9pZHMsCiAgICAgICAgICB2b2lkcyA9IF9vcHRpb25zJHZvaWRzNiA9PT0gdm9pZCAwID8gZmFsc2UgOiBfb3B0aW9ucyR2b2lkczY7CiAgICAgIHZhciBtYXRjaCA9IG9wdGlvbnMubWF0Y2gsCiAgICAgICAgICBfb3B0aW9ucyRhdDYgPSBvcHRpb25zLmF0LAogICAgICAgICAgYXQgPSBfb3B0aW9ucyRhdDYgPT09IHZvaWQgMCA/IGVkaXRvci5zZWxlY3Rpb24gOiBfb3B0aW9ucyRhdDY7CgogICAgICBpZiAoIWF0KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgcG9pbnRCZWZvcmVMb2NhdGlvbiA9IEVkaXRvci5iZWZvcmUoZWRpdG9yLCBhdCwgewogICAgICAgIHZvaWRzOiB2b2lkcwogICAgICB9KTsKCiAgICAgIGlmICghcG9pbnRCZWZvcmVMb2NhdGlvbikgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIF9FZGl0b3IkZmlyc3QgPSBFZGl0b3IuZmlyc3QoZWRpdG9yLCBbXSksCiAgICAgICAgICBfRWRpdG9yJGZpcnN0MiA9IF9zbGljZWRUb0FycmF5KF9FZGl0b3IkZmlyc3QsIDIpLAogICAgICAgICAgdG8gPSBfRWRpdG9yJGZpcnN0MlsxXTsgLy8gVGhlIHNlYXJjaCBsb2NhdGlvbiBpcyBmcm9tIHRoZSBzdGFydCBvZiB0aGUgZG9jdW1lbnQgdG8gdGhlIHBhdGggb2YKICAgICAgLy8gdGhlIHBvaW50IGJlZm9yZSB0aGUgbG9jYXRpb24gcGFzc2VkIGluCgoKICAgICAgdmFyIHNwYW4gPSBbcG9pbnRCZWZvcmVMb2NhdGlvbi5wYXRoLCB0b107CgogICAgICBpZiAoUGF0aC5pc1BhdGgoYXQpICYmIGF0Lmxlbmd0aCA9PT0gMCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2Fubm90IGdldCB0aGUgcHJldmlvdXMgbm9kZSBmcm9tIHRoZSByb290IG5vZGUhIik7CiAgICAgIH0KCiAgICAgIGlmIChtYXRjaCA9PSBudWxsKSB7CiAgICAgICAgaWYgKFBhdGguaXNQYXRoKGF0KSkgewogICAgICAgICAgdmFyIF9FZGl0b3IkcGFyZW50MyA9IEVkaXRvci5wYXJlbnQoZWRpdG9yLCBhdCksCiAgICAgICAgICAgICAgX0VkaXRvciRwYXJlbnQ0ID0gX3NsaWNlZFRvQXJyYXkoX0VkaXRvciRwYXJlbnQzLCAxKSwKICAgICAgICAgICAgICBwYXJlbnQgPSBfRWRpdG9yJHBhcmVudDRbMF07CgogICAgICAgICAgbWF0Y2ggPSBmdW5jdGlvbiBtYXRjaChuKSB7CiAgICAgICAgICAgIHJldHVybiBwYXJlbnQuY2hpbGRyZW4uaW5jbHVkZXMobik7CiAgICAgICAgICB9OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtYXRjaCA9IGZ1bmN0aW9uIG1hdGNoKCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgX0VkaXRvciRub2RlczUgPSBFZGl0b3Iubm9kZXMoZWRpdG9yLCB7CiAgICAgICAgcmV2ZXJzZTogdHJ1ZSwKICAgICAgICBhdDogc3BhbiwKICAgICAgICBtYXRjaDogbWF0Y2gsCiAgICAgICAgbW9kZTogbW9kZSwKICAgICAgICB2b2lkczogdm9pZHMKICAgICAgfSksCiAgICAgICAgICBfRWRpdG9yJG5vZGVzNiA9IF9zbGljZWRUb0FycmF5KF9FZGl0b3Ikbm9kZXM1LCAxKSwKICAgICAgICAgIHByZXZpb3VzID0gX0VkaXRvciRub2RlczZbMF07CgogICAgICByZXR1cm4gcHJldmlvdXM7CiAgICB9LAoKICAgIC8qKgogICAgICogR2V0IGEgcmFuZ2Ugb2YgYSBsb2NhdGlvbi4KICAgICAqLwogICAgcmFuZ2U6IGZ1bmN0aW9uIHJhbmdlKGVkaXRvciwgYXQsIHRvKSB7CiAgICAgIGlmIChSYW5nZS5pc1JhbmdlKGF0KSAmJiAhdG8pIHsKICAgICAgICByZXR1cm4gYXQ7CiAgICAgIH0KCiAgICAgIHZhciBzdGFydCA9IEVkaXRvci5zdGFydChlZGl0b3IsIGF0KTsKICAgICAgdmFyIGVuZCA9IEVkaXRvci5lbmQoZWRpdG9yLCB0byB8fCBhdCk7CiAgICAgIHJldHVybiB7CiAgICAgICAgYW5jaG9yOiBzdGFydCwKICAgICAgICBmb2N1czogZW5kCiAgICAgIH07CiAgICB9LAoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbXV0YWJsZSByZWYgZm9yIGEgYFJhbmdlYCBvYmplY3QsIHdoaWNoIHdpbGwgc3RheSBpbiBzeW5jIGFzIG5ldwogICAgICogb3BlcmF0aW9ucyBhcmUgYXBwbGllZCB0byB0aGUgZWRpdG9yLgogICAgICovCiAgICByYW5nZVJlZjogZnVuY3Rpb24gcmFuZ2VSZWYoZWRpdG9yLCByYW5nZSkgewogICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDoge307CiAgICAgIHZhciBfb3B0aW9ucyRhZmZpbml0eTMgPSBvcHRpb25zLmFmZmluaXR5LAogICAgICAgICAgYWZmaW5pdHkgPSBfb3B0aW9ucyRhZmZpbml0eTMgPT09IHZvaWQgMCA/ICdmb3J3YXJkJyA6IF9vcHRpb25zJGFmZmluaXR5MzsKICAgICAgdmFyIHJlZiA9IHsKICAgICAgICBjdXJyZW50OiByYW5nZSwKICAgICAgICBhZmZpbml0eTogYWZmaW5pdHksCiAgICAgICAgdW5yZWY6IGZ1bmN0aW9uIHVucmVmKCkgewogICAgICAgICAgdmFyIGN1cnJlbnQgPSByZWYuY3VycmVudDsKICAgICAgICAgIHZhciByYW5nZVJlZnMgPSBFZGl0b3IucmFuZ2VSZWZzKGVkaXRvcik7CiAgICAgICAgICByYW5nZVJlZnNbImRlbGV0ZSJdKHJlZik7CiAgICAgICAgICByZWYuY3VycmVudCA9IG51bGw7CiAgICAgICAgICByZXR1cm4gY3VycmVudDsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHZhciByZWZzID0gRWRpdG9yLnJhbmdlUmVmcyhlZGl0b3IpOwogICAgICByZWZzLmFkZChyZWYpOwogICAgICByZXR1cm4gcmVmOwogICAgfSwKCiAgICAvKioKICAgICAqIEdldCB0aGUgc2V0IG9mIGN1cnJlbnRseSB0cmFja2VkIHJhbmdlIHJlZnMgb2YgdGhlIGVkaXRvci4KICAgICAqLwogICAgcmFuZ2VSZWZzOiBmdW5jdGlvbiByYW5nZVJlZnMoZWRpdG9yKSB7CiAgICAgIHZhciByZWZzID0gUkFOR0VfUkVGUy5nZXQoZWRpdG9yKTsKCiAgICAgIGlmICghcmVmcykgewogICAgICAgIHJlZnMgPSBuZXcgU2V0KCk7CiAgICAgICAgUkFOR0VfUkVGUy5zZXQoZWRpdG9yLCByZWZzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlZnM7CiAgICB9LAoKICAgIC8qKgogICAgICogUmVtb3ZlIGEgY3VzdG9tIHByb3BlcnR5IGZyb20gYWxsIG9mIHRoZSBsZWFmIHRleHQgbm9kZXMgaW4gdGhlIGN1cnJlbnQKICAgICAqIHNlbGVjdGlvbi4KICAgICAqCiAgICAgKiBJZiB0aGUgc2VsZWN0aW9uIGlzIGN1cnJlbnRseSBjb2xsYXBzZWQsIHRoZSByZW1vdmFsIHdpbGwgYmUgc3RvcmVkIG9uCiAgICAgKiBgZWRpdG9yLm1hcmtzYCBhbmQgYXBwbGllZCB0byB0aGUgdGV4dCBpbnNlcnRlZCBuZXh0LgogICAgICovCiAgICByZW1vdmVNYXJrOiBmdW5jdGlvbiByZW1vdmVNYXJrKGVkaXRvciwga2V5KSB7CiAgICAgIGVkaXRvci5yZW1vdmVNYXJrKGtleSk7CiAgICB9LAoKICAgIC8qKgogICAgICogTWFudWFsbHkgc2V0IGlmIHRoZSBlZGl0b3Igc2hvdWxkIGN1cnJlbnRseSBiZSBub3JtYWxpemluZy4KICAgICAqCiAgICAgKiBOb3RlOiBVc2luZyB0aGlzIGluY29ycmVjdGx5IGNhbiBsZWF2ZSB0aGUgZWRpdG9yIGluIGFuIGludmFsaWQgc3RhdGUuCiAgICAgKgogICAgICovCiAgICBzZXROb3JtYWxpemluZzogZnVuY3Rpb24gc2V0Tm9ybWFsaXppbmcoZWRpdG9yLCBpc05vcm1hbGl6aW5nKSB7CiAgICAgIE5PUk1BTElaSU5HLnNldChlZGl0b3IsIGlzTm9ybWFsaXppbmcpOwogICAgfSwKCiAgICAvKioKICAgICAqIEdldCB0aGUgc3RhcnQgcG9pbnQgb2YgYSBsb2NhdGlvbi4KICAgICAqLwogICAgc3RhcnQ6IGZ1bmN0aW9uIHN0YXJ0KGVkaXRvciwgYXQpIHsKICAgICAgcmV0dXJuIEVkaXRvci5wb2ludChlZGl0b3IsIGF0LCB7CiAgICAgICAgZWRnZTogJ3N0YXJ0JwogICAgICB9KTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBHZXQgdGhlIHRleHQgc3RyaW5nIGNvbnRlbnQgb2YgYSBsb2NhdGlvbi4KICAgICAqCiAgICAgKiBOb3RlOiBieSBkZWZhdWx0IHRoZSB0ZXh0IG9mIHZvaWQgbm9kZXMgaXMgY29uc2lkZXJlZCB0byBiZSBhbiBlbXB0eQogICAgICogc3RyaW5nLCByZWdhcmRsZXNzIG9mIGNvbnRlbnQsIHVubGVzcyB5b3UgcGFzcyBpbiB0cnVlIGZvciB0aGUgdm9pZHMgb3B0aW9uCiAgICAgKi8KICAgIHN0cmluZzogZnVuY3Rpb24gc3RyaW5nKGVkaXRvciwgYXQpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IHt9OwogICAgICB2YXIgX29wdGlvbnMkdm9pZHM3ID0gb3B0aW9ucy52b2lkcywKICAgICAgICAgIHZvaWRzID0gX29wdGlvbnMkdm9pZHM3ID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zJHZvaWRzNzsKICAgICAgdmFyIHJhbmdlID0gRWRpdG9yLnJhbmdlKGVkaXRvciwgYXQpOwoKICAgICAgdmFyIF9SYW5nZSRlZGdlczUgPSBSYW5nZS5lZGdlcyhyYW5nZSksCiAgICAgICAgICBfUmFuZ2UkZWRnZXM2ID0gX3NsaWNlZFRvQXJyYXkoX1JhbmdlJGVkZ2VzNSwgMiksCiAgICAgICAgICBzdGFydCA9IF9SYW5nZSRlZGdlczZbMF0sCiAgICAgICAgICBlbmQgPSBfUmFuZ2UkZWRnZXM2WzFdOwoKICAgICAgdmFyIHRleHQgPSAnJzsKCiAgICAgIHZhciBfaXRlcmF0b3I4ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIkNShFZGl0b3Iubm9kZXMoZWRpdG9yLCB7CiAgICAgICAgYXQ6IHJhbmdlLAogICAgICAgIG1hdGNoOiBUZXh0LmlzVGV4dCwKICAgICAgICB2b2lkczogdm9pZHMKICAgICAgfSkpLAogICAgICAgICAgX3N0ZXA4OwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvcjgucygpOyAhKF9zdGVwOCA9IF9pdGVyYXRvcjgubigpKS5kb25lOykgewogICAgICAgICAgdmFyIF9zdGVwOCR2YWx1ZSA9IF9zbGljZWRUb0FycmF5KF9zdGVwOC52YWx1ZSwgMiksCiAgICAgICAgICAgICAgbm9kZSA9IF9zdGVwOCR2YWx1ZVswXSwKICAgICAgICAgICAgICBwYXRoID0gX3N0ZXA4JHZhbHVlWzFdOwoKICAgICAgICAgIHZhciB0ID0gbm9kZS50ZXh0OwoKICAgICAgICAgIGlmIChQYXRoLmVxdWFscyhwYXRoLCBlbmQucGF0aCkpIHsKICAgICAgICAgICAgdCA9IHQuc2xpY2UoMCwgZW5kLm9mZnNldCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKFBhdGguZXF1YWxzKHBhdGgsIHN0YXJ0LnBhdGgpKSB7CiAgICAgICAgICAgIHQgPSB0LnNsaWNlKHN0YXJ0Lm9mZnNldCk7CiAgICAgICAgICB9CgogICAgICAgICAgdGV4dCArPSB0OwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yOC5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yOC5mKCk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0ZXh0OwogICAgfSwKCiAgICAvKioKICAgICAqIENvbnZlcnQgYSByYW5nZSBpbnRvIGEgbm9uLWhhbmdpbmcgb25lLgogICAgICovCiAgICB1bmhhbmdSYW5nZTogZnVuY3Rpb24gdW5oYW5nUmFuZ2UoZWRpdG9yLCByYW5nZSkgewogICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDoge307CiAgICAgIHZhciBfb3B0aW9ucyR2b2lkczggPSBvcHRpb25zLnZvaWRzLAogICAgICAgICAgdm9pZHMgPSBfb3B0aW9ucyR2b2lkczggPT09IHZvaWQgMCA/IGZhbHNlIDogX29wdGlvbnMkdm9pZHM4OwoKICAgICAgdmFyIF9SYW5nZSRlZGdlczcgPSBSYW5nZS5lZGdlcyhyYW5nZSksCiAgICAgICAgICBfUmFuZ2UkZWRnZXM4ID0gX3NsaWNlZFRvQXJyYXkoX1JhbmdlJGVkZ2VzNywgMiksCiAgICAgICAgICBzdGFydCA9IF9SYW5nZSRlZGdlczhbMF0sCiAgICAgICAgICBlbmQgPSBfUmFuZ2UkZWRnZXM4WzFdOyAvLyBQRVJGOiBleGl0IGVhcmx5IGlmIHdlIGNhbiBndWFyYW50ZWUgdGhhdCB0aGUgcmFuZ2UgaXNuJ3QgaGFuZ2luZy4KCgogICAgICBpZiAoc3RhcnQub2Zmc2V0ICE9PSAwIHx8IGVuZC5vZmZzZXQgIT09IDAgfHwgUmFuZ2UuaXNDb2xsYXBzZWQocmFuZ2UpKSB7CiAgICAgICAgcmV0dXJuIHJhbmdlOwogICAgICB9CgogICAgICB2YXIgZW5kQmxvY2sgPSBFZGl0b3IuYWJvdmUoZWRpdG9yLCB7CiAgICAgICAgYXQ6IGVuZCwKICAgICAgICBtYXRjaDogZnVuY3Rpb24gbWF0Y2gobikgewogICAgICAgICAgcmV0dXJuIEVkaXRvci5pc0Jsb2NrKGVkaXRvciwgbik7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdmFyIGJsb2NrUGF0aCA9IGVuZEJsb2NrID8gZW5kQmxvY2tbMV0gOiBbXTsKICAgICAgdmFyIGZpcnN0ID0gRWRpdG9yLnN0YXJ0KGVkaXRvciwgW10pOwogICAgICB2YXIgYmVmb3JlID0gewogICAgICAgIGFuY2hvcjogZmlyc3QsCiAgICAgICAgZm9jdXM6IGVuZAogICAgICB9OwogICAgICB2YXIgc2tpcCA9IHRydWU7CgogICAgICB2YXIgX2l0ZXJhdG9yOSA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyJDUoRWRpdG9yLm5vZGVzKGVkaXRvciwgewogICAgICAgIGF0OiBiZWZvcmUsCiAgICAgICAgbWF0Y2g6IFRleHQuaXNUZXh0LAogICAgICAgIHJldmVyc2U6IHRydWUsCiAgICAgICAgdm9pZHM6IHZvaWRzCiAgICAgIH0pKSwKICAgICAgICAgIF9zdGVwOTsKCiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3I5LnMoKTsgIShfc3RlcDkgPSBfaXRlcmF0b3I5Lm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBfc3RlcDkkdmFsdWUgPSBfc2xpY2VkVG9BcnJheShfc3RlcDkudmFsdWUsIDIpLAogICAgICAgICAgICAgIG5vZGUgPSBfc3RlcDkkdmFsdWVbMF0sCiAgICAgICAgICAgICAgcGF0aCA9IF9zdGVwOSR2YWx1ZVsxXTsKCiAgICAgICAgICBpZiAoc2tpcCkgewogICAgICAgICAgICBza2lwID0gZmFsc2U7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChub2RlLnRleHQgIT09ICcnIHx8IFBhdGguaXNCZWZvcmUocGF0aCwgYmxvY2tQYXRoKSkgewogICAgICAgICAgICBlbmQgPSB7CiAgICAgICAgICAgICAgcGF0aDogcGF0aCwKICAgICAgICAgICAgICBvZmZzZXQ6IG5vZGUudGV4dC5sZW5ndGgKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3I5LmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3I5LmYoKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHsKICAgICAgICBhbmNob3I6IHN0YXJ0LAogICAgICAgIGZvY3VzOiBlbmQKICAgICAgfTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBNYXRjaCBhIHZvaWQgbm9kZSBpbiB0aGUgY3VycmVudCBicmFuY2ggb2YgdGhlIGVkaXRvci4KICAgICAqLwogICAgInZvaWQiOiBmdW5jdGlvbiBfdm9pZChlZGl0b3IpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogICAgICByZXR1cm4gRWRpdG9yLmFib3ZlKGVkaXRvciwgX29iamVjdFNwcmVhZCQ4KF9vYmplY3RTcHJlYWQkOCh7fSwgb3B0aW9ucyksIHt9LCB7CiAgICAgICAgbWF0Y2g6IGZ1bmN0aW9uIG1hdGNoKG4pIHsKICAgICAgICAgIHJldHVybiBFZGl0b3IuaXNWb2lkKGVkaXRvciwgbik7CiAgICAgICAgfQogICAgICB9KSk7CiAgICB9LAoKICAgIC8qKgogICAgICogQ2FsbCBhIGZ1bmN0aW9uLCBkZWZlcnJpbmcgbm9ybWFsaXphdGlvbiB1bnRpbCBhZnRlciBpdCBjb21wbGV0ZXMuCiAgICAgKi8KICAgIHdpdGhvdXROb3JtYWxpemluZzogZnVuY3Rpb24gd2l0aG91dE5vcm1hbGl6aW5nKGVkaXRvciwgZm4pIHsKICAgICAgdmFyIHZhbHVlID0gRWRpdG9yLmlzTm9ybWFsaXppbmcoZWRpdG9yKTsKICAgICAgRWRpdG9yLnNldE5vcm1hbGl6aW5nKGVkaXRvciwgZmFsc2UpOwoKICAgICAgdHJ5IHsKICAgICAgICBmbigpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIEVkaXRvci5zZXROb3JtYWxpemluZyhlZGl0b3IsIHZhbHVlKTsKICAgICAgfQoKICAgICAgRWRpdG9yLm5vcm1hbGl6ZShlZGl0b3IpOwogICAgfQogIH07CgogIHZhciBMb2NhdGlvbiA9IHsKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSB2YWx1ZSBpbXBsZW1lbnRzIHRoZSBgTG9jYXRpb25gIGludGVyZmFjZS4KICAgICAqLwogICAgaXNMb2NhdGlvbjogZnVuY3Rpb24gaXNMb2NhdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gUGF0aC5pc1BhdGgodmFsdWUpIHx8IFBvaW50LmlzUG9pbnQodmFsdWUpIHx8IFJhbmdlLmlzUmFuZ2UodmFsdWUpOwogICAgfQogIH07CiAgdmFyIFNwYW4gPSB7CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmFsdWUgaW1wbGVtZW50cyB0aGUgYFNwYW5gIGludGVyZmFjZS4KICAgICAqLwogICAgaXNTcGFuOiBmdW5jdGlvbiBpc1NwYW4odmFsdWUpIHsKICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkodmFsdWUpICYmIHZhbHVlLmxlbmd0aCA9PT0gMiAmJiB2YWx1ZS5ldmVyeShQYXRoLmlzUGF0aCk7CiAgICB9CiAgfTsKCiAgdmFyIF9leGNsdWRlZCQzID0gWyJjaGlsZHJlbiJdLAogICAgICBfZXhjbHVkZWQyJDIgPSBbInRleHQiXTsKCiAgZnVuY3Rpb24gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIkNChvLCBhbGxvd0FycmF5TGlrZSkgeyB2YXIgaXQgPSB0eXBlb2YgU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl0gfHwgb1siQEBpdGVyYXRvciJdOyBpZiAoIWl0KSB7IGlmIChBcnJheS5pc0FycmF5KG8pIHx8IChpdCA9IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheSQ0KG8pKSB8fCBhbGxvd0FycmF5TGlrZSAmJiBvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHsgaWYgKGl0KSBvID0gaXQ7IHZhciBpID0gMDsgdmFyIEYgPSBmdW5jdGlvbiBGKCkge307IHJldHVybiB7IHM6IEYsIG46IGZ1bmN0aW9uIG4oKSB7IGlmIChpID49IG8ubGVuZ3RoKSByZXR1cm4geyBkb25lOiB0cnVlIH07IHJldHVybiB7IGRvbmU6IGZhbHNlLCB2YWx1ZTogb1tpKytdIH07IH0sIGU6IGZ1bmN0aW9uIGUoX2UpIHsgdGhyb3cgX2U7IH0sIGY6IEYgfTsgfSB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gaXRlcmF0ZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7IH0gdmFyIG5vcm1hbENvbXBsZXRpb24gPSB0cnVlLCBkaWRFcnIgPSBmYWxzZSwgZXJyOyByZXR1cm4geyBzOiBmdW5jdGlvbiBzKCkgeyBpdCA9IGl0LmNhbGwobyk7IH0sIG46IGZ1bmN0aW9uIG4oKSB7IHZhciBzdGVwID0gaXQubmV4dCgpOyBub3JtYWxDb21wbGV0aW9uID0gc3RlcC5kb25lOyByZXR1cm4gc3RlcDsgfSwgZTogZnVuY3Rpb24gZShfZTIpIHsgZGlkRXJyID0gdHJ1ZTsgZXJyID0gX2UyOyB9LCBmOiBmdW5jdGlvbiBmKCkgeyB0cnkgeyBpZiAoIW5vcm1hbENvbXBsZXRpb24gJiYgaXRbInJldHVybiJdICE9IG51bGwpIGl0WyJyZXR1cm4iXSgpOyB9IGZpbmFsbHkgeyBpZiAoZGlkRXJyKSB0aHJvdyBlcnI7IH0gfSB9OyB9CgogIGZ1bmN0aW9uIF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheSQ0KG8sIG1pbkxlbikgeyBpZiAoIW8pIHJldHVybjsgaWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5JDQobywgbWluTGVuKTsgdmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpOyBpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTsgaWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKSByZXR1cm4gQXJyYXkuZnJvbShvKTsgaWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkkNChvLCBtaW5MZW4pOyB9CgogIGZ1bmN0aW9uIF9hcnJheUxpa2VUb0FycmF5JDQoYXJyLCBsZW4pIHsgaWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykgeyBhcnIyW2ldID0gYXJyW2ldOyB9IHJldHVybiBhcnIyOyB9CiAgdmFyIElTX05PREVfTElTVF9DQUNIRSA9IG5ldyBXZWFrTWFwKCk7CiAgdmFyIE5vZGUkMSA9IHsKICAgIC8qKgogICAgICogR2V0IHRoZSBub2RlIGF0IGEgc3BlY2lmaWMgcGF0aCwgYXNzZXJ0aW5nIHRoYXQgaXQncyBhbiBhbmNlc3RvciBub2RlLgogICAgICovCiAgICBhbmNlc3RvcjogZnVuY3Rpb24gYW5jZXN0b3Iocm9vdCwgcGF0aCkgewogICAgICB2YXIgbm9kZSA9IE5vZGUkMS5nZXQocm9vdCwgcGF0aCk7CgogICAgICBpZiAoVGV4dC5pc1RleHQobm9kZSkpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBnZXQgdGhlIGFuY2VzdG9yIG5vZGUgYXQgcGF0aCBbIi5jb25jYXQocGF0aCwgIl0gYmVjYXVzZSBpdCByZWZlcnMgdG8gYSB0ZXh0IG5vZGUgaW5zdGVhZDogIikuY29uY2F0KG5vZGUpKTsKICAgICAgfQoKICAgICAgcmV0dXJuIG5vZGU7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJuIGEgZ2VuZXJhdG9yIG9mIGFsbCB0aGUgYW5jZXN0b3Igbm9kZXMgYWJvdmUgYSBzcGVjaWZpYyBwYXRoLgogICAgICoKICAgICAqIEJ5IGRlZmF1bHQgdGhlIG9yZGVyIGlzIGJvdHRvbS11cCwgZnJvbSBsb3dlc3QgdG8gaGlnaGVzdCBhbmNlc3RvciBpbgogICAgICogdGhlIHRyZWUsIGJ1dCB5b3UgY2FuIHBhc3MgdGhlIGByZXZlcnNlOiB0cnVlYCBvcHRpb24gdG8gZ28gdG9wLWRvd24uCiAgICAgKi8KICAgIGFuY2VzdG9yczogZnVuY3Rpb24qIGFuY2VzdG9ycyhyb290LCBwYXRoKSB7CiAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiB7fTsKCiAgICAgIHZhciBfaXRlcmF0b3IgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciQ0KFBhdGguYW5jZXN0b3JzKHBhdGgsIG9wdGlvbnMpKSwKICAgICAgICAgIF9zdGVwOwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvci5zKCk7ICEoX3N0ZXAgPSBfaXRlcmF0b3IubigpKS5kb25lOykgewogICAgICAgICAgdmFyIHAgPSBfc3RlcC52YWx1ZTsKICAgICAgICAgIHZhciBuID0gTm9kZSQxLmFuY2VzdG9yKHJvb3QsIHApOwogICAgICAgICAgdmFyIGVudHJ5ID0gW24sIHBdOwogICAgICAgICAgeWllbGQgZW50cnk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3IuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvci5mKCk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNoaWxkIG9mIGEgbm9kZSBhdCBhIHNwZWNpZmljIGluZGV4LgogICAgICovCiAgICBjaGlsZDogZnVuY3Rpb24gY2hpbGQocm9vdCwgaW5kZXgpIHsKICAgICAgaWYgKFRleHQuaXNUZXh0KHJvb3QpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgZ2V0IHRoZSBjaGlsZCBvZiBhIHRleHQgbm9kZTogIi5jb25jYXQoSlNPTi5zdHJpbmdpZnkocm9vdCkpKTsKICAgICAgfQoKICAgICAgdmFyIGMgPSByb290LmNoaWxkcmVuW2luZGV4XTsKCiAgICAgIGlmIChjID09IG51bGwpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBnZXQgY2hpbGQgYXQgaW5kZXggYCIuY29uY2F0KGluZGV4LCAiYCBpbiBub2RlOiAiKS5jb25jYXQoSlNPTi5zdHJpbmdpZnkocm9vdCkpKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGM7CiAgICB9LAoKICAgIC8qKgogICAgICogSXRlcmF0ZSBvdmVyIHRoZSBjaGlsZHJlbiBvZiBhIG5vZGUgYXQgYSBzcGVjaWZpYyBwYXRoLgogICAgICovCiAgICBjaGlsZHJlbjogZnVuY3Rpb24qIGNoaWxkcmVuKHJvb3QsIHBhdGgpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IHt9OwogICAgICB2YXIgX29wdGlvbnMkcmV2ZXJzZSA9IG9wdGlvbnMucmV2ZXJzZSwKICAgICAgICAgIHJldmVyc2UgPSBfb3B0aW9ucyRyZXZlcnNlID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zJHJldmVyc2U7CiAgICAgIHZhciBhbmNlc3RvciA9IE5vZGUkMS5hbmNlc3Rvcihyb290LCBwYXRoKTsKICAgICAgdmFyIGNoaWxkcmVuID0gYW5jZXN0b3IuY2hpbGRyZW47CiAgICAgIHZhciBpbmRleCA9IHJldmVyc2UgPyBjaGlsZHJlbi5sZW5ndGggLSAxIDogMDsKCiAgICAgIHdoaWxlIChyZXZlcnNlID8gaW5kZXggPj0gMCA6IGluZGV4IDwgY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgdmFyIGNoaWxkID0gTm9kZSQxLmNoaWxkKGFuY2VzdG9yLCBpbmRleCk7CiAgICAgICAgdmFyIGNoaWxkUGF0aCA9IHBhdGguY29uY2F0KGluZGV4KTsKICAgICAgICB5aWVsZCBbY2hpbGQsIGNoaWxkUGF0aF07CiAgICAgICAgaW5kZXggPSByZXZlcnNlID8gaW5kZXggLSAxIDogaW5kZXggKyAxOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogR2V0IGFuIGVudHJ5IGZvciB0aGUgY29tbW9uIGFuY2VzZXRvciBub2RlIG9mIHR3byBwYXRocy4KICAgICAqLwogICAgY29tbW9uOiBmdW5jdGlvbiBjb21tb24ocm9vdCwgcGF0aCwgYW5vdGhlcikgewogICAgICB2YXIgcCA9IFBhdGguY29tbW9uKHBhdGgsIGFub3RoZXIpOwogICAgICB2YXIgbiA9IE5vZGUkMS5nZXQocm9vdCwgcCk7CiAgICAgIHJldHVybiBbbiwgcF07CiAgICB9LAoKICAgIC8qKgogICAgICogR2V0IHRoZSBub2RlIGF0IGEgc3BlY2lmaWMgcGF0aCwgYXNzZXJ0aW5nIHRoYXQgaXQncyBhIGRlc2NlbmRhbnQgbm9kZS4KICAgICAqLwogICAgZGVzY2VuZGFudDogZnVuY3Rpb24gZGVzY2VuZGFudChyb290LCBwYXRoKSB7CiAgICAgIHZhciBub2RlID0gTm9kZSQxLmdldChyb290LCBwYXRoKTsKCiAgICAgIGlmIChFZGl0b3IuaXNFZGl0b3Iobm9kZSkpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBnZXQgdGhlIGRlc2NlbmRhbnQgbm9kZSBhdCBwYXRoIFsiLmNvbmNhdChwYXRoLCAiXSBiZWNhdXNlIGl0IHJlZmVycyB0byB0aGUgcm9vdCBlZGl0b3Igbm9kZSBpbnN0ZWFkOiAiKS5jb25jYXQobm9kZSkpOwogICAgICB9CgogICAgICByZXR1cm4gbm9kZTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXR1cm4gYSBnZW5lcmF0b3Igb2YgYWxsIHRoZSBkZXNjZW5kYW50IG5vZGUgZW50cmllcyBpbnNpZGUgYSByb290IG5vZGUuCiAgICAgKi8KICAgIGRlc2NlbmRhbnRzOiBmdW5jdGlvbiogZGVzY2VuZGFudHMocm9vdCkgewogICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CgogICAgICB2YXIgX2l0ZXJhdG9yMiA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyJDQoTm9kZSQxLm5vZGVzKHJvb3QsIG9wdGlvbnMpKSwKICAgICAgICAgIF9zdGVwMjsKCiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IyLnMoKTsgIShfc3RlcDIgPSBfaXRlcmF0b3IyLm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBfc3RlcDIkdmFsdWUgPSBfc2xpY2VkVG9BcnJheShfc3RlcDIudmFsdWUsIDIpLAogICAgICAgICAgICAgIG5vZGUgPSBfc3RlcDIkdmFsdWVbMF0sCiAgICAgICAgICAgICAgcGF0aCA9IF9zdGVwMiR2YWx1ZVsxXTsKCiAgICAgICAgICBpZiAocGF0aC5sZW5ndGggIT09IDApIHsKICAgICAgICAgICAgLy8gTk9URTogd2UgaGF2ZSB0byBjb2VyY2UgaGVyZSBiZWNhdXNlIGNoZWNraW5nIHRoZSBwYXRoJ3MgbGVuZ3RoIGRvZXMKICAgICAgICAgICAgLy8gZ3VhcmFudGVlIHRoYXQgYG5vZGVgIGlzIG5vdCBhIGBFZGl0b3JgLCBidXQgVHlwZVNjcmlwdCBkb2Vzbid0IGtub3cuCiAgICAgICAgICAgIHlpZWxkIFtub2RlLCBwYXRoXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjIuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjIuZigpOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJuIGEgZ2VuZXJhdG9yIG9mIGFsbCB0aGUgZWxlbWVudCBub2RlcyBpbnNpZGUgYSByb290IG5vZGUuIEVhY2ggaXRlcmF0aW9uCiAgICAgKiB3aWxsIHJldHVybiBhbiBgRWxlbWVudEVudHJ5YCB0dXBsZSBjb25zaXN0aW5nIG9mIGBbRWxlbWVudCwgUGF0aF1gLiBJZiB0aGUKICAgICAqIHJvb3Qgbm9kZSBpcyBhbiBlbGVtZW50IGl0IHdpbGwgYmUgaW5jbHVkZWQgaW4gdGhlIGl0ZXJhdGlvbiBhcyB3ZWxsLgogICAgICovCiAgICBlbGVtZW50czogZnVuY3Rpb24qIGVsZW1lbnRzKHJvb3QpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwoKICAgICAgdmFyIF9pdGVyYXRvcjMgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciQ0KE5vZGUkMS5ub2Rlcyhyb290LCBvcHRpb25zKSksCiAgICAgICAgICBfc3RlcDM7CgogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yMy5zKCk7ICEoX3N0ZXAzID0gX2l0ZXJhdG9yMy5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgX3N0ZXAzJHZhbHVlID0gX3NsaWNlZFRvQXJyYXkoX3N0ZXAzLnZhbHVlLCAyKSwKICAgICAgICAgICAgICBub2RlID0gX3N0ZXAzJHZhbHVlWzBdLAogICAgICAgICAgICAgIHBhdGggPSBfc3RlcDMkdmFsdWVbMV07CgogICAgICAgICAgaWYgKEVsZW1lbnQkMS5pc0VsZW1lbnQobm9kZSkpIHsKICAgICAgICAgICAgeWllbGQgW25vZGUsIHBhdGhdOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yMy5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yMy5mKCk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBFeHRyYWN0IHByb3BzIGZyb20gYSBOb2RlLgogICAgICovCiAgICBleHRyYWN0UHJvcHM6IGZ1bmN0aW9uIGV4dHJhY3RQcm9wcyhub2RlKSB7CiAgICAgIGlmIChFbGVtZW50JDEuaXNBbmNlc3Rvcihub2RlKSkgewogICAgICAgIG5vZGUuY2hpbGRyZW47CiAgICAgICAgICAgIHZhciBwcm9wZXJ0aWVzID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKG5vZGUsIF9leGNsdWRlZCQzKTsKCiAgICAgICAgcmV0dXJuIHByb3BlcnRpZXM7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbm9kZS50ZXh0OwogICAgICAgICAgICB2YXIgX3Byb3BlcnRpZXMgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMobm9kZSwgX2V4Y2x1ZGVkMiQyKTsKCiAgICAgICAgcmV0dXJuIF9wcm9wZXJ0aWVzOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogR2V0IHRoZSBmaXJzdCBub2RlIGVudHJ5IGluIGEgcm9vdCBub2RlIGZyb20gYSBwYXRoLgogICAgICovCiAgICBmaXJzdDogZnVuY3Rpb24gZmlyc3Qocm9vdCwgcGF0aCkgewogICAgICB2YXIgcCA9IHBhdGguc2xpY2UoKTsKICAgICAgdmFyIG4gPSBOb2RlJDEuZ2V0KHJvb3QsIHApOwoKICAgICAgd2hpbGUgKG4pIHsKICAgICAgICBpZiAoVGV4dC5pc1RleHQobikgfHwgbi5jaGlsZHJlbi5sZW5ndGggPT09IDApIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBuID0gbi5jaGlsZHJlblswXTsKICAgICAgICAgIHAucHVzaCgwKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBbbiwgcF07CiAgICB9LAoKICAgIC8qKgogICAgICogR2V0IHRoZSBzbGljZWQgZnJhZ21lbnQgcmVwcmVzZW50ZWQgYnkgYSByYW5nZSBpbnNpZGUgYSByb290IG5vZGUuCiAgICAgKi8KICAgIGZyYWdtZW50OiBmdW5jdGlvbiBmcmFnbWVudChyb290LCByYW5nZSkgewogICAgICBpZiAoVGV4dC5pc1RleHQocm9vdCkpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBnZXQgYSBmcmFnbWVudCBzdGFydGluZyBmcm9tIGEgcm9vdCB0ZXh0IG5vZGU6ICIuY29uY2F0KEpTT04uc3RyaW5naWZ5KHJvb3QpKSk7CiAgICAgIH0KCiAgICAgIHZhciBuZXdSb290ID0gaW1tZXIucHJvZHVjZSh7CiAgICAgICAgY2hpbGRyZW46IHJvb3QuY2hpbGRyZW4KICAgICAgfSwgZnVuY3Rpb24gKHIpIHsKICAgICAgICB2YXIgX1JhbmdlJGVkZ2VzID0gUmFuZ2UuZWRnZXMocmFuZ2UpLAogICAgICAgICAgICBfUmFuZ2UkZWRnZXMyID0gX3NsaWNlZFRvQXJyYXkoX1JhbmdlJGVkZ2VzLCAyKSwKICAgICAgICAgICAgc3RhcnQgPSBfUmFuZ2UkZWRnZXMyWzBdLAogICAgICAgICAgICBlbmQgPSBfUmFuZ2UkZWRnZXMyWzFdOwoKICAgICAgICB2YXIgbm9kZUVudHJpZXMgPSBOb2RlJDEubm9kZXMociwgewogICAgICAgICAgcmV2ZXJzZTogdHJ1ZSwKICAgICAgICAgIHBhc3M6IGZ1bmN0aW9uIHBhc3MoX3JlZikgewogICAgICAgICAgICB2YXIgX3JlZjIgPSBfc2xpY2VkVG9BcnJheShfcmVmLCAyKSwKICAgICAgICAgICAgICAgIHBhdGggPSBfcmVmMlsxXTsKCiAgICAgICAgICAgIHJldHVybiAhUmFuZ2UuaW5jbHVkZXMocmFuZ2UsIHBhdGgpOwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB2YXIgX2l0ZXJhdG9yNCA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyJDQobm9kZUVudHJpZXMpLAogICAgICAgICAgICBfc3RlcDQ7CgogICAgICAgIHRyeSB7CiAgICAgICAgICBmb3IgKF9pdGVyYXRvcjQucygpOyAhKF9zdGVwNCA9IF9pdGVyYXRvcjQubigpKS5kb25lOykgewogICAgICAgICAgICB2YXIgX3N0ZXA0JHZhbHVlID0gX3NsaWNlZFRvQXJyYXkoX3N0ZXA0LnZhbHVlLCAyKSwKICAgICAgICAgICAgICAgIHBhdGggPSBfc3RlcDQkdmFsdWVbMV07CgogICAgICAgICAgICBpZiAoIVJhbmdlLmluY2x1ZGVzKHJhbmdlLCBwYXRoKSkgewogICAgICAgICAgICAgIHZhciBwYXJlbnQgPSBOb2RlJDEucGFyZW50KHIsIHBhdGgpOwogICAgICAgICAgICAgIHZhciBpbmRleCA9IHBhdGhbcGF0aC5sZW5ndGggLSAxXTsKICAgICAgICAgICAgICBwYXJlbnQuY2hpbGRyZW4uc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKFBhdGguZXF1YWxzKHBhdGgsIGVuZC5wYXRoKSkgewogICAgICAgICAgICAgIHZhciBsZWFmID0gTm9kZSQxLmxlYWYociwgcGF0aCk7CiAgICAgICAgICAgICAgbGVhZi50ZXh0ID0gbGVhZi50ZXh0LnNsaWNlKDAsIGVuZC5vZmZzZXQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoUGF0aC5lcXVhbHMocGF0aCwgc3RhcnQucGF0aCkpIHsKICAgICAgICAgICAgICB2YXIgX2xlYWYgPSBOb2RlJDEubGVhZihyLCBwYXRoKTsKCiAgICAgICAgICAgICAgX2xlYWYudGV4dCA9IF9sZWFmLnRleHQuc2xpY2Uoc3RhcnQub2Zmc2V0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgX2l0ZXJhdG9yNC5lKGVycik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIF9pdGVyYXRvcjQuZigpOwogICAgICAgIH0KCiAgICAgICAgaWYgKEVkaXRvci5pc0VkaXRvcihyKSkgewogICAgICAgICAgci5zZWxlY3Rpb24gPSBudWxsOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybiBuZXdSb290LmNoaWxkcmVuOwogICAgfSwKCiAgICAvKioKICAgICAqIEdldCB0aGUgZGVzY2VuZGFudCBub2RlIHJlZmVycmVkIHRvIGJ5IGEgc3BlY2lmaWMgcGF0aC4gSWYgdGhlIHBhdGggaXMgYW4KICAgICAqIGVtcHR5IGFycmF5LCBpdCByZWZlcnMgdG8gdGhlIHJvb3Qgbm9kZSBpdHNlbGYuCiAgICAgKi8KICAgIGdldDogZnVuY3Rpb24gZ2V0KHJvb3QsIHBhdGgpIHsKICAgICAgdmFyIG5vZGUgPSByb290OwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXRoLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIHAgPSBwYXRoW2ldOwoKICAgICAgICBpZiAoVGV4dC5pc1RleHQobm9kZSkgfHwgIW5vZGUuY2hpbGRyZW5bcF0pIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2Fubm90IGZpbmQgYSBkZXNjZW5kYW50IGF0IHBhdGggWyIuY29uY2F0KHBhdGgsICJdIGluIG5vZGU6ICIpLmNvbmNhdChKU09OLnN0cmluZ2lmeShyb290KSkpOwogICAgICAgIH0KCiAgICAgICAgbm9kZSA9IG5vZGUuY2hpbGRyZW5bcF07CiAgICAgIH0KCiAgICAgIHJldHVybiBub2RlOwogICAgfSwKCiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgZGVzY2VuZGFudCBub2RlIGV4aXN0cyBhdCBhIHNwZWNpZmljIHBhdGguCiAgICAgKi8KICAgIGhhczogZnVuY3Rpb24gaGFzKHJvb3QsIHBhdGgpIHsKICAgICAgdmFyIG5vZGUgPSByb290OwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXRoLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIHAgPSBwYXRoW2ldOwoKICAgICAgICBpZiAoVGV4dC5pc1RleHQobm9kZSkgfHwgIW5vZGUuY2hpbGRyZW5bcF0pIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIG5vZGUgPSBub2RlLmNoaWxkcmVuW3BdOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIHZhbHVlIGltcGxlbWVudHMgdGhlIGBOb2RlYCBpbnRlcmZhY2UuCiAgICAgKi8KICAgIGlzTm9kZTogZnVuY3Rpb24gaXNOb2RlKHZhbHVlKSB7CiAgICAgIHJldHVybiBUZXh0LmlzVGV4dCh2YWx1ZSkgfHwgRWxlbWVudCQxLmlzRWxlbWVudCh2YWx1ZSkgfHwgRWRpdG9yLmlzRWRpdG9yKHZhbHVlKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIHZhbHVlIGlzIGEgbGlzdCBvZiBgTm9kZWAgb2JqZWN0cy4KICAgICAqLwogICAgaXNOb2RlTGlzdDogZnVuY3Rpb24gaXNOb2RlTGlzdCh2YWx1ZSkgewogICAgICBpZiAoIUFycmF5LmlzQXJyYXkodmFsdWUpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICB2YXIgY2FjaGVkUmVzdWx0ID0gSVNfTk9ERV9MSVNUX0NBQ0hFLmdldCh2YWx1ZSk7CgogICAgICBpZiAoY2FjaGVkUmVzdWx0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gY2FjaGVkUmVzdWx0OwogICAgICB9CgogICAgICB2YXIgaXNOb2RlTGlzdCA9IHZhbHVlLmV2ZXJ5KGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICByZXR1cm4gTm9kZSQxLmlzTm9kZSh2YWwpOwogICAgICB9KTsKICAgICAgSVNfTk9ERV9MSVNUX0NBQ0hFLnNldCh2YWx1ZSwgaXNOb2RlTGlzdCk7CiAgICAgIHJldHVybiBpc05vZGVMaXN0OwogICAgfSwKCiAgICAvKioKICAgICAqIEdldCB0aGUgbGFzdCBub2RlIGVudHJ5IGluIGEgcm9vdCBub2RlIGZyb20gYSBwYXRoLgogICAgICovCiAgICBsYXN0OiBmdW5jdGlvbiBsYXN0KHJvb3QsIHBhdGgpIHsKICAgICAgdmFyIHAgPSBwYXRoLnNsaWNlKCk7CiAgICAgIHZhciBuID0gTm9kZSQxLmdldChyb290LCBwKTsKCiAgICAgIHdoaWxlIChuKSB7CiAgICAgICAgaWYgKFRleHQuaXNUZXh0KG4pIHx8IG4uY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIGkgPSBuLmNoaWxkcmVuLmxlbmd0aCAtIDE7CiAgICAgICAgICBuID0gbi5jaGlsZHJlbltpXTsKICAgICAgICAgIHAucHVzaChpKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBbbiwgcF07CiAgICB9LAoKICAgIC8qKgogICAgICogR2V0IHRoZSBub2RlIGF0IGEgc3BlY2lmaWMgcGF0aCwgZW5zdXJpbmcgaXQncyBhIGxlYWYgdGV4dCBub2RlLgogICAgICovCiAgICBsZWFmOiBmdW5jdGlvbiBsZWFmKHJvb3QsIHBhdGgpIHsKICAgICAgdmFyIG5vZGUgPSBOb2RlJDEuZ2V0KHJvb3QsIHBhdGgpOwoKICAgICAgaWYgKCFUZXh0LmlzVGV4dChub2RlKSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2Fubm90IGdldCB0aGUgbGVhZiBub2RlIGF0IHBhdGggWyIuY29uY2F0KHBhdGgsICJdIGJlY2F1c2UgaXQgcmVmZXJzIHRvIGEgbm9uLWxlYWYgbm9kZTogIikuY29uY2F0KG5vZGUpKTsKICAgICAgfQoKICAgICAgcmV0dXJuIG5vZGU7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJuIGEgZ2VuZXJhdG9yIG9mIHRoZSBpbiBhIGJyYW5jaCBvZiB0aGUgdHJlZSwgZnJvbSBhIHNwZWNpZmljIHBhdGguCiAgICAgKgogICAgICogQnkgZGVmYXVsdCB0aGUgb3JkZXIgaXMgdG9wLWRvd24sIGZyb20gbG93ZXN0IHRvIGhpZ2hlc3Qgbm9kZSBpbiB0aGUgdHJlZSwKICAgICAqIGJ1dCB5b3UgY2FuIHBhc3MgdGhlIGByZXZlcnNlOiB0cnVlYCBvcHRpb24gdG8gZ28gYm90dG9tLXVwLgogICAgICovCiAgICBsZXZlbHM6IGZ1bmN0aW9uKiBsZXZlbHMocm9vdCwgcGF0aCkgewogICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDoge307CgogICAgICB2YXIgX2l0ZXJhdG9yNSA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyJDQoUGF0aC5sZXZlbHMocGF0aCwgb3B0aW9ucykpLAogICAgICAgICAgX3N0ZXA1OwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvcjUucygpOyAhKF9zdGVwNSA9IF9pdGVyYXRvcjUubigpKS5kb25lOykgewogICAgICAgICAgdmFyIHAgPSBfc3RlcDUudmFsdWU7CiAgICAgICAgICB2YXIgbiA9IE5vZGUkMS5nZXQocm9vdCwgcCk7CiAgICAgICAgICB5aWVsZCBbbiwgcF07CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3I1LmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3I1LmYoKTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgbm9kZSBtYXRjaGVzIGEgc2V0IG9mIHByb3BzLgogICAgICovCiAgICBtYXRjaGVzOiBmdW5jdGlvbiBtYXRjaGVzKG5vZGUsIHByb3BzKSB7CiAgICAgIHJldHVybiBFbGVtZW50JDEuaXNFbGVtZW50KG5vZGUpICYmIEVsZW1lbnQkMS5pc0VsZW1lbnRQcm9wcyhwcm9wcykgJiYgRWxlbWVudCQxLm1hdGNoZXMobm9kZSwgcHJvcHMpIHx8IFRleHQuaXNUZXh0KG5vZGUpICYmIFRleHQuaXNUZXh0UHJvcHMocHJvcHMpICYmIFRleHQubWF0Y2hlcyhub2RlLCBwcm9wcyk7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJuIGEgZ2VuZXJhdG9yIG9mIGFsbCB0aGUgbm9kZSBlbnRyaWVzIG9mIGEgcm9vdCBub2RlLiBFYWNoIGVudHJ5IGlzCiAgICAgKiByZXR1cm5lZCBhcyBhIGBbTm9kZSwgUGF0aF1gIHR1cGxlLCB3aXRoIHRoZSBwYXRoIHJlZmVycmluZyB0byB0aGUgbm9kZSdzCiAgICAgKiBwb3NpdGlvbiBpbnNpZGUgdGhlIHJvb3Qgbm9kZS4KICAgICAqLwogICAgbm9kZXM6IGZ1bmN0aW9uKiBub2Rlcyhyb290KSB7CiAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsKICAgICAgdmFyIHBhc3MgPSBvcHRpb25zLnBhc3MsCiAgICAgICAgICBfb3B0aW9ucyRyZXZlcnNlMiA9IG9wdGlvbnMucmV2ZXJzZSwKICAgICAgICAgIHJldmVyc2UgPSBfb3B0aW9ucyRyZXZlcnNlMiA9PT0gdm9pZCAwID8gZmFsc2UgOiBfb3B0aW9ucyRyZXZlcnNlMjsKICAgICAgdmFyIF9vcHRpb25zJGZyb20gPSBvcHRpb25zLmZyb20sCiAgICAgICAgICBmcm9tID0gX29wdGlvbnMkZnJvbSA9PT0gdm9pZCAwID8gW10gOiBfb3B0aW9ucyRmcm9tLAogICAgICAgICAgdG8gPSBvcHRpb25zLnRvOwogICAgICB2YXIgdmlzaXRlZCA9IG5ldyBTZXQoKTsKICAgICAgdmFyIHAgPSBbXTsKICAgICAgdmFyIG4gPSByb290OwoKICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICBpZiAodG8gJiYgKHJldmVyc2UgPyBQYXRoLmlzQmVmb3JlKHAsIHRvKSA6IFBhdGguaXNBZnRlcihwLCB0bykpKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIGlmICghdmlzaXRlZC5oYXMobikpIHsKICAgICAgICAgIHlpZWxkIFtuLCBwXTsKICAgICAgICB9IC8vIElmIHdlJ3JlIGFsbG93ZWQgdG8gZ28gZG93bndhcmQgYW5kIHdlIGhhdmVuJ3QgZGVzY2VuZGVkIHlldCwgZG8uCgoKICAgICAgICBpZiAoIXZpc2l0ZWQuaGFzKG4pICYmICFUZXh0LmlzVGV4dChuKSAmJiBuLmNoaWxkcmVuLmxlbmd0aCAhPT0gMCAmJiAocGFzcyA9PSBudWxsIHx8IHBhc3MoW24sIHBdKSA9PT0gZmFsc2UpKSB7CiAgICAgICAgICB2aXNpdGVkLmFkZChuKTsKICAgICAgICAgIHZhciBuZXh0SW5kZXggPSByZXZlcnNlID8gbi5jaGlsZHJlbi5sZW5ndGggLSAxIDogMDsKCiAgICAgICAgICBpZiAoUGF0aC5pc0FuY2VzdG9yKHAsIGZyb20pKSB7CiAgICAgICAgICAgIG5leHRJbmRleCA9IGZyb21bcC5sZW5ndGhdOwogICAgICAgICAgfQoKICAgICAgICAgIHAgPSBwLmNvbmNhdChuZXh0SW5kZXgpOwogICAgICAgICAgbiA9IE5vZGUkMS5nZXQocm9vdCwgcCk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIElmIHdlJ3JlIGF0IHRoZSByb290IGFuZCB3ZSBjYW4ndCBnbyBkb3duLCB3ZSdyZSBkb25lLgoKCiAgICAgICAgaWYgKHAubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9IC8vIElmIHdlJ3JlIGdvaW5nIGZvcndhcmQuLi4KCgogICAgICAgIGlmICghcmV2ZXJzZSkgewogICAgICAgICAgdmFyIG5ld1BhdGggPSBQYXRoLm5leHQocCk7CgogICAgICAgICAgaWYgKE5vZGUkMS5oYXMocm9vdCwgbmV3UGF0aCkpIHsKICAgICAgICAgICAgcCA9IG5ld1BhdGg7CiAgICAgICAgICAgIG4gPSBOb2RlJDEuZ2V0KHJvb3QsIHApOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICB9IC8vIElmIHdlJ3JlIGdvaW5nIGJhY2t3YXJkLi4uCgoKICAgICAgICBpZiAocmV2ZXJzZSAmJiBwW3AubGVuZ3RoIC0gMV0gIT09IDApIHsKICAgICAgICAgIHZhciBfbmV3UGF0aCA9IFBhdGgucHJldmlvdXMocCk7CgogICAgICAgICAgcCA9IF9uZXdQYXRoOwogICAgICAgICAgbiA9IE5vZGUkMS5nZXQocm9vdCwgcCk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIE90aGVyd2lzZSB3ZSdyZSBnb2luZyB1cHdhcmQuLi4KCgogICAgICAgIHAgPSBQYXRoLnBhcmVudChwKTsKICAgICAgICBuID0gTm9kZSQxLmdldChyb290LCBwKTsKICAgICAgICB2aXNpdGVkLmFkZChuKTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIEdldCB0aGUgcGFyZW50IG9mIGEgbm9kZSBhdCBhIHNwZWNpZmljIHBhdGguCiAgICAgKi8KICAgIHBhcmVudDogZnVuY3Rpb24gcGFyZW50KHJvb3QsIHBhdGgpIHsKICAgICAgdmFyIHBhcmVudFBhdGggPSBQYXRoLnBhcmVudChwYXRoKTsKICAgICAgdmFyIHAgPSBOb2RlJDEuZ2V0KHJvb3QsIHBhcmVudFBhdGgpOwoKICAgICAgaWYgKFRleHQuaXNUZXh0KHApKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgZ2V0IHRoZSBwYXJlbnQgb2YgcGF0aCBbIi5jb25jYXQocGF0aCwgIl0gYmVjYXVzZSBpdCBkb2VzIG5vdCBleGlzdCBpbiB0aGUgcm9vdC4iKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBwOwogICAgfSwKCiAgICAvKioKICAgICAqIEdldCB0aGUgY29uY2F0ZW5hdGVkIHRleHQgc3RyaW5nIG9mIGEgbm9kZSdzIGNvbnRlbnQuCiAgICAgKgogICAgICogTm90ZSB0aGF0IHRoaXMgd2lsbCBub3QgaW5jbHVkZSBzcGFjZXMgb3IgbGluZSBicmVha3MgYmV0d2VlbiBibG9jayBub2Rlcy4KICAgICAqIEl0IGlzIG5vdCBhIHVzZXItZmFjaW5nIHN0cmluZywgYnV0IGEgc3RyaW5nIGZvciBwZXJmb3JtaW5nIG9mZnNldC1yZWxhdGVkCiAgICAgKiBjb21wdXRhdGlvbnMgZm9yIGEgbm9kZS4KICAgICAqLwogICAgc3RyaW5nOiBmdW5jdGlvbiBzdHJpbmcobm9kZSkgewogICAgICBpZiAoVGV4dC5pc1RleHQobm9kZSkpIHsKICAgICAgICByZXR1cm4gbm9kZS50ZXh0OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBub2RlLmNoaWxkcmVuLm1hcChOb2RlJDEuc3RyaW5nKS5qb2luKCcnKTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybiBhIGdlbmVyYXRvciBvZiBhbGwgbGVhZiB0ZXh0IG5vZGVzIGluIGEgcm9vdCBub2RlLgogICAgICovCiAgICB0ZXh0czogZnVuY3Rpb24qIHRleHRzKHJvb3QpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwoKICAgICAgdmFyIF9pdGVyYXRvcjYgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciQ0KE5vZGUkMS5ub2Rlcyhyb290LCBvcHRpb25zKSksCiAgICAgICAgICBfc3RlcDY7CgogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yNi5zKCk7ICEoX3N0ZXA2ID0gX2l0ZXJhdG9yNi5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgX3N0ZXA2JHZhbHVlID0gX3NsaWNlZFRvQXJyYXkoX3N0ZXA2LnZhbHVlLCAyKSwKICAgICAgICAgICAgICBub2RlID0gX3N0ZXA2JHZhbHVlWzBdLAogICAgICAgICAgICAgIHBhdGggPSBfc3RlcDYkdmFsdWVbMV07CgogICAgICAgICAgaWYgKFRleHQuaXNUZXh0KG5vZGUpKSB7CiAgICAgICAgICAgIHlpZWxkIFtub2RlLCBwYXRoXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjYuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjYuZigpOwogICAgICB9CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gb3duS2V5cyQ3KG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOyBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgeyB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsgaWYgKGVudW1lcmFibGVPbmx5KSB7IHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsgfSBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCiAgZnVuY3Rpb24gX29iamVjdFNwcmVhZCQ3KHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMkNyhPYmplY3Qoc291cmNlKSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyBvd25LZXlzJDcoT2JqZWN0KHNvdXJjZSkpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsgfSk7IH0gfSByZXR1cm4gdGFyZ2V0OyB9CiAgdmFyIE9wZXJhdGlvbiA9IHsKICAgIC8qKgogICAgICogQ2hlY2sgb2YgYSB2YWx1ZSBpcyBhIGBOb2RlT3BlcmF0aW9uYCBvYmplY3QuCiAgICAgKi8KICAgIGlzTm9kZU9wZXJhdGlvbjogZnVuY3Rpb24gaXNOb2RlT3BlcmF0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiBPcGVyYXRpb24uaXNPcGVyYXRpb24odmFsdWUpICYmIHZhbHVlLnR5cGUuZW5kc1dpdGgoJ19ub2RlJyk7CiAgICB9LAoKICAgIC8qKgogICAgICogQ2hlY2sgb2YgYSB2YWx1ZSBpcyBhbiBgT3BlcmF0aW9uYCBvYmplY3QuCiAgICAgKi8KICAgIGlzT3BlcmF0aW9uOiBmdW5jdGlvbiBpc09wZXJhdGlvbih2YWx1ZSkgewogICAgICBpZiAoIWlzUGxhaW5PYmplY3QuaXNQbGFpbk9iamVjdCh2YWx1ZSkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHN3aXRjaCAodmFsdWUudHlwZSkgewogICAgICAgIGNhc2UgJ2luc2VydF9ub2RlJzoKICAgICAgICAgIHJldHVybiBQYXRoLmlzUGF0aCh2YWx1ZS5wYXRoKSAmJiBOb2RlJDEuaXNOb2RlKHZhbHVlLm5vZGUpOwoKICAgICAgICBjYXNlICdpbnNlcnRfdGV4dCc6CiAgICAgICAgICByZXR1cm4gdHlwZW9mIHZhbHVlLm9mZnNldCA9PT0gJ251bWJlcicgJiYgdHlwZW9mIHZhbHVlLnRleHQgPT09ICdzdHJpbmcnICYmIFBhdGguaXNQYXRoKHZhbHVlLnBhdGgpOwoKICAgICAgICBjYXNlICdtZXJnZV9ub2RlJzoKICAgICAgICAgIHJldHVybiB0eXBlb2YgdmFsdWUucG9zaXRpb24gPT09ICdudW1iZXInICYmIFBhdGguaXNQYXRoKHZhbHVlLnBhdGgpICYmIGlzUGxhaW5PYmplY3QuaXNQbGFpbk9iamVjdCh2YWx1ZS5wcm9wZXJ0aWVzKTsKCiAgICAgICAgY2FzZSAnbW92ZV9ub2RlJzoKICAgICAgICAgIHJldHVybiBQYXRoLmlzUGF0aCh2YWx1ZS5wYXRoKSAmJiBQYXRoLmlzUGF0aCh2YWx1ZS5uZXdQYXRoKTsKCiAgICAgICAgY2FzZSAncmVtb3ZlX25vZGUnOgogICAgICAgICAgcmV0dXJuIFBhdGguaXNQYXRoKHZhbHVlLnBhdGgpICYmIE5vZGUkMS5pc05vZGUodmFsdWUubm9kZSk7CgogICAgICAgIGNhc2UgJ3JlbW92ZV90ZXh0JzoKICAgICAgICAgIHJldHVybiB0eXBlb2YgdmFsdWUub2Zmc2V0ID09PSAnbnVtYmVyJyAmJiB0eXBlb2YgdmFsdWUudGV4dCA9PT0gJ3N0cmluZycgJiYgUGF0aC5pc1BhdGgodmFsdWUucGF0aCk7CgogICAgICAgIGNhc2UgJ3NldF9ub2RlJzoKICAgICAgICAgIHJldHVybiBQYXRoLmlzUGF0aCh2YWx1ZS5wYXRoKSAmJiBpc1BsYWluT2JqZWN0LmlzUGxhaW5PYmplY3QodmFsdWUucHJvcGVydGllcykgJiYgaXNQbGFpbk9iamVjdC5pc1BsYWluT2JqZWN0KHZhbHVlLm5ld1Byb3BlcnRpZXMpOwoKICAgICAgICBjYXNlICdzZXRfc2VsZWN0aW9uJzoKICAgICAgICAgIHJldHVybiB2YWx1ZS5wcm9wZXJ0aWVzID09PSBudWxsICYmIFJhbmdlLmlzUmFuZ2UodmFsdWUubmV3UHJvcGVydGllcykgfHwgdmFsdWUubmV3UHJvcGVydGllcyA9PT0gbnVsbCAmJiBSYW5nZS5pc1JhbmdlKHZhbHVlLnByb3BlcnRpZXMpIHx8IGlzUGxhaW5PYmplY3QuaXNQbGFpbk9iamVjdCh2YWx1ZS5wcm9wZXJ0aWVzKSAmJiBpc1BsYWluT2JqZWN0LmlzUGxhaW5PYmplY3QodmFsdWUubmV3UHJvcGVydGllcyk7CgogICAgICAgIGNhc2UgJ3NwbGl0X25vZGUnOgogICAgICAgICAgcmV0dXJuIFBhdGguaXNQYXRoKHZhbHVlLnBhdGgpICYmIHR5cGVvZiB2YWx1ZS5wb3NpdGlvbiA9PT0gJ251bWJlcicgJiYgaXNQbGFpbk9iamVjdC5pc1BsYWluT2JqZWN0KHZhbHVlLnByb3BlcnRpZXMpOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSB2YWx1ZSBpcyBhIGxpc3Qgb2YgYE9wZXJhdGlvbmAgb2JqZWN0cy4KICAgICAqLwogICAgaXNPcGVyYXRpb25MaXN0OiBmdW5jdGlvbiBpc09wZXJhdGlvbkxpc3QodmFsdWUpIHsKICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkodmFsdWUpICYmIHZhbHVlLmV2ZXJ5KGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICByZXR1cm4gT3BlcmF0aW9uLmlzT3BlcmF0aW9uKHZhbCk7CiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIENoZWNrIG9mIGEgdmFsdWUgaXMgYSBgU2VsZWN0aW9uT3BlcmF0aW9uYCBvYmplY3QuCiAgICAgKi8KICAgIGlzU2VsZWN0aW9uT3BlcmF0aW9uOiBmdW5jdGlvbiBpc1NlbGVjdGlvbk9wZXJhdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gT3BlcmF0aW9uLmlzT3BlcmF0aW9uKHZhbHVlKSAmJiB2YWx1ZS50eXBlLmVuZHNXaXRoKCdfc2VsZWN0aW9uJyk7CiAgICB9LAoKICAgIC8qKgogICAgICogQ2hlY2sgb2YgYSB2YWx1ZSBpcyBhIGBUZXh0T3BlcmF0aW9uYCBvYmplY3QuCiAgICAgKi8KICAgIGlzVGV4dE9wZXJhdGlvbjogZnVuY3Rpb24gaXNUZXh0T3BlcmF0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiBPcGVyYXRpb24uaXNPcGVyYXRpb24odmFsdWUpICYmIHZhbHVlLnR5cGUuZW5kc1dpdGgoJ190ZXh0Jyk7CiAgICB9LAoKICAgIC8qKgogICAgICogSW52ZXJ0IGFuIG9wZXJhdGlvbiwgcmV0dXJuaW5nIGEgbmV3IG9wZXJhdGlvbiB0aGF0IHdpbGwgZXhhY3RseSB1bmRvIHRoZQogICAgICogb3JpZ2luYWwgd2hlbiBhcHBsaWVkLgogICAgICovCiAgICBpbnZlcnNlOiBmdW5jdGlvbiBpbnZlcnNlKG9wKSB7CiAgICAgIHN3aXRjaCAob3AudHlwZSkgewogICAgICAgIGNhc2UgJ2luc2VydF9ub2RlJzoKICAgICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQkNyhfb2JqZWN0U3ByZWFkJDcoe30sIG9wKSwge30sIHsKICAgICAgICAgICAgICB0eXBlOiAncmVtb3ZlX25vZGUnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICBjYXNlICdpbnNlcnRfdGV4dCc6CiAgICAgICAgICB7CiAgICAgICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkJDcoX29iamVjdFNwcmVhZCQ3KHt9LCBvcCksIHt9LCB7CiAgICAgICAgICAgICAgdHlwZTogJ3JlbW92ZV90ZXh0JwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgY2FzZSAnbWVyZ2Vfbm9kZSc6CiAgICAgICAgICB7CiAgICAgICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkJDcoX29iamVjdFNwcmVhZCQ3KHt9LCBvcCksIHt9LCB7CiAgICAgICAgICAgICAgdHlwZTogJ3NwbGl0X25vZGUnLAogICAgICAgICAgICAgIHBhdGg6IFBhdGgucHJldmlvdXMob3AucGF0aCkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgIGNhc2UgJ21vdmVfbm9kZSc6CiAgICAgICAgICB7CiAgICAgICAgICAgIHZhciBuZXdQYXRoID0gb3AubmV3UGF0aCwKICAgICAgICAgICAgICAgIHBhdGggPSBvcC5wYXRoOyAvLyBQRVJGOiBpbiB0aGlzIGNhc2UgdGhlIG1vdmUgb3BlcmF0aW9uIGlzIGEgbm8tb3AgYW55d2F5cy4KCiAgICAgICAgICAgIGlmIChQYXRoLmVxdWFscyhuZXdQYXRoLCBwYXRoKSkgewogICAgICAgICAgICAgIHJldHVybiBvcDsKICAgICAgICAgICAgfSAvLyBJZiB0aGUgbW92ZSBoYXBwZW5zIGNvbXBsZXRlbHkgd2l0aGluIGEgc2luZ2xlIHBhcmVudCB0aGUgcGF0aCBhbmQKICAgICAgICAgICAgLy8gbmV3UGF0aCBhcmUgc3RhYmxlIHdpdGggcmVzcGVjdCB0byBlYWNoIG90aGVyLgoKCiAgICAgICAgICAgIGlmIChQYXRoLmlzU2libGluZyhwYXRoLCBuZXdQYXRoKSkgewogICAgICAgICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkJDcoX29iamVjdFNwcmVhZCQ3KHt9LCBvcCksIHt9LCB7CiAgICAgICAgICAgICAgICBwYXRoOiBuZXdQYXRoLAogICAgICAgICAgICAgICAgbmV3UGF0aDogcGF0aAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IC8vIElmIHRoZSBtb3ZlIGRvZXMgbm90IGhhcHBlbiB3aXRoaW4gYSBzaW5nbGUgcGFyZW50IGl0IGlzIHBvc3NpYmxlCiAgICAgICAgICAgIC8vIGZvciB0aGUgbW92ZSB0byBpbXBhY3QgdGhlIHRydWUgcGF0aCB0byB0aGUgbG9jYXRpb24gd2hlcmUgdGhlIG5vZGUKICAgICAgICAgICAgLy8gd2FzIHJlbW92ZWQgZnJvbSBhbmQgd2hlcmUgaXQgd2FzIGluc2VydGVkLiBXZSBoYXZlIHRvIGFkanVzdCBmb3IgdGhpcwogICAgICAgICAgICAvLyBhbmQgZmluZCB0aGUgb3JpZ2luYWwgcGF0aC4gV2UgY2FuIGFjY29tcGxpc2ggdGhpcyAob25seSBpbiBub24tc2libGluZykKICAgICAgICAgICAgLy8gbW92ZXMgYnkgbG9va2luZyBhdCB0aGUgaW1wYWN0IG9mIHRoZSBtb3ZlIG9wZXJhdGlvbiBvbiB0aGUgbm9kZQogICAgICAgICAgICAvLyBhZnRlciB0aGUgb3JpZ2luYWwgbW92ZSBwYXRoLgoKCiAgICAgICAgICAgIHZhciBpbnZlcnNlUGF0aCA9IFBhdGgudHJhbnNmb3JtKHBhdGgsIG9wKTsKICAgICAgICAgICAgdmFyIGludmVyc2VOZXdQYXRoID0gUGF0aC50cmFuc2Zvcm0oUGF0aC5uZXh0KHBhdGgpLCBvcCk7CiAgICAgICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkJDcoX29iamVjdFNwcmVhZCQ3KHt9LCBvcCksIHt9LCB7CiAgICAgICAgICAgICAgcGF0aDogaW52ZXJzZVBhdGgsCiAgICAgICAgICAgICAgbmV3UGF0aDogaW52ZXJzZU5ld1BhdGgKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgIGNhc2UgJ3JlbW92ZV9ub2RlJzoKICAgICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQkNyhfb2JqZWN0U3ByZWFkJDcoe30sIG9wKSwge30sIHsKICAgICAgICAgICAgICB0eXBlOiAnaW5zZXJ0X25vZGUnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICBjYXNlICdyZW1vdmVfdGV4dCc6CiAgICAgICAgICB7CiAgICAgICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkJDcoX29iamVjdFNwcmVhZCQ3KHt9LCBvcCksIHt9LCB7CiAgICAgICAgICAgICAgdHlwZTogJ2luc2VydF90ZXh0JwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgY2FzZSAnc2V0X25vZGUnOgogICAgICAgICAgewogICAgICAgICAgICB2YXIgcHJvcGVydGllcyA9IG9wLnByb3BlcnRpZXMsCiAgICAgICAgICAgICAgICBuZXdQcm9wZXJ0aWVzID0gb3AubmV3UHJvcGVydGllczsKICAgICAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQkNyhfb2JqZWN0U3ByZWFkJDcoe30sIG9wKSwge30sIHsKICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiBuZXdQcm9wZXJ0aWVzLAogICAgICAgICAgICAgIG5ld1Byb3BlcnRpZXM6IHByb3BlcnRpZXMKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgIGNhc2UgJ3NldF9zZWxlY3Rpb24nOgogICAgICAgICAgewogICAgICAgICAgICB2YXIgX3Byb3BlcnRpZXMgPSBvcC5wcm9wZXJ0aWVzLAogICAgICAgICAgICAgICAgX25ld1Byb3BlcnRpZXMgPSBvcC5uZXdQcm9wZXJ0aWVzOwoKICAgICAgICAgICAgaWYgKF9wcm9wZXJ0aWVzID09IG51bGwpIHsKICAgICAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZCQ3KF9vYmplY3RTcHJlYWQkNyh7fSwgb3ApLCB7fSwgewogICAgICAgICAgICAgICAgcHJvcGVydGllczogX25ld1Byb3BlcnRpZXMsCiAgICAgICAgICAgICAgICBuZXdQcm9wZXJ0aWVzOiBudWxsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoX25ld1Byb3BlcnRpZXMgPT0gbnVsbCkgewogICAgICAgICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkJDcoX29iamVjdFNwcmVhZCQ3KHt9LCBvcCksIHt9LCB7CiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiBudWxsLAogICAgICAgICAgICAgICAgbmV3UHJvcGVydGllczogX3Byb3BlcnRpZXMKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZCQ3KF9vYmplY3RTcHJlYWQkNyh7fSwgb3ApLCB7fSwgewogICAgICAgICAgICAgICAgcHJvcGVydGllczogX25ld1Byb3BlcnRpZXMsCiAgICAgICAgICAgICAgICBuZXdQcm9wZXJ0aWVzOiBfcHJvcGVydGllcwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgIGNhc2UgJ3NwbGl0X25vZGUnOgogICAgICAgICAgewogICAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZCQ3KF9vYmplY3RTcHJlYWQkNyh7fSwgb3ApLCB7fSwgewogICAgICAgICAgICAgIHR5cGU6ICdtZXJnZV9ub2RlJywKICAgICAgICAgICAgICBwYXRoOiBQYXRoLm5leHQob3AucGF0aCkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwoKICB2YXIgUGF0aCA9IHsKICAgIC8qKgogICAgICogR2V0IGEgbGlzdCBvZiBhbmNlc3RvciBwYXRocyBmb3IgYSBnaXZlbiBwYXRoLgogICAgICoKICAgICAqIFRoZSBwYXRocyBhcmUgc29ydGVkIGZyb20gZGVlcGVzdCB0byBzaGFsbG93ZXN0IGFuY2VzdG9yLiBIb3dldmVyLCBpZiB0aGUKICAgICAqIGByZXZlcnNlOiB0cnVlYCBvcHRpb24gaXMgcGFzc2VkLCB0aGV5IGFyZSByZXZlcnNlZC4KICAgICAqLwogICAgYW5jZXN0b3JzOiBmdW5jdGlvbiBhbmNlc3RvcnMocGF0aCkgewogICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CiAgICAgIHZhciBfb3B0aW9ucyRyZXZlcnNlID0gb3B0aW9ucy5yZXZlcnNlLAogICAgICAgICAgcmV2ZXJzZSA9IF9vcHRpb25zJHJldmVyc2UgPT09IHZvaWQgMCA/IGZhbHNlIDogX29wdGlvbnMkcmV2ZXJzZTsKICAgICAgdmFyIHBhdGhzID0gUGF0aC5sZXZlbHMocGF0aCwgb3B0aW9ucyk7CgogICAgICBpZiAocmV2ZXJzZSkgewogICAgICAgIHBhdGhzID0gcGF0aHMuc2xpY2UoMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcGF0aHMgPSBwYXRocy5zbGljZSgwLCAtMSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBwYXRoczsKICAgIH0sCgogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNvbW1vbiBhbmNlc3RvciBwYXRoIG9mIHR3byBwYXRocy4KICAgICAqLwogICAgY29tbW9uOiBmdW5jdGlvbiBjb21tb24ocGF0aCwgYW5vdGhlcikgewogICAgICB2YXIgY29tbW9uID0gW107CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhdGgubGVuZ3RoICYmIGkgPCBhbm90aGVyLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGF2ID0gcGF0aFtpXTsKICAgICAgICB2YXIgYnYgPSBhbm90aGVyW2ldOwoKICAgICAgICBpZiAoYXYgIT09IGJ2KSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIGNvbW1vbi5wdXNoKGF2KTsKICAgICAgfQoKICAgICAgcmV0dXJuIGNvbW1vbjsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDb21wYXJlIGEgcGF0aCB0byBhbm90aGVyLCByZXR1cm5pbmcgYW4gaW50ZWdlciBpbmRpY2F0aW5nIHdoZXRoZXIgdGhlIHBhdGgKICAgICAqIHdhcyBiZWZvcmUsIGF0LCBvciBhZnRlciB0aGUgb3RoZXIuCiAgICAgKgogICAgICogTm90ZTogVHdvIHBhdGhzIG9mIHVuZXF1YWwgbGVuZ3RoIGNhbiBzdGlsbCByZWNlaXZlIGEgYDBgIHJlc3VsdCBpZiBvbmUgaXMKICAgICAqIGRpcmVjdGx5IGFib3ZlIG9yIGJlbG93IHRoZSBvdGhlci4gSWYgeW91IHdhbnQgZXhhY3QgbWF0Y2hpbmcsIHVzZQogICAgICogW1tQYXRoLmVxdWFsc11dIGluc3RlYWQuCiAgICAgKi8KICAgIGNvbXBhcmU6IGZ1bmN0aW9uIGNvbXBhcmUocGF0aCwgYW5vdGhlcikgewogICAgICB2YXIgbWluID0gTWF0aC5taW4ocGF0aC5sZW5ndGgsIGFub3RoZXIubGVuZ3RoKTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWluOyBpKyspIHsKICAgICAgICBpZiAocGF0aFtpXSA8IGFub3RoZXJbaV0pIHJldHVybiAtMTsKICAgICAgICBpZiAocGF0aFtpXSA+IGFub3RoZXJbaV0pIHJldHVybiAxOwogICAgICB9CgogICAgICByZXR1cm4gMDsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIHBhdGggZW5kcyBhZnRlciBvbmUgb2YgdGhlIGluZGV4ZXMgaW4gYW5vdGhlci4KICAgICAqLwogICAgZW5kc0FmdGVyOiBmdW5jdGlvbiBlbmRzQWZ0ZXIocGF0aCwgYW5vdGhlcikgewogICAgICB2YXIgaSA9IHBhdGgubGVuZ3RoIC0gMTsKICAgICAgdmFyIGFzID0gcGF0aC5zbGljZSgwLCBpKTsKICAgICAgdmFyIGJzID0gYW5vdGhlci5zbGljZSgwLCBpKTsKICAgICAgdmFyIGF2ID0gcGF0aFtpXTsKICAgICAgdmFyIGJ2ID0gYW5vdGhlcltpXTsKICAgICAgcmV0dXJuIFBhdGguZXF1YWxzKGFzLCBicykgJiYgYXYgPiBidjsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIHBhdGggZW5kcyBhdCBvbmUgb2YgdGhlIGluZGV4ZXMgaW4gYW5vdGhlci4KICAgICAqLwogICAgZW5kc0F0OiBmdW5jdGlvbiBlbmRzQXQocGF0aCwgYW5vdGhlcikgewogICAgICB2YXIgaSA9IHBhdGgubGVuZ3RoOwogICAgICB2YXIgYXMgPSBwYXRoLnNsaWNlKDAsIGkpOwogICAgICB2YXIgYnMgPSBhbm90aGVyLnNsaWNlKDAsIGkpOwogICAgICByZXR1cm4gUGF0aC5lcXVhbHMoYXMsIGJzKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIHBhdGggZW5kcyBiZWZvcmUgb25lIG9mIHRoZSBpbmRleGVzIGluIGFub3RoZXIuCiAgICAgKi8KICAgIGVuZHNCZWZvcmU6IGZ1bmN0aW9uIGVuZHNCZWZvcmUocGF0aCwgYW5vdGhlcikgewogICAgICB2YXIgaSA9IHBhdGgubGVuZ3RoIC0gMTsKICAgICAgdmFyIGFzID0gcGF0aC5zbGljZSgwLCBpKTsKICAgICAgdmFyIGJzID0gYW5vdGhlci5zbGljZSgwLCBpKTsKICAgICAgdmFyIGF2ID0gcGF0aFtpXTsKICAgICAgdmFyIGJ2ID0gYW5vdGhlcltpXTsKICAgICAgcmV0dXJuIFBhdGguZXF1YWxzKGFzLCBicykgJiYgYXYgPCBidjsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIHBhdGggaXMgZXhhY3RseSBlcXVhbCB0byBhbm90aGVyLgogICAgICovCiAgICBlcXVhbHM6IGZ1bmN0aW9uIGVxdWFscyhwYXRoLCBhbm90aGVyKSB7CiAgICAgIHJldHVybiBwYXRoLmxlbmd0aCA9PT0gYW5vdGhlci5sZW5ndGggJiYgcGF0aC5ldmVyeShmdW5jdGlvbiAobiwgaSkgewogICAgICAgIHJldHVybiBuID09PSBhbm90aGVyW2ldOwogICAgICB9KTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgcGF0aCBvZiBwcmV2aW91cyBzaWJsaW5nIG5vZGUgZXhpc3RzCiAgICAgKi8KICAgIGhhc1ByZXZpb3VzOiBmdW5jdGlvbiBoYXNQcmV2aW91cyhwYXRoKSB7CiAgICAgIHJldHVybiBwYXRoW3BhdGgubGVuZ3RoIC0gMV0gPiAwOwogICAgfSwKCiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgcGF0aCBpcyBhZnRlciBhbm90aGVyLgogICAgICovCiAgICBpc0FmdGVyOiBmdW5jdGlvbiBpc0FmdGVyKHBhdGgsIGFub3RoZXIpIHsKICAgICAgcmV0dXJuIFBhdGguY29tcGFyZShwYXRoLCBhbm90aGVyKSA9PT0gMTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIHBhdGggaXMgYW4gYW5jZXN0b3Igb2YgYW5vdGhlci4KICAgICAqLwogICAgaXNBbmNlc3RvcjogZnVuY3Rpb24gaXNBbmNlc3RvcihwYXRoLCBhbm90aGVyKSB7CiAgICAgIHJldHVybiBwYXRoLmxlbmd0aCA8IGFub3RoZXIubGVuZ3RoICYmIFBhdGguY29tcGFyZShwYXRoLCBhbm90aGVyKSA9PT0gMDsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIHBhdGggaXMgYmVmb3JlIGFub3RoZXIuCiAgICAgKi8KICAgIGlzQmVmb3JlOiBmdW5jdGlvbiBpc0JlZm9yZShwYXRoLCBhbm90aGVyKSB7CiAgICAgIHJldHVybiBQYXRoLmNvbXBhcmUocGF0aCwgYW5vdGhlcikgPT09IC0xOwogICAgfSwKCiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgcGF0aCBpcyBhIGNoaWxkIG9mIGFub3RoZXIuCiAgICAgKi8KICAgIGlzQ2hpbGQ6IGZ1bmN0aW9uIGlzQ2hpbGQocGF0aCwgYW5vdGhlcikgewogICAgICByZXR1cm4gcGF0aC5sZW5ndGggPT09IGFub3RoZXIubGVuZ3RoICsgMSAmJiBQYXRoLmNvbXBhcmUocGF0aCwgYW5vdGhlcikgPT09IDA7CiAgICB9LAoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSBwYXRoIGlzIGVxdWFsIHRvIG9yIGFuIGFuY2VzdG9yIG9mIGFub3RoZXIuCiAgICAgKi8KICAgIGlzQ29tbW9uOiBmdW5jdGlvbiBpc0NvbW1vbihwYXRoLCBhbm90aGVyKSB7CiAgICAgIHJldHVybiBwYXRoLmxlbmd0aCA8PSBhbm90aGVyLmxlbmd0aCAmJiBQYXRoLmNvbXBhcmUocGF0aCwgYW5vdGhlcikgPT09IDA7CiAgICB9LAoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSBwYXRoIGlzIGEgZGVzY2VuZGFudCBvZiBhbm90aGVyLgogICAgICovCiAgICBpc0Rlc2NlbmRhbnQ6IGZ1bmN0aW9uIGlzRGVzY2VuZGFudChwYXRoLCBhbm90aGVyKSB7CiAgICAgIHJldHVybiBwYXRoLmxlbmd0aCA+IGFub3RoZXIubGVuZ3RoICYmIFBhdGguY29tcGFyZShwYXRoLCBhbm90aGVyKSA9PT0gMDsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIHBhdGggaXMgdGhlIHBhcmVudCBvZiBhbm90aGVyLgogICAgICovCiAgICBpc1BhcmVudDogZnVuY3Rpb24gaXNQYXJlbnQocGF0aCwgYW5vdGhlcikgewogICAgICByZXR1cm4gcGF0aC5sZW5ndGggKyAxID09PSBhbm90aGVyLmxlbmd0aCAmJiBQYXRoLmNvbXBhcmUocGF0aCwgYW5vdGhlcikgPT09IDA7CiAgICB9LAoKICAgIC8qKgogICAgICogQ2hlY2sgaXMgYSB2YWx1ZSBpbXBsZW1lbnRzIHRoZSBgUGF0aGAgaW50ZXJmYWNlLgogICAgICovCiAgICBpc1BhdGg6IGZ1bmN0aW9uIGlzUGF0aCh2YWx1ZSkgewogICAgICByZXR1cm4gQXJyYXkuaXNBcnJheSh2YWx1ZSkgJiYgKHZhbHVlLmxlbmd0aCA9PT0gMCB8fCB0eXBlb2YgdmFsdWVbMF0gPT09ICdudW1iZXInKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIHBhdGggaXMgYSBzaWJsaW5nIG9mIGFub3RoZXIuCiAgICAgKi8KICAgIGlzU2libGluZzogZnVuY3Rpb24gaXNTaWJsaW5nKHBhdGgsIGFub3RoZXIpIHsKICAgICAgaWYgKHBhdGgubGVuZ3RoICE9PSBhbm90aGVyLmxlbmd0aCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgdmFyIGFzID0gcGF0aC5zbGljZSgwLCAtMSk7CiAgICAgIHZhciBicyA9IGFub3RoZXIuc2xpY2UoMCwgLTEpOwogICAgICB2YXIgYWwgPSBwYXRoW3BhdGgubGVuZ3RoIC0gMV07CiAgICAgIHZhciBibCA9IGFub3RoZXJbYW5vdGhlci5sZW5ndGggLSAxXTsKICAgICAgcmV0dXJuIGFsICE9PSBibCAmJiBQYXRoLmVxdWFscyhhcywgYnMpOwogICAgfSwKCiAgICAvKioKICAgICAqIEdldCBhIGxpc3Qgb2YgcGF0aHMgYXQgZXZlcnkgbGV2ZWwgZG93biB0byBhIHBhdGguIE5vdGU6IHRoaXMgaXMgdGhlIHNhbWUKICAgICAqIGFzIGBQYXRoLmFuY2VzdG9yc2AsIGJ1dCBpbmNsdWRpbmcgdGhlIHBhdGggaXRzZWxmLgogICAgICoKICAgICAqIFRoZSBwYXRocyBhcmUgc29ydGVkIGZyb20gc2hhbGxvd2VzdCB0byBkZWVwZXN0LiBIb3dldmVyLCBpZiB0aGUgYHJldmVyc2U6CiAgICAgKiB0cnVlYCBvcHRpb24gaXMgcGFzc2VkLCB0aGV5IGFyZSByZXZlcnNlZC4KICAgICAqLwogICAgbGV2ZWxzOiBmdW5jdGlvbiBsZXZlbHMocGF0aCkgewogICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CiAgICAgIHZhciBfb3B0aW9ucyRyZXZlcnNlMiA9IG9wdGlvbnMucmV2ZXJzZSwKICAgICAgICAgIHJldmVyc2UgPSBfb3B0aW9ucyRyZXZlcnNlMiA9PT0gdm9pZCAwID8gZmFsc2UgOiBfb3B0aW9ucyRyZXZlcnNlMjsKICAgICAgdmFyIGxpc3QgPSBbXTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDw9IHBhdGgubGVuZ3RoOyBpKyspIHsKICAgICAgICBsaXN0LnB1c2gocGF0aC5zbGljZSgwLCBpKSk7CiAgICAgIH0KCiAgICAgIGlmIChyZXZlcnNlKSB7CiAgICAgICAgbGlzdC5yZXZlcnNlKCk7CiAgICAgIH0KCiAgICAgIHJldHVybiBsaXN0OwogICAgfSwKCiAgICAvKioKICAgICAqIEdpdmVuIGEgcGF0aCwgZ2V0IHRoZSBwYXRoIHRvIHRoZSBuZXh0IHNpYmxpbmcgbm9kZS4KICAgICAqLwogICAgbmV4dDogZnVuY3Rpb24gbmV4dChwYXRoKSB7CiAgICAgIGlmIChwYXRoLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2Fubm90IGdldCB0aGUgbmV4dCBwYXRoIG9mIGEgcm9vdCBwYXRoIFsiLmNvbmNhdChwYXRoLCAiXSwgYmVjYXVzZSBpdCBoYXMgbm8gbmV4dCBpbmRleC4iKSk7CiAgICAgIH0KCiAgICAgIHZhciBsYXN0ID0gcGF0aFtwYXRoLmxlbmd0aCAtIDFdOwogICAgICByZXR1cm4gcGF0aC5zbGljZSgwLCAtMSkuY29uY2F0KGxhc3QgKyAxKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBHaXZlbiBhIHBhdGgsIHJldHVybiBhIG5ldyBwYXRoIHJlZmVycmluZyB0byB0aGUgcGFyZW50IG5vZGUgYWJvdmUgaXQuCiAgICAgKi8KICAgIHBhcmVudDogZnVuY3Rpb24gcGFyZW50KHBhdGgpIHsKICAgICAgaWYgKHBhdGgubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgZ2V0IHRoZSBwYXJlbnQgcGF0aCBvZiB0aGUgcm9vdCBwYXRoIFsiLmNvbmNhdChwYXRoLCAiXS4iKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBwYXRoLnNsaWNlKDAsIC0xKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBHaXZlbiBhIHBhdGgsIGdldCB0aGUgcGF0aCB0byB0aGUgcHJldmlvdXMgc2libGluZyBub2RlLgogICAgICovCiAgICBwcmV2aW91czogZnVuY3Rpb24gcHJldmlvdXMocGF0aCkgewogICAgICBpZiAocGF0aC5sZW5ndGggPT09IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBnZXQgdGhlIHByZXZpb3VzIHBhdGggb2YgYSByb290IHBhdGggWyIuY29uY2F0KHBhdGgsICJdLCBiZWNhdXNlIGl0IGhhcyBubyBwcmV2aW91cyBpbmRleC4iKSk7CiAgICAgIH0KCiAgICAgIHZhciBsYXN0ID0gcGF0aFtwYXRoLmxlbmd0aCAtIDFdOwoKICAgICAgaWYgKGxhc3QgPD0gMCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2Fubm90IGdldCB0aGUgcHJldmlvdXMgcGF0aCBvZiBhIGZpcnN0IGNoaWxkIHBhdGggWyIuY29uY2F0KHBhdGgsICJdIGJlY2F1c2UgaXQgd291bGQgcmVzdWx0IGluIGEgbmVnYXRpdmUgaW5kZXguIikpOwogICAgICB9CgogICAgICByZXR1cm4gcGF0aC5zbGljZSgwLCAtMSkuY29uY2F0KGxhc3QgLSAxKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBHZXQgYSBwYXRoIHJlbGF0aXZlIHRvIGFuIGFuY2VzdG9yLgogICAgICovCiAgICByZWxhdGl2ZTogZnVuY3Rpb24gcmVsYXRpdmUocGF0aCwgYW5jZXN0b3IpIHsKICAgICAgaWYgKCFQYXRoLmlzQW5jZXN0b3IoYW5jZXN0b3IsIHBhdGgpICYmICFQYXRoLmVxdWFscyhwYXRoLCBhbmNlc3RvcikpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBnZXQgdGhlIHJlbGF0aXZlIHBhdGggb2YgWyIuY29uY2F0KHBhdGgsICJdIGluc2lkZSBhbmNlc3RvciBbIikuY29uY2F0KGFuY2VzdG9yLCAiXSwgYmVjYXVzZSBpdCBpcyBub3QgYWJvdmUgb3IgZXF1YWwgdG8gdGhlIHBhdGguIikpOwogICAgICB9CgogICAgICByZXR1cm4gcGF0aC5zbGljZShhbmNlc3Rvci5sZW5ndGgpOwogICAgfSwKCiAgICAvKioKICAgICAqIFRyYW5zZm9ybSBhIHBhdGggYnkgYW4gb3BlcmF0aW9uLgogICAgICovCiAgICB0cmFuc2Zvcm06IGZ1bmN0aW9uIHRyYW5zZm9ybShwYXRoLCBvcGVyYXRpb24pIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IHt9OwogICAgICByZXR1cm4gaW1tZXIucHJvZHVjZShwYXRoLCBmdW5jdGlvbiAocCkgewogICAgICAgIHZhciBfb3B0aW9ucyRhZmZpbml0eSA9IG9wdGlvbnMuYWZmaW5pdHksCiAgICAgICAgICAgIGFmZmluaXR5ID0gX29wdGlvbnMkYWZmaW5pdHkgPT09IHZvaWQgMCA/ICdmb3J3YXJkJyA6IF9vcHRpb25zJGFmZmluaXR5OyAvLyBQRVJGOiBFeGl0IGVhcmx5IGlmIHRoZSBvcGVyYXRpb24gaXMgZ3VhcmFudGVlZCBub3QgdG8gaGF2ZSBhbiBlZmZlY3QuCgogICAgICAgIGlmICghcGF0aCB8fCAocGF0aCA9PT0gbnVsbCB8fCBwYXRoID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwYXRoLmxlbmd0aCkgPT09IDApIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChwID09PSBudWxsKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIHN3aXRjaCAob3BlcmF0aW9uLnR5cGUpIHsKICAgICAgICAgIGNhc2UgJ2luc2VydF9ub2RlJzoKICAgICAgICAgICAgewogICAgICAgICAgICAgIHZhciBvcCA9IG9wZXJhdGlvbi5wYXRoOwoKICAgICAgICAgICAgICBpZiAoUGF0aC5lcXVhbHMob3AsIHApIHx8IFBhdGguZW5kc0JlZm9yZShvcCwgcCkgfHwgUGF0aC5pc0FuY2VzdG9yKG9wLCBwKSkgewogICAgICAgICAgICAgICAgcFtvcC5sZW5ndGggLSAxXSArPSAxOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICBjYXNlICdyZW1vdmVfbm9kZSc6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICB2YXIgX29wID0gb3BlcmF0aW9uLnBhdGg7CgogICAgICAgICAgICAgIGlmIChQYXRoLmVxdWFscyhfb3AsIHApIHx8IFBhdGguaXNBbmNlc3Rvcihfb3AsIHApKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKFBhdGguZW5kc0JlZm9yZShfb3AsIHApKSB7CiAgICAgICAgICAgICAgICBwW19vcC5sZW5ndGggLSAxXSAtPSAxOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICBjYXNlICdtZXJnZV9ub2RlJzoKICAgICAgICAgICAgewogICAgICAgICAgICAgIHZhciBfb3AyID0gb3BlcmF0aW9uLnBhdGgsCiAgICAgICAgICAgICAgICAgIHBvc2l0aW9uID0gb3BlcmF0aW9uLnBvc2l0aW9uOwoKICAgICAgICAgICAgICBpZiAoUGF0aC5lcXVhbHMoX29wMiwgcCkgfHwgUGF0aC5lbmRzQmVmb3JlKF9vcDIsIHApKSB7CiAgICAgICAgICAgICAgICBwW19vcDIubGVuZ3RoIC0gMV0gLT0gMTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKFBhdGguaXNBbmNlc3Rvcihfb3AyLCBwKSkgewogICAgICAgICAgICAgICAgcFtfb3AyLmxlbmd0aCAtIDFdIC09IDE7CiAgICAgICAgICAgICAgICBwW19vcDIubGVuZ3RoXSArPSBwb3NpdGlvbjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgY2FzZSAnc3BsaXRfbm9kZSc6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICB2YXIgX29wMyA9IG9wZXJhdGlvbi5wYXRoLAogICAgICAgICAgICAgICAgICBfcG9zaXRpb24gPSBvcGVyYXRpb24ucG9zaXRpb247CgogICAgICAgICAgICAgIGlmIChQYXRoLmVxdWFscyhfb3AzLCBwKSkgewogICAgICAgICAgICAgICAgaWYgKGFmZmluaXR5ID09PSAnZm9yd2FyZCcpIHsKICAgICAgICAgICAgICAgICAgcFtwLmxlbmd0aCAtIDFdICs9IDE7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFmZmluaXR5ID09PSAnYmFja3dhcmQnKSA7IGVsc2UgewogICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKFBhdGguZW5kc0JlZm9yZShfb3AzLCBwKSkgewogICAgICAgICAgICAgICAgcFtfb3AzLmxlbmd0aCAtIDFdICs9IDE7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChQYXRoLmlzQW5jZXN0b3IoX29wMywgcCkgJiYgcGF0aFtfb3AzLmxlbmd0aF0gPj0gX3Bvc2l0aW9uKSB7CiAgICAgICAgICAgICAgICBwW19vcDMubGVuZ3RoIC0gMV0gKz0gMTsKICAgICAgICAgICAgICAgIHBbX29wMy5sZW5ndGhdIC09IF9wb3NpdGlvbjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgY2FzZSAnbW92ZV9ub2RlJzoKICAgICAgICAgICAgewogICAgICAgICAgICAgIHZhciBfb3A0ID0gb3BlcmF0aW9uLnBhdGgsCiAgICAgICAgICAgICAgICAgIG9ucCA9IG9wZXJhdGlvbi5uZXdQYXRoOyAvLyBJZiB0aGUgb2xkIGFuZCBuZXcgcGF0aCBhcmUgdGhlIHNhbWUsIGl0J3MgYSBuby1vcC4KCiAgICAgICAgICAgICAgaWYgKFBhdGguZXF1YWxzKF9vcDQsIG9ucCkpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChQYXRoLmlzQW5jZXN0b3IoX29wNCwgcCkgfHwgUGF0aC5lcXVhbHMoX29wNCwgcCkpIHsKICAgICAgICAgICAgICAgIHZhciBjb3B5ID0gb25wLnNsaWNlKCk7CgogICAgICAgICAgICAgICAgaWYgKFBhdGguZW5kc0JlZm9yZShfb3A0LCBvbnApICYmIF9vcDQubGVuZ3RoIDwgb25wLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICBjb3B5W19vcDQubGVuZ3RoIC0gMV0gLT0gMTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gY29weS5jb25jYXQocC5zbGljZShfb3A0Lmxlbmd0aCkpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoUGF0aC5pc1NpYmxpbmcoX29wNCwgb25wKSAmJiAoUGF0aC5pc0FuY2VzdG9yKG9ucCwgcCkgfHwgUGF0aC5lcXVhbHMob25wLCBwKSkpIHsKICAgICAgICAgICAgICAgIGlmIChQYXRoLmVuZHNCZWZvcmUoX29wNCwgcCkpIHsKICAgICAgICAgICAgICAgICAgcFtfb3A0Lmxlbmd0aCAtIDFdIC09IDE7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBwW19vcDQubGVuZ3RoIC0gMV0gKz0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKFBhdGguZW5kc0JlZm9yZShvbnAsIHApIHx8IFBhdGguZXF1YWxzKG9ucCwgcCkgfHwgUGF0aC5pc0FuY2VzdG9yKG9ucCwgcCkpIHsKICAgICAgICAgICAgICAgIGlmIChQYXRoLmVuZHNCZWZvcmUoX29wNCwgcCkpIHsKICAgICAgICAgICAgICAgICAgcFtfb3A0Lmxlbmd0aCAtIDFdIC09IDE7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcFtvbnAubGVuZ3RoIC0gMV0gKz0gMTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKFBhdGguZW5kc0JlZm9yZShfb3A0LCBwKSkgewogICAgICAgICAgICAgICAgaWYgKFBhdGguZXF1YWxzKG9ucCwgcCkpIHsKICAgICAgICAgICAgICAgICAgcFtvbnAubGVuZ3RoIC0gMV0gKz0gMTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBwW19vcDQubGVuZ3RoIC0gMV0gLT0gMTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9OwoKICB2YXIgUGF0aFJlZiA9IHsKICAgIC8qKgogICAgICogVHJhbnNmb3JtIHRoZSBwYXRoIHJlZidzIGN1cnJlbnQgdmFsdWUgYnkgYW4gb3BlcmF0aW9uLgogICAgICovCiAgICB0cmFuc2Zvcm06IGZ1bmN0aW9uIHRyYW5zZm9ybShyZWYsIG9wKSB7CiAgICAgIHZhciBjdXJyZW50ID0gcmVmLmN1cnJlbnQsCiAgICAgICAgICBhZmZpbml0eSA9IHJlZi5hZmZpbml0eTsKCiAgICAgIGlmIChjdXJyZW50ID09IG51bGwpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBwYXRoID0gUGF0aC50cmFuc2Zvcm0oY3VycmVudCwgb3AsIHsKICAgICAgICBhZmZpbml0eTogYWZmaW5pdHkKICAgICAgfSk7CiAgICAgIHJlZi5jdXJyZW50ID0gcGF0aDsKCiAgICAgIGlmIChwYXRoID09IG51bGwpIHsKICAgICAgICByZWYudW5yZWYoKTsKICAgICAgfQogICAgfQogIH07CgogIGZ1bmN0aW9uIG93bktleXMkNihvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgeyBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgeyByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsgfSk7IH0ga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgogIGZ1bmN0aW9uIF9vYmplY3RTcHJlYWQkNih0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307IGlmIChpICUgMikgeyBvd25LZXlzJDYoT2JqZWN0KHNvdXJjZSksIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyQ2KE9iamVjdChzb3VyY2UpKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfQogIHZhciBQb2ludCA9IHsKICAgIC8qKgogICAgICogQ29tcGFyZSBhIHBvaW50IHRvIGFub3RoZXIsIHJldHVybmluZyBhbiBpbnRlZ2VyIGluZGljYXRpbmcgd2hldGhlciB0aGUKICAgICAqIHBvaW50IHdhcyBiZWZvcmUsIGF0LCBvciBhZnRlciB0aGUgb3RoZXIuCiAgICAgKi8KICAgIGNvbXBhcmU6IGZ1bmN0aW9uIGNvbXBhcmUocG9pbnQsIGFub3RoZXIpIHsKICAgICAgdmFyIHJlc3VsdCA9IFBhdGguY29tcGFyZShwb2ludC5wYXRoLCBhbm90aGVyLnBhdGgpOwoKICAgICAgaWYgKHJlc3VsdCA9PT0gMCkgewogICAgICAgIGlmIChwb2ludC5vZmZzZXQgPCBhbm90aGVyLm9mZnNldCkgcmV0dXJuIC0xOwogICAgICAgIGlmIChwb2ludC5vZmZzZXQgPiBhbm90aGVyLm9mZnNldCkgcmV0dXJuIDE7CiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9LAoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSBwb2ludCBpcyBhZnRlciBhbm90aGVyLgogICAgICovCiAgICBpc0FmdGVyOiBmdW5jdGlvbiBpc0FmdGVyKHBvaW50LCBhbm90aGVyKSB7CiAgICAgIHJldHVybiBQb2ludC5jb21wYXJlKHBvaW50LCBhbm90aGVyKSA9PT0gMTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIHBvaW50IGlzIGJlZm9yZSBhbm90aGVyLgogICAgICovCiAgICBpc0JlZm9yZTogZnVuY3Rpb24gaXNCZWZvcmUocG9pbnQsIGFub3RoZXIpIHsKICAgICAgcmV0dXJuIFBvaW50LmNvbXBhcmUocG9pbnQsIGFub3RoZXIpID09PSAtMTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIHBvaW50IGlzIGV4YWN0bHkgZXF1YWwgdG8gYW5vdGhlci4KICAgICAqLwogICAgZXF1YWxzOiBmdW5jdGlvbiBlcXVhbHMocG9pbnQsIGFub3RoZXIpIHsKICAgICAgLy8gUEVSRjogZW5zdXJlIHRoZSBvZmZzZXRzIGFyZSBlcXVhbCBmaXJzdCBzaW5jZSB0aGV5IGFyZSBjaGVhcGVyIHRvIGNoZWNrLgogICAgICByZXR1cm4gcG9pbnQub2Zmc2V0ID09PSBhbm90aGVyLm9mZnNldCAmJiBQYXRoLmVxdWFscyhwb2ludC5wYXRoLCBhbm90aGVyLnBhdGgpOwogICAgfSwKCiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmFsdWUgaW1wbGVtZW50cyB0aGUgYFBvaW50YCBpbnRlcmZhY2UuCiAgICAgKi8KICAgIGlzUG9pbnQ6IGZ1bmN0aW9uIGlzUG9pbnQodmFsdWUpIHsKICAgICAgcmV0dXJuIGlzUGxhaW5PYmplY3QuaXNQbGFpbk9iamVjdCh2YWx1ZSkgJiYgdHlwZW9mIHZhbHVlLm9mZnNldCA9PT0gJ251bWJlcicgJiYgUGF0aC5pc1BhdGgodmFsdWUucGF0aCk7CiAgICB9LAoKICAgIC8qKgogICAgICogVHJhbnNmb3JtIGEgcG9pbnQgYnkgYW4gb3BlcmF0aW9uLgogICAgICovCiAgICB0cmFuc2Zvcm06IGZ1bmN0aW9uIHRyYW5zZm9ybShwb2ludCwgb3ApIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IHt9OwogICAgICByZXR1cm4gaW1tZXIucHJvZHVjZShwb2ludCwgZnVuY3Rpb24gKHApIHsKICAgICAgICBpZiAocCA9PT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICB2YXIgX29wdGlvbnMkYWZmaW5pdHkgPSBvcHRpb25zLmFmZmluaXR5LAogICAgICAgICAgICBhZmZpbml0eSA9IF9vcHRpb25zJGFmZmluaXR5ID09PSB2b2lkIDAgPyAnZm9yd2FyZCcgOiBfb3B0aW9ucyRhZmZpbml0eTsKICAgICAgICB2YXIgcGF0aCA9IHAucGF0aCwKICAgICAgICAgICAgb2Zmc2V0ID0gcC5vZmZzZXQ7CgogICAgICAgIHN3aXRjaCAob3AudHlwZSkgewogICAgICAgICAgY2FzZSAnaW5zZXJ0X25vZGUnOgogICAgICAgICAgY2FzZSAnbW92ZV9ub2RlJzoKICAgICAgICAgICAgewogICAgICAgICAgICAgIHAucGF0aCA9IFBhdGgudHJhbnNmb3JtKHBhdGgsIG9wLCBvcHRpb25zKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgIGNhc2UgJ2luc2VydF90ZXh0JzoKICAgICAgICAgICAgewogICAgICAgICAgICAgIGlmIChQYXRoLmVxdWFscyhvcC5wYXRoLCBwYXRoKSAmJiBvcC5vZmZzZXQgPD0gb2Zmc2V0KSB7CiAgICAgICAgICAgICAgICBwLm9mZnNldCArPSBvcC50ZXh0Lmxlbmd0aDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgY2FzZSAnbWVyZ2Vfbm9kZSc6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBpZiAoUGF0aC5lcXVhbHMob3AucGF0aCwgcGF0aCkpIHsKICAgICAgICAgICAgICAgIHAub2Zmc2V0ICs9IG9wLnBvc2l0aW9uOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcC5wYXRoID0gUGF0aC50cmFuc2Zvcm0ocGF0aCwgb3AsIG9wdGlvbnMpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgY2FzZSAncmVtb3ZlX3RleHQnOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgaWYgKFBhdGguZXF1YWxzKG9wLnBhdGgsIHBhdGgpICYmIG9wLm9mZnNldCA8PSBvZmZzZXQpIHsKICAgICAgICAgICAgICAgIHAub2Zmc2V0IC09IE1hdGgubWluKG9mZnNldCAtIG9wLm9mZnNldCwgb3AudGV4dC5sZW5ndGgpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICBjYXNlICdyZW1vdmVfbm9kZSc6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBpZiAoUGF0aC5lcXVhbHMob3AucGF0aCwgcGF0aCkgfHwgUGF0aC5pc0FuY2VzdG9yKG9wLnBhdGgsIHBhdGgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHAucGF0aCA9IFBhdGgudHJhbnNmb3JtKHBhdGgsIG9wLCBvcHRpb25zKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgIGNhc2UgJ3NwbGl0X25vZGUnOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgaWYgKFBhdGguZXF1YWxzKG9wLnBhdGgsIHBhdGgpKSB7CiAgICAgICAgICAgICAgICBpZiAob3AucG9zaXRpb24gPT09IG9mZnNldCAmJiBhZmZpbml0eSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvcC5wb3NpdGlvbiA8IG9mZnNldCB8fCBvcC5wb3NpdGlvbiA9PT0gb2Zmc2V0ICYmIGFmZmluaXR5ID09PSAnZm9yd2FyZCcpIHsKICAgICAgICAgICAgICAgICAgcC5vZmZzZXQgLT0gb3AucG9zaXRpb247CiAgICAgICAgICAgICAgICAgIHAucGF0aCA9IFBhdGgudHJhbnNmb3JtKHBhdGgsIG9wLCBfb2JqZWN0U3ByZWFkJDYoX29iamVjdFNwcmVhZCQ2KHt9LCBvcHRpb25zKSwge30sIHsKICAgICAgICAgICAgICAgICAgICBhZmZpbml0eTogJ2ZvcndhcmQnCiAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcC5wYXRoID0gUGF0aC50cmFuc2Zvcm0ocGF0aCwgb3AsIG9wdGlvbnMpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH07CgogIHZhciBQb2ludFJlZiA9IHsKICAgIC8qKgogICAgICogVHJhbnNmb3JtIHRoZSBwb2ludCByZWYncyBjdXJyZW50IHZhbHVlIGJ5IGFuIG9wZXJhdGlvbi4KICAgICAqLwogICAgdHJhbnNmb3JtOiBmdW5jdGlvbiB0cmFuc2Zvcm0ocmVmLCBvcCkgewogICAgICB2YXIgY3VycmVudCA9IHJlZi5jdXJyZW50LAogICAgICAgICAgYWZmaW5pdHkgPSByZWYuYWZmaW5pdHk7CgogICAgICBpZiAoY3VycmVudCA9PSBudWxsKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgcG9pbnQgPSBQb2ludC50cmFuc2Zvcm0oY3VycmVudCwgb3AsIHsKICAgICAgICBhZmZpbml0eTogYWZmaW5pdHkKICAgICAgfSk7CiAgICAgIHJlZi5jdXJyZW50ID0gcG9pbnQ7CgogICAgICBpZiAocG9pbnQgPT0gbnVsbCkgewogICAgICAgIHJlZi51bnJlZigpOwogICAgICB9CiAgICB9CiAgfTsKCiAgdmFyIF9leGNsdWRlZCQyID0gWyJhbmNob3IiLCAiZm9jdXMiXTsKCiAgZnVuY3Rpb24gb3duS2V5cyQ1KG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOyBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgeyB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsgaWYgKGVudW1lcmFibGVPbmx5KSB7IHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsgfSBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCiAgZnVuY3Rpb24gX29iamVjdFNwcmVhZCQ1KHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMkNShPYmplY3Qoc291cmNlKSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyBvd25LZXlzJDUoT2JqZWN0KHNvdXJjZSkpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsgfSk7IH0gfSByZXR1cm4gdGFyZ2V0OyB9CiAgdmFyIFJhbmdlID0gewogICAgLyoqCiAgICAgKiBHZXQgdGhlIHN0YXJ0IGFuZCBlbmQgcG9pbnRzIG9mIGEgcmFuZ2UsIGluIHRoZSBvcmRlciBpbiB3aGljaCB0aGV5IGFwcGVhcgogICAgICogaW4gdGhlIGRvY3VtZW50LgogICAgICovCiAgICBlZGdlczogZnVuY3Rpb24gZWRnZXMocmFuZ2UpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogICAgICB2YXIgX29wdGlvbnMkcmV2ZXJzZSA9IG9wdGlvbnMucmV2ZXJzZSwKICAgICAgICAgIHJldmVyc2UgPSBfb3B0aW9ucyRyZXZlcnNlID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zJHJldmVyc2U7CiAgICAgIHZhciBhbmNob3IgPSByYW5nZS5hbmNob3IsCiAgICAgICAgICBmb2N1cyA9IHJhbmdlLmZvY3VzOwogICAgICByZXR1cm4gUmFuZ2UuaXNCYWNrd2FyZChyYW5nZSkgPT09IHJldmVyc2UgPyBbYW5jaG9yLCBmb2N1c10gOiBbZm9jdXMsIGFuY2hvcl07CiAgICB9LAoKICAgIC8qKgogICAgICogR2V0IHRoZSBlbmQgcG9pbnQgb2YgYSByYW5nZS4KICAgICAqLwogICAgZW5kOiBmdW5jdGlvbiBlbmQocmFuZ2UpIHsKICAgICAgdmFyIF9SYW5nZSRlZGdlcyA9IFJhbmdlLmVkZ2VzKHJhbmdlKSwKICAgICAgICAgIF9SYW5nZSRlZGdlczIgPSBfc2xpY2VkVG9BcnJheShfUmFuZ2UkZWRnZXMsIDIpLAogICAgICAgICAgZW5kID0gX1JhbmdlJGVkZ2VzMlsxXTsKCiAgICAgIHJldHVybiBlbmQ7CiAgICB9LAoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSByYW5nZSBpcyBleGFjdGx5IGVxdWFsIHRvIGFub3RoZXIuCiAgICAgKi8KICAgIGVxdWFsczogZnVuY3Rpb24gZXF1YWxzKHJhbmdlLCBhbm90aGVyKSB7CiAgICAgIHJldHVybiBQb2ludC5lcXVhbHMocmFuZ2UuYW5jaG9yLCBhbm90aGVyLmFuY2hvcikgJiYgUG9pbnQuZXF1YWxzKHJhbmdlLmZvY3VzLCBhbm90aGVyLmZvY3VzKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIHJhbmdlIGluY2x1ZGVzIGEgcGF0aCwgYSBwb2ludCBvciBwYXJ0IG9mIGFub3RoZXIgcmFuZ2UuCiAgICAgKi8KICAgIGluY2x1ZGVzOiBmdW5jdGlvbiBpbmNsdWRlcyhyYW5nZSwgdGFyZ2V0KSB7CiAgICAgIGlmIChSYW5nZS5pc1JhbmdlKHRhcmdldCkpIHsKICAgICAgICBpZiAoUmFuZ2UuaW5jbHVkZXMocmFuZ2UsIHRhcmdldC5hbmNob3IpIHx8IFJhbmdlLmluY2x1ZGVzKHJhbmdlLCB0YXJnZXQuZm9jdXMpKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHZhciBfUmFuZ2UkZWRnZXMzID0gUmFuZ2UuZWRnZXMocmFuZ2UpLAogICAgICAgICAgICBfUmFuZ2UkZWRnZXM0ID0gX3NsaWNlZFRvQXJyYXkoX1JhbmdlJGVkZ2VzMywgMiksCiAgICAgICAgICAgIHJzID0gX1JhbmdlJGVkZ2VzNFswXSwKICAgICAgICAgICAgcmUgPSBfUmFuZ2UkZWRnZXM0WzFdOwoKICAgICAgICB2YXIgX1JhbmdlJGVkZ2VzNSA9IFJhbmdlLmVkZ2VzKHRhcmdldCksCiAgICAgICAgICAgIF9SYW5nZSRlZGdlczYgPSBfc2xpY2VkVG9BcnJheShfUmFuZ2UkZWRnZXM1LCAyKSwKICAgICAgICAgICAgdHMgPSBfUmFuZ2UkZWRnZXM2WzBdLAogICAgICAgICAgICB0ZSA9IF9SYW5nZSRlZGdlczZbMV07CgogICAgICAgIHJldHVybiBQb2ludC5pc0JlZm9yZShycywgdHMpICYmIFBvaW50LmlzQWZ0ZXIocmUsIHRlKTsKICAgICAgfQoKICAgICAgdmFyIF9SYW5nZSRlZGdlczcgPSBSYW5nZS5lZGdlcyhyYW5nZSksCiAgICAgICAgICBfUmFuZ2UkZWRnZXM4ID0gX3NsaWNlZFRvQXJyYXkoX1JhbmdlJGVkZ2VzNywgMiksCiAgICAgICAgICBzdGFydCA9IF9SYW5nZSRlZGdlczhbMF0sCiAgICAgICAgICBlbmQgPSBfUmFuZ2UkZWRnZXM4WzFdOwoKICAgICAgdmFyIGlzQWZ0ZXJTdGFydCA9IGZhbHNlOwogICAgICB2YXIgaXNCZWZvcmVFbmQgPSBmYWxzZTsKCiAgICAgIGlmIChQb2ludC5pc1BvaW50KHRhcmdldCkpIHsKICAgICAgICBpc0FmdGVyU3RhcnQgPSBQb2ludC5jb21wYXJlKHRhcmdldCwgc3RhcnQpID49IDA7CiAgICAgICAgaXNCZWZvcmVFbmQgPSBQb2ludC5jb21wYXJlKHRhcmdldCwgZW5kKSA8PSAwOwogICAgICB9IGVsc2UgewogICAgICAgIGlzQWZ0ZXJTdGFydCA9IFBhdGguY29tcGFyZSh0YXJnZXQsIHN0YXJ0LnBhdGgpID49IDA7CiAgICAgICAgaXNCZWZvcmVFbmQgPSBQYXRoLmNvbXBhcmUodGFyZ2V0LCBlbmQucGF0aCkgPD0gMDsKICAgICAgfQoKICAgICAgcmV0dXJuIGlzQWZ0ZXJTdGFydCAmJiBpc0JlZm9yZUVuZDsKICAgIH0sCgogICAgLyoqCiAgICAgKiBHZXQgdGhlIGludGVyc2VjdGlvbiBvZiBhIHJhbmdlIHdpdGggYW5vdGhlci4KICAgICAqLwogICAgaW50ZXJzZWN0aW9uOiBmdW5jdGlvbiBpbnRlcnNlY3Rpb24ocmFuZ2UsIGFub3RoZXIpIHsKICAgICAgcmFuZ2UuYW5jaG9yOwogICAgICAgICAgcmFuZ2UuZm9jdXM7CiAgICAgICAgICB2YXIgcmVzdCA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllcyhyYW5nZSwgX2V4Y2x1ZGVkJDIpOwoKICAgICAgdmFyIF9SYW5nZSRlZGdlczkgPSBSYW5nZS5lZGdlcyhyYW5nZSksCiAgICAgICAgICBfUmFuZ2UkZWRnZXMxMCA9IF9zbGljZWRUb0FycmF5KF9SYW5nZSRlZGdlczksIDIpLAogICAgICAgICAgczEgPSBfUmFuZ2UkZWRnZXMxMFswXSwKICAgICAgICAgIGUxID0gX1JhbmdlJGVkZ2VzMTBbMV07CgogICAgICB2YXIgX1JhbmdlJGVkZ2VzMTEgPSBSYW5nZS5lZGdlcyhhbm90aGVyKSwKICAgICAgICAgIF9SYW5nZSRlZGdlczEyID0gX3NsaWNlZFRvQXJyYXkoX1JhbmdlJGVkZ2VzMTEsIDIpLAogICAgICAgICAgczIgPSBfUmFuZ2UkZWRnZXMxMlswXSwKICAgICAgICAgIGUyID0gX1JhbmdlJGVkZ2VzMTJbMV07CgogICAgICB2YXIgc3RhcnQgPSBQb2ludC5pc0JlZm9yZShzMSwgczIpID8gczIgOiBzMTsKICAgICAgdmFyIGVuZCA9IFBvaW50LmlzQmVmb3JlKGUxLCBlMikgPyBlMSA6IGUyOwoKICAgICAgaWYgKFBvaW50LmlzQmVmb3JlKGVuZCwgc3RhcnQpKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQkNSh7CiAgICAgICAgICBhbmNob3I6IHN0YXJ0LAogICAgICAgICAgZm9jdXM6IGVuZAogICAgICAgIH0sIHJlc3QpOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSByYW5nZSBpcyBiYWNrd2FyZCwgbWVhbmluZyB0aGF0IGl0cyBhbmNob3IgcG9pbnQgYXBwZWFycyBpbiB0aGUKICAgICAqIGRvY3VtZW50IF9hZnRlcl8gaXRzIGZvY3VzIHBvaW50LgogICAgICovCiAgICBpc0JhY2t3YXJkOiBmdW5jdGlvbiBpc0JhY2t3YXJkKHJhbmdlKSB7CiAgICAgIHZhciBhbmNob3IgPSByYW5nZS5hbmNob3IsCiAgICAgICAgICBmb2N1cyA9IHJhbmdlLmZvY3VzOwogICAgICByZXR1cm4gUG9pbnQuaXNBZnRlcihhbmNob3IsIGZvY3VzKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIHJhbmdlIGlzIGNvbGxhcHNlZCwgbWVhbmluZyB0aGF0IGJvdGggaXRzIGFuY2hvciBhbmQgZm9jdXMKICAgICAqIHBvaW50cyByZWZlciB0byB0aGUgZXhhY3Qgc2FtZSBwb3NpdGlvbiBpbiB0aGUgZG9jdW1lbnQuCiAgICAgKi8KICAgIGlzQ29sbGFwc2VkOiBmdW5jdGlvbiBpc0NvbGxhcHNlZChyYW5nZSkgewogICAgICB2YXIgYW5jaG9yID0gcmFuZ2UuYW5jaG9yLAogICAgICAgICAgZm9jdXMgPSByYW5nZS5mb2N1czsKICAgICAgcmV0dXJuIFBvaW50LmVxdWFscyhhbmNob3IsIGZvY3VzKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIHJhbmdlIGlzIGV4cGFuZGVkLgogICAgICoKICAgICAqIFRoaXMgaXMgdGhlIG9wcG9zaXRlIG9mIFtbUmFuZ2UuaXNDb2xsYXBzZWRdXSBhbmQgaXMgcHJvdmlkZWQgZm9yIGxlZ2liaWxpdHkuCiAgICAgKi8KICAgIGlzRXhwYW5kZWQ6IGZ1bmN0aW9uIGlzRXhwYW5kZWQocmFuZ2UpIHsKICAgICAgcmV0dXJuICFSYW5nZS5pc0NvbGxhcHNlZChyYW5nZSk7CiAgICB9LAoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSByYW5nZSBpcyBmb3J3YXJkLgogICAgICoKICAgICAqIFRoaXMgaXMgdGhlIG9wcG9zaXRlIG9mIFtbUmFuZ2UuaXNCYWNrd2FyZF1dIGFuZCBpcyBwcm92aWRlZCBmb3IgbGVnaWJpbGl0eS4KICAgICAqLwogICAgaXNGb3J3YXJkOiBmdW5jdGlvbiBpc0ZvcndhcmQocmFuZ2UpIHsKICAgICAgcmV0dXJuICFSYW5nZS5pc0JhY2t3YXJkKHJhbmdlKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIHZhbHVlIGltcGxlbWVudHMgdGhlIFtbUmFuZ2VdXSBpbnRlcmZhY2UuCiAgICAgKi8KICAgIGlzUmFuZ2U6IGZ1bmN0aW9uIGlzUmFuZ2UodmFsdWUpIHsKICAgICAgcmV0dXJuIGlzUGxhaW5PYmplY3QuaXNQbGFpbk9iamVjdCh2YWx1ZSkgJiYgUG9pbnQuaXNQb2ludCh2YWx1ZS5hbmNob3IpICYmIFBvaW50LmlzUG9pbnQodmFsdWUuZm9jdXMpOwogICAgfSwKCiAgICAvKioKICAgICAqIEl0ZXJhdGUgdGhyb3VnaCBhbGwgb2YgdGhlIHBvaW50IGVudHJpZXMgaW4gYSByYW5nZS4KICAgICAqLwogICAgcG9pbnRzOiBmdW5jdGlvbiogcG9pbnRzKHJhbmdlKSB7CiAgICAgIHlpZWxkIFtyYW5nZS5hbmNob3IsICdhbmNob3InXTsKICAgICAgeWllbGQgW3JhbmdlLmZvY3VzLCAnZm9jdXMnXTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBHZXQgdGhlIHN0YXJ0IHBvaW50IG9mIGEgcmFuZ2UuCiAgICAgKi8KICAgIHN0YXJ0OiBmdW5jdGlvbiBzdGFydChyYW5nZSkgewogICAgICB2YXIgX1JhbmdlJGVkZ2VzMTMgPSBSYW5nZS5lZGdlcyhyYW5nZSksCiAgICAgICAgICBfUmFuZ2UkZWRnZXMxNCA9IF9zbGljZWRUb0FycmF5KF9SYW5nZSRlZGdlczEzLCAxKSwKICAgICAgICAgIHN0YXJ0ID0gX1JhbmdlJGVkZ2VzMTRbMF07CgogICAgICByZXR1cm4gc3RhcnQ7CiAgICB9LAoKICAgIC8qKgogICAgICogVHJhbnNmb3JtIGEgcmFuZ2UgYnkgYW4gb3BlcmF0aW9uLgogICAgICovCiAgICB0cmFuc2Zvcm06IGZ1bmN0aW9uIHRyYW5zZm9ybShyYW5nZSwgb3ApIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IHt9OwogICAgICByZXR1cm4gaW1tZXIucHJvZHVjZShyYW5nZSwgZnVuY3Rpb24gKHIpIHsKICAgICAgICBpZiAociA9PT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICB2YXIgX29wdGlvbnMkYWZmaW5pdHkgPSBvcHRpb25zLmFmZmluaXR5LAogICAgICAgICAgICBhZmZpbml0eSA9IF9vcHRpb25zJGFmZmluaXR5ID09PSB2b2lkIDAgPyAnaW53YXJkJyA6IF9vcHRpb25zJGFmZmluaXR5OwogICAgICAgIHZhciBhZmZpbml0eUFuY2hvcjsKICAgICAgICB2YXIgYWZmaW5pdHlGb2N1czsKCiAgICAgICAgaWYgKGFmZmluaXR5ID09PSAnaW53YXJkJykgewogICAgICAgICAgLy8gSWYgdGhlIHJhbmdlIGlzIGNvbGxhcHNlZCwgbWFrZSBzdXJlIHRvIHVzZSB0aGUgc2FtZSBhZmZpbml0eSB0bwogICAgICAgICAgLy8gYXZvaWQgdGhlIHR3byBwb2ludHMgcGFzc2luZyBlYWNoIG90aGVyIGFuZCBleHBhbmRpbmcgaW4gdGhlIG9wcG9zaXRlCiAgICAgICAgICAvLyBkaXJlY3Rpb24KICAgICAgICAgIHZhciBpc0NvbGxhcHNlZCA9IFJhbmdlLmlzQ29sbGFwc2VkKHIpOwoKICAgICAgICAgIGlmIChSYW5nZS5pc0ZvcndhcmQocikpIHsKICAgICAgICAgICAgYWZmaW5pdHlBbmNob3IgPSAnZm9yd2FyZCc7CiAgICAgICAgICAgIGFmZmluaXR5Rm9jdXMgPSBpc0NvbGxhcHNlZCA/IGFmZmluaXR5QW5jaG9yIDogJ2JhY2t3YXJkJzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFmZmluaXR5QW5jaG9yID0gJ2JhY2t3YXJkJzsKICAgICAgICAgICAgYWZmaW5pdHlGb2N1cyA9IGlzQ29sbGFwc2VkID8gYWZmaW5pdHlBbmNob3IgOiAnZm9yd2FyZCc7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChhZmZpbml0eSA9PT0gJ291dHdhcmQnKSB7CiAgICAgICAgICBpZiAoUmFuZ2UuaXNGb3J3YXJkKHIpKSB7CiAgICAgICAgICAgIGFmZmluaXR5QW5jaG9yID0gJ2JhY2t3YXJkJzsKICAgICAgICAgICAgYWZmaW5pdHlGb2N1cyA9ICdmb3J3YXJkJzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFmZmluaXR5QW5jaG9yID0gJ2ZvcndhcmQnOwogICAgICAgICAgICBhZmZpbml0eUZvY3VzID0gJ2JhY2t3YXJkJzsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgYWZmaW5pdHlBbmNob3IgPSBhZmZpbml0eTsKICAgICAgICAgIGFmZmluaXR5Rm9jdXMgPSBhZmZpbml0eTsKICAgICAgICB9CgogICAgICAgIHZhciBhbmNob3IgPSBQb2ludC50cmFuc2Zvcm0oci5hbmNob3IsIG9wLCB7CiAgICAgICAgICBhZmZpbml0eTogYWZmaW5pdHlBbmNob3IKICAgICAgICB9KTsKICAgICAgICB2YXIgZm9jdXMgPSBQb2ludC50cmFuc2Zvcm0oci5mb2N1cywgb3AsIHsKICAgICAgICAgIGFmZmluaXR5OiBhZmZpbml0eUZvY3VzCiAgICAgICAgfSk7CgogICAgICAgIGlmICghYW5jaG9yIHx8ICFmb2N1cykgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICByLmFuY2hvciA9IGFuY2hvcjsKICAgICAgICByLmZvY3VzID0gZm9jdXM7CiAgICAgIH0pOwogICAgfQogIH07CgogIHZhciBSYW5nZVJlZiA9IHsKICAgIC8qKgogICAgICogVHJhbnNmb3JtIHRoZSByYW5nZSByZWYncyBjdXJyZW50IHZhbHVlIGJ5IGFuIG9wZXJhdGlvbi4KICAgICAqLwogICAgdHJhbnNmb3JtOiBmdW5jdGlvbiB0cmFuc2Zvcm0ocmVmLCBvcCkgewogICAgICB2YXIgY3VycmVudCA9IHJlZi5jdXJyZW50LAogICAgICAgICAgYWZmaW5pdHkgPSByZWYuYWZmaW5pdHk7CgogICAgICBpZiAoY3VycmVudCA9PSBudWxsKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgcGF0aCA9IFJhbmdlLnRyYW5zZm9ybShjdXJyZW50LCBvcCwgewogICAgICAgIGFmZmluaXR5OiBhZmZpbml0eQogICAgICB9KTsKICAgICAgcmVmLmN1cnJlbnQgPSBwYXRoOwoKICAgICAgaWYgKHBhdGggPT0gbnVsbCkgewogICAgICAgIHJlZi51bnJlZigpOwogICAgICB9CiAgICB9CiAgfTsKCiAgLyoKICAgIEN1c3RvbSBkZWVwIGVxdWFsIGNvbXBhcmlzb24gZm9yIFNsYXRlIG5vZGVzLgoKICAgIFdlIGRvbid0IG5lZWQgZ2VuZXJhbCBwdXJwb3NlIGRlZXAgZXF1YWxpdHk7CiAgICBTbGF0ZSBvbmx5IHN1cHBvcnRzIHBsYWluIHZhbHVlcywgQXJyYXlzLCBhbmQgbmVzdGVkIG9iamVjdHMuCiAgICBDb21wbGV4IHZhbHVlcyBuZXN0ZWQgaW5zaWRlIEFycmF5cyBhcmUgbm90IHN1cHBvcnRlZC4KCiAgICBTbGF0ZSBvYmplY3RzIGFyZSBkZXNpZ25lZCB0byBiZSBzZXJpYWxpc2VkLCBzbwogICAgbWlzc2luZyBrZXlzIGFyZSBkZWxpYmVyYXRlbHkgbm9ybWFsaXNlZCB0byB1bmRlZmluZWQuCiAgICovCgogIHZhciBpc0RlZXBFcXVhbCA9IGZ1bmN0aW9uIGlzRGVlcEVxdWFsKG5vZGUsIGFub3RoZXIpIHsKICAgIGZvciAodmFyIGtleSBpbiBub2RlKSB7CiAgICAgIHZhciBhID0gbm9kZVtrZXldOwogICAgICB2YXIgYiA9IGFub3RoZXJba2V5XTsKCiAgICAgIGlmIChpc1BsYWluT2JqZWN0LmlzUGxhaW5PYmplY3QoYSkgJiYgaXNQbGFpbk9iamVjdC5pc1BsYWluT2JqZWN0KGIpKSB7CiAgICAgICAgaWYgKCFpc0RlZXBFcXVhbChhLCBiKSkgcmV0dXJuIGZhbHNlOwogICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoYSkgJiYgQXJyYXkuaXNBcnJheShiKSkgewogICAgICAgIGlmIChhLmxlbmd0aCAhPT0gYi5sZW5ndGgpIHJldHVybiBmYWxzZTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAoYVtpXSAhPT0gYltpXSkgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChhICE9PSBiKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CiAgICAvKgogICAgICBEZWVwIG9iamVjdCBlcXVhbGl0eSBpcyBvbmx5IG5lY2Vzc2FyeSBpbiBvbmUgZGlyZWN0aW9uOyBpbiB0aGUgcmV2ZXJzZSBkaXJlY3Rpb24KICAgICAgd2UgYXJlIG9ubHkgbG9va2luZyBmb3Iga2V5cyB0aGF0IGFyZSBtaXNzaW5nLgogICAgICBBcyBhYm92ZSwgdW5kZWZpbmVkIGtleXMgYXJlIG5vcm1hbGlzZWQgdG8gbWlzc2luZy4KICAgICovCgoKICAgIGZvciAodmFyIF9rZXkgaW4gYW5vdGhlcikgewogICAgICBpZiAobm9kZVtfa2V5XSA9PT0gdW5kZWZpbmVkICYmIGFub3RoZXJbX2tleV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiB0cnVlOwogIH07CgogIHZhciBfZXhjbHVkZWQkMSA9IFsidGV4dCJdLAogICAgICBfZXhjbHVkZWQyJDEgPSBbImFuY2hvciIsICJmb2N1cyJdOwoKICBmdW5jdGlvbiBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciQzKG8sIGFsbG93QXJyYXlMaWtlKSB7IHZhciBpdCA9IHR5cGVvZiBTeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIG9bU3ltYm9sLml0ZXJhdG9yXSB8fCBvWyJAQGl0ZXJhdG9yIl07IGlmICghaXQpIHsgaWYgKEFycmF5LmlzQXJyYXkobykgfHwgKGl0ID0gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5JDMobykpIHx8IGFsbG93QXJyYXlMaWtlICYmIG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgeyBpZiAoaXQpIG8gPSBpdDsgdmFyIGkgPSAwOyB2YXIgRiA9IGZ1bmN0aW9uIEYoKSB7fTsgcmV0dXJuIHsgczogRiwgbjogZnVuY3Rpb24gbigpIHsgaWYgKGkgPj0gby5sZW5ndGgpIHJldHVybiB7IGRvbmU6IHRydWUgfTsgcmV0dXJuIHsgZG9uZTogZmFsc2UsIHZhbHVlOiBvW2krK10gfTsgfSwgZTogZnVuY3Rpb24gZShfZSkgeyB0aHJvdyBfZTsgfSwgZjogRiB9OyB9IHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBpdGVyYXRlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTsgfSB2YXIgbm9ybWFsQ29tcGxldGlvbiA9IHRydWUsIGRpZEVyciA9IGZhbHNlLCBlcnI7IHJldHVybiB7IHM6IGZ1bmN0aW9uIHMoKSB7IGl0ID0gaXQuY2FsbChvKTsgfSwgbjogZnVuY3Rpb24gbigpIHsgdmFyIHN0ZXAgPSBpdC5uZXh0KCk7IG5vcm1hbENvbXBsZXRpb24gPSBzdGVwLmRvbmU7IHJldHVybiBzdGVwOyB9LCBlOiBmdW5jdGlvbiBlKF9lMikgeyBkaWRFcnIgPSB0cnVlOyBlcnIgPSBfZTI7IH0sIGY6IGZ1bmN0aW9uIGYoKSB7IHRyeSB7IGlmICghbm9ybWFsQ29tcGxldGlvbiAmJiBpdFsicmV0dXJuIl0gIT0gbnVsbCkgaXRbInJldHVybiJdKCk7IH0gZmluYWxseSB7IGlmIChkaWRFcnIpIHRocm93IGVycjsgfSB9IH07IH0KCiAgZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5JDMobywgbWluTGVuKSB7IGlmICghbykgcmV0dXJuOyBpZiAodHlwZW9mIG8gPT09ICJzdHJpbmciKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkkMyhvLCBtaW5MZW4pOyB2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7IGlmIChuID09PSAiT2JqZWN0IiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lOyBpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pOyBpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheSQzKG8sIG1pbkxlbik7IH0KCiAgZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkkMyhhcnIsIGxlbikgeyBpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkgbGVuID0gYXJyLmxlbmd0aDsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSB7IGFycjJbaV0gPSBhcnJbaV07IH0gcmV0dXJuIGFycjI7IH0KCiAgZnVuY3Rpb24gb3duS2V5cyQ0KG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOyBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgeyB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsgaWYgKGVudW1lcmFibGVPbmx5KSB7IHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsgfSBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCiAgZnVuY3Rpb24gX29iamVjdFNwcmVhZCQ0KHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMkNChPYmplY3Qoc291cmNlKSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyBvd25LZXlzJDQoT2JqZWN0KHNvdXJjZSkpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsgfSk7IH0gfSByZXR1cm4gdGFyZ2V0OyB9CiAgdmFyIFRleHQgPSB7CiAgICAvKioKICAgICAqIENoZWNrIGlmIHR3byB0ZXh0IG5vZGVzIGFyZSBlcXVhbC4KICAgICAqCiAgICAgKiBXaGVuIGxvb3NlIGlzIHNldCwgdGhlIHRleHQgaXMgbm90IGNvbXBhcmVkLiBUaGlzIGlzCiAgICAgKiB1c2VkIHRvIGNoZWNrIHdoZXRoZXIgc2libGluZyB0ZXh0IG5vZGVzIGNhbiBiZSBtZXJnZWQuCiAgICAgKi8KICAgIGVxdWFsczogZnVuY3Rpb24gZXF1YWxzKHRleHQsIGFub3RoZXIpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IHt9OwogICAgICB2YXIgX29wdGlvbnMkbG9vc2UgPSBvcHRpb25zLmxvb3NlLAogICAgICAgICAgbG9vc2UgPSBfb3B0aW9ucyRsb29zZSA9PT0gdm9pZCAwID8gZmFsc2UgOiBfb3B0aW9ucyRsb29zZTsKCiAgICAgIGZ1bmN0aW9uIG9taXRUZXh0KG9iaikgewogICAgICAgIG9iai50ZXh0OwogICAgICAgICAgICB2YXIgcmVzdCA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllcyhvYmosIF9leGNsdWRlZCQxKTsKCiAgICAgICAgcmV0dXJuIHJlc3Q7CiAgICAgIH0KCiAgICAgIHJldHVybiBpc0RlZXBFcXVhbChsb29zZSA/IG9taXRUZXh0KHRleHQpIDogdGV4dCwgbG9vc2UgPyBvbWl0VGV4dChhbm90aGVyKSA6IGFub3RoZXIpOwogICAgfSwKCiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmFsdWUgaW1wbGVtZW50cyB0aGUgYFRleHRgIGludGVyZmFjZS4KICAgICAqLwogICAgaXNUZXh0OiBmdW5jdGlvbiBpc1RleHQodmFsdWUpIHsKICAgICAgcmV0dXJuIGlzUGxhaW5PYmplY3QuaXNQbGFpbk9iamVjdCh2YWx1ZSkgJiYgdHlwZW9mIHZhbHVlLnRleHQgPT09ICdzdHJpbmcnOwogICAgfSwKCiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmFsdWUgaXMgYSBsaXN0IG9mIGBUZXh0YCBvYmplY3RzLgogICAgICovCiAgICBpc1RleHRMaXN0OiBmdW5jdGlvbiBpc1RleHRMaXN0KHZhbHVlKSB7CiAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5ldmVyeShmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgcmV0dXJuIFRleHQuaXNUZXh0KHZhbCk7CiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIENoZWNrIGlmIHNvbWUgcHJvcHMgYXJlIGEgcGFydGlhbCBvZiBUZXh0LgogICAgICovCiAgICBpc1RleHRQcm9wczogZnVuY3Rpb24gaXNUZXh0UHJvcHMocHJvcHMpIHsKICAgICAgcmV0dXJuIHByb3BzLnRleHQgIT09IHVuZGVmaW5lZDsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhbiB0ZXh0IG1hdGNoZXMgc2V0IG9mIHByb3BlcnRpZXMuCiAgICAgKgogICAgICogTm90ZTogdGhpcyBpcyBmb3IgbWF0Y2hpbmcgY3VzdG9tIHByb3BlcnRpZXMsIGFuZCBpdCBkb2VzIG5vdCBlbnN1cmUgdGhhdAogICAgICogdGhlIGB0ZXh0YCBwcm9wZXJ0eSBhcmUgdHdvIG5vZGVzIGVxdWFsLgogICAgICovCiAgICBtYXRjaGVzOiBmdW5jdGlvbiBtYXRjaGVzKHRleHQsIHByb3BzKSB7CiAgICAgIGZvciAodmFyIGtleSBpbiBwcm9wcykgewogICAgICAgIGlmIChrZXkgPT09ICd0ZXh0JykgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXRleHQuaGFzT3duUHJvcGVydHkoa2V5KSB8fCB0ZXh0W2tleV0gIT09IHByb3BzW2tleV0pIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfSwKCiAgICAvKioKICAgICAqIEdldCB0aGUgbGVhdmVzIGZvciBhIHRleHQgbm9kZSBnaXZlbiBkZWNvcmF0aW9ucy4KICAgICAqLwogICAgZGVjb3JhdGlvbnM6IGZ1bmN0aW9uIGRlY29yYXRpb25zKG5vZGUsIF9kZWNvcmF0aW9ucykgewogICAgICB2YXIgbGVhdmVzID0gW19vYmplY3RTcHJlYWQkNCh7fSwgbm9kZSldOwoKICAgICAgdmFyIF9pdGVyYXRvciA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyJDMoX2RlY29yYXRpb25zKSwKICAgICAgICAgIF9zdGVwOwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvci5zKCk7ICEoX3N0ZXAgPSBfaXRlcmF0b3IubigpKS5kb25lOykgewogICAgICAgICAgdmFyIGRlYyA9IF9zdGVwLnZhbHVlOwoKICAgICAgICAgIHZhciBhbmNob3IgPSBkZWMuYW5jaG9yLAogICAgICAgICAgICAgIGZvY3VzID0gZGVjLmZvY3VzLAogICAgICAgICAgICAgIHJlc3QgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMoZGVjLCBfZXhjbHVkZWQyJDEpOwoKICAgICAgICAgIHZhciBfUmFuZ2UkZWRnZXMgPSBSYW5nZS5lZGdlcyhkZWMpLAogICAgICAgICAgICAgIF9SYW5nZSRlZGdlczIgPSBfc2xpY2VkVG9BcnJheShfUmFuZ2UkZWRnZXMsIDIpLAogICAgICAgICAgICAgIHN0YXJ0ID0gX1JhbmdlJGVkZ2VzMlswXSwKICAgICAgICAgICAgICBlbmQgPSBfUmFuZ2UkZWRnZXMyWzFdOwoKICAgICAgICAgIHZhciBuZXh0ID0gW107CiAgICAgICAgICB2YXIgbyA9IDA7CgogICAgICAgICAgdmFyIF9pdGVyYXRvcjIgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciQzKGxlYXZlcyksCiAgICAgICAgICAgICAgX3N0ZXAyOwoKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yMi5zKCk7ICEoX3N0ZXAyID0gX2l0ZXJhdG9yMi5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgICAgdmFyIGxlYWYgPSBfc3RlcDIudmFsdWU7CiAgICAgICAgICAgICAgdmFyIGxlbmd0aCA9IGxlYWYudGV4dC5sZW5ndGg7CiAgICAgICAgICAgICAgdmFyIG9mZnNldCA9IG87CiAgICAgICAgICAgICAgbyArPSBsZW5ndGg7IC8vIElmIHRoZSByYW5nZSBlbmNvbXBhc2VzIHRoZSBlbnRpcmUgbGVhZiwgYWRkIHRoZSByYW5nZS4KCiAgICAgICAgICAgICAgaWYgKHN0YXJ0Lm9mZnNldCA8PSBvZmZzZXQgJiYgZW5kLm9mZnNldCA+PSBvKSB7CiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGxlYWYsIHJlc3QpOwogICAgICAgICAgICAgICAgbmV4dC5wdXNoKGxlYWYpOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfSAvLyBJZiB0aGUgcmFuZ2UgZXhwYW5kZWQgYW5kIG1hdGNoIHRoZSBsZWFmLCBvciBzdGFydHMgYWZ0ZXIsIG9yIGVuZHMgYmVmb3JlIGl0LCBjb250aW51ZS4KCgogICAgICAgICAgICAgIGlmIChzdGFydC5vZmZzZXQgIT09IGVuZC5vZmZzZXQgJiYgKHN0YXJ0Lm9mZnNldCA9PT0gbyB8fCBlbmQub2Zmc2V0ID09PSBvZmZzZXQpIHx8IHN0YXJ0Lm9mZnNldCA+IG8gfHwgZW5kLm9mZnNldCA8IG9mZnNldCB8fCBlbmQub2Zmc2V0ID09PSBvZmZzZXQgJiYgb2Zmc2V0ICE9PSAwKSB7CiAgICAgICAgICAgICAgICBuZXh0LnB1c2gobGVhZik7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9IC8vIE90aGVyd2lzZSB3ZSBuZWVkIHRvIHNwbGl0IHRoZSBsZWFmLCBhdCB0aGUgc3RhcnQsIGVuZCwgb3IgYm90aCwKICAgICAgICAgICAgICAvLyBhbmQgYWRkIHRoZSByYW5nZSB0byB0aGUgbWlkZGxlIGludGVyc2VjdGluZyBzZWN0aW9uLiBEbyB0aGUgZW5kCiAgICAgICAgICAgICAgLy8gc3BsaXQgZmlyc3Qgc2luY2Ugd2UgZG9uJ3QgbmVlZCB0byB1cGRhdGUgdGhlIG9mZnNldCB0aGF0IHdheS4KCgogICAgICAgICAgICAgIHZhciBtaWRkbGUgPSBsZWFmOwogICAgICAgICAgICAgIHZhciBiZWZvcmUgPSB2b2lkIDA7CiAgICAgICAgICAgICAgdmFyIGFmdGVyID0gdm9pZCAwOwoKICAgICAgICAgICAgICBpZiAoZW5kLm9mZnNldCA8IG8pIHsKICAgICAgICAgICAgICAgIHZhciBvZmYgPSBlbmQub2Zmc2V0IC0gb2Zmc2V0OwogICAgICAgICAgICAgICAgYWZ0ZXIgPSBfb2JqZWN0U3ByZWFkJDQoX29iamVjdFNwcmVhZCQ0KHt9LCBtaWRkbGUpLCB7fSwgewogICAgICAgICAgICAgICAgICB0ZXh0OiBtaWRkbGUudGV4dC5zbGljZShvZmYpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIG1pZGRsZSA9IF9vYmplY3RTcHJlYWQkNChfb2JqZWN0U3ByZWFkJDQoe30sIG1pZGRsZSksIHt9LCB7CiAgICAgICAgICAgICAgICAgIHRleHQ6IG1pZGRsZS50ZXh0LnNsaWNlKDAsIG9mZikKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHN0YXJ0Lm9mZnNldCA+IG9mZnNldCkgewogICAgICAgICAgICAgICAgdmFyIF9vZmYgPSBzdGFydC5vZmZzZXQgLSBvZmZzZXQ7CgogICAgICAgICAgICAgICAgYmVmb3JlID0gX29iamVjdFNwcmVhZCQ0KF9vYmplY3RTcHJlYWQkNCh7fSwgbWlkZGxlKSwge30sIHsKICAgICAgICAgICAgICAgICAgdGV4dDogbWlkZGxlLnRleHQuc2xpY2UoMCwgX29mZikKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgbWlkZGxlID0gX29iamVjdFNwcmVhZCQ0KF9vYmplY3RTcHJlYWQkNCh7fSwgbWlkZGxlKSwge30sIHsKICAgICAgICAgICAgICAgICAgdGV4dDogbWlkZGxlLnRleHQuc2xpY2UoX29mZikKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihtaWRkbGUsIHJlc3QpOwoKICAgICAgICAgICAgICBpZiAoYmVmb3JlKSB7CiAgICAgICAgICAgICAgICBuZXh0LnB1c2goYmVmb3JlKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIG5leHQucHVzaChtaWRkbGUpOwoKICAgICAgICAgICAgICBpZiAoYWZ0ZXIpIHsKICAgICAgICAgICAgICAgIG5leHQucHVzaChhZnRlcik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgX2l0ZXJhdG9yMi5lKGVycik7CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBfaXRlcmF0b3IyLmYoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBsZWF2ZXMgPSBuZXh0OwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yLmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3IuZigpOwogICAgICB9CgogICAgICByZXR1cm4gbGVhdmVzOwogICAgfQogIH07CgogIGZ1bmN0aW9uIG93bktleXMkMyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgeyBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgeyByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsgfSk7IH0ga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgogIGZ1bmN0aW9uIF9vYmplY3RTcHJlYWQkMyh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307IGlmIChpICUgMikgeyBvd25LZXlzJDMoT2JqZWN0KHNvdXJjZSksIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyQzKE9iamVjdChzb3VyY2UpKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfQoKICBmdW5jdGlvbiBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciQyKG8sIGFsbG93QXJyYXlMaWtlKSB7IHZhciBpdCA9IHR5cGVvZiBTeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIG9bU3ltYm9sLml0ZXJhdG9yXSB8fCBvWyJAQGl0ZXJhdG9yIl07IGlmICghaXQpIHsgaWYgKEFycmF5LmlzQXJyYXkobykgfHwgKGl0ID0gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5JDIobykpIHx8IGFsbG93QXJyYXlMaWtlICYmIG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgeyBpZiAoaXQpIG8gPSBpdDsgdmFyIGkgPSAwOyB2YXIgRiA9IGZ1bmN0aW9uIEYoKSB7fTsgcmV0dXJuIHsgczogRiwgbjogZnVuY3Rpb24gbigpIHsgaWYgKGkgPj0gby5sZW5ndGgpIHJldHVybiB7IGRvbmU6IHRydWUgfTsgcmV0dXJuIHsgZG9uZTogZmFsc2UsIHZhbHVlOiBvW2krK10gfTsgfSwgZTogZnVuY3Rpb24gZShfZSkgeyB0aHJvdyBfZTsgfSwgZjogRiB9OyB9IHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBpdGVyYXRlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTsgfSB2YXIgbm9ybWFsQ29tcGxldGlvbiA9IHRydWUsIGRpZEVyciA9IGZhbHNlLCBlcnI7IHJldHVybiB7IHM6IGZ1bmN0aW9uIHMoKSB7IGl0ID0gaXQuY2FsbChvKTsgfSwgbjogZnVuY3Rpb24gbigpIHsgdmFyIHN0ZXAgPSBpdC5uZXh0KCk7IG5vcm1hbENvbXBsZXRpb24gPSBzdGVwLmRvbmU7IHJldHVybiBzdGVwOyB9LCBlOiBmdW5jdGlvbiBlKF9lMikgeyBkaWRFcnIgPSB0cnVlOyBlcnIgPSBfZTI7IH0sIGY6IGZ1bmN0aW9uIGYoKSB7IHRyeSB7IGlmICghbm9ybWFsQ29tcGxldGlvbiAmJiBpdFsicmV0dXJuIl0gIT0gbnVsbCkgaXRbInJldHVybiJdKCk7IH0gZmluYWxseSB7IGlmIChkaWRFcnIpIHRocm93IGVycjsgfSB9IH07IH0KCiAgZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5JDIobywgbWluTGVuKSB7IGlmICghbykgcmV0dXJuOyBpZiAodHlwZW9mIG8gPT09ICJzdHJpbmciKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkkMihvLCBtaW5MZW4pOyB2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7IGlmIChuID09PSAiT2JqZWN0IiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lOyBpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pOyBpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheSQyKG8sIG1pbkxlbik7IH0KCiAgZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkkMihhcnIsIGxlbikgeyBpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkgbGVuID0gYXJyLmxlbmd0aDsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSB7IGFycjJbaV0gPSBhcnJbaV07IH0gcmV0dXJuIGFycjI7IH0KCiAgdmFyIGFwcGx5VG9EcmFmdCA9IGZ1bmN0aW9uIGFwcGx5VG9EcmFmdChlZGl0b3IsIHNlbGVjdGlvbiwgb3ApIHsKICAgIHN3aXRjaCAob3AudHlwZSkgewogICAgICBjYXNlICdpbnNlcnRfbm9kZSc6CiAgICAgICAgewogICAgICAgICAgdmFyIHBhdGggPSBvcC5wYXRoLAogICAgICAgICAgICAgIG5vZGUgPSBvcC5ub2RlOwogICAgICAgICAgdmFyIHBhcmVudCA9IE5vZGUkMS5wYXJlbnQoZWRpdG9yLCBwYXRoKTsKICAgICAgICAgIHZhciBpbmRleCA9IHBhdGhbcGF0aC5sZW5ndGggLSAxXTsKCiAgICAgICAgICBpZiAoaW5kZXggPiBwYXJlbnQuY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2Fubm90IGFwcGx5IGFuIFwiaW5zZXJ0X25vZGVcIiBvcGVyYXRpb24gYXQgcGF0aCBbIi5jb25jYXQocGF0aCwgIl0gYmVjYXVzZSB0aGUgZGVzdGluYXRpb24gaXMgcGFzdCB0aGUgZW5kIG9mIHRoZSBub2RlLiIpKTsKICAgICAgICAgIH0KCiAgICAgICAgICBwYXJlbnQuY2hpbGRyZW4uc3BsaWNlKGluZGV4LCAwLCBub2RlKTsKCiAgICAgICAgICBpZiAoc2VsZWN0aW9uKSB7CiAgICAgICAgICAgIHZhciBfaXRlcmF0b3IgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciQyKFJhbmdlLnBvaW50cyhzZWxlY3Rpb24pKSwKICAgICAgICAgICAgICAgIF9zdGVwOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBmb3IgKF9pdGVyYXRvci5zKCk7ICEoX3N0ZXAgPSBfaXRlcmF0b3IubigpKS5kb25lOykgewogICAgICAgICAgICAgICAgdmFyIF9zdGVwJHZhbHVlID0gX3NsaWNlZFRvQXJyYXkoX3N0ZXAudmFsdWUsIDIpLAogICAgICAgICAgICAgICAgICAgIHBvaW50ID0gX3N0ZXAkdmFsdWVbMF0sCiAgICAgICAgICAgICAgICAgICAga2V5ID0gX3N0ZXAkdmFsdWVbMV07CgogICAgICAgICAgICAgICAgc2VsZWN0aW9uW2tleV0gPSBQb2ludC50cmFuc2Zvcm0ocG9pbnQsIG9wKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgIF9pdGVyYXRvci5lKGVycik7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yLmYoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ2luc2VydF90ZXh0JzoKICAgICAgICB7CiAgICAgICAgICB2YXIgX3BhdGggPSBvcC5wYXRoLAogICAgICAgICAgICAgIG9mZnNldCA9IG9wLm9mZnNldCwKICAgICAgICAgICAgICB0ZXh0ID0gb3AudGV4dDsKICAgICAgICAgIGlmICh0ZXh0Lmxlbmd0aCA9PT0gMCkgYnJlYWs7CgogICAgICAgICAgdmFyIF9ub2RlID0gTm9kZSQxLmxlYWYoZWRpdG9yLCBfcGF0aCk7CgogICAgICAgICAgdmFyIGJlZm9yZSA9IF9ub2RlLnRleHQuc2xpY2UoMCwgb2Zmc2V0KTsKCiAgICAgICAgICB2YXIgYWZ0ZXIgPSBfbm9kZS50ZXh0LnNsaWNlKG9mZnNldCk7CgogICAgICAgICAgX25vZGUudGV4dCA9IGJlZm9yZSArIHRleHQgKyBhZnRlcjsKCiAgICAgICAgICBpZiAoc2VsZWN0aW9uKSB7CiAgICAgICAgICAgIHZhciBfaXRlcmF0b3IyID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIkMihSYW5nZS5wb2ludHMoc2VsZWN0aW9uKSksCiAgICAgICAgICAgICAgICBfc3RlcDI7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yMi5zKCk7ICEoX3N0ZXAyID0gX2l0ZXJhdG9yMi5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgICAgICB2YXIgX3N0ZXAyJHZhbHVlID0gX3NsaWNlZFRvQXJyYXkoX3N0ZXAyLnZhbHVlLCAyKSwKICAgICAgICAgICAgICAgICAgICBfcG9pbnQgPSBfc3RlcDIkdmFsdWVbMF0sCiAgICAgICAgICAgICAgICAgICAgX2tleSA9IF9zdGVwMiR2YWx1ZVsxXTsKCiAgICAgICAgICAgICAgICBzZWxlY3Rpb25bX2tleV0gPSBQb2ludC50cmFuc2Zvcm0oX3BvaW50LCBvcCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICBfaXRlcmF0b3IyLmUoZXJyKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICBfaXRlcmF0b3IyLmYoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ21lcmdlX25vZGUnOgogICAgICAgIHsKICAgICAgICAgIHZhciBfcGF0aDIgPSBvcC5wYXRoOwoKICAgICAgICAgIHZhciBfbm9kZTIgPSBOb2RlJDEuZ2V0KGVkaXRvciwgX3BhdGgyKTsKCiAgICAgICAgICB2YXIgcHJldlBhdGggPSBQYXRoLnByZXZpb3VzKF9wYXRoMik7CiAgICAgICAgICB2YXIgcHJldiA9IE5vZGUkMS5nZXQoZWRpdG9yLCBwcmV2UGF0aCk7CgogICAgICAgICAgdmFyIF9wYXJlbnQgPSBOb2RlJDEucGFyZW50KGVkaXRvciwgX3BhdGgyKTsKCiAgICAgICAgICB2YXIgX2luZGV4ID0gX3BhdGgyW19wYXRoMi5sZW5ndGggLSAxXTsKCiAgICAgICAgICBpZiAoVGV4dC5pc1RleHQoX25vZGUyKSAmJiBUZXh0LmlzVGV4dChwcmV2KSkgewogICAgICAgICAgICBwcmV2LnRleHQgKz0gX25vZGUyLnRleHQ7CiAgICAgICAgICB9IGVsc2UgaWYgKCFUZXh0LmlzVGV4dChfbm9kZTIpICYmICFUZXh0LmlzVGV4dChwcmV2KSkgewogICAgICAgICAgICB2YXIgX3ByZXYkY2hpbGRyZW47CgogICAgICAgICAgICAoX3ByZXYkY2hpbGRyZW4gPSBwcmV2LmNoaWxkcmVuKS5wdXNoLmFwcGx5KF9wcmV2JGNoaWxkcmVuLCBfdG9Db25zdW1hYmxlQXJyYXkoX25vZGUyLmNoaWxkcmVuKSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBhcHBseSBhIFwibWVyZ2Vfbm9kZVwiIG9wZXJhdGlvbiBhdCBwYXRoIFsiLmNvbmNhdChfcGF0aDIsICJdIHRvIG5vZGVzIG9mIGRpZmZlcmVudCBpbnRlcmZhY2VzOiAiKS5jb25jYXQoX25vZGUyLCAiICIpLmNvbmNhdChwcmV2KSk7CiAgICAgICAgICB9CgogICAgICAgICAgX3BhcmVudC5jaGlsZHJlbi5zcGxpY2UoX2luZGV4LCAxKTsKCiAgICAgICAgICBpZiAoc2VsZWN0aW9uKSB7CiAgICAgICAgICAgIHZhciBfaXRlcmF0b3IzID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIkMihSYW5nZS5wb2ludHMoc2VsZWN0aW9uKSksCiAgICAgICAgICAgICAgICBfc3RlcDM7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yMy5zKCk7ICEoX3N0ZXAzID0gX2l0ZXJhdG9yMy5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgICAgICB2YXIgX3N0ZXAzJHZhbHVlID0gX3NsaWNlZFRvQXJyYXkoX3N0ZXAzLnZhbHVlLCAyKSwKICAgICAgICAgICAgICAgICAgICBfcG9pbnQyID0gX3N0ZXAzJHZhbHVlWzBdLAogICAgICAgICAgICAgICAgICAgIF9rZXkyID0gX3N0ZXAzJHZhbHVlWzFdOwoKICAgICAgICAgICAgICAgIHNlbGVjdGlvbltfa2V5Ml0gPSBQb2ludC50cmFuc2Zvcm0oX3BvaW50Miwgb3ApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yMy5lKGVycik7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yMy5mKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdtb3ZlX25vZGUnOgogICAgICAgIHsKICAgICAgICAgIHZhciBfcGF0aDMgPSBvcC5wYXRoLAogICAgICAgICAgICAgIG5ld1BhdGggPSBvcC5uZXdQYXRoOwoKICAgICAgICAgIGlmIChQYXRoLmlzQW5jZXN0b3IoX3BhdGgzLCBuZXdQYXRoKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBtb3ZlIGEgcGF0aCBbIi5jb25jYXQoX3BhdGgzLCAiXSB0byBuZXcgcGF0aCBbIikuY29uY2F0KG5ld1BhdGgsICJdIGJlY2F1c2UgdGhlIGRlc3RpbmF0aW9uIGlzIGluc2lkZSBpdHNlbGYuIikpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBfbm9kZTMgPSBOb2RlJDEuZ2V0KGVkaXRvciwgX3BhdGgzKTsKCiAgICAgICAgICB2YXIgX3BhcmVudDIgPSBOb2RlJDEucGFyZW50KGVkaXRvciwgX3BhdGgzKTsKCiAgICAgICAgICB2YXIgX2luZGV4MiA9IF9wYXRoM1tfcGF0aDMubGVuZ3RoIC0gMV07IC8vIFRoaXMgaXMgdHJpY2t5LCBidXQgc2luY2UgdGhlIGBwYXRoYCBhbmQgYG5ld1BhdGhgIGJvdGggcmVmZXIgdG8KICAgICAgICAgIC8vIHRoZSBzYW1lIHNuYXBzaG90IGluIHRpbWUsIHRoZXJlJ3MgYSBtaXNtYXRjaC4gQWZ0ZXIgZWl0aGVyCiAgICAgICAgICAvLyByZW1vdmluZyB0aGUgb3JpZ2luYWwgcG9zaXRpb24sIHRoZSBzZWNvbmQgc3RlcCdzIHBhdGggY2FuIGJlIG91dAogICAgICAgICAgLy8gb2YgZGF0ZS4gU28gaW5zdGVhZCBvZiB1c2luZyB0aGUgYG9wLm5ld1BhdGhgIGRpcmVjdGx5LCB3ZQogICAgICAgICAgLy8gdHJhbnNmb3JtIGBvcC5wYXRoYCB0byBhc2NlcnRhaW4gd2hhdCB0aGUgYG5ld1BhdGhgIHdvdWxkIGJlIGFmdGVyCiAgICAgICAgICAvLyB0aGUgb3BlcmF0aW9uIHdhcyBhcHBsaWVkLgoKICAgICAgICAgIF9wYXJlbnQyLmNoaWxkcmVuLnNwbGljZShfaW5kZXgyLCAxKTsKCiAgICAgICAgICB2YXIgdHJ1ZVBhdGggPSBQYXRoLnRyYW5zZm9ybShfcGF0aDMsIG9wKTsKICAgICAgICAgIHZhciBuZXdQYXJlbnQgPSBOb2RlJDEuZ2V0KGVkaXRvciwgUGF0aC5wYXJlbnQodHJ1ZVBhdGgpKTsKICAgICAgICAgIHZhciBuZXdJbmRleCA9IHRydWVQYXRoW3RydWVQYXRoLmxlbmd0aCAtIDFdOwogICAgICAgICAgbmV3UGFyZW50LmNoaWxkcmVuLnNwbGljZShuZXdJbmRleCwgMCwgX25vZGUzKTsKCiAgICAgICAgICBpZiAoc2VsZWN0aW9uKSB7CiAgICAgICAgICAgIHZhciBfaXRlcmF0b3I0ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIkMihSYW5nZS5wb2ludHMoc2VsZWN0aW9uKSksCiAgICAgICAgICAgICAgICBfc3RlcDQ7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yNC5zKCk7ICEoX3N0ZXA0ID0gX2l0ZXJhdG9yNC5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgICAgICB2YXIgX3N0ZXA0JHZhbHVlID0gX3NsaWNlZFRvQXJyYXkoX3N0ZXA0LnZhbHVlLCAyKSwKICAgICAgICAgICAgICAgICAgICBfcG9pbnQzID0gX3N0ZXA0JHZhbHVlWzBdLAogICAgICAgICAgICAgICAgICAgIF9rZXkzID0gX3N0ZXA0JHZhbHVlWzFdOwoKICAgICAgICAgICAgICAgIHNlbGVjdGlvbltfa2V5M10gPSBQb2ludC50cmFuc2Zvcm0oX3BvaW50Mywgb3ApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yNC5lKGVycik7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yNC5mKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdyZW1vdmVfbm9kZSc6CiAgICAgICAgewogICAgICAgICAgdmFyIF9wYXRoNCA9IG9wLnBhdGg7CiAgICAgICAgICB2YXIgX2luZGV4MyA9IF9wYXRoNFtfcGF0aDQubGVuZ3RoIC0gMV07CgogICAgICAgICAgdmFyIF9wYXJlbnQzID0gTm9kZSQxLnBhcmVudChlZGl0b3IsIF9wYXRoNCk7CgogICAgICAgICAgX3BhcmVudDMuY2hpbGRyZW4uc3BsaWNlKF9pbmRleDMsIDEpOyAvLyBUcmFuc2Zvcm0gYWxsIG9mIHRoZSBwb2ludHMgaW4gdGhlIHZhbHVlLCBidXQgaWYgdGhlIHBvaW50IHdhcyBpbiB0aGUKICAgICAgICAgIC8vIG5vZGUgdGhhdCB3YXMgcmVtb3ZlZCB3ZSBuZWVkIHRvIHVwZGF0ZSB0aGUgcmFuZ2Ugb3IgcmVtb3ZlIGl0LgoKCiAgICAgICAgICBpZiAoc2VsZWN0aW9uKSB7CiAgICAgICAgICAgIHZhciBfaXRlcmF0b3I1ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIkMihSYW5nZS5wb2ludHMoc2VsZWN0aW9uKSksCiAgICAgICAgICAgICAgICBfc3RlcDU7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yNS5zKCk7ICEoX3N0ZXA1ID0gX2l0ZXJhdG9yNS5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgICAgICB2YXIgX3N0ZXA1JHZhbHVlID0gX3NsaWNlZFRvQXJyYXkoX3N0ZXA1LnZhbHVlLCAyKSwKICAgICAgICAgICAgICAgICAgICBfcG9pbnQ0ID0gX3N0ZXA1JHZhbHVlWzBdLAogICAgICAgICAgICAgICAgICAgIF9rZXk0ID0gX3N0ZXA1JHZhbHVlWzFdOwoKICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBQb2ludC50cmFuc2Zvcm0oX3BvaW50NCwgb3ApOwoKICAgICAgICAgICAgICAgIGlmIChzZWxlY3Rpb24gIT0gbnVsbCAmJiByZXN1bHQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICBzZWxlY3Rpb25bX2tleTRdID0gcmVzdWx0OwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdmFyIF9wcmV2ID0gdm9pZCAwOwoKICAgICAgICAgICAgICAgICAgdmFyIG5leHQgPSB2b2lkIDA7CgogICAgICAgICAgICAgICAgICB2YXIgX2l0ZXJhdG9yNiA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyJDIoTm9kZSQxLnRleHRzKGVkaXRvcikpLAogICAgICAgICAgICAgICAgICAgICAgX3N0ZXA2OwoKICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBmb3IgKF9pdGVyYXRvcjYucygpOyAhKF9zdGVwNiA9IF9pdGVyYXRvcjYubigpKS5kb25lOykgewogICAgICAgICAgICAgICAgICAgICAgdmFyIF9zdGVwNiR2YWx1ZSA9IF9zbGljZWRUb0FycmF5KF9zdGVwNi52YWx1ZSwgMiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgbiA9IF9zdGVwNiR2YWx1ZVswXSwKICAgICAgICAgICAgICAgICAgICAgICAgICBwID0gX3N0ZXA2JHZhbHVlWzFdOwoKICAgICAgICAgICAgICAgICAgICAgIGlmIChQYXRoLmNvbXBhcmUocCwgX3BhdGg0KSA9PT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3ByZXYgPSBbbiwgcF07CiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBuZXh0ID0gW24sIHBdOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgIF9pdGVyYXRvcjYuZShlcnIpOwogICAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIF9pdGVyYXRvcjYuZigpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB2YXIgcHJlZmVyTmV4dCA9IGZhbHNlOwoKICAgICAgICAgICAgICAgICAgaWYgKF9wcmV2ICYmIG5leHQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoUGF0aC5lcXVhbHMobmV4dFsxXSwgX3BhdGg0KSkgewogICAgICAgICAgICAgICAgICAgICAgcHJlZmVyTmV4dCA9ICFQYXRoLmhhc1ByZXZpb3VzKG5leHRbMV0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICBwcmVmZXJOZXh0ID0gUGF0aC5jb21tb24oX3ByZXZbMV0sIF9wYXRoNCkubGVuZ3RoIDwgUGF0aC5jb21tb24obmV4dFsxXSwgX3BhdGg0KS5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBpZiAoX3ByZXYgJiYgIXByZWZlck5leHQpIHsKICAgICAgICAgICAgICAgICAgICBfcG9pbnQ0LnBhdGggPSBfcHJldlsxXTsKICAgICAgICAgICAgICAgICAgICBfcG9pbnQ0Lm9mZnNldCA9IF9wcmV2WzBdLnRleHQubGVuZ3RoOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5leHQpIHsKICAgICAgICAgICAgICAgICAgICBfcG9pbnQ0LnBhdGggPSBuZXh0WzFdOwogICAgICAgICAgICAgICAgICAgIF9wb2ludDQub2Zmc2V0ID0gMDsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzZWxlY3Rpb24gPSBudWxsOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICBfaXRlcmF0b3I1LmUoZXJyKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICBfaXRlcmF0b3I1LmYoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3JlbW92ZV90ZXh0JzoKICAgICAgICB7CiAgICAgICAgICB2YXIgX3BhdGg1ID0gb3AucGF0aCwKICAgICAgICAgICAgICBfb2Zmc2V0ID0gb3Aub2Zmc2V0LAogICAgICAgICAgICAgIF90ZXh0ID0gb3AudGV4dDsKICAgICAgICAgIGlmIChfdGV4dC5sZW5ndGggPT09IDApIGJyZWFrOwoKICAgICAgICAgIHZhciBfbm9kZTQgPSBOb2RlJDEubGVhZihlZGl0b3IsIF9wYXRoNSk7CgogICAgICAgICAgdmFyIF9iZWZvcmUgPSBfbm9kZTQudGV4dC5zbGljZSgwLCBfb2Zmc2V0KTsKCiAgICAgICAgICB2YXIgX2FmdGVyID0gX25vZGU0LnRleHQuc2xpY2UoX29mZnNldCArIF90ZXh0Lmxlbmd0aCk7CgogICAgICAgICAgX25vZGU0LnRleHQgPSBfYmVmb3JlICsgX2FmdGVyOwoKICAgICAgICAgIGlmIChzZWxlY3Rpb24pIHsKICAgICAgICAgICAgdmFyIF9pdGVyYXRvcjcgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciQyKFJhbmdlLnBvaW50cyhzZWxlY3Rpb24pKSwKICAgICAgICAgICAgICAgIF9zdGVwNzsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgZm9yIChfaXRlcmF0b3I3LnMoKTsgIShfc3RlcDcgPSBfaXRlcmF0b3I3Lm4oKSkuZG9uZTspIHsKICAgICAgICAgICAgICAgIHZhciBfc3RlcDckdmFsdWUgPSBfc2xpY2VkVG9BcnJheShfc3RlcDcudmFsdWUsIDIpLAogICAgICAgICAgICAgICAgICAgIF9wb2ludDUgPSBfc3RlcDckdmFsdWVbMF0sCiAgICAgICAgICAgICAgICAgICAgX2tleTUgPSBfc3RlcDckdmFsdWVbMV07CgogICAgICAgICAgICAgICAgc2VsZWN0aW9uW19rZXk1XSA9IFBvaW50LnRyYW5zZm9ybShfcG9pbnQ1LCBvcCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICBfaXRlcmF0b3I3LmUoZXJyKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICBfaXRlcmF0b3I3LmYoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3NldF9ub2RlJzoKICAgICAgICB7CiAgICAgICAgICB2YXIgX3BhdGg2ID0gb3AucGF0aCwKICAgICAgICAgICAgICBwcm9wZXJ0aWVzID0gb3AucHJvcGVydGllcywKICAgICAgICAgICAgICBuZXdQcm9wZXJ0aWVzID0gb3AubmV3UHJvcGVydGllczsKCiAgICAgICAgICBpZiAoX3BhdGg2Lmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBzZXQgcHJvcGVydGllcyBvbiB0aGUgcm9vdCBub2RlISIpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBfbm9kZTUgPSBOb2RlJDEuZ2V0KGVkaXRvciwgX3BhdGg2KTsKCiAgICAgICAgICBmb3IgKHZhciBfa2V5NiBpbiBuZXdQcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgIGlmIChfa2V5NiA9PT0gJ2NoaWxkcmVuJyB8fCBfa2V5NiA9PT0gJ3RleHQnKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW5ub3Qgc2V0IHRoZSBcIiIuY29uY2F0KF9rZXk2LCAiXCIgcHJvcGVydHkgb2Ygbm9kZXMhIikpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgdmFsdWUgPSBuZXdQcm9wZXJ0aWVzW19rZXk2XTsKCiAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgZGVsZXRlIF9ub2RlNVtfa2V5Nl07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgX25vZGU1W19rZXk2XSA9IHZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vIHByb3BlcnRpZXMgdGhhdCB3ZXJlIHByZXZpb3VzbHkgZGVmaW5lZCwgYnV0IGFyZSBub3cgbWlzc2luZywgbXVzdCBiZSBkZWxldGVkCgoKICAgICAgICAgIGZvciAodmFyIF9rZXk3IGluIHByb3BlcnRpZXMpIHsKICAgICAgICAgICAgaWYgKCFuZXdQcm9wZXJ0aWVzLmhhc093blByb3BlcnR5KF9rZXk3KSkgewogICAgICAgICAgICAgIGRlbGV0ZSBfbm9kZTVbX2tleTddOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc2V0X3NlbGVjdGlvbic6CiAgICAgICAgewogICAgICAgICAgdmFyIF9uZXdQcm9wZXJ0aWVzID0gb3AubmV3UHJvcGVydGllczsKCiAgICAgICAgICBpZiAoX25ld1Byb3BlcnRpZXMgPT0gbnVsbCkgewogICAgICAgICAgICBzZWxlY3Rpb24gPSBfbmV3UHJvcGVydGllczsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChzZWxlY3Rpb24gPT0gbnVsbCkgewogICAgICAgICAgICAgIGlmICghUmFuZ2UuaXNSYW5nZShfbmV3UHJvcGVydGllcykpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2Fubm90IGFwcGx5IGFuIGluY29tcGxldGUgXCJzZXRfc2VsZWN0aW9uXCIgb3BlcmF0aW9uIHByb3BlcnRpZXMgIi5jb25jYXQoSlNPTi5zdHJpbmdpZnkoX25ld1Byb3BlcnRpZXMpLCAiIHdoZW4gdGhlcmUgaXMgbm8gY3VycmVudCBzZWxlY3Rpb24uIikpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgc2VsZWN0aW9uID0gX29iamVjdFNwcmVhZCQzKHt9LCBfbmV3UHJvcGVydGllcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAodmFyIF9rZXk4IGluIF9uZXdQcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgICAgdmFyIF92YWx1ZSA9IF9uZXdQcm9wZXJ0aWVzW19rZXk4XTsKCiAgICAgICAgICAgICAgaWYgKF92YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoX2tleTggPT09ICdhbmNob3InIHx8IF9rZXk4ID09PSAnZm9jdXMnKSB7CiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2Fubm90IHJlbW92ZSB0aGUgXCIiLmNvbmNhdChfa2V5OCwgIlwiIHNlbGVjdGlvbiBwcm9wZXJ0eSIpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBkZWxldGUgc2VsZWN0aW9uW19rZXk4XTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc2VsZWN0aW9uW19rZXk4XSA9IF92YWx1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdzcGxpdF9ub2RlJzoKICAgICAgICB7CiAgICAgICAgICB2YXIgX3BhdGg3ID0gb3AucGF0aCwKICAgICAgICAgICAgICBwb3NpdGlvbiA9IG9wLnBvc2l0aW9uLAogICAgICAgICAgICAgIF9wcm9wZXJ0aWVzID0gb3AucHJvcGVydGllczsKCiAgICAgICAgICBpZiAoX3BhdGg3Lmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBhcHBseSBhIFwic3BsaXRfbm9kZVwiIG9wZXJhdGlvbiBhdCBwYXRoIFsiLmNvbmNhdChfcGF0aDcsICJdIGJlY2F1c2UgdGhlIHJvb3Qgbm9kZSBjYW5ub3QgYmUgc3BsaXQuIikpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBfbm9kZTYgPSBOb2RlJDEuZ2V0KGVkaXRvciwgX3BhdGg3KTsKCiAgICAgICAgICB2YXIgX3BhcmVudDQgPSBOb2RlJDEucGFyZW50KGVkaXRvciwgX3BhdGg3KTsKCiAgICAgICAgICB2YXIgX2luZGV4NCA9IF9wYXRoN1tfcGF0aDcubGVuZ3RoIC0gMV07CiAgICAgICAgICB2YXIgbmV3Tm9kZTsKCiAgICAgICAgICBpZiAoVGV4dC5pc1RleHQoX25vZGU2KSkgewogICAgICAgICAgICB2YXIgX2JlZm9yZTIgPSBfbm9kZTYudGV4dC5zbGljZSgwLCBwb3NpdGlvbik7CgogICAgICAgICAgICB2YXIgX2FmdGVyMiA9IF9ub2RlNi50ZXh0LnNsaWNlKHBvc2l0aW9uKTsKCiAgICAgICAgICAgIF9ub2RlNi50ZXh0ID0gX2JlZm9yZTI7CiAgICAgICAgICAgIG5ld05vZGUgPSBfb2JqZWN0U3ByZWFkJDMoX29iamVjdFNwcmVhZCQzKHt9LCBfcHJvcGVydGllcyksIHt9LCB7CiAgICAgICAgICAgICAgdGV4dDogX2FmdGVyMgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBfYmVmb3JlMyA9IF9ub2RlNi5jaGlsZHJlbi5zbGljZSgwLCBwb3NpdGlvbik7CgogICAgICAgICAgICB2YXIgX2FmdGVyMyA9IF9ub2RlNi5jaGlsZHJlbi5zbGljZShwb3NpdGlvbik7CgogICAgICAgICAgICBfbm9kZTYuY2hpbGRyZW4gPSBfYmVmb3JlMzsKICAgICAgICAgICAgbmV3Tm9kZSA9IF9vYmplY3RTcHJlYWQkMyhfb2JqZWN0U3ByZWFkJDMoe30sIF9wcm9wZXJ0aWVzKSwge30sIHsKICAgICAgICAgICAgICBjaGlsZHJlbjogX2FmdGVyMwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBfcGFyZW50NC5jaGlsZHJlbi5zcGxpY2UoX2luZGV4NCArIDEsIDAsIG5ld05vZGUpOwoKICAgICAgICAgIGlmIChzZWxlY3Rpb24pIHsKICAgICAgICAgICAgdmFyIF9pdGVyYXRvcjggPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciQyKFJhbmdlLnBvaW50cyhzZWxlY3Rpb24pKSwKICAgICAgICAgICAgICAgIF9zdGVwODsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgZm9yIChfaXRlcmF0b3I4LnMoKTsgIShfc3RlcDggPSBfaXRlcmF0b3I4Lm4oKSkuZG9uZTspIHsKICAgICAgICAgICAgICAgIHZhciBfc3RlcDgkdmFsdWUgPSBfc2xpY2VkVG9BcnJheShfc3RlcDgudmFsdWUsIDIpLAogICAgICAgICAgICAgICAgICAgIF9wb2ludDYgPSBfc3RlcDgkdmFsdWVbMF0sCiAgICAgICAgICAgICAgICAgICAgX2tleTkgPSBfc3RlcDgkdmFsdWVbMV07CgogICAgICAgICAgICAgICAgc2VsZWN0aW9uW19rZXk5XSA9IFBvaW50LnRyYW5zZm9ybShfcG9pbnQ2LCBvcCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICBfaXRlcmF0b3I4LmUoZXJyKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICBfaXRlcmF0b3I4LmYoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gc2VsZWN0aW9uOwogIH07CgogIHZhciBHZW5lcmFsVHJhbnNmb3JtcyA9IHsKICAgIC8qKgogICAgICogVHJhbnNmb3JtIHRoZSBlZGl0b3IgYnkgYW4gb3BlcmF0aW9uLgogICAgICovCiAgICB0cmFuc2Zvcm06IGZ1bmN0aW9uIHRyYW5zZm9ybShlZGl0b3IsIG9wKSB7CiAgICAgIGVkaXRvci5jaGlsZHJlbiA9IGltbWVyLmNyZWF0ZURyYWZ0KGVkaXRvci5jaGlsZHJlbik7CiAgICAgIHZhciBzZWxlY3Rpb24gPSBlZGl0b3Iuc2VsZWN0aW9uICYmIGltbWVyLmNyZWF0ZURyYWZ0KGVkaXRvci5zZWxlY3Rpb24pOwoKICAgICAgdHJ5IHsKICAgICAgICBzZWxlY3Rpb24gPSBhcHBseVRvRHJhZnQoZWRpdG9yLCBzZWxlY3Rpb24sIG9wKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBlZGl0b3IuY2hpbGRyZW4gPSBpbW1lci5maW5pc2hEcmFmdChlZGl0b3IuY2hpbGRyZW4pOwoKICAgICAgICBpZiAoc2VsZWN0aW9uKSB7CiAgICAgICAgICBlZGl0b3Iuc2VsZWN0aW9uID0gaW1tZXIuaXNEcmFmdChzZWxlY3Rpb24pID8gaW1tZXIuZmluaXNoRHJhZnQoc2VsZWN0aW9uKSA6IHNlbGVjdGlvbjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZWRpdG9yLnNlbGVjdGlvbiA9IG51bGw7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKCiAgdmFyIF9leGNsdWRlZCA9IFsidGV4dCJdLAogICAgICBfZXhjbHVkZWQyID0gWyJjaGlsZHJlbiJdOwoKICBmdW5jdGlvbiBvd25LZXlzJDIob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBpZiAoZW51bWVyYWJsZU9ubHkpIHsgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyB9IGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsgfSByZXR1cm4ga2V5czsgfQoKICBmdW5jdGlvbiBfb2JqZWN0U3ByZWFkJDIodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyQyKE9iamVjdChzb3VyY2UpLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7IH0pOyB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7IH0gZWxzZSB7IG93bktleXMkMihPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSB9IHJldHVybiB0YXJnZXQ7IH0KCiAgZnVuY3Rpb24gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIkMShvLCBhbGxvd0FycmF5TGlrZSkgeyB2YXIgaXQgPSB0eXBlb2YgU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl0gfHwgb1siQEBpdGVyYXRvciJdOyBpZiAoIWl0KSB7IGlmIChBcnJheS5pc0FycmF5KG8pIHx8IChpdCA9IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheSQxKG8pKSB8fCBhbGxvd0FycmF5TGlrZSAmJiBvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHsgaWYgKGl0KSBvID0gaXQ7IHZhciBpID0gMDsgdmFyIEYgPSBmdW5jdGlvbiBGKCkge307IHJldHVybiB7IHM6IEYsIG46IGZ1bmN0aW9uIG4oKSB7IGlmIChpID49IG8ubGVuZ3RoKSByZXR1cm4geyBkb25lOiB0cnVlIH07IHJldHVybiB7IGRvbmU6IGZhbHNlLCB2YWx1ZTogb1tpKytdIH07IH0sIGU6IGZ1bmN0aW9uIGUoX2UpIHsgdGhyb3cgX2U7IH0sIGY6IEYgfTsgfSB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gaXRlcmF0ZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7IH0gdmFyIG5vcm1hbENvbXBsZXRpb24gPSB0cnVlLCBkaWRFcnIgPSBmYWxzZSwgZXJyOyByZXR1cm4geyBzOiBmdW5jdGlvbiBzKCkgeyBpdCA9IGl0LmNhbGwobyk7IH0sIG46IGZ1bmN0aW9uIG4oKSB7IHZhciBzdGVwID0gaXQubmV4dCgpOyBub3JtYWxDb21wbGV0aW9uID0gc3RlcC5kb25lOyByZXR1cm4gc3RlcDsgfSwgZTogZnVuY3Rpb24gZShfZTIpIHsgZGlkRXJyID0gdHJ1ZTsgZXJyID0gX2UyOyB9LCBmOiBmdW5jdGlvbiBmKCkgeyB0cnkgeyBpZiAoIW5vcm1hbENvbXBsZXRpb24gJiYgaXRbInJldHVybiJdICE9IG51bGwpIGl0WyJyZXR1cm4iXSgpOyB9IGZpbmFsbHkgeyBpZiAoZGlkRXJyKSB0aHJvdyBlcnI7IH0gfSB9OyB9CgogIGZ1bmN0aW9uIF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheSQxKG8sIG1pbkxlbikgeyBpZiAoIW8pIHJldHVybjsgaWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5JDEobywgbWluTGVuKTsgdmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpOyBpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTsgaWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKSByZXR1cm4gQXJyYXkuZnJvbShvKTsgaWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkkMShvLCBtaW5MZW4pOyB9CgogIGZ1bmN0aW9uIF9hcnJheUxpa2VUb0FycmF5JDEoYXJyLCBsZW4pIHsgaWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykgeyBhcnIyW2ldID0gYXJyW2ldOyB9IHJldHVybiBhcnIyOyB9CiAgdmFyIE5vZGVUcmFuc2Zvcm1zID0gewogICAgLyoqCiAgICAgKiBJbnNlcnQgbm9kZXMgYXQgYSBzcGVjaWZpYyBsb2NhdGlvbiBpbiB0aGUgRWRpdG9yLgogICAgICovCiAgICBpbnNlcnROb2RlczogZnVuY3Rpb24gaW5zZXJ0Tm9kZXMoZWRpdG9yLCBub2RlcykgewogICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDoge307CiAgICAgIEVkaXRvci53aXRob3V0Tm9ybWFsaXppbmcoZWRpdG9yLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIF9vcHRpb25zJGhhbmdpbmcgPSBvcHRpb25zLmhhbmdpbmcsCiAgICAgICAgICAgIGhhbmdpbmcgPSBfb3B0aW9ucyRoYW5naW5nID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zJGhhbmdpbmcsCiAgICAgICAgICAgIF9vcHRpb25zJHZvaWRzID0gb3B0aW9ucy52b2lkcywKICAgICAgICAgICAgdm9pZHMgPSBfb3B0aW9ucyR2b2lkcyA9PT0gdm9pZCAwID8gZmFsc2UgOiBfb3B0aW9ucyR2b2lkcywKICAgICAgICAgICAgX29wdGlvbnMkbW9kZSA9IG9wdGlvbnMubW9kZSwKICAgICAgICAgICAgbW9kZSA9IF9vcHRpb25zJG1vZGUgPT09IHZvaWQgMCA/ICdsb3dlc3QnIDogX29wdGlvbnMkbW9kZTsKICAgICAgICB2YXIgYXQgPSBvcHRpb25zLmF0LAogICAgICAgICAgICBtYXRjaCA9IG9wdGlvbnMubWF0Y2gsCiAgICAgICAgICAgIHNlbGVjdCA9IG9wdGlvbnMuc2VsZWN0OwoKICAgICAgICBpZiAoTm9kZSQxLmlzTm9kZShub2RlcykpIHsKICAgICAgICAgIG5vZGVzID0gW25vZGVzXTsKICAgICAgICB9CgogICAgICAgIGlmIChub2Rlcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBfbm9kZXMgPSBub2RlcywKICAgICAgICAgICAgX25vZGVzMiA9IF9zbGljZWRUb0FycmF5KF9ub2RlcywgMSksCiAgICAgICAgICAgIG5vZGUgPSBfbm9kZXMyWzBdOyAvLyBCeSBkZWZhdWx0LCB1c2UgdGhlIHNlbGVjdGlvbiBhcyB0aGUgdGFyZ2V0IGxvY2F0aW9uLiBCdXQgaWYgdGhlcmUgaXMKICAgICAgICAvLyBubyBzZWxlY3Rpb24sIGluc2VydCBhdCB0aGUgZW5kIG9mIHRoZSBkb2N1bWVudCBzaW5jZSB0aGF0IGlzIHN1Y2ggYQogICAgICAgIC8vIGNvbW1vbiB1c2UgY2FzZSB3aGVuIGluc2VydGluZyBmcm9tIGEgbm9uLXNlbGVjdGVkIHN0YXRlLgoKCiAgICAgICAgaWYgKCFhdCkgewogICAgICAgICAgaWYgKGVkaXRvci5zZWxlY3Rpb24pIHsKICAgICAgICAgICAgYXQgPSBlZGl0b3Iuc2VsZWN0aW9uOwogICAgICAgICAgfSBlbHNlIGlmIChlZGl0b3IuY2hpbGRyZW4ubGVuZ3RoID4gMCkgewogICAgICAgICAgICBhdCA9IEVkaXRvci5lbmQoZWRpdG9yLCBbXSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhdCA9IFswXTsKICAgICAgICAgIH0KCiAgICAgICAgICBzZWxlY3QgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKHNlbGVjdCA9PSBudWxsKSB7CiAgICAgICAgICBzZWxlY3QgPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGlmIChSYW5nZS5pc1JhbmdlKGF0KSkgewogICAgICAgICAgaWYgKCFoYW5naW5nKSB7CiAgICAgICAgICAgIGF0ID0gRWRpdG9yLnVuaGFuZ1JhbmdlKGVkaXRvciwgYXQpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChSYW5nZS5pc0NvbGxhcHNlZChhdCkpIHsKICAgICAgICAgICAgYXQgPSBhdC5hbmNob3I7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgX1JhbmdlJGVkZ2VzID0gUmFuZ2UuZWRnZXMoYXQpLAogICAgICAgICAgICAgICAgX1JhbmdlJGVkZ2VzMiA9IF9zbGljZWRUb0FycmF5KF9SYW5nZSRlZGdlcywgMiksCiAgICAgICAgICAgICAgICBlbmQgPSBfUmFuZ2UkZWRnZXMyWzFdOwoKICAgICAgICAgICAgdmFyIHBvaW50UmVmID0gRWRpdG9yLnBvaW50UmVmKGVkaXRvciwgZW5kKTsKICAgICAgICAgICAgVHJhbnNmb3Jtc1siZGVsZXRlIl0oZWRpdG9yLCB7CiAgICAgICAgICAgICAgYXQ6IGF0CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhdCA9IHBvaW50UmVmLnVucmVmKCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoUG9pbnQuaXNQb2ludChhdCkpIHsKICAgICAgICAgIGlmIChtYXRjaCA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChUZXh0LmlzVGV4dChub2RlKSkgewogICAgICAgICAgICAgIG1hdGNoID0gZnVuY3Rpb24gbWF0Y2gobikgewogICAgICAgICAgICAgICAgcmV0dXJuIFRleHQuaXNUZXh0KG4pOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWRpdG9yLmlzSW5saW5lKG5vZGUpKSB7CiAgICAgICAgICAgICAgbWF0Y2ggPSBmdW5jdGlvbiBtYXRjaChuKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gVGV4dC5pc1RleHQobikgfHwgRWRpdG9yLmlzSW5saW5lKGVkaXRvciwgbik7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBtYXRjaCA9IGZ1bmN0aW9uIG1hdGNoKG4pIHsKICAgICAgICAgICAgICAgIHJldHVybiBFZGl0b3IuaXNCbG9jayhlZGl0b3IsIG4pOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgX0VkaXRvciRub2RlcyA9IEVkaXRvci5ub2RlcyhlZGl0b3IsIHsKICAgICAgICAgICAgYXQ6IGF0LnBhdGgsCiAgICAgICAgICAgIG1hdGNoOiBtYXRjaCwKICAgICAgICAgICAgbW9kZTogbW9kZSwKICAgICAgICAgICAgdm9pZHM6IHZvaWRzCiAgICAgICAgICB9KSwKICAgICAgICAgICAgICBfRWRpdG9yJG5vZGVzMiA9IF9zbGljZWRUb0FycmF5KF9FZGl0b3Ikbm9kZXMsIDEpLAogICAgICAgICAgICAgIGVudHJ5ID0gX0VkaXRvciRub2RlczJbMF07CgogICAgICAgICAgaWYgKGVudHJ5KSB7CiAgICAgICAgICAgIHZhciBfZW50cnkgPSBfc2xpY2VkVG9BcnJheShlbnRyeSwgMiksCiAgICAgICAgICAgICAgICBfbWF0Y2hQYXRoID0gX2VudHJ5WzFdOwoKICAgICAgICAgICAgdmFyIHBhdGhSZWYgPSBFZGl0b3IucGF0aFJlZihlZGl0b3IsIF9tYXRjaFBhdGgpOwogICAgICAgICAgICB2YXIgaXNBdEVuZCA9IEVkaXRvci5pc0VuZChlZGl0b3IsIGF0LCBfbWF0Y2hQYXRoKTsKICAgICAgICAgICAgVHJhbnNmb3Jtcy5zcGxpdE5vZGVzKGVkaXRvciwgewogICAgICAgICAgICAgIGF0OiBhdCwKICAgICAgICAgICAgICBtYXRjaDogbWF0Y2gsCiAgICAgICAgICAgICAgbW9kZTogbW9kZSwKICAgICAgICAgICAgICB2b2lkczogdm9pZHMKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBwYXRoID0gcGF0aFJlZi51bnJlZigpOwogICAgICAgICAgICBhdCA9IGlzQXRFbmQgPyBQYXRoLm5leHQocGF0aCkgOiBwYXRoOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIHBhcmVudFBhdGggPSBQYXRoLnBhcmVudChhdCk7CiAgICAgICAgdmFyIGluZGV4ID0gYXRbYXQubGVuZ3RoIC0gMV07CgogICAgICAgIGlmICghdm9pZHMgJiYgRWRpdG9yWyJ2b2lkIl0oZWRpdG9yLCB7CiAgICAgICAgICBhdDogcGFyZW50UGF0aAogICAgICAgIH0pKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIkMShub2RlcyksCiAgICAgICAgICAgIF9zdGVwOwoKICAgICAgICB0cnkgewogICAgICAgICAgZm9yIChfaXRlcmF0b3IucygpOyAhKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZTspIHsKICAgICAgICAgICAgdmFyIF9ub2RlID0gX3N0ZXAudmFsdWU7CgogICAgICAgICAgICB2YXIgX3BhdGggPSBwYXJlbnRQYXRoLmNvbmNhdChpbmRleCk7CgogICAgICAgICAgICBpbmRleCsrOwogICAgICAgICAgICBlZGl0b3IuYXBwbHkoewogICAgICAgICAgICAgIHR5cGU6ICdpbnNlcnRfbm9kZScsCiAgICAgICAgICAgICAgcGF0aDogX3BhdGgsCiAgICAgICAgICAgICAgbm9kZTogX25vZGUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGF0ID0gUGF0aC5uZXh0KGF0KTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgIF9pdGVyYXRvci5lKGVycik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIF9pdGVyYXRvci5mKCk7CiAgICAgICAgfQoKICAgICAgICBhdCA9IFBhdGgucHJldmlvdXMoYXQpOwoKICAgICAgICBpZiAoc2VsZWN0KSB7CiAgICAgICAgICB2YXIgcG9pbnQgPSBFZGl0b3IuZW5kKGVkaXRvciwgYXQpOwoKICAgICAgICAgIGlmIChwb2ludCkgewogICAgICAgICAgICBUcmFuc2Zvcm1zLnNlbGVjdChlZGl0b3IsIHBvaW50KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIExpZnQgbm9kZXMgYXQgYSBzcGVjaWZpYyBsb2NhdGlvbiB1cHdhcmRzIGluIHRoZSBkb2N1bWVudCB0cmVlLCBzcGxpdHRpbmcKICAgICAqIHRoZWlyIHBhcmVudCBpbiB0d28gaWYgbmVjZXNzYXJ5LgogICAgICovCiAgICBsaWZ0Tm9kZXM6IGZ1bmN0aW9uIGxpZnROb2RlcyhlZGl0b3IpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogICAgICBFZGl0b3Iud2l0aG91dE5vcm1hbGl6aW5nKGVkaXRvciwgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBfb3B0aW9ucyRhdCA9IG9wdGlvbnMuYXQsCiAgICAgICAgICAgIGF0ID0gX29wdGlvbnMkYXQgPT09IHZvaWQgMCA/IGVkaXRvci5zZWxlY3Rpb24gOiBfb3B0aW9ucyRhdCwKICAgICAgICAgICAgX29wdGlvbnMkbW9kZTIgPSBvcHRpb25zLm1vZGUsCiAgICAgICAgICAgIG1vZGUgPSBfb3B0aW9ucyRtb2RlMiA9PT0gdm9pZCAwID8gJ2xvd2VzdCcgOiBfb3B0aW9ucyRtb2RlMiwKICAgICAgICAgICAgX29wdGlvbnMkdm9pZHMyID0gb3B0aW9ucy52b2lkcywKICAgICAgICAgICAgdm9pZHMgPSBfb3B0aW9ucyR2b2lkczIgPT09IHZvaWQgMCA/IGZhbHNlIDogX29wdGlvbnMkdm9pZHMyOwogICAgICAgIHZhciBtYXRjaCA9IG9wdGlvbnMubWF0Y2g7CgogICAgICAgIGlmIChtYXRjaCA9PSBudWxsKSB7CiAgICAgICAgICBtYXRjaCA9IFBhdGguaXNQYXRoKGF0KSA/IG1hdGNoUGF0aChlZGl0b3IsIGF0KSA6IGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgIHJldHVybiBFZGl0b3IuaXNCbG9jayhlZGl0b3IsIG4pOwogICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIGlmICghYXQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBtYXRjaGVzID0gRWRpdG9yLm5vZGVzKGVkaXRvciwgewogICAgICAgICAgYXQ6IGF0LAogICAgICAgICAgbWF0Y2g6IG1hdGNoLAogICAgICAgICAgbW9kZTogbW9kZSwKICAgICAgICAgIHZvaWRzOiB2b2lkcwogICAgICAgIH0pOwogICAgICAgIHZhciBwYXRoUmVmcyA9IEFycmF5LmZyb20obWF0Y2hlcywgZnVuY3Rpb24gKF9yZWYpIHsKICAgICAgICAgIHZhciBfcmVmMiA9IF9zbGljZWRUb0FycmF5KF9yZWYsIDIpLAogICAgICAgICAgICAgIHAgPSBfcmVmMlsxXTsKCiAgICAgICAgICByZXR1cm4gRWRpdG9yLnBhdGhSZWYoZWRpdG9yLCBwKTsKICAgICAgICB9KTsKCiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfcGF0aFJlZnMgPSBwYXRoUmVmczsgX2kgPCBfcGF0aFJlZnMubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICB2YXIgcGF0aFJlZiA9IF9wYXRoUmVmc1tfaV07CiAgICAgICAgICB2YXIgcGF0aCA9IHBhdGhSZWYudW5yZWYoKTsKCiAgICAgICAgICBpZiAocGF0aC5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2Fubm90IGxpZnQgbm9kZSBhdCBhIHBhdGggWyIuY29uY2F0KHBhdGgsICJdIGJlY2F1c2UgaXQgaGFzIGEgZGVwdGggb2YgbGVzcyB0aGFuIGAyYC4iKSk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHBhcmVudE5vZGVFbnRyeSA9IEVkaXRvci5ub2RlKGVkaXRvciwgUGF0aC5wYXJlbnQocGF0aCkpOwoKICAgICAgICAgIHZhciBfcGFyZW50Tm9kZUVudHJ5ID0gX3NsaWNlZFRvQXJyYXkocGFyZW50Tm9kZUVudHJ5LCAyKSwKICAgICAgICAgICAgICBwYXJlbnQgPSBfcGFyZW50Tm9kZUVudHJ5WzBdLAogICAgICAgICAgICAgIHBhcmVudFBhdGggPSBfcGFyZW50Tm9kZUVudHJ5WzFdOwoKICAgICAgICAgIHZhciBpbmRleCA9IHBhdGhbcGF0aC5sZW5ndGggLSAxXTsKICAgICAgICAgIHZhciBsZW5ndGggPSBwYXJlbnQuY2hpbGRyZW4ubGVuZ3RoOwoKICAgICAgICAgIGlmIChsZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgdmFyIHRvUGF0aCA9IFBhdGgubmV4dChwYXJlbnRQYXRoKTsKICAgICAgICAgICAgVHJhbnNmb3Jtcy5tb3ZlTm9kZXMoZWRpdG9yLCB7CiAgICAgICAgICAgICAgYXQ6IHBhdGgsCiAgICAgICAgICAgICAgdG86IHRvUGF0aCwKICAgICAgICAgICAgICB2b2lkczogdm9pZHMKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIFRyYW5zZm9ybXMucmVtb3ZlTm9kZXMoZWRpdG9yLCB7CiAgICAgICAgICAgICAgYXQ6IHBhcmVudFBhdGgsCiAgICAgICAgICAgICAgdm9pZHM6IHZvaWRzCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChpbmRleCA9PT0gMCkgewogICAgICAgICAgICBUcmFuc2Zvcm1zLm1vdmVOb2RlcyhlZGl0b3IsIHsKICAgICAgICAgICAgICBhdDogcGF0aCwKICAgICAgICAgICAgICB0bzogcGFyZW50UGF0aCwKICAgICAgICAgICAgICB2b2lkczogdm9pZHMKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKGluZGV4ID09PSBsZW5ndGggLSAxKSB7CiAgICAgICAgICAgIHZhciBfdG9QYXRoID0gUGF0aC5uZXh0KHBhcmVudFBhdGgpOwoKICAgICAgICAgICAgVHJhbnNmb3Jtcy5tb3ZlTm9kZXMoZWRpdG9yLCB7CiAgICAgICAgICAgICAgYXQ6IHBhdGgsCiAgICAgICAgICAgICAgdG86IF90b1BhdGgsCiAgICAgICAgICAgICAgdm9pZHM6IHZvaWRzCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIHNwbGl0UGF0aCA9IFBhdGgubmV4dChwYXRoKTsKCiAgICAgICAgICAgIHZhciBfdG9QYXRoMiA9IFBhdGgubmV4dChwYXJlbnRQYXRoKTsKCiAgICAgICAgICAgIFRyYW5zZm9ybXMuc3BsaXROb2RlcyhlZGl0b3IsIHsKICAgICAgICAgICAgICBhdDogc3BsaXRQYXRoLAogICAgICAgICAgICAgIHZvaWRzOiB2b2lkcwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgVHJhbnNmb3Jtcy5tb3ZlTm9kZXMoZWRpdG9yLCB7CiAgICAgICAgICAgICAgYXQ6IHBhdGgsCiAgICAgICAgICAgICAgdG86IF90b1BhdGgyLAogICAgICAgICAgICAgIHZvaWRzOiB2b2lkcwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIE1lcmdlIGEgbm9kZSBhdCBhIGxvY2F0aW9uIHdpdGggdGhlIHByZXZpb3VzIG5vZGUgb2YgdGhlIHNhbWUgZGVwdGgsCiAgICAgKiByZW1vdmluZyBhbnkgZW1wdHkgY29udGFpbmluZyBub2RlcyBhZnRlciB0aGUgbWVyZ2UgaWYgbmVjZXNzYXJ5LgogICAgICovCiAgICBtZXJnZU5vZGVzOiBmdW5jdGlvbiBtZXJnZU5vZGVzKGVkaXRvcikgewogICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CiAgICAgIEVkaXRvci53aXRob3V0Tm9ybWFsaXppbmcoZWRpdG9yLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIG1hdGNoID0gb3B0aW9ucy5tYXRjaCwKICAgICAgICAgICAgX29wdGlvbnMkYXQyID0gb3B0aW9ucy5hdCwKICAgICAgICAgICAgYXQgPSBfb3B0aW9ucyRhdDIgPT09IHZvaWQgMCA/IGVkaXRvci5zZWxlY3Rpb24gOiBfb3B0aW9ucyRhdDI7CiAgICAgICAgdmFyIF9vcHRpb25zJGhhbmdpbmcyID0gb3B0aW9ucy5oYW5naW5nLAogICAgICAgICAgICBoYW5naW5nID0gX29wdGlvbnMkaGFuZ2luZzIgPT09IHZvaWQgMCA/IGZhbHNlIDogX29wdGlvbnMkaGFuZ2luZzIsCiAgICAgICAgICAgIF9vcHRpb25zJHZvaWRzMyA9IG9wdGlvbnMudm9pZHMsCiAgICAgICAgICAgIHZvaWRzID0gX29wdGlvbnMkdm9pZHMzID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zJHZvaWRzMywKICAgICAgICAgICAgX29wdGlvbnMkbW9kZTMgPSBvcHRpb25zLm1vZGUsCiAgICAgICAgICAgIG1vZGUgPSBfb3B0aW9ucyRtb2RlMyA9PT0gdm9pZCAwID8gJ2xvd2VzdCcgOiBfb3B0aW9ucyRtb2RlMzsKCiAgICAgICAgaWYgKCFhdCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKG1hdGNoID09IG51bGwpIHsKICAgICAgICAgIGlmIChQYXRoLmlzUGF0aChhdCkpIHsKICAgICAgICAgICAgdmFyIF9FZGl0b3IkcGFyZW50ID0gRWRpdG9yLnBhcmVudChlZGl0b3IsIGF0KSwKICAgICAgICAgICAgICAgIF9FZGl0b3IkcGFyZW50MiA9IF9zbGljZWRUb0FycmF5KF9FZGl0b3IkcGFyZW50LCAxKSwKICAgICAgICAgICAgICAgIHBhcmVudCA9IF9FZGl0b3IkcGFyZW50MlswXTsKCiAgICAgICAgICAgIG1hdGNoID0gZnVuY3Rpb24gbWF0Y2gobikgewogICAgICAgICAgICAgIHJldHVybiBwYXJlbnQuY2hpbGRyZW4uaW5jbHVkZXMobik7CiAgICAgICAgICAgIH07CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtYXRjaCA9IGZ1bmN0aW9uIG1hdGNoKG4pIHsKICAgICAgICAgICAgICByZXR1cm4gRWRpdG9yLmlzQmxvY2soZWRpdG9yLCBuKTsKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICghaGFuZ2luZyAmJiBSYW5nZS5pc1JhbmdlKGF0KSkgewogICAgICAgICAgYXQgPSBFZGl0b3IudW5oYW5nUmFuZ2UoZWRpdG9yLCBhdCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoUmFuZ2UuaXNSYW5nZShhdCkpIHsKICAgICAgICAgIGlmIChSYW5nZS5pc0NvbGxhcHNlZChhdCkpIHsKICAgICAgICAgICAgYXQgPSBhdC5hbmNob3I7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgX1JhbmdlJGVkZ2VzMyA9IFJhbmdlLmVkZ2VzKGF0KSwKICAgICAgICAgICAgICAgIF9SYW5nZSRlZGdlczQgPSBfc2xpY2VkVG9BcnJheShfUmFuZ2UkZWRnZXMzLCAyKSwKICAgICAgICAgICAgICAgIGVuZCA9IF9SYW5nZSRlZGdlczRbMV07CgogICAgICAgICAgICB2YXIgcG9pbnRSZWYgPSBFZGl0b3IucG9pbnRSZWYoZWRpdG9yLCBlbmQpOwogICAgICAgICAgICBUcmFuc2Zvcm1zWyJkZWxldGUiXShlZGl0b3IsIHsKICAgICAgICAgICAgICBhdDogYXQKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGF0ID0gcG9pbnRSZWYudW5yZWYoKTsKCiAgICAgICAgICAgIGlmIChvcHRpb25zLmF0ID09IG51bGwpIHsKICAgICAgICAgICAgICBUcmFuc2Zvcm1zLnNlbGVjdChlZGl0b3IsIGF0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIF9FZGl0b3Ikbm9kZXMzID0gRWRpdG9yLm5vZGVzKGVkaXRvciwgewogICAgICAgICAgYXQ6IGF0LAogICAgICAgICAgbWF0Y2g6IG1hdGNoLAogICAgICAgICAgdm9pZHM6IHZvaWRzLAogICAgICAgICAgbW9kZTogbW9kZQogICAgICAgIH0pLAogICAgICAgICAgICBfRWRpdG9yJG5vZGVzNCA9IF9zbGljZWRUb0FycmF5KF9FZGl0b3Ikbm9kZXMzLCAxKSwKICAgICAgICAgICAgY3VycmVudCA9IF9FZGl0b3Ikbm9kZXM0WzBdOwoKICAgICAgICB2YXIgcHJldiA9IEVkaXRvci5wcmV2aW91cyhlZGl0b3IsIHsKICAgICAgICAgIGF0OiBhdCwKICAgICAgICAgIG1hdGNoOiBtYXRjaCwKICAgICAgICAgIHZvaWRzOiB2b2lkcywKICAgICAgICAgIG1vZGU6IG1vZGUKICAgICAgICB9KTsKCiAgICAgICAgaWYgKCFjdXJyZW50IHx8ICFwcmV2KSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgX2N1cnJlbnQgPSBfc2xpY2VkVG9BcnJheShjdXJyZW50LCAyKSwKICAgICAgICAgICAgbm9kZSA9IF9jdXJyZW50WzBdLAogICAgICAgICAgICBwYXRoID0gX2N1cnJlbnRbMV07CgogICAgICAgIHZhciBfcHJldiA9IF9zbGljZWRUb0FycmF5KHByZXYsIDIpLAogICAgICAgICAgICBwcmV2Tm9kZSA9IF9wcmV2WzBdLAogICAgICAgICAgICBwcmV2UGF0aCA9IF9wcmV2WzFdOwoKICAgICAgICBpZiAocGF0aC5sZW5ndGggPT09IDAgfHwgcHJldlBhdGgubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgbmV3UGF0aCA9IFBhdGgubmV4dChwcmV2UGF0aCk7CiAgICAgICAgdmFyIGNvbW1vblBhdGggPSBQYXRoLmNvbW1vbihwYXRoLCBwcmV2UGF0aCk7CiAgICAgICAgdmFyIGlzUHJldmlvdXNTaWJsaW5nID0gUGF0aC5pc1NpYmxpbmcocGF0aCwgcHJldlBhdGgpOwogICAgICAgIHZhciBsZXZlbHMgPSBBcnJheS5mcm9tKEVkaXRvci5sZXZlbHMoZWRpdG9yLCB7CiAgICAgICAgICBhdDogcGF0aAogICAgICAgIH0pLCBmdW5jdGlvbiAoX3JlZjMpIHsKICAgICAgICAgIHZhciBfcmVmNCA9IF9zbGljZWRUb0FycmF5KF9yZWYzLCAxKSwKICAgICAgICAgICAgICBuID0gX3JlZjRbMF07CgogICAgICAgICAgcmV0dXJuIG47CiAgICAgICAgfSkuc2xpY2UoY29tbW9uUGF0aC5sZW5ndGgpLnNsaWNlKDAsIC0xKTsgLy8gRGV0ZXJtaW5lIGlmIHRoZSBtZXJnZSB3aWxsIGxlYXZlIGFuIGFuY2VzdG9yIG9mIHRoZSBwYXRoIGVtcHR5IGFzIGEKICAgICAgICAvLyByZXN1bHQsIGluIHdoaWNoIGNhc2Ugd2UnbGwgd2FudCB0byByZW1vdmUgaXQgYWZ0ZXIgbWVyZ2luZy4KCiAgICAgICAgdmFyIGVtcHR5QW5jZXN0b3IgPSBFZGl0b3IuYWJvdmUoZWRpdG9yLCB7CiAgICAgICAgICBhdDogcGF0aCwKICAgICAgICAgIG1vZGU6ICdoaWdoZXN0JywKICAgICAgICAgIG1hdGNoOiBmdW5jdGlvbiBtYXRjaChuKSB7CiAgICAgICAgICAgIHJldHVybiBsZXZlbHMuaW5jbHVkZXMobikgJiYgaGFzU2luZ2xlQ2hpbGROZXN0KGVkaXRvciwgbik7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgdmFyIGVtcHR5UmVmID0gZW1wdHlBbmNlc3RvciAmJiBFZGl0b3IucGF0aFJlZihlZGl0b3IsIGVtcHR5QW5jZXN0b3JbMV0pOwogICAgICAgIHZhciBwcm9wZXJ0aWVzOwogICAgICAgIHZhciBwb3NpdGlvbjsgLy8gRW5zdXJlIHRoYXQgdGhlIG5vZGVzIGFyZSBlcXVpdmFsZW50LCBhbmQgZmlndXJlIG91dCB3aGF0IHRoZSBwb3NpdGlvbgogICAgICAgIC8vIGFuZCBleHRyYSBwcm9wZXJ0aWVzIG9mIHRoZSBtZXJnZSB3aWxsIGJlLgoKICAgICAgICBpZiAoVGV4dC5pc1RleHQobm9kZSkgJiYgVGV4dC5pc1RleHQocHJldk5vZGUpKSB7CiAgICAgICAgICBub2RlLnRleHQ7CiAgICAgICAgICAgICAgdmFyIHJlc3QgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMobm9kZSwgX2V4Y2x1ZGVkKTsKCiAgICAgICAgICBwb3NpdGlvbiA9IHByZXZOb2RlLnRleHQubGVuZ3RoOwogICAgICAgICAgcHJvcGVydGllcyA9IHJlc3Q7CiAgICAgICAgfSBlbHNlIGlmIChFbGVtZW50JDEuaXNFbGVtZW50KG5vZGUpICYmIEVsZW1lbnQkMS5pc0VsZW1lbnQocHJldk5vZGUpKSB7CiAgICAgICAgICBub2RlLmNoaWxkcmVuOwogICAgICAgICAgICAgIHZhciBfcmVzdCA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllcyhub2RlLCBfZXhjbHVkZWQyKTsKCiAgICAgICAgICBwb3NpdGlvbiA9IHByZXZOb2RlLmNoaWxkcmVuLmxlbmd0aDsKICAgICAgICAgIHByb3BlcnRpZXMgPSBfcmVzdDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgbWVyZ2UgdGhlIG5vZGUgYXQgcGF0aCBbIi5jb25jYXQocGF0aCwgIl0gd2l0aCB0aGUgcHJldmlvdXMgc2libGluZyBiZWNhdXNlIGl0IGlzIG5vdCB0aGUgc2FtZSBraW5kOiAiKS5jb25jYXQoSlNPTi5zdHJpbmdpZnkobm9kZSksICIgIikuY29uY2F0KEpTT04uc3RyaW5naWZ5KHByZXZOb2RlKSkpOwogICAgICAgIH0gLy8gSWYgdGhlIG5vZGUgaXNuJ3QgYWxyZWFkeSB0aGUgbmV4dCBzaWJsaW5nIG9mIHRoZSBwcmV2aW91cyBub2RlLCBtb3ZlCiAgICAgICAgLy8gaXQgc28gdGhhdCBpdCBpcyBiZWZvcmUgbWVyZ2luZy4KCgogICAgICAgIGlmICghaXNQcmV2aW91c1NpYmxpbmcpIHsKICAgICAgICAgIFRyYW5zZm9ybXMubW92ZU5vZGVzKGVkaXRvciwgewogICAgICAgICAgICBhdDogcGF0aCwKICAgICAgICAgICAgdG86IG5ld1BhdGgsCiAgICAgICAgICAgIHZvaWRzOiB2b2lkcwogICAgICAgICAgfSk7CiAgICAgICAgfSAvLyBJZiB0aGVyZSB3YXMgZ29pbmcgdG8gYmUgYW4gZW1wdHkgYW5jZXN0b3Igb2YgdGhlIG5vZGUgdGhhdCB3YXMgbWVyZ2VkLAogICAgICAgIC8vIHdlIHJlbW92ZSBpdCBmcm9tIHRoZSB0cmVlLgoKCiAgICAgICAgaWYgKGVtcHR5UmVmKSB7CiAgICAgICAgICBUcmFuc2Zvcm1zLnJlbW92ZU5vZGVzKGVkaXRvciwgewogICAgICAgICAgICBhdDogZW1wdHlSZWYuY3VycmVudCwKICAgICAgICAgICAgdm9pZHM6IHZvaWRzCiAgICAgICAgICB9KTsKICAgICAgICB9IC8vIElmIHRoZSB0YXJnZXQgbm9kZSB0aGF0IHdlJ3JlIG1lcmdpbmcgd2l0aCBpcyBlbXB0eSwgcmVtb3ZlIGl0IGluc3RlYWQKICAgICAgICAvLyBvZiBtZXJnaW5nIHRoZSB0d28uIFRoaXMgaXMgYSBjb21tb24gcmljaCB0ZXh0IGVkaXRvciBiZWhhdmlvciB0bwogICAgICAgIC8vIHByZXZlbnQgbG9zaW5nIGZvcm1hdHRpbmcgd2hlbiBkZWxldGluZyBlbnRpcmUgbm9kZXMgd2hlbiB5b3UgaGF2ZSBhCiAgICAgICAgLy8gaGFuZ2luZyBzZWxlY3Rpb24uCiAgICAgICAgLy8gaWYgcHJldk5vZGUgaXMgZmlyc3QgY2hpbGQgaW4gcGFyZW50LGRvbid0IHJlbW92ZSBpdC4KCgogICAgICAgIGlmIChFbGVtZW50JDEuaXNFbGVtZW50KHByZXZOb2RlKSAmJiBFZGl0b3IuaXNFbXB0eShlZGl0b3IsIHByZXZOb2RlKSB8fCBUZXh0LmlzVGV4dChwcmV2Tm9kZSkgJiYgcHJldk5vZGUudGV4dCA9PT0gJycgJiYgcHJldlBhdGhbcHJldlBhdGgubGVuZ3RoIC0gMV0gIT09IDApIHsKICAgICAgICAgIFRyYW5zZm9ybXMucmVtb3ZlTm9kZXMoZWRpdG9yLCB7CiAgICAgICAgICAgIGF0OiBwcmV2UGF0aCwKICAgICAgICAgICAgdm9pZHM6IHZvaWRzCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZWRpdG9yLmFwcGx5KHsKICAgICAgICAgICAgdHlwZTogJ21lcmdlX25vZGUnLAogICAgICAgICAgICBwYXRoOiBuZXdQYXRoLAogICAgICAgICAgICBwb3NpdGlvbjogcG9zaXRpb24sCiAgICAgICAgICAgIHByb3BlcnRpZXM6IHByb3BlcnRpZXMKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKGVtcHR5UmVmKSB7CiAgICAgICAgICBlbXB0eVJlZi51bnJlZigpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAoKICAgIC8qKgogICAgICogTW92ZSB0aGUgbm9kZXMgYXQgYSBsb2NhdGlvbiB0byBhIG5ldyBsb2NhdGlvbi4KICAgICAqLwogICAgbW92ZU5vZGVzOiBmdW5jdGlvbiBtb3ZlTm9kZXMoZWRpdG9yLCBvcHRpb25zKSB7CiAgICAgIEVkaXRvci53aXRob3V0Tm9ybWFsaXppbmcoZWRpdG9yLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHRvID0gb3B0aW9ucy50bywKICAgICAgICAgICAgX29wdGlvbnMkYXQzID0gb3B0aW9ucy5hdCwKICAgICAgICAgICAgYXQgPSBfb3B0aW9ucyRhdDMgPT09IHZvaWQgMCA/IGVkaXRvci5zZWxlY3Rpb24gOiBfb3B0aW9ucyRhdDMsCiAgICAgICAgICAgIF9vcHRpb25zJG1vZGU0ID0gb3B0aW9ucy5tb2RlLAogICAgICAgICAgICBtb2RlID0gX29wdGlvbnMkbW9kZTQgPT09IHZvaWQgMCA/ICdsb3dlc3QnIDogX29wdGlvbnMkbW9kZTQsCiAgICAgICAgICAgIF9vcHRpb25zJHZvaWRzNCA9IG9wdGlvbnMudm9pZHMsCiAgICAgICAgICAgIHZvaWRzID0gX29wdGlvbnMkdm9pZHM0ID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zJHZvaWRzNDsKICAgICAgICB2YXIgbWF0Y2ggPSBvcHRpb25zLm1hdGNoOwoKICAgICAgICBpZiAoIWF0KSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAobWF0Y2ggPT0gbnVsbCkgewogICAgICAgICAgbWF0Y2ggPSBQYXRoLmlzUGF0aChhdCkgPyBtYXRjaFBhdGgoZWRpdG9yLCBhdCkgOiBmdW5jdGlvbiAobikgewogICAgICAgICAgICByZXR1cm4gRWRpdG9yLmlzQmxvY2soZWRpdG9yLCBuKTsKICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICB2YXIgdG9SZWYgPSBFZGl0b3IucGF0aFJlZihlZGl0b3IsIHRvKTsKICAgICAgICB2YXIgdGFyZ2V0cyA9IEVkaXRvci5ub2RlcyhlZGl0b3IsIHsKICAgICAgICAgIGF0OiBhdCwKICAgICAgICAgIG1hdGNoOiBtYXRjaCwKICAgICAgICAgIG1vZGU6IG1vZGUsCiAgICAgICAgICB2b2lkczogdm9pZHMKICAgICAgICB9KTsKICAgICAgICB2YXIgcGF0aFJlZnMgPSBBcnJheS5mcm9tKHRhcmdldHMsIGZ1bmN0aW9uIChfcmVmNSkgewogICAgICAgICAgdmFyIF9yZWY2ID0gX3NsaWNlZFRvQXJyYXkoX3JlZjUsIDIpLAogICAgICAgICAgICAgIHAgPSBfcmVmNlsxXTsKCiAgICAgICAgICByZXR1cm4gRWRpdG9yLnBhdGhSZWYoZWRpdG9yLCBwKTsKICAgICAgICB9KTsKCiAgICAgICAgZm9yICh2YXIgX2kyID0gMCwgX3BhdGhSZWZzMiA9IHBhdGhSZWZzOyBfaTIgPCBfcGF0aFJlZnMyLmxlbmd0aDsgX2kyKyspIHsKICAgICAgICAgIHZhciBwYXRoUmVmID0gX3BhdGhSZWZzMltfaTJdOwogICAgICAgICAgdmFyIHBhdGggPSBwYXRoUmVmLnVucmVmKCk7CiAgICAgICAgICB2YXIgbmV3UGF0aCA9IHRvUmVmLmN1cnJlbnQ7CgogICAgICAgICAgaWYgKHBhdGgubGVuZ3RoICE9PSAwKSB7CiAgICAgICAgICAgIGVkaXRvci5hcHBseSh7CiAgICAgICAgICAgICAgdHlwZTogJ21vdmVfbm9kZScsCiAgICAgICAgICAgICAgcGF0aDogcGF0aCwKICAgICAgICAgICAgICBuZXdQYXRoOiBuZXdQYXRoCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0b1JlZi5jdXJyZW50ICYmIFBhdGguaXNTaWJsaW5nKG5ld1BhdGgsIHBhdGgpICYmIFBhdGguaXNBZnRlcihuZXdQYXRoLCBwYXRoKSkgewogICAgICAgICAgICAvLyBXaGVuIHBlcmZvcm1pbmcgYSBzaWJsaW5nIG1vdmUgdG8gYSBsYXRlciBpbmRleCwgdGhlIHBhdGggYXQgdGhlIGRlc3RpbmF0aW9uIGlzIHNoaWZ0ZWQKICAgICAgICAgICAgLy8gdG8gYmVmb3JlIHRoZSBpbnNlcnRpb24gcG9pbnQgaW5zdGVhZCBvZiBhZnRlci4gVG8gZW5zdXJlIG91ciBncm91cCBvZiBub2RlcyBhcmUgaW5zZXJ0ZWQKICAgICAgICAgICAgLy8gaW4gdGhlIGNvcnJlY3Qgb3JkZXIgd2UgaW5jcmVtZW50IHRvUmVmIHRvIGFjY291bnQgZm9yIHRoYXQKICAgICAgICAgICAgdG9SZWYuY3VycmVudCA9IFBhdGgubmV4dCh0b1JlZi5jdXJyZW50KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRvUmVmLnVucmVmKCk7CiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIFJlbW92ZSB0aGUgbm9kZXMgYXQgYSBzcGVjaWZpYyBsb2NhdGlvbiBpbiB0aGUgZG9jdW1lbnQuCiAgICAgKi8KICAgIHJlbW92ZU5vZGVzOiBmdW5jdGlvbiByZW1vdmVOb2RlcyhlZGl0b3IpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogICAgICBFZGl0b3Iud2l0aG91dE5vcm1hbGl6aW5nKGVkaXRvciwgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBfb3B0aW9ucyRoYW5naW5nMyA9IG9wdGlvbnMuaGFuZ2luZywKICAgICAgICAgICAgaGFuZ2luZyA9IF9vcHRpb25zJGhhbmdpbmczID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zJGhhbmdpbmczLAogICAgICAgICAgICBfb3B0aW9ucyR2b2lkczUgPSBvcHRpb25zLnZvaWRzLAogICAgICAgICAgICB2b2lkcyA9IF9vcHRpb25zJHZvaWRzNSA9PT0gdm9pZCAwID8gZmFsc2UgOiBfb3B0aW9ucyR2b2lkczUsCiAgICAgICAgICAgIF9vcHRpb25zJG1vZGU1ID0gb3B0aW9ucy5tb2RlLAogICAgICAgICAgICBtb2RlID0gX29wdGlvbnMkbW9kZTUgPT09IHZvaWQgMCA/ICdsb3dlc3QnIDogX29wdGlvbnMkbW9kZTU7CiAgICAgICAgdmFyIF9vcHRpb25zJGF0NCA9IG9wdGlvbnMuYXQsCiAgICAgICAgICAgIGF0ID0gX29wdGlvbnMkYXQ0ID09PSB2b2lkIDAgPyBlZGl0b3Iuc2VsZWN0aW9uIDogX29wdGlvbnMkYXQ0LAogICAgICAgICAgICBtYXRjaCA9IG9wdGlvbnMubWF0Y2g7CgogICAgICAgIGlmICghYXQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChtYXRjaCA9PSBudWxsKSB7CiAgICAgICAgICBtYXRjaCA9IFBhdGguaXNQYXRoKGF0KSA/IG1hdGNoUGF0aChlZGl0b3IsIGF0KSA6IGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgIHJldHVybiBFZGl0b3IuaXNCbG9jayhlZGl0b3IsIG4pOwogICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIGlmICghaGFuZ2luZyAmJiBSYW5nZS5pc1JhbmdlKGF0KSkgewogICAgICAgICAgYXQgPSBFZGl0b3IudW5oYW5nUmFuZ2UoZWRpdG9yLCBhdCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgZGVwdGhzID0gRWRpdG9yLm5vZGVzKGVkaXRvciwgewogICAgICAgICAgYXQ6IGF0LAogICAgICAgICAgbWF0Y2g6IG1hdGNoLAogICAgICAgICAgbW9kZTogbW9kZSwKICAgICAgICAgIHZvaWRzOiB2b2lkcwogICAgICAgIH0pOwogICAgICAgIHZhciBwYXRoUmVmcyA9IEFycmF5LmZyb20oZGVwdGhzLCBmdW5jdGlvbiAoX3JlZjcpIHsKICAgICAgICAgIHZhciBfcmVmOCA9IF9zbGljZWRUb0FycmF5KF9yZWY3LCAyKSwKICAgICAgICAgICAgICBwID0gX3JlZjhbMV07CgogICAgICAgICAgcmV0dXJuIEVkaXRvci5wYXRoUmVmKGVkaXRvciwgcCk7CiAgICAgICAgfSk7CgogICAgICAgIGZvciAodmFyIF9pMyA9IDAsIF9wYXRoUmVmczMgPSBwYXRoUmVmczsgX2kzIDwgX3BhdGhSZWZzMy5sZW5ndGg7IF9pMysrKSB7CiAgICAgICAgICB2YXIgcGF0aFJlZiA9IF9wYXRoUmVmczNbX2kzXTsKICAgICAgICAgIHZhciBwYXRoID0gcGF0aFJlZi51bnJlZigpOwoKICAgICAgICAgIGlmIChwYXRoKSB7CiAgICAgICAgICAgIHZhciBfRWRpdG9yJG5vZGUgPSBFZGl0b3Iubm9kZShlZGl0b3IsIHBhdGgpLAogICAgICAgICAgICAgICAgX0VkaXRvciRub2RlMiA9IF9zbGljZWRUb0FycmF5KF9FZGl0b3Ikbm9kZSwgMSksCiAgICAgICAgICAgICAgICBub2RlID0gX0VkaXRvciRub2RlMlswXTsKCiAgICAgICAgICAgIGVkaXRvci5hcHBseSh7CiAgICAgICAgICAgICAgdHlwZTogJ3JlbW92ZV9ub2RlJywKICAgICAgICAgICAgICBwYXRoOiBwYXRoLAogICAgICAgICAgICAgIG5vZGU6IG5vZGUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBTZXQgbmV3IHByb3BlcnRpZXMgb24gdGhlIG5vZGVzIGF0IGEgbG9jYXRpb24uCiAgICAgKi8KICAgIHNldE5vZGVzOiBmdW5jdGlvbiBzZXROb2RlcyhlZGl0b3IsIHByb3BzKSB7CiAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiB7fTsKICAgICAgRWRpdG9yLndpdGhvdXROb3JtYWxpemluZyhlZGl0b3IsIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgbWF0Y2ggPSBvcHRpb25zLm1hdGNoLAogICAgICAgICAgICBfb3B0aW9ucyRhdDUgPSBvcHRpb25zLmF0LAogICAgICAgICAgICBhdCA9IF9vcHRpb25zJGF0NSA9PT0gdm9pZCAwID8gZWRpdG9yLnNlbGVjdGlvbiA6IF9vcHRpb25zJGF0NTsKICAgICAgICB2YXIgX29wdGlvbnMkaGFuZ2luZzQgPSBvcHRpb25zLmhhbmdpbmcsCiAgICAgICAgICAgIGhhbmdpbmcgPSBfb3B0aW9ucyRoYW5naW5nNCA9PT0gdm9pZCAwID8gZmFsc2UgOiBfb3B0aW9ucyRoYW5naW5nNCwKICAgICAgICAgICAgX29wdGlvbnMkbW9kZTYgPSBvcHRpb25zLm1vZGUsCiAgICAgICAgICAgIG1vZGUgPSBfb3B0aW9ucyRtb2RlNiA9PT0gdm9pZCAwID8gJ2xvd2VzdCcgOiBfb3B0aW9ucyRtb2RlNiwKICAgICAgICAgICAgX29wdGlvbnMkc3BsaXQgPSBvcHRpb25zLnNwbGl0LAogICAgICAgICAgICBzcGxpdCA9IF9vcHRpb25zJHNwbGl0ID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zJHNwbGl0LAogICAgICAgICAgICBfb3B0aW9ucyR2b2lkczYgPSBvcHRpb25zLnZvaWRzLAogICAgICAgICAgICB2b2lkcyA9IF9vcHRpb25zJHZvaWRzNiA9PT0gdm9pZCAwID8gZmFsc2UgOiBfb3B0aW9ucyR2b2lkczY7CgogICAgICAgIGlmICghYXQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChtYXRjaCA9PSBudWxsKSB7CiAgICAgICAgICBtYXRjaCA9IFBhdGguaXNQYXRoKGF0KSA/IG1hdGNoUGF0aChlZGl0b3IsIGF0KSA6IGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgIHJldHVybiBFZGl0b3IuaXNCbG9jayhlZGl0b3IsIG4pOwogICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIGlmICghaGFuZ2luZyAmJiBSYW5nZS5pc1JhbmdlKGF0KSkgewogICAgICAgICAgYXQgPSBFZGl0b3IudW5oYW5nUmFuZ2UoZWRpdG9yLCBhdCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoc3BsaXQgJiYgUmFuZ2UuaXNSYW5nZShhdCkpIHsKICAgICAgICAgIGlmIChSYW5nZS5pc0NvbGxhcHNlZChhdCkgJiYgRWRpdG9yLmxlYWYoZWRpdG9yLCBhdC5hbmNob3IpWzBdLnRleHQubGVuZ3RoID4gMCkgewogICAgICAgICAgICAvLyBJZiB0aGUgcmFuZ2UgaXMgY29sbGFwc2VkIGluIGEgbm9uLWVtcHR5IG5vZGUgYW5kICdzcGxpdCcgaXMgdHJ1ZSwgdGhlcmUncyBub3RoaW5nIHRvCiAgICAgICAgICAgIC8vIHNldCB0aGF0IHdvbid0IGdldCBub3JtYWxpemVkIGF3YXkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciByYW5nZVJlZiA9IEVkaXRvci5yYW5nZVJlZihlZGl0b3IsIGF0LCB7CiAgICAgICAgICAgIGFmZmluaXR5OiAnaW53YXJkJwogICAgICAgICAgfSk7CgogICAgICAgICAgdmFyIF9SYW5nZSRlZGdlczUgPSBSYW5nZS5lZGdlcyhhdCksCiAgICAgICAgICAgICAgX1JhbmdlJGVkZ2VzNiA9IF9zbGljZWRUb0FycmF5KF9SYW5nZSRlZGdlczUsIDIpLAogICAgICAgICAgICAgIHN0YXJ0ID0gX1JhbmdlJGVkZ2VzNlswXSwKICAgICAgICAgICAgICBlbmQgPSBfUmFuZ2UkZWRnZXM2WzFdOwoKICAgICAgICAgIHZhciBzcGxpdE1vZGUgPSBtb2RlID09PSAnbG93ZXN0JyA/ICdsb3dlc3QnIDogJ2hpZ2hlc3QnOwogICAgICAgICAgdmFyIGVuZEF0RW5kT2ZOb2RlID0gRWRpdG9yLmlzRW5kKGVkaXRvciwgZW5kLCBlbmQucGF0aCk7CiAgICAgICAgICBUcmFuc2Zvcm1zLnNwbGl0Tm9kZXMoZWRpdG9yLCB7CiAgICAgICAgICAgIGF0OiBlbmQsCiAgICAgICAgICAgIG1hdGNoOiBtYXRjaCwKICAgICAgICAgICAgbW9kZTogc3BsaXRNb2RlLAogICAgICAgICAgICB2b2lkczogdm9pZHMsCiAgICAgICAgICAgIGFsd2F5czogIWVuZEF0RW5kT2ZOb2RlCiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciBzdGFydEF0U3RhcnRPZk5vZGUgPSBFZGl0b3IuaXNTdGFydChlZGl0b3IsIHN0YXJ0LCBzdGFydC5wYXRoKTsKICAgICAgICAgIFRyYW5zZm9ybXMuc3BsaXROb2RlcyhlZGl0b3IsIHsKICAgICAgICAgICAgYXQ6IHN0YXJ0LAogICAgICAgICAgICBtYXRjaDogbWF0Y2gsCiAgICAgICAgICAgIG1vZGU6IHNwbGl0TW9kZSwKICAgICAgICAgICAgdm9pZHM6IHZvaWRzLAogICAgICAgICAgICBhbHdheXM6ICFzdGFydEF0U3RhcnRPZk5vZGUKICAgICAgICAgIH0pOwogICAgICAgICAgYXQgPSByYW5nZVJlZi51bnJlZigpOwoKICAgICAgICAgIGlmIChvcHRpb25zLmF0ID09IG51bGwpIHsKICAgICAgICAgICAgVHJhbnNmb3Jtcy5zZWxlY3QoZWRpdG9yLCBhdCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgX2l0ZXJhdG9yMiA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyJDEoRWRpdG9yLm5vZGVzKGVkaXRvciwgewogICAgICAgICAgYXQ6IGF0LAogICAgICAgICAgbWF0Y2g6IG1hdGNoLAogICAgICAgICAgbW9kZTogbW9kZSwKICAgICAgICAgIHZvaWRzOiB2b2lkcwogICAgICAgIH0pKSwKICAgICAgICAgICAgX3N0ZXAyOwoKICAgICAgICB0cnkgewogICAgICAgICAgZm9yIChfaXRlcmF0b3IyLnMoKTsgIShfc3RlcDIgPSBfaXRlcmF0b3IyLm4oKSkuZG9uZTspIHsKICAgICAgICAgICAgdmFyIF9zdGVwMiR2YWx1ZSA9IF9zbGljZWRUb0FycmF5KF9zdGVwMi52YWx1ZSwgMiksCiAgICAgICAgICAgICAgICBub2RlID0gX3N0ZXAyJHZhbHVlWzBdLAogICAgICAgICAgICAgICAgcGF0aCA9IF9zdGVwMiR2YWx1ZVsxXTsKCiAgICAgICAgICAgIHZhciBwcm9wZXJ0aWVzID0ge307CiAgICAgICAgICAgIHZhciBuZXdQcm9wZXJ0aWVzID0ge307IC8vIFlvdSBjYW4ndCBzZXQgcHJvcGVydGllcyBvbiB0aGUgZWRpdG9yIG5vZGUuCgogICAgICAgICAgICBpZiAocGF0aC5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGhhc0NoYW5nZXMgPSBmYWxzZTsKCiAgICAgICAgICAgIGZvciAodmFyIGsgaW4gcHJvcHMpIHsKICAgICAgICAgICAgICBpZiAoayA9PT0gJ2NoaWxkcmVuJyB8fCBrID09PSAndGV4dCcpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHByb3BzW2tdICE9PSBub2RlW2tdKSB7CiAgICAgICAgICAgICAgICBoYXNDaGFuZ2VzID0gdHJ1ZTsgLy8gT21pdCBuZXcgcHJvcGVydGllcyBmcm9tIHRoZSBvbGQgcHJvcGVydGllcyBsaXN0CgogICAgICAgICAgICAgICAgaWYgKG5vZGUuaGFzT3duUHJvcGVydHkoaykpIHByb3BlcnRpZXNba10gPSBub2RlW2tdOyAvLyBPbWl0IHByb3BlcnRpZXMgdGhhdCBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSBuZXcgcHJvcGVydGllcyBsaXN0CgogICAgICAgICAgICAgICAgaWYgKHByb3BzW2tdICE9IG51bGwpIG5ld1Byb3BlcnRpZXNba10gPSBwcm9wc1trXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChoYXNDaGFuZ2VzKSB7CiAgICAgICAgICAgICAgZWRpdG9yLmFwcGx5KHsKICAgICAgICAgICAgICAgIHR5cGU6ICdzZXRfbm9kZScsCiAgICAgICAgICAgICAgICBwYXRoOiBwYXRoLAogICAgICAgICAgICAgICAgcHJvcGVydGllczogcHJvcGVydGllcywKICAgICAgICAgICAgICAgIG5ld1Byb3BlcnRpZXM6IG5ld1Byb3BlcnRpZXMKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgX2l0ZXJhdG9yMi5lKGVycik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIF9pdGVyYXRvcjIuZigpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAoKICAgIC8qKgogICAgICogU3BsaXQgdGhlIG5vZGVzIGF0IGEgc3BlY2lmaWMgbG9jYXRpb24uCiAgICAgKi8KICAgIHNwbGl0Tm9kZXM6IGZ1bmN0aW9uIHNwbGl0Tm9kZXMoZWRpdG9yKSB7CiAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsKICAgICAgRWRpdG9yLndpdGhvdXROb3JtYWxpemluZyhlZGl0b3IsIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgX29wdGlvbnMkbW9kZTcgPSBvcHRpb25zLm1vZGUsCiAgICAgICAgICAgIG1vZGUgPSBfb3B0aW9ucyRtb2RlNyA9PT0gdm9pZCAwID8gJ2xvd2VzdCcgOiBfb3B0aW9ucyRtb2RlNywKICAgICAgICAgICAgX29wdGlvbnMkdm9pZHM3ID0gb3B0aW9ucy52b2lkcywKICAgICAgICAgICAgdm9pZHMgPSBfb3B0aW9ucyR2b2lkczcgPT09IHZvaWQgMCA/IGZhbHNlIDogX29wdGlvbnMkdm9pZHM3OwogICAgICAgIHZhciBtYXRjaCA9IG9wdGlvbnMubWF0Y2gsCiAgICAgICAgICAgIF9vcHRpb25zJGF0NiA9IG9wdGlvbnMuYXQsCiAgICAgICAgICAgIGF0ID0gX29wdGlvbnMkYXQ2ID09PSB2b2lkIDAgPyBlZGl0b3Iuc2VsZWN0aW9uIDogX29wdGlvbnMkYXQ2LAogICAgICAgICAgICBfb3B0aW9ucyRoZWlnaHQgPSBvcHRpb25zLmhlaWdodCwKICAgICAgICAgICAgaGVpZ2h0ID0gX29wdGlvbnMkaGVpZ2h0ID09PSB2b2lkIDAgPyAwIDogX29wdGlvbnMkaGVpZ2h0LAogICAgICAgICAgICBfb3B0aW9ucyRhbHdheXMgPSBvcHRpb25zLmFsd2F5cywKICAgICAgICAgICAgYWx3YXlzID0gX29wdGlvbnMkYWx3YXlzID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zJGFsd2F5czsKCiAgICAgICAgaWYgKG1hdGNoID09IG51bGwpIHsKICAgICAgICAgIG1hdGNoID0gZnVuY3Rpb24gbWF0Y2gobikgewogICAgICAgICAgICByZXR1cm4gRWRpdG9yLmlzQmxvY2soZWRpdG9yLCBuKTsKICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICBpZiAoUmFuZ2UuaXNSYW5nZShhdCkpIHsKICAgICAgICAgIGF0ID0gZGVsZXRlUmFuZ2UoZWRpdG9yLCBhdCk7CiAgICAgICAgfSAvLyBJZiB0aGUgdGFyZ2V0IGlzIGEgcGF0aCwgdGhlIGRlZmF1bHQgaGVpZ2h0LXNraXBwaW5nIGFuZCBwb3NpdGlvbgogICAgICAgIC8vIGNvdW50ZXJzIG5lZWQgdG8gYWNjb3VudCBmb3IgdXMgcG90ZW50aWFsbHkgc3BsaXR0aW5nIGF0IGEgbm9uLWxlYWYuCgoKICAgICAgICBpZiAoUGF0aC5pc1BhdGgoYXQpKSB7CiAgICAgICAgICB2YXIgcGF0aCA9IGF0OwogICAgICAgICAgdmFyIHBvaW50ID0gRWRpdG9yLnBvaW50KGVkaXRvciwgcGF0aCk7CgogICAgICAgICAgdmFyIF9FZGl0b3IkcGFyZW50MyA9IEVkaXRvci5wYXJlbnQoZWRpdG9yLCBwYXRoKSwKICAgICAgICAgICAgICBfRWRpdG9yJHBhcmVudDQgPSBfc2xpY2VkVG9BcnJheShfRWRpdG9yJHBhcmVudDMsIDEpLAogICAgICAgICAgICAgIHBhcmVudCA9IF9FZGl0b3IkcGFyZW50NFswXTsKCiAgICAgICAgICBtYXRjaCA9IGZ1bmN0aW9uIG1hdGNoKG4pIHsKICAgICAgICAgICAgcmV0dXJuIG4gPT09IHBhcmVudDsKICAgICAgICAgIH07CgogICAgICAgICAgaGVpZ2h0ID0gcG9pbnQucGF0aC5sZW5ndGggLSBwYXRoLmxlbmd0aCArIDE7CiAgICAgICAgICBhdCA9IHBvaW50OwogICAgICAgICAgYWx3YXlzID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGlmICghYXQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBiZWZvcmVSZWYgPSBFZGl0b3IucG9pbnRSZWYoZWRpdG9yLCBhdCwgewogICAgICAgICAgYWZmaW5pdHk6ICdiYWNrd2FyZCcKICAgICAgICB9KTsKCiAgICAgICAgdmFyIF9FZGl0b3Ikbm9kZXM1ID0gRWRpdG9yLm5vZGVzKGVkaXRvciwgewogICAgICAgICAgYXQ6IGF0LAogICAgICAgICAgbWF0Y2g6IG1hdGNoLAogICAgICAgICAgbW9kZTogbW9kZSwKICAgICAgICAgIHZvaWRzOiB2b2lkcwogICAgICAgIH0pLAogICAgICAgICAgICBfRWRpdG9yJG5vZGVzNiA9IF9zbGljZWRUb0FycmF5KF9FZGl0b3Ikbm9kZXM1LCAxKSwKICAgICAgICAgICAgaGlnaGVzdCA9IF9FZGl0b3Ikbm9kZXM2WzBdOwoKICAgICAgICBpZiAoIWhpZ2hlc3QpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciB2b2lkTWF0Y2ggPSBFZGl0b3JbInZvaWQiXShlZGl0b3IsIHsKICAgICAgICAgIGF0OiBhdCwKICAgICAgICAgIG1vZGU6ICdoaWdoZXN0JwogICAgICAgIH0pOwogICAgICAgIHZhciBudWRnZSA9IDA7CgogICAgICAgIGlmICghdm9pZHMgJiYgdm9pZE1hdGNoKSB7CiAgICAgICAgICB2YXIgX3ZvaWRNYXRjaCA9IF9zbGljZWRUb0FycmF5KHZvaWRNYXRjaCwgMiksCiAgICAgICAgICAgICAgdm9pZE5vZGUgPSBfdm9pZE1hdGNoWzBdLAogICAgICAgICAgICAgIHZvaWRQYXRoID0gX3ZvaWRNYXRjaFsxXTsKCiAgICAgICAgICBpZiAoRWxlbWVudCQxLmlzRWxlbWVudCh2b2lkTm9kZSkgJiYgZWRpdG9yLmlzSW5saW5lKHZvaWROb2RlKSkgewogICAgICAgICAgICB2YXIgYWZ0ZXIgPSBFZGl0b3IuYWZ0ZXIoZWRpdG9yLCB2b2lkUGF0aCk7CgogICAgICAgICAgICBpZiAoIWFmdGVyKSB7CiAgICAgICAgICAgICAgdmFyIHRleHQgPSB7CiAgICAgICAgICAgICAgICB0ZXh0OiAnJwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgdmFyIGFmdGVyUGF0aCA9IFBhdGgubmV4dCh2b2lkUGF0aCk7CiAgICAgICAgICAgICAgVHJhbnNmb3Jtcy5pbnNlcnROb2RlcyhlZGl0b3IsIHRleHQsIHsKICAgICAgICAgICAgICAgIGF0OiBhZnRlclBhdGgsCiAgICAgICAgICAgICAgICB2b2lkczogdm9pZHMKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBhZnRlciA9IEVkaXRvci5wb2ludChlZGl0b3IsIGFmdGVyUGF0aCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGF0ID0gYWZ0ZXI7CiAgICAgICAgICAgIGFsd2F5cyA9IHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHNpYmxpbmdIZWlnaHQgPSBhdC5wYXRoLmxlbmd0aCAtIHZvaWRQYXRoLmxlbmd0aDsKICAgICAgICAgIGhlaWdodCA9IHNpYmxpbmdIZWlnaHQgKyAxOwogICAgICAgICAgYWx3YXlzID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHZhciBhZnRlclJlZiA9IEVkaXRvci5wb2ludFJlZihlZGl0b3IsIGF0KTsKICAgICAgICB2YXIgZGVwdGggPSBhdC5wYXRoLmxlbmd0aCAtIGhlaWdodDsKCiAgICAgICAgdmFyIF9oaWdoZXN0ID0gX3NsaWNlZFRvQXJyYXkoaGlnaGVzdCwgMiksCiAgICAgICAgICAgIGhpZ2hlc3RQYXRoID0gX2hpZ2hlc3RbMV07CgogICAgICAgIHZhciBsb3dlc3RQYXRoID0gYXQucGF0aC5zbGljZSgwLCBkZXB0aCk7CiAgICAgICAgdmFyIHBvc2l0aW9uID0gaGVpZ2h0ID09PSAwID8gYXQub2Zmc2V0IDogYXQucGF0aFtkZXB0aF0gKyBudWRnZTsKCiAgICAgICAgdmFyIF9pdGVyYXRvcjMgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciQxKEVkaXRvci5sZXZlbHMoZWRpdG9yLCB7CiAgICAgICAgICBhdDogbG93ZXN0UGF0aCwKICAgICAgICAgIHJldmVyc2U6IHRydWUsCiAgICAgICAgICB2b2lkczogdm9pZHMKICAgICAgICB9KSksCiAgICAgICAgICAgIF9zdGVwMzsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGZvciAoX2l0ZXJhdG9yMy5zKCk7ICEoX3N0ZXAzID0gX2l0ZXJhdG9yMy5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgIHZhciBfc3RlcDMkdmFsdWUgPSBfc2xpY2VkVG9BcnJheShfc3RlcDMudmFsdWUsIDIpLAogICAgICAgICAgICAgICAgbm9kZSA9IF9zdGVwMyR2YWx1ZVswXSwKICAgICAgICAgICAgICAgIF9wYXRoMiA9IF9zdGVwMyR2YWx1ZVsxXTsKCiAgICAgICAgICAgIHZhciBzcGxpdCA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKF9wYXRoMi5sZW5ndGggPCBoaWdoZXN0UGF0aC5sZW5ndGggfHwgX3BhdGgyLmxlbmd0aCA9PT0gMCB8fCAhdm9pZHMgJiYgRWRpdG9yLmlzVm9pZChlZGl0b3IsIG5vZGUpKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBfcG9pbnQyID0gYmVmb3JlUmVmLmN1cnJlbnQ7CiAgICAgICAgICAgIHZhciBpc0VuZCA9IEVkaXRvci5pc0VuZChlZGl0b3IsIF9wb2ludDIsIF9wYXRoMik7CgogICAgICAgICAgICBpZiAoYWx3YXlzIHx8ICFiZWZvcmVSZWYgfHwgIUVkaXRvci5pc0VkZ2UoZWRpdG9yLCBfcG9pbnQyLCBfcGF0aDIpKSB7CiAgICAgICAgICAgICAgc3BsaXQgPSB0cnVlOwogICAgICAgICAgICAgIHZhciBwcm9wZXJ0aWVzID0gTm9kZSQxLmV4dHJhY3RQcm9wcyhub2RlKTsKICAgICAgICAgICAgICBlZGl0b3IuYXBwbHkoewogICAgICAgICAgICAgICAgdHlwZTogJ3NwbGl0X25vZGUnLAogICAgICAgICAgICAgICAgcGF0aDogX3BhdGgyLAogICAgICAgICAgICAgICAgcG9zaXRpb246IHBvc2l0aW9uLAogICAgICAgICAgICAgICAgcHJvcGVydGllczogcHJvcGVydGllcwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwb3NpdGlvbiA9IF9wYXRoMltfcGF0aDIubGVuZ3RoIC0gMV0gKyAoc3BsaXQgfHwgaXNFbmQgPyAxIDogMCk7CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICBfaXRlcmF0b3IzLmUoZXJyKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgX2l0ZXJhdG9yMy5mKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAob3B0aW9ucy5hdCA9PSBudWxsKSB7CiAgICAgICAgICB2YXIgX3BvaW50ID0gYWZ0ZXJSZWYuY3VycmVudCB8fCBFZGl0b3IuZW5kKGVkaXRvciwgW10pOwoKICAgICAgICAgIFRyYW5zZm9ybXMuc2VsZWN0KGVkaXRvciwgX3BvaW50KTsKICAgICAgICB9CgogICAgICAgIGJlZm9yZVJlZi51bnJlZigpOwogICAgICAgIGFmdGVyUmVmLnVucmVmKCk7CiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIFVuc2V0IHByb3BlcnRpZXMgb24gdGhlIG5vZGVzIGF0IGEgbG9jYXRpb24uCiAgICAgKi8KICAgIHVuc2V0Tm9kZXM6IGZ1bmN0aW9uIHVuc2V0Tm9kZXMoZWRpdG9yLCBwcm9wcykgewogICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDoge307CgogICAgICBpZiAoIUFycmF5LmlzQXJyYXkocHJvcHMpKSB7CiAgICAgICAgcHJvcHMgPSBbcHJvcHNdOwogICAgICB9CgogICAgICB2YXIgb2JqID0ge307CgogICAgICB2YXIgX2l0ZXJhdG9yNCA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyJDEocHJvcHMpLAogICAgICAgICAgX3N0ZXA0OwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvcjQucygpOyAhKF9zdGVwNCA9IF9pdGVyYXRvcjQubigpKS5kb25lOykgewogICAgICAgICAgdmFyIGtleSA9IF9zdGVwNC52YWx1ZTsKICAgICAgICAgIG9ialtrZXldID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvcjQuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvcjQuZigpOwogICAgICB9CgogICAgICBUcmFuc2Zvcm1zLnNldE5vZGVzKGVkaXRvciwgb2JqLCBvcHRpb25zKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBVbndyYXAgdGhlIG5vZGVzIGF0IGEgbG9jYXRpb24gZnJvbSBhIHBhcmVudCBub2RlLCBzcGxpdHRpbmcgdGhlIHBhcmVudCBpZgogICAgICogbmVjZXNzYXJ5IHRvIGVuc3VyZSB0aGF0IG9ubHkgdGhlIGNvbnRlbnQgaW4gdGhlIHJhbmdlIGlzIHVud3JhcHBlZC4KICAgICAqLwogICAgdW53cmFwTm9kZXM6IGZ1bmN0aW9uIHVud3JhcE5vZGVzKGVkaXRvcikgewogICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CiAgICAgIEVkaXRvci53aXRob3V0Tm9ybWFsaXppbmcoZWRpdG9yLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIF9vcHRpb25zJG1vZGU4ID0gb3B0aW9ucy5tb2RlLAogICAgICAgICAgICBtb2RlID0gX29wdGlvbnMkbW9kZTggPT09IHZvaWQgMCA/ICdsb3dlc3QnIDogX29wdGlvbnMkbW9kZTgsCiAgICAgICAgICAgIF9vcHRpb25zJHNwbGl0MiA9IG9wdGlvbnMuc3BsaXQsCiAgICAgICAgICAgIHNwbGl0ID0gX29wdGlvbnMkc3BsaXQyID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zJHNwbGl0MiwKICAgICAgICAgICAgX29wdGlvbnMkdm9pZHM4ID0gb3B0aW9ucy52b2lkcywKICAgICAgICAgICAgdm9pZHMgPSBfb3B0aW9ucyR2b2lkczggPT09IHZvaWQgMCA/IGZhbHNlIDogX29wdGlvbnMkdm9pZHM4OwogICAgICAgIHZhciBfb3B0aW9ucyRhdDcgPSBvcHRpb25zLmF0LAogICAgICAgICAgICBhdCA9IF9vcHRpb25zJGF0NyA9PT0gdm9pZCAwID8gZWRpdG9yLnNlbGVjdGlvbiA6IF9vcHRpb25zJGF0NywKICAgICAgICAgICAgbWF0Y2ggPSBvcHRpb25zLm1hdGNoOwoKICAgICAgICBpZiAoIWF0KSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAobWF0Y2ggPT0gbnVsbCkgewogICAgICAgICAgbWF0Y2ggPSBQYXRoLmlzUGF0aChhdCkgPyBtYXRjaFBhdGgoZWRpdG9yLCBhdCkgOiBmdW5jdGlvbiAobikgewogICAgICAgICAgICByZXR1cm4gRWRpdG9yLmlzQmxvY2soZWRpdG9yLCBuKTsKICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICBpZiAoUGF0aC5pc1BhdGgoYXQpKSB7CiAgICAgICAgICBhdCA9IEVkaXRvci5yYW5nZShlZGl0b3IsIGF0KTsKICAgICAgICB9CgogICAgICAgIHZhciByYW5nZVJlZiA9IFJhbmdlLmlzUmFuZ2UoYXQpID8gRWRpdG9yLnJhbmdlUmVmKGVkaXRvciwgYXQpIDogbnVsbDsKICAgICAgICB2YXIgbWF0Y2hlcyA9IEVkaXRvci5ub2RlcyhlZGl0b3IsIHsKICAgICAgICAgIGF0OiBhdCwKICAgICAgICAgIG1hdGNoOiBtYXRjaCwKICAgICAgICAgIG1vZGU6IG1vZGUsCiAgICAgICAgICB2b2lkczogdm9pZHMKICAgICAgICB9KTsKICAgICAgICB2YXIgcGF0aFJlZnMgPSBBcnJheS5mcm9tKG1hdGNoZXMsIGZ1bmN0aW9uIChfcmVmOSkgewogICAgICAgICAgdmFyIF9yZWYxMCA9IF9zbGljZWRUb0FycmF5KF9yZWY5LCAyKSwKICAgICAgICAgICAgICBwID0gX3JlZjEwWzFdOwoKICAgICAgICAgIHJldHVybiBFZGl0b3IucGF0aFJlZihlZGl0b3IsIHApOwogICAgICAgIH0gLy8gdW53cmFwTm9kZSB3aWxsIGNhbGwgbGlmdE5vZGUgd2hpY2ggZG9lcyBub3Qgc3VwcG9ydCBzcGxpdHRpbmcgdGhlIG5vZGUgd2hlbiBuZXN0ZWQuCiAgICAgICAgLy8gSWYgd2UgZG8gbm90IHJldmVyc2UgdGhlIG9yZGVyIGFuZCBjYWxsIGl0IGZyb20gdG9wIHRvIHRoZSBib3R0b20sIGl0IHdpbGwgcmVtb3ZlIGFsbCBibG9ja3MKICAgICAgICAvLyB0aGF0IHdyYXAgdGFyZ2V0IG5vZGUuIFNvIHdlIHJldmVyc2UgdGhlIG9yZGVyLgogICAgICAgICkucmV2ZXJzZSgpOwoKICAgICAgICB2YXIgX2l0ZXJhdG9yNSA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyJDEocGF0aFJlZnMpLAogICAgICAgICAgICBfc3RlcDU7CgogICAgICAgIHRyeSB7CiAgICAgICAgICB2YXIgX2xvb3AgPSBmdW5jdGlvbiBfbG9vcCgpIHsKICAgICAgICAgICAgdmFyIHBhdGhSZWYgPSBfc3RlcDUudmFsdWU7CiAgICAgICAgICAgIHZhciBwYXRoID0gcGF0aFJlZi51bnJlZigpOwoKICAgICAgICAgICAgdmFyIF9FZGl0b3Ikbm9kZTMgPSBFZGl0b3Iubm9kZShlZGl0b3IsIHBhdGgpLAogICAgICAgICAgICAgICAgX0VkaXRvciRub2RlNCA9IF9zbGljZWRUb0FycmF5KF9FZGl0b3Ikbm9kZTMsIDEpLAogICAgICAgICAgICAgICAgbm9kZSA9IF9FZGl0b3Ikbm9kZTRbMF07CgogICAgICAgICAgICB2YXIgcmFuZ2UgPSBFZGl0b3IucmFuZ2UoZWRpdG9yLCBwYXRoKTsKCiAgICAgICAgICAgIGlmIChzcGxpdCAmJiByYW5nZVJlZikgewogICAgICAgICAgICAgIHJhbmdlID0gUmFuZ2UuaW50ZXJzZWN0aW9uKHJhbmdlUmVmLmN1cnJlbnQsIHJhbmdlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgVHJhbnNmb3Jtcy5saWZ0Tm9kZXMoZWRpdG9yLCB7CiAgICAgICAgICAgICAgYXQ6IHJhbmdlLAogICAgICAgICAgICAgIG1hdGNoOiBmdW5jdGlvbiBtYXRjaChuKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gRWxlbWVudCQxLmlzQW5jZXN0b3Iobm9kZSkgJiYgbm9kZS5jaGlsZHJlbi5pbmNsdWRlcyhuKTsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHZvaWRzOiB2b2lkcwogICAgICAgICAgICB9KTsKICAgICAgICAgIH07CgogICAgICAgICAgZm9yIChfaXRlcmF0b3I1LnMoKTsgIShfc3RlcDUgPSBfaXRlcmF0b3I1Lm4oKSkuZG9uZTspIHsKICAgICAgICAgICAgX2xvb3AoKTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgIF9pdGVyYXRvcjUuZShlcnIpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICBfaXRlcmF0b3I1LmYoKTsKICAgICAgICB9CgogICAgICAgIGlmIChyYW5nZVJlZikgewogICAgICAgICAgcmFuZ2VSZWYudW5yZWYoKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIFdyYXAgdGhlIG5vZGVzIGF0IGEgbG9jYXRpb24gaW4gYSBuZXcgY29udGFpbmVyIG5vZGUsIHNwbGl0dGluZyB0aGUgZWRnZXMKICAgICAqIG9mIHRoZSByYW5nZSBmaXJzdCB0byBlbnN1cmUgdGhhdCBvbmx5IHRoZSBjb250ZW50IGluIHRoZSByYW5nZSBpcyB3cmFwcGVkLgogICAgICovCiAgICB3cmFwTm9kZXM6IGZ1bmN0aW9uIHdyYXBOb2RlcyhlZGl0b3IsIGVsZW1lbnQpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IHt9OwogICAgICBFZGl0b3Iud2l0aG91dE5vcm1hbGl6aW5nKGVkaXRvciwgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBfb3B0aW9ucyRtb2RlOSA9IG9wdGlvbnMubW9kZSwKICAgICAgICAgICAgbW9kZSA9IF9vcHRpb25zJG1vZGU5ID09PSB2b2lkIDAgPyAnbG93ZXN0JyA6IF9vcHRpb25zJG1vZGU5LAogICAgICAgICAgICBfb3B0aW9ucyRzcGxpdDMgPSBvcHRpb25zLnNwbGl0LAogICAgICAgICAgICBzcGxpdCA9IF9vcHRpb25zJHNwbGl0MyA9PT0gdm9pZCAwID8gZmFsc2UgOiBfb3B0aW9ucyRzcGxpdDMsCiAgICAgICAgICAgIF9vcHRpb25zJHZvaWRzOSA9IG9wdGlvbnMudm9pZHMsCiAgICAgICAgICAgIHZvaWRzID0gX29wdGlvbnMkdm9pZHM5ID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zJHZvaWRzOTsKICAgICAgICB2YXIgbWF0Y2ggPSBvcHRpb25zLm1hdGNoLAogICAgICAgICAgICBfb3B0aW9ucyRhdDggPSBvcHRpb25zLmF0LAogICAgICAgICAgICBhdCA9IF9vcHRpb25zJGF0OCA9PT0gdm9pZCAwID8gZWRpdG9yLnNlbGVjdGlvbiA6IF9vcHRpb25zJGF0ODsKCiAgICAgICAgaWYgKCFhdCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKG1hdGNoID09IG51bGwpIHsKICAgICAgICAgIGlmIChQYXRoLmlzUGF0aChhdCkpIHsKICAgICAgICAgICAgbWF0Y2ggPSBtYXRjaFBhdGgoZWRpdG9yLCBhdCk7CiAgICAgICAgICB9IGVsc2UgaWYgKGVkaXRvci5pc0lubGluZShlbGVtZW50KSkgewogICAgICAgICAgICBtYXRjaCA9IGZ1bmN0aW9uIG1hdGNoKG4pIHsKICAgICAgICAgICAgICByZXR1cm4gRWRpdG9yLmlzSW5saW5lKGVkaXRvciwgbikgfHwgVGV4dC5pc1RleHQobik7CiAgICAgICAgICAgIH07CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtYXRjaCA9IGZ1bmN0aW9uIG1hdGNoKG4pIHsKICAgICAgICAgICAgICByZXR1cm4gRWRpdG9yLmlzQmxvY2soZWRpdG9yLCBuKTsKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChzcGxpdCAmJiBSYW5nZS5pc1JhbmdlKGF0KSkgewogICAgICAgICAgdmFyIF9SYW5nZSRlZGdlczcgPSBSYW5nZS5lZGdlcyhhdCksCiAgICAgICAgICAgICAgX1JhbmdlJGVkZ2VzOCA9IF9zbGljZWRUb0FycmF5KF9SYW5nZSRlZGdlczcsIDIpLAogICAgICAgICAgICAgIHN0YXJ0ID0gX1JhbmdlJGVkZ2VzOFswXSwKICAgICAgICAgICAgICBlbmQgPSBfUmFuZ2UkZWRnZXM4WzFdOwoKICAgICAgICAgIHZhciByYW5nZVJlZiA9IEVkaXRvci5yYW5nZVJlZihlZGl0b3IsIGF0LCB7CiAgICAgICAgICAgIGFmZmluaXR5OiAnaW53YXJkJwogICAgICAgICAgfSk7CiAgICAgICAgICBUcmFuc2Zvcm1zLnNwbGl0Tm9kZXMoZWRpdG9yLCB7CiAgICAgICAgICAgIGF0OiBlbmQsCiAgICAgICAgICAgIG1hdGNoOiBtYXRjaCwKICAgICAgICAgICAgdm9pZHM6IHZvaWRzCiAgICAgICAgICB9KTsKICAgICAgICAgIFRyYW5zZm9ybXMuc3BsaXROb2RlcyhlZGl0b3IsIHsKICAgICAgICAgICAgYXQ6IHN0YXJ0LAogICAgICAgICAgICBtYXRjaDogbWF0Y2gsCiAgICAgICAgICAgIHZvaWRzOiB2b2lkcwogICAgICAgICAgfSk7CiAgICAgICAgICBhdCA9IHJhbmdlUmVmLnVucmVmKCk7CgogICAgICAgICAgaWYgKG9wdGlvbnMuYXQgPT0gbnVsbCkgewogICAgICAgICAgICBUcmFuc2Zvcm1zLnNlbGVjdChlZGl0b3IsIGF0KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZhciByb290cyA9IEFycmF5LmZyb20oRWRpdG9yLm5vZGVzKGVkaXRvciwgewogICAgICAgICAgYXQ6IGF0LAogICAgICAgICAgbWF0Y2g6IGVkaXRvci5pc0lubGluZShlbGVtZW50KSA/IGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgIHJldHVybiBFZGl0b3IuaXNCbG9jayhlZGl0b3IsIG4pOwogICAgICAgICAgfSA6IGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgIHJldHVybiBFZGl0b3IuaXNFZGl0b3Iobik7CiAgICAgICAgICB9LAogICAgICAgICAgbW9kZTogJ2xvd2VzdCcsCiAgICAgICAgICB2b2lkczogdm9pZHMKICAgICAgICB9KSk7CgogICAgICAgIGZvciAodmFyIF9pNCA9IDAsIF9yb290cyA9IHJvb3RzOyBfaTQgPCBfcm9vdHMubGVuZ3RoOyBfaTQrKykgewogICAgICAgICAgdmFyIF9yb290cyRfaSA9IF9zbGljZWRUb0FycmF5KF9yb290c1tfaTRdLCAyKSwKICAgICAgICAgICAgICByb290UGF0aCA9IF9yb290cyRfaVsxXTsKCiAgICAgICAgICB2YXIgYSA9IFJhbmdlLmlzUmFuZ2UoYXQpID8gUmFuZ2UuaW50ZXJzZWN0aW9uKGF0LCBFZGl0b3IucmFuZ2UoZWRpdG9yLCByb290UGF0aCkpIDogYXQ7CgogICAgICAgICAgaWYgKCFhKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBtYXRjaGVzID0gQXJyYXkuZnJvbShFZGl0b3Iubm9kZXMoZWRpdG9yLCB7CiAgICAgICAgICAgIGF0OiBhLAogICAgICAgICAgICBtYXRjaDogbWF0Y2gsCiAgICAgICAgICAgIG1vZGU6IG1vZGUsCiAgICAgICAgICAgIHZvaWRzOiB2b2lkcwogICAgICAgICAgfSkpOwoKICAgICAgICAgIGlmIChtYXRjaGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgdmFyIF9yZXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdmFyIF9tYXRjaGVzID0gX3NsaWNlZFRvQXJyYXkobWF0Y2hlcywgMSksCiAgICAgICAgICAgICAgICAgIGZpcnN0ID0gX21hdGNoZXNbMF07CgogICAgICAgICAgICAgIHZhciBsYXN0ID0gbWF0Y2hlc1ttYXRjaGVzLmxlbmd0aCAtIDFdOwoKICAgICAgICAgICAgICB2YXIgX2ZpcnN0ID0gX3NsaWNlZFRvQXJyYXkoZmlyc3QsIDIpLAogICAgICAgICAgICAgICAgICBmaXJzdFBhdGggPSBfZmlyc3RbMV07CgogICAgICAgICAgICAgIHZhciBfbGFzdCA9IF9zbGljZWRUb0FycmF5KGxhc3QsIDIpLAogICAgICAgICAgICAgICAgICBsYXN0UGF0aCA9IF9sYXN0WzFdOwoKICAgICAgICAgICAgICBpZiAoZmlyc3RQYXRoLmxlbmd0aCA9PT0gMCAmJiBsYXN0UGF0aC5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlJ3Mgbm8gbWF0Y2hpbmcgcGFyZW50IC0gdXN1YWxseSBtZWFucyB0aGUgbm9kZSBpcyBhbiBlZGl0b3IgLSBkb24ndCBkbyBhbnl0aGluZwogICAgICAgICAgICAgICAgcmV0dXJuICJjb250aW51ZSI7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgY29tbW9uUGF0aCA9IFBhdGguZXF1YWxzKGZpcnN0UGF0aCwgbGFzdFBhdGgpID8gUGF0aC5wYXJlbnQoZmlyc3RQYXRoKSA6IFBhdGguY29tbW9uKGZpcnN0UGF0aCwgbGFzdFBhdGgpOwogICAgICAgICAgICAgIHZhciByYW5nZSA9IEVkaXRvci5yYW5nZShlZGl0b3IsIGZpcnN0UGF0aCwgbGFzdFBhdGgpOwogICAgICAgICAgICAgIHZhciBjb21tb25Ob2RlRW50cnkgPSBFZGl0b3Iubm9kZShlZGl0b3IsIGNvbW1vblBhdGgpOwoKICAgICAgICAgICAgICB2YXIgX2NvbW1vbk5vZGVFbnRyeSA9IF9zbGljZWRUb0FycmF5KGNvbW1vbk5vZGVFbnRyeSwgMSksCiAgICAgICAgICAgICAgICAgIGNvbW1vbk5vZGUgPSBfY29tbW9uTm9kZUVudHJ5WzBdOwoKICAgICAgICAgICAgICB2YXIgZGVwdGggPSBjb21tb25QYXRoLmxlbmd0aCArIDE7CiAgICAgICAgICAgICAgdmFyIHdyYXBwZXJQYXRoID0gUGF0aC5uZXh0KGxhc3RQYXRoLnNsaWNlKDAsIGRlcHRoKSk7CgogICAgICAgICAgICAgIHZhciB3cmFwcGVyID0gX29iamVjdFNwcmVhZCQyKF9vYmplY3RTcHJlYWQkMih7fSwgZWxlbWVudCksIHt9LCB7CiAgICAgICAgICAgICAgICBjaGlsZHJlbjogW10KICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgVHJhbnNmb3Jtcy5pbnNlcnROb2RlcyhlZGl0b3IsIHdyYXBwZXIsIHsKICAgICAgICAgICAgICAgIGF0OiB3cmFwcGVyUGF0aCwKICAgICAgICAgICAgICAgIHZvaWRzOiB2b2lkcwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIFRyYW5zZm9ybXMubW92ZU5vZGVzKGVkaXRvciwgewogICAgICAgICAgICAgICAgYXQ6IHJhbmdlLAogICAgICAgICAgICAgICAgbWF0Y2g6IGZ1bmN0aW9uIG1hdGNoKG4pIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIEVsZW1lbnQkMS5pc0FuY2VzdG9yKGNvbW1vbk5vZGUpICYmIGNvbW1vbk5vZGUuY2hpbGRyZW4uaW5jbHVkZXMobik7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdG86IHdyYXBwZXJQYXRoLmNvbmNhdCgwKSwKICAgICAgICAgICAgICAgIHZvaWRzOiB2b2lkcwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KCk7CgogICAgICAgICAgICBpZiAoX3JldCA9PT0gImNvbnRpbnVlIikgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9OwoKICB2YXIgaGFzU2luZ2xlQ2hpbGROZXN0ID0gZnVuY3Rpb24gaGFzU2luZ2xlQ2hpbGROZXN0KGVkaXRvciwgbm9kZSkgewogICAgaWYgKEVsZW1lbnQkMS5pc0VsZW1lbnQobm9kZSkpIHsKICAgICAgdmFyIGVsZW1lbnQgPSBub2RlOwoKICAgICAgaWYgKEVkaXRvci5pc1ZvaWQoZWRpdG9yLCBub2RlKSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGVsc2UgaWYgKGVsZW1lbnQuY2hpbGRyZW4ubGVuZ3RoID09PSAxKSB7CiAgICAgICAgcmV0dXJuIGhhc1NpbmdsZUNoaWxkTmVzdChlZGl0b3IsIGVsZW1lbnQuY2hpbGRyZW5bMF0pOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfSBlbHNlIGlmIChFZGl0b3IuaXNFZGl0b3Iobm9kZSkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgfTsKICAvKioKICAgKiBDb252ZXJ0IGEgcmFuZ2UgaW50byBhIHBvaW50IGJ5IGRlbGV0aW5nIGl0J3MgY29udGVudC4KICAgKi8KCgogIHZhciBkZWxldGVSYW5nZSA9IGZ1bmN0aW9uIGRlbGV0ZVJhbmdlKGVkaXRvciwgcmFuZ2UpIHsKICAgIGlmIChSYW5nZS5pc0NvbGxhcHNlZChyYW5nZSkpIHsKICAgICAgcmV0dXJuIHJhbmdlLmFuY2hvcjsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBfUmFuZ2UkZWRnZXM5ID0gUmFuZ2UuZWRnZXMocmFuZ2UpLAogICAgICAgICAgX1JhbmdlJGVkZ2VzMTAgPSBfc2xpY2VkVG9BcnJheShfUmFuZ2UkZWRnZXM5LCAyKSwKICAgICAgICAgIGVuZCA9IF9SYW5nZSRlZGdlczEwWzFdOwoKICAgICAgdmFyIHBvaW50UmVmID0gRWRpdG9yLnBvaW50UmVmKGVkaXRvciwgZW5kKTsKICAgICAgVHJhbnNmb3Jtc1siZGVsZXRlIl0oZWRpdG9yLCB7CiAgICAgICAgYXQ6IHJhbmdlCiAgICAgIH0pOwogICAgICByZXR1cm4gcG9pbnRSZWYudW5yZWYoKTsKICAgIH0KICB9OwoKICB2YXIgbWF0Y2hQYXRoID0gZnVuY3Rpb24gbWF0Y2hQYXRoKGVkaXRvciwgcGF0aCkgewogICAgdmFyIF9FZGl0b3Ikbm9kZTUgPSBFZGl0b3Iubm9kZShlZGl0b3IsIHBhdGgpLAogICAgICAgIF9FZGl0b3Ikbm9kZTYgPSBfc2xpY2VkVG9BcnJheShfRWRpdG9yJG5vZGU1LCAxKSwKICAgICAgICBub2RlID0gX0VkaXRvciRub2RlNlswXTsKCiAgICByZXR1cm4gZnVuY3Rpb24gKG4pIHsKICAgICAgcmV0dXJuIG4gPT09IG5vZGU7CiAgICB9OwogIH07CgogIGZ1bmN0aW9uIG93bktleXMkMShvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgeyBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgeyByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsgfSk7IH0ga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgogIGZ1bmN0aW9uIF9vYmplY3RTcHJlYWQkMSh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307IGlmIChpICUgMikgeyBvd25LZXlzJDEoT2JqZWN0KHNvdXJjZSksIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyQxKE9iamVjdChzb3VyY2UpKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfQogIHZhciBTZWxlY3Rpb25UcmFuc2Zvcm1zID0gewogICAgLyoqCiAgICAgKiBDb2xsYXBzZSB0aGUgc2VsZWN0aW9uLgogICAgICovCiAgICBjb2xsYXBzZTogZnVuY3Rpb24gY29sbGFwc2UoZWRpdG9yKSB7CiAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsKICAgICAgdmFyIF9vcHRpb25zJGVkZ2UgPSBvcHRpb25zLmVkZ2UsCiAgICAgICAgICBlZGdlID0gX29wdGlvbnMkZWRnZSA9PT0gdm9pZCAwID8gJ2FuY2hvcicgOiBfb3B0aW9ucyRlZGdlOwogICAgICB2YXIgc2VsZWN0aW9uID0gZWRpdG9yLnNlbGVjdGlvbjsKCiAgICAgIGlmICghc2VsZWN0aW9uKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKGVkZ2UgPT09ICdhbmNob3InKSB7CiAgICAgICAgVHJhbnNmb3Jtcy5zZWxlY3QoZWRpdG9yLCBzZWxlY3Rpb24uYW5jaG9yKTsKICAgICAgfSBlbHNlIGlmIChlZGdlID09PSAnZm9jdXMnKSB7CiAgICAgICAgVHJhbnNmb3Jtcy5zZWxlY3QoZWRpdG9yLCBzZWxlY3Rpb24uZm9jdXMpOwogICAgICB9IGVsc2UgaWYgKGVkZ2UgPT09ICdzdGFydCcpIHsKICAgICAgICB2YXIgX1JhbmdlJGVkZ2VzID0gUmFuZ2UuZWRnZXMoc2VsZWN0aW9uKSwKICAgICAgICAgICAgX1JhbmdlJGVkZ2VzMiA9IF9zbGljZWRUb0FycmF5KF9SYW5nZSRlZGdlcywgMSksCiAgICAgICAgICAgIHN0YXJ0ID0gX1JhbmdlJGVkZ2VzMlswXTsKCiAgICAgICAgVHJhbnNmb3Jtcy5zZWxlY3QoZWRpdG9yLCBzdGFydCk7CiAgICAgIH0gZWxzZSBpZiAoZWRnZSA9PT0gJ2VuZCcpIHsKICAgICAgICB2YXIgX1JhbmdlJGVkZ2VzMyA9IFJhbmdlLmVkZ2VzKHNlbGVjdGlvbiksCiAgICAgICAgICAgIF9SYW5nZSRlZGdlczQgPSBfc2xpY2VkVG9BcnJheShfUmFuZ2UkZWRnZXMzLCAyKSwKICAgICAgICAgICAgZW5kID0gX1JhbmdlJGVkZ2VzNFsxXTsKCiAgICAgICAgVHJhbnNmb3Jtcy5zZWxlY3QoZWRpdG9yLCBlbmQpOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogVW5zZXQgdGhlIHNlbGVjdGlvbi4KICAgICAqLwogICAgZGVzZWxlY3Q6IGZ1bmN0aW9uIGRlc2VsZWN0KGVkaXRvcikgewogICAgICB2YXIgc2VsZWN0aW9uID0gZWRpdG9yLnNlbGVjdGlvbjsKCiAgICAgIGlmIChzZWxlY3Rpb24pIHsKICAgICAgICBlZGl0b3IuYXBwbHkoewogICAgICAgICAgdHlwZTogJ3NldF9zZWxlY3Rpb24nLAogICAgICAgICAgcHJvcGVydGllczogc2VsZWN0aW9uLAogICAgICAgICAgbmV3UHJvcGVydGllczogbnVsbAogICAgICAgIH0pOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogTW92ZSB0aGUgc2VsZWN0aW9uJ3MgcG9pbnQgZm9yd2FyZCBvciBiYWNrd2FyZC4KICAgICAqLwogICAgbW92ZTogZnVuY3Rpb24gbW92ZShlZGl0b3IpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogICAgICB2YXIgc2VsZWN0aW9uID0gZWRpdG9yLnNlbGVjdGlvbjsKICAgICAgdmFyIF9vcHRpb25zJGRpc3RhbmNlID0gb3B0aW9ucy5kaXN0YW5jZSwKICAgICAgICAgIGRpc3RhbmNlID0gX29wdGlvbnMkZGlzdGFuY2UgPT09IHZvaWQgMCA/IDEgOiBfb3B0aW9ucyRkaXN0YW5jZSwKICAgICAgICAgIF9vcHRpb25zJHVuaXQgPSBvcHRpb25zLnVuaXQsCiAgICAgICAgICB1bml0ID0gX29wdGlvbnMkdW5pdCA9PT0gdm9pZCAwID8gJ2NoYXJhY3RlcicgOiBfb3B0aW9ucyR1bml0LAogICAgICAgICAgX29wdGlvbnMkcmV2ZXJzZSA9IG9wdGlvbnMucmV2ZXJzZSwKICAgICAgICAgIHJldmVyc2UgPSBfb3B0aW9ucyRyZXZlcnNlID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zJHJldmVyc2U7CiAgICAgIHZhciBfb3B0aW9ucyRlZGdlMiA9IG9wdGlvbnMuZWRnZSwKICAgICAgICAgIGVkZ2UgPSBfb3B0aW9ucyRlZGdlMiA9PT0gdm9pZCAwID8gbnVsbCA6IF9vcHRpb25zJGVkZ2UyOwoKICAgICAgaWYgKCFzZWxlY3Rpb24pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChlZGdlID09PSAnc3RhcnQnKSB7CiAgICAgICAgZWRnZSA9IFJhbmdlLmlzQmFja3dhcmQoc2VsZWN0aW9uKSA/ICdmb2N1cycgOiAnYW5jaG9yJzsKICAgICAgfQoKICAgICAgaWYgKGVkZ2UgPT09ICdlbmQnKSB7CiAgICAgICAgZWRnZSA9IFJhbmdlLmlzQmFja3dhcmQoc2VsZWN0aW9uKSA/ICdhbmNob3InIDogJ2ZvY3VzJzsKICAgICAgfQoKICAgICAgdmFyIGFuY2hvciA9IHNlbGVjdGlvbi5hbmNob3IsCiAgICAgICAgICBmb2N1cyA9IHNlbGVjdGlvbi5mb2N1czsKICAgICAgdmFyIG9wdHMgPSB7CiAgICAgICAgZGlzdGFuY2U6IGRpc3RhbmNlLAogICAgICAgIHVuaXQ6IHVuaXQKICAgICAgfTsKICAgICAgdmFyIHByb3BzID0ge307CgogICAgICBpZiAoZWRnZSA9PSBudWxsIHx8IGVkZ2UgPT09ICdhbmNob3InKSB7CiAgICAgICAgdmFyIHBvaW50ID0gcmV2ZXJzZSA/IEVkaXRvci5iZWZvcmUoZWRpdG9yLCBhbmNob3IsIG9wdHMpIDogRWRpdG9yLmFmdGVyKGVkaXRvciwgYW5jaG9yLCBvcHRzKTsKCiAgICAgICAgaWYgKHBvaW50KSB7CiAgICAgICAgICBwcm9wcy5hbmNob3IgPSBwb2ludDsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChlZGdlID09IG51bGwgfHwgZWRnZSA9PT0gJ2ZvY3VzJykgewogICAgICAgIHZhciBfcG9pbnQgPSByZXZlcnNlID8gRWRpdG9yLmJlZm9yZShlZGl0b3IsIGZvY3VzLCBvcHRzKSA6IEVkaXRvci5hZnRlcihlZGl0b3IsIGZvY3VzLCBvcHRzKTsKCiAgICAgICAgaWYgKF9wb2ludCkgewogICAgICAgICAgcHJvcHMuZm9jdXMgPSBfcG9pbnQ7CiAgICAgICAgfQogICAgICB9CgogICAgICBUcmFuc2Zvcm1zLnNldFNlbGVjdGlvbihlZGl0b3IsIHByb3BzKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBTZXQgdGhlIHNlbGVjdGlvbiB0byBhIG5ldyB2YWx1ZS4KICAgICAqLwogICAgc2VsZWN0OiBmdW5jdGlvbiBzZWxlY3QoZWRpdG9yLCB0YXJnZXQpIHsKICAgICAgdmFyIHNlbGVjdGlvbiA9IGVkaXRvci5zZWxlY3Rpb247CiAgICAgIHRhcmdldCA9IEVkaXRvci5yYW5nZShlZGl0b3IsIHRhcmdldCk7CgogICAgICBpZiAoc2VsZWN0aW9uKSB7CiAgICAgICAgVHJhbnNmb3Jtcy5zZXRTZWxlY3Rpb24oZWRpdG9yLCB0YXJnZXQpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKCFSYW5nZS5pc1JhbmdlKHRhcmdldCkpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIldoZW4gc2V0dGluZyB0aGUgc2VsZWN0aW9uIGFuZCB0aGUgY3VycmVudCBzZWxlY3Rpb24gaXMgYG51bGxgIHlvdSBtdXN0IHByb3ZpZGUgYXQgbGVhc3QgYW4gYGFuY2hvcmAgYW5kIGBmb2N1c2AsIGJ1dCB5b3UgcGFzc2VkOiAiLmNvbmNhdChKU09OLnN0cmluZ2lmeSh0YXJnZXQpKSk7CiAgICAgIH0KCiAgICAgIGVkaXRvci5hcHBseSh7CiAgICAgICAgdHlwZTogJ3NldF9zZWxlY3Rpb24nLAogICAgICAgIHByb3BlcnRpZXM6IHNlbGVjdGlvbiwKICAgICAgICBuZXdQcm9wZXJ0aWVzOiB0YXJnZXQKICAgICAgfSk7CiAgICB9LAoKICAgIC8qKgogICAgICogU2V0IG5ldyBwcm9wZXJ0aWVzIG9uIG9uZSBvZiB0aGUgc2VsZWN0aW9uJ3MgcG9pbnRzLgogICAgICovCiAgICBzZXRQb2ludDogZnVuY3Rpb24gc2V0UG9pbnQoZWRpdG9yLCBwcm9wcykgewogICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDoge307CiAgICAgIHZhciBzZWxlY3Rpb24gPSBlZGl0b3Iuc2VsZWN0aW9uOwogICAgICB2YXIgX29wdGlvbnMkZWRnZTMgPSBvcHRpb25zLmVkZ2UsCiAgICAgICAgICBlZGdlID0gX29wdGlvbnMkZWRnZTMgPT09IHZvaWQgMCA/ICdib3RoJyA6IF9vcHRpb25zJGVkZ2UzOwoKICAgICAgaWYgKCFzZWxlY3Rpb24pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChlZGdlID09PSAnc3RhcnQnKSB7CiAgICAgICAgZWRnZSA9IFJhbmdlLmlzQmFja3dhcmQoc2VsZWN0aW9uKSA/ICdmb2N1cycgOiAnYW5jaG9yJzsKICAgICAgfQoKICAgICAgaWYgKGVkZ2UgPT09ICdlbmQnKSB7CiAgICAgICAgZWRnZSA9IFJhbmdlLmlzQmFja3dhcmQoc2VsZWN0aW9uKSA/ICdhbmNob3InIDogJ2ZvY3VzJzsKICAgICAgfQoKICAgICAgdmFyIGFuY2hvciA9IHNlbGVjdGlvbi5hbmNob3IsCiAgICAgICAgICBmb2N1cyA9IHNlbGVjdGlvbi5mb2N1czsKICAgICAgdmFyIHBvaW50ID0gZWRnZSA9PT0gJ2FuY2hvcicgPyBhbmNob3IgOiBmb2N1czsKICAgICAgVHJhbnNmb3Jtcy5zZXRTZWxlY3Rpb24oZWRpdG9yLCBfZGVmaW5lUHJvcGVydHkoe30sIGVkZ2UgPT09ICdhbmNob3InID8gJ2FuY2hvcicgOiAnZm9jdXMnLCBfb2JqZWN0U3ByZWFkJDEoX29iamVjdFNwcmVhZCQxKHt9LCBwb2ludCksIHByb3BzKSkpOwogICAgfSwKCiAgICAvKioKICAgICAqIFNldCBuZXcgcHJvcGVydGllcyBvbiB0aGUgc2VsZWN0aW9uLgogICAgICovCiAgICBzZXRTZWxlY3Rpb246IGZ1bmN0aW9uIHNldFNlbGVjdGlvbihlZGl0b3IsIHByb3BzKSB7CiAgICAgIHZhciBzZWxlY3Rpb24gPSBlZGl0b3Iuc2VsZWN0aW9uOwogICAgICB2YXIgb2xkUHJvcHMgPSB7fTsKICAgICAgdmFyIG5ld1Byb3BzID0ge307CgogICAgICBpZiAoIXNlbGVjdGlvbikgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgZm9yICh2YXIgayBpbiBwcm9wcykgewogICAgICAgIGlmIChrID09PSAnYW5jaG9yJyAmJiBwcm9wcy5hbmNob3IgIT0gbnVsbCAmJiAhUG9pbnQuZXF1YWxzKHByb3BzLmFuY2hvciwgc2VsZWN0aW9uLmFuY2hvcikgfHwgayA9PT0gJ2ZvY3VzJyAmJiBwcm9wcy5mb2N1cyAhPSBudWxsICYmICFQb2ludC5lcXVhbHMocHJvcHMuZm9jdXMsIHNlbGVjdGlvbi5mb2N1cykgfHwgayAhPT0gJ2FuY2hvcicgJiYgayAhPT0gJ2ZvY3VzJyAmJiBwcm9wc1trXSAhPT0gc2VsZWN0aW9uW2tdKSB7CiAgICAgICAgICBvbGRQcm9wc1trXSA9IHNlbGVjdGlvbltrXTsKICAgICAgICAgIG5ld1Byb3BzW2tdID0gcHJvcHNba107CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoT2JqZWN0LmtleXMob2xkUHJvcHMpLmxlbmd0aCA+IDApIHsKICAgICAgICBlZGl0b3IuYXBwbHkoewogICAgICAgICAgdHlwZTogJ3NldF9zZWxlY3Rpb24nLAogICAgICAgICAgcHJvcGVydGllczogb2xkUHJvcHMsCiAgICAgICAgICBuZXdQcm9wZXJ0aWVzOiBuZXdQcm9wcwogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIobywgYWxsb3dBcnJheUxpa2UpIHsgdmFyIGl0ID0gdHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgb1tTeW1ib2wuaXRlcmF0b3JdIHx8IG9bIkBAaXRlcmF0b3IiXTsgaWYgKCFpdCkgeyBpZiAoQXJyYXkuaXNBcnJheShvKSB8fCAoaXQgPSBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobykpIHx8IGFsbG93QXJyYXlMaWtlICYmIG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgeyBpZiAoaXQpIG8gPSBpdDsgdmFyIGkgPSAwOyB2YXIgRiA9IGZ1bmN0aW9uIEYoKSB7fTsgcmV0dXJuIHsgczogRiwgbjogZnVuY3Rpb24gbigpIHsgaWYgKGkgPj0gby5sZW5ndGgpIHJldHVybiB7IGRvbmU6IHRydWUgfTsgcmV0dXJuIHsgZG9uZTogZmFsc2UsIHZhbHVlOiBvW2krK10gfTsgfSwgZTogZnVuY3Rpb24gZShfZSkgeyB0aHJvdyBfZTsgfSwgZjogRiB9OyB9IHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBpdGVyYXRlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTsgfSB2YXIgbm9ybWFsQ29tcGxldGlvbiA9IHRydWUsIGRpZEVyciA9IGZhbHNlLCBlcnI7IHJldHVybiB7IHM6IGZ1bmN0aW9uIHMoKSB7IGl0ID0gaXQuY2FsbChvKTsgfSwgbjogZnVuY3Rpb24gbigpIHsgdmFyIHN0ZXAgPSBpdC5uZXh0KCk7IG5vcm1hbENvbXBsZXRpb24gPSBzdGVwLmRvbmU7IHJldHVybiBzdGVwOyB9LCBlOiBmdW5jdGlvbiBlKF9lMikgeyBkaWRFcnIgPSB0cnVlOyBlcnIgPSBfZTI7IH0sIGY6IGZ1bmN0aW9uIGYoKSB7IHRyeSB7IGlmICghbm9ybWFsQ29tcGxldGlvbiAmJiBpdFsicmV0dXJuIl0gIT0gbnVsbCkgaXRbInJldHVybiJdKCk7IH0gZmluYWxseSB7IGlmIChkaWRFcnIpIHRocm93IGVycjsgfSB9IH07IH0KCiAgZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikgeyBpZiAoIW8pIHJldHVybjsgaWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7IHZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTsgaWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7IGlmIChuID09PSAiTWFwIiB8fCBuID09PSAiU2V0IikgcmV0dXJuIEFycmF5LmZyb20obyk7IGlmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7IH0KCiAgZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHsgaWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykgeyBhcnIyW2ldID0gYXJyW2ldOyB9IHJldHVybiBhcnIyOyB9CiAgdmFyIFRleHRUcmFuc2Zvcm1zID0gewogICAgLyoqCiAgICAgKiBEZWxldGUgY29udGVudCBpbiB0aGUgZWRpdG9yLgogICAgICovCiAgICAiZGVsZXRlIjogZnVuY3Rpb24gX2RlbGV0ZShlZGl0b3IpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogICAgICBFZGl0b3Iud2l0aG91dE5vcm1hbGl6aW5nKGVkaXRvciwgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBfb3B0aW9ucyRyZXZlcnNlID0gb3B0aW9ucy5yZXZlcnNlLAogICAgICAgICAgICByZXZlcnNlID0gX29wdGlvbnMkcmV2ZXJzZSA9PT0gdm9pZCAwID8gZmFsc2UgOiBfb3B0aW9ucyRyZXZlcnNlLAogICAgICAgICAgICBfb3B0aW9ucyR1bml0ID0gb3B0aW9ucy51bml0LAogICAgICAgICAgICB1bml0ID0gX29wdGlvbnMkdW5pdCA9PT0gdm9pZCAwID8gJ2NoYXJhY3RlcicgOiBfb3B0aW9ucyR1bml0LAogICAgICAgICAgICBfb3B0aW9ucyRkaXN0YW5jZSA9IG9wdGlvbnMuZGlzdGFuY2UsCiAgICAgICAgICAgIGRpc3RhbmNlID0gX29wdGlvbnMkZGlzdGFuY2UgPT09IHZvaWQgMCA/IDEgOiBfb3B0aW9ucyRkaXN0YW5jZSwKICAgICAgICAgICAgX29wdGlvbnMkdm9pZHMgPSBvcHRpb25zLnZvaWRzLAogICAgICAgICAgICB2b2lkcyA9IF9vcHRpb25zJHZvaWRzID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zJHZvaWRzOwogICAgICAgIHZhciBfb3B0aW9ucyRhdCA9IG9wdGlvbnMuYXQsCiAgICAgICAgICAgIGF0ID0gX29wdGlvbnMkYXQgPT09IHZvaWQgMCA/IGVkaXRvci5zZWxlY3Rpb24gOiBfb3B0aW9ucyRhdCwKICAgICAgICAgICAgX29wdGlvbnMkaGFuZ2luZyA9IG9wdGlvbnMuaGFuZ2luZywKICAgICAgICAgICAgaGFuZ2luZyA9IF9vcHRpb25zJGhhbmdpbmcgPT09IHZvaWQgMCA/IGZhbHNlIDogX29wdGlvbnMkaGFuZ2luZzsKCiAgICAgICAgaWYgKCFhdCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKFJhbmdlLmlzUmFuZ2UoYXQpICYmIFJhbmdlLmlzQ29sbGFwc2VkKGF0KSkgewogICAgICAgICAgYXQgPSBhdC5hbmNob3I7CiAgICAgICAgfQoKICAgICAgICBpZiAoUG9pbnQuaXNQb2ludChhdCkpIHsKICAgICAgICAgIHZhciBmdXJ0aGVzdFZvaWQgPSBFZGl0b3JbInZvaWQiXShlZGl0b3IsIHsKICAgICAgICAgICAgYXQ6IGF0LAogICAgICAgICAgICBtb2RlOiAnaGlnaGVzdCcKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmICghdm9pZHMgJiYgZnVydGhlc3RWb2lkKSB7CiAgICAgICAgICAgIHZhciBfZnVydGhlc3RWb2lkID0gX3NsaWNlZFRvQXJyYXkoZnVydGhlc3RWb2lkLCAyKSwKICAgICAgICAgICAgICAgIHZvaWRQYXRoID0gX2Z1cnRoZXN0Vm9pZFsxXTsKCiAgICAgICAgICAgIGF0ID0gdm9pZFBhdGg7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgb3B0cyA9IHsKICAgICAgICAgICAgICB1bml0OiB1bml0LAogICAgICAgICAgICAgIGRpc3RhbmNlOiBkaXN0YW5jZQogICAgICAgICAgICB9OwogICAgICAgICAgICB2YXIgdGFyZ2V0ID0gcmV2ZXJzZSA/IEVkaXRvci5iZWZvcmUoZWRpdG9yLCBhdCwgb3B0cykgfHwgRWRpdG9yLnN0YXJ0KGVkaXRvciwgW10pIDogRWRpdG9yLmFmdGVyKGVkaXRvciwgYXQsIG9wdHMpIHx8IEVkaXRvci5lbmQoZWRpdG9yLCBbXSk7CiAgICAgICAgICAgIGF0ID0gewogICAgICAgICAgICAgIGFuY2hvcjogYXQsCiAgICAgICAgICAgICAgZm9jdXM6IHRhcmdldAogICAgICAgICAgICB9OwogICAgICAgICAgICBoYW5naW5nID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChQYXRoLmlzUGF0aChhdCkpIHsKICAgICAgICAgIFRyYW5zZm9ybXMucmVtb3ZlTm9kZXMoZWRpdG9yLCB7CiAgICAgICAgICAgIGF0OiBhdCwKICAgICAgICAgICAgdm9pZHM6IHZvaWRzCiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChSYW5nZS5pc0NvbGxhcHNlZChhdCkpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICghaGFuZ2luZykgewogICAgICAgICAgdmFyIF9SYW5nZSRlZGdlcyA9IFJhbmdlLmVkZ2VzKGF0KSwKICAgICAgICAgICAgICBfUmFuZ2UkZWRnZXMyID0gX3NsaWNlZFRvQXJyYXkoX1JhbmdlJGVkZ2VzLCAyKSwKICAgICAgICAgICAgICBfZW5kID0gX1JhbmdlJGVkZ2VzMlsxXTsKCiAgICAgICAgICB2YXIgZW5kT2ZEb2MgPSBFZGl0b3IuZW5kKGVkaXRvciwgW10pOwoKICAgICAgICAgIGlmICghUG9pbnQuZXF1YWxzKF9lbmQsIGVuZE9mRG9jKSkgewogICAgICAgICAgICBhdCA9IEVkaXRvci51bmhhbmdSYW5nZShlZGl0b3IsIGF0LCB7CiAgICAgICAgICAgICAgdm9pZHM6IHZvaWRzCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIF9SYW5nZSRlZGdlczMgPSBSYW5nZS5lZGdlcyhhdCksCiAgICAgICAgICAgIF9SYW5nZSRlZGdlczQgPSBfc2xpY2VkVG9BcnJheShfUmFuZ2UkZWRnZXMzLCAyKSwKICAgICAgICAgICAgc3RhcnQgPSBfUmFuZ2UkZWRnZXM0WzBdLAogICAgICAgICAgICBlbmQgPSBfUmFuZ2UkZWRnZXM0WzFdOwoKICAgICAgICB2YXIgc3RhcnRCbG9jayA9IEVkaXRvci5hYm92ZShlZGl0b3IsIHsKICAgICAgICAgIG1hdGNoOiBmdW5jdGlvbiBtYXRjaChuKSB7CiAgICAgICAgICAgIHJldHVybiBFZGl0b3IuaXNCbG9jayhlZGl0b3IsIG4pOwogICAgICAgICAgfSwKICAgICAgICAgIGF0OiBzdGFydCwKICAgICAgICAgIHZvaWRzOiB2b2lkcwogICAgICAgIH0pOwogICAgICAgIHZhciBlbmRCbG9jayA9IEVkaXRvci5hYm92ZShlZGl0b3IsIHsKICAgICAgICAgIG1hdGNoOiBmdW5jdGlvbiBtYXRjaChuKSB7CiAgICAgICAgICAgIHJldHVybiBFZGl0b3IuaXNCbG9jayhlZGl0b3IsIG4pOwogICAgICAgICAgfSwKICAgICAgICAgIGF0OiBlbmQsCiAgICAgICAgICB2b2lkczogdm9pZHMKICAgICAgICB9KTsKICAgICAgICB2YXIgaXNBY3Jvc3NCbG9ja3MgPSBzdGFydEJsb2NrICYmIGVuZEJsb2NrICYmICFQYXRoLmVxdWFscyhzdGFydEJsb2NrWzFdLCBlbmRCbG9ja1sxXSk7CiAgICAgICAgdmFyIGlzU2luZ2xlVGV4dCA9IFBhdGguZXF1YWxzKHN0YXJ0LnBhdGgsIGVuZC5wYXRoKTsKICAgICAgICB2YXIgc3RhcnRWb2lkID0gdm9pZHMgPyBudWxsIDogRWRpdG9yWyJ2b2lkIl0oZWRpdG9yLCB7CiAgICAgICAgICBhdDogc3RhcnQsCiAgICAgICAgICBtb2RlOiAnaGlnaGVzdCcKICAgICAgICB9KTsKICAgICAgICB2YXIgZW5kVm9pZCA9IHZvaWRzID8gbnVsbCA6IEVkaXRvclsidm9pZCJdKGVkaXRvciwgewogICAgICAgICAgYXQ6IGVuZCwKICAgICAgICAgIG1vZGU6ICdoaWdoZXN0JwogICAgICAgIH0pOyAvLyBJZiB0aGUgc3RhcnQgb3IgZW5kIHBvaW50cyBhcmUgaW5zaWRlIGFuIGlubGluZSB2b2lkLCBudWRnZSB0aGVtIG91dC4KCiAgICAgICAgaWYgKHN0YXJ0Vm9pZCkgewogICAgICAgICAgdmFyIGJlZm9yZSA9IEVkaXRvci5iZWZvcmUoZWRpdG9yLCBzdGFydCk7CgogICAgICAgICAgaWYgKGJlZm9yZSAmJiBzdGFydEJsb2NrICYmIFBhdGguaXNBbmNlc3RvcihzdGFydEJsb2NrWzFdLCBiZWZvcmUucGF0aCkpIHsKICAgICAgICAgICAgc3RhcnQgPSBiZWZvcmU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZW5kVm9pZCkgewogICAgICAgICAgdmFyIGFmdGVyID0gRWRpdG9yLmFmdGVyKGVkaXRvciwgZW5kKTsKCiAgICAgICAgICBpZiAoYWZ0ZXIgJiYgZW5kQmxvY2sgJiYgUGF0aC5pc0FuY2VzdG9yKGVuZEJsb2NrWzFdLCBhZnRlci5wYXRoKSkgewogICAgICAgICAgICBlbmQgPSBhZnRlcjsKICAgICAgICAgIH0KICAgICAgICB9IC8vIEdldCB0aGUgaGlnaGVzdCBub2RlcyB0aGF0IGFyZSBjb21wbGV0ZWx5IGluc2lkZSB0aGUgcmFuZ2UsIGFzIHdlbGwgYXMKICAgICAgICAvLyB0aGUgc3RhcnQgYW5kIGVuZCBub2Rlcy4KCgogICAgICAgIHZhciBtYXRjaGVzID0gW107CiAgICAgICAgdmFyIGxhc3RQYXRoOwoKICAgICAgICB2YXIgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoRWRpdG9yLm5vZGVzKGVkaXRvciwgewogICAgICAgICAgYXQ6IGF0LAogICAgICAgICAgdm9pZHM6IHZvaWRzCiAgICAgICAgfSkpLAogICAgICAgICAgICBfc3RlcDsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGZvciAoX2l0ZXJhdG9yLnMoKTsgIShfc3RlcCA9IF9pdGVyYXRvci5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgIHZhciBlbnRyeSA9IF9zdGVwLnZhbHVlOwoKICAgICAgICAgICAgdmFyIF9lbnRyeSA9IF9zbGljZWRUb0FycmF5KGVudHJ5LCAyKSwKICAgICAgICAgICAgICAgIF9ub2RlMiA9IF9lbnRyeVswXSwKICAgICAgICAgICAgICAgIF9wYXRoMyA9IF9lbnRyeVsxXTsKCiAgICAgICAgICAgIGlmIChsYXN0UGF0aCAmJiBQYXRoLmNvbXBhcmUoX3BhdGgzLCBsYXN0UGF0aCkgPT09IDApIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCF2b2lkcyAmJiBFZGl0b3IuaXNWb2lkKGVkaXRvciwgX25vZGUyKSB8fCAhUGF0aC5pc0NvbW1vbihfcGF0aDMsIHN0YXJ0LnBhdGgpICYmICFQYXRoLmlzQ29tbW9uKF9wYXRoMywgZW5kLnBhdGgpKSB7CiAgICAgICAgICAgICAgbWF0Y2hlcy5wdXNoKGVudHJ5KTsKICAgICAgICAgICAgICBsYXN0UGF0aCA9IF9wYXRoMzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgX2l0ZXJhdG9yLmUoZXJyKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgX2l0ZXJhdG9yLmYoKTsKICAgICAgICB9CgogICAgICAgIHZhciBwYXRoUmVmcyA9IEFycmF5LmZyb20obWF0Y2hlcywgZnVuY3Rpb24gKF9yZWYpIHsKICAgICAgICAgIHZhciBfcmVmMiA9IF9zbGljZWRUb0FycmF5KF9yZWYsIDIpLAogICAgICAgICAgICAgIHAgPSBfcmVmMlsxXTsKCiAgICAgICAgICByZXR1cm4gRWRpdG9yLnBhdGhSZWYoZWRpdG9yLCBwKTsKICAgICAgICB9KTsKICAgICAgICB2YXIgc3RhcnRSZWYgPSBFZGl0b3IucG9pbnRSZWYoZWRpdG9yLCBzdGFydCk7CiAgICAgICAgdmFyIGVuZFJlZiA9IEVkaXRvci5wb2ludFJlZihlZGl0b3IsIGVuZCk7CgogICAgICAgIGlmICghaXNTaW5nbGVUZXh0ICYmICFzdGFydFZvaWQpIHsKICAgICAgICAgIHZhciBfcG9pbnQgPSBzdGFydFJlZi5jdXJyZW50OwoKICAgICAgICAgIHZhciBfRWRpdG9yJGxlYWYgPSBFZGl0b3IubGVhZihlZGl0b3IsIF9wb2ludCksCiAgICAgICAgICAgICAgX0VkaXRvciRsZWFmMiA9IF9zbGljZWRUb0FycmF5KF9FZGl0b3IkbGVhZiwgMSksCiAgICAgICAgICAgICAgbm9kZSA9IF9FZGl0b3IkbGVhZjJbMF07CgogICAgICAgICAgdmFyIHBhdGggPSBfcG9pbnQucGF0aDsKICAgICAgICAgIHZhciBfc3RhcnQgPSBzdGFydCwKICAgICAgICAgICAgICBvZmZzZXQgPSBfc3RhcnQub2Zmc2V0OwogICAgICAgICAgdmFyIHRleHQgPSBub2RlLnRleHQuc2xpY2Uob2Zmc2V0KTsKICAgICAgICAgIGlmICh0ZXh0Lmxlbmd0aCA+IDApIGVkaXRvci5hcHBseSh7CiAgICAgICAgICAgIHR5cGU6ICdyZW1vdmVfdGV4dCcsCiAgICAgICAgICAgIHBhdGg6IHBhdGgsCiAgICAgICAgICAgIG9mZnNldDogb2Zmc2V0LAogICAgICAgICAgICB0ZXh0OiB0ZXh0CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGZvciAodmFyIF9pID0gMCwgX3BhdGhSZWZzID0gcGF0aFJlZnM7IF9pIDwgX3BhdGhSZWZzLmxlbmd0aDsgX2krKykgewogICAgICAgICAgdmFyIHBhdGhSZWYgPSBfcGF0aFJlZnNbX2ldOwoKICAgICAgICAgIHZhciBfcGF0aCA9IHBhdGhSZWYudW5yZWYoKTsKCiAgICAgICAgICBUcmFuc2Zvcm1zLnJlbW92ZU5vZGVzKGVkaXRvciwgewogICAgICAgICAgICBhdDogX3BhdGgsCiAgICAgICAgICAgIHZvaWRzOiB2b2lkcwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWVuZFZvaWQpIHsKICAgICAgICAgIHZhciBfcG9pbnQyID0gZW5kUmVmLmN1cnJlbnQ7CgogICAgICAgICAgdmFyIF9FZGl0b3IkbGVhZjMgPSBFZGl0b3IubGVhZihlZGl0b3IsIF9wb2ludDIpLAogICAgICAgICAgICAgIF9FZGl0b3IkbGVhZjQgPSBfc2xpY2VkVG9BcnJheShfRWRpdG9yJGxlYWYzLCAxKSwKICAgICAgICAgICAgICBfbm9kZSA9IF9FZGl0b3IkbGVhZjRbMF07CgogICAgICAgICAgdmFyIF9wYXRoMiA9IF9wb2ludDIucGF0aDsKCiAgICAgICAgICB2YXIgX29mZnNldCA9IGlzU2luZ2xlVGV4dCA/IHN0YXJ0Lm9mZnNldCA6IDA7CgogICAgICAgICAgdmFyIF90ZXh0ID0gX25vZGUudGV4dC5zbGljZShfb2Zmc2V0LCBlbmQub2Zmc2V0KTsKCiAgICAgICAgICBpZiAoX3RleHQubGVuZ3RoID4gMCkgZWRpdG9yLmFwcGx5KHsKICAgICAgICAgICAgdHlwZTogJ3JlbW92ZV90ZXh0JywKICAgICAgICAgICAgcGF0aDogX3BhdGgyLAogICAgICAgICAgICBvZmZzZXQ6IF9vZmZzZXQsCiAgICAgICAgICAgIHRleHQ6IF90ZXh0CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlmICghaXNTaW5nbGVUZXh0ICYmIGlzQWNyb3NzQmxvY2tzICYmIGVuZFJlZi5jdXJyZW50ICYmIHN0YXJ0UmVmLmN1cnJlbnQpIHsKICAgICAgICAgIFRyYW5zZm9ybXMubWVyZ2VOb2RlcyhlZGl0b3IsIHsKICAgICAgICAgICAgYXQ6IGVuZFJlZi5jdXJyZW50LAogICAgICAgICAgICBoYW5naW5nOiB0cnVlLAogICAgICAgICAgICB2b2lkczogdm9pZHMKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgdmFyIHBvaW50ID0gcmV2ZXJzZSA/IHN0YXJ0UmVmLnVucmVmKCkgfHwgZW5kUmVmLnVucmVmKCkgOiBlbmRSZWYudW5yZWYoKSB8fCBzdGFydFJlZi51bnJlZigpOwoKICAgICAgICBpZiAob3B0aW9ucy5hdCA9PSBudWxsICYmIHBvaW50KSB7CiAgICAgICAgICBUcmFuc2Zvcm1zLnNlbGVjdChlZGl0b3IsIHBvaW50KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIEluc2VydCBhIGZyYWdtZW50IGF0IGEgc3BlY2lmaWMgbG9jYXRpb24gaW4gdGhlIGVkaXRvci4KICAgICAqLwogICAgaW5zZXJ0RnJhZ21lbnQ6IGZ1bmN0aW9uIGluc2VydEZyYWdtZW50KGVkaXRvciwgZnJhZ21lbnQpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IHt9OwogICAgICBFZGl0b3Iud2l0aG91dE5vcm1hbGl6aW5nKGVkaXRvciwgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBfb3B0aW9ucyRoYW5naW5nMiA9IG9wdGlvbnMuaGFuZ2luZywKICAgICAgICAgICAgaGFuZ2luZyA9IF9vcHRpb25zJGhhbmdpbmcyID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zJGhhbmdpbmcyLAogICAgICAgICAgICBfb3B0aW9ucyR2b2lkczIgPSBvcHRpb25zLnZvaWRzLAogICAgICAgICAgICB2b2lkcyA9IF9vcHRpb25zJHZvaWRzMiA9PT0gdm9pZCAwID8gZmFsc2UgOiBfb3B0aW9ucyR2b2lkczI7CiAgICAgICAgdmFyIF9vcHRpb25zJGF0MiA9IG9wdGlvbnMuYXQsCiAgICAgICAgICAgIGF0ID0gX29wdGlvbnMkYXQyID09PSB2b2lkIDAgPyBlZGl0b3Iuc2VsZWN0aW9uIDogX29wdGlvbnMkYXQyOwoKICAgICAgICBpZiAoIWZyYWdtZW50Lmxlbmd0aCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFhdCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gZWxzZSBpZiAoUmFuZ2UuaXNSYW5nZShhdCkpIHsKICAgICAgICAgIGlmICghaGFuZ2luZykgewogICAgICAgICAgICBhdCA9IEVkaXRvci51bmhhbmdSYW5nZShlZGl0b3IsIGF0KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoUmFuZ2UuaXNDb2xsYXBzZWQoYXQpKSB7CiAgICAgICAgICAgIGF0ID0gYXQuYW5jaG9yOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIF9SYW5nZSRlZGdlczUgPSBSYW5nZS5lZGdlcyhhdCksCiAgICAgICAgICAgICAgICBfUmFuZ2UkZWRnZXM2ID0gX3NsaWNlZFRvQXJyYXkoX1JhbmdlJGVkZ2VzNSwgMiksCiAgICAgICAgICAgICAgICBlbmQgPSBfUmFuZ2UkZWRnZXM2WzFdOwoKICAgICAgICAgICAgaWYgKCF2b2lkcyAmJiBFZGl0b3JbInZvaWQiXShlZGl0b3IsIHsKICAgICAgICAgICAgICBhdDogZW5kCiAgICAgICAgICAgIH0pKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcG9pbnRSZWYgPSBFZGl0b3IucG9pbnRSZWYoZWRpdG9yLCBlbmQpOwogICAgICAgICAgICBUcmFuc2Zvcm1zWyJkZWxldGUiXShlZGl0b3IsIHsKICAgICAgICAgICAgICBhdDogYXQKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGF0ID0gcG9pbnRSZWYudW5yZWYoKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKFBhdGguaXNQYXRoKGF0KSkgewogICAgICAgICAgYXQgPSBFZGl0b3Iuc3RhcnQoZWRpdG9yLCBhdCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXZvaWRzICYmIEVkaXRvclsidm9pZCJdKGVkaXRvciwgewogICAgICAgICAgYXQ6IGF0CiAgICAgICAgfSkpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9IC8vIElmIHRoZSBpbnNlcnQgcG9pbnQgaXMgYXQgdGhlIGVkZ2Ugb2YgYW4gaW5saW5lIG5vZGUsIG1vdmUgaXQgb3V0c2lkZQogICAgICAgIC8vIGluc3RlYWQgc2luY2UgaXQgd2lsbCBuZWVkIHRvIGJlIHNwbGl0IG90aGVyd2lzZS4KCgogICAgICAgIHZhciBpbmxpbmVFbGVtZW50TWF0Y2ggPSBFZGl0b3IuYWJvdmUoZWRpdG9yLCB7CiAgICAgICAgICBhdDogYXQsCiAgICAgICAgICBtYXRjaDogZnVuY3Rpb24gbWF0Y2gobikgewogICAgICAgICAgICByZXR1cm4gRWRpdG9yLmlzSW5saW5lKGVkaXRvciwgbik7CiAgICAgICAgICB9LAogICAgICAgICAgbW9kZTogJ2hpZ2hlc3QnLAogICAgICAgICAgdm9pZHM6IHZvaWRzCiAgICAgICAgfSk7CgogICAgICAgIGlmIChpbmxpbmVFbGVtZW50TWF0Y2gpIHsKICAgICAgICAgIHZhciBfaW5saW5lRWxlbWVudE1hdGNoID0gX3NsaWNlZFRvQXJyYXkoaW5saW5lRWxlbWVudE1hdGNoLCAyKSwKICAgICAgICAgICAgICBfaW5saW5lUGF0aCA9IF9pbmxpbmVFbGVtZW50TWF0Y2hbMV07CgogICAgICAgICAgaWYgKEVkaXRvci5pc0VuZChlZGl0b3IsIGF0LCBfaW5saW5lUGF0aCkpIHsKICAgICAgICAgICAgdmFyIGFmdGVyID0gRWRpdG9yLmFmdGVyKGVkaXRvciwgX2lubGluZVBhdGgpOwogICAgICAgICAgICBhdCA9IGFmdGVyOwogICAgICAgICAgfSBlbHNlIGlmIChFZGl0b3IuaXNTdGFydChlZGl0b3IsIGF0LCBfaW5saW5lUGF0aCkpIHsKICAgICAgICAgICAgdmFyIGJlZm9yZSA9IEVkaXRvci5iZWZvcmUoZWRpdG9yLCBfaW5saW5lUGF0aCk7CiAgICAgICAgICAgIGF0ID0gYmVmb3JlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIGJsb2NrTWF0Y2ggPSBFZGl0b3IuYWJvdmUoZWRpdG9yLCB7CiAgICAgICAgICBtYXRjaDogZnVuY3Rpb24gbWF0Y2gobikgewogICAgICAgICAgICByZXR1cm4gRWRpdG9yLmlzQmxvY2soZWRpdG9yLCBuKTsKICAgICAgICAgIH0sCiAgICAgICAgICBhdDogYXQsCiAgICAgICAgICB2b2lkczogdm9pZHMKICAgICAgICB9KTsKCiAgICAgICAgdmFyIF9ibG9ja01hdGNoID0gX3NsaWNlZFRvQXJyYXkoYmxvY2tNYXRjaCwgMiksCiAgICAgICAgICAgIGJsb2NrUGF0aCA9IF9ibG9ja01hdGNoWzFdOwoKICAgICAgICB2YXIgaXNCbG9ja1N0YXJ0ID0gRWRpdG9yLmlzU3RhcnQoZWRpdG9yLCBhdCwgYmxvY2tQYXRoKTsKICAgICAgICB2YXIgaXNCbG9ja0VuZCA9IEVkaXRvci5pc0VuZChlZGl0b3IsIGF0LCBibG9ja1BhdGgpOwogICAgICAgIHZhciBpc0Jsb2NrRW1wdHkgPSBpc0Jsb2NrU3RhcnQgJiYgaXNCbG9ja0VuZDsKICAgICAgICB2YXIgbWVyZ2VTdGFydCA9ICFpc0Jsb2NrU3RhcnQgfHwgaXNCbG9ja1N0YXJ0ICYmIGlzQmxvY2tFbmQ7CiAgICAgICAgdmFyIG1lcmdlRW5kID0gIWlzQmxvY2tFbmQ7CgogICAgICAgIHZhciBfTm9kZSRmaXJzdCA9IE5vZGUkMS5maXJzdCh7CiAgICAgICAgICBjaGlsZHJlbjogZnJhZ21lbnQKICAgICAgICB9LCBbXSksCiAgICAgICAgICAgIF9Ob2RlJGZpcnN0MiA9IF9zbGljZWRUb0FycmF5KF9Ob2RlJGZpcnN0LCAyKSwKICAgICAgICAgICAgZmlyc3RQYXRoID0gX05vZGUkZmlyc3QyWzFdOwoKICAgICAgICB2YXIgX05vZGUkbGFzdCA9IE5vZGUkMS5sYXN0KHsKICAgICAgICAgIGNoaWxkcmVuOiBmcmFnbWVudAogICAgICAgIH0sIFtdKSwKICAgICAgICAgICAgX05vZGUkbGFzdDIgPSBfc2xpY2VkVG9BcnJheShfTm9kZSRsYXN0LCAyKSwKICAgICAgICAgICAgbGFzdFBhdGggPSBfTm9kZSRsYXN0MlsxXTsKCiAgICAgICAgdmFyIG1hdGNoZXMgPSBbXTsKCiAgICAgICAgdmFyIG1hdGNoZXIgPSBmdW5jdGlvbiBtYXRjaGVyKF9yZWYzKSB7CiAgICAgICAgICB2YXIgX3JlZjQgPSBfc2xpY2VkVG9BcnJheShfcmVmMywgMiksCiAgICAgICAgICAgICAgbiA9IF9yZWY0WzBdLAogICAgICAgICAgICAgIHAgPSBfcmVmNFsxXTsKCiAgICAgICAgICB2YXIgaXNSb290ID0gcC5sZW5ndGggPT09IDA7CgogICAgICAgICAgaWYgKGlzUm9vdCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGlzQmxvY2tFbXB0eSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAobWVyZ2VTdGFydCAmJiBQYXRoLmlzQW5jZXN0b3IocCwgZmlyc3RQYXRoKSAmJiBFbGVtZW50JDEuaXNFbGVtZW50KG4pICYmICFlZGl0b3IuaXNWb2lkKG4pICYmICFlZGl0b3IuaXNJbmxpbmUobikpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChtZXJnZUVuZCAmJiBQYXRoLmlzQW5jZXN0b3IocCwgbGFzdFBhdGgpICYmIEVsZW1lbnQkMS5pc0VsZW1lbnQobikgJiYgIWVkaXRvci5pc1ZvaWQobikgJiYgIWVkaXRvci5pc0lubGluZShuKSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfTsKCiAgICAgICAgdmFyIF9pdGVyYXRvcjIgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihOb2RlJDEubm9kZXMoewogICAgICAgICAgY2hpbGRyZW46IGZyYWdtZW50CiAgICAgICAgfSwgewogICAgICAgICAgcGFzczogbWF0Y2hlcgogICAgICAgIH0pKSwKICAgICAgICAgICAgX3N0ZXAyOwoKICAgICAgICB0cnkgewogICAgICAgICAgZm9yIChfaXRlcmF0b3IyLnMoKTsgIShfc3RlcDIgPSBfaXRlcmF0b3IyLm4oKSkuZG9uZTspIHsKICAgICAgICAgICAgdmFyIGVudHJ5ID0gX3N0ZXAyLnZhbHVlOwoKICAgICAgICAgICAgaWYgKG1hdGNoZXIoZW50cnkpKSB7CiAgICAgICAgICAgICAgbWF0Y2hlcy5wdXNoKGVudHJ5KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgX2l0ZXJhdG9yMi5lKGVycik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIF9pdGVyYXRvcjIuZigpOwogICAgICAgIH0KCiAgICAgICAgdmFyIHN0YXJ0cyA9IFtdOwogICAgICAgIHZhciBtaWRkbGVzID0gW107CiAgICAgICAgdmFyIGVuZHMgPSBbXTsKICAgICAgICB2YXIgc3RhcnRpbmcgPSB0cnVlOwogICAgICAgIHZhciBoYXNCbG9ja3MgPSBmYWxzZTsKCiAgICAgICAgZm9yICh2YXIgX2kyID0gMCwgX21hdGNoZXMgPSBtYXRjaGVzOyBfaTIgPCBfbWF0Y2hlcy5sZW5ndGg7IF9pMisrKSB7CiAgICAgICAgICB2YXIgX21hdGNoZXMkX2kgPSBfc2xpY2VkVG9BcnJheShfbWF0Y2hlc1tfaTJdLCAxKSwKICAgICAgICAgICAgICBub2RlID0gX21hdGNoZXMkX2lbMF07CgogICAgICAgICAgaWYgKEVsZW1lbnQkMS5pc0VsZW1lbnQobm9kZSkgJiYgIWVkaXRvci5pc0lubGluZShub2RlKSkgewogICAgICAgICAgICBzdGFydGluZyA9IGZhbHNlOwogICAgICAgICAgICBoYXNCbG9ja3MgPSB0cnVlOwogICAgICAgICAgICBtaWRkbGVzLnB1c2gobm9kZSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHN0YXJ0aW5nKSB7CiAgICAgICAgICAgIHN0YXJ0cy5wdXNoKG5vZGUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZW5kcy5wdXNoKG5vZGUpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIF9FZGl0b3Ikbm9kZXMgPSBFZGl0b3Iubm9kZXMoZWRpdG9yLCB7CiAgICAgICAgICBhdDogYXQsCiAgICAgICAgICBtYXRjaDogZnVuY3Rpb24gbWF0Y2gobikgewogICAgICAgICAgICByZXR1cm4gVGV4dC5pc1RleHQobikgfHwgRWRpdG9yLmlzSW5saW5lKGVkaXRvciwgbik7CiAgICAgICAgICB9LAogICAgICAgICAgbW9kZTogJ2hpZ2hlc3QnLAogICAgICAgICAgdm9pZHM6IHZvaWRzCiAgICAgICAgfSksCiAgICAgICAgICAgIF9FZGl0b3Ikbm9kZXMyID0gX3NsaWNlZFRvQXJyYXkoX0VkaXRvciRub2RlcywgMSksCiAgICAgICAgICAgIGlubGluZU1hdGNoID0gX0VkaXRvciRub2RlczJbMF07CgogICAgICAgIHZhciBfaW5saW5lTWF0Y2ggPSBfc2xpY2VkVG9BcnJheShpbmxpbmVNYXRjaCwgMiksCiAgICAgICAgICAgIGlubGluZVBhdGggPSBfaW5saW5lTWF0Y2hbMV07CgogICAgICAgIHZhciBpc0lubGluZVN0YXJ0ID0gRWRpdG9yLmlzU3RhcnQoZWRpdG9yLCBhdCwgaW5saW5lUGF0aCk7CiAgICAgICAgdmFyIGlzSW5saW5lRW5kID0gRWRpdG9yLmlzRW5kKGVkaXRvciwgYXQsIGlubGluZVBhdGgpOwogICAgICAgIHZhciBtaWRkbGVSZWYgPSBFZGl0b3IucGF0aFJlZihlZGl0b3IsIGlzQmxvY2tFbmQgPyBQYXRoLm5leHQoYmxvY2tQYXRoKSA6IGJsb2NrUGF0aCk7CiAgICAgICAgdmFyIGVuZFJlZiA9IEVkaXRvci5wYXRoUmVmKGVkaXRvciwgaXNJbmxpbmVFbmQgPyBQYXRoLm5leHQoaW5saW5lUGF0aCkgOiBpbmxpbmVQYXRoKTsKICAgICAgICB2YXIgYmxvY2tQYXRoUmVmID0gRWRpdG9yLnBhdGhSZWYoZWRpdG9yLCBibG9ja1BhdGgpOwogICAgICAgIFRyYW5zZm9ybXMuc3BsaXROb2RlcyhlZGl0b3IsIHsKICAgICAgICAgIGF0OiBhdCwKICAgICAgICAgIG1hdGNoOiBmdW5jdGlvbiBtYXRjaChuKSB7CiAgICAgICAgICAgIHJldHVybiBoYXNCbG9ja3MgPyBFZGl0b3IuaXNCbG9jayhlZGl0b3IsIG4pIDogVGV4dC5pc1RleHQobikgfHwgRWRpdG9yLmlzSW5saW5lKGVkaXRvciwgbik7CiAgICAgICAgICB9LAogICAgICAgICAgbW9kZTogaGFzQmxvY2tzID8gJ2xvd2VzdCcgOiAnaGlnaGVzdCcsCiAgICAgICAgICB2b2lkczogdm9pZHMKICAgICAgICB9KTsKICAgICAgICB2YXIgc3RhcnRSZWYgPSBFZGl0b3IucGF0aFJlZihlZGl0b3IsICFpc0lubGluZVN0YXJ0IHx8IGlzSW5saW5lU3RhcnQgJiYgaXNJbmxpbmVFbmQgPyBQYXRoLm5leHQoaW5saW5lUGF0aCkgOiBpbmxpbmVQYXRoKTsKICAgICAgICBUcmFuc2Zvcm1zLmluc2VydE5vZGVzKGVkaXRvciwgc3RhcnRzLCB7CiAgICAgICAgICBhdDogc3RhcnRSZWYuY3VycmVudCwKICAgICAgICAgIG1hdGNoOiBmdW5jdGlvbiBtYXRjaChuKSB7CiAgICAgICAgICAgIHJldHVybiBUZXh0LmlzVGV4dChuKSB8fCBFZGl0b3IuaXNJbmxpbmUoZWRpdG9yLCBuKTsKICAgICAgICAgIH0sCiAgICAgICAgICBtb2RlOiAnaGlnaGVzdCcsCiAgICAgICAgICB2b2lkczogdm9pZHMKICAgICAgICB9KTsKCiAgICAgICAgaWYgKGlzQmxvY2tFbXB0eSAmJiBtaWRkbGVzLmxlbmd0aCkgewogICAgICAgICAgVHJhbnNmb3Jtc1siZGVsZXRlIl0oZWRpdG9yLCB7CiAgICAgICAgICAgIGF0OiBibG9ja1BhdGhSZWYudW5yZWYoKSwKICAgICAgICAgICAgdm9pZHM6IHZvaWRzCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIFRyYW5zZm9ybXMuaW5zZXJ0Tm9kZXMoZWRpdG9yLCBtaWRkbGVzLCB7CiAgICAgICAgICBhdDogbWlkZGxlUmVmLmN1cnJlbnQsCiAgICAgICAgICBtYXRjaDogZnVuY3Rpb24gbWF0Y2gobikgewogICAgICAgICAgICByZXR1cm4gRWRpdG9yLmlzQmxvY2soZWRpdG9yLCBuKTsKICAgICAgICAgIH0sCiAgICAgICAgICBtb2RlOiAnbG93ZXN0JywKICAgICAgICAgIHZvaWRzOiB2b2lkcwogICAgICAgIH0pOwogICAgICAgIFRyYW5zZm9ybXMuaW5zZXJ0Tm9kZXMoZWRpdG9yLCBlbmRzLCB7CiAgICAgICAgICBhdDogZW5kUmVmLmN1cnJlbnQsCiAgICAgICAgICBtYXRjaDogZnVuY3Rpb24gbWF0Y2gobikgewogICAgICAgICAgICByZXR1cm4gVGV4dC5pc1RleHQobikgfHwgRWRpdG9yLmlzSW5saW5lKGVkaXRvciwgbik7CiAgICAgICAgICB9LAogICAgICAgICAgbW9kZTogJ2hpZ2hlc3QnLAogICAgICAgICAgdm9pZHM6IHZvaWRzCiAgICAgICAgfSk7CgogICAgICAgIGlmICghb3B0aW9ucy5hdCkgewogICAgICAgICAgdmFyIHBhdGg7CgogICAgICAgICAgaWYgKGVuZHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBwYXRoID0gUGF0aC5wcmV2aW91cyhlbmRSZWYuY3VycmVudCk7CiAgICAgICAgICB9IGVsc2UgaWYgKG1pZGRsZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBwYXRoID0gUGF0aC5wcmV2aW91cyhtaWRkbGVSZWYuY3VycmVudCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwYXRoID0gUGF0aC5wcmV2aW91cyhzdGFydFJlZi5jdXJyZW50KTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgX2VuZDIgPSBFZGl0b3IuZW5kKGVkaXRvciwgcGF0aCk7CgogICAgICAgICAgVHJhbnNmb3Jtcy5zZWxlY3QoZWRpdG9yLCBfZW5kMik7CiAgICAgICAgfQoKICAgICAgICBzdGFydFJlZi51bnJlZigpOwogICAgICAgIG1pZGRsZVJlZi51bnJlZigpOwogICAgICAgIGVuZFJlZi51bnJlZigpOwogICAgICB9KTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBJbnNlcnQgYSBzdHJpbmcgb2YgdGV4dCBpbiB0aGUgRWRpdG9yLgogICAgICovCiAgICBpbnNlcnRUZXh0OiBmdW5jdGlvbiBpbnNlcnRUZXh0KGVkaXRvciwgdGV4dCkgewogICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDoge307CiAgICAgIEVkaXRvci53aXRob3V0Tm9ybWFsaXppbmcoZWRpdG9yLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIF9vcHRpb25zJHZvaWRzMyA9IG9wdGlvbnMudm9pZHMsCiAgICAgICAgICAgIHZvaWRzID0gX29wdGlvbnMkdm9pZHMzID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zJHZvaWRzMzsKICAgICAgICB2YXIgX29wdGlvbnMkYXQzID0gb3B0aW9ucy5hdCwKICAgICAgICAgICAgYXQgPSBfb3B0aW9ucyRhdDMgPT09IHZvaWQgMCA/IGVkaXRvci5zZWxlY3Rpb24gOiBfb3B0aW9ucyRhdDM7CgogICAgICAgIGlmICghYXQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChQYXRoLmlzUGF0aChhdCkpIHsKICAgICAgICAgIGF0ID0gRWRpdG9yLnJhbmdlKGVkaXRvciwgYXQpOwogICAgICAgIH0KCiAgICAgICAgaWYgKFJhbmdlLmlzUmFuZ2UoYXQpKSB7CiAgICAgICAgICBpZiAoUmFuZ2UuaXNDb2xsYXBzZWQoYXQpKSB7CiAgICAgICAgICAgIGF0ID0gYXQuYW5jaG9yOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIGVuZCA9IFJhbmdlLmVuZChhdCk7CgogICAgICAgICAgICBpZiAoIXZvaWRzICYmIEVkaXRvclsidm9pZCJdKGVkaXRvciwgewogICAgICAgICAgICAgIGF0OiBlbmQKICAgICAgICAgICAgfSkpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBwb2ludFJlZiA9IEVkaXRvci5wb2ludFJlZihlZGl0b3IsIGVuZCk7CiAgICAgICAgICAgIFRyYW5zZm9ybXNbImRlbGV0ZSJdKGVkaXRvciwgewogICAgICAgICAgICAgIGF0OiBhdCwKICAgICAgICAgICAgICB2b2lkczogdm9pZHMKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGF0ID0gcG9pbnRSZWYudW5yZWYoKTsKICAgICAgICAgICAgVHJhbnNmb3Jtcy5zZXRTZWxlY3Rpb24oZWRpdG9yLCB7CiAgICAgICAgICAgICAgYW5jaG9yOiBhdCwKICAgICAgICAgICAgICBmb2N1czogYXQKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoIXZvaWRzICYmIEVkaXRvclsidm9pZCJdKGVkaXRvciwgewogICAgICAgICAgYXQ6IGF0CiAgICAgICAgfSkpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBfYXQgPSBhdCwKICAgICAgICAgICAgcGF0aCA9IF9hdC5wYXRoLAogICAgICAgICAgICBvZmZzZXQgPSBfYXQub2Zmc2V0OwogICAgICAgIGlmICh0ZXh0Lmxlbmd0aCA+IDApIGVkaXRvci5hcHBseSh7CiAgICAgICAgICB0eXBlOiAnaW5zZXJ0X3RleHQnLAogICAgICAgICAgcGF0aDogcGF0aCwKICAgICAgICAgIG9mZnNldDogb2Zmc2V0LAogICAgICAgICAgdGV4dDogdGV4dAogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9OwoKICBmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOyBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgeyB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsgaWYgKGVudW1lcmFibGVPbmx5KSB7IHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsgfSBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCiAgZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307IGlmIChpICUgMikgeyBvd25LZXlzKE9iamVjdChzb3VyY2UpLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7IH0pOyB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7IH0gZWxzZSB7IG93bktleXMoT2JqZWN0KHNvdXJjZSkpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsgfSk7IH0gfSByZXR1cm4gdGFyZ2V0OyB9CiAgdmFyIFRyYW5zZm9ybXMgPSBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBHZW5lcmFsVHJhbnNmb3JtcyksIE5vZGVUcmFuc2Zvcm1zKSwgU2VsZWN0aW9uVHJhbnNmb3JtcyksIFRleHRUcmFuc2Zvcm1zKTsKCiAgdmFyIEVkaXRvcl8xID0gRWRpdG9yOwogIHZhciBFbGVtZW50XzEgPSBFbGVtZW50JDE7CiAgdmFyIExvY2F0aW9uXzEgPSBMb2NhdGlvbjsKICB2YXIgTm9kZV8xID0gTm9kZSQxOwogIHZhciBPcGVyYXRpb25fMSA9IE9wZXJhdGlvbjsKICB2YXIgUGF0aF8xID0gUGF0aDsKICB2YXIgUGF0aFJlZl8xID0gUGF0aFJlZjsKICB2YXIgUG9pbnRfMSA9IFBvaW50OwogIHZhciBQb2ludFJlZl8xID0gUG9pbnRSZWY7CiAgdmFyIFJhbmdlXzEgPSBSYW5nZTsKICB2YXIgUmFuZ2VSZWZfMSA9IFJhbmdlUmVmOwogIHZhciBTcGFuXzEgPSBTcGFuOwogIHZhciBUZXh0XzEgPSBUZXh0OwogIHZhciBUcmFuc2Zvcm1zXzEgPSBUcmFuc2Zvcm1zOwogIHZhciBjcmVhdGVFZGl0b3JfMSA9IGNyZWF0ZUVkaXRvciQxOwoKCiAgdmFyIGRpc3QkNyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogIAlFZGl0b3I6IEVkaXRvcl8xLAogIAlFbGVtZW50OiBFbGVtZW50XzEsCiAgCUxvY2F0aW9uOiBMb2NhdGlvbl8xLAogIAlOb2RlOiBOb2RlXzEsCiAgCU9wZXJhdGlvbjogT3BlcmF0aW9uXzEsCiAgCVBhdGg6IFBhdGhfMSwKICAJUGF0aFJlZjogUGF0aFJlZl8xLAogIAlQb2ludDogUG9pbnRfMSwKICAJUG9pbnRSZWY6IFBvaW50UmVmXzEsCiAgCVJhbmdlOiBSYW5nZV8xLAogIAlSYW5nZVJlZjogUmFuZ2VSZWZfMSwKICAJU3BhbjogU3Bhbl8xLAogIAlUZXh0OiBUZXh0XzEsCiAgCVRyYW5zZm9ybXM6IFRyYW5zZm9ybXNfMSwKICAJY3JlYXRlRWRpdG9yOiBjcmVhdGVFZGl0b3JfMQogIH0sICdfX2VzTW9kdWxlJywge3ZhbHVlOiB0cnVlfSk7CgogIC8qKgogICAqIGxvZGFzaCAoQ3VzdG9tIEJ1aWxkKSA8aHR0cHM6Ly9sb2Rhc2guY29tLz4KICAgKiBCdWlsZDogYGxvZGFzaCBtb2R1bGFyaXplIGV4cG9ydHM9Im5wbSIgLW8gLi9gCiAgICogQ29weXJpZ2h0IGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMgPGh0dHBzOi8vanF1ZXJ5Lm9yZy8+CiAgICogUmVsZWFzZWQgdW5kZXIgTUlUIGxpY2Vuc2UgPGh0dHBzOi8vbG9kYXNoLmNvbS9saWNlbnNlPgogICAqIEJhc2VkIG9uIFVuZGVyc2NvcmUuanMgMS44LjMgPGh0dHA6Ly91bmRlcnNjb3JlanMub3JnL0xJQ0VOU0U+CiAgICogQ29weXJpZ2h0IEplcmVteSBBc2hrZW5hcywgRG9jdW1lbnRDbG91ZCBhbmQgSW52ZXN0aWdhdGl2ZSBSZXBvcnRlcnMgJiBFZGl0b3JzCiAgICovCgogIC8qKiBVc2VkIGFzIHJlZmVyZW5jZXMgZm9yIHZhcmlvdXMgYE51bWJlcmAgY29uc3RhbnRzLiAqLwogIHZhciBNQVhfU0FGRV9JTlRFR0VSJDEgPSA5MDA3MTk5MjU0NzQwOTkxOwoKICAvKiogYE9iamVjdCN0b1N0cmluZ2AgcmVzdWx0IHJlZmVyZW5jZXMuICovCiAgdmFyIGFyZ3NUYWckMSA9ICdbb2JqZWN0IEFyZ3VtZW50c10nLAogICAgICBmdW5jVGFnJDEgPSAnW29iamVjdCBGdW5jdGlvbl0nLAogICAgICBnZW5UYWckMSA9ICdbb2JqZWN0IEdlbmVyYXRvckZ1bmN0aW9uXScsCiAgICAgIG1hcFRhZyA9ICdbb2JqZWN0IE1hcF0nLAogICAgICBvYmplY3RUYWcgPSAnW29iamVjdCBPYmplY3RdJywKICAgICAgcHJvbWlzZVRhZyA9ICdbb2JqZWN0IFByb21pc2VdJywKICAgICAgc2V0VGFnID0gJ1tvYmplY3QgU2V0XScsCiAgICAgIHN0cmluZ1RhZyA9ICdbb2JqZWN0IFN0cmluZ10nLAogICAgICB3ZWFrTWFwVGFnID0gJ1tvYmplY3QgV2Vha01hcF0nOwoKICB2YXIgZGF0YVZpZXdUYWcgPSAnW29iamVjdCBEYXRhVmlld10nOwoKICAvKioKICAgKiBVc2VkIHRvIG1hdGNoIGBSZWdFeHBgCiAgICogW3N5bnRheCBjaGFyYWN0ZXJzXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1wYXR0ZXJucykuCiAgICovCiAgdmFyIHJlUmVnRXhwQ2hhciA9IC9bXFxeJC4qKz8oKVtcXXt9fF0vZzsKCiAgLyoqIFVzZWQgdG8gZGV0ZWN0IGhvc3QgY29uc3RydWN0b3JzIChTYWZhcmkpLiAqLwogIHZhciByZUlzSG9zdEN0b3IgPSAvXlxbb2JqZWN0IC4rP0NvbnN0cnVjdG9yXF0kLzsKCiAgLyoqIFVzZWQgdG8gZGV0ZWN0IHVuc2lnbmVkIGludGVnZXIgdmFsdWVzLiAqLwogIHZhciByZUlzVWludCQxID0gL14oPzowfFsxLTldXGQqKSQvOwoKICAvKiogVXNlZCB0byBjb21wb3NlIHVuaWNvZGUgY2hhcmFjdGVyIGNsYXNzZXMuICovCiAgdmFyIHJzQXN0cmFsUmFuZ2UkMSA9ICdcXHVkODAwLVxcdWRmZmYnLAogICAgICByc0NvbWJvTWFya3NSYW5nZSQxID0gJ1xcdTAzMDAtXFx1MDM2ZlxcdWZlMjAtXFx1ZmUyMycsCiAgICAgIHJzQ29tYm9TeW1ib2xzUmFuZ2UkMSA9ICdcXHUyMGQwLVxcdTIwZjAnLAogICAgICByc1ZhclJhbmdlJDEgPSAnXFx1ZmUwZVxcdWZlMGYnOwoKICAvKiogVXNlZCB0byBjb21wb3NlIHVuaWNvZGUgY2FwdHVyZSBncm91cHMuICovCiAgdmFyIHJzQXN0cmFsJDEgPSAnWycgKyByc0FzdHJhbFJhbmdlJDEgKyAnXScsCiAgICAgIHJzQ29tYm8kMSA9ICdbJyArIHJzQ29tYm9NYXJrc1JhbmdlJDEgKyByc0NvbWJvU3ltYm9sc1JhbmdlJDEgKyAnXScsCiAgICAgIHJzRml0eiQxID0gJ1xcdWQ4M2NbXFx1ZGZmYi1cXHVkZmZmXScsCiAgICAgIHJzTW9kaWZpZXIkMSA9ICcoPzonICsgcnNDb21ibyQxICsgJ3wnICsgcnNGaXR6JDEgKyAnKScsCiAgICAgIHJzTm9uQXN0cmFsJDEgPSAnW14nICsgcnNBc3RyYWxSYW5nZSQxICsgJ10nLAogICAgICByc1JlZ2lvbmFsJDEgPSAnKD86XFx1ZDgzY1tcXHVkZGU2LVxcdWRkZmZdKXsyfScsCiAgICAgIHJzU3VyclBhaXIkMSA9ICdbXFx1ZDgwMC1cXHVkYmZmXVtcXHVkYzAwLVxcdWRmZmZdJywKICAgICAgcnNaV0okMSA9ICdcXHUyMDBkJzsKCiAgLyoqIFVzZWQgdG8gY29tcG9zZSB1bmljb2RlIHJlZ2V4ZXMuICovCiAgdmFyIHJlT3B0TW9kJDEgPSByc01vZGlmaWVyJDEgKyAnPycsCiAgICAgIHJzT3B0VmFyJDEgPSAnWycgKyByc1ZhclJhbmdlJDEgKyAnXT8nLAogICAgICByc09wdEpvaW4kMSA9ICcoPzonICsgcnNaV0okMSArICcoPzonICsgW3JzTm9uQXN0cmFsJDEsIHJzUmVnaW9uYWwkMSwgcnNTdXJyUGFpciQxXS5qb2luKCd8JykgKyAnKScgKyByc09wdFZhciQxICsgcmVPcHRNb2QkMSArICcpKicsCiAgICAgIHJzU2VxJDEgPSByc09wdFZhciQxICsgcmVPcHRNb2QkMSArIHJzT3B0Sm9pbiQxLAogICAgICByc1N5bWJvbCQxID0gJyg/OicgKyBbcnNOb25Bc3RyYWwkMSArIHJzQ29tYm8kMSArICc/JywgcnNDb21ibyQxLCByc1JlZ2lvbmFsJDEsIHJzU3VyclBhaXIkMSwgcnNBc3RyYWwkMV0uam9pbignfCcpICsgJyknOwoKICAvKiogVXNlZCB0byBtYXRjaCBbc3RyaW5nIHN5bWJvbHNdKGh0dHBzOi8vbWF0aGlhc2J5bmVucy5iZS9ub3Rlcy9qYXZhc2NyaXB0LXVuaWNvZGUpLiAqLwogIHZhciByZVVuaWNvZGUkMSA9IFJlZ0V4cChyc0ZpdHokMSArICcoPz0nICsgcnNGaXR6JDEgKyAnKXwnICsgcnNTeW1ib2wkMSArIHJzU2VxJDEsICdnJyk7CgogIC8qKiBVc2VkIHRvIGRldGVjdCBzdHJpbmdzIHdpdGggW3plcm8td2lkdGggam9pbmVycyBvciBjb2RlIHBvaW50cyBmcm9tIHRoZSBhc3RyYWwgcGxhbmVzXShodHRwOi8vZWV2LmVlL2Jsb2cvMjAxNS8wOS8xMi9kYXJrLWNvcm5lcnMtb2YtdW5pY29kZS8pLiAqLwogIHZhciByZUhhc1VuaWNvZGUkMSA9IFJlZ0V4cCgnWycgKyByc1pXSiQxICsgcnNBc3RyYWxSYW5nZSQxICArIHJzQ29tYm9NYXJrc1JhbmdlJDEgKyByc0NvbWJvU3ltYm9sc1JhbmdlJDEgKyByc1ZhclJhbmdlJDEgKyAnXScpOwoKICAvKiogRGV0ZWN0IGZyZWUgdmFyaWFibGUgYGdsb2JhbGAgZnJvbSBOb2RlLmpzLiAqLwogIHZhciBmcmVlR2xvYmFsJDMgPSB0eXBlb2YgY29tbW9uanNHbG9iYWwgPT0gJ29iamVjdCcgJiYgY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuT2JqZWN0ID09PSBPYmplY3QgJiYgY29tbW9uanNHbG9iYWw7CgogIC8qKiBEZXRlY3QgZnJlZSB2YXJpYWJsZSBgc2VsZmAuICovCiAgdmFyIGZyZWVTZWxmJDMgPSB0eXBlb2Ygc2VsZiA9PSAnb2JqZWN0JyAmJiBzZWxmICYmIHNlbGYuT2JqZWN0ID09PSBPYmplY3QgJiYgc2VsZjsKCiAgLyoqIFVzZWQgYXMgYSByZWZlcmVuY2UgdG8gdGhlIGdsb2JhbCBvYmplY3QuICovCiAgdmFyIHJvb3QkMyA9IGZyZWVHbG9iYWwkMyB8fCBmcmVlU2VsZiQzIHx8IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7CgogIC8qKgogICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgXy5tYXBgIGZvciBhcnJheXMgd2l0aG91dCBzdXBwb3J0IGZvciBpdGVyYXRlZQogICAqIHNob3J0aGFuZHMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IFthcnJheV0gVGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IG1hcHBlZCBhcnJheS4KICAgKi8KICBmdW5jdGlvbiBhcnJheU1hcChhcnJheSwgaXRlcmF0ZWUpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IGFycmF5ID8gYXJyYXkubGVuZ3RoIDogMCwKICAgICAgICByZXN1bHQgPSBBcnJheShsZW5ndGgpOwoKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIHJlc3VsdFtpbmRleF0gPSBpdGVyYXRlZShhcnJheVtpbmRleF0sIGluZGV4LCBhcnJheSk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYW4gQVNDSUkgYHN0cmluZ2AgdG8gYW4gYXJyYXkuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7c3RyaW5nfSBzdHJpbmcgVGhlIHN0cmluZyB0byBjb252ZXJ0LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgY29udmVydGVkIGFycmF5LgogICAqLwogIGZ1bmN0aW9uIGFzY2lpVG9BcnJheSQxKHN0cmluZykgewogICAgcmV0dXJuIHN0cmluZy5zcGxpdCgnJyk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy50aW1lc2Agd2l0aG91dCBzdXBwb3J0IGZvciBpdGVyYXRlZSBzaG9ydGhhbmRzCiAgICogb3IgbWF4IGFycmF5IGxlbmd0aCBjaGVja3MuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7bnVtYmVyfSBuIFRoZSBudW1iZXIgb2YgdGltZXMgdG8gaW52b2tlIGBpdGVyYXRlZWAuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gaXRlcmF0ZWUgVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHJlc3VsdHMuCiAgICovCiAgZnVuY3Rpb24gYmFzZVRpbWVzJDEobiwgaXRlcmF0ZWUpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIHJlc3VsdCA9IEFycmF5KG4pOwoKICAgIHdoaWxlICgrK2luZGV4IDwgbikgewogICAgICByZXN1bHRbaW5kZXhdID0gaXRlcmF0ZWUoaW5kZXgpOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnZhbHVlc2AgYW5kIGBfLnZhbHVlc0luYCB3aGljaCBjcmVhdGVzIGFuCiAgICogYXJyYXkgb2YgYG9iamVjdGAgcHJvcGVydHkgdmFsdWVzIGNvcnJlc3BvbmRpbmcgdG8gdGhlIHByb3BlcnR5IG5hbWVzCiAgICogb2YgYHByb3BzYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LgogICAqIEBwYXJhbSB7QXJyYXl9IHByb3BzIFRoZSBwcm9wZXJ0eSBuYW1lcyB0byBnZXQgdmFsdWVzIGZvci4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBhcnJheSBvZiBwcm9wZXJ0eSB2YWx1ZXMuCiAgICovCiAgZnVuY3Rpb24gYmFzZVZhbHVlcyhvYmplY3QsIHByb3BzKSB7CiAgICByZXR1cm4gYXJyYXlNYXAocHJvcHMsIGZ1bmN0aW9uKGtleSkgewogICAgICByZXR1cm4gb2JqZWN0W2tleV07CiAgICB9KTsKICB9CgogIC8qKgogICAqIEdldHMgdGhlIHZhbHVlIGF0IGBrZXlgIG9mIGBvYmplY3RgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gW29iamVjdF0gVGhlIG9iamVjdCB0byBxdWVyeS4KICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHByb3BlcnR5IHRvIGdldC4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgcHJvcGVydHkgdmFsdWUuCiAgICovCiAgZnVuY3Rpb24gZ2V0VmFsdWUob2JqZWN0LCBrZXkpIHsKICAgIHJldHVybiBvYmplY3QgPT0gbnVsbCA/IHVuZGVmaW5lZCA6IG9iamVjdFtrZXldOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGBzdHJpbmdgIGNvbnRhaW5zIFVuaWNvZGUgc3ltYm9scy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtzdHJpbmd9IHN0cmluZyBUaGUgc3RyaW5nIHRvIGluc3BlY3QuCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGEgc3ltYm9sIGlzIGZvdW5kLCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gaGFzVW5pY29kZSQxKHN0cmluZykgewogICAgcmV0dXJuIHJlSGFzVW5pY29kZSQxLnRlc3Qoc3RyaW5nKTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGEgaG9zdCBvYmplY3QgaW4gSUUgPCA5LgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIGhvc3Qgb2JqZWN0LCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gaXNIb3N0T2JqZWN0KHZhbHVlKSB7CiAgICAvLyBNYW55IGhvc3Qgb2JqZWN0cyBhcmUgYE9iamVjdGAgb2JqZWN0cyB0aGF0IGNhbiBjb2VyY2UgdG8gc3RyaW5ncwogICAgLy8gZGVzcGl0ZSBoYXZpbmcgaW1wcm9wZXJseSBkZWZpbmVkIGB0b1N0cmluZ2AgbWV0aG9kcy4KICAgIHZhciByZXN1bHQgPSBmYWxzZTsKICAgIGlmICh2YWx1ZSAhPSBudWxsICYmIHR5cGVvZiB2YWx1ZS50b1N0cmluZyAhPSAnZnVuY3Rpb24nKSB7CiAgICAgIHRyeSB7CiAgICAgICAgcmVzdWx0ID0gISEodmFsdWUgKyAnJyk7CiAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYGl0ZXJhdG9yYCB0byBhbiBhcnJheS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IGl0ZXJhdG9yIFRoZSBpdGVyYXRvciB0byBjb252ZXJ0LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgY29udmVydGVkIGFycmF5LgogICAqLwogIGZ1bmN0aW9uIGl0ZXJhdG9yVG9BcnJheShpdGVyYXRvcikgewogICAgdmFyIGRhdGEsCiAgICAgICAgcmVzdWx0ID0gW107CgogICAgd2hpbGUgKCEoZGF0YSA9IGl0ZXJhdG9yLm5leHQoKSkuZG9uZSkgewogICAgICByZXN1bHQucHVzaChkYXRhLnZhbHVlKTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBDb252ZXJ0cyBgbWFwYCB0byBpdHMga2V5LXZhbHVlIHBhaXJzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gbWFwIFRoZSBtYXAgdG8gY29udmVydC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGtleS12YWx1ZSBwYWlycy4KICAgKi8KICBmdW5jdGlvbiBtYXBUb0FycmF5KG1hcCkgewogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgcmVzdWx0ID0gQXJyYXkobWFwLnNpemUpOwoKICAgIG1hcC5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHsKICAgICAgcmVzdWx0WysraW5kZXhdID0gW2tleSwgdmFsdWVdOwogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhIHVuYXJ5IGZ1bmN0aW9uIHRoYXQgaW52b2tlcyBgZnVuY2Agd2l0aCBpdHMgYXJndW1lbnQgdHJhbnNmb3JtZWQuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIHdyYXAuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gdHJhbnNmb3JtIFRoZSBhcmd1bWVudCB0cmFuc2Zvcm0uCiAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZnVuY3Rpb24uCiAgICovCiAgZnVuY3Rpb24gb3ZlckFyZyQxKGZ1bmMsIHRyYW5zZm9ybSkgewogICAgcmV0dXJuIGZ1bmN0aW9uKGFyZykgewogICAgICByZXR1cm4gZnVuYyh0cmFuc2Zvcm0oYXJnKSk7CiAgICB9OwogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYHNldGAgdG8gYW4gYXJyYXkgb2YgaXRzIHZhbHVlcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IHNldCBUaGUgc2V0IHRvIGNvbnZlcnQuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSB2YWx1ZXMuCiAgICovCiAgZnVuY3Rpb24gc2V0VG9BcnJheShzZXQpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIHJlc3VsdCA9IEFycmF5KHNldC5zaXplKTsKCiAgICBzZXQuZm9yRWFjaChmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXN1bHRbKytpbmRleF0gPSB2YWx1ZTsKICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIENvbnZlcnRzIGBzdHJpbmdgIHRvIGFuIGFycmF5LgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge3N0cmluZ30gc3RyaW5nIFRoZSBzdHJpbmcgdG8gY29udmVydC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGNvbnZlcnRlZCBhcnJheS4KICAgKi8KICBmdW5jdGlvbiBzdHJpbmdUb0FycmF5JDEoc3RyaW5nKSB7CiAgICByZXR1cm4gaGFzVW5pY29kZSQxKHN0cmluZykKICAgICAgPyB1bmljb2RlVG9BcnJheSQxKHN0cmluZykKICAgICAgOiBhc2NpaVRvQXJyYXkkMShzdHJpbmcpOwogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYSBVbmljb2RlIGBzdHJpbmdgIHRvIGFuIGFycmF5LgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge3N0cmluZ30gc3RyaW5nIFRoZSBzdHJpbmcgdG8gY29udmVydC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGNvbnZlcnRlZCBhcnJheS4KICAgKi8KICBmdW5jdGlvbiB1bmljb2RlVG9BcnJheSQxKHN0cmluZykgewogICAgcmV0dXJuIHN0cmluZy5tYXRjaChyZVVuaWNvZGUkMSkgfHwgW107CiAgfQoKICAvKiogVXNlZCBmb3IgYnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMuICovCiAgdmFyIGZ1bmNQcm90byA9IEZ1bmN0aW9uLnByb3RvdHlwZSwKICAgICAgb2JqZWN0UHJvdG8kNCA9IE9iamVjdC5wcm90b3R5cGU7CgogIC8qKiBVc2VkIHRvIGRldGVjdCBvdmVycmVhY2hpbmcgY29yZS1qcyBzaGltcy4gKi8KICB2YXIgY29yZUpzRGF0YSA9IHJvb3QkM1snX19jb3JlLWpzX3NoYXJlZF9fJ107CgogIC8qKiBVc2VkIHRvIGRldGVjdCBtZXRob2RzIG1hc3F1ZXJhZGluZyBhcyBuYXRpdmUuICovCiAgdmFyIG1hc2tTcmNLZXkgPSAoZnVuY3Rpb24oKSB7CiAgICB2YXIgdWlkID0gL1teLl0rJC8uZXhlYyhjb3JlSnNEYXRhICYmIGNvcmVKc0RhdGEua2V5cyAmJiBjb3JlSnNEYXRhLmtleXMuSUVfUFJPVE8gfHwgJycpOwogICAgcmV0dXJuIHVpZCA/ICgnU3ltYm9sKHNyYylfMS4nICsgdWlkKSA6ICcnOwogIH0oKSk7CgogIC8qKiBVc2VkIHRvIHJlc29sdmUgdGhlIGRlY29tcGlsZWQgc291cmNlIG9mIGZ1bmN0aW9ucy4gKi8KICB2YXIgZnVuY1RvU3RyaW5nID0gZnVuY1Byb3RvLnRvU3RyaW5nOwoKICAvKiogVXNlZCB0byBjaGVjayBvYmplY3RzIGZvciBvd24gcHJvcGVydGllcy4gKi8KICB2YXIgaGFzT3duUHJvcGVydHkkMiA9IG9iamVjdFByb3RvJDQuaGFzT3duUHJvcGVydHk7CgogIC8qKgogICAqIFVzZWQgdG8gcmVzb2x2ZSB0aGUKICAgKiBbYHRvU3RyaW5nVGFnYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtb2JqZWN0LnByb3RvdHlwZS50b3N0cmluZykKICAgKiBvZiB2YWx1ZXMuCiAgICovCiAgdmFyIG9iamVjdFRvU3RyaW5nJDQgPSBvYmplY3RQcm90byQ0LnRvU3RyaW5nOwoKICAvKiogVXNlZCB0byBkZXRlY3QgaWYgYSBtZXRob2QgaXMgbmF0aXZlLiAqLwogIHZhciByZUlzTmF0aXZlID0gUmVnRXhwKCdeJyArCiAgICBmdW5jVG9TdHJpbmcuY2FsbChoYXNPd25Qcm9wZXJ0eSQyKS5yZXBsYWNlKHJlUmVnRXhwQ2hhciwgJ1xcJCYnKQogICAgLnJlcGxhY2UoL2hhc093blByb3BlcnR5fChmdW5jdGlvbikuKj8oPz1cXFwoKXwgZm9yIC4rPyg/PVxcXF0pL2csICckMS4qPycpICsgJyQnCiAgKTsKCiAgLyoqIEJ1aWx0LWluIHZhbHVlIHJlZmVyZW5jZXMuICovCiAgdmFyIFN5bWJvbCQyID0gcm9vdCQzLlN5bWJvbCwKICAgICAgaXRlcmF0b3JTeW1ib2wgPSBTeW1ib2wkMiA/IFN5bWJvbCQyLml0ZXJhdG9yIDogdW5kZWZpbmVkLAogICAgICBwcm9wZXJ0eUlzRW51bWVyYWJsZSQxID0gb2JqZWN0UHJvdG8kNC5wcm9wZXJ0eUlzRW51bWVyYWJsZTsKCiAgLyogQnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMgZm9yIHRob3NlIHdpdGggdGhlIHNhbWUgbmFtZSBhcyBvdGhlciBgbG9kYXNoYCBtZXRob2RzLiAqLwogIHZhciBuYXRpdmVLZXlzJDEgPSBvdmVyQXJnJDEoT2JqZWN0LmtleXMsIE9iamVjdCk7CgogIC8qIEJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzIHRoYXQgYXJlIHZlcmlmaWVkIHRvIGJlIG5hdGl2ZS4gKi8KICB2YXIgRGF0YVZpZXcgPSBnZXROYXRpdmUocm9vdCQzLCAnRGF0YVZpZXcnKSwKICAgICAgTWFwJDEgPSBnZXROYXRpdmUocm9vdCQzLCAnTWFwJyksCiAgICAgIFByb21pc2UkMSA9IGdldE5hdGl2ZShyb290JDMsICdQcm9taXNlJyksCiAgICAgIFNldCQxID0gZ2V0TmF0aXZlKHJvb3QkMywgJ1NldCcpLAogICAgICBXZWFrTWFwJDEgPSBnZXROYXRpdmUocm9vdCQzLCAnV2Vha01hcCcpOwoKICAvKiogVXNlZCB0byBkZXRlY3QgbWFwcywgc2V0cywgYW5kIHdlYWttYXBzLiAqLwogIHZhciBkYXRhVmlld0N0b3JTdHJpbmcgPSB0b1NvdXJjZShEYXRhVmlldyksCiAgICAgIG1hcEN0b3JTdHJpbmcgPSB0b1NvdXJjZShNYXAkMSksCiAgICAgIHByb21pc2VDdG9yU3RyaW5nID0gdG9Tb3VyY2UoUHJvbWlzZSQxKSwKICAgICAgc2V0Q3RvclN0cmluZyA9IHRvU291cmNlKFNldCQxKSwKICAgICAgd2Vha01hcEN0b3JTdHJpbmcgPSB0b1NvdXJjZShXZWFrTWFwJDEpOwoKICAvKioKICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIHRoZSBlbnVtZXJhYmxlIHByb3BlcnR5IG5hbWVzIG9mIHRoZSBhcnJheS1saWtlIGB2YWx1ZWAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHF1ZXJ5LgogICAqIEBwYXJhbSB7Ym9vbGVhbn0gaW5oZXJpdGVkIFNwZWNpZnkgcmV0dXJuaW5nIGluaGVyaXRlZCBwcm9wZXJ0eSBuYW1lcy4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IG5hbWVzLgogICAqLwogIGZ1bmN0aW9uIGFycmF5TGlrZUtleXMkMSh2YWx1ZSwgaW5oZXJpdGVkKSB7CiAgICAvLyBTYWZhcmkgOC4xIG1ha2VzIGBhcmd1bWVudHMuY2FsbGVlYCBlbnVtZXJhYmxlIGluIHN0cmljdCBtb2RlLgogICAgLy8gU2FmYXJpIDkgbWFrZXMgYGFyZ3VtZW50cy5sZW5ndGhgIGVudW1lcmFibGUgaW4gc3RyaWN0IG1vZGUuCiAgICB2YXIgcmVzdWx0ID0gKGlzQXJyYXkkMSh2YWx1ZSkgfHwgaXNBcmd1bWVudHMkMSh2YWx1ZSkpCiAgICAgID8gYmFzZVRpbWVzJDEodmFsdWUubGVuZ3RoLCBTdHJpbmcpCiAgICAgIDogW107CgogICAgdmFyIGxlbmd0aCA9IHJlc3VsdC5sZW5ndGgsCiAgICAgICAgc2tpcEluZGV4ZXMgPSAhIWxlbmd0aDsKCiAgICBmb3IgKHZhciBrZXkgaW4gdmFsdWUpIHsKICAgICAgaWYgKChpbmhlcml0ZWQgfHwgaGFzT3duUHJvcGVydHkkMi5jYWxsKHZhbHVlLCBrZXkpKSAmJgogICAgICAgICAgIShza2lwSW5kZXhlcyAmJiAoa2V5ID09ICdsZW5ndGgnIHx8IGlzSW5kZXgkMShrZXksIGxlbmd0aCkpKSkgewogICAgICAgIHJlc3VsdC5wdXNoKGtleSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgZ2V0VGFnYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcXVlcnkuCiAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgYHRvU3RyaW5nVGFnYC4KICAgKi8KICBmdW5jdGlvbiBiYXNlR2V0VGFnKHZhbHVlKSB7CiAgICByZXR1cm4gb2JqZWN0VG9TdHJpbmckNC5jYWxsKHZhbHVlKTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmlzTmF0aXZlYCB3aXRob3V0IGJhZCBzaGltIGNoZWNrcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBuYXRpdmUgZnVuY3Rpb24sCiAgICogIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBiYXNlSXNOYXRpdmUodmFsdWUpIHsKICAgIGlmICghaXNPYmplY3QkMyh2YWx1ZSkgfHwgaXNNYXNrZWQodmFsdWUpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHZhciBwYXR0ZXJuID0gKGlzRnVuY3Rpb24kMSh2YWx1ZSkgfHwgaXNIb3N0T2JqZWN0KHZhbHVlKSkgPyByZUlzTmF0aXZlIDogcmVJc0hvc3RDdG9yOwogICAgcmV0dXJuIHBhdHRlcm4udGVzdCh0b1NvdXJjZSh2YWx1ZSkpOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8ua2V5c2Agd2hpY2ggZG9lc24ndCB0cmVhdCBzcGFyc2UgYXJyYXlzIGFzIGRlbnNlLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBvZiBwcm9wZXJ0eSBuYW1lcy4KICAgKi8KICBmdW5jdGlvbiBiYXNlS2V5cyQxKG9iamVjdCkgewogICAgaWYgKCFpc1Byb3RvdHlwZSQxKG9iamVjdCkpIHsKICAgICAgcmV0dXJuIG5hdGl2ZUtleXMkMShvYmplY3QpOwogICAgfQogICAgdmFyIHJlc3VsdCA9IFtdOwogICAgZm9yICh2YXIga2V5IGluIE9iamVjdChvYmplY3QpKSB7CiAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eSQyLmNhbGwob2JqZWN0LCBrZXkpICYmIGtleSAhPSAnY29uc3RydWN0b3InKSB7CiAgICAgICAgcmVzdWx0LnB1c2goa2V5KTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIENvcGllcyB0aGUgdmFsdWVzIG9mIGBzb3VyY2VgIHRvIGBhcnJheWAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IHNvdXJjZSBUaGUgYXJyYXkgdG8gY29weSB2YWx1ZXMgZnJvbS4KICAgKiBAcGFyYW0ge0FycmF5fSBbYXJyYXk9W11dIFRoZSBhcnJheSB0byBjb3B5IHZhbHVlcyB0by4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC4KICAgKi8KICBmdW5jdGlvbiBjb3B5QXJyYXkoc291cmNlLCBhcnJheSkgewogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgbGVuZ3RoID0gc291cmNlLmxlbmd0aDsKCiAgICBhcnJheSB8fCAoYXJyYXkgPSBBcnJheShsZW5ndGgpKTsKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIGFycmF5W2luZGV4XSA9IHNvdXJjZVtpbmRleF07CiAgICB9CiAgICByZXR1cm4gYXJyYXk7CiAgfQoKICAvKioKICAgKiBHZXRzIHRoZSBuYXRpdmUgZnVuY3Rpb24gYXQgYGtleWAgb2YgYG9iamVjdGAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS4KICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIG1ldGhvZCB0byBnZXQuCiAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGZ1bmN0aW9uIGlmIGl0J3MgbmF0aXZlLCBlbHNlIGB1bmRlZmluZWRgLgogICAqLwogIGZ1bmN0aW9uIGdldE5hdGl2ZShvYmplY3QsIGtleSkgewogICAgdmFyIHZhbHVlID0gZ2V0VmFsdWUob2JqZWN0LCBrZXkpOwogICAgcmV0dXJuIGJhc2VJc05hdGl2ZSh2YWx1ZSkgPyB2YWx1ZSA6IHVuZGVmaW5lZDsKICB9CgogIC8qKgogICAqIEdldHMgdGhlIGB0b1N0cmluZ1RhZ2Agb2YgYHZhbHVlYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcXVlcnkuCiAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgYHRvU3RyaW5nVGFnYC4KICAgKi8KICB2YXIgZ2V0VGFnID0gYmFzZUdldFRhZzsKCiAgLy8gRmFsbGJhY2sgZm9yIGRhdGEgdmlld3MsIG1hcHMsIHNldHMsIGFuZCB3ZWFrIG1hcHMgaW4gSUUgMTEsCiAgLy8gZm9yIGRhdGEgdmlld3MgaW4gRWRnZSA8IDE0LCBhbmQgcHJvbWlzZXMgaW4gTm9kZS5qcy4KICBpZiAoKERhdGFWaWV3ICYmIGdldFRhZyhuZXcgRGF0YVZpZXcobmV3IEFycmF5QnVmZmVyKDEpKSkgIT0gZGF0YVZpZXdUYWcpIHx8CiAgICAgIChNYXAkMSAmJiBnZXRUYWcobmV3IE1hcCQxKSAhPSBtYXBUYWcpIHx8CiAgICAgIChQcm9taXNlJDEgJiYgZ2V0VGFnKFByb21pc2UkMS5yZXNvbHZlKCkpICE9IHByb21pc2VUYWcpIHx8CiAgICAgIChTZXQkMSAmJiBnZXRUYWcobmV3IFNldCQxKSAhPSBzZXRUYWcpIHx8CiAgICAgIChXZWFrTWFwJDEgJiYgZ2V0VGFnKG5ldyBXZWFrTWFwJDEpICE9IHdlYWtNYXBUYWcpKSB7CiAgICBnZXRUYWcgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICB2YXIgcmVzdWx0ID0gb2JqZWN0VG9TdHJpbmckNC5jYWxsKHZhbHVlKSwKICAgICAgICAgIEN0b3IgPSByZXN1bHQgPT0gb2JqZWN0VGFnID8gdmFsdWUuY29uc3RydWN0b3IgOiB1bmRlZmluZWQsCiAgICAgICAgICBjdG9yU3RyaW5nID0gQ3RvciA/IHRvU291cmNlKEN0b3IpIDogdW5kZWZpbmVkOwoKICAgICAgaWYgKGN0b3JTdHJpbmcpIHsKICAgICAgICBzd2l0Y2ggKGN0b3JTdHJpbmcpIHsKICAgICAgICAgIGNhc2UgZGF0YVZpZXdDdG9yU3RyaW5nOiByZXR1cm4gZGF0YVZpZXdUYWc7CiAgICAgICAgICBjYXNlIG1hcEN0b3JTdHJpbmc6IHJldHVybiBtYXBUYWc7CiAgICAgICAgICBjYXNlIHByb21pc2VDdG9yU3RyaW5nOiByZXR1cm4gcHJvbWlzZVRhZzsKICAgICAgICAgIGNhc2Ugc2V0Q3RvclN0cmluZzogcmV0dXJuIHNldFRhZzsKICAgICAgICAgIGNhc2Ugd2Vha01hcEN0b3JTdHJpbmc6IHJldHVybiB3ZWFrTWFwVGFnOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGEgdmFsaWQgYXJyYXktbGlrZSBpbmRleC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHBhcmFtIHtudW1iZXJ9IFtsZW5ndGg9TUFYX1NBRkVfSU5URUdFUl0gVGhlIHVwcGVyIGJvdW5kcyBvZiBhIHZhbGlkIGluZGV4LgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgdmFsaWQgaW5kZXgsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBpc0luZGV4JDEodmFsdWUsIGxlbmd0aCkgewogICAgbGVuZ3RoID0gbGVuZ3RoID09IG51bGwgPyBNQVhfU0FGRV9JTlRFR0VSJDEgOiBsZW5ndGg7CiAgICByZXR1cm4gISFsZW5ndGggJiYKICAgICAgKHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJyB8fCByZUlzVWludCQxLnRlc3QodmFsdWUpKSAmJgogICAgICAodmFsdWUgPiAtMSAmJiB2YWx1ZSAlIDEgPT0gMCAmJiB2YWx1ZSA8IGxlbmd0aCk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYGZ1bmNgIGhhcyBpdHMgc291cmNlIG1hc2tlZC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGBmdW5jYCBpcyBtYXNrZWQsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBpc01hc2tlZChmdW5jKSB7CiAgICByZXR1cm4gISFtYXNrU3JjS2V5ICYmIChtYXNrU3JjS2V5IGluIGZ1bmMpOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgbGlrZWx5IGEgcHJvdG90eXBlIG9iamVjdC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBwcm90b3R5cGUsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBpc1Byb3RvdHlwZSQxKHZhbHVlKSB7CiAgICB2YXIgQ3RvciA9IHZhbHVlICYmIHZhbHVlLmNvbnN0cnVjdG9yLAogICAgICAgIHByb3RvID0gKHR5cGVvZiBDdG9yID09ICdmdW5jdGlvbicgJiYgQ3Rvci5wcm90b3R5cGUpIHx8IG9iamVjdFByb3RvJDQ7CgogICAgcmV0dXJuIHZhbHVlID09PSBwcm90bzsKICB9CgogIC8qKgogICAqIENvbnZlcnRzIGBmdW5jYCB0byBpdHMgc291cmNlIGNvZGUuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIHByb2Nlc3MuCiAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgc291cmNlIGNvZGUuCiAgICovCiAgZnVuY3Rpb24gdG9Tb3VyY2UoZnVuYykgewogICAgaWYgKGZ1bmMgIT0gbnVsbCkgewogICAgICB0cnkgewogICAgICAgIHJldHVybiBmdW5jVG9TdHJpbmcuY2FsbChmdW5jKTsKICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgdHJ5IHsKICAgICAgICByZXR1cm4gKGZ1bmMgKyAnJyk7CiAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICB9CiAgICByZXR1cm4gJyc7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBsaWtlbHkgYW4gYGFyZ3VtZW50c2Agb2JqZWN0LgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDAuMS4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhbiBgYXJndW1lbnRzYCBvYmplY3QsCiAgICogIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc0FyZ3VtZW50cyhmdW5jdGlvbigpIHsgcmV0dXJuIGFyZ3VtZW50czsgfSgpKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzQXJndW1lbnRzKFsxLCAyLCAzXSk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc0FyZ3VtZW50cyQxKHZhbHVlKSB7CiAgICAvLyBTYWZhcmkgOC4xIG1ha2VzIGBhcmd1bWVudHMuY2FsbGVlYCBlbnVtZXJhYmxlIGluIHN0cmljdCBtb2RlLgogICAgcmV0dXJuIGlzQXJyYXlMaWtlT2JqZWN0JDEodmFsdWUpICYmIGhhc093blByb3BlcnR5JDIuY2FsbCh2YWx1ZSwgJ2NhbGxlZScpICYmCiAgICAgICghcHJvcGVydHlJc0VudW1lcmFibGUkMS5jYWxsKHZhbHVlLCAnY2FsbGVlJykgfHwgb2JqZWN0VG9TdHJpbmckNC5jYWxsKHZhbHVlKSA9PSBhcmdzVGFnJDEpOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgY2xhc3NpZmllZCBhcyBhbiBgQXJyYXlgIG9iamVjdC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYW4gYXJyYXksIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc0FycmF5KFsxLCAyLCAzXSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0FycmF5KGRvY3VtZW50LmJvZHkuY2hpbGRyZW4pOwogICAqIC8vID0+IGZhbHNlCiAgICoKICAgKiBfLmlzQXJyYXkoJ2FiYycpOwogICAqIC8vID0+IGZhbHNlCiAgICoKICAgKiBfLmlzQXJyYXkoXy5ub29wKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIHZhciBpc0FycmF5JDEgPSBBcnJheS5pc0FycmF5OwoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBhcnJheS1saWtlLiBBIHZhbHVlIGlzIGNvbnNpZGVyZWQgYXJyYXktbGlrZSBpZiBpdCdzCiAgICogbm90IGEgZnVuY3Rpb24gYW5kIGhhcyBhIGB2YWx1ZS5sZW5ndGhgIHRoYXQncyBhbiBpbnRlZ2VyIGdyZWF0ZXIgdGhhbiBvcgogICAqIGVxdWFsIHRvIGAwYCBhbmQgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIGBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUmAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGFycmF5LWxpa2UsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc0FycmF5TGlrZShbMSwgMiwgM10pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNBcnJheUxpa2UoZG9jdW1lbnQuYm9keS5jaGlsZHJlbik7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0FycmF5TGlrZSgnYWJjJyk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0FycmF5TGlrZShfLm5vb3ApOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNBcnJheUxpa2UkMSh2YWx1ZSkgewogICAgcmV0dXJuIHZhbHVlICE9IG51bGwgJiYgaXNMZW5ndGgkMSh2YWx1ZS5sZW5ndGgpICYmICFpc0Z1bmN0aW9uJDEodmFsdWUpOwogIH0KCiAgLyoqCiAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5pc0FycmF5TGlrZWAgZXhjZXB0IHRoYXQgaXQgYWxzbyBjaGVja3MgaWYgYHZhbHVlYAogICAqIGlzIGFuIG9iamVjdC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYW4gYXJyYXktbGlrZSBvYmplY3QsCiAgICogIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc0FycmF5TGlrZU9iamVjdChbMSwgMiwgM10pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNBcnJheUxpa2VPYmplY3QoZG9jdW1lbnQuYm9keS5jaGlsZHJlbik7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0FycmF5TGlrZU9iamVjdCgnYWJjJyk7CiAgICogLy8gPT4gZmFsc2UKICAgKgogICAqIF8uaXNBcnJheUxpa2VPYmplY3QoXy5ub29wKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIGZ1bmN0aW9uIGlzQXJyYXlMaWtlT2JqZWN0JDEodmFsdWUpIHsKICAgIHJldHVybiBpc09iamVjdExpa2UkNCh2YWx1ZSkgJiYgaXNBcnJheUxpa2UkMSh2YWx1ZSk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBjbGFzc2lmaWVkIGFzIGEgYEZ1bmN0aW9uYCBvYmplY3QuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgZnVuY3Rpb24sIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc0Z1bmN0aW9uKF8pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNGdW5jdGlvbigvYWJjLyk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc0Z1bmN0aW9uJDEodmFsdWUpIHsKICAgIC8vIFRoZSB1c2Ugb2YgYE9iamVjdCN0b1N0cmluZ2AgYXZvaWRzIGlzc3VlcyB3aXRoIHRoZSBgdHlwZW9mYCBvcGVyYXRvcgogICAgLy8gaW4gU2FmYXJpIDgtOSB3aGljaCByZXR1cm5zICdvYmplY3QnIGZvciB0eXBlZCBhcnJheSBhbmQgb3RoZXIgY29uc3RydWN0b3JzLgogICAgdmFyIHRhZyA9IGlzT2JqZWN0JDModmFsdWUpID8gb2JqZWN0VG9TdHJpbmckNC5jYWxsKHZhbHVlKSA6ICcnOwogICAgcmV0dXJuIHRhZyA9PSBmdW5jVGFnJDEgfHwgdGFnID09IGdlblRhZyQxOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYSB2YWxpZCBhcnJheS1saWtlIGxlbmd0aC4KICAgKgogICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBpcyBsb29zZWx5IGJhc2VkIG9uCiAgICogW2BUb0xlbmd0aGBdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLXRvbGVuZ3RoKS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSB2YWxpZCBsZW5ndGgsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc0xlbmd0aCgzKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzTGVuZ3RoKE51bWJlci5NSU5fVkFMVUUpOwogICAqIC8vID0+IGZhbHNlCiAgICoKICAgKiBfLmlzTGVuZ3RoKEluZmluaXR5KTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5pc0xlbmd0aCgnMycpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNMZW5ndGgkMSh2YWx1ZSkgewogICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJyAmJgogICAgICB2YWx1ZSA+IC0xICYmIHZhbHVlICUgMSA9PSAwICYmIHZhbHVlIDw9IE1BWF9TQUZFX0lOVEVHRVIkMTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIHRoZQogICAqIFtsYW5ndWFnZSB0eXBlXShodHRwOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtZWNtYXNjcmlwdC1sYW5ndWFnZS10eXBlcykKICAgKiBvZiBgT2JqZWN0YC4gKGUuZy4gYXJyYXlzLCBmdW5jdGlvbnMsIG9iamVjdHMsIHJlZ2V4ZXMsIGBuZXcgTnVtYmVyKDApYCwgYW5kIGBuZXcgU3RyaW5nKCcnKWApCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGFuIG9iamVjdCwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzT2JqZWN0KHt9KTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzT2JqZWN0KFsxLCAyLCAzXSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc09iamVjdChfLm5vb3ApOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNPYmplY3QobnVsbCk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc09iamVjdCQzKHZhbHVlKSB7CiAgICB2YXIgdHlwZSA9IHR5cGVvZiB2YWx1ZTsKICAgIHJldHVybiAhIXZhbHVlICYmICh0eXBlID09ICdvYmplY3QnIHx8IHR5cGUgPT0gJ2Z1bmN0aW9uJyk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBvYmplY3QtbGlrZS4gQSB2YWx1ZSBpcyBvYmplY3QtbGlrZSBpZiBpdCdzIG5vdCBgbnVsbGAKICAgKiBhbmQgaGFzIGEgYHR5cGVvZmAgcmVzdWx0IG9mICJvYmplY3QiLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMC4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBvYmplY3QtbGlrZSwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzT2JqZWN0TGlrZSh7fSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc09iamVjdExpa2UoWzEsIDIsIDNdKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzT2JqZWN0TGlrZShfLm5vb3ApOwogICAqIC8vID0+IGZhbHNlCiAgICoKICAgKiBfLmlzT2JqZWN0TGlrZShudWxsKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIGZ1bmN0aW9uIGlzT2JqZWN0TGlrZSQ0KHZhbHVlKSB7CiAgICByZXR1cm4gISF2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT0gJ29iamVjdCc7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBjbGFzc2lmaWVkIGFzIGEgYFN0cmluZ2AgcHJpbWl0aXZlIG9yIG9iamVjdC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAc2luY2UgMC4xLjAKICAgKiBAbWVtYmVyT2YgXwogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBzdHJpbmcsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc1N0cmluZygnYWJjJyk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc1N0cmluZygxKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIGZ1bmN0aW9uIGlzU3RyaW5nKHZhbHVlKSB7CiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09ICdzdHJpbmcnIHx8CiAgICAgICghaXNBcnJheSQxKHZhbHVlKSAmJiBpc09iamVjdExpa2UkNCh2YWx1ZSkgJiYgb2JqZWN0VG9TdHJpbmckNC5jYWxsKHZhbHVlKSA9PSBzdHJpbmdUYWcpOwogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYHZhbHVlYCB0byBhbiBhcnJheS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAc2luY2UgMC4xLjAKICAgKiBAbWVtYmVyT2YgXwogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29udmVydC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGNvbnZlcnRlZCBhcnJheS4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy50b0FycmF5KHsgJ2EnOiAxLCAnYic6IDIgfSk7CiAgICogLy8gPT4gWzEsIDJdCiAgICoKICAgKiBfLnRvQXJyYXkoJ2FiYycpOwogICAqIC8vID0+IFsnYScsICdiJywgJ2MnXQogICAqCiAgICogXy50b0FycmF5KDEpOwogICAqIC8vID0+IFtdCiAgICoKICAgKiBfLnRvQXJyYXkobnVsbCk7CiAgICogLy8gPT4gW10KICAgKi8KICBmdW5jdGlvbiB0b0FycmF5KHZhbHVlKSB7CiAgICBpZiAoIXZhbHVlKSB7CiAgICAgIHJldHVybiBbXTsKICAgIH0KICAgIGlmIChpc0FycmF5TGlrZSQxKHZhbHVlKSkgewogICAgICByZXR1cm4gaXNTdHJpbmcodmFsdWUpID8gc3RyaW5nVG9BcnJheSQxKHZhbHVlKSA6IGNvcHlBcnJheSh2YWx1ZSk7CiAgICB9CiAgICBpZiAoaXRlcmF0b3JTeW1ib2wgJiYgdmFsdWVbaXRlcmF0b3JTeW1ib2xdKSB7CiAgICAgIHJldHVybiBpdGVyYXRvclRvQXJyYXkodmFsdWVbaXRlcmF0b3JTeW1ib2xdKCkpOwogICAgfQogICAgdmFyIHRhZyA9IGdldFRhZyh2YWx1ZSksCiAgICAgICAgZnVuYyA9IHRhZyA9PSBtYXBUYWcgPyBtYXBUb0FycmF5IDogKHRhZyA9PSBzZXRUYWcgPyBzZXRUb0FycmF5IDogdmFsdWVzKTsKCiAgICByZXR1cm4gZnVuYyh2YWx1ZSk7CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIHRoZSBvd24gZW51bWVyYWJsZSBwcm9wZXJ0eSBuYW1lcyBvZiBgb2JqZWN0YC4KICAgKgogICAqICoqTm90ZToqKiBOb24tb2JqZWN0IHZhbHVlcyBhcmUgY29lcmNlZCB0byBvYmplY3RzLiBTZWUgdGhlCiAgICogW0VTIHNwZWNdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLW9iamVjdC5rZXlzKQogICAqIGZvciBtb3JlIGRldGFpbHMuCiAgICoKICAgKiBAc3RhdGljCiAgICogQHNpbmNlIDAuMS4wCiAgICogQG1lbWJlck9mIF8KICAgKiBAY2F0ZWdvcnkgT2JqZWN0CiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2YgcHJvcGVydHkgbmFtZXMuCiAgICogQGV4YW1wbGUKICAgKgogICAqIGZ1bmN0aW9uIEZvbygpIHsKICAgKiAgIHRoaXMuYSA9IDE7CiAgICogICB0aGlzLmIgPSAyOwogICAqIH0KICAgKgogICAqIEZvby5wcm90b3R5cGUuYyA9IDM7CiAgICoKICAgKiBfLmtleXMobmV3IEZvbyk7CiAgICogLy8gPT4gWydhJywgJ2InXSAoaXRlcmF0aW9uIG9yZGVyIGlzIG5vdCBndWFyYW50ZWVkKQogICAqCiAgICogXy5rZXlzKCdoaScpOwogICAqIC8vID0+IFsnMCcsICcxJ10KICAgKi8KICBmdW5jdGlvbiBrZXlzJDEob2JqZWN0KSB7CiAgICByZXR1cm4gaXNBcnJheUxpa2UkMShvYmplY3QpID8gYXJyYXlMaWtlS2V5cyQxKG9iamVjdCkgOiBiYXNlS2V5cyQxKG9iamVjdCk7CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIHRoZSBvd24gZW51bWVyYWJsZSBzdHJpbmcga2V5ZWQgcHJvcGVydHkgdmFsdWVzIG9mIGBvYmplY3RgLgogICAqCiAgICogKipOb3RlOioqIE5vbi1vYmplY3QgdmFsdWVzIGFyZSBjb2VyY2VkIHRvIG9iamVjdHMuCiAgICoKICAgKiBAc3RhdGljCiAgICogQHNpbmNlIDAuMS4wCiAgICogQG1lbWJlck9mIF8KICAgKiBAY2F0ZWdvcnkgT2JqZWN0CiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2YgcHJvcGVydHkgdmFsdWVzLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBmdW5jdGlvbiBGb28oKSB7CiAgICogICB0aGlzLmEgPSAxOwogICAqICAgdGhpcy5iID0gMjsKICAgKiB9CiAgICoKICAgKiBGb28ucHJvdG90eXBlLmMgPSAzOwogICAqCiAgICogXy52YWx1ZXMobmV3IEZvbyk7CiAgICogLy8gPT4gWzEsIDJdIChpdGVyYXRpb24gb3JkZXIgaXMgbm90IGd1YXJhbnRlZWQpCiAgICoKICAgKiBfLnZhbHVlcygnaGknKTsKICAgKiAvLyA9PiBbJ2gnLCAnaSddCiAgICovCiAgZnVuY3Rpb24gdmFsdWVzKG9iamVjdCkgewogICAgcmV0dXJuIG9iamVjdCA/IGJhc2VWYWx1ZXMob2JqZWN0LCBrZXlzJDEob2JqZWN0KSkgOiBbXTsKICB9CgogIHZhciBsb2Rhc2hfdG9hcnJheSA9IHRvQXJyYXk7CgogIC8qKgogICAqIFNTUiBXaW5kb3cgMy4wLjAKICAgKiBCZXR0ZXIgaGFuZGxpbmcgZm9yIHdpbmRvdyBvYmplY3QgaW4gU1NSIGVudmlyb25tZW50CiAgICogaHR0cHM6Ly9naXRodWIuY29tL25vbGltaXRzNHdlYi9zc3Itd2luZG93CiAgICoKICAgKiBDb3B5cmlnaHQgMjAyMCwgVmxhZGltaXIgS2hhcmxhbXBpZGkKICAgKgogICAqIExpY2Vuc2VkIHVuZGVyIE1JVAogICAqCiAgICogUmVsZWFzZWQgb246IE5vdmVtYmVyIDksIDIwMjAKICAgKi8KCiAgdmFyIHNzcldpbmRvd191bWQgPSBjcmVhdGVDb21tb25qc01vZHVsZSQxKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAoZnVuY3Rpb24gKGdsb2JhbCwgZmFjdG9yeSkgewogICAgICBmYWN0b3J5KGV4cG9ydHMpIDsKICB9KGNvbW1vbmpzR2xvYmFsLCAoZnVuY3Rpb24gKGV4cG9ydHMpIHsKICAgICAgLyogZXNsaW50LWRpc2FibGUgbm8tcGFyYW0tcmVhc3NpZ24gKi8KICAgICAgZnVuY3Rpb24gaXNPYmplY3Qob2JqKSB7CiAgICAgICAgICByZXR1cm4gKG9iaiAhPT0gbnVsbCAmJgogICAgICAgICAgICAgIHR5cGVvZiBvYmogPT09ICdvYmplY3QnICYmCiAgICAgICAgICAgICAgJ2NvbnN0cnVjdG9yJyBpbiBvYmogJiYKICAgICAgICAgICAgICBvYmouY29uc3RydWN0b3IgPT09IE9iamVjdCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZXh0ZW5kKHRhcmdldCwgc3JjKSB7CiAgICAgICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsgdGFyZ2V0ID0ge307IH0KICAgICAgICAgIGlmIChzcmMgPT09IHZvaWQgMCkgeyBzcmMgPSB7fTsgfQogICAgICAgICAgT2JqZWN0LmtleXMoc3JjKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgICAgICBpZiAodHlwZW9mIHRhcmdldFtrZXldID09PSAndW5kZWZpbmVkJykKICAgICAgICAgICAgICAgICAgdGFyZ2V0W2tleV0gPSBzcmNba2V5XTsKICAgICAgICAgICAgICBlbHNlIGlmIChpc09iamVjdChzcmNba2V5XSkgJiYKICAgICAgICAgICAgICAgICAgaXNPYmplY3QodGFyZ2V0W2tleV0pICYmCiAgICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKHNyY1trZXldKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgIGV4dGVuZCh0YXJnZXRba2V5XSwgc3JjW2tleV0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICB9CgogICAgICB2YXIgc3NyRG9jdW1lbnQgPSB7CiAgICAgICAgICBib2R5OiB7fSwKICAgICAgICAgIGFkZEV2ZW50TGlzdGVuZXI6IGZ1bmN0aW9uICgpIHsgfSwKICAgICAgICAgIHJlbW92ZUV2ZW50TGlzdGVuZXI6IGZ1bmN0aW9uICgpIHsgfSwKICAgICAgICAgIGFjdGl2ZUVsZW1lbnQ6IHsKICAgICAgICAgICAgICBibHVyOiBmdW5jdGlvbiAoKSB7IH0sCiAgICAgICAgICAgICAgbm9kZU5hbWU6ICcnLAogICAgICAgICAgfSwKICAgICAgICAgIHF1ZXJ5U2VsZWN0b3I6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0sCiAgICAgICAgICBxdWVyeVNlbGVjdG9yQWxsOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgICAgfSwKICAgICAgICAgIGdldEVsZW1lbnRCeUlkOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9LAogICAgICAgICAgY3JlYXRlRXZlbnQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICBpbml0RXZlbnQ6IGZ1bmN0aW9uICgpIHsgfSwKICAgICAgICAgICAgICB9OwogICAgICAgICAgfSwKICAgICAgICAgIGNyZWF0ZUVsZW1lbnQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICBjaGlsZHJlbjogW10sCiAgICAgICAgICAgICAgICAgIGNoaWxkTm9kZXM6IFtdLAogICAgICAgICAgICAgICAgICBzdHlsZToge30sCiAgICAgICAgICAgICAgICAgIHNldEF0dHJpYnV0ZTogZnVuY3Rpb24gKCkgeyB9LAogICAgICAgICAgICAgICAgICBnZXRFbGVtZW50c0J5VGFnTmFtZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH07CiAgICAgICAgICB9LAogICAgICAgICAgY3JlYXRlRWxlbWVudE5TOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHt9OwogICAgICAgICAgfSwKICAgICAgICAgIGltcG9ydE5vZGU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0sCiAgICAgICAgICBsb2NhdGlvbjogewogICAgICAgICAgICAgIGhhc2g6ICcnLAogICAgICAgICAgICAgIGhvc3Q6ICcnLAogICAgICAgICAgICAgIGhvc3RuYW1lOiAnJywKICAgICAgICAgICAgICBocmVmOiAnJywKICAgICAgICAgICAgICBvcmlnaW46ICcnLAogICAgICAgICAgICAgIHBhdGhuYW1lOiAnJywKICAgICAgICAgICAgICBwcm90b2NvbDogJycsCiAgICAgICAgICAgICAgc2VhcmNoOiAnJywKICAgICAgICAgIH0sCiAgICAgIH07CiAgICAgIGZ1bmN0aW9uIGdldERvY3VtZW50KCkgewogICAgICAgICAgdmFyIGRvYyA9IHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcgPyBkb2N1bWVudCA6IHt9OwogICAgICAgICAgZXh0ZW5kKGRvYywgc3NyRG9jdW1lbnQpOwogICAgICAgICAgcmV0dXJuIGRvYzsKICAgICAgfQoKICAgICAgdmFyIHNzcldpbmRvdyA9IHsKICAgICAgICAgIGRvY3VtZW50OiBzc3JEb2N1bWVudCwKICAgICAgICAgIG5hdmlnYXRvcjogewogICAgICAgICAgICAgIHVzZXJBZ2VudDogJycsCiAgICAgICAgICB9LAogICAgICAgICAgbG9jYXRpb246IHsKICAgICAgICAgICAgICBoYXNoOiAnJywKICAgICAgICAgICAgICBob3N0OiAnJywKICAgICAgICAgICAgICBob3N0bmFtZTogJycsCiAgICAgICAgICAgICAgaHJlZjogJycsCiAgICAgICAgICAgICAgb3JpZ2luOiAnJywKICAgICAgICAgICAgICBwYXRobmFtZTogJycsCiAgICAgICAgICAgICAgcHJvdG9jb2w6ICcnLAogICAgICAgICAgICAgIHNlYXJjaDogJycsCiAgICAgICAgICB9LAogICAgICAgICAgaGlzdG9yeTogewogICAgICAgICAgICAgIHJlcGxhY2VTdGF0ZTogZnVuY3Rpb24gKCkgeyB9LAogICAgICAgICAgICAgIHB1c2hTdGF0ZTogZnVuY3Rpb24gKCkgeyB9LAogICAgICAgICAgICAgIGdvOiBmdW5jdGlvbiAoKSB7IH0sCiAgICAgICAgICAgICAgYmFjazogZnVuY3Rpb24gKCkgeyB9LAogICAgICAgICAgfSwKICAgICAgICAgIEN1c3RvbUV2ZW50OiBmdW5jdGlvbiBDdXN0b21FdmVudCgpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgIH0sCiAgICAgICAgICBhZGRFdmVudExpc3RlbmVyOiBmdW5jdGlvbiAoKSB7IH0sCiAgICAgICAgICByZW1vdmVFdmVudExpc3RlbmVyOiBmdW5jdGlvbiAoKSB7IH0sCiAgICAgICAgICBnZXRDb21wdXRlZFN0eWxlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgZ2V0UHJvcGVydHlWYWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH07CiAgICAgICAgICB9LAogICAgICAgICAgSW1hZ2U6IGZ1bmN0aW9uICgpIHsgfSwKICAgICAgICAgIERhdGU6IGZ1bmN0aW9uICgpIHsgfSwKICAgICAgICAgIHNjcmVlbjoge30sCiAgICAgICAgICBzZXRUaW1lb3V0OiBmdW5jdGlvbiAoKSB7IH0sCiAgICAgICAgICBjbGVhclRpbWVvdXQ6IGZ1bmN0aW9uICgpIHsgfSwKICAgICAgICAgIG1hdGNoTWVkaWE6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4ge307CiAgICAgICAgICB9LAogICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lOiBmdW5jdGlvbiAoY2FsbGJhY2spIHsKICAgICAgICAgICAgICBpZiAodHlwZW9mIHNldFRpbWVvdXQgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7CiAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gc2V0VGltZW91dChjYWxsYmFjaywgMCk7CiAgICAgICAgICB9LAogICAgICAgICAgY2FuY2VsQW5pbWF0aW9uRnJhbWU6IGZ1bmN0aW9uIChpZCkgewogICAgICAgICAgICAgIGlmICh0eXBlb2Ygc2V0VGltZW91dCA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoaWQpOwogICAgICAgICAgfSwKICAgICAgfTsKICAgICAgZnVuY3Rpb24gZ2V0V2luZG93KCkgewogICAgICAgICAgdmFyIHdpbiA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gd2luZG93IDoge307CiAgICAgICAgICBleHRlbmQod2luLCBzc3JXaW5kb3cpOwogICAgICAgICAgcmV0dXJuIHdpbjsKICAgICAgfQoKICAgICAgZXhwb3J0cy5leHRlbmQgPSBleHRlbmQ7CiAgICAgIGV4cG9ydHMuZ2V0RG9jdW1lbnQgPSBnZXREb2N1bWVudDsKICAgICAgZXhwb3J0cy5nZXRXaW5kb3cgPSBnZXRXaW5kb3c7CiAgICAgIGV4cG9ydHMuc3NyRG9jdW1lbnQgPSBzc3JEb2N1bWVudDsKICAgICAgZXhwb3J0cy5zc3JXaW5kb3cgPSBzc3JXaW5kb3c7CgogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pOwoKICB9KSkpOwoKICB9KTsKCiAgLyoqCiAgICogRG9tNyAzLjAuMAogICAqIE1pbmltYWxpc3RpYyBKYXZhU2NyaXB0IGxpYnJhcnkgZm9yIERPTSBtYW5pcHVsYXRpb24sIHdpdGggYSBqUXVlcnktY29tcGF0aWJsZSBBUEkKICAgKiBodHRwczovL2ZyYW1ld29yazcuaW8vZG9jcy9kb203Lmh0bWwKICAgKgogICAqIENvcHlyaWdodCAyMDIwLCBWbGFkaW1pciBLaGFybGFtcGlkaQogICAqCiAgICogTGljZW5zZWQgdW5kZXIgTUlUCiAgICoKICAgKiBSZWxlYXNlZCBvbjogTm92ZW1iZXIgOSwgMjAyMAogICAqLwoKCgoKCiAgZnVuY3Rpb24gX2luaGVyaXRzTG9vc2Uoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsKICAgIHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcy5wcm90b3R5cGUpOwogICAgc3ViQ2xhc3MucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gc3ViQ2xhc3M7CiAgICBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOwogIH0KCiAgZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsKICAgIF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CiAgICAgIHJldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7CiAgICB9OwogICAgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsKICB9CgogIGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7CiAgICBfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsKICAgICAgby5fX3Byb3RvX18gPSBwOwogICAgICByZXR1cm4gbzsKICAgIH07CgogICAgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsKICB9CgogIGZ1bmN0aW9uIF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSB7CiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09ICJ1bmRlZmluZWQiIHx8ICFSZWZsZWN0LmNvbnN0cnVjdCkgcmV0dXJuIGZhbHNlOwogICAgaWYgKFJlZmxlY3QuY29uc3RydWN0LnNoYW0pIHJldHVybiBmYWxzZTsKICAgIGlmICh0eXBlb2YgUHJveHkgPT09ICJmdW5jdGlvbiIpIHJldHVybiB0cnVlOwoKICAgIHRyeSB7CiAgICAgIERhdGUucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoUmVmbGVjdC5jb25zdHJ1Y3QoRGF0ZSwgW10sIGZ1bmN0aW9uICgpIHt9KSk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfSBjYXRjaCAoZSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBfY29uc3RydWN0KFBhcmVudCwgYXJncywgQ2xhc3MpIHsKICAgIGlmIChfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCkpIHsKICAgICAgX2NvbnN0cnVjdCA9IFJlZmxlY3QuY29uc3RydWN0OwogICAgfSBlbHNlIHsKICAgICAgX2NvbnN0cnVjdCA9IGZ1bmN0aW9uIF9jb25zdHJ1Y3QoUGFyZW50LCBhcmdzLCBDbGFzcykgewogICAgICAgIHZhciBhID0gW251bGxdOwogICAgICAgIGEucHVzaC5hcHBseShhLCBhcmdzKTsKICAgICAgICB2YXIgQ29uc3RydWN0b3IgPSBGdW5jdGlvbi5iaW5kLmFwcGx5KFBhcmVudCwgYSk7CiAgICAgICAgdmFyIGluc3RhbmNlID0gbmV3IENvbnN0cnVjdG9yKCk7CiAgICAgICAgaWYgKENsYXNzKSBfc2V0UHJvdG90eXBlT2YoaW5zdGFuY2UsIENsYXNzLnByb3RvdHlwZSk7CiAgICAgICAgcmV0dXJuIGluc3RhbmNlOwogICAgICB9OwogICAgfQoKICAgIHJldHVybiBfY29uc3RydWN0LmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7CiAgfQoKICBmdW5jdGlvbiBfaXNOYXRpdmVGdW5jdGlvbihmbikgewogICAgcmV0dXJuIEZ1bmN0aW9uLnRvU3RyaW5nLmNhbGwoZm4pLmluZGV4T2YoIltuYXRpdmUgY29kZV0iKSAhPT0gLTE7CiAgfQoKICBmdW5jdGlvbiBfd3JhcE5hdGl2ZVN1cGVyKENsYXNzKSB7CiAgICB2YXIgX2NhY2hlID0gdHlwZW9mIE1hcCA9PT0gImZ1bmN0aW9uIiA/IG5ldyBNYXAoKSA6IHVuZGVmaW5lZDsKCiAgICBfd3JhcE5hdGl2ZVN1cGVyID0gZnVuY3Rpb24gX3dyYXBOYXRpdmVTdXBlcihDbGFzcykgewogICAgICBpZiAoQ2xhc3MgPT09IG51bGwgfHwgIV9pc05hdGl2ZUZ1bmN0aW9uKENsYXNzKSkgcmV0dXJuIENsYXNzOwoKICAgICAgaWYgKHR5cGVvZiBDbGFzcyAhPT0gImZ1bmN0aW9uIikgewogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7CiAgICAgIH0KCiAgICAgIGlmICh0eXBlb2YgX2NhY2hlICE9PSAidW5kZWZpbmVkIikgewogICAgICAgIGlmIChfY2FjaGUuaGFzKENsYXNzKSkgcmV0dXJuIF9jYWNoZS5nZXQoQ2xhc3MpOwoKICAgICAgICBfY2FjaGUuc2V0KENsYXNzLCBXcmFwcGVyKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gV3JhcHBlcigpIHsKICAgICAgICByZXR1cm4gX2NvbnN0cnVjdChDbGFzcywgYXJndW1lbnRzLCBfZ2V0UHJvdG90eXBlT2YodGhpcykuY29uc3RydWN0b3IpOwogICAgICB9CgogICAgICBXcmFwcGVyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQ2xhc3MucHJvdG90eXBlLCB7CiAgICAgICAgY29uc3RydWN0b3I6IHsKICAgICAgICAgIHZhbHVlOiBXcmFwcGVyLAogICAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsCiAgICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybiBfc2V0UHJvdG90eXBlT2YoV3JhcHBlciwgQ2xhc3MpOwogICAgfTsKCiAgICByZXR1cm4gX3dyYXBOYXRpdmVTdXBlcihDbGFzcyk7CiAgfQoKICBmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHsKICAgIGlmIChzZWxmID09PSB2b2lkIDApIHsKICAgICAgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsKICAgIH0KCiAgICByZXR1cm4gc2VsZjsKICB9CgogIC8qIGVzbGludC1kaXNhYmxlIG5vLXByb3RvICovCiAgZnVuY3Rpb24gbWFrZVJlYWN0aXZlKG9iaikgewogICAgdmFyIHByb3RvID0gb2JqLl9fcHJvdG9fXzsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosICdfX3Byb3RvX18nLCB7CiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgIHJldHVybiBwcm90bzsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbiBzZXQodmFsdWUpIHsKICAgICAgICBwcm90by5fX3Byb3RvX18gPSB2YWx1ZTsKICAgICAgfQogICAgfSk7CiAgfQoKICB2YXIgRG9tNyA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0FycmF5KSB7CiAgICBfaW5oZXJpdHNMb29zZShEb203LCBfQXJyYXkpOwoKICAgIGZ1bmN0aW9uIERvbTcoaXRlbXMpIHsKICAgICAgdmFyIF90aGlzOwoKICAgICAgX3RoaXMgPSBfQXJyYXkuY2FsbC5hcHBseShfQXJyYXksIFt0aGlzXS5jb25jYXQoaXRlbXMpKSB8fCB0aGlzOwogICAgICBtYWtlUmVhY3RpdmUoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpOwogICAgICByZXR1cm4gX3RoaXM7CiAgICB9CgogICAgcmV0dXJuIERvbTc7CiAgfSggLyojX19QVVJFX18qL193cmFwTmF0aXZlU3VwZXIoQXJyYXkpKTsKCiAgZnVuY3Rpb24gYXJyYXlGbGF0KGFycikgewogICAgaWYgKGFyciA9PT0gdm9pZCAwKSB7CiAgICAgIGFyciA9IFtdOwogICAgfQoKICAgIHZhciByZXMgPSBbXTsKICAgIGFyci5mb3JFYWNoKGZ1bmN0aW9uIChlbCkgewogICAgICBpZiAoQXJyYXkuaXNBcnJheShlbCkpIHsKICAgICAgICByZXMucHVzaC5hcHBseShyZXMsIGFycmF5RmxhdChlbCkpOwogICAgICB9IGVsc2UgewogICAgICAgIHJlcy5wdXNoKGVsKTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gcmVzOwogIH0KICBmdW5jdGlvbiBhcnJheUZpbHRlcihhcnIsIGNhbGxiYWNrKSB7CiAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLmZpbHRlci5jYWxsKGFyciwgY2FsbGJhY2spOwogIH0KICBmdW5jdGlvbiBhcnJheVVuaXF1ZShhcnIpIHsKICAgIHZhciB1bmlxdWVBcnJheSA9IFtdOwoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgIGlmICh1bmlxdWVBcnJheS5pbmRleE9mKGFycltpXSkgPT09IC0xKSB1bmlxdWVBcnJheS5wdXNoKGFycltpXSk7CiAgICB9CgogICAgcmV0dXJuIHVuaXF1ZUFycmF5OwogIH0KICBmdW5jdGlvbiB0b0NhbWVsQ2FzZShzdHJpbmcpIHsKICAgIHJldHVybiBzdHJpbmcudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC8tKC4pL2csIGZ1bmN0aW9uIChtYXRjaCwgZ3JvdXApIHsKICAgICAgcmV0dXJuIGdyb3VwLnRvVXBwZXJDYXNlKCk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIHFzYShzZWxlY3RvciwgY29udGV4dCkgewogICAgaWYgKHR5cGVvZiBzZWxlY3RvciAhPT0gJ3N0cmluZycpIHsKICAgICAgcmV0dXJuIFtzZWxlY3Rvcl07CiAgICB9CgogICAgdmFyIGEgPSBbXTsKICAgIHZhciByZXMgPSBjb250ZXh0LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpOwoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgIGEucHVzaChyZXNbaV0pOwogICAgfQoKICAgIHJldHVybiBhOwogIH0KCiAgZnVuY3Rpb24gJChzZWxlY3RvciwgY29udGV4dCkgewogICAgdmFyIHdpbmRvdyA9IHNzcldpbmRvd191bWQuZ2V0V2luZG93KCk7CiAgICB2YXIgZG9jdW1lbnQgPSBzc3JXaW5kb3dfdW1kLmdldERvY3VtZW50KCk7CiAgICB2YXIgYXJyID0gW107CgogICAgaWYgKCFjb250ZXh0ICYmIHNlbGVjdG9yIGluc3RhbmNlb2YgRG9tNykgewogICAgICByZXR1cm4gc2VsZWN0b3I7CiAgICB9CgogICAgaWYgKCFzZWxlY3RvcikgewogICAgICByZXR1cm4gbmV3IERvbTcoYXJyKTsKICAgIH0KCiAgICBpZiAodHlwZW9mIHNlbGVjdG9yID09PSAnc3RyaW5nJykgewogICAgICB2YXIgaHRtbCA9IHNlbGVjdG9yLnRyaW0oKTsKCiAgICAgIGlmIChodG1sLmluZGV4T2YoJzwnKSA+PSAwICYmIGh0bWwuaW5kZXhPZignPicpID49IDApIHsKICAgICAgICB2YXIgdG9DcmVhdGUgPSAnZGl2JzsKICAgICAgICBpZiAoaHRtbC5pbmRleE9mKCc8bGknKSA9PT0gMCkgdG9DcmVhdGUgPSAndWwnOwogICAgICAgIGlmIChodG1sLmluZGV4T2YoJzx0cicpID09PSAwKSB0b0NyZWF0ZSA9ICd0Ym9keSc7CiAgICAgICAgaWYgKGh0bWwuaW5kZXhPZignPHRkJykgPT09IDAgfHwgaHRtbC5pbmRleE9mKCc8dGgnKSA9PT0gMCkgdG9DcmVhdGUgPSAndHInOwogICAgICAgIGlmIChodG1sLmluZGV4T2YoJzx0Ym9keScpID09PSAwKSB0b0NyZWF0ZSA9ICd0YWJsZSc7CiAgICAgICAgaWYgKGh0bWwuaW5kZXhPZignPG9wdGlvbicpID09PSAwKSB0b0NyZWF0ZSA9ICdzZWxlY3QnOwogICAgICAgIHZhciB0ZW1wUGFyZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0b0NyZWF0ZSk7CiAgICAgICAgdGVtcFBhcmVudC5pbm5lckhUTUwgPSBodG1sOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRlbXBQYXJlbnQuY2hpbGROb2Rlcy5sZW5ndGg7IGkgKz0gMSkgewogICAgICAgICAgYXJyLnB1c2godGVtcFBhcmVudC5jaGlsZE5vZGVzW2ldKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYXJyID0gcXNhKHNlbGVjdG9yLnRyaW0oKSwgY29udGV4dCB8fCBkb2N1bWVudCk7CiAgICAgIH0gLy8gYXJyID0gcXNhKHNlbGVjdG9yLCBkb2N1bWVudCk7CgogICAgfSBlbHNlIGlmIChzZWxlY3Rvci5ub2RlVHlwZSB8fCBzZWxlY3RvciA9PT0gd2luZG93IHx8IHNlbGVjdG9yID09PSBkb2N1bWVudCkgewogICAgICBhcnIucHVzaChzZWxlY3Rvcik7CiAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoc2VsZWN0b3IpKSB7CiAgICAgIGlmIChzZWxlY3RvciBpbnN0YW5jZW9mIERvbTcpIHJldHVybiBzZWxlY3RvcjsKICAgICAgYXJyID0gc2VsZWN0b3I7CiAgICB9CgogICAgcmV0dXJuIG5ldyBEb203KGFycmF5VW5pcXVlKGFycikpOwogIH0KCiAgJC5mbiA9IERvbTcucHJvdG90eXBlOwoKICBmdW5jdGlvbiBhZGRDbGFzcygpIHsKICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBjbGFzc2VzID0gbmV3IEFycmF5KF9sZW4pLCBfa2V5ID0gMDsgX2tleSA8IF9sZW47IF9rZXkrKykgewogICAgICBjbGFzc2VzW19rZXldID0gYXJndW1lbnRzW19rZXldOwogICAgfQoKICAgIHZhciBjbGFzc05hbWVzID0gYXJyYXlGbGF0KGNsYXNzZXMubWFwKGZ1bmN0aW9uIChjKSB7CiAgICAgIHJldHVybiBjLnNwbGl0KCcgJyk7CiAgICB9KSk7CiAgICB0aGlzLmZvckVhY2goZnVuY3Rpb24gKGVsKSB7CiAgICAgIHZhciBfZWwkY2xhc3NMaXN0OwoKICAgICAgKF9lbCRjbGFzc0xpc3QgPSBlbC5jbGFzc0xpc3QpLmFkZC5hcHBseShfZWwkY2xhc3NMaXN0LCBjbGFzc05hbWVzKTsKICAgIH0pOwogICAgcmV0dXJuIHRoaXM7CiAgfQoKICBmdW5jdGlvbiByZW1vdmVDbGFzcygpIHsKICAgIGZvciAodmFyIF9sZW4yID0gYXJndW1lbnRzLmxlbmd0aCwgY2xhc3NlcyA9IG5ldyBBcnJheShfbGVuMiksIF9rZXkyID0gMDsgX2tleTIgPCBfbGVuMjsgX2tleTIrKykgewogICAgICBjbGFzc2VzW19rZXkyXSA9IGFyZ3VtZW50c1tfa2V5Ml07CiAgICB9CgogICAgdmFyIGNsYXNzTmFtZXMgPSBhcnJheUZsYXQoY2xhc3Nlcy5tYXAoZnVuY3Rpb24gKGMpIHsKICAgICAgcmV0dXJuIGMuc3BsaXQoJyAnKTsKICAgIH0pKTsKICAgIHRoaXMuZm9yRWFjaChmdW5jdGlvbiAoZWwpIHsKICAgICAgdmFyIF9lbCRjbGFzc0xpc3QyOwoKICAgICAgKF9lbCRjbGFzc0xpc3QyID0gZWwuY2xhc3NMaXN0KS5yZW1vdmUuYXBwbHkoX2VsJGNsYXNzTGlzdDIsIGNsYXNzTmFtZXMpOwogICAgfSk7CiAgICByZXR1cm4gdGhpczsKICB9CgogIGZ1bmN0aW9uIHRvZ2dsZUNsYXNzKCkgewogICAgZm9yICh2YXIgX2xlbjMgPSBhcmd1bWVudHMubGVuZ3RoLCBjbGFzc2VzID0gbmV3IEFycmF5KF9sZW4zKSwgX2tleTMgPSAwOyBfa2V5MyA8IF9sZW4zOyBfa2V5MysrKSB7CiAgICAgIGNsYXNzZXNbX2tleTNdID0gYXJndW1lbnRzW19rZXkzXTsKICAgIH0KCiAgICB2YXIgY2xhc3NOYW1lcyA9IGFycmF5RmxhdChjbGFzc2VzLm1hcChmdW5jdGlvbiAoYykgewogICAgICByZXR1cm4gYy5zcGxpdCgnICcpOwogICAgfSkpOwogICAgdGhpcy5mb3JFYWNoKGZ1bmN0aW9uIChlbCkgewogICAgICBjbGFzc05hbWVzLmZvckVhY2goZnVuY3Rpb24gKGNsYXNzTmFtZSkgewogICAgICAgIGVsLmNsYXNzTGlzdC50b2dnbGUoY2xhc3NOYW1lKTsKICAgICAgfSk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGhhc0NsYXNzKCkgewogICAgZm9yICh2YXIgX2xlbjQgPSBhcmd1bWVudHMubGVuZ3RoLCBjbGFzc2VzID0gbmV3IEFycmF5KF9sZW40KSwgX2tleTQgPSAwOyBfa2V5NCA8IF9sZW40OyBfa2V5NCsrKSB7CiAgICAgIGNsYXNzZXNbX2tleTRdID0gYXJndW1lbnRzW19rZXk0XTsKICAgIH0KCiAgICB2YXIgY2xhc3NOYW1lcyA9IGFycmF5RmxhdChjbGFzc2VzLm1hcChmdW5jdGlvbiAoYykgewogICAgICByZXR1cm4gYy5zcGxpdCgnICcpOwogICAgfSkpOwogICAgcmV0dXJuIGFycmF5RmlsdGVyKHRoaXMsIGZ1bmN0aW9uIChlbCkgewogICAgICByZXR1cm4gY2xhc3NOYW1lcy5maWx0ZXIoZnVuY3Rpb24gKGNsYXNzTmFtZSkgewogICAgICAgIHJldHVybiBlbC5jbGFzc0xpc3QuY29udGFpbnMoY2xhc3NOYW1lKTsKICAgICAgfSkubGVuZ3RoID4gMDsKICAgIH0pLmxlbmd0aCA+IDA7CiAgfQoKICBmdW5jdGlvbiBhdHRyKGF0dHJzLCB2YWx1ZSkgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEgJiYgdHlwZW9mIGF0dHJzID09PSAnc3RyaW5nJykgewogICAgICAvLyBHZXQgYXR0cgogICAgICBpZiAodGhpc1swXSkgcmV0dXJuIHRoaXNbMF0uZ2V0QXR0cmlidXRlKGF0dHJzKTsKICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0gLy8gU2V0IGF0dHJzCgoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkgKz0gMSkgewogICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgIC8vIFN0cmluZwogICAgICAgIHRoaXNbaV0uc2V0QXR0cmlidXRlKGF0dHJzLCB2YWx1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gT2JqZWN0CiAgICAgICAgZm9yICh2YXIgYXR0ck5hbWUgaW4gYXR0cnMpIHsKICAgICAgICAgIHRoaXNbaV1bYXR0ck5hbWVdID0gYXR0cnNbYXR0ck5hbWVdOwogICAgICAgICAgdGhpc1tpXS5zZXRBdHRyaWJ1dGUoYXR0ck5hbWUsIGF0dHJzW2F0dHJOYW1lXSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfQoKICBmdW5jdGlvbiByZW1vdmVBdHRyKGF0dHIpIHsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkgKz0gMSkgewogICAgICB0aGlzW2ldLnJlbW92ZUF0dHJpYnV0ZShhdHRyKTsKICAgIH0KCiAgICByZXR1cm4gdGhpczsKICB9CgogIGZ1bmN0aW9uIHByb3AocHJvcHMsIHZhbHVlKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSAmJiB0eXBlb2YgcHJvcHMgPT09ICdzdHJpbmcnKSB7CiAgICAgIC8vIEdldCBwcm9wCiAgICAgIGlmICh0aGlzWzBdKSByZXR1cm4gdGhpc1swXVtwcm9wc107CiAgICB9IGVsc2UgewogICAgICAvLyBTZXQgcHJvcHMKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgIC8vIFN0cmluZwogICAgICAgICAgdGhpc1tpXVtwcm9wc10gPSB2YWx1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gT2JqZWN0CiAgICAgICAgICBmb3IgKHZhciBwcm9wTmFtZSBpbiBwcm9wcykgewogICAgICAgICAgICB0aGlzW2ldW3Byb3BOYW1lXSA9IHByb3BzW3Byb3BOYW1lXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIHJldHVybiB0aGlzOwogIH0KCiAgZnVuY3Rpb24gZGF0YShrZXksIHZhbHVlKSB7CiAgICB2YXIgZWw7CgogICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgZWwgPSB0aGlzWzBdOwogICAgICBpZiAoIWVsKSByZXR1cm4gdW5kZWZpbmVkOyAvLyBHZXQgdmFsdWUKCiAgICAgIGlmIChlbC5kb203RWxlbWVudERhdGFTdG9yYWdlICYmIGtleSBpbiBlbC5kb203RWxlbWVudERhdGFTdG9yYWdlKSB7CiAgICAgICAgcmV0dXJuIGVsLmRvbTdFbGVtZW50RGF0YVN0b3JhZ2Vba2V5XTsKICAgICAgfQoKICAgICAgdmFyIGRhdGFLZXkgPSBlbC5nZXRBdHRyaWJ1dGUoImRhdGEtIiArIGtleSk7CgogICAgICBpZiAoZGF0YUtleSkgewogICAgICAgIHJldHVybiBkYXRhS2V5OwogICAgICB9CgogICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgfSAvLyBTZXQgdmFsdWUKCgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgIGVsID0gdGhpc1tpXTsKICAgICAgaWYgKCFlbC5kb203RWxlbWVudERhdGFTdG9yYWdlKSBlbC5kb203RWxlbWVudERhdGFTdG9yYWdlID0ge307CiAgICAgIGVsLmRvbTdFbGVtZW50RGF0YVN0b3JhZ2Vba2V5XSA9IHZhbHVlOwogICAgfQoKICAgIHJldHVybiB0aGlzOwogIH0KCiAgZnVuY3Rpb24gcmVtb3ZlRGF0YShrZXkpIHsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkgKz0gMSkgewogICAgICB2YXIgZWwgPSB0aGlzW2ldOwoKICAgICAgaWYgKGVsLmRvbTdFbGVtZW50RGF0YVN0b3JhZ2UgJiYgZWwuZG9tN0VsZW1lbnREYXRhU3RvcmFnZVtrZXldKSB7CiAgICAgICAgZWwuZG9tN0VsZW1lbnREYXRhU3RvcmFnZVtrZXldID0gbnVsbDsKICAgICAgICBkZWxldGUgZWwuZG9tN0VsZW1lbnREYXRhU3RvcmFnZVtrZXldOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBkYXRhc2V0KCkgewogICAgdmFyIGVsID0gdGhpc1swXTsKICAgIGlmICghZWwpIHJldHVybiB1bmRlZmluZWQ7CiAgICB2YXIgZGF0YXNldCA9IHt9OyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lCgogICAgaWYgKGVsLmRhdGFzZXQpIHsKICAgICAgZm9yICh2YXIgZGF0YUtleSBpbiBlbC5kYXRhc2V0KSB7CiAgICAgICAgZGF0YXNldFtkYXRhS2V5XSA9IGVsLmRhdGFzZXRbZGF0YUtleV07CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWwuYXR0cmlidXRlcy5sZW5ndGg7IGkgKz0gMSkgewogICAgICAgIHZhciBfYXR0ciA9IGVsLmF0dHJpYnV0ZXNbaV07CgogICAgICAgIGlmIChfYXR0ci5uYW1lLmluZGV4T2YoJ2RhdGEtJykgPj0gMCkgewogICAgICAgICAgZGF0YXNldFt0b0NhbWVsQ2FzZShfYXR0ci5uYW1lLnNwbGl0KCdkYXRhLScpWzFdKV0gPSBfYXR0ci52YWx1ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBmb3IgKHZhciBrZXkgaW4gZGF0YXNldCkgewogICAgICBpZiAoZGF0YXNldFtrZXldID09PSAnZmFsc2UnKSBkYXRhc2V0W2tleV0gPSBmYWxzZTtlbHNlIGlmIChkYXRhc2V0W2tleV0gPT09ICd0cnVlJykgZGF0YXNldFtrZXldID0gdHJ1ZTtlbHNlIGlmIChwYXJzZUZsb2F0KGRhdGFzZXRba2V5XSkgPT09IGRhdGFzZXRba2V5XSAqIDEpIGRhdGFzZXRba2V5XSAqPSAxOwogICAgfQoKICAgIHJldHVybiBkYXRhc2V0OwogIH0KCiAgZnVuY3Rpb24gdmFsKHZhbHVlKSB7CiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJykgewogICAgICAvLyBnZXQgdmFsdWUKICAgICAgdmFyIGVsID0gdGhpc1swXTsKICAgICAgaWYgKCFlbCkgcmV0dXJuIHVuZGVmaW5lZDsKCiAgICAgIGlmIChlbC5tdWx0aXBsZSAmJiBlbC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnc2VsZWN0JykgewogICAgICAgIHZhciB2YWx1ZXMgPSBbXTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbC5zZWxlY3RlZE9wdGlvbnMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICAgIHZhbHVlcy5wdXNoKGVsLnNlbGVjdGVkT3B0aW9uc1tpXS52YWx1ZSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdmFsdWVzOwogICAgICB9CgogICAgICByZXR1cm4gZWwudmFsdWU7CiAgICB9IC8vIHNldCB2YWx1ZQoKCiAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgdGhpcy5sZW5ndGg7IF9pICs9IDEpIHsKICAgICAgdmFyIF9lbCA9IHRoaXNbX2ldOwoKICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpICYmIF9lbC5tdWx0aXBsZSAmJiBfZWwubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ3NlbGVjdCcpIHsKICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IF9lbC5vcHRpb25zLmxlbmd0aDsgaiArPSAxKSB7CiAgICAgICAgICBfZWwub3B0aW9uc1tqXS5zZWxlY3RlZCA9IHZhbHVlLmluZGV4T2YoX2VsLm9wdGlvbnNbal0udmFsdWUpID49IDA7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIF9lbC52YWx1ZSA9IHZhbHVlOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfQoKICBmdW5jdGlvbiB2YWx1ZSh2YWx1ZSkgewogICAgcmV0dXJuIHRoaXMudmFsKHZhbHVlKTsKICB9CgogIGZ1bmN0aW9uIHRyYW5zZm9ybSh0cmFuc2Zvcm0pIHsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkgKz0gMSkgewogICAgICB0aGlzW2ldLnN0eWxlLnRyYW5zZm9ybSA9IHRyYW5zZm9ybTsKICAgIH0KCiAgICByZXR1cm4gdGhpczsKICB9CgogIGZ1bmN0aW9uIHRyYW5zaXRpb24oZHVyYXRpb24pIHsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkgKz0gMSkgewogICAgICB0aGlzW2ldLnN0eWxlLnRyYW5zaXRpb25EdXJhdGlvbiA9IHR5cGVvZiBkdXJhdGlvbiAhPT0gJ3N0cmluZycgPyBkdXJhdGlvbiArICJtcyIgOiBkdXJhdGlvbjsKICAgIH0KCiAgICByZXR1cm4gdGhpczsKICB9CgogIGZ1bmN0aW9uIG9uKCkgewogICAgZm9yICh2YXIgX2xlbjUgPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW41KSwgX2tleTUgPSAwOyBfa2V5NSA8IF9sZW41OyBfa2V5NSsrKSB7CiAgICAgIGFyZ3NbX2tleTVdID0gYXJndW1lbnRzW19rZXk1XTsKICAgIH0KCiAgICB2YXIgZXZlbnRUeXBlID0gYXJnc1swXSwKICAgICAgICB0YXJnZXRTZWxlY3RvciA9IGFyZ3NbMV0sCiAgICAgICAgbGlzdGVuZXIgPSBhcmdzWzJdLAogICAgICAgIGNhcHR1cmUgPSBhcmdzWzNdOwoKICAgIGlmICh0eXBlb2YgYXJnc1sxXSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICBldmVudFR5cGUgPSBhcmdzWzBdOwogICAgICBsaXN0ZW5lciA9IGFyZ3NbMV07CiAgICAgIGNhcHR1cmUgPSBhcmdzWzJdOwogICAgICB0YXJnZXRTZWxlY3RvciA9IHVuZGVmaW5lZDsKICAgIH0KCiAgICBpZiAoIWNhcHR1cmUpIGNhcHR1cmUgPSBmYWxzZTsKCiAgICBmdW5jdGlvbiBoYW5kbGVMaXZlRXZlbnQoZSkgewogICAgICB2YXIgdGFyZ2V0ID0gZS50YXJnZXQ7CiAgICAgIGlmICghdGFyZ2V0KSByZXR1cm47CiAgICAgIHZhciBldmVudERhdGEgPSBlLnRhcmdldC5kb203RXZlbnREYXRhIHx8IFtdOwoKICAgICAgaWYgKGV2ZW50RGF0YS5pbmRleE9mKGUpIDwgMCkgewogICAgICAgIGV2ZW50RGF0YS51bnNoaWZ0KGUpOwogICAgICB9CgogICAgICBpZiAoJCh0YXJnZXQpLmlzKHRhcmdldFNlbGVjdG9yKSkgbGlzdGVuZXIuYXBwbHkodGFyZ2V0LCBldmVudERhdGEpO2Vsc2UgewogICAgICAgIHZhciBfcGFyZW50cyA9ICQodGFyZ2V0KS5wYXJlbnRzKCk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUKCgogICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgX3BhcmVudHMubGVuZ3RoOyBrICs9IDEpIHsKICAgICAgICAgIGlmICgkKF9wYXJlbnRzW2tdKS5pcyh0YXJnZXRTZWxlY3RvcikpIGxpc3RlbmVyLmFwcGx5KF9wYXJlbnRzW2tdLCBldmVudERhdGEpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGhhbmRsZUV2ZW50KGUpIHsKICAgICAgdmFyIGV2ZW50RGF0YSA9IGUgJiYgZS50YXJnZXQgPyBlLnRhcmdldC5kb203RXZlbnREYXRhIHx8IFtdIDogW107CgogICAgICBpZiAoZXZlbnREYXRhLmluZGV4T2YoZSkgPCAwKSB7CiAgICAgICAgZXZlbnREYXRhLnVuc2hpZnQoZSk7CiAgICAgIH0KCiAgICAgIGxpc3RlbmVyLmFwcGx5KHRoaXMsIGV2ZW50RGF0YSk7CiAgICB9CgogICAgdmFyIGV2ZW50cyA9IGV2ZW50VHlwZS5zcGxpdCgnICcpOwogICAgdmFyIGo7CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgIHZhciBlbCA9IHRoaXNbaV07CgogICAgICBpZiAoIXRhcmdldFNlbGVjdG9yKSB7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IGV2ZW50cy5sZW5ndGg7IGogKz0gMSkgewogICAgICAgICAgdmFyIGV2ZW50ID0gZXZlbnRzW2pdOwogICAgICAgICAgaWYgKCFlbC5kb203TGlzdGVuZXJzKSBlbC5kb203TGlzdGVuZXJzID0ge307CiAgICAgICAgICBpZiAoIWVsLmRvbTdMaXN0ZW5lcnNbZXZlbnRdKSBlbC5kb203TGlzdGVuZXJzW2V2ZW50XSA9IFtdOwogICAgICAgICAgZWwuZG9tN0xpc3RlbmVyc1tldmVudF0ucHVzaCh7CiAgICAgICAgICAgIGxpc3RlbmVyOiBsaXN0ZW5lciwKICAgICAgICAgICAgcHJveHlMaXN0ZW5lcjogaGFuZGxlRXZlbnQKICAgICAgICAgIH0pOwogICAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgaGFuZGxlRXZlbnQsIGNhcHR1cmUpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBMaXZlIGV2ZW50cwogICAgICAgIGZvciAoaiA9IDA7IGogPCBldmVudHMubGVuZ3RoOyBqICs9IDEpIHsKICAgICAgICAgIHZhciBfZXZlbnQgPSBldmVudHNbal07CiAgICAgICAgICBpZiAoIWVsLmRvbTdMaXZlTGlzdGVuZXJzKSBlbC5kb203TGl2ZUxpc3RlbmVycyA9IHt9OwogICAgICAgICAgaWYgKCFlbC5kb203TGl2ZUxpc3RlbmVyc1tfZXZlbnRdKSBlbC5kb203TGl2ZUxpc3RlbmVyc1tfZXZlbnRdID0gW107CgogICAgICAgICAgZWwuZG9tN0xpdmVMaXN0ZW5lcnNbX2V2ZW50XS5wdXNoKHsKICAgICAgICAgICAgbGlzdGVuZXI6IGxpc3RlbmVyLAogICAgICAgICAgICBwcm94eUxpc3RlbmVyOiBoYW5kbGVMaXZlRXZlbnQKICAgICAgICAgIH0pOwoKICAgICAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoX2V2ZW50LCBoYW5kbGVMaXZlRXZlbnQsIGNhcHR1cmUpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHJldHVybiB0aGlzOwogIH0KCiAgZnVuY3Rpb24gb2ZmKCkgewogICAgZm9yICh2YXIgX2xlbjYgPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW42KSwgX2tleTYgPSAwOyBfa2V5NiA8IF9sZW42OyBfa2V5NisrKSB7CiAgICAgIGFyZ3NbX2tleTZdID0gYXJndW1lbnRzW19rZXk2XTsKICAgIH0KCiAgICB2YXIgZXZlbnRUeXBlID0gYXJnc1swXSwKICAgICAgICB0YXJnZXRTZWxlY3RvciA9IGFyZ3NbMV0sCiAgICAgICAgbGlzdGVuZXIgPSBhcmdzWzJdLAogICAgICAgIGNhcHR1cmUgPSBhcmdzWzNdOwoKICAgIGlmICh0eXBlb2YgYXJnc1sxXSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICBldmVudFR5cGUgPSBhcmdzWzBdOwogICAgICBsaXN0ZW5lciA9IGFyZ3NbMV07CiAgICAgIGNhcHR1cmUgPSBhcmdzWzJdOwogICAgICB0YXJnZXRTZWxlY3RvciA9IHVuZGVmaW5lZDsKICAgIH0KCiAgICBpZiAoIWNhcHR1cmUpIGNhcHR1cmUgPSBmYWxzZTsKICAgIHZhciBldmVudHMgPSBldmVudFR5cGUuc3BsaXQoJyAnKTsKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50cy5sZW5ndGg7IGkgKz0gMSkgewogICAgICB2YXIgZXZlbnQgPSBldmVudHNbaV07CgogICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMubGVuZ3RoOyBqICs9IDEpIHsKICAgICAgICB2YXIgZWwgPSB0aGlzW2pdOwogICAgICAgIHZhciBoYW5kbGVycyA9IHZvaWQgMDsKCiAgICAgICAgaWYgKCF0YXJnZXRTZWxlY3RvciAmJiBlbC5kb203TGlzdGVuZXJzKSB7CiAgICAgICAgICBoYW5kbGVycyA9IGVsLmRvbTdMaXN0ZW5lcnNbZXZlbnRdOwogICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0U2VsZWN0b3IgJiYgZWwuZG9tN0xpdmVMaXN0ZW5lcnMpIHsKICAgICAgICAgIGhhbmRsZXJzID0gZWwuZG9tN0xpdmVMaXN0ZW5lcnNbZXZlbnRdOwogICAgICAgIH0KCiAgICAgICAgaWYgKGhhbmRsZXJzICYmIGhhbmRsZXJzLmxlbmd0aCkgewogICAgICAgICAgZm9yICh2YXIgayA9IGhhbmRsZXJzLmxlbmd0aCAtIDE7IGsgPj0gMDsgayAtPSAxKSB7CiAgICAgICAgICAgIHZhciBoYW5kbGVyID0gaGFuZGxlcnNba107CgogICAgICAgICAgICBpZiAobGlzdGVuZXIgJiYgaGFuZGxlci5saXN0ZW5lciA9PT0gbGlzdGVuZXIpIHsKICAgICAgICAgICAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LCBoYW5kbGVyLnByb3h5TGlzdGVuZXIsIGNhcHR1cmUpOwogICAgICAgICAgICAgIGhhbmRsZXJzLnNwbGljZShrLCAxKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChsaXN0ZW5lciAmJiBoYW5kbGVyLmxpc3RlbmVyICYmIGhhbmRsZXIubGlzdGVuZXIuZG9tN3Byb3h5ICYmIGhhbmRsZXIubGlzdGVuZXIuZG9tN3Byb3h5ID09PSBsaXN0ZW5lcikgewogICAgICAgICAgICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnQsIGhhbmRsZXIucHJveHlMaXN0ZW5lciwgY2FwdHVyZSk7CiAgICAgICAgICAgICAgaGFuZGxlcnMuc3BsaWNlKGssIDEpOwogICAgICAgICAgICB9IGVsc2UgaWYgKCFsaXN0ZW5lcikgewogICAgICAgICAgICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnQsIGhhbmRsZXIucHJveHlMaXN0ZW5lciwgY2FwdHVyZSk7CiAgICAgICAgICAgICAgaGFuZGxlcnMuc3BsaWNlKGssIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfQoKICBmdW5jdGlvbiBvbmNlKCkgewogICAgdmFyIGRvbSA9IHRoaXM7CgogICAgZm9yICh2YXIgX2xlbjcgPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW43KSwgX2tleTcgPSAwOyBfa2V5NyA8IF9sZW43OyBfa2V5NysrKSB7CiAgICAgIGFyZ3NbX2tleTddID0gYXJndW1lbnRzW19rZXk3XTsKICAgIH0KCiAgICB2YXIgZXZlbnROYW1lID0gYXJnc1swXSwKICAgICAgICB0YXJnZXRTZWxlY3RvciA9IGFyZ3NbMV0sCiAgICAgICAgbGlzdGVuZXIgPSBhcmdzWzJdLAogICAgICAgIGNhcHR1cmUgPSBhcmdzWzNdOwoKICAgIGlmICh0eXBlb2YgYXJnc1sxXSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICBldmVudE5hbWUgPSBhcmdzWzBdOwogICAgICBsaXN0ZW5lciA9IGFyZ3NbMV07CiAgICAgIGNhcHR1cmUgPSBhcmdzWzJdOwogICAgICB0YXJnZXRTZWxlY3RvciA9IHVuZGVmaW5lZDsKICAgIH0KCiAgICBmdW5jdGlvbiBvbmNlSGFuZGxlcigpIHsKICAgICAgZm9yICh2YXIgX2xlbjggPSBhcmd1bWVudHMubGVuZ3RoLCBldmVudEFyZ3MgPSBuZXcgQXJyYXkoX2xlbjgpLCBfa2V5OCA9IDA7IF9rZXk4IDwgX2xlbjg7IF9rZXk4KyspIHsKICAgICAgICBldmVudEFyZ3NbX2tleThdID0gYXJndW1lbnRzW19rZXk4XTsKICAgICAgfQoKICAgICAgbGlzdGVuZXIuYXBwbHkodGhpcywgZXZlbnRBcmdzKTsKICAgICAgZG9tLm9mZihldmVudE5hbWUsIHRhcmdldFNlbGVjdG9yLCBvbmNlSGFuZGxlciwgY2FwdHVyZSk7CgogICAgICBpZiAob25jZUhhbmRsZXIuZG9tN3Byb3h5KSB7CiAgICAgICAgZGVsZXRlIG9uY2VIYW5kbGVyLmRvbTdwcm94eTsKICAgICAgfQogICAgfQoKICAgIG9uY2VIYW5kbGVyLmRvbTdwcm94eSA9IGxpc3RlbmVyOwogICAgcmV0dXJuIGRvbS5vbihldmVudE5hbWUsIHRhcmdldFNlbGVjdG9yLCBvbmNlSGFuZGxlciwgY2FwdHVyZSk7CiAgfQoKICBmdW5jdGlvbiB0cmlnZ2VyKCkgewogICAgdmFyIHdpbmRvdyA9IHNzcldpbmRvd191bWQuZ2V0V2luZG93KCk7CgogICAgZm9yICh2YXIgX2xlbjkgPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW45KSwgX2tleTkgPSAwOyBfa2V5OSA8IF9sZW45OyBfa2V5OSsrKSB7CiAgICAgIGFyZ3NbX2tleTldID0gYXJndW1lbnRzW19rZXk5XTsKICAgIH0KCiAgICB2YXIgZXZlbnRzID0gYXJnc1swXS5zcGxpdCgnICcpOwogICAgdmFyIGV2ZW50RGF0YSA9IGFyZ3NbMV07CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBldmVudHMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgdmFyIGV2ZW50ID0gZXZlbnRzW2ldOwoKICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLmxlbmd0aDsgaiArPSAxKSB7CiAgICAgICAgdmFyIGVsID0gdGhpc1tqXTsKCiAgICAgICAgaWYgKHdpbmRvdy5DdXN0b21FdmVudCkgewogICAgICAgICAgdmFyIGV2dCA9IG5ldyB3aW5kb3cuQ3VzdG9tRXZlbnQoZXZlbnQsIHsKICAgICAgICAgICAgZGV0YWlsOiBldmVudERhdGEsCiAgICAgICAgICAgIGJ1YmJsZXM6IHRydWUsCiAgICAgICAgICAgIGNhbmNlbGFibGU6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgICAgZWwuZG9tN0V2ZW50RGF0YSA9IGFyZ3MuZmlsdGVyKGZ1bmN0aW9uIChkYXRhLCBkYXRhSW5kZXgpIHsKICAgICAgICAgICAgcmV0dXJuIGRhdGFJbmRleCA+IDA7CiAgICAgICAgICB9KTsKICAgICAgICAgIGVsLmRpc3BhdGNoRXZlbnQoZXZ0KTsKICAgICAgICAgIGVsLmRvbTdFdmVudERhdGEgPSBbXTsKICAgICAgICAgIGRlbGV0ZSBlbC5kb203RXZlbnREYXRhOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHJldHVybiB0aGlzOwogIH0KCiAgZnVuY3Rpb24gdHJhbnNpdGlvbkVuZChjYWxsYmFjaykgewogICAgdmFyIGRvbSA9IHRoaXM7CgogICAgZnVuY3Rpb24gZmlyZUNhbGxCYWNrKGUpIHsKICAgICAgaWYgKGUudGFyZ2V0ICE9PSB0aGlzKSByZXR1cm47CiAgICAgIGNhbGxiYWNrLmNhbGwodGhpcywgZSk7CiAgICAgIGRvbS5vZmYoJ3RyYW5zaXRpb25lbmQnLCBmaXJlQ2FsbEJhY2spOwogICAgfQoKICAgIGlmIChjYWxsYmFjaykgewogICAgICBkb20ub24oJ3RyYW5zaXRpb25lbmQnLCBmaXJlQ2FsbEJhY2spOwogICAgfQoKICAgIHJldHVybiB0aGlzOwogIH0KCiAgZnVuY3Rpb24gYW5pbWF0aW9uRW5kKGNhbGxiYWNrKSB7CiAgICB2YXIgZG9tID0gdGhpczsKCiAgICBmdW5jdGlvbiBmaXJlQ2FsbEJhY2soZSkgewogICAgICBpZiAoZS50YXJnZXQgIT09IHRoaXMpIHJldHVybjsKICAgICAgY2FsbGJhY2suY2FsbCh0aGlzLCBlKTsKICAgICAgZG9tLm9mZignYW5pbWF0aW9uZW5kJywgZmlyZUNhbGxCYWNrKTsKICAgIH0KCiAgICBpZiAoY2FsbGJhY2spIHsKICAgICAgZG9tLm9uKCdhbmltYXRpb25lbmQnLCBmaXJlQ2FsbEJhY2spOwogICAgfQoKICAgIHJldHVybiB0aGlzOwogIH0KCiAgZnVuY3Rpb24gd2lkdGgoKSB7CiAgICB2YXIgd2luZG93ID0gc3NyV2luZG93X3VtZC5nZXRXaW5kb3coKTsKCiAgICBpZiAodGhpc1swXSA9PT0gd2luZG93KSB7CiAgICAgIHJldHVybiB3aW5kb3cuaW5uZXJXaWR0aDsKICAgIH0KCiAgICBpZiAodGhpcy5sZW5ndGggPiAwKSB7CiAgICAgIHJldHVybiBwYXJzZUZsb2F0KHRoaXMuY3NzKCd3aWR0aCcpKTsKICAgIH0KCiAgICByZXR1cm4gbnVsbDsKICB9CgogIGZ1bmN0aW9uIG91dGVyV2lkdGgoaW5jbHVkZU1hcmdpbnMpIHsKICAgIGlmICh0aGlzLmxlbmd0aCA+IDApIHsKICAgICAgaWYgKGluY2x1ZGVNYXJnaW5zKSB7CiAgICAgICAgdmFyIF9zdHlsZXMgPSB0aGlzLnN0eWxlcygpOwoKICAgICAgICByZXR1cm4gdGhpc1swXS5vZmZzZXRXaWR0aCArIHBhcnNlRmxvYXQoX3N0eWxlcy5nZXRQcm9wZXJ0eVZhbHVlKCdtYXJnaW4tcmlnaHQnKSkgKyBwYXJzZUZsb2F0KF9zdHlsZXMuZ2V0UHJvcGVydHlWYWx1ZSgnbWFyZ2luLWxlZnQnKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzWzBdLm9mZnNldFdpZHRoOwogICAgfQoKICAgIHJldHVybiBudWxsOwogIH0KCiAgZnVuY3Rpb24gaGVpZ2h0KCkgewogICAgdmFyIHdpbmRvdyA9IHNzcldpbmRvd191bWQuZ2V0V2luZG93KCk7CgogICAgaWYgKHRoaXNbMF0gPT09IHdpbmRvdykgewogICAgICByZXR1cm4gd2luZG93LmlubmVySGVpZ2h0OwogICAgfQoKICAgIGlmICh0aGlzLmxlbmd0aCA+IDApIHsKICAgICAgcmV0dXJuIHBhcnNlRmxvYXQodGhpcy5jc3MoJ2hlaWdodCcpKTsKICAgIH0KCiAgICByZXR1cm4gbnVsbDsKICB9CgogIGZ1bmN0aW9uIG91dGVySGVpZ2h0KGluY2x1ZGVNYXJnaW5zKSB7CiAgICBpZiAodGhpcy5sZW5ndGggPiAwKSB7CiAgICAgIGlmIChpbmNsdWRlTWFyZ2lucykgewogICAgICAgIHZhciBfc3R5bGVzMiA9IHRoaXMuc3R5bGVzKCk7CgogICAgICAgIHJldHVybiB0aGlzWzBdLm9mZnNldEhlaWdodCArIHBhcnNlRmxvYXQoX3N0eWxlczIuZ2V0UHJvcGVydHlWYWx1ZSgnbWFyZ2luLXRvcCcpKSArIHBhcnNlRmxvYXQoX3N0eWxlczIuZ2V0UHJvcGVydHlWYWx1ZSgnbWFyZ2luLWJvdHRvbScpKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXNbMF0ub2Zmc2V0SGVpZ2h0OwogICAgfQoKICAgIHJldHVybiBudWxsOwogIH0KCiAgZnVuY3Rpb24gb2Zmc2V0KCkgewogICAgaWYgKHRoaXMubGVuZ3RoID4gMCkgewogICAgICB2YXIgd2luZG93ID0gc3NyV2luZG93X3VtZC5nZXRXaW5kb3coKTsKICAgICAgdmFyIGRvY3VtZW50ID0gc3NyV2luZG93X3VtZC5nZXREb2N1bWVudCgpOwogICAgICB2YXIgZWwgPSB0aGlzWzBdOwogICAgICB2YXIgYm94ID0gZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgIHZhciBib2R5ID0gZG9jdW1lbnQuYm9keTsKICAgICAgdmFyIGNsaWVudFRvcCA9IGVsLmNsaWVudFRvcCB8fCBib2R5LmNsaWVudFRvcCB8fCAwOwogICAgICB2YXIgY2xpZW50TGVmdCA9IGVsLmNsaWVudExlZnQgfHwgYm9keS5jbGllbnRMZWZ0IHx8IDA7CiAgICAgIHZhciBzY3JvbGxUb3AgPSBlbCA9PT0gd2luZG93ID8gd2luZG93LnNjcm9sbFkgOiBlbC5zY3JvbGxUb3A7CiAgICAgIHZhciBzY3JvbGxMZWZ0ID0gZWwgPT09IHdpbmRvdyA/IHdpbmRvdy5zY3JvbGxYIDogZWwuc2Nyb2xsTGVmdDsKICAgICAgcmV0dXJuIHsKICAgICAgICB0b3A6IGJveC50b3AgKyBzY3JvbGxUb3AgLSBjbGllbnRUb3AsCiAgICAgICAgbGVmdDogYm94LmxlZnQgKyBzY3JvbGxMZWZ0IC0gY2xpZW50TGVmdAogICAgICB9OwogICAgfQoKICAgIHJldHVybiBudWxsOwogIH0KCiAgZnVuY3Rpb24gaGlkZSgpIHsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkgKz0gMSkgewogICAgICB0aGlzW2ldLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfQoKICBmdW5jdGlvbiBzaG93KCkgewogICAgdmFyIHdpbmRvdyA9IHNzcldpbmRvd191bWQuZ2V0V2luZG93KCk7CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgIHZhciBlbCA9IHRoaXNbaV07CgogICAgICBpZiAoZWwuc3R5bGUuZGlzcGxheSA9PT0gJ25vbmUnKSB7CiAgICAgICAgZWwuc3R5bGUuZGlzcGxheSA9ICcnOwogICAgICB9CgogICAgICBpZiAod2luZG93LmdldENvbXB1dGVkU3R5bGUoZWwsIG51bGwpLmdldFByb3BlcnR5VmFsdWUoJ2Rpc3BsYXknKSA9PT0gJ25vbmUnKSB7CiAgICAgICAgLy8gU3RpbGwgbm90IHZpc2libGUKICAgICAgICBlbC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgfQogICAgfQoKICAgIHJldHVybiB0aGlzOwogIH0KCiAgZnVuY3Rpb24gc3R5bGVzKCkgewogICAgdmFyIHdpbmRvdyA9IHNzcldpbmRvd191bWQuZ2V0V2luZG93KCk7CiAgICBpZiAodGhpc1swXSkgcmV0dXJuIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHRoaXNbMF0sIG51bGwpOwogICAgcmV0dXJuIHt9OwogIH0KCiAgZnVuY3Rpb24gY3NzKHByb3BzLCB2YWx1ZSkgewogICAgdmFyIHdpbmRvdyA9IHNzcldpbmRvd191bWQuZ2V0V2luZG93KCk7CiAgICB2YXIgaTsKCiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSkgewogICAgICBpZiAodHlwZW9mIHByb3BzID09PSAnc3RyaW5nJykgewogICAgICAgIC8vIC5jc3MoJ3dpZHRoJykKICAgICAgICBpZiAodGhpc1swXSkgcmV0dXJuIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHRoaXNbMF0sIG51bGwpLmdldFByb3BlcnR5VmFsdWUocHJvcHMpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIC5jc3MoeyB3aWR0aDogJzEwMHB4JyB9KQogICAgICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICBmb3IgKHZhciBfcHJvcCBpbiBwcm9wcykgewogICAgICAgICAgICB0aGlzW2ldLnN0eWxlW19wcm9wXSA9IHByb3BzW19wcm9wXTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICB9CgogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIgJiYgdHlwZW9mIHByb3BzID09PSAnc3RyaW5nJykgewogICAgICAvLyAuY3NzKCd3aWR0aCcsICcxMDBweCcpCiAgICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgdGhpc1tpXS5zdHlsZVtwcm9wc10gPSB2YWx1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfQoKICBmdW5jdGlvbiBlYWNoKGNhbGxiYWNrKSB7CiAgICBpZiAoIWNhbGxiYWNrKSByZXR1cm4gdGhpczsKICAgIHRoaXMuZm9yRWFjaChmdW5jdGlvbiAoZWwsIGluZGV4KSB7CiAgICAgIGNhbGxiYWNrLmFwcGx5KGVsLCBbZWwsIGluZGV4XSk7CiAgICB9KTsKICAgIHJldHVybiB0aGlzOwogIH0KCiAgZnVuY3Rpb24gZmlsdGVyKGNhbGxiYWNrKSB7CiAgICB2YXIgcmVzdWx0ID0gYXJyYXlGaWx0ZXIodGhpcywgY2FsbGJhY2spOwogICAgcmV0dXJuICQocmVzdWx0KTsKICB9CgogIGZ1bmN0aW9uIGh0bWwoaHRtbCkgewogICAgaWYgKHR5cGVvZiBodG1sID09PSAndW5kZWZpbmVkJykgewogICAgICByZXR1cm4gdGhpc1swXSA/IHRoaXNbMF0uaW5uZXJIVE1MIDogbnVsbDsKICAgIH0KCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgdGhpc1tpXS5pbm5lckhUTUwgPSBodG1sOwogICAgfQoKICAgIHJldHVybiB0aGlzOwogIH0KCiAgZnVuY3Rpb24gdGV4dCh0ZXh0KSB7CiAgICBpZiAodHlwZW9mIHRleHQgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgIHJldHVybiB0aGlzWzBdID8gdGhpc1swXS50ZXh0Q29udGVudC50cmltKCkgOiBudWxsOwogICAgfQoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkgKz0gMSkgewogICAgICB0aGlzW2ldLnRleHRDb250ZW50ID0gdGV4dDsKICAgIH0KCiAgICByZXR1cm4gdGhpczsKICB9CgogIGZ1bmN0aW9uIGlzKHNlbGVjdG9yKSB7CiAgICB2YXIgd2luZG93ID0gc3NyV2luZG93X3VtZC5nZXRXaW5kb3coKTsKICAgIHZhciBkb2N1bWVudCA9IHNzcldpbmRvd191bWQuZ2V0RG9jdW1lbnQoKTsKICAgIHZhciBlbCA9IHRoaXNbMF07CiAgICB2YXIgY29tcGFyZVdpdGg7CiAgICB2YXIgaTsKICAgIGlmICghZWwgfHwgdHlwZW9mIHNlbGVjdG9yID09PSAndW5kZWZpbmVkJykgcmV0dXJuIGZhbHNlOwoKICAgIGlmICh0eXBlb2Ygc2VsZWN0b3IgPT09ICdzdHJpbmcnKSB7CiAgICAgIGlmIChlbC5tYXRjaGVzKSByZXR1cm4gZWwubWF0Y2hlcyhzZWxlY3Rvcik7CiAgICAgIGlmIChlbC53ZWJraXRNYXRjaGVzU2VsZWN0b3IpIHJldHVybiBlbC53ZWJraXRNYXRjaGVzU2VsZWN0b3Ioc2VsZWN0b3IpOwogICAgICBpZiAoZWwubXNNYXRjaGVzU2VsZWN0b3IpIHJldHVybiBlbC5tc01hdGNoZXNTZWxlY3RvcihzZWxlY3Rvcik7CiAgICAgIGNvbXBhcmVXaXRoID0gJChzZWxlY3Rvcik7CgogICAgICBmb3IgKGkgPSAwOyBpIDwgY29tcGFyZVdpdGgubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICBpZiAoY29tcGFyZVdpdGhbaV0gPT09IGVsKSByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGlmIChzZWxlY3RvciA9PT0gZG9jdW1lbnQpIHsKICAgICAgcmV0dXJuIGVsID09PSBkb2N1bWVudDsKICAgIH0KCiAgICBpZiAoc2VsZWN0b3IgPT09IHdpbmRvdykgewogICAgICByZXR1cm4gZWwgPT09IHdpbmRvdzsKICAgIH0KCiAgICBpZiAoc2VsZWN0b3Iubm9kZVR5cGUgfHwgc2VsZWN0b3IgaW5zdGFuY2VvZiBEb203KSB7CiAgICAgIGNvbXBhcmVXaXRoID0gc2VsZWN0b3Iubm9kZVR5cGUgPyBbc2VsZWN0b3JdIDogc2VsZWN0b3I7CgogICAgICBmb3IgKGkgPSAwOyBpIDwgY29tcGFyZVdpdGgubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICBpZiAoY29tcGFyZVdpdGhbaV0gPT09IGVsKSByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHJldHVybiBmYWxzZTsKICB9CgogIGZ1bmN0aW9uIGluZGV4JDEoKSB7CiAgICB2YXIgY2hpbGQgPSB0aGlzWzBdOwogICAgdmFyIGk7CgogICAgaWYgKGNoaWxkKSB7CiAgICAgIGkgPSAwOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUKCiAgICAgIHdoaWxlICgoY2hpbGQgPSBjaGlsZC5wcmV2aW91c1NpYmxpbmcpICE9PSBudWxsKSB7CiAgICAgICAgaWYgKGNoaWxkLm5vZGVUeXBlID09PSAxKSBpICs9IDE7CiAgICAgIH0KCiAgICAgIHJldHVybiBpOwogICAgfQoKICAgIHJldHVybiB1bmRlZmluZWQ7CiAgfQoKICBmdW5jdGlvbiBlcShpbmRleCkgewogICAgaWYgKHR5cGVvZiBpbmRleCA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybiB0aGlzOwogICAgdmFyIGxlbmd0aCA9IHRoaXMubGVuZ3RoOwoKICAgIGlmIChpbmRleCA+IGxlbmd0aCAtIDEpIHsKICAgICAgcmV0dXJuICQoW10pOwogICAgfQoKICAgIGlmIChpbmRleCA8IDApIHsKICAgICAgdmFyIHJldHVybkluZGV4ID0gbGVuZ3RoICsgaW5kZXg7CiAgICAgIGlmIChyZXR1cm5JbmRleCA8IDApIHJldHVybiAkKFtdKTsKICAgICAgcmV0dXJuICQoW3RoaXNbcmV0dXJuSW5kZXhdXSk7CiAgICB9CgogICAgcmV0dXJuICQoW3RoaXNbaW5kZXhdXSk7CiAgfQoKICBmdW5jdGlvbiBhcHBlbmQoKSB7CiAgICB2YXIgbmV3Q2hpbGQ7CiAgICB2YXIgZG9jdW1lbnQgPSBzc3JXaW5kb3dfdW1kLmdldERvY3VtZW50KCk7CgogICAgZm9yICh2YXIgayA9IDA7IGsgPCBhcmd1bWVudHMubGVuZ3RoOyBrICs9IDEpIHsKICAgICAgbmV3Q2hpbGQgPSBrIDwgMCB8fCBhcmd1bWVudHMubGVuZ3RoIDw9IGsgPyB1bmRlZmluZWQgOiBhcmd1bWVudHNba107CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICBpZiAodHlwZW9mIG5ld0NoaWxkID09PSAnc3RyaW5nJykgewogICAgICAgICAgdmFyIHRlbXBEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgIHRlbXBEaXYuaW5uZXJIVE1MID0gbmV3Q2hpbGQ7CgogICAgICAgICAgd2hpbGUgKHRlbXBEaXYuZmlyc3RDaGlsZCkgewogICAgICAgICAgICB0aGlzW2ldLmFwcGVuZENoaWxkKHRlbXBEaXYuZmlyc3RDaGlsZCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChuZXdDaGlsZCBpbnN0YW5jZW9mIERvbTcpIHsKICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbmV3Q2hpbGQubGVuZ3RoOyBqICs9IDEpIHsKICAgICAgICAgICAgdGhpc1tpXS5hcHBlbmRDaGlsZChuZXdDaGlsZFtqXSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXNbaV0uYXBwZW5kQ2hpbGQobmV3Q2hpbGQpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHJldHVybiB0aGlzOwogIH0KCiAgZnVuY3Rpb24gYXBwZW5kVG8ocGFyZW50KSB7CiAgICAkKHBhcmVudCkuYXBwZW5kKHRoaXMpOwogICAgcmV0dXJuIHRoaXM7CiAgfQoKICBmdW5jdGlvbiBwcmVwZW5kKG5ld0NoaWxkKSB7CiAgICB2YXIgZG9jdW1lbnQgPSBzc3JXaW5kb3dfdW1kLmdldERvY3VtZW50KCk7CiAgICB2YXIgaTsKICAgIHZhciBqOwoKICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgIGlmICh0eXBlb2YgbmV3Q2hpbGQgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgdmFyIHRlbXBEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICB0ZW1wRGl2LmlubmVySFRNTCA9IG5ld0NoaWxkOwoKICAgICAgICBmb3IgKGogPSB0ZW1wRGl2LmNoaWxkTm9kZXMubGVuZ3RoIC0gMTsgaiA+PSAwOyBqIC09IDEpIHsKICAgICAgICAgIHRoaXNbaV0uaW5zZXJ0QmVmb3JlKHRlbXBEaXYuY2hpbGROb2Rlc1tqXSwgdGhpc1tpXS5jaGlsZE5vZGVzWzBdKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAobmV3Q2hpbGQgaW5zdGFuY2VvZiBEb203KSB7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IG5ld0NoaWxkLmxlbmd0aDsgaiArPSAxKSB7CiAgICAgICAgICB0aGlzW2ldLmluc2VydEJlZm9yZShuZXdDaGlsZFtqXSwgdGhpc1tpXS5jaGlsZE5vZGVzWzBdKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpc1tpXS5pbnNlcnRCZWZvcmUobmV3Q2hpbGQsIHRoaXNbaV0uY2hpbGROb2Rlc1swXSk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdGhpczsKICB9CgogIGZ1bmN0aW9uIHByZXBlbmRUbyhwYXJlbnQpIHsKICAgICQocGFyZW50KS5wcmVwZW5kKHRoaXMpOwogICAgcmV0dXJuIHRoaXM7CiAgfQoKICBmdW5jdGlvbiBpbnNlcnRCZWZvcmUoc2VsZWN0b3IpIHsKICAgIHZhciBiZWZvcmUgPSAkKHNlbGVjdG9yKTsKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgaWYgKGJlZm9yZS5sZW5ndGggPT09IDEpIHsKICAgICAgICBiZWZvcmVbMF0ucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpc1tpXSwgYmVmb3JlWzBdKTsKICAgICAgfSBlbHNlIGlmIChiZWZvcmUubGVuZ3RoID4gMSkgewogICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgYmVmb3JlLmxlbmd0aDsgaiArPSAxKSB7CiAgICAgICAgICBiZWZvcmVbal0ucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpc1tpXS5jbG9uZU5vZGUodHJ1ZSksIGJlZm9yZVtqXSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBpbnNlcnRBZnRlcihzZWxlY3RvcikgewogICAgdmFyIGFmdGVyID0gJChzZWxlY3Rvcik7CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgIGlmIChhZnRlci5sZW5ndGggPT09IDEpIHsKICAgICAgICBhZnRlclswXS5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh0aGlzW2ldLCBhZnRlclswXS5uZXh0U2libGluZyk7CiAgICAgIH0gZWxzZSBpZiAoYWZ0ZXIubGVuZ3RoID4gMSkgewogICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgYWZ0ZXIubGVuZ3RoOyBqICs9IDEpIHsKICAgICAgICAgIGFmdGVyW2pdLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRoaXNbaV0uY2xvbmVOb2RlKHRydWUpLCBhZnRlcltqXS5uZXh0U2libGluZyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBuZXh0KHNlbGVjdG9yKSB7CiAgICBpZiAodGhpcy5sZW5ndGggPiAwKSB7CiAgICAgIGlmIChzZWxlY3RvcikgewogICAgICAgIGlmICh0aGlzWzBdLm5leHRFbGVtZW50U2libGluZyAmJiAkKHRoaXNbMF0ubmV4dEVsZW1lbnRTaWJsaW5nKS5pcyhzZWxlY3RvcikpIHsKICAgICAgICAgIHJldHVybiAkKFt0aGlzWzBdLm5leHRFbGVtZW50U2libGluZ10pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICQoW10pOwogICAgICB9CgogICAgICBpZiAodGhpc1swXS5uZXh0RWxlbWVudFNpYmxpbmcpIHJldHVybiAkKFt0aGlzWzBdLm5leHRFbGVtZW50U2libGluZ10pOwogICAgICByZXR1cm4gJChbXSk7CiAgICB9CgogICAgcmV0dXJuICQoW10pOwogIH0KCiAgZnVuY3Rpb24gbmV4dEFsbChzZWxlY3RvcikgewogICAgdmFyIG5leHRFbHMgPSBbXTsKICAgIHZhciBlbCA9IHRoaXNbMF07CiAgICBpZiAoIWVsKSByZXR1cm4gJChbXSk7CgogICAgd2hpbGUgKGVsLm5leHRFbGVtZW50U2libGluZykgewogICAgICB2YXIgX25leHQgPSBlbC5uZXh0RWxlbWVudFNpYmxpbmc7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUKCiAgICAgIGlmIChzZWxlY3RvcikgewogICAgICAgIGlmICgkKF9uZXh0KS5pcyhzZWxlY3RvcikpIG5leHRFbHMucHVzaChfbmV4dCk7CiAgICAgIH0gZWxzZSBuZXh0RWxzLnB1c2goX25leHQpOwoKICAgICAgZWwgPSBfbmV4dDsKICAgIH0KCiAgICByZXR1cm4gJChuZXh0RWxzKTsKICB9CgogIGZ1bmN0aW9uIHByZXYoc2VsZWN0b3IpIHsKICAgIGlmICh0aGlzLmxlbmd0aCA+IDApIHsKICAgICAgdmFyIGVsID0gdGhpc1swXTsKCiAgICAgIGlmIChzZWxlY3RvcikgewogICAgICAgIGlmIChlbC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nICYmICQoZWwucHJldmlvdXNFbGVtZW50U2libGluZykuaXMoc2VsZWN0b3IpKSB7CiAgICAgICAgICByZXR1cm4gJChbZWwucHJldmlvdXNFbGVtZW50U2libGluZ10pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICQoW10pOwogICAgICB9CgogICAgICBpZiAoZWwucHJldmlvdXNFbGVtZW50U2libGluZykgcmV0dXJuICQoW2VsLnByZXZpb3VzRWxlbWVudFNpYmxpbmddKTsKICAgICAgcmV0dXJuICQoW10pOwogICAgfQoKICAgIHJldHVybiAkKFtdKTsKICB9CgogIGZ1bmN0aW9uIHByZXZBbGwoc2VsZWN0b3IpIHsKICAgIHZhciBwcmV2RWxzID0gW107CiAgICB2YXIgZWwgPSB0aGlzWzBdOwogICAgaWYgKCFlbCkgcmV0dXJuICQoW10pOwoKICAgIHdoaWxlIChlbC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nKSB7CiAgICAgIHZhciBfcHJldiA9IGVsLnByZXZpb3VzRWxlbWVudFNpYmxpbmc7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUKCiAgICAgIGlmIChzZWxlY3RvcikgewogICAgICAgIGlmICgkKF9wcmV2KS5pcyhzZWxlY3RvcikpIHByZXZFbHMucHVzaChfcHJldik7CiAgICAgIH0gZWxzZSBwcmV2RWxzLnB1c2goX3ByZXYpOwoKICAgICAgZWwgPSBfcHJldjsKICAgIH0KCiAgICByZXR1cm4gJChwcmV2RWxzKTsKICB9CgogIGZ1bmN0aW9uIHNpYmxpbmdzKHNlbGVjdG9yKSB7CiAgICByZXR1cm4gdGhpcy5uZXh0QWxsKHNlbGVjdG9yKS5hZGQodGhpcy5wcmV2QWxsKHNlbGVjdG9yKSk7CiAgfQoKICBmdW5jdGlvbiBwYXJlbnQoc2VsZWN0b3IpIHsKICAgIHZhciBwYXJlbnRzID0gW107IC8vIGVzbGludC1kaXNhYmxlLWxpbmUKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgaWYgKHRoaXNbaV0ucGFyZW50Tm9kZSAhPT0gbnVsbCkgewogICAgICAgIGlmIChzZWxlY3RvcikgewogICAgICAgICAgaWYgKCQodGhpc1tpXS5wYXJlbnROb2RlKS5pcyhzZWxlY3RvcikpIHBhcmVudHMucHVzaCh0aGlzW2ldLnBhcmVudE5vZGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBwYXJlbnRzLnB1c2godGhpc1tpXS5wYXJlbnROb2RlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gJChwYXJlbnRzKTsKICB9CgogIGZ1bmN0aW9uIHBhcmVudHMoc2VsZWN0b3IpIHsKICAgIHZhciBwYXJlbnRzID0gW107IC8vIGVzbGludC1kaXNhYmxlLWxpbmUKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgdmFyIF9wYXJlbnQgPSB0aGlzW2ldLnBhcmVudE5vZGU7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUKCiAgICAgIHdoaWxlIChfcGFyZW50KSB7CiAgICAgICAgaWYgKHNlbGVjdG9yKSB7CiAgICAgICAgICBpZiAoJChfcGFyZW50KS5pcyhzZWxlY3RvcikpIHBhcmVudHMucHVzaChfcGFyZW50KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcGFyZW50cy5wdXNoKF9wYXJlbnQpOwogICAgICAgIH0KCiAgICAgICAgX3BhcmVudCA9IF9wYXJlbnQucGFyZW50Tm9kZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiAkKHBhcmVudHMpOwogIH0KCiAgZnVuY3Rpb24gY2xvc2VzdChzZWxlY3RvcikgewogICAgdmFyIGNsb3Nlc3QgPSB0aGlzOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lCgogICAgaWYgKHR5cGVvZiBzZWxlY3RvciA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgcmV0dXJuICQoW10pOwogICAgfQoKICAgIGlmICghY2xvc2VzdC5pcyhzZWxlY3RvcikpIHsKICAgICAgY2xvc2VzdCA9IGNsb3Nlc3QucGFyZW50cyhzZWxlY3RvcikuZXEoMCk7CiAgICB9CgogICAgcmV0dXJuIGNsb3Nlc3Q7CiAgfQoKICBmdW5jdGlvbiBmaW5kKHNlbGVjdG9yKSB7CiAgICB2YXIgZm91bmRFbGVtZW50cyA9IFtdOwoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkgKz0gMSkgewogICAgICB2YXIgZm91bmQgPSB0aGlzW2ldLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpOwoKICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBmb3VuZC5sZW5ndGg7IGogKz0gMSkgewogICAgICAgIGZvdW5kRWxlbWVudHMucHVzaChmb3VuZFtqXSk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gJChmb3VuZEVsZW1lbnRzKTsKICB9CgogIGZ1bmN0aW9uIGNoaWxkcmVuKHNlbGVjdG9yKSB7CiAgICB2YXIgY2hpbGRyZW4gPSBbXTsgLy8gZXNsaW50LWRpc2FibGUtbGluZQoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkgKz0gMSkgewogICAgICB2YXIgY2hpbGROb2RlcyA9IHRoaXNbaV0uY2hpbGRyZW47CgogICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGNoaWxkTm9kZXMubGVuZ3RoOyBqICs9IDEpIHsKICAgICAgICBpZiAoIXNlbGVjdG9yIHx8ICQoY2hpbGROb2Rlc1tqXSkuaXMoc2VsZWN0b3IpKSB7CiAgICAgICAgICBjaGlsZHJlbi5wdXNoKGNoaWxkTm9kZXNbal0pOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHJldHVybiAkKGNoaWxkcmVuKTsKICB9CgogIGZ1bmN0aW9uIHJlbW92ZSgpIHsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkgKz0gMSkgewogICAgICBpZiAodGhpc1tpXS5wYXJlbnROb2RlKSB0aGlzW2ldLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpc1tpXSk7CiAgICB9CgogICAgcmV0dXJuIHRoaXM7CiAgfQoKICBmdW5jdGlvbiBkZXRhY2goKSB7CiAgICByZXR1cm4gdGhpcy5yZW1vdmUoKTsKICB9CgogIGZ1bmN0aW9uIGFkZCgpIHsKICAgIHZhciBkb20gPSB0aGlzOwogICAgdmFyIGk7CiAgICB2YXIgajsKCiAgICBmb3IgKHZhciBfbGVuMTAgPSBhcmd1bWVudHMubGVuZ3RoLCBlbHMgPSBuZXcgQXJyYXkoX2xlbjEwKSwgX2tleTEwID0gMDsgX2tleTEwIDwgX2xlbjEwOyBfa2V5MTArKykgewogICAgICBlbHNbX2tleTEwXSA9IGFyZ3VtZW50c1tfa2V5MTBdOwogICAgfQoKICAgIGZvciAoaSA9IDA7IGkgPCBlbHMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgdmFyIHRvQWRkID0gJChlbHNbaV0pOwoKICAgICAgZm9yIChqID0gMDsgaiA8IHRvQWRkLmxlbmd0aDsgaiArPSAxKSB7CiAgICAgICAgZG9tLnB1c2godG9BZGRbal0pOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGRvbTsKICB9CgogIGZ1bmN0aW9uIGVtcHR5KCkgewogICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgIHZhciBlbCA9IHRoaXNbaV07CgogICAgICBpZiAoZWwubm9kZVR5cGUgPT09IDEpIHsKICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGVsLmNoaWxkTm9kZXMubGVuZ3RoOyBqICs9IDEpIHsKICAgICAgICAgIGlmIChlbC5jaGlsZE5vZGVzW2pdLnBhcmVudE5vZGUpIHsKICAgICAgICAgICAgZWwuY2hpbGROb2Rlc1tqXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsLmNoaWxkTm9kZXNbal0pOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZWwudGV4dENvbnRlbnQgPSAnJzsKICAgICAgfQogICAgfQoKICAgIHJldHVybiB0aGlzOwogIH0KCiAgZnVuY3Rpb24gc2Nyb2xsVG8oKSB7CiAgICB2YXIgd2luZG93ID0gc3NyV2luZG93X3VtZC5nZXRXaW5kb3coKTsKCiAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsKICAgICAgYXJnc1tfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTsKICAgIH0KCiAgICB2YXIgbGVmdCA9IGFyZ3NbMF0sCiAgICAgICAgdG9wID0gYXJnc1sxXSwKICAgICAgICBkdXJhdGlvbiA9IGFyZ3NbMl0sCiAgICAgICAgZWFzaW5nID0gYXJnc1szXSwKICAgICAgICBjYWxsYmFjayA9IGFyZ3NbNF07CgogICAgaWYgKGFyZ3MubGVuZ3RoID09PSA0ICYmIHR5cGVvZiBlYXNpbmcgPT09ICdmdW5jdGlvbicpIHsKICAgICAgY2FsbGJhY2sgPSBlYXNpbmc7CiAgICAgIGxlZnQgPSBhcmdzWzBdOwogICAgICB0b3AgPSBhcmdzWzFdOwogICAgICBkdXJhdGlvbiA9IGFyZ3NbMl07CiAgICAgIGNhbGxiYWNrID0gYXJnc1szXTsKICAgICAgZWFzaW5nID0gYXJnc1s0XTsKICAgIH0KCiAgICBpZiAodHlwZW9mIGVhc2luZyA9PT0gJ3VuZGVmaW5lZCcpIGVhc2luZyA9ICdzd2luZyc7CiAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgIHZhciBlbCA9IHRoaXM7CiAgICAgIHZhciBjdXJyZW50VG9wOwogICAgICB2YXIgY3VycmVudExlZnQ7CiAgICAgIHZhciBtYXhUb3A7CiAgICAgIHZhciBtYXhMZWZ0OwogICAgICB2YXIgbmV3VG9wOwogICAgICB2YXIgbmV3TGVmdDsKICAgICAgdmFyIHNjcm9sbFRvcDsgLy8gZXNsaW50LWRpc2FibGUtbGluZQoKICAgICAgdmFyIHNjcm9sbExlZnQ7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUKCiAgICAgIHZhciBhbmltYXRlVG9wID0gdG9wID4gMCB8fCB0b3AgPT09IDA7CiAgICAgIHZhciBhbmltYXRlTGVmdCA9IGxlZnQgPiAwIHx8IGxlZnQgPT09IDA7CgogICAgICBpZiAodHlwZW9mIGVhc2luZyA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICBlYXNpbmcgPSAnc3dpbmcnOwogICAgICB9CgogICAgICBpZiAoYW5pbWF0ZVRvcCkgewogICAgICAgIGN1cnJlbnRUb3AgPSBlbC5zY3JvbGxUb3A7CgogICAgICAgIGlmICghZHVyYXRpb24pIHsKICAgICAgICAgIGVsLnNjcm9sbFRvcCA9IHRvcDsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChhbmltYXRlTGVmdCkgewogICAgICAgIGN1cnJlbnRMZWZ0ID0gZWwuc2Nyb2xsTGVmdDsKCiAgICAgICAgaWYgKCFkdXJhdGlvbikgewogICAgICAgICAgZWwuc2Nyb2xsTGVmdCA9IGxlZnQ7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoIWR1cmF0aW9uKSByZXR1cm47CgogICAgICBpZiAoYW5pbWF0ZVRvcCkgewogICAgICAgIG1heFRvcCA9IGVsLnNjcm9sbEhlaWdodCAtIGVsLm9mZnNldEhlaWdodDsKICAgICAgICBuZXdUb3AgPSBNYXRoLm1heChNYXRoLm1pbih0b3AsIG1heFRvcCksIDApOwogICAgICB9CgogICAgICBpZiAoYW5pbWF0ZUxlZnQpIHsKICAgICAgICBtYXhMZWZ0ID0gZWwuc2Nyb2xsV2lkdGggLSBlbC5vZmZzZXRXaWR0aDsKICAgICAgICBuZXdMZWZ0ID0gTWF0aC5tYXgoTWF0aC5taW4obGVmdCwgbWF4TGVmdCksIDApOwogICAgICB9CgogICAgICB2YXIgc3RhcnRUaW1lID0gbnVsbDsKICAgICAgaWYgKGFuaW1hdGVUb3AgJiYgbmV3VG9wID09PSBjdXJyZW50VG9wKSBhbmltYXRlVG9wID0gZmFsc2U7CiAgICAgIGlmIChhbmltYXRlTGVmdCAmJiBuZXdMZWZ0ID09PSBjdXJyZW50TGVmdCkgYW5pbWF0ZUxlZnQgPSBmYWxzZTsKCiAgICAgIGZ1bmN0aW9uIHJlbmRlcih0aW1lKSB7CiAgICAgICAgaWYgKHRpbWUgPT09IHZvaWQgMCkgewogICAgICAgICAgdGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHN0YXJ0VGltZSA9PT0gbnVsbCkgewogICAgICAgICAgc3RhcnRUaW1lID0gdGltZTsKICAgICAgICB9CgogICAgICAgIHZhciBwcm9ncmVzcyA9IE1hdGgubWF4KE1hdGgubWluKCh0aW1lIC0gc3RhcnRUaW1lKSAvIGR1cmF0aW9uLCAxKSwgMCk7CiAgICAgICAgdmFyIGVhc2VQcm9ncmVzcyA9IGVhc2luZyA9PT0gJ2xpbmVhcicgPyBwcm9ncmVzcyA6IDAuNSAtIE1hdGguY29zKHByb2dyZXNzICogTWF0aC5QSSkgLyAyOwogICAgICAgIHZhciBkb25lOwogICAgICAgIGlmIChhbmltYXRlVG9wKSBzY3JvbGxUb3AgPSBjdXJyZW50VG9wICsgZWFzZVByb2dyZXNzICogKG5ld1RvcCAtIGN1cnJlbnRUb3ApOwogICAgICAgIGlmIChhbmltYXRlTGVmdCkgc2Nyb2xsTGVmdCA9IGN1cnJlbnRMZWZ0ICsgZWFzZVByb2dyZXNzICogKG5ld0xlZnQgLSBjdXJyZW50TGVmdCk7CgogICAgICAgIGlmIChhbmltYXRlVG9wICYmIG5ld1RvcCA+IGN1cnJlbnRUb3AgJiYgc2Nyb2xsVG9wID49IG5ld1RvcCkgewogICAgICAgICAgZWwuc2Nyb2xsVG9wID0gbmV3VG9wOwogICAgICAgICAgZG9uZSA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBpZiAoYW5pbWF0ZVRvcCAmJiBuZXdUb3AgPCBjdXJyZW50VG9wICYmIHNjcm9sbFRvcCA8PSBuZXdUb3ApIHsKICAgICAgICAgIGVsLnNjcm9sbFRvcCA9IG5ld1RvcDsKICAgICAgICAgIGRvbmUgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKGFuaW1hdGVMZWZ0ICYmIG5ld0xlZnQgPiBjdXJyZW50TGVmdCAmJiBzY3JvbGxMZWZ0ID49IG5ld0xlZnQpIHsKICAgICAgICAgIGVsLnNjcm9sbExlZnQgPSBuZXdMZWZ0OwogICAgICAgICAgZG9uZSA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBpZiAoYW5pbWF0ZUxlZnQgJiYgbmV3TGVmdCA8IGN1cnJlbnRMZWZ0ICYmIHNjcm9sbExlZnQgPD0gbmV3TGVmdCkgewogICAgICAgICAgZWwuc2Nyb2xsTGVmdCA9IG5ld0xlZnQ7CiAgICAgICAgICBkb25lID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGlmIChkb25lKSB7CiAgICAgICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoYW5pbWF0ZVRvcCkgZWwuc2Nyb2xsVG9wID0gc2Nyb2xsVG9wOwogICAgICAgIGlmIChhbmltYXRlTGVmdCkgZWwuc2Nyb2xsTGVmdCA9IHNjcm9sbExlZnQ7CiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShyZW5kZXIpOwogICAgICB9CgogICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHJlbmRlcik7CiAgICB9KTsKICB9IC8vIHNjcm9sbFRvcCh0b3AsIGR1cmF0aW9uLCBlYXNpbmcsIGNhbGxiYWNrKSB7CgoKICBmdW5jdGlvbiBzY3JvbGxUb3AoKSB7CiAgICBmb3IgKHZhciBfbGVuMiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbjIpLCBfa2V5MiA9IDA7IF9rZXkyIDwgX2xlbjI7IF9rZXkyKyspIHsKICAgICAgYXJnc1tfa2V5Ml0gPSBhcmd1bWVudHNbX2tleTJdOwogICAgfQoKICAgIHZhciB0b3AgPSBhcmdzWzBdLAogICAgICAgIGR1cmF0aW9uID0gYXJnc1sxXSwKICAgICAgICBlYXNpbmcgPSBhcmdzWzJdLAogICAgICAgIGNhbGxiYWNrID0gYXJnc1szXTsKCiAgICBpZiAoYXJncy5sZW5ndGggPT09IDMgJiYgdHlwZW9mIGVhc2luZyA9PT0gJ2Z1bmN0aW9uJykgewogICAgICB0b3AgPSBhcmdzWzBdOwogICAgICBkdXJhdGlvbiA9IGFyZ3NbMV07CiAgICAgIGNhbGxiYWNrID0gYXJnc1syXTsKICAgICAgZWFzaW5nID0gYXJnc1szXTsKICAgIH0KCiAgICB2YXIgZG9tID0gdGhpczsKCiAgICBpZiAodHlwZW9mIHRvcCA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgaWYgKGRvbS5sZW5ndGggPiAwKSByZXR1cm4gZG9tWzBdLnNjcm9sbFRvcDsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcmV0dXJuIGRvbS5zY3JvbGxUbyh1bmRlZmluZWQsIHRvcCwgZHVyYXRpb24sIGVhc2luZywgY2FsbGJhY2spOwogIH0KCiAgZnVuY3Rpb24gc2Nyb2xsTGVmdCgpIHsKICAgIGZvciAodmFyIF9sZW4zID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuMyksIF9rZXkzID0gMDsgX2tleTMgPCBfbGVuMzsgX2tleTMrKykgewogICAgICBhcmdzW19rZXkzXSA9IGFyZ3VtZW50c1tfa2V5M107CiAgICB9CgogICAgdmFyIGxlZnQgPSBhcmdzWzBdLAogICAgICAgIGR1cmF0aW9uID0gYXJnc1sxXSwKICAgICAgICBlYXNpbmcgPSBhcmdzWzJdLAogICAgICAgIGNhbGxiYWNrID0gYXJnc1szXTsKCiAgICBpZiAoYXJncy5sZW5ndGggPT09IDMgJiYgdHlwZW9mIGVhc2luZyA9PT0gJ2Z1bmN0aW9uJykgewogICAgICBsZWZ0ID0gYXJnc1swXTsKICAgICAgZHVyYXRpb24gPSBhcmdzWzFdOwogICAgICBjYWxsYmFjayA9IGFyZ3NbMl07CiAgICAgIGVhc2luZyA9IGFyZ3NbM107CiAgICB9CgogICAgdmFyIGRvbSA9IHRoaXM7CgogICAgaWYgKHR5cGVvZiBsZWZ0ID09PSAndW5kZWZpbmVkJykgewogICAgICBpZiAoZG9tLmxlbmd0aCA+IDApIHJldHVybiBkb21bMF0uc2Nyb2xsTGVmdDsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgcmV0dXJuIGRvbS5zY3JvbGxUbyhsZWZ0LCB1bmRlZmluZWQsIGR1cmF0aW9uLCBlYXNpbmcsIGNhbGxiYWNrKTsKICB9CgogIGZ1bmN0aW9uIGFuaW1hdGUoaW5pdGlhbFByb3BzLCBpbml0aWFsUGFyYW1zKSB7CiAgICB2YXIgd2luZG93ID0gc3NyV2luZG93X3VtZC5nZXRXaW5kb3coKTsKICAgIHZhciBlbHMgPSB0aGlzOwogICAgdmFyIGEgPSB7CiAgICAgIHByb3BzOiBPYmplY3QuYXNzaWduKHt9LCBpbml0aWFsUHJvcHMpLAogICAgICBwYXJhbXM6IE9iamVjdC5hc3NpZ24oewogICAgICAgIGR1cmF0aW9uOiAzMDAsCiAgICAgICAgZWFzaW5nOiAnc3dpbmcnIC8vIG9yICdsaW5lYXInCgogICAgICAgIC8qIENhbGxiYWNrcwogICAgICAgIGJlZ2luKGVsZW1lbnRzKQogICAgICAgIGNvbXBsZXRlKGVsZW1lbnRzKQogICAgICAgIHByb2dyZXNzKGVsZW1lbnRzLCBjb21wbGV0ZSwgcmVtYWluaW5nLCBzdGFydCwgdHdlZW5WYWx1ZSkKICAgICAgICAqLwoKICAgICAgfSwgaW5pdGlhbFBhcmFtcyksCiAgICAgIGVsZW1lbnRzOiBlbHMsCiAgICAgIGFuaW1hdGluZzogZmFsc2UsCiAgICAgIHF1ZTogW10sCiAgICAgIGVhc2luZ1Byb2dyZXNzOiBmdW5jdGlvbiBlYXNpbmdQcm9ncmVzcyhlYXNpbmcsIHByb2dyZXNzKSB7CiAgICAgICAgaWYgKGVhc2luZyA9PT0gJ3N3aW5nJykgewogICAgICAgICAgcmV0dXJuIDAuNSAtIE1hdGguY29zKHByb2dyZXNzICogTWF0aC5QSSkgLyAyOwogICAgICAgIH0KCiAgICAgICAgaWYgKHR5cGVvZiBlYXNpbmcgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgIHJldHVybiBlYXNpbmcocHJvZ3Jlc3MpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHByb2dyZXNzOwogICAgICB9LAogICAgICBzdG9wOiBmdW5jdGlvbiBzdG9wKCkgewogICAgICAgIGlmIChhLmZyYW1lSWQpIHsKICAgICAgICAgIHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZShhLmZyYW1lSWQpOwogICAgICAgIH0KCiAgICAgICAgYS5hbmltYXRpbmcgPSBmYWxzZTsKICAgICAgICBhLmVsZW1lbnRzLmVhY2goZnVuY3Rpb24gKGVsKSB7CiAgICAgICAgICB2YXIgZWxlbWVudCA9IGVsOwogICAgICAgICAgZGVsZXRlIGVsZW1lbnQuZG9tN0FuaW1hdGVJbnN0YW5jZTsKICAgICAgICB9KTsKICAgICAgICBhLnF1ZSA9IFtdOwogICAgICB9LAogICAgICBkb25lOiBmdW5jdGlvbiBkb25lKGNvbXBsZXRlKSB7CiAgICAgICAgYS5hbmltYXRpbmcgPSBmYWxzZTsKICAgICAgICBhLmVsZW1lbnRzLmVhY2goZnVuY3Rpb24gKGVsKSB7CiAgICAgICAgICB2YXIgZWxlbWVudCA9IGVsOwogICAgICAgICAgZGVsZXRlIGVsZW1lbnQuZG9tN0FuaW1hdGVJbnN0YW5jZTsKICAgICAgICB9KTsKICAgICAgICBpZiAoY29tcGxldGUpIGNvbXBsZXRlKGVscyk7CgogICAgICAgIGlmIChhLnF1ZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICB2YXIgcXVlID0gYS5xdWUuc2hpZnQoKTsKICAgICAgICAgIGEuYW5pbWF0ZShxdWVbMF0sIHF1ZVsxXSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBhbmltYXRlOiBmdW5jdGlvbiBhbmltYXRlKHByb3BzLCBwYXJhbXMpIHsKICAgICAgICBpZiAoYS5hbmltYXRpbmcpIHsKICAgICAgICAgIGEucXVlLnB1c2goW3Byb3BzLCBwYXJhbXNdKTsKICAgICAgICAgIHJldHVybiBhOwogICAgICAgIH0KCiAgICAgICAgdmFyIGVsZW1lbnRzID0gW107IC8vIERlZmluZSAmIENhY2hlIEluaXRpYWxzICYgVW5pdHMKCiAgICAgICAgYS5lbGVtZW50cy5lYWNoKGZ1bmN0aW9uIChlbCwgaW5kZXgpIHsKICAgICAgICAgIHZhciBpbml0aWFsRnVsbFZhbHVlOwogICAgICAgICAgdmFyIGluaXRpYWxWYWx1ZTsKICAgICAgICAgIHZhciB1bml0OwogICAgICAgICAgdmFyIGZpbmFsVmFsdWU7CiAgICAgICAgICB2YXIgZmluYWxGdWxsVmFsdWU7CiAgICAgICAgICBpZiAoIWVsLmRvbTdBbmltYXRlSW5zdGFuY2UpIGEuZWxlbWVudHNbaW5kZXhdLmRvbTdBbmltYXRlSW5zdGFuY2UgPSBhOwogICAgICAgICAgZWxlbWVudHNbaW5kZXhdID0gewogICAgICAgICAgICBjb250YWluZXI6IGVsCiAgICAgICAgICB9OwogICAgICAgICAgT2JqZWN0LmtleXMocHJvcHMpLmZvckVhY2goZnVuY3Rpb24gKHByb3ApIHsKICAgICAgICAgICAgaW5pdGlhbEZ1bGxWYWx1ZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsLCBudWxsKS5nZXRQcm9wZXJ0eVZhbHVlKHByb3ApLnJlcGxhY2UoJywnLCAnLicpOwogICAgICAgICAgICBpbml0aWFsVmFsdWUgPSBwYXJzZUZsb2F0KGluaXRpYWxGdWxsVmFsdWUpOwogICAgICAgICAgICB1bml0ID0gaW5pdGlhbEZ1bGxWYWx1ZS5yZXBsYWNlKGluaXRpYWxWYWx1ZSwgJycpOwogICAgICAgICAgICBmaW5hbFZhbHVlID0gcGFyc2VGbG9hdChwcm9wc1twcm9wXSk7CiAgICAgICAgICAgIGZpbmFsRnVsbFZhbHVlID0gcHJvcHNbcHJvcF0gKyB1bml0OwogICAgICAgICAgICBlbGVtZW50c1tpbmRleF1bcHJvcF0gPSB7CiAgICAgICAgICAgICAgaW5pdGlhbEZ1bGxWYWx1ZTogaW5pdGlhbEZ1bGxWYWx1ZSwKICAgICAgICAgICAgICBpbml0aWFsVmFsdWU6IGluaXRpYWxWYWx1ZSwKICAgICAgICAgICAgICB1bml0OiB1bml0LAogICAgICAgICAgICAgIGZpbmFsVmFsdWU6IGZpbmFsVmFsdWUsCiAgICAgICAgICAgICAgZmluYWxGdWxsVmFsdWU6IGZpbmFsRnVsbFZhbHVlLAogICAgICAgICAgICAgIGN1cnJlbnRWYWx1ZTogaW5pdGlhbFZhbHVlCiAgICAgICAgICAgIH07CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICB2YXIgc3RhcnRUaW1lID0gbnVsbDsKICAgICAgICB2YXIgdGltZTsKICAgICAgICB2YXIgZWxlbWVudHNEb25lID0gMDsKICAgICAgICB2YXIgcHJvcHNEb25lID0gMDsKICAgICAgICB2YXIgZG9uZTsKICAgICAgICB2YXIgYmVnYW4gPSBmYWxzZTsKICAgICAgICBhLmFuaW1hdGluZyA9IHRydWU7CgogICAgICAgIGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgICAgIHRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgICAgICAgIHZhciBwcm9ncmVzczsKICAgICAgICAgIHZhciBlYXNlUHJvZ3Jlc3M7IC8vIGxldCBlbDsKCiAgICAgICAgICBpZiAoIWJlZ2FuKSB7CiAgICAgICAgICAgIGJlZ2FuID0gdHJ1ZTsKICAgICAgICAgICAgaWYgKHBhcmFtcy5iZWdpbikgcGFyYW1zLmJlZ2luKGVscyk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHN0YXJ0VGltZSA9PT0gbnVsbCkgewogICAgICAgICAgICBzdGFydFRpbWUgPSB0aW1lOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChwYXJhbXMucHJvZ3Jlc3MpIHsKICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lCiAgICAgICAgICAgIHBhcmFtcy5wcm9ncmVzcyhlbHMsIE1hdGgubWF4KE1hdGgubWluKCh0aW1lIC0gc3RhcnRUaW1lKSAvIHBhcmFtcy5kdXJhdGlvbiwgMSksIDApLCBzdGFydFRpbWUgKyBwYXJhbXMuZHVyYXRpb24gLSB0aW1lIDwgMCA/IDAgOiBzdGFydFRpbWUgKyBwYXJhbXMuZHVyYXRpb24gLSB0aW1lLCBzdGFydFRpbWUpOwogICAgICAgICAgfQoKICAgICAgICAgIGVsZW1lbnRzLmZvckVhY2goZnVuY3Rpb24gKGVsZW1lbnQpIHsKICAgICAgICAgICAgdmFyIGVsID0gZWxlbWVudDsKICAgICAgICAgICAgaWYgKGRvbmUgfHwgZWwuZG9uZSkgcmV0dXJuOwogICAgICAgICAgICBPYmplY3Qua2V5cyhwcm9wcykuZm9yRWFjaChmdW5jdGlvbiAocHJvcCkgewogICAgICAgICAgICAgIGlmIChkb25lIHx8IGVsLmRvbmUpIHJldHVybjsKICAgICAgICAgICAgICBwcm9ncmVzcyA9IE1hdGgubWF4KE1hdGgubWluKCh0aW1lIC0gc3RhcnRUaW1lKSAvIHBhcmFtcy5kdXJhdGlvbiwgMSksIDApOwogICAgICAgICAgICAgIGVhc2VQcm9ncmVzcyA9IGEuZWFzaW5nUHJvZ3Jlc3MocGFyYW1zLmVhc2luZywgcHJvZ3Jlc3MpOwogICAgICAgICAgICAgIHZhciBfZWwkcHJvcCA9IGVsW3Byb3BdLAogICAgICAgICAgICAgICAgICBpbml0aWFsVmFsdWUgPSBfZWwkcHJvcC5pbml0aWFsVmFsdWUsCiAgICAgICAgICAgICAgICAgIGZpbmFsVmFsdWUgPSBfZWwkcHJvcC5maW5hbFZhbHVlLAogICAgICAgICAgICAgICAgICB1bml0ID0gX2VsJHByb3AudW5pdDsKICAgICAgICAgICAgICBlbFtwcm9wXS5jdXJyZW50VmFsdWUgPSBpbml0aWFsVmFsdWUgKyBlYXNlUHJvZ3Jlc3MgKiAoZmluYWxWYWx1ZSAtIGluaXRpYWxWYWx1ZSk7CiAgICAgICAgICAgICAgdmFyIGN1cnJlbnRWYWx1ZSA9IGVsW3Byb3BdLmN1cnJlbnRWYWx1ZTsKCiAgICAgICAgICAgICAgaWYgKGZpbmFsVmFsdWUgPiBpbml0aWFsVmFsdWUgJiYgY3VycmVudFZhbHVlID49IGZpbmFsVmFsdWUgfHwgZmluYWxWYWx1ZSA8IGluaXRpYWxWYWx1ZSAmJiBjdXJyZW50VmFsdWUgPD0gZmluYWxWYWx1ZSkgewogICAgICAgICAgICAgICAgZWwuY29udGFpbmVyLnN0eWxlW3Byb3BdID0gZmluYWxWYWx1ZSArIHVuaXQ7CiAgICAgICAgICAgICAgICBwcm9wc0RvbmUgKz0gMTsKCiAgICAgICAgICAgICAgICBpZiAocHJvcHNEb25lID09PSBPYmplY3Qua2V5cyhwcm9wcykubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgIGVsLmRvbmUgPSB0cnVlOwogICAgICAgICAgICAgICAgICBlbGVtZW50c0RvbmUgKz0gMTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudHNEb25lID09PSBlbGVtZW50cy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgZG9uZSA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoZG9uZSkgewogICAgICAgICAgICAgICAgYS5kb25lKHBhcmFtcy5jb21wbGV0ZSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBlbC5jb250YWluZXIuc3R5bGVbcHJvcF0gPSBjdXJyZW50VmFsdWUgKyB1bml0OwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKGRvbmUpIHJldHVybjsgLy8gVGhlbiBjYWxsCgogICAgICAgICAgYS5mcmFtZUlkID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShyZW5kZXIpOwogICAgICAgIH0KCiAgICAgICAgYS5mcmFtZUlkID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShyZW5kZXIpOwogICAgICAgIHJldHVybiBhOwogICAgICB9CiAgICB9OwoKICAgIGlmIChhLmVsZW1lbnRzLmxlbmd0aCA9PT0gMCkgewogICAgICByZXR1cm4gZWxzOwogICAgfQoKICAgIHZhciBhbmltYXRlSW5zdGFuY2U7CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhLmVsZW1lbnRzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgIGlmIChhLmVsZW1lbnRzW2ldLmRvbTdBbmltYXRlSW5zdGFuY2UpIHsKICAgICAgICBhbmltYXRlSW5zdGFuY2UgPSBhLmVsZW1lbnRzW2ldLmRvbTdBbmltYXRlSW5zdGFuY2U7CiAgICAgIH0gZWxzZSBhLmVsZW1lbnRzW2ldLmRvbTdBbmltYXRlSW5zdGFuY2UgPSBhOwogICAgfQoKICAgIGlmICghYW5pbWF0ZUluc3RhbmNlKSB7CiAgICAgIGFuaW1hdGVJbnN0YW5jZSA9IGE7CiAgICB9CgogICAgaWYgKGluaXRpYWxQcm9wcyA9PT0gJ3N0b3AnKSB7CiAgICAgIGFuaW1hdGVJbnN0YW5jZS5zdG9wKCk7CiAgICB9IGVsc2UgewogICAgICBhbmltYXRlSW5zdGFuY2UuYW5pbWF0ZShhLnByb3BzLCBhLnBhcmFtcyk7CiAgICB9CgogICAgcmV0dXJuIGVsczsKICB9CgogIGZ1bmN0aW9uIHN0b3AoKSB7CiAgICB2YXIgZWxzID0gdGhpczsKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVscy5sZW5ndGg7IGkgKz0gMSkgewogICAgICBpZiAoZWxzW2ldLmRvbTdBbmltYXRlSW5zdGFuY2UpIHsKICAgICAgICBlbHNbaV0uZG9tN0FuaW1hdGVJbnN0YW5jZS5zdG9wKCk7CiAgICAgIH0KICAgIH0KICB9CgogIHZhciBub1RyaWdnZXIgPSAncmVzaXplIHNjcm9sbCcuc3BsaXQoJyAnKTsKCiAgZnVuY3Rpb24gc2hvcnRjdXQobmFtZSkgewogICAgZnVuY3Rpb24gZXZlbnRIYW5kbGVyKCkgewogICAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsKICAgICAgICBhcmdzW19rZXldID0gYXJndW1lbnRzW19rZXldOwogICAgICB9CgogICAgICBpZiAodHlwZW9mIGFyZ3NbMF0gPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICBpZiAobm9UcmlnZ2VyLmluZGV4T2YobmFtZSkgPCAwKSB7CiAgICAgICAgICAgIGlmIChuYW1lIGluIHRoaXNbaV0pIHRoaXNbaV1bbmFtZV0oKTtlbHNlIHsKICAgICAgICAgICAgICAkKHRoaXNbaV0pLnRyaWdnZXIobmFtZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5vbi5hcHBseSh0aGlzLCBbbmFtZV0uY29uY2F0KGFyZ3MpKTsKICAgIH0KCiAgICByZXR1cm4gZXZlbnRIYW5kbGVyOwogIH0KCiAgdmFyIGNsaWNrID0gc2hvcnRjdXQoJ2NsaWNrJyk7CiAgdmFyIGJsdXIgPSBzaG9ydGN1dCgnYmx1cicpOwogIHZhciBmb2N1cyA9IHNob3J0Y3V0KCdmb2N1cycpOwogIHZhciBmb2N1c2luID0gc2hvcnRjdXQoJ2ZvY3VzaW4nKTsKICB2YXIgZm9jdXNvdXQgPSBzaG9ydGN1dCgnZm9jdXNvdXQnKTsKICB2YXIga2V5dXAgPSBzaG9ydGN1dCgna2V5dXAnKTsKICB2YXIga2V5ZG93biA9IHNob3J0Y3V0KCdrZXlkb3duJyk7CiAgdmFyIGtleXByZXNzID0gc2hvcnRjdXQoJ2tleXByZXNzJyk7CiAgdmFyIHN1Ym1pdCA9IHNob3J0Y3V0KCdzdWJtaXQnKTsKICB2YXIgY2hhbmdlID0gc2hvcnRjdXQoJ2NoYW5nZScpOwogIHZhciBtb3VzZWRvd24gPSBzaG9ydGN1dCgnbW91c2Vkb3duJyk7CiAgdmFyIG1vdXNlbW92ZSA9IHNob3J0Y3V0KCdtb3VzZW1vdmUnKTsKICB2YXIgbW91c2V1cCA9IHNob3J0Y3V0KCdtb3VzZXVwJyk7CiAgdmFyIG1vdXNlZW50ZXIgPSBzaG9ydGN1dCgnbW91c2VlbnRlcicpOwogIHZhciBtb3VzZWxlYXZlID0gc2hvcnRjdXQoJ21vdXNlbGVhdmUnKTsKICB2YXIgbW91c2VvdXQgPSBzaG9ydGN1dCgnbW91c2VvdXQnKTsKICB2YXIgbW91c2VvdmVyID0gc2hvcnRjdXQoJ21vdXNlb3ZlcicpOwogIHZhciB0b3VjaHN0YXJ0ID0gc2hvcnRjdXQoJ3RvdWNoc3RhcnQnKTsKICB2YXIgdG91Y2hlbmQgPSBzaG9ydGN1dCgndG91Y2hlbmQnKTsKICB2YXIgdG91Y2htb3ZlID0gc2hvcnRjdXQoJ3RvdWNobW92ZScpOwogIHZhciByZXNpemUgPSBzaG9ydGN1dCgncmVzaXplJyk7CiAgdmFyIHNjcm9sbCA9IHNob3J0Y3V0KCdzY3JvbGwnKTsKCiAgdmFyICRfMSA9ICQ7CiAgdmFyIGFkZF8xID0gYWRkOwogIHZhciBhZGRDbGFzc18xID0gYWRkQ2xhc3M7CiAgdmFyIGFuaW1hdGVfMSA9IGFuaW1hdGU7CiAgdmFyIGFuaW1hdGlvbkVuZF8xID0gYW5pbWF0aW9uRW5kOwogIHZhciBhcHBlbmRfMSA9IGFwcGVuZDsKICB2YXIgYXBwZW5kVG9fMSA9IGFwcGVuZFRvOwogIHZhciBhdHRyXzEgPSBhdHRyOwogIHZhciBibHVyXzEgPSBibHVyOwogIHZhciBjaGFuZ2VfMSA9IGNoYW5nZTsKICB2YXIgY2hpbGRyZW5fMSA9IGNoaWxkcmVuOwogIHZhciBjbGlja18xID0gY2xpY2s7CiAgdmFyIGNsb3Nlc3RfMSA9IGNsb3Nlc3Q7CiAgdmFyIGNzc18xID0gY3NzOwogIHZhciBkYXRhXzEgPSBkYXRhOwogIHZhciBkYXRhc2V0XzEgPSBkYXRhc2V0OwogIHZhciBfZGVmYXVsdCQxID0gJDsKICB2YXIgZGV0YWNoXzEgPSBkZXRhY2g7CiAgdmFyIGVhY2hfMSA9IGVhY2g7CiAgdmFyIGVtcHR5XzEgPSBlbXB0eTsKICB2YXIgZXFfMSA9IGVxOwogIHZhciBmaWx0ZXJfMSA9IGZpbHRlcjsKICB2YXIgZmluZF8xID0gZmluZDsKICB2YXIgZm9jdXNfMSA9IGZvY3VzOwogIHZhciBmb2N1c2luXzEgPSBmb2N1c2luOwogIHZhciBmb2N1c291dF8xID0gZm9jdXNvdXQ7CiAgdmFyIGhhc0NsYXNzXzEgPSBoYXNDbGFzczsKICB2YXIgaGVpZ2h0XzEgPSBoZWlnaHQ7CiAgdmFyIGhpZGVfMSA9IGhpZGU7CiAgdmFyIGh0bWxfMSA9IGh0bWw7CiAgdmFyIGluZGV4XzEgPSBpbmRleCQxOwogIHZhciBpbnNlcnRBZnRlcl8xID0gaW5zZXJ0QWZ0ZXI7CiAgdmFyIGluc2VydEJlZm9yZV8xID0gaW5zZXJ0QmVmb3JlOwogIHZhciBpc18xID0gaXM7CiAgdmFyIGtleWRvd25fMSA9IGtleWRvd247CiAgdmFyIGtleXByZXNzXzEgPSBrZXlwcmVzczsKICB2YXIga2V5dXBfMSA9IGtleXVwOwogIHZhciBtb3VzZWRvd25fMSA9IG1vdXNlZG93bjsKICB2YXIgbW91c2VlbnRlcl8xID0gbW91c2VlbnRlcjsKICB2YXIgbW91c2VsZWF2ZV8xID0gbW91c2VsZWF2ZTsKICB2YXIgbW91c2Vtb3ZlXzEgPSBtb3VzZW1vdmU7CiAgdmFyIG1vdXNlb3V0XzEgPSBtb3VzZW91dDsKICB2YXIgbW91c2VvdmVyXzEgPSBtb3VzZW92ZXI7CiAgdmFyIG1vdXNldXBfMSA9IG1vdXNldXA7CiAgdmFyIG5leHRfMSA9IG5leHQ7CiAgdmFyIG5leHRBbGxfMSA9IG5leHRBbGw7CiAgdmFyIG9mZl8xID0gb2ZmOwogIHZhciBvZmZzZXRfMSA9IG9mZnNldDsKICB2YXIgb25fMSA9IG9uOwogIHZhciBvbmNlXzEgPSBvbmNlOwogIHZhciBvdXRlckhlaWdodF8xID0gb3V0ZXJIZWlnaHQ7CiAgdmFyIG91dGVyV2lkdGhfMSA9IG91dGVyV2lkdGg7CiAgdmFyIHBhcmVudF8xID0gcGFyZW50OwogIHZhciBwYXJlbnRzXzEgPSBwYXJlbnRzOwogIHZhciBwcmVwZW5kXzEgPSBwcmVwZW5kOwogIHZhciBwcmVwZW5kVG9fMSA9IHByZXBlbmRUbzsKICB2YXIgcHJldl8xID0gcHJldjsKICB2YXIgcHJldkFsbF8xID0gcHJldkFsbDsKICB2YXIgcHJvcF8xID0gcHJvcDsKICB2YXIgcmVtb3ZlXzEgPSByZW1vdmU7CiAgdmFyIHJlbW92ZUF0dHJfMSA9IHJlbW92ZUF0dHI7CiAgdmFyIHJlbW92ZUNsYXNzXzEgPSByZW1vdmVDbGFzczsKICB2YXIgcmVtb3ZlRGF0YV8xID0gcmVtb3ZlRGF0YTsKICB2YXIgcmVzaXplXzEgPSByZXNpemU7CiAgdmFyIHNjcm9sbF8xID0gc2Nyb2xsOwogIHZhciBzY3JvbGxMZWZ0XzEgPSBzY3JvbGxMZWZ0OwogIHZhciBzY3JvbGxUb18xID0gc2Nyb2xsVG87CiAgdmFyIHNjcm9sbFRvcF8xID0gc2Nyb2xsVG9wOwogIHZhciBzaG93XzEgPSBzaG93OwogIHZhciBzaWJsaW5nc18xID0gc2libGluZ3M7CiAgdmFyIHN0b3BfMSA9IHN0b3A7CiAgdmFyIHN0eWxlc18xID0gc3R5bGVzOwogIHZhciBzdWJtaXRfMSA9IHN1Ym1pdDsKICB2YXIgdGV4dF8xID0gdGV4dDsKICB2YXIgdG9nZ2xlQ2xhc3NfMSA9IHRvZ2dsZUNsYXNzOwogIHZhciB0b3VjaGVuZF8xID0gdG91Y2hlbmQ7CiAgdmFyIHRvdWNobW92ZV8xID0gdG91Y2htb3ZlOwogIHZhciB0b3VjaHN0YXJ0XzEgPSB0b3VjaHN0YXJ0OwogIHZhciB0cmFuc2Zvcm1fMSA9IHRyYW5zZm9ybTsKICB2YXIgdHJhbnNpdGlvbl8xID0gdHJhbnNpdGlvbjsKICB2YXIgdHJhbnNpdGlvbkVuZF8xID0gdHJhbnNpdGlvbkVuZDsKICB2YXIgdHJpZ2dlcl8xID0gdHJpZ2dlcjsKICB2YXIgdmFsXzEgPSB2YWw7CiAgdmFyIHZhbHVlXzEgPSB2YWx1ZTsKICB2YXIgd2lkdGhfMSA9IHdpZHRoOwoKICB2YXIgZG9tN19janMgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAJJDogJF8xLAogIAlhZGQ6IGFkZF8xLAogIAlhZGRDbGFzczogYWRkQ2xhc3NfMSwKICAJYW5pbWF0ZTogYW5pbWF0ZV8xLAogIAlhbmltYXRpb25FbmQ6IGFuaW1hdGlvbkVuZF8xLAogIAlhcHBlbmQ6IGFwcGVuZF8xLAogIAlhcHBlbmRUbzogYXBwZW5kVG9fMSwKICAJYXR0cjogYXR0cl8xLAogIAlibHVyOiBibHVyXzEsCiAgCWNoYW5nZTogY2hhbmdlXzEsCiAgCWNoaWxkcmVuOiBjaGlsZHJlbl8xLAogIAljbGljazogY2xpY2tfMSwKICAJY2xvc2VzdDogY2xvc2VzdF8xLAogIAljc3M6IGNzc18xLAogIAlkYXRhOiBkYXRhXzEsCiAgCWRhdGFzZXQ6IGRhdGFzZXRfMSwKICAJZGVmYXVsdDogX2RlZmF1bHQkMSwKICAJZGV0YWNoOiBkZXRhY2hfMSwKICAJZWFjaDogZWFjaF8xLAogIAllbXB0eTogZW1wdHlfMSwKICAJZXE6IGVxXzEsCiAgCWZpbHRlcjogZmlsdGVyXzEsCiAgCWZpbmQ6IGZpbmRfMSwKICAJZm9jdXM6IGZvY3VzXzEsCiAgCWZvY3VzaW46IGZvY3VzaW5fMSwKICAJZm9jdXNvdXQ6IGZvY3Vzb3V0XzEsCiAgCWhhc0NsYXNzOiBoYXNDbGFzc18xLAogIAloZWlnaHQ6IGhlaWdodF8xLAogIAloaWRlOiBoaWRlXzEsCiAgCWh0bWw6IGh0bWxfMSwKICAJaW5kZXg6IGluZGV4XzEsCiAgCWluc2VydEFmdGVyOiBpbnNlcnRBZnRlcl8xLAogIAlpbnNlcnRCZWZvcmU6IGluc2VydEJlZm9yZV8xLAogIAlpczogaXNfMSwKICAJa2V5ZG93bjoga2V5ZG93bl8xLAogIAlrZXlwcmVzczoga2V5cHJlc3NfMSwKICAJa2V5dXA6IGtleXVwXzEsCiAgCW1vdXNlZG93bjogbW91c2Vkb3duXzEsCiAgCW1vdXNlZW50ZXI6IG1vdXNlZW50ZXJfMSwKICAJbW91c2VsZWF2ZTogbW91c2VsZWF2ZV8xLAogIAltb3VzZW1vdmU6IG1vdXNlbW92ZV8xLAogIAltb3VzZW91dDogbW91c2VvdXRfMSwKICAJbW91c2VvdmVyOiBtb3VzZW92ZXJfMSwKICAJbW91c2V1cDogbW91c2V1cF8xLAogIAluZXh0OiBuZXh0XzEsCiAgCW5leHRBbGw6IG5leHRBbGxfMSwKICAJb2ZmOiBvZmZfMSwKICAJb2Zmc2V0OiBvZmZzZXRfMSwKICAJb246IG9uXzEsCiAgCW9uY2U6IG9uY2VfMSwKICAJb3V0ZXJIZWlnaHQ6IG91dGVySGVpZ2h0XzEsCiAgCW91dGVyV2lkdGg6IG91dGVyV2lkdGhfMSwKICAJcGFyZW50OiBwYXJlbnRfMSwKICAJcGFyZW50czogcGFyZW50c18xLAogIAlwcmVwZW5kOiBwcmVwZW5kXzEsCiAgCXByZXBlbmRUbzogcHJlcGVuZFRvXzEsCiAgCXByZXY6IHByZXZfMSwKICAJcHJldkFsbDogcHJldkFsbF8xLAogIAlwcm9wOiBwcm9wXzEsCiAgCXJlbW92ZTogcmVtb3ZlXzEsCiAgCXJlbW92ZUF0dHI6IHJlbW92ZUF0dHJfMSwKICAJcmVtb3ZlQ2xhc3M6IHJlbW92ZUNsYXNzXzEsCiAgCXJlbW92ZURhdGE6IHJlbW92ZURhdGFfMSwKICAJcmVzaXplOiByZXNpemVfMSwKICAJc2Nyb2xsOiBzY3JvbGxfMSwKICAJc2Nyb2xsTGVmdDogc2Nyb2xsTGVmdF8xLAogIAlzY3JvbGxUbzogc2Nyb2xsVG9fMSwKICAJc2Nyb2xsVG9wOiBzY3JvbGxUb3BfMSwKICAJc2hvdzogc2hvd18xLAogIAlzaWJsaW5nczogc2libGluZ3NfMSwKICAJc3RvcDogc3RvcF8xLAogIAlzdHlsZXM6IHN0eWxlc18xLAogIAlzdWJtaXQ6IHN1Ym1pdF8xLAogIAl0ZXh0OiB0ZXh0XzEsCiAgCXRvZ2dsZUNsYXNzOiB0b2dnbGVDbGFzc18xLAogIAl0b3VjaGVuZDogdG91Y2hlbmRfMSwKICAJdG91Y2htb3ZlOiB0b3VjaG1vdmVfMSwKICAJdG91Y2hzdGFydDogdG91Y2hzdGFydF8xLAogIAl0cmFuc2Zvcm06IHRyYW5zZm9ybV8xLAogIAl0cmFuc2l0aW9uOiB0cmFuc2l0aW9uXzEsCiAgCXRyYW5zaXRpb25FbmQ6IHRyYW5zaXRpb25FbmRfMSwKICAJdHJpZ2dlcjogdHJpZ2dlcl8xLAogIAl2YWw6IHZhbF8xLAogIAl2YWx1ZTogdmFsdWVfMSwKICAJd2lkdGg6IHdpZHRoXzEKICB9LCAnX19lc01vZHVsZScsIHt2YWx1ZTogdHJ1ZX0pOwoKICAvKioKICAgKiBsb2Rhc2ggKEN1c3RvbSBCdWlsZCkgPGh0dHBzOi8vbG9kYXNoLmNvbS8+CiAgICogQnVpbGQ6IGBsb2Rhc2ggbW9kdWxhcml6ZSBleHBvcnRzPSJucG0iIC1vIC4vYAogICAqIENvcHlyaWdodCBqUXVlcnkgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzIDxodHRwczovL2pxdWVyeS5vcmcvPgogICAqIFJlbGVhc2VkIHVuZGVyIE1JVCBsaWNlbnNlIDxodHRwczovL2xvZGFzaC5jb20vbGljZW5zZT4KICAgKiBCYXNlZCBvbiBVbmRlcnNjb3JlLmpzIDEuOC4zIDxodHRwOi8vdW5kZXJzY29yZWpzLm9yZy9MSUNFTlNFPgogICAqIENvcHlyaWdodCBKZXJlbXkgQXNoa2VuYXMsIERvY3VtZW50Q2xvdWQgYW5kIEludmVzdGlnYXRpdmUgUmVwb3J0ZXJzICYgRWRpdG9ycwogICAqLwogIC8qKiBVc2VkIGFzIHJlZmVyZW5jZXMgZm9yIHZhcmlvdXMgYE51bWJlcmAgY29uc3RhbnRzLiAqLwogIHZhciBNQVhfU0FGRV9JTlRFR0VSID0gOTAwNzE5OTI1NDc0MDk5MTsKCiAgLyoqIGBPYmplY3QjdG9TdHJpbmdgIHJlc3VsdCByZWZlcmVuY2VzLiAqLwogIHZhciBhcmdzVGFnID0gJ1tvYmplY3QgQXJndW1lbnRzXScsCiAgICAgIGZ1bmNUYWcgPSAnW29iamVjdCBGdW5jdGlvbl0nLAogICAgICBnZW5UYWcgPSAnW29iamVjdCBHZW5lcmF0b3JGdW5jdGlvbl0nOwoKICAvKiogVXNlZCB0byBkZXRlY3QgdW5zaWduZWQgaW50ZWdlciB2YWx1ZXMuICovCiAgdmFyIHJlSXNVaW50ID0gL14oPzowfFsxLTldXGQqKSQvOwoKICAvKioKICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYF8uZm9yRWFjaGAgZm9yIGFycmF5cyB3aXRob3V0IHN1cHBvcnQgZm9yCiAgICogaXRlcmF0ZWUgc2hvcnRoYW5kcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gW2FycmF5XSBUaGUgYXJyYXkgdG8gaXRlcmF0ZSBvdmVyLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGl0ZXJhdGVlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGBhcnJheWAuCiAgICovCiAgZnVuY3Rpb24gYXJyYXlFYWNoKGFycmF5LCBpdGVyYXRlZSkgewogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgbGVuZ3RoID0gYXJyYXkgPyBhcnJheS5sZW5ndGggOiAwOwoKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIGlmIChpdGVyYXRlZShhcnJheVtpbmRleF0sIGluZGV4LCBhcnJheSkgPT09IGZhbHNlKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBhcnJheTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnRpbWVzYCB3aXRob3V0IHN1cHBvcnQgZm9yIGl0ZXJhdGVlIHNob3J0aGFuZHMKICAgKiBvciBtYXggYXJyYXkgbGVuZ3RoIGNoZWNrcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtudW1iZXJ9IG4gVGhlIG51bWJlciBvZiB0aW1lcyB0byBpbnZva2UgYGl0ZXJhdGVlYC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2YgcmVzdWx0cy4KICAgKi8KICBmdW5jdGlvbiBiYXNlVGltZXMobiwgaXRlcmF0ZWUpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIHJlc3VsdCA9IEFycmF5KG4pOwoKICAgIHdoaWxlICgrK2luZGV4IDwgbikgewogICAgICByZXN1bHRbaW5kZXhdID0gaXRlcmF0ZWUoaW5kZXgpOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIENyZWF0ZXMgYSB1bmFyeSBmdW5jdGlvbiB0aGF0IGludm9rZXMgYGZ1bmNgIHdpdGggaXRzIGFyZ3VtZW50IHRyYW5zZm9ybWVkLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byB3cmFwLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IHRyYW5zZm9ybSBUaGUgYXJndW1lbnQgdHJhbnNmb3JtLgogICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGZ1bmN0aW9uLgogICAqLwogIGZ1bmN0aW9uIG92ZXJBcmcoZnVuYywgdHJhbnNmb3JtKSB7CiAgICByZXR1cm4gZnVuY3Rpb24oYXJnKSB7CiAgICAgIHJldHVybiBmdW5jKHRyYW5zZm9ybShhcmcpKTsKICAgIH07CiAgfQoKICAvKiogVXNlZCBmb3IgYnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMuICovCiAgdmFyIG9iamVjdFByb3RvJDMgPSBPYmplY3QucHJvdG90eXBlOwoKICAvKiogVXNlZCB0byBjaGVjayBvYmplY3RzIGZvciBvd24gcHJvcGVydGllcy4gKi8KICB2YXIgaGFzT3duUHJvcGVydHkkMSA9IG9iamVjdFByb3RvJDMuaGFzT3duUHJvcGVydHk7CgogIC8qKgogICAqIFVzZWQgdG8gcmVzb2x2ZSB0aGUKICAgKiBbYHRvU3RyaW5nVGFnYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtb2JqZWN0LnByb3RvdHlwZS50b3N0cmluZykKICAgKiBvZiB2YWx1ZXMuCiAgICovCiAgdmFyIG9iamVjdFRvU3RyaW5nJDMgPSBvYmplY3RQcm90byQzLnRvU3RyaW5nOwoKICAvKiogQnVpbHQtaW4gdmFsdWUgcmVmZXJlbmNlcy4gKi8KICB2YXIgcHJvcGVydHlJc0VudW1lcmFibGUgPSBvYmplY3RQcm90byQzLnByb3BlcnR5SXNFbnVtZXJhYmxlOwoKICAvKiBCdWlsdC1pbiBtZXRob2QgcmVmZXJlbmNlcyBmb3IgdGhvc2Ugd2l0aCB0aGUgc2FtZSBuYW1lIGFzIG90aGVyIGBsb2Rhc2hgIG1ldGhvZHMuICovCiAgdmFyIG5hdGl2ZUtleXMgPSBvdmVyQXJnKE9iamVjdC5rZXlzLCBPYmplY3QpOwoKICAvKioKICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIHRoZSBlbnVtZXJhYmxlIHByb3BlcnR5IG5hbWVzIG9mIHRoZSBhcnJheS1saWtlIGB2YWx1ZWAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHF1ZXJ5LgogICAqIEBwYXJhbSB7Ym9vbGVhbn0gaW5oZXJpdGVkIFNwZWNpZnkgcmV0dXJuaW5nIGluaGVyaXRlZCBwcm9wZXJ0eSBuYW1lcy4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IG5hbWVzLgogICAqLwogIGZ1bmN0aW9uIGFycmF5TGlrZUtleXModmFsdWUsIGluaGVyaXRlZCkgewogICAgLy8gU2FmYXJpIDguMSBtYWtlcyBgYXJndW1lbnRzLmNhbGxlZWAgZW51bWVyYWJsZSBpbiBzdHJpY3QgbW9kZS4KICAgIC8vIFNhZmFyaSA5IG1ha2VzIGBhcmd1bWVudHMubGVuZ3RoYCBlbnVtZXJhYmxlIGluIHN0cmljdCBtb2RlLgogICAgdmFyIHJlc3VsdCA9IChpc0FycmF5KHZhbHVlKSB8fCBpc0FyZ3VtZW50cyh2YWx1ZSkpCiAgICAgID8gYmFzZVRpbWVzKHZhbHVlLmxlbmd0aCwgU3RyaW5nKQogICAgICA6IFtdOwoKICAgIHZhciBsZW5ndGggPSByZXN1bHQubGVuZ3RoLAogICAgICAgIHNraXBJbmRleGVzID0gISFsZW5ndGg7CgogICAgZm9yICh2YXIga2V5IGluIHZhbHVlKSB7CiAgICAgIGlmICgoaW5oZXJpdGVkIHx8IGhhc093blByb3BlcnR5JDEuY2FsbCh2YWx1ZSwga2V5KSkgJiYKICAgICAgICAgICEoc2tpcEluZGV4ZXMgJiYgKGtleSA9PSAnbGVuZ3RoJyB8fCBpc0luZGV4KGtleSwgbGVuZ3RoKSkpKSB7CiAgICAgICAgcmVzdWx0LnB1c2goa2V5KTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmZvckVhY2hgIHdpdGhvdXQgc3VwcG9ydCBmb3IgaXRlcmF0ZWUgc2hvcnRoYW5kcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheXxPYmplY3R9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGl0ZXJhdGVlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uCiAgICogQHJldHVybnMge0FycmF5fE9iamVjdH0gUmV0dXJucyBgY29sbGVjdGlvbmAuCiAgICovCiAgdmFyIGJhc2VFYWNoID0gY3JlYXRlQmFzZUVhY2goYmFzZUZvck93bik7CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBiYXNlRm9yT3duYCB3aGljaCBpdGVyYXRlcyBvdmVyIGBvYmplY3RgCiAgICogcHJvcGVydGllcyByZXR1cm5lZCBieSBga2V5c0Z1bmNgIGFuZCBpbnZva2VzIGBpdGVyYXRlZWAgZm9yIGVhY2ggcHJvcGVydHkuCiAgICogSXRlcmF0ZWUgZnVuY3Rpb25zIG1heSBleGl0IGl0ZXJhdGlvbiBlYXJseSBieSBleHBsaWNpdGx5IHJldHVybmluZyBgZmFsc2VgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gaXRlcmF0ZSBvdmVyLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGl0ZXJhdGVlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uCiAgICogQHBhcmFtIHtGdW5jdGlvbn0ga2V5c0Z1bmMgVGhlIGZ1bmN0aW9uIHRvIGdldCB0aGUga2V5cyBvZiBgb2JqZWN0YC4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLgogICAqLwogIHZhciBiYXNlRm9yID0gY3JlYXRlQmFzZUZvcigpOwoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5mb3JPd25gIHdpdGhvdXQgc3VwcG9ydCBmb3IgaXRlcmF0ZWUgc2hvcnRoYW5kcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGl0ZXJhdGUgb3Zlci4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLgogICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYG9iamVjdGAuCiAgICovCiAgZnVuY3Rpb24gYmFzZUZvck93bihvYmplY3QsIGl0ZXJhdGVlKSB7CiAgICByZXR1cm4gb2JqZWN0ICYmIGJhc2VGb3Iob2JqZWN0LCBpdGVyYXRlZSwga2V5cyk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5rZXlzYCB3aGljaCBkb2Vzbid0IHRyZWF0IHNwYXJzZSBhcnJheXMgYXMgZGVuc2UuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IG5hbWVzLgogICAqLwogIGZ1bmN0aW9uIGJhc2VLZXlzKG9iamVjdCkgewogICAgaWYgKCFpc1Byb3RvdHlwZShvYmplY3QpKSB7CiAgICAgIHJldHVybiBuYXRpdmVLZXlzKG9iamVjdCk7CiAgICB9CiAgICB2YXIgcmVzdWx0ID0gW107CiAgICBmb3IgKHZhciBrZXkgaW4gT2JqZWN0KG9iamVjdCkpIHsKICAgICAgaWYgKGhhc093blByb3BlcnR5JDEuY2FsbChvYmplY3QsIGtleSkgJiYga2V5ICE9ICdjb25zdHJ1Y3RvcicpIHsKICAgICAgICByZXN1bHQucHVzaChrZXkpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhIGBiYXNlRWFjaGAgb3IgYGJhc2VFYWNoUmlnaHRgIGZ1bmN0aW9uLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBlYWNoRnVuYyBUaGUgZnVuY3Rpb24gdG8gaXRlcmF0ZSBvdmVyIGEgY29sbGVjdGlvbi4KICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtmcm9tUmlnaHRdIFNwZWNpZnkgaXRlcmF0aW5nIGZyb20gcmlnaHQgdG8gbGVmdC4KICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBiYXNlIGZ1bmN0aW9uLgogICAqLwogIGZ1bmN0aW9uIGNyZWF0ZUJhc2VFYWNoKGVhY2hGdW5jLCBmcm9tUmlnaHQpIHsKICAgIHJldHVybiBmdW5jdGlvbihjb2xsZWN0aW9uLCBpdGVyYXRlZSkgewogICAgICBpZiAoY29sbGVjdGlvbiA9PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIGNvbGxlY3Rpb247CiAgICAgIH0KICAgICAgaWYgKCFpc0FycmF5TGlrZShjb2xsZWN0aW9uKSkgewogICAgICAgIHJldHVybiBlYWNoRnVuYyhjb2xsZWN0aW9uLCBpdGVyYXRlZSk7CiAgICAgIH0KICAgICAgdmFyIGxlbmd0aCA9IGNvbGxlY3Rpb24ubGVuZ3RoLAogICAgICAgICAgaW5kZXggPSBmcm9tUmlnaHQgPyBsZW5ndGggOiAtMSwKICAgICAgICAgIGl0ZXJhYmxlID0gT2JqZWN0KGNvbGxlY3Rpb24pOwoKICAgICAgd2hpbGUgKChmcm9tUmlnaHQgPyBpbmRleC0tIDogKytpbmRleCA8IGxlbmd0aCkpIHsKICAgICAgICBpZiAoaXRlcmF0ZWUoaXRlcmFibGVbaW5kZXhdLCBpbmRleCwgaXRlcmFibGUpID09PSBmYWxzZSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBjb2xsZWN0aW9uOwogICAgfTsKICB9CgogIC8qKgogICAqIENyZWF0ZXMgYSBiYXNlIGZ1bmN0aW9uIGZvciBtZXRob2RzIGxpa2UgYF8uZm9ySW5gIGFuZCBgXy5mb3JPd25gLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtmcm9tUmlnaHRdIFNwZWNpZnkgaXRlcmF0aW5nIGZyb20gcmlnaHQgdG8gbGVmdC4KICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBiYXNlIGZ1bmN0aW9uLgogICAqLwogIGZ1bmN0aW9uIGNyZWF0ZUJhc2VGb3IoZnJvbVJpZ2h0KSB7CiAgICByZXR1cm4gZnVuY3Rpb24ob2JqZWN0LCBpdGVyYXRlZSwga2V5c0Z1bmMpIHsKICAgICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgICBpdGVyYWJsZSA9IE9iamVjdChvYmplY3QpLAogICAgICAgICAgcHJvcHMgPSBrZXlzRnVuYyhvYmplY3QpLAogICAgICAgICAgbGVuZ3RoID0gcHJvcHMubGVuZ3RoOwoKICAgICAgd2hpbGUgKGxlbmd0aC0tKSB7CiAgICAgICAgdmFyIGtleSA9IHByb3BzW2Zyb21SaWdodCA/IGxlbmd0aCA6ICsraW5kZXhdOwogICAgICAgIGlmIChpdGVyYXRlZShpdGVyYWJsZVtrZXldLCBrZXksIGl0ZXJhYmxlKSA9PT0gZmFsc2UpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gb2JqZWN0OwogICAgfTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGEgdmFsaWQgYXJyYXktbGlrZSBpbmRleC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHBhcmFtIHtudW1iZXJ9IFtsZW5ndGg9TUFYX1NBRkVfSU5URUdFUl0gVGhlIHVwcGVyIGJvdW5kcyBvZiBhIHZhbGlkIGluZGV4LgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgdmFsaWQgaW5kZXgsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBpc0luZGV4KHZhbHVlLCBsZW5ndGgpIHsKICAgIGxlbmd0aCA9IGxlbmd0aCA9PSBudWxsID8gTUFYX1NBRkVfSU5URUdFUiA6IGxlbmd0aDsKICAgIHJldHVybiAhIWxlbmd0aCAmJgogICAgICAodHlwZW9mIHZhbHVlID09ICdudW1iZXInIHx8IHJlSXNVaW50LnRlc3QodmFsdWUpKSAmJgogICAgICAodmFsdWUgPiAtMSAmJiB2YWx1ZSAlIDEgPT0gMCAmJiB2YWx1ZSA8IGxlbmd0aCk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBsaWtlbHkgYSBwcm90b3R5cGUgb2JqZWN0LgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHByb3RvdHlwZSwgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGlzUHJvdG90eXBlKHZhbHVlKSB7CiAgICB2YXIgQ3RvciA9IHZhbHVlICYmIHZhbHVlLmNvbnN0cnVjdG9yLAogICAgICAgIHByb3RvID0gKHR5cGVvZiBDdG9yID09ICdmdW5jdGlvbicgJiYgQ3Rvci5wcm90b3R5cGUpIHx8IG9iamVjdFByb3RvJDM7CgogICAgcmV0dXJuIHZhbHVlID09PSBwcm90bzsKICB9CgogIC8qKgogICAqIEl0ZXJhdGVzIG92ZXIgZWxlbWVudHMgb2YgYGNvbGxlY3Rpb25gIGFuZCBpbnZva2VzIGBpdGVyYXRlZWAgZm9yIGVhY2ggZWxlbWVudC4KICAgKiBUaGUgaXRlcmF0ZWUgaXMgaW52b2tlZCB3aXRoIHRocmVlIGFyZ3VtZW50czogKHZhbHVlLCBpbmRleHxrZXksIGNvbGxlY3Rpb24pLgogICAqIEl0ZXJhdGVlIGZ1bmN0aW9ucyBtYXkgZXhpdCBpdGVyYXRpb24gZWFybHkgYnkgZXhwbGljaXRseSByZXR1cm5pbmcgYGZhbHNlYC4KICAgKgogICAqICoqTm90ZToqKiBBcyB3aXRoIG90aGVyICJDb2xsZWN0aW9ucyIgbWV0aG9kcywgb2JqZWN0cyB3aXRoIGEgImxlbmd0aCIKICAgKiBwcm9wZXJ0eSBhcmUgaXRlcmF0ZWQgbGlrZSBhcnJheXMuIFRvIGF2b2lkIHRoaXMgYmVoYXZpb3IgdXNlIGBfLmZvckluYAogICAqIG9yIGBfLmZvck93bmAgZm9yIG9iamVjdCBpdGVyYXRpb24uCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAYWxpYXMgZWFjaAogICAqIEBjYXRlZ29yeSBDb2xsZWN0aW9uCiAgICogQHBhcmFtIHtBcnJheXxPYmplY3R9IGNvbGxlY3Rpb24gVGhlIGNvbGxlY3Rpb24gdG8gaXRlcmF0ZSBvdmVyLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLgogICAqIEByZXR1cm5zIHtBcnJheXxPYmplY3R9IFJldHVybnMgYGNvbGxlY3Rpb25gLgogICAqIEBzZWUgXy5mb3JFYWNoUmlnaHQKICAgKiBAZXhhbXBsZQogICAqCiAgICogXyhbMSwgMl0pLmZvckVhY2goZnVuY3Rpb24odmFsdWUpIHsKICAgKiAgIGNvbnNvbGUubG9nKHZhbHVlKTsKICAgKiB9KTsKICAgKiAvLyA9PiBMb2dzIGAxYCB0aGVuIGAyYC4KICAgKgogICAqIF8uZm9yRWFjaCh7ICdhJzogMSwgJ2InOiAyIH0sIGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHsKICAgKiAgIGNvbnNvbGUubG9nKGtleSk7CiAgICogfSk7CiAgICogLy8gPT4gTG9ncyAnYScgdGhlbiAnYicgKGl0ZXJhdGlvbiBvcmRlciBpcyBub3QgZ3VhcmFudGVlZCkuCiAgICovCiAgZnVuY3Rpb24gZm9yRWFjaChjb2xsZWN0aW9uLCBpdGVyYXRlZSkgewogICAgdmFyIGZ1bmMgPSBpc0FycmF5KGNvbGxlY3Rpb24pID8gYXJyYXlFYWNoIDogYmFzZUVhY2g7CiAgICByZXR1cm4gZnVuYyhjb2xsZWN0aW9uLCB0eXBlb2YgaXRlcmF0ZWUgPT0gJ2Z1bmN0aW9uJyA/IGl0ZXJhdGVlIDogaWRlbnRpdHkpOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgbGlrZWx5IGFuIGBhcmd1bWVudHNgIG9iamVjdC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYW4gYGFyZ3VtZW50c2Agb2JqZWN0LAogICAqICBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uaXNBcmd1bWVudHMoZnVuY3Rpb24oKSB7IHJldHVybiBhcmd1bWVudHM7IH0oKSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0FyZ3VtZW50cyhbMSwgMiwgM10pOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNBcmd1bWVudHModmFsdWUpIHsKICAgIC8vIFNhZmFyaSA4LjEgbWFrZXMgYGFyZ3VtZW50cy5jYWxsZWVgIGVudW1lcmFibGUgaW4gc3RyaWN0IG1vZGUuCiAgICByZXR1cm4gaXNBcnJheUxpa2VPYmplY3QodmFsdWUpICYmIGhhc093blByb3BlcnR5JDEuY2FsbCh2YWx1ZSwgJ2NhbGxlZScpICYmCiAgICAgICghcHJvcGVydHlJc0VudW1lcmFibGUuY2FsbCh2YWx1ZSwgJ2NhbGxlZScpIHx8IG9iamVjdFRvU3RyaW5nJDMuY2FsbCh2YWx1ZSkgPT0gYXJnc1RhZyk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBjbGFzc2lmaWVkIGFzIGFuIGBBcnJheWAgb2JqZWN0LgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDAuMS4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhbiBhcnJheSwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzQXJyYXkoWzEsIDIsIDNdKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzQXJyYXkoZG9jdW1lbnQuYm9keS5jaGlsZHJlbik7CiAgICogLy8gPT4gZmFsc2UKICAgKgogICAqIF8uaXNBcnJheSgnYWJjJyk7CiAgICogLy8gPT4gZmFsc2UKICAgKgogICAqIF8uaXNBcnJheShfLm5vb3ApOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgdmFyIGlzQXJyYXkgPSBBcnJheS5pc0FycmF5OwoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBhcnJheS1saWtlLiBBIHZhbHVlIGlzIGNvbnNpZGVyZWQgYXJyYXktbGlrZSBpZiBpdCdzCiAgICogbm90IGEgZnVuY3Rpb24gYW5kIGhhcyBhIGB2YWx1ZS5sZW5ndGhgIHRoYXQncyBhbiBpbnRlZ2VyIGdyZWF0ZXIgdGhhbiBvcgogICAqIGVxdWFsIHRvIGAwYCBhbmQgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIGBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUmAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGFycmF5LWxpa2UsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc0FycmF5TGlrZShbMSwgMiwgM10pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNBcnJheUxpa2UoZG9jdW1lbnQuYm9keS5jaGlsZHJlbik7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0FycmF5TGlrZSgnYWJjJyk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0FycmF5TGlrZShfLm5vb3ApOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNBcnJheUxpa2UodmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZSAhPSBudWxsICYmIGlzTGVuZ3RoKHZhbHVlLmxlbmd0aCkgJiYgIWlzRnVuY3Rpb24odmFsdWUpOwogIH0KCiAgLyoqCiAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5pc0FycmF5TGlrZWAgZXhjZXB0IHRoYXQgaXQgYWxzbyBjaGVja3MgaWYgYHZhbHVlYAogICAqIGlzIGFuIG9iamVjdC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYW4gYXJyYXktbGlrZSBvYmplY3QsCiAgICogIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc0FycmF5TGlrZU9iamVjdChbMSwgMiwgM10pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNBcnJheUxpa2VPYmplY3QoZG9jdW1lbnQuYm9keS5jaGlsZHJlbik7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0FycmF5TGlrZU9iamVjdCgnYWJjJyk7CiAgICogLy8gPT4gZmFsc2UKICAgKgogICAqIF8uaXNBcnJheUxpa2VPYmplY3QoXy5ub29wKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIGZ1bmN0aW9uIGlzQXJyYXlMaWtlT2JqZWN0KHZhbHVlKSB7CiAgICByZXR1cm4gaXNPYmplY3RMaWtlJDModmFsdWUpICYmIGlzQXJyYXlMaWtlKHZhbHVlKTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYSBgRnVuY3Rpb25gIG9iamVjdC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBmdW5jdGlvbiwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzRnVuY3Rpb24oXyk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0Z1bmN0aW9uKC9hYmMvKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIGZ1bmN0aW9uIGlzRnVuY3Rpb24odmFsdWUpIHsKICAgIC8vIFRoZSB1c2Ugb2YgYE9iamVjdCN0b1N0cmluZ2AgYXZvaWRzIGlzc3VlcyB3aXRoIHRoZSBgdHlwZW9mYCBvcGVyYXRvcgogICAgLy8gaW4gU2FmYXJpIDgtOSB3aGljaCByZXR1cm5zICdvYmplY3QnIGZvciB0eXBlZCBhcnJheSBhbmQgb3RoZXIgY29uc3RydWN0b3JzLgogICAgdmFyIHRhZyA9IGlzT2JqZWN0JDIodmFsdWUpID8gb2JqZWN0VG9TdHJpbmckMy5jYWxsKHZhbHVlKSA6ICcnOwogICAgcmV0dXJuIHRhZyA9PSBmdW5jVGFnIHx8IHRhZyA9PSBnZW5UYWc7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBhIHZhbGlkIGFycmF5LWxpa2UgbGVuZ3RoLgogICAqCiAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGlzIGxvb3NlbHkgYmFzZWQgb24KICAgKiBbYFRvTGVuZ3RoYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtdG9sZW5ndGgpLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMC4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHZhbGlkIGxlbmd0aCwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzTGVuZ3RoKDMpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNMZW5ndGgoTnVtYmVyLk1JTl9WQUxVRSk7CiAgICogLy8gPT4gZmFsc2UKICAgKgogICAqIF8uaXNMZW5ndGgoSW5maW5pdHkpOwogICAqIC8vID0+IGZhbHNlCiAgICoKICAgKiBfLmlzTGVuZ3RoKCczJyk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc0xlbmd0aCh2YWx1ZSkgewogICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJyAmJgogICAgICB2YWx1ZSA+IC0xICYmIHZhbHVlICUgMSA9PSAwICYmIHZhbHVlIDw9IE1BWF9TQUZFX0lOVEVHRVI7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyB0aGUKICAgKiBbbGFuZ3VhZ2UgdHlwZV0oaHR0cDovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLWVjbWFzY3JpcHQtbGFuZ3VhZ2UtdHlwZXMpCiAgICogb2YgYE9iamVjdGAuIChlLmcuIGFycmF5cywgZnVuY3Rpb25zLCBvYmplY3RzLCByZWdleGVzLCBgbmV3IE51bWJlcigwKWAsIGFuZCBgbmV3IFN0cmluZygnJylgKQogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDAuMS4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhbiBvYmplY3QsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc09iamVjdCh7fSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc09iamVjdChbMSwgMiwgM10pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNPYmplY3QoXy5ub29wKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzT2JqZWN0KG51bGwpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNPYmplY3QkMih2YWx1ZSkgewogICAgdmFyIHR5cGUgPSB0eXBlb2YgdmFsdWU7CiAgICByZXR1cm4gISF2YWx1ZSAmJiAodHlwZSA9PSAnb2JqZWN0JyB8fCB0eXBlID09ICdmdW5jdGlvbicpOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgb2JqZWN0LWxpa2UuIEEgdmFsdWUgaXMgb2JqZWN0LWxpa2UgaWYgaXQncyBub3QgYG51bGxgCiAgICogYW5kIGhhcyBhIGB0eXBlb2ZgIHJlc3VsdCBvZiAib2JqZWN0Ii4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgb2JqZWN0LWxpa2UsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc09iamVjdExpa2Uoe30pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNPYmplY3RMaWtlKFsxLCAyLCAzXSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc09iamVjdExpa2UoXy5ub29wKTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5pc09iamVjdExpa2UobnVsbCk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc09iamVjdExpa2UkMyh2YWx1ZSkgewogICAgcmV0dXJuICEhdmFsdWUgJiYgdHlwZW9mIHZhbHVlID09ICdvYmplY3QnOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiB0aGUgb3duIGVudW1lcmFibGUgcHJvcGVydHkgbmFtZXMgb2YgYG9iamVjdGAuCiAgICoKICAgKiAqKk5vdGU6KiogTm9uLW9iamVjdCB2YWx1ZXMgYXJlIGNvZXJjZWQgdG8gb2JqZWN0cy4gU2VlIHRoZQogICAqIFtFUyBzcGVjXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1vYmplY3Qua2V5cykKICAgKiBmb3IgbW9yZSBkZXRhaWxzLgogICAqCiAgICogQHN0YXRpYwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBtZW1iZXJPZiBfCiAgICogQGNhdGVnb3J5IE9iamVjdAogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IG5hbWVzLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBmdW5jdGlvbiBGb28oKSB7CiAgICogICB0aGlzLmEgPSAxOwogICAqICAgdGhpcy5iID0gMjsKICAgKiB9CiAgICoKICAgKiBGb28ucHJvdG90eXBlLmMgPSAzOwogICAqCiAgICogXy5rZXlzKG5ldyBGb28pOwogICAqIC8vID0+IFsnYScsICdiJ10gKGl0ZXJhdGlvbiBvcmRlciBpcyBub3QgZ3VhcmFudGVlZCkKICAgKgogICAqIF8ua2V5cygnaGknKTsKICAgKiAvLyA9PiBbJzAnLCAnMSddCiAgICovCiAgZnVuY3Rpb24ga2V5cyhvYmplY3QpIHsKICAgIHJldHVybiBpc0FycmF5TGlrZShvYmplY3QpID8gYXJyYXlMaWtlS2V5cyhvYmplY3QpIDogYmFzZUtleXMob2JqZWN0KTsKICB9CgogIC8qKgogICAqIFRoaXMgbWV0aG9kIHJldHVybnMgdGhlIGZpcnN0IGFyZ3VtZW50IGl0IHJlY2VpdmVzLgogICAqCiAgICogQHN0YXRpYwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBtZW1iZXJPZiBfCiAgICogQGNhdGVnb3J5IFV0aWwKICAgKiBAcGFyYW0geyp9IHZhbHVlIEFueSB2YWx1ZS4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyBgdmFsdWVgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgb2JqZWN0ID0geyAnYSc6IDEgfTsKICAgKgogICAqIGNvbnNvbGUubG9nKF8uaWRlbnRpdHkob2JqZWN0KSA9PT0gb2JqZWN0KTsKICAgKiAvLyA9PiB0cnVlCiAgICovCiAgZnVuY3Rpb24gaWRlbnRpdHkodmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZTsKICB9CgogIHZhciBsb2Rhc2hfZm9yZWFjaCA9IGZvckVhY2g7CgogIGxldCB1cmxBbHBoYWJldCQxID0KICAgICd1c2VhbmRvbS0yNlQxOTgzNDBQWDc1cHhKQUNLVkVSWU1JTkRCVVNIV09MRl9HUVpiZmdoamtscXZ3eXpyaWN0JzsKICB2YXIgdXJsQWxwaGFiZXRfMSA9IHsgdXJsQWxwaGFiZXQ6IHVybEFscGhhYmV0JDEgfTsKCiAgbGV0IHsgdXJsQWxwaGFiZXQgfSA9IHVybEFscGhhYmV0XzE7CiAgewogICAgaWYgKAogICAgICB0eXBlb2YgbmF2aWdhdG9yICE9PSAndW5kZWZpbmVkJyAmJgogICAgICBuYXZpZ2F0b3IucHJvZHVjdCA9PT0gJ1JlYWN0TmF0aXZlJyAmJgogICAgICB0eXBlb2YgY3J5cHRvID09PSAndW5kZWZpbmVkJwogICAgKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAnUmVhY3QgTmF0aXZlIGRvZXMgbm90IGhhdmUgYSBidWlsdC1pbiBzZWN1cmUgcmFuZG9tIGdlbmVyYXRvci4gJyArCiAgICAgICAgICAnSWYgeW91IGRvbuKAmXQgbmVlZCB1bnByZWRpY3RhYmxlIElEcyB1c2UgYG5hbm9pZC9ub24tc2VjdXJlYC4gJyArCiAgICAgICAgICAnRm9yIHNlY3VyZSBJRHMsIGltcG9ydCBgcmVhY3QtbmF0aXZlLWdldC1yYW5kb20tdmFsdWVzYCAnICsKICAgICAgICAgICdiZWZvcmUgTmFubyBJRC4nCiAgICAgICkKICAgIH0KICAgIGlmICh0eXBlb2YgbXNDcnlwdG8gIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBjcnlwdG8gPT09ICd1bmRlZmluZWQnKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAnSW1wb3J0IGZpbGUgd2l0aCBgaWYgKCF3aW5kb3cuY3J5cHRvKSB3aW5kb3cuY3J5cHRvID0gd2luZG93Lm1zQ3J5cHRvYCcgKwogICAgICAgICAgJyBiZWZvcmUgaW1wb3J0aW5nIE5hbm8gSUQgdG8gZml4IElFIDExIHN1cHBvcnQnCiAgICAgICkKICAgIH0KICAgIGlmICh0eXBlb2YgY3J5cHRvID09PSAndW5kZWZpbmVkJykgewogICAgICB0aHJvdyBuZXcgRXJyb3IoCiAgICAgICAgJ1lvdXIgYnJvd3NlciBkb2VzIG5vdCBoYXZlIHNlY3VyZSByYW5kb20gZ2VuZXJhdG9yLiAnICsKICAgICAgICAgICdJZiB5b3UgZG9u4oCZdCBuZWVkIHVucHJlZGljdGFibGUgSURzLCB5b3UgY2FuIHVzZSBuYW5vaWQvbm9uLXNlY3VyZS4nCiAgICAgICkKICAgIH0KICB9CiAgbGV0IHJhbmRvbSA9IGJ5dGVzID0+IGNyeXB0by5nZXRSYW5kb21WYWx1ZXMobmV3IFVpbnQ4QXJyYXkoYnl0ZXMpKTsKICBsZXQgY3VzdG9tUmFuZG9tID0gKGFscGhhYmV0LCBzaXplLCBnZXRSYW5kb20pID0+IHsKICAgIGxldCBtYXNrID0gKDIgPDwgKE1hdGgubG9nKGFscGhhYmV0Lmxlbmd0aCAtIDEpIC8gTWF0aC5MTjIpKSAtIDE7CiAgICBsZXQgc3RlcCA9IC1+KCgxLjYgKiBtYXNrICogc2l6ZSkgLyBhbHBoYWJldC5sZW5ndGgpOwogICAgcmV0dXJuICgpID0+IHsKICAgICAgbGV0IGlkID0gJyc7CiAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgbGV0IGJ5dGVzID0gZ2V0UmFuZG9tKHN0ZXApOwogICAgICAgIGxldCBqID0gc3RlcDsKICAgICAgICB3aGlsZSAoai0tKSB7CiAgICAgICAgICBpZCArPSBhbHBoYWJldFtieXRlc1tqXSAmIG1hc2tdIHx8ICcnOwogICAgICAgICAgaWYgKGlkLmxlbmd0aCA9PT0gc2l6ZSkgcmV0dXJuIGlkCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKICBsZXQgY3VzdG9tQWxwaGFiZXQgPSAoYWxwaGFiZXQsIHNpemUpID0+IGN1c3RvbVJhbmRvbShhbHBoYWJldCwgc2l6ZSwgcmFuZG9tKTsKICBsZXQgbmFub2lkJDIgPSAoc2l6ZSA9IDIxKSA9PiB7CiAgICBsZXQgaWQgPSAnJzsKICAgIGxldCBieXRlcyA9IGNyeXB0by5nZXRSYW5kb21WYWx1ZXMobmV3IFVpbnQ4QXJyYXkoc2l6ZSkpOwogICAgd2hpbGUgKHNpemUtLSkgewogICAgICBsZXQgYnl0ZSA9IGJ5dGVzW3NpemVdICYgNjM7CiAgICAgIGlmIChieXRlIDwgMzYpIHsKICAgICAgICBpZCArPSBieXRlLnRvU3RyaW5nKDM2KTsKICAgICAgfSBlbHNlIGlmIChieXRlIDwgNjIpIHsKICAgICAgICBpZCArPSAoYnl0ZSAtIDI2KS50b1N0cmluZygzNikudG9VcHBlckNhc2UoKTsKICAgICAgfSBlbHNlIGlmIChieXRlIDwgNjMpIHsKICAgICAgICBpZCArPSAnXyc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWQgKz0gJy0nOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gaWQKICB9OwogIHZhciBpbmRleF9icm93c2VyID0geyBuYW5vaWQ6IG5hbm9pZCQyLCBjdXN0b21BbHBoYWJldCwgY3VzdG9tUmFuZG9tLCB1cmxBbHBoYWJldCwgcmFuZG9tIH07CgogIC8qKgogICAqIGxvZGFzaCAoQ3VzdG9tIEJ1aWxkKSA8aHR0cHM6Ly9sb2Rhc2guY29tLz4KICAgKiBCdWlsZDogYGxvZGFzaCBtb2R1bGFyaXplIGV4cG9ydHM9Im5wbSIgLW8gLi9gCiAgICogQ29weXJpZ2h0IGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMgPGh0dHBzOi8vanF1ZXJ5Lm9yZy8+CiAgICogUmVsZWFzZWQgdW5kZXIgTUlUIGxpY2Vuc2UgPGh0dHBzOi8vbG9kYXNoLmNvbS9saWNlbnNlPgogICAqIEJhc2VkIG9uIFVuZGVyc2NvcmUuanMgMS44LjMgPGh0dHA6Ly91bmRlcnNjb3JlanMub3JnL0xJQ0VOU0U+CiAgICogQ29weXJpZ2h0IEplcmVteSBBc2hrZW5hcywgRG9jdW1lbnRDbG91ZCBhbmQgSW52ZXN0aWdhdGl2ZSBSZXBvcnRlcnMgJiBFZGl0b3JzCiAgICovCgogIC8qKiBVc2VkIGFzIHRoZSBgVHlwZUVycm9yYCBtZXNzYWdlIGZvciAiRnVuY3Rpb25zIiBtZXRob2RzLiAqLwogIHZhciBGVU5DX0VSUk9SX1RFWFQkMSA9ICdFeHBlY3RlZCBhIGZ1bmN0aW9uJzsKCiAgLyoqIFVzZWQgYXMgcmVmZXJlbmNlcyBmb3IgdmFyaW91cyBgTnVtYmVyYCBjb25zdGFudHMuICovCiAgdmFyIE5BTiQxID0gMCAvIDA7CgogIC8qKiBgT2JqZWN0I3RvU3RyaW5nYCByZXN1bHQgcmVmZXJlbmNlcy4gKi8KICB2YXIgc3ltYm9sVGFnJDIgPSAnW29iamVjdCBTeW1ib2xdJzsKCiAgLyoqIFVzZWQgdG8gbWF0Y2ggbGVhZGluZyBhbmQgdHJhaWxpbmcgd2hpdGVzcGFjZS4gKi8KICB2YXIgcmVUcmltJDEgPSAvXlxzK3xccyskL2c7CgogIC8qKiBVc2VkIHRvIGRldGVjdCBiYWQgc2lnbmVkIGhleGFkZWNpbWFsIHN0cmluZyB2YWx1ZXMuICovCiAgdmFyIHJlSXNCYWRIZXgkMSA9IC9eWy0rXTB4WzAtOWEtZl0rJC9pOwoKICAvKiogVXNlZCB0byBkZXRlY3QgYmluYXJ5IHN0cmluZyB2YWx1ZXMuICovCiAgdmFyIHJlSXNCaW5hcnkkMSA9IC9eMGJbMDFdKyQvaTsKCiAgLyoqIFVzZWQgdG8gZGV0ZWN0IG9jdGFsIHN0cmluZyB2YWx1ZXMuICovCiAgdmFyIHJlSXNPY3RhbCQxID0gL14wb1swLTddKyQvaTsKCiAgLyoqIEJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzIHdpdGhvdXQgYSBkZXBlbmRlbmN5IG9uIGByb290YC4gKi8KICB2YXIgZnJlZVBhcnNlSW50JDEgPSBwYXJzZUludDsKCiAgLyoqIERldGVjdCBmcmVlIHZhcmlhYmxlIGBnbG9iYWxgIGZyb20gTm9kZS5qcy4gKi8KICB2YXIgZnJlZUdsb2JhbCQyID0gdHlwZW9mIGNvbW1vbmpzR2xvYmFsID09ICdvYmplY3QnICYmIGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLk9iamVjdCA9PT0gT2JqZWN0ICYmIGNvbW1vbmpzR2xvYmFsOwoKICAvKiogRGV0ZWN0IGZyZWUgdmFyaWFibGUgYHNlbGZgLiAqLwogIHZhciBmcmVlU2VsZiQyID0gdHlwZW9mIHNlbGYgPT0gJ29iamVjdCcgJiYgc2VsZiAmJiBzZWxmLk9iamVjdCA9PT0gT2JqZWN0ICYmIHNlbGY7CgogIC8qKiBVc2VkIGFzIGEgcmVmZXJlbmNlIHRvIHRoZSBnbG9iYWwgb2JqZWN0LiAqLwogIHZhciByb290JDIgPSBmcmVlR2xvYmFsJDIgfHwgZnJlZVNlbGYkMiB8fCBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpOwoKICAvKiogVXNlZCBmb3IgYnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMuICovCiAgdmFyIG9iamVjdFByb3RvJDIgPSBPYmplY3QucHJvdG90eXBlOwoKICAvKioKICAgKiBVc2VkIHRvIHJlc29sdmUgdGhlCiAgICogW2B0b1N0cmluZ1RhZ2BdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLW9iamVjdC5wcm90b3R5cGUudG9zdHJpbmcpCiAgICogb2YgdmFsdWVzLgogICAqLwogIHZhciBvYmplY3RUb1N0cmluZyQyID0gb2JqZWN0UHJvdG8kMi50b1N0cmluZzsKCiAgLyogQnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMgZm9yIHRob3NlIHdpdGggdGhlIHNhbWUgbmFtZSBhcyBvdGhlciBgbG9kYXNoYCBtZXRob2RzLiAqLwogIHZhciBuYXRpdmVNYXgkMSA9IE1hdGgubWF4LAogICAgICBuYXRpdmVNaW4kMSA9IE1hdGgubWluOwoKICAvKioKICAgKiBHZXRzIHRoZSB0aW1lc3RhbXAgb2YgdGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdGhhdCBoYXZlIGVsYXBzZWQgc2luY2UKICAgKiB0aGUgVW5peCBlcG9jaCAoMSBKYW51YXJ5IDE5NzAgMDA6MDA6MDAgVVRDKS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAyLjQuMAogICAqIEBjYXRlZ29yeSBEYXRlCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgdGltZXN0YW1wLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmRlZmVyKGZ1bmN0aW9uKHN0YW1wKSB7CiAgICogICBjb25zb2xlLmxvZyhfLm5vdygpIC0gc3RhbXApOwogICAqIH0sIF8ubm93KCkpOwogICAqIC8vID0+IExvZ3MgdGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgaXQgdG9vayBmb3IgdGhlIGRlZmVycmVkIGludm9jYXRpb24uCiAgICovCiAgdmFyIG5vdyQxID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gcm9vdCQyLkRhdGUubm93KCk7CiAgfTsKCiAgLyoqCiAgICogQ3JlYXRlcyBhIGRlYm91bmNlZCBmdW5jdGlvbiB0aGF0IGRlbGF5cyBpbnZva2luZyBgZnVuY2AgdW50aWwgYWZ0ZXIgYHdhaXRgCiAgICogbWlsbGlzZWNvbmRzIGhhdmUgZWxhcHNlZCBzaW5jZSB0aGUgbGFzdCB0aW1lIHRoZSBkZWJvdW5jZWQgZnVuY3Rpb24gd2FzCiAgICogaW52b2tlZC4gVGhlIGRlYm91bmNlZCBmdW5jdGlvbiBjb21lcyB3aXRoIGEgYGNhbmNlbGAgbWV0aG9kIHRvIGNhbmNlbAogICAqIGRlbGF5ZWQgYGZ1bmNgIGludm9jYXRpb25zIGFuZCBhIGBmbHVzaGAgbWV0aG9kIHRvIGltbWVkaWF0ZWx5IGludm9rZSB0aGVtLgogICAqIFByb3ZpZGUgYG9wdGlvbnNgIHRvIGluZGljYXRlIHdoZXRoZXIgYGZ1bmNgIHNob3VsZCBiZSBpbnZva2VkIG9uIHRoZQogICAqIGxlYWRpbmcgYW5kL29yIHRyYWlsaW5nIGVkZ2Ugb2YgdGhlIGB3YWl0YCB0aW1lb3V0LiBUaGUgYGZ1bmNgIGlzIGludm9rZWQKICAgKiB3aXRoIHRoZSBsYXN0IGFyZ3VtZW50cyBwcm92aWRlZCB0byB0aGUgZGVib3VuY2VkIGZ1bmN0aW9uLiBTdWJzZXF1ZW50CiAgICogY2FsbHMgdG8gdGhlIGRlYm91bmNlZCBmdW5jdGlvbiByZXR1cm4gdGhlIHJlc3VsdCBvZiB0aGUgbGFzdCBgZnVuY2AKICAgKiBpbnZvY2F0aW9uLgogICAqCiAgICogKipOb3RlOioqIElmIGBsZWFkaW5nYCBhbmQgYHRyYWlsaW5nYCBvcHRpb25zIGFyZSBgdHJ1ZWAsIGBmdW5jYCBpcwogICAqIGludm9rZWQgb24gdGhlIHRyYWlsaW5nIGVkZ2Ugb2YgdGhlIHRpbWVvdXQgb25seSBpZiB0aGUgZGVib3VuY2VkIGZ1bmN0aW9uCiAgICogaXMgaW52b2tlZCBtb3JlIHRoYW4gb25jZSBkdXJpbmcgdGhlIGB3YWl0YCB0aW1lb3V0LgogICAqCiAgICogSWYgYHdhaXRgIGlzIGAwYCBhbmQgYGxlYWRpbmdgIGlzIGBmYWxzZWAsIGBmdW5jYCBpbnZvY2F0aW9uIGlzIGRlZmVycmVkCiAgICogdW50aWwgdG8gdGhlIG5leHQgdGljaywgc2ltaWxhciB0byBgc2V0VGltZW91dGAgd2l0aCBhIHRpbWVvdXQgb2YgYDBgLgogICAqCiAgICogU2VlIFtEYXZpZCBDb3JiYWNobydzIGFydGljbGVdKGh0dHBzOi8vY3NzLXRyaWNrcy5jb20vZGVib3VuY2luZy10aHJvdHRsaW5nLWV4cGxhaW5lZC1leGFtcGxlcy8pCiAgICogZm9yIGRldGFpbHMgb3ZlciB0aGUgZGlmZmVyZW5jZXMgYmV0d2VlbiBgXy5kZWJvdW5jZWAgYW5kIGBfLnRocm90dGxlYC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBGdW5jdGlvbgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGRlYm91bmNlLgogICAqIEBwYXJhbSB7bnVtYmVyfSBbd2FpdD0wXSBUaGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byBkZWxheS4KICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnM9e31dIFRoZSBvcHRpb25zIG9iamVjdC4KICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRpb25zLmxlYWRpbmc9ZmFsc2VdCiAgICogIFNwZWNpZnkgaW52b2tpbmcgb24gdGhlIGxlYWRpbmcgZWRnZSBvZiB0aGUgdGltZW91dC4KICAgKiBAcGFyYW0ge251bWJlcn0gW29wdGlvbnMubWF4V2FpdF0KICAgKiAgVGhlIG1heGltdW0gdGltZSBgZnVuY2AgaXMgYWxsb3dlZCB0byBiZSBkZWxheWVkIGJlZm9yZSBpdCdzIGludm9rZWQuCiAgICogQHBhcmFtIHtib29sZWFufSBbb3B0aW9ucy50cmFpbGluZz10cnVlXQogICAqICBTcGVjaWZ5IGludm9raW5nIG9uIHRoZSB0cmFpbGluZyBlZGdlIG9mIHRoZSB0aW1lb3V0LgogICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGRlYm91bmNlZCBmdW5jdGlvbi4KICAgKiBAZXhhbXBsZQogICAqCiAgICogLy8gQXZvaWQgY29zdGx5IGNhbGN1bGF0aW9ucyB3aGlsZSB0aGUgd2luZG93IHNpemUgaXMgaW4gZmx1eC4KICAgKiBqUXVlcnkod2luZG93KS5vbigncmVzaXplJywgXy5kZWJvdW5jZShjYWxjdWxhdGVMYXlvdXQsIDE1MCkpOwogICAqCiAgICogLy8gSW52b2tlIGBzZW5kTWFpbGAgd2hlbiBjbGlja2VkLCBkZWJvdW5jaW5nIHN1YnNlcXVlbnQgY2FsbHMuCiAgICogalF1ZXJ5KGVsZW1lbnQpLm9uKCdjbGljaycsIF8uZGVib3VuY2Uoc2VuZE1haWwsIDMwMCwgewogICAqICAgJ2xlYWRpbmcnOiB0cnVlLAogICAqICAgJ3RyYWlsaW5nJzogZmFsc2UKICAgKiB9KSk7CiAgICoKICAgKiAvLyBFbnN1cmUgYGJhdGNoTG9nYCBpcyBpbnZva2VkIG9uY2UgYWZ0ZXIgMSBzZWNvbmQgb2YgZGVib3VuY2VkIGNhbGxzLgogICAqIHZhciBkZWJvdW5jZWQgPSBfLmRlYm91bmNlKGJhdGNoTG9nLCAyNTAsIHsgJ21heFdhaXQnOiAxMDAwIH0pOwogICAqIHZhciBzb3VyY2UgPSBuZXcgRXZlbnRTb3VyY2UoJy9zdHJlYW0nKTsKICAgKiBqUXVlcnkoc291cmNlKS5vbignbWVzc2FnZScsIGRlYm91bmNlZCk7CiAgICoKICAgKiAvLyBDYW5jZWwgdGhlIHRyYWlsaW5nIGRlYm91bmNlZCBpbnZvY2F0aW9uLgogICAqIGpRdWVyeSh3aW5kb3cpLm9uKCdwb3BzdGF0ZScsIGRlYm91bmNlZC5jYW5jZWwpOwogICAqLwogIGZ1bmN0aW9uIGRlYm91bmNlJDIoZnVuYywgd2FpdCwgb3B0aW9ucykgewogICAgdmFyIGxhc3RBcmdzLAogICAgICAgIGxhc3RUaGlzLAogICAgICAgIG1heFdhaXQsCiAgICAgICAgcmVzdWx0LAogICAgICAgIHRpbWVySWQsCiAgICAgICAgbGFzdENhbGxUaW1lLAogICAgICAgIGxhc3RJbnZva2VUaW1lID0gMCwKICAgICAgICBsZWFkaW5nID0gZmFsc2UsCiAgICAgICAgbWF4aW5nID0gZmFsc2UsCiAgICAgICAgdHJhaWxpbmcgPSB0cnVlOwoKICAgIGlmICh0eXBlb2YgZnVuYyAhPSAnZnVuY3Rpb24nKSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoRlVOQ19FUlJPUl9URVhUJDEpOwogICAgfQogICAgd2FpdCA9IHRvTnVtYmVyJDEod2FpdCkgfHwgMDsKICAgIGlmIChpc09iamVjdCQxKG9wdGlvbnMpKSB7CiAgICAgIGxlYWRpbmcgPSAhIW9wdGlvbnMubGVhZGluZzsKICAgICAgbWF4aW5nID0gJ21heFdhaXQnIGluIG9wdGlvbnM7CiAgICAgIG1heFdhaXQgPSBtYXhpbmcgPyBuYXRpdmVNYXgkMSh0b051bWJlciQxKG9wdGlvbnMubWF4V2FpdCkgfHwgMCwgd2FpdCkgOiBtYXhXYWl0OwogICAgICB0cmFpbGluZyA9ICd0cmFpbGluZycgaW4gb3B0aW9ucyA/ICEhb3B0aW9ucy50cmFpbGluZyA6IHRyYWlsaW5nOwogICAgfQoKICAgIGZ1bmN0aW9uIGludm9rZUZ1bmModGltZSkgewogICAgICB2YXIgYXJncyA9IGxhc3RBcmdzLAogICAgICAgICAgdGhpc0FyZyA9IGxhc3RUaGlzOwoKICAgICAgbGFzdEFyZ3MgPSBsYXN0VGhpcyA9IHVuZGVmaW5lZDsKICAgICAgbGFzdEludm9rZVRpbWUgPSB0aW1lOwogICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KHRoaXNBcmcsIGFyZ3MpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICAgIGZ1bmN0aW9uIGxlYWRpbmdFZGdlKHRpbWUpIHsKICAgICAgLy8gUmVzZXQgYW55IGBtYXhXYWl0YCB0aW1lci4KICAgICAgbGFzdEludm9rZVRpbWUgPSB0aW1lOwogICAgICAvLyBTdGFydCB0aGUgdGltZXIgZm9yIHRoZSB0cmFpbGluZyBlZGdlLgogICAgICB0aW1lcklkID0gc2V0VGltZW91dCh0aW1lckV4cGlyZWQsIHdhaXQpOwogICAgICAvLyBJbnZva2UgdGhlIGxlYWRpbmcgZWRnZS4KICAgICAgcmV0dXJuIGxlYWRpbmcgPyBpbnZva2VGdW5jKHRpbWUpIDogcmVzdWx0OwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbWFpbmluZ1dhaXQodGltZSkgewogICAgICB2YXIgdGltZVNpbmNlTGFzdENhbGwgPSB0aW1lIC0gbGFzdENhbGxUaW1lLAogICAgICAgICAgdGltZVNpbmNlTGFzdEludm9rZSA9IHRpbWUgLSBsYXN0SW52b2tlVGltZSwKICAgICAgICAgIHJlc3VsdCA9IHdhaXQgLSB0aW1lU2luY2VMYXN0Q2FsbDsKCiAgICAgIHJldHVybiBtYXhpbmcgPyBuYXRpdmVNaW4kMShyZXN1bHQsIG1heFdhaXQgLSB0aW1lU2luY2VMYXN0SW52b2tlKSA6IHJlc3VsdDsKICAgIH0KCiAgICBmdW5jdGlvbiBzaG91bGRJbnZva2UodGltZSkgewogICAgICB2YXIgdGltZVNpbmNlTGFzdENhbGwgPSB0aW1lIC0gbGFzdENhbGxUaW1lLAogICAgICAgICAgdGltZVNpbmNlTGFzdEludm9rZSA9IHRpbWUgLSBsYXN0SW52b2tlVGltZTsKCiAgICAgIC8vIEVpdGhlciB0aGlzIGlzIHRoZSBmaXJzdCBjYWxsLCBhY3Rpdml0eSBoYXMgc3RvcHBlZCBhbmQgd2UncmUgYXQgdGhlCiAgICAgIC8vIHRyYWlsaW5nIGVkZ2UsIHRoZSBzeXN0ZW0gdGltZSBoYXMgZ29uZSBiYWNrd2FyZHMgYW5kIHdlJ3JlIHRyZWF0aW5nCiAgICAgIC8vIGl0IGFzIHRoZSB0cmFpbGluZyBlZGdlLCBvciB3ZSd2ZSBoaXQgdGhlIGBtYXhXYWl0YCBsaW1pdC4KICAgICAgcmV0dXJuIChsYXN0Q2FsbFRpbWUgPT09IHVuZGVmaW5lZCB8fCAodGltZVNpbmNlTGFzdENhbGwgPj0gd2FpdCkgfHwKICAgICAgICAodGltZVNpbmNlTGFzdENhbGwgPCAwKSB8fCAobWF4aW5nICYmIHRpbWVTaW5jZUxhc3RJbnZva2UgPj0gbWF4V2FpdCkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRpbWVyRXhwaXJlZCgpIHsKICAgICAgdmFyIHRpbWUgPSBub3ckMSgpOwogICAgICBpZiAoc2hvdWxkSW52b2tlKHRpbWUpKSB7CiAgICAgICAgcmV0dXJuIHRyYWlsaW5nRWRnZSh0aW1lKTsKICAgICAgfQogICAgICAvLyBSZXN0YXJ0IHRoZSB0aW1lci4KICAgICAgdGltZXJJZCA9IHNldFRpbWVvdXQodGltZXJFeHBpcmVkLCByZW1haW5pbmdXYWl0KHRpbWUpKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFpbGluZ0VkZ2UodGltZSkgewogICAgICB0aW1lcklkID0gdW5kZWZpbmVkOwoKICAgICAgLy8gT25seSBpbnZva2UgaWYgd2UgaGF2ZSBgbGFzdEFyZ3NgIHdoaWNoIG1lYW5zIGBmdW5jYCBoYXMgYmVlbgogICAgICAvLyBkZWJvdW5jZWQgYXQgbGVhc3Qgb25jZS4KICAgICAgaWYgKHRyYWlsaW5nICYmIGxhc3RBcmdzKSB7CiAgICAgICAgcmV0dXJuIGludm9rZUZ1bmModGltZSk7CiAgICAgIH0KICAgICAgbGFzdEFyZ3MgPSBsYXN0VGhpcyA9IHVuZGVmaW5lZDsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICBmdW5jdGlvbiBjYW5jZWwoKSB7CiAgICAgIGlmICh0aW1lcklkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBjbGVhclRpbWVvdXQodGltZXJJZCk7CiAgICAgIH0KICAgICAgbGFzdEludm9rZVRpbWUgPSAwOwogICAgICBsYXN0QXJncyA9IGxhc3RDYWxsVGltZSA9IGxhc3RUaGlzID0gdGltZXJJZCA9IHVuZGVmaW5lZDsKICAgIH0KCiAgICBmdW5jdGlvbiBmbHVzaCgpIHsKICAgICAgcmV0dXJuIHRpbWVySWQgPT09IHVuZGVmaW5lZCA/IHJlc3VsdCA6IHRyYWlsaW5nRWRnZShub3ckMSgpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBkZWJvdW5jZWQoKSB7CiAgICAgIHZhciB0aW1lID0gbm93JDEoKSwKICAgICAgICAgIGlzSW52b2tpbmcgPSBzaG91bGRJbnZva2UodGltZSk7CgogICAgICBsYXN0QXJncyA9IGFyZ3VtZW50czsKICAgICAgbGFzdFRoaXMgPSB0aGlzOwogICAgICBsYXN0Q2FsbFRpbWUgPSB0aW1lOwoKICAgICAgaWYgKGlzSW52b2tpbmcpIHsKICAgICAgICBpZiAodGltZXJJZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICByZXR1cm4gbGVhZGluZ0VkZ2UobGFzdENhbGxUaW1lKTsKICAgICAgICB9CiAgICAgICAgaWYgKG1heGluZykgewogICAgICAgICAgLy8gSGFuZGxlIGludm9jYXRpb25zIGluIGEgdGlnaHQgbG9vcC4KICAgICAgICAgIHRpbWVySWQgPSBzZXRUaW1lb3V0KHRpbWVyRXhwaXJlZCwgd2FpdCk7CiAgICAgICAgICByZXR1cm4gaW52b2tlRnVuYyhsYXN0Q2FsbFRpbWUpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAodGltZXJJZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGltZXJJZCA9IHNldFRpbWVvdXQodGltZXJFeHBpcmVkLCB3YWl0KTsKICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgZGVib3VuY2VkLmNhbmNlbCA9IGNhbmNlbDsKICAgIGRlYm91bmNlZC5mbHVzaCA9IGZsdXNoOwogICAgcmV0dXJuIGRlYm91bmNlZDsKICB9CgogIC8qKgogICAqIENyZWF0ZXMgYSB0aHJvdHRsZWQgZnVuY3Rpb24gdGhhdCBvbmx5IGludm9rZXMgYGZ1bmNgIGF0IG1vc3Qgb25jZSBwZXIKICAgKiBldmVyeSBgd2FpdGAgbWlsbGlzZWNvbmRzLiBUaGUgdGhyb3R0bGVkIGZ1bmN0aW9uIGNvbWVzIHdpdGggYSBgY2FuY2VsYAogICAqIG1ldGhvZCB0byBjYW5jZWwgZGVsYXllZCBgZnVuY2AgaW52b2NhdGlvbnMgYW5kIGEgYGZsdXNoYCBtZXRob2QgdG8KICAgKiBpbW1lZGlhdGVseSBpbnZva2UgdGhlbS4gUHJvdmlkZSBgb3B0aW9uc2AgdG8gaW5kaWNhdGUgd2hldGhlciBgZnVuY2AKICAgKiBzaG91bGQgYmUgaW52b2tlZCBvbiB0aGUgbGVhZGluZyBhbmQvb3IgdHJhaWxpbmcgZWRnZSBvZiB0aGUgYHdhaXRgCiAgICogdGltZW91dC4gVGhlIGBmdW5jYCBpcyBpbnZva2VkIHdpdGggdGhlIGxhc3QgYXJndW1lbnRzIHByb3ZpZGVkIHRvIHRoZQogICAqIHRocm90dGxlZCBmdW5jdGlvbi4gU3Vic2VxdWVudCBjYWxscyB0byB0aGUgdGhyb3R0bGVkIGZ1bmN0aW9uIHJldHVybiB0aGUKICAgKiByZXN1bHQgb2YgdGhlIGxhc3QgYGZ1bmNgIGludm9jYXRpb24uCiAgICoKICAgKiAqKk5vdGU6KiogSWYgYGxlYWRpbmdgIGFuZCBgdHJhaWxpbmdgIG9wdGlvbnMgYXJlIGB0cnVlYCwgYGZ1bmNgIGlzCiAgICogaW52b2tlZCBvbiB0aGUgdHJhaWxpbmcgZWRnZSBvZiB0aGUgdGltZW91dCBvbmx5IGlmIHRoZSB0aHJvdHRsZWQgZnVuY3Rpb24KICAgKiBpcyBpbnZva2VkIG1vcmUgdGhhbiBvbmNlIGR1cmluZyB0aGUgYHdhaXRgIHRpbWVvdXQuCiAgICoKICAgKiBJZiBgd2FpdGAgaXMgYDBgIGFuZCBgbGVhZGluZ2AgaXMgYGZhbHNlYCwgYGZ1bmNgIGludm9jYXRpb24gaXMgZGVmZXJyZWQKICAgKiB1bnRpbCB0byB0aGUgbmV4dCB0aWNrLCBzaW1pbGFyIHRvIGBzZXRUaW1lb3V0YCB3aXRoIGEgdGltZW91dCBvZiBgMGAuCiAgICoKICAgKiBTZWUgW0RhdmlkIENvcmJhY2hvJ3MgYXJ0aWNsZV0oaHR0cHM6Ly9jc3MtdHJpY2tzLmNvbS9kZWJvdW5jaW5nLXRocm90dGxpbmctZXhwbGFpbmVkLWV4YW1wbGVzLykKICAgKiBmb3IgZGV0YWlscyBvdmVyIHRoZSBkaWZmZXJlbmNlcyBiZXR3ZWVuIGBfLnRocm90dGxlYCBhbmQgYF8uZGVib3VuY2VgLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDAuMS4wCiAgICogQGNhdGVnb3J5IEZ1bmN0aW9uCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gdGhyb3R0bGUuCiAgICogQHBhcmFtIHtudW1iZXJ9IFt3YWl0PTBdIFRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHRocm90dGxlIGludm9jYXRpb25zIHRvLgogICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9ucz17fV0gVGhlIG9wdGlvbnMgb2JqZWN0LgogICAqIEBwYXJhbSB7Ym9vbGVhbn0gW29wdGlvbnMubGVhZGluZz10cnVlXQogICAqICBTcGVjaWZ5IGludm9raW5nIG9uIHRoZSBsZWFkaW5nIGVkZ2Ugb2YgdGhlIHRpbWVvdXQuCiAgICogQHBhcmFtIHtib29sZWFufSBbb3B0aW9ucy50cmFpbGluZz10cnVlXQogICAqICBTcGVjaWZ5IGludm9raW5nIG9uIHRoZSB0cmFpbGluZyBlZGdlIG9mIHRoZSB0aW1lb3V0LgogICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IHRocm90dGxlZCBmdW5jdGlvbi4KICAgKiBAZXhhbXBsZQogICAqCiAgICogLy8gQXZvaWQgZXhjZXNzaXZlbHkgdXBkYXRpbmcgdGhlIHBvc2l0aW9uIHdoaWxlIHNjcm9sbGluZy4KICAgKiBqUXVlcnkod2luZG93KS5vbignc2Nyb2xsJywgXy50aHJvdHRsZSh1cGRhdGVQb3NpdGlvbiwgMTAwKSk7CiAgICoKICAgKiAvLyBJbnZva2UgYHJlbmV3VG9rZW5gIHdoZW4gdGhlIGNsaWNrIGV2ZW50IGlzIGZpcmVkLCBidXQgbm90IG1vcmUgdGhhbiBvbmNlIGV2ZXJ5IDUgbWludXRlcy4KICAgKiB2YXIgdGhyb3R0bGVkID0gXy50aHJvdHRsZShyZW5ld1Rva2VuLCAzMDAwMDAsIHsgJ3RyYWlsaW5nJzogZmFsc2UgfSk7CiAgICogalF1ZXJ5KGVsZW1lbnQpLm9uKCdjbGljaycsIHRocm90dGxlZCk7CiAgICoKICAgKiAvLyBDYW5jZWwgdGhlIHRyYWlsaW5nIHRocm90dGxlZCBpbnZvY2F0aW9uLgogICAqIGpRdWVyeSh3aW5kb3cpLm9uKCdwb3BzdGF0ZScsIHRocm90dGxlZC5jYW5jZWwpOwogICAqLwogIGZ1bmN0aW9uIHRocm90dGxlKGZ1bmMsIHdhaXQsIG9wdGlvbnMpIHsKICAgIHZhciBsZWFkaW5nID0gdHJ1ZSwKICAgICAgICB0cmFpbGluZyA9IHRydWU7CgogICAgaWYgKHR5cGVvZiBmdW5jICE9ICdmdW5jdGlvbicpIHsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihGVU5DX0VSUk9SX1RFWFQkMSk7CiAgICB9CiAgICBpZiAoaXNPYmplY3QkMShvcHRpb25zKSkgewogICAgICBsZWFkaW5nID0gJ2xlYWRpbmcnIGluIG9wdGlvbnMgPyAhIW9wdGlvbnMubGVhZGluZyA6IGxlYWRpbmc7CiAgICAgIHRyYWlsaW5nID0gJ3RyYWlsaW5nJyBpbiBvcHRpb25zID8gISFvcHRpb25zLnRyYWlsaW5nIDogdHJhaWxpbmc7CiAgICB9CiAgICByZXR1cm4gZGVib3VuY2UkMihmdW5jLCB3YWl0LCB7CiAgICAgICdsZWFkaW5nJzogbGVhZGluZywKICAgICAgJ21heFdhaXQnOiB3YWl0LAogICAgICAndHJhaWxpbmcnOiB0cmFpbGluZwogICAgfSk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyB0aGUKICAgKiBbbGFuZ3VhZ2UgdHlwZV0oaHR0cDovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLWVjbWFzY3JpcHQtbGFuZ3VhZ2UtdHlwZXMpCiAgICogb2YgYE9iamVjdGAuIChlLmcuIGFycmF5cywgZnVuY3Rpb25zLCBvYmplY3RzLCByZWdleGVzLCBgbmV3IE51bWJlcigwKWAsIGFuZCBgbmV3IFN0cmluZygnJylgKQogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDAuMS4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhbiBvYmplY3QsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc09iamVjdCh7fSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc09iamVjdChbMSwgMiwgM10pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNPYmplY3QoXy5ub29wKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzT2JqZWN0KG51bGwpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNPYmplY3QkMSh2YWx1ZSkgewogICAgdmFyIHR5cGUgPSB0eXBlb2YgdmFsdWU7CiAgICByZXR1cm4gISF2YWx1ZSAmJiAodHlwZSA9PSAnb2JqZWN0JyB8fCB0eXBlID09ICdmdW5jdGlvbicpOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgb2JqZWN0LWxpa2UuIEEgdmFsdWUgaXMgb2JqZWN0LWxpa2UgaWYgaXQncyBub3QgYG51bGxgCiAgICogYW5kIGhhcyBhIGB0eXBlb2ZgIHJlc3VsdCBvZiAib2JqZWN0Ii4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgb2JqZWN0LWxpa2UsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc09iamVjdExpa2Uoe30pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNPYmplY3RMaWtlKFsxLCAyLCAzXSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc09iamVjdExpa2UoXy5ub29wKTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5pc09iamVjdExpa2UobnVsbCk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc09iamVjdExpa2UkMih2YWx1ZSkgewogICAgcmV0dXJuICEhdmFsdWUgJiYgdHlwZW9mIHZhbHVlID09ICdvYmplY3QnOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgY2xhc3NpZmllZCBhcyBhIGBTeW1ib2xgIHByaW1pdGl2ZSBvciBvYmplY3QuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgc3ltYm9sLCBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uaXNTeW1ib2woU3ltYm9sLml0ZXJhdG9yKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzU3ltYm9sKCdhYmMnKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIGZ1bmN0aW9uIGlzU3ltYm9sJDIodmFsdWUpIHsKICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ3N5bWJvbCcgfHwKICAgICAgKGlzT2JqZWN0TGlrZSQyKHZhbHVlKSAmJiBvYmplY3RUb1N0cmluZyQyLmNhbGwodmFsdWUpID09IHN5bWJvbFRhZyQyKTsKICB9CgogIC8qKgogICAqIENvbnZlcnRzIGB2YWx1ZWAgdG8gYSBudW1iZXIuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHByb2Nlc3MuCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgbnVtYmVyLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnRvTnVtYmVyKDMuMik7CiAgICogLy8gPT4gMy4yCiAgICoKICAgKiBfLnRvTnVtYmVyKE51bWJlci5NSU5fVkFMVUUpOwogICAqIC8vID0+IDVlLTMyNAogICAqCiAgICogXy50b051bWJlcihJbmZpbml0eSk7CiAgICogLy8gPT4gSW5maW5pdHkKICAgKgogICAqIF8udG9OdW1iZXIoJzMuMicpOwogICAqIC8vID0+IDMuMgogICAqLwogIGZ1bmN0aW9uIHRvTnVtYmVyJDEodmFsdWUpIHsKICAgIGlmICh0eXBlb2YgdmFsdWUgPT0gJ251bWJlcicpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQogICAgaWYgKGlzU3ltYm9sJDIodmFsdWUpKSB7CiAgICAgIHJldHVybiBOQU4kMTsKICAgIH0KICAgIGlmIChpc09iamVjdCQxKHZhbHVlKSkgewogICAgICB2YXIgb3RoZXIgPSB0eXBlb2YgdmFsdWUudmFsdWVPZiA9PSAnZnVuY3Rpb24nID8gdmFsdWUudmFsdWVPZigpIDogdmFsdWU7CiAgICAgIHZhbHVlID0gaXNPYmplY3QkMShvdGhlcikgPyAob3RoZXIgKyAnJykgOiBvdGhlcjsKICAgIH0KICAgIGlmICh0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIHsKICAgICAgcmV0dXJuIHZhbHVlID09PSAwID8gdmFsdWUgOiArdmFsdWU7CiAgICB9CiAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UocmVUcmltJDEsICcnKTsKICAgIHZhciBpc0JpbmFyeSA9IHJlSXNCaW5hcnkkMS50ZXN0KHZhbHVlKTsKICAgIHJldHVybiAoaXNCaW5hcnkgfHwgcmVJc09jdGFsJDEudGVzdCh2YWx1ZSkpCiAgICAgID8gZnJlZVBhcnNlSW50JDEodmFsdWUuc2xpY2UoMiksIGlzQmluYXJ5ID8gMiA6IDgpCiAgICAgIDogKHJlSXNCYWRIZXgkMS50ZXN0KHZhbHVlKSA/IE5BTiQxIDogK3ZhbHVlKTsKICB9CgogIHZhciBsb2Rhc2hfdGhyb3R0bGUgPSB0aHJvdHRsZTsKCiAgdmFyIHNuYWJiZG9tX2NqcyA9IGNyZWF0ZUNvbW1vbmpzTW9kdWxlJDEoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pOwoKICBmdW5jdGlvbiBjcmVhdGVFbGVtZW50KHRhZ05hbWUsIG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnTmFtZSwgb3B0aW9ucyk7CiAgfQogIGZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnROUyhuYW1lc3BhY2VVUkksIHF1YWxpZmllZE5hbWUsIG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhuYW1lc3BhY2VVUkksIHF1YWxpZmllZE5hbWUsIG9wdGlvbnMpOwogIH0KICBmdW5jdGlvbiBjcmVhdGVUZXh0Tm9kZSh0ZXh0KSB7CiAgICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0KTsKICB9CiAgZnVuY3Rpb24gY3JlYXRlQ29tbWVudCh0ZXh0KSB7CiAgICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVDb21tZW50KHRleHQpOwogIH0KICBmdW5jdGlvbiBpbnNlcnRCZWZvcmUocGFyZW50Tm9kZSwgbmV3Tm9kZSwgcmVmZXJlbmNlTm9kZSkgewogICAgICBwYXJlbnROb2RlLmluc2VydEJlZm9yZShuZXdOb2RlLCByZWZlcmVuY2VOb2RlKTsKICB9CiAgZnVuY3Rpb24gcmVtb3ZlQ2hpbGQobm9kZSwgY2hpbGQpIHsKICAgICAgbm9kZS5yZW1vdmVDaGlsZChjaGlsZCk7CiAgfQogIGZ1bmN0aW9uIGFwcGVuZENoaWxkKG5vZGUsIGNoaWxkKSB7CiAgICAgIG5vZGUuYXBwZW5kQ2hpbGQoY2hpbGQpOwogIH0KICBmdW5jdGlvbiBwYXJlbnROb2RlKG5vZGUpIHsKICAgICAgcmV0dXJuIG5vZGUucGFyZW50Tm9kZTsKICB9CiAgZnVuY3Rpb24gbmV4dFNpYmxpbmcobm9kZSkgewogICAgICByZXR1cm4gbm9kZS5uZXh0U2libGluZzsKICB9CiAgZnVuY3Rpb24gdGFnTmFtZShlbG0pIHsKICAgICAgcmV0dXJuIGVsbS50YWdOYW1lOwogIH0KICBmdW5jdGlvbiBzZXRUZXh0Q29udGVudChub2RlLCB0ZXh0KSB7CiAgICAgIG5vZGUudGV4dENvbnRlbnQgPSB0ZXh0OwogIH0KICBmdW5jdGlvbiBnZXRUZXh0Q29udGVudChub2RlKSB7CiAgICAgIHJldHVybiBub2RlLnRleHRDb250ZW50OwogIH0KICBmdW5jdGlvbiBpc0VsZW1lbnQobm9kZSkgewogICAgICByZXR1cm4gbm9kZS5ub2RlVHlwZSA9PT0gMTsKICB9CiAgZnVuY3Rpb24gaXNUZXh0KG5vZGUpIHsKICAgICAgcmV0dXJuIG5vZGUubm9kZVR5cGUgPT09IDM7CiAgfQogIGZ1bmN0aW9uIGlzQ29tbWVudChub2RlKSB7CiAgICAgIHJldHVybiBub2RlLm5vZGVUeXBlID09PSA4OwogIH0KICBjb25zdCBodG1sRG9tQXBpID0gewogICAgICBjcmVhdGVFbGVtZW50LAogICAgICBjcmVhdGVFbGVtZW50TlMsCiAgICAgIGNyZWF0ZVRleHROb2RlLAogICAgICBjcmVhdGVDb21tZW50LAogICAgICBpbnNlcnRCZWZvcmUsCiAgICAgIHJlbW92ZUNoaWxkLAogICAgICBhcHBlbmRDaGlsZCwKICAgICAgcGFyZW50Tm9kZSwKICAgICAgbmV4dFNpYmxpbmcsCiAgICAgIHRhZ05hbWUsCiAgICAgIHNldFRleHRDb250ZW50LAogICAgICBnZXRUZXh0Q29udGVudCwKICAgICAgaXNFbGVtZW50LAogICAgICBpc1RleHQsCiAgICAgIGlzQ29tbWVudCwKICB9OwoKICBmdW5jdGlvbiB2bm9kZShzZWwsIGRhdGEsIGNoaWxkcmVuLCB0ZXh0LCBlbG0pIHsKICAgICAgY29uc3Qga2V5ID0gZGF0YSA9PT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkIDogZGF0YS5rZXk7CiAgICAgIHJldHVybiB7IHNlbCwgZGF0YSwgY2hpbGRyZW4sIHRleHQsIGVsbSwga2V5IH07CiAgfQoKICBjb25zdCBhcnJheSA9IEFycmF5LmlzQXJyYXk7CiAgZnVuY3Rpb24gcHJpbWl0aXZlKHMpIHsKICAgICAgcmV0dXJuIHR5cGVvZiBzID09PSAic3RyaW5nIiB8fAogICAgICAgICAgdHlwZW9mIHMgPT09ICJudW1iZXIiIHx8CiAgICAgICAgICBzIGluc3RhbmNlb2YgU3RyaW5nIHx8CiAgICAgICAgICBzIGluc3RhbmNlb2YgTnVtYmVyOwogIH0KCiAgZnVuY3Rpb24gaXNVbmRlZihzKSB7CiAgICAgIHJldHVybiBzID09PSB1bmRlZmluZWQ7CiAgfQogIGZ1bmN0aW9uIGlzRGVmKHMpIHsKICAgICAgcmV0dXJuIHMgIT09IHVuZGVmaW5lZDsKICB9CiAgY29uc3QgZW1wdHlOb2RlID0gdm5vZGUoIiIsIHt9LCBbXSwgdW5kZWZpbmVkLCB1bmRlZmluZWQpOwogIGZ1bmN0aW9uIHNhbWVWbm9kZSh2bm9kZTEsIHZub2RlMikgewogICAgICB2YXIgX2EsIF9iOwogICAgICBjb25zdCBpc1NhbWVLZXkgPSB2bm9kZTEua2V5ID09PSB2bm9kZTIua2V5OwogICAgICBjb25zdCBpc1NhbWVJcyA9ICgoX2EgPSB2bm9kZTEuZGF0YSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmlzKSA9PT0gKChfYiA9IHZub2RlMi5kYXRhKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuaXMpOwogICAgICBjb25zdCBpc1NhbWVTZWwgPSB2bm9kZTEuc2VsID09PSB2bm9kZTIuc2VsOwogICAgICByZXR1cm4gaXNTYW1lU2VsICYmIGlzU2FtZUtleSAmJiBpc1NhbWVJczsKICB9CiAgZnVuY3Rpb24gaXNWbm9kZSh2bm9kZSkgewogICAgICByZXR1cm4gdm5vZGUuc2VsICE9PSB1bmRlZmluZWQ7CiAgfQogIGZ1bmN0aW9uIGNyZWF0ZUtleVRvT2xkSWR4KGNoaWxkcmVuLCBiZWdpbklkeCwgZW5kSWR4KSB7CiAgICAgIHZhciBfYTsKICAgICAgY29uc3QgbWFwID0ge307CiAgICAgIGZvciAobGV0IGkgPSBiZWdpbklkeDsgaSA8PSBlbmRJZHg7ICsraSkgewogICAgICAgICAgY29uc3Qga2V5ID0gKF9hID0gY2hpbGRyZW5baV0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5rZXk7CiAgICAgICAgICBpZiAoa2V5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBtYXBba2V5XSA9IGk7CiAgICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIG1hcDsKICB9CiAgY29uc3QgaG9va3MgPSBbCiAgICAgICJjcmVhdGUiLAogICAgICAidXBkYXRlIiwKICAgICAgInJlbW92ZSIsCiAgICAgICJkZXN0cm95IiwKICAgICAgInByZSIsCiAgICAgICJwb3N0IiwKICBdOwogIGZ1bmN0aW9uIGluaXQkMShtb2R1bGVzLCBkb21BcGkpIHsKICAgICAgY29uc3QgY2JzID0gewogICAgICAgICAgY3JlYXRlOiBbXSwKICAgICAgICAgIHVwZGF0ZTogW10sCiAgICAgICAgICByZW1vdmU6IFtdLAogICAgICAgICAgZGVzdHJveTogW10sCiAgICAgICAgICBwcmU6IFtdLAogICAgICAgICAgcG9zdDogW10sCiAgICAgIH07CiAgICAgIGNvbnN0IGFwaSA9IGRvbUFwaSAhPT0gdW5kZWZpbmVkID8gZG9tQXBpIDogaHRtbERvbUFwaTsKICAgICAgZm9yIChjb25zdCBob29rIG9mIGhvb2tzKSB7CiAgICAgICAgICBmb3IgKGNvbnN0IG1vZHVsZSBvZiBtb2R1bGVzKSB7CiAgICAgICAgICAgICAgY29uc3QgY3VycmVudEhvb2sgPSBtb2R1bGVbaG9va107CiAgICAgICAgICAgICAgaWYgKGN1cnJlbnRIb29rICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgY2JzW2hvb2tdLnB1c2goY3VycmVudEhvb2spOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBlbXB0eU5vZGVBdChlbG0pIHsKICAgICAgICAgIGNvbnN0IGlkID0gZWxtLmlkID8gIiMiICsgZWxtLmlkIDogIiI7CiAgICAgICAgICAvLyBlbG0uY2xhc3NOYW1lIGRvZXNuJ3QgcmV0dXJuIGEgc3RyaW5nIHdoZW4gZWxtIGlzIGFuIFNWRyBlbGVtZW50IGluc2lkZSBhIHNoYWRvd1Jvb3QuCiAgICAgICAgICAvLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8yOTQ1NDM0MC9kZXRlY3RpbmctY2xhc3NuYW1lLW9mLXN2Z2FuaW1hdGVkc3RyaW5nCiAgICAgICAgICBjb25zdCBjbGFzc2VzID0gZWxtLmdldEF0dHJpYnV0ZSgiY2xhc3MiKTsKICAgICAgICAgIGNvbnN0IGMgPSBjbGFzc2VzID8gIi4iICsgY2xhc3Nlcy5zcGxpdCgiICIpLmpvaW4oIi4iKSA6ICIiOwogICAgICAgICAgcmV0dXJuIHZub2RlKGFwaS50YWdOYW1lKGVsbSkudG9Mb3dlckNhc2UoKSArIGlkICsgYywge30sIFtdLCB1bmRlZmluZWQsIGVsbSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gY3JlYXRlUm1DYihjaGlsZEVsbSwgbGlzdGVuZXJzKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gcm1DYigpIHsKICAgICAgICAgICAgICBpZiAoLS1saXN0ZW5lcnMgPT09IDApIHsKICAgICAgICAgICAgICAgICAgY29uc3QgcGFyZW50ID0gYXBpLnBhcmVudE5vZGUoY2hpbGRFbG0pOwogICAgICAgICAgICAgICAgICBhcGkucmVtb3ZlQ2hpbGQocGFyZW50LCBjaGlsZEVsbSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBjcmVhdGVFbG0odm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSkgewogICAgICAgICAgdmFyIF9hLCBfYjsKICAgICAgICAgIGxldCBpOwogICAgICAgICAgbGV0IGRhdGEgPSB2bm9kZS5kYXRhOwogICAgICAgICAgaWYgKGRhdGEgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIGNvbnN0IGluaXQgPSAoX2EgPSBkYXRhLmhvb2spID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbml0OwogICAgICAgICAgICAgIGlmIChpc0RlZihpbml0KSkgewogICAgICAgICAgICAgICAgICBpbml0KHZub2RlKTsKICAgICAgICAgICAgICAgICAgZGF0YSA9IHZub2RlLmRhdGE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgY29uc3QgY2hpbGRyZW4gPSB2bm9kZS5jaGlsZHJlbjsKICAgICAgICAgIGNvbnN0IHNlbCA9IHZub2RlLnNlbDsKICAgICAgICAgIGlmIChzZWwgPT09ICIhIikgewogICAgICAgICAgICAgIGlmIChpc1VuZGVmKHZub2RlLnRleHQpKSB7CiAgICAgICAgICAgICAgICAgIHZub2RlLnRleHQgPSAiIjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdm5vZGUuZWxtID0gYXBpLmNyZWF0ZUNvbW1lbnQodm5vZGUudGV4dCk7CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlIGlmIChzZWwgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIC8vIFBhcnNlIHNlbGVjdG9yCiAgICAgICAgICAgICAgY29uc3QgaGFzaElkeCA9IHNlbC5pbmRleE9mKCIjIik7CiAgICAgICAgICAgICAgY29uc3QgZG90SWR4ID0gc2VsLmluZGV4T2YoIi4iLCBoYXNoSWR4KTsKICAgICAgICAgICAgICBjb25zdCBoYXNoID0gaGFzaElkeCA+IDAgPyBoYXNoSWR4IDogc2VsLmxlbmd0aDsKICAgICAgICAgICAgICBjb25zdCBkb3QgPSBkb3RJZHggPiAwID8gZG90SWR4IDogc2VsLmxlbmd0aDsKICAgICAgICAgICAgICBjb25zdCB0YWcgPSBoYXNoSWR4ICE9PSAtMSB8fCBkb3RJZHggIT09IC0xCiAgICAgICAgICAgICAgICAgID8gc2VsLnNsaWNlKDAsIE1hdGgubWluKGhhc2gsIGRvdCkpCiAgICAgICAgICAgICAgICAgIDogc2VsOwogICAgICAgICAgICAgIGNvbnN0IGVsbSA9ICh2bm9kZS5lbG0gPQogICAgICAgICAgICAgICAgICBpc0RlZihkYXRhKSAmJiBpc0RlZigoaSA9IGRhdGEubnMpKQogICAgICAgICAgICAgICAgICAgICAgPyBhcGkuY3JlYXRlRWxlbWVudE5TKGksIHRhZywgZGF0YSkKICAgICAgICAgICAgICAgICAgICAgIDogYXBpLmNyZWF0ZUVsZW1lbnQodGFnLCBkYXRhKSk7CiAgICAgICAgICAgICAgaWYgKGhhc2ggPCBkb3QpCiAgICAgICAgICAgICAgICAgIGVsbS5zZXRBdHRyaWJ1dGUoImlkIiwgc2VsLnNsaWNlKGhhc2ggKyAxLCBkb3QpKTsKICAgICAgICAgICAgICBpZiAoZG90SWR4ID4gMCkKICAgICAgICAgICAgICAgICAgZWxtLnNldEF0dHJpYnV0ZSgiY2xhc3MiLCBzZWwuc2xpY2UoZG90ICsgMSkucmVwbGFjZSgvXC4vZywgIiAiKSk7CiAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGNicy5jcmVhdGUubGVuZ3RoOyArK2kpCiAgICAgICAgICAgICAgICAgIGNicy5jcmVhdGVbaV0oZW1wdHlOb2RlLCB2bm9kZSk7CiAgICAgICAgICAgICAgaWYgKGFycmF5KGNoaWxkcmVuKSkgewogICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoID0gY2hpbGRyZW5baV07CiAgICAgICAgICAgICAgICAgICAgICBpZiAoY2ggIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGFwaS5hcHBlbmRDaGlsZChlbG0sIGNyZWF0ZUVsbShjaCwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKSk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSBpZiAocHJpbWl0aXZlKHZub2RlLnRleHQpKSB7CiAgICAgICAgICAgICAgICAgIGFwaS5hcHBlbmRDaGlsZChlbG0sIGFwaS5jcmVhdGVUZXh0Tm9kZSh2bm9kZS50ZXh0KSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IGhvb2sgPSB2bm9kZS5kYXRhLmhvb2s7CiAgICAgICAgICAgICAgaWYgKGlzRGVmKGhvb2spKSB7CiAgICAgICAgICAgICAgICAgIChfYiA9IGhvb2suY3JlYXRlKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuY2FsbChob29rLCBlbXB0eU5vZGUsIHZub2RlKTsKICAgICAgICAgICAgICAgICAgaWYgKGhvb2suaW5zZXJ0KSB7CiAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRlZFZub2RlUXVldWUucHVzaCh2bm9kZSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICB2bm9kZS5lbG0gPSBhcGkuY3JlYXRlVGV4dE5vZGUodm5vZGUudGV4dCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdm5vZGUuZWxtOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGFkZFZub2RlcyhwYXJlbnRFbG0sIGJlZm9yZSwgdm5vZGVzLCBzdGFydElkeCwgZW5kSWR4LCBpbnNlcnRlZFZub2RlUXVldWUpIHsKICAgICAgICAgIGZvciAoOyBzdGFydElkeCA8PSBlbmRJZHg7ICsrc3RhcnRJZHgpIHsKICAgICAgICAgICAgICBjb25zdCBjaCA9IHZub2Rlc1tzdGFydElkeF07CiAgICAgICAgICAgICAgaWYgKGNoICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgYXBpLmluc2VydEJlZm9yZShwYXJlbnRFbG0sIGNyZWF0ZUVsbShjaCwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKSwgYmVmb3JlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gaW52b2tlRGVzdHJveUhvb2sodm5vZGUpIHsKICAgICAgICAgIHZhciBfYSwgX2I7CiAgICAgICAgICBjb25zdCBkYXRhID0gdm5vZGUuZGF0YTsKICAgICAgICAgIGlmIChkYXRhICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAoX2IgPSAoX2EgPSBkYXRhID09PSBudWxsIHx8IGRhdGEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRhdGEuaG9vaykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmRlc3Ryb3kpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5jYWxsKF9hLCB2bm9kZSk7CiAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjYnMuZGVzdHJveS5sZW5ndGg7ICsraSkKICAgICAgICAgICAgICAgICAgY2JzLmRlc3Ryb3lbaV0odm5vZGUpOwogICAgICAgICAgICAgIGlmICh2bm9kZS5jaGlsZHJlbiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdm5vZGUuY2hpbGRyZW4ubGVuZ3RoOyArK2opIHsKICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkID0gdm5vZGUuY2hpbGRyZW5bal07CiAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGQgIT0gbnVsbCAmJiB0eXBlb2YgY2hpbGQgIT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaW52b2tlRGVzdHJveUhvb2soY2hpbGQpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIHJlbW92ZVZub2RlcyhwYXJlbnRFbG0sIHZub2Rlcywgc3RhcnRJZHgsIGVuZElkeCkgewogICAgICAgICAgdmFyIF9hLCBfYjsKICAgICAgICAgIGZvciAoOyBzdGFydElkeCA8PSBlbmRJZHg7ICsrc3RhcnRJZHgpIHsKICAgICAgICAgICAgICBsZXQgbGlzdGVuZXJzOwogICAgICAgICAgICAgIGxldCBybTsKICAgICAgICAgICAgICBjb25zdCBjaCA9IHZub2Rlc1tzdGFydElkeF07CiAgICAgICAgICAgICAgaWYgKGNoICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgaWYgKGlzRGVmKGNoLnNlbCkpIHsKICAgICAgICAgICAgICAgICAgICAgIGludm9rZURlc3Ryb3lIb29rKGNoKTsKICAgICAgICAgICAgICAgICAgICAgIGxpc3RlbmVycyA9IGNicy5yZW1vdmUubGVuZ3RoICsgMTsKICAgICAgICAgICAgICAgICAgICAgIHJtID0gY3JlYXRlUm1DYihjaC5lbG0sIGxpc3RlbmVycyk7CiAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNicy5yZW1vdmUubGVuZ3RoOyArK2kpCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2JzLnJlbW92ZVtpXShjaCwgcm0pOwogICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVtb3ZlSG9vayA9IChfYiA9IChfYSA9IGNoID09PSBudWxsIHx8IGNoID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjaC5kYXRhKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaG9vaykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnJlbW92ZTsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0RlZihyZW1vdmVIb29rKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZUhvb2soY2gsIHJtKTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJtKCk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAvLyBUZXh0IG5vZGUKICAgICAgICAgICAgICAgICAgICAgIGFwaS5yZW1vdmVDaGlsZChwYXJlbnRFbG0sIGNoLmVsbSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gdXBkYXRlQ2hpbGRyZW4ocGFyZW50RWxtLCBvbGRDaCwgbmV3Q2gsIGluc2VydGVkVm5vZGVRdWV1ZSkgewogICAgICAgICAgbGV0IG9sZFN0YXJ0SWR4ID0gMDsKICAgICAgICAgIGxldCBuZXdTdGFydElkeCA9IDA7CiAgICAgICAgICBsZXQgb2xkRW5kSWR4ID0gb2xkQ2gubGVuZ3RoIC0gMTsKICAgICAgICAgIGxldCBvbGRTdGFydFZub2RlID0gb2xkQ2hbMF07CiAgICAgICAgICBsZXQgb2xkRW5kVm5vZGUgPSBvbGRDaFtvbGRFbmRJZHhdOwogICAgICAgICAgbGV0IG5ld0VuZElkeCA9IG5ld0NoLmxlbmd0aCAtIDE7CiAgICAgICAgICBsZXQgbmV3U3RhcnRWbm9kZSA9IG5ld0NoWzBdOwogICAgICAgICAgbGV0IG5ld0VuZFZub2RlID0gbmV3Q2hbbmV3RW5kSWR4XTsKICAgICAgICAgIGxldCBvbGRLZXlUb0lkeDsKICAgICAgICAgIGxldCBpZHhJbk9sZDsKICAgICAgICAgIGxldCBlbG1Ub01vdmU7CiAgICAgICAgICBsZXQgYmVmb3JlOwogICAgICAgICAgd2hpbGUgKG9sZFN0YXJ0SWR4IDw9IG9sZEVuZElkeCAmJiBuZXdTdGFydElkeCA8PSBuZXdFbmRJZHgpIHsKICAgICAgICAgICAgICBpZiAob2xkU3RhcnRWbm9kZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIG9sZFN0YXJ0Vm5vZGUgPSBvbGRDaFsrK29sZFN0YXJ0SWR4XTsgLy8gVm5vZGUgbWlnaHQgaGF2ZSBiZWVuIG1vdmVkIGxlZnQKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSBpZiAob2xkRW5kVm5vZGUgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICBvbGRFbmRWbm9kZSA9IG9sZENoWy0tb2xkRW5kSWR4XTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSBpZiAobmV3U3RhcnRWbm9kZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIG5ld1N0YXJ0Vm5vZGUgPSBuZXdDaFsrK25ld1N0YXJ0SWR4XTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSBpZiAobmV3RW5kVm5vZGUgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICBuZXdFbmRWbm9kZSA9IG5ld0NoWy0tbmV3RW5kSWR4XTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSBpZiAoc2FtZVZub2RlKG9sZFN0YXJ0Vm5vZGUsIG5ld1N0YXJ0Vm5vZGUpKSB7CiAgICAgICAgICAgICAgICAgIHBhdGNoVm5vZGUob2xkU3RhcnRWbm9kZSwgbmV3U3RhcnRWbm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKTsKICAgICAgICAgICAgICAgICAgb2xkU3RhcnRWbm9kZSA9IG9sZENoWysrb2xkU3RhcnRJZHhdOwogICAgICAgICAgICAgICAgICBuZXdTdGFydFZub2RlID0gbmV3Q2hbKytuZXdTdGFydElkeF07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGVsc2UgaWYgKHNhbWVWbm9kZShvbGRFbmRWbm9kZSwgbmV3RW5kVm5vZGUpKSB7CiAgICAgICAgICAgICAgICAgIHBhdGNoVm5vZGUob2xkRW5kVm5vZGUsIG5ld0VuZFZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUpOwogICAgICAgICAgICAgICAgICBvbGRFbmRWbm9kZSA9IG9sZENoWy0tb2xkRW5kSWR4XTsKICAgICAgICAgICAgICAgICAgbmV3RW5kVm5vZGUgPSBuZXdDaFstLW5ld0VuZElkeF07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGVsc2UgaWYgKHNhbWVWbm9kZShvbGRTdGFydFZub2RlLCBuZXdFbmRWbm9kZSkpIHsKICAgICAgICAgICAgICAgICAgLy8gVm5vZGUgbW92ZWQgcmlnaHQKICAgICAgICAgICAgICAgICAgcGF0Y2hWbm9kZShvbGRTdGFydFZub2RlLCBuZXdFbmRWbm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKTsKICAgICAgICAgICAgICAgICAgYXBpLmluc2VydEJlZm9yZShwYXJlbnRFbG0sIG9sZFN0YXJ0Vm5vZGUuZWxtLCBhcGkubmV4dFNpYmxpbmcob2xkRW5kVm5vZGUuZWxtKSk7CiAgICAgICAgICAgICAgICAgIG9sZFN0YXJ0Vm5vZGUgPSBvbGRDaFsrK29sZFN0YXJ0SWR4XTsKICAgICAgICAgICAgICAgICAgbmV3RW5kVm5vZGUgPSBuZXdDaFstLW5ld0VuZElkeF07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGVsc2UgaWYgKHNhbWVWbm9kZShvbGRFbmRWbm9kZSwgbmV3U3RhcnRWbm9kZSkpIHsKICAgICAgICAgICAgICAgICAgLy8gVm5vZGUgbW92ZWQgbGVmdAogICAgICAgICAgICAgICAgICBwYXRjaFZub2RlKG9sZEVuZFZub2RlLCBuZXdTdGFydFZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUpOwogICAgICAgICAgICAgICAgICBhcGkuaW5zZXJ0QmVmb3JlKHBhcmVudEVsbSwgb2xkRW5kVm5vZGUuZWxtLCBvbGRTdGFydFZub2RlLmVsbSk7CiAgICAgICAgICAgICAgICAgIG9sZEVuZFZub2RlID0gb2xkQ2hbLS1vbGRFbmRJZHhdOwogICAgICAgICAgICAgICAgICBuZXdTdGFydFZub2RlID0gbmV3Q2hbKytuZXdTdGFydElkeF07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICBpZiAob2xkS2V5VG9JZHggPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgb2xkS2V5VG9JZHggPSBjcmVhdGVLZXlUb09sZElkeChvbGRDaCwgb2xkU3RhcnRJZHgsIG9sZEVuZElkeCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgaWR4SW5PbGQgPSBvbGRLZXlUb0lkeFtuZXdTdGFydFZub2RlLmtleV07CiAgICAgICAgICAgICAgICAgIGlmIChpc1VuZGVmKGlkeEluT2xkKSkgewogICAgICAgICAgICAgICAgICAgICAgLy8gTmV3IGVsZW1lbnQKICAgICAgICAgICAgICAgICAgICAgIGFwaS5pbnNlcnRCZWZvcmUocGFyZW50RWxtLCBjcmVhdGVFbG0obmV3U3RhcnRWbm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKSwgb2xkU3RhcnRWbm9kZS5lbG0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgZWxtVG9Nb3ZlID0gb2xkQ2hbaWR4SW5PbGRdOwogICAgICAgICAgICAgICAgICAgICAgaWYgKGVsbVRvTW92ZS5zZWwgIT09IG5ld1N0YXJ0Vm5vZGUuc2VsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYXBpLmluc2VydEJlZm9yZShwYXJlbnRFbG0sIGNyZWF0ZUVsbShuZXdTdGFydFZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUpLCBvbGRTdGFydFZub2RlLmVsbSk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRjaFZub2RlKGVsbVRvTW92ZSwgbmV3U3RhcnRWbm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRDaFtpZHhJbk9sZF0gPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYXBpLmluc2VydEJlZm9yZShwYXJlbnRFbG0sIGVsbVRvTW92ZS5lbG0sIG9sZFN0YXJ0Vm5vZGUuZWxtKTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBuZXdTdGFydFZub2RlID0gbmV3Q2hbKytuZXdTdGFydElkeF07CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKG9sZFN0YXJ0SWR4IDw9IG9sZEVuZElkeCB8fCBuZXdTdGFydElkeCA8PSBuZXdFbmRJZHgpIHsKICAgICAgICAgICAgICBpZiAob2xkU3RhcnRJZHggPiBvbGRFbmRJZHgpIHsKICAgICAgICAgICAgICAgICAgYmVmb3JlID0gbmV3Q2hbbmV3RW5kSWR4ICsgMV0gPT0gbnVsbCA/IG51bGwgOiBuZXdDaFtuZXdFbmRJZHggKyAxXS5lbG07CiAgICAgICAgICAgICAgICAgIGFkZFZub2RlcyhwYXJlbnRFbG0sIGJlZm9yZSwgbmV3Q2gsIG5ld1N0YXJ0SWR4LCBuZXdFbmRJZHgsIGluc2VydGVkVm5vZGVRdWV1ZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICByZW1vdmVWbm9kZXMocGFyZW50RWxtLCBvbGRDaCwgb2xkU3RhcnRJZHgsIG9sZEVuZElkeCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIHBhdGNoVm5vZGUob2xkVm5vZGUsIHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUpIHsKICAgICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2U7CiAgICAgICAgICBjb25zdCBob29rID0gKF9hID0gdm5vZGUuZGF0YSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmhvb2s7CiAgICAgICAgICAoX2IgPSBob29rID09PSBudWxsIHx8IGhvb2sgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGhvb2sucHJlcGF0Y2gpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5jYWxsKGhvb2ssIG9sZFZub2RlLCB2bm9kZSk7CiAgICAgICAgICBjb25zdCBlbG0gPSAodm5vZGUuZWxtID0gb2xkVm5vZGUuZWxtKTsKICAgICAgICAgIGNvbnN0IG9sZENoID0gb2xkVm5vZGUuY2hpbGRyZW47CiAgICAgICAgICBjb25zdCBjaCA9IHZub2RlLmNoaWxkcmVuOwogICAgICAgICAgaWYgKG9sZFZub2RlID09PSB2bm9kZSkKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICBpZiAodm5vZGUuZGF0YSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjYnMudXBkYXRlLmxlbmd0aDsgKytpKQogICAgICAgICAgICAgICAgICBjYnMudXBkYXRlW2ldKG9sZFZub2RlLCB2bm9kZSk7CiAgICAgICAgICAgICAgKF9kID0gKF9jID0gdm5vZGUuZGF0YS5ob29rKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MudXBkYXRlKSA9PT0gbnVsbCB8fCBfZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2QuY2FsbChfYywgb2xkVm5vZGUsIHZub2RlKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChpc1VuZGVmKHZub2RlLnRleHQpKSB7CiAgICAgICAgICAgICAgaWYgKGlzRGVmKG9sZENoKSAmJiBpc0RlZihjaCkpIHsKICAgICAgICAgICAgICAgICAgaWYgKG9sZENoICE9PSBjaCkKICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZUNoaWxkcmVuKGVsbSwgb2xkQ2gsIGNoLCBpbnNlcnRlZFZub2RlUXVldWUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIGlmIChpc0RlZihjaCkpIHsKICAgICAgICAgICAgICAgICAgaWYgKGlzRGVmKG9sZFZub2RlLnRleHQpKQogICAgICAgICAgICAgICAgICAgICAgYXBpLnNldFRleHRDb250ZW50KGVsbSwgIiIpOwogICAgICAgICAgICAgICAgICBhZGRWbm9kZXMoZWxtLCBudWxsLCBjaCwgMCwgY2gubGVuZ3RoIC0gMSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSBpZiAoaXNEZWYob2xkQ2gpKSB7CiAgICAgICAgICAgICAgICAgIHJlbW92ZVZub2RlcyhlbG0sIG9sZENoLCAwLCBvbGRDaC5sZW5ndGggLSAxKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSBpZiAoaXNEZWYob2xkVm5vZGUudGV4dCkpIHsKICAgICAgICAgICAgICAgICAgYXBpLnNldFRleHRDb250ZW50KGVsbSwgIiIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgaWYgKG9sZFZub2RlLnRleHQgIT09IHZub2RlLnRleHQpIHsKICAgICAgICAgICAgICBpZiAoaXNEZWYob2xkQ2gpKSB7CiAgICAgICAgICAgICAgICAgIHJlbW92ZVZub2RlcyhlbG0sIG9sZENoLCAwLCBvbGRDaC5sZW5ndGggLSAxKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYXBpLnNldFRleHRDb250ZW50KGVsbSwgdm5vZGUudGV4dCk7CiAgICAgICAgICB9CiAgICAgICAgICAoX2UgPSBob29rID09PSBudWxsIHx8IGhvb2sgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGhvb2sucG9zdHBhdGNoKSA9PT0gbnVsbCB8fCBfZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2UuY2FsbChob29rLCBvbGRWbm9kZSwgdm5vZGUpOwogICAgICB9CiAgICAgIHJldHVybiBmdW5jdGlvbiBwYXRjaChvbGRWbm9kZSwgdm5vZGUpIHsKICAgICAgICAgIGxldCBpLCBlbG0sIHBhcmVudDsKICAgICAgICAgIGNvbnN0IGluc2VydGVkVm5vZGVRdWV1ZSA9IFtdOwogICAgICAgICAgZm9yIChpID0gMDsgaSA8IGNicy5wcmUubGVuZ3RoOyArK2kpCiAgICAgICAgICAgICAgY2JzLnByZVtpXSgpOwogICAgICAgICAgaWYgKCFpc1Zub2RlKG9sZFZub2RlKSkgewogICAgICAgICAgICAgIG9sZFZub2RlID0gZW1wdHlOb2RlQXQob2xkVm5vZGUpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHNhbWVWbm9kZShvbGRWbm9kZSwgdm5vZGUpKSB7CiAgICAgICAgICAgICAgcGF0Y2hWbm9kZShvbGRWbm9kZSwgdm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSk7CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICBlbG0gPSBvbGRWbm9kZS5lbG07CiAgICAgICAgICAgICAgcGFyZW50ID0gYXBpLnBhcmVudE5vZGUoZWxtKTsKICAgICAgICAgICAgICBjcmVhdGVFbG0odm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSk7CiAgICAgICAgICAgICAgaWYgKHBhcmVudCAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICBhcGkuaW5zZXJ0QmVmb3JlKHBhcmVudCwgdm5vZGUuZWxtLCBhcGkubmV4dFNpYmxpbmcoZWxtKSk7CiAgICAgICAgICAgICAgICAgIHJlbW92ZVZub2RlcyhwYXJlbnQsIFtvbGRWbm9kZV0sIDAsIDApOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBpbnNlcnRlZFZub2RlUXVldWUubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgICBpbnNlcnRlZFZub2RlUXVldWVbaV0uZGF0YS5ob29rLmluc2VydChpbnNlcnRlZFZub2RlUXVldWVbaV0pOwogICAgICAgICAgfQogICAgICAgICAgZm9yIChpID0gMDsgaSA8IGNicy5wb3N0Lmxlbmd0aDsgKytpKQogICAgICAgICAgICAgIGNicy5wb3N0W2ldKCk7CiAgICAgICAgICByZXR1cm4gdm5vZGU7CiAgICAgIH07CiAgfQoKICBmdW5jdGlvbiBhZGROUyhkYXRhLCBjaGlsZHJlbiwgc2VsKSB7CiAgICAgIGRhdGEubnMgPSAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciOwogICAgICBpZiAoc2VsICE9PSAiZm9yZWlnbk9iamVjdCIgJiYgY2hpbGRyZW4gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgIGNvbnN0IGNoaWxkRGF0YSA9IGNoaWxkcmVuW2ldLmRhdGE7CiAgICAgICAgICAgICAgaWYgKGNoaWxkRGF0YSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgIGFkZE5TKGNoaWxkRGF0YSwgY2hpbGRyZW5baV0uY2hpbGRyZW4sIGNoaWxkcmVuW2ldLnNlbCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICB9CiAgfQogIGZ1bmN0aW9uIGgoc2VsLCBiLCBjKSB7CiAgICAgIGxldCBkYXRhID0ge307CiAgICAgIGxldCBjaGlsZHJlbjsKICAgICAgbGV0IHRleHQ7CiAgICAgIGxldCBpOwogICAgICBpZiAoYyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBpZiAoYiAhPT0gbnVsbCkgewogICAgICAgICAgICAgIGRhdGEgPSBiOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGFycmF5KGMpKSB7CiAgICAgICAgICAgICAgY2hpbGRyZW4gPSBjOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSBpZiAocHJpbWl0aXZlKGMpKSB7CiAgICAgICAgICAgICAgdGV4dCA9IGMudG9TdHJpbmcoKTsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgaWYgKGMgJiYgYy5zZWwpIHsKICAgICAgICAgICAgICBjaGlsZHJlbiA9IFtjXTsKICAgICAgICAgIH0KICAgICAgfQogICAgICBlbHNlIGlmIChiICE9PSB1bmRlZmluZWQgJiYgYiAhPT0gbnVsbCkgewogICAgICAgICAgaWYgKGFycmF5KGIpKSB7CiAgICAgICAgICAgICAgY2hpbGRyZW4gPSBiOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSBpZiAocHJpbWl0aXZlKGIpKSB7CiAgICAgICAgICAgICAgdGV4dCA9IGIudG9TdHJpbmcoKTsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgaWYgKGIgJiYgYi5zZWwpIHsKICAgICAgICAgICAgICBjaGlsZHJlbiA9IFtiXTsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIGRhdGEgPSBiOwogICAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChjaGlsZHJlbiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgICBpZiAocHJpbWl0aXZlKGNoaWxkcmVuW2ldKSkKICAgICAgICAgICAgICAgICAgY2hpbGRyZW5baV0gPSB2bm9kZSh1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBjaGlsZHJlbltpXSwgdW5kZWZpbmVkKTsKICAgICAgICAgIH0KICAgICAgfQogICAgICBpZiAoc2VsWzBdID09PSAicyIgJiYKICAgICAgICAgIHNlbFsxXSA9PT0gInYiICYmCiAgICAgICAgICBzZWxbMl0gPT09ICJnIiAmJgogICAgICAgICAgKHNlbC5sZW5ndGggPT09IDMgfHwgc2VsWzNdID09PSAiLiIgfHwgc2VsWzNdID09PSAiIyIpKSB7CiAgICAgICAgICBhZGROUyhkYXRhLCBjaGlsZHJlbiwgc2VsKTsKICAgICAgfQogICAgICByZXR1cm4gdm5vZGUoc2VsLCBkYXRhLCBjaGlsZHJlbiwgdGV4dCwgdW5kZWZpbmVkKTsKICB9CgogIGZ1bmN0aW9uIGNvcHlUb1RodW5rKHZub2RlLCB0aHVuaykgewogICAgICB2bm9kZS5kYXRhLmZuID0gdGh1bmsuZGF0YS5mbjsKICAgICAgdm5vZGUuZGF0YS5hcmdzID0gdGh1bmsuZGF0YS5hcmdzOwogICAgICB0aHVuay5kYXRhID0gdm5vZGUuZGF0YTsKICAgICAgdGh1bmsuY2hpbGRyZW4gPSB2bm9kZS5jaGlsZHJlbjsKICAgICAgdGh1bmsudGV4dCA9IHZub2RlLnRleHQ7CiAgICAgIHRodW5rLmVsbSA9IHZub2RlLmVsbTsKICB9CiAgZnVuY3Rpb24gaW5pdCh0aHVuaykgewogICAgICBjb25zdCBjdXIgPSB0aHVuay5kYXRhOwogICAgICBjb25zdCB2bm9kZSA9IGN1ci5mbiguLi5jdXIuYXJncyk7CiAgICAgIGNvcHlUb1RodW5rKHZub2RlLCB0aHVuayk7CiAgfQogIGZ1bmN0aW9uIHByZXBhdGNoKG9sZFZub2RlLCB0aHVuaykgewogICAgICBsZXQgaTsKICAgICAgY29uc3Qgb2xkID0gb2xkVm5vZGUuZGF0YTsKICAgICAgY29uc3QgY3VyID0gdGh1bmsuZGF0YTsKICAgICAgY29uc3Qgb2xkQXJncyA9IG9sZC5hcmdzOwogICAgICBjb25zdCBhcmdzID0gY3VyLmFyZ3M7CiAgICAgIGlmIChvbGQuZm4gIT09IGN1ci5mbiB8fCBvbGRBcmdzLmxlbmd0aCAhPT0gYXJncy5sZW5ndGgpIHsKICAgICAgICAgIGNvcHlUb1RodW5rKGN1ci5mbiguLi5hcmdzKSwgdGh1bmspOwogICAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGZvciAoaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICBpZiAob2xkQXJnc1tpXSAhPT0gYXJnc1tpXSkgewogICAgICAgICAgICAgIGNvcHlUb1RodW5rKGN1ci5mbiguLi5hcmdzKSwgdGh1bmspOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgfQogICAgICBjb3B5VG9UaHVuayhvbGRWbm9kZSwgdGh1bmspOwogIH0KICBjb25zdCB0aHVuayA9IGZ1bmN0aW9uIHRodW5rKHNlbCwga2V5LCBmbiwgYXJncykgewogICAgICBpZiAoYXJncyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBhcmdzID0gZm47CiAgICAgICAgICBmbiA9IGtleTsKICAgICAgICAgIGtleSA9IHVuZGVmaW5lZDsKICAgICAgfQogICAgICByZXR1cm4gaChzZWwsIHsKICAgICAgICAgIGtleToga2V5LAogICAgICAgICAgaG9vazogeyBpbml0LCBwcmVwYXRjaCB9LAogICAgICAgICAgZm46IGZuLAogICAgICAgICAgYXJnczogYXJncywKICAgICAgfSk7CiAgfTsKCiAgZnVuY3Rpb24gcHJlKHZub2RlLCBuZXdWbm9kZSkgewogICAgICBjb25zdCBhdHRhY2hEYXRhID0gdm5vZGUuZGF0YS5hdHRhY2hEYXRhOwogICAgICAvLyBDb3B5IGNyZWF0ZWQgcGxhY2Vob2xkZXIgYW5kIHJlYWwgZWxlbWVudCBmcm9tIG9sZCB2bm9kZQogICAgICBuZXdWbm9kZS5kYXRhLmF0dGFjaERhdGEucGxhY2Vob2xkZXIgPSBhdHRhY2hEYXRhLnBsYWNlaG9sZGVyOwogICAgICBuZXdWbm9kZS5kYXRhLmF0dGFjaERhdGEucmVhbCA9IGF0dGFjaERhdGEucmVhbDsKICAgICAgLy8gTW91bnQgcmVhbCBlbGVtZW50IGluIHZub2RlIHNvIHRoZSBwYXRjaCBwcm9jZXNzIG9wZXJhdGVzIG9uIGl0CiAgICAgIHZub2RlLmVsbSA9IHZub2RlLmRhdGEuYXR0YWNoRGF0YS5yZWFsOwogIH0KICBmdW5jdGlvbiBwb3N0KF8sIHZub2RlKSB7CiAgICAgIC8vIE1vdW50IGR1bW15IHBsYWNlaG9sZGVyIGluIHZub2RlIHNvIHBvdGVudGlhbCByZW9yZGVycyB1c2UgaXQKICAgICAgdm5vZGUuZWxtID0gdm5vZGUuZGF0YS5hdHRhY2hEYXRhLnBsYWNlaG9sZGVyOwogIH0KICBmdW5jdGlvbiBkZXN0cm95KHZub2RlKSB7CiAgICAgIC8vIFJlbW92ZSBwbGFjZWhvbGRlcgogICAgICBpZiAodm5vZGUuZWxtICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHZub2RlLmVsbS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHZub2RlLmVsbSk7CiAgICAgIH0KICAgICAgLy8gUmVtb3ZlIHJlYWwgZWxlbWVudCBmcm9tIHdoZXJlIGl0IHdhcyBpbnNlcnRlZAogICAgICB2bm9kZS5lbG0gPSB2bm9kZS5kYXRhLmF0dGFjaERhdGEucmVhbDsKICB9CiAgZnVuY3Rpb24gY3JlYXRlKF8sIHZub2RlKSB7CiAgICAgIGNvbnN0IHJlYWwgPSB2bm9kZS5lbG07CiAgICAgIGNvbnN0IGF0dGFjaERhdGEgPSB2bm9kZS5kYXRhLmF0dGFjaERhdGE7CiAgICAgIGNvbnN0IHBsYWNlaG9sZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpOwogICAgICAvLyBSZXBsYWNlIGFjdHVhbCBlbGVtZW50IHdpdGggZHVtbXkgcGxhY2Vob2xkZXIKICAgICAgLy8gU25hYmJkb20gd2lsbCB0aGVuIGluc2VydCBwbGFjZWhvbGRlciBpbnN0ZWFkCiAgICAgIHZub2RlLmVsbSA9IHBsYWNlaG9sZGVyOwogICAgICBhdHRhY2hEYXRhLnRhcmdldC5hcHBlbmRDaGlsZChyZWFsKTsKICAgICAgYXR0YWNoRGF0YS5yZWFsID0gcmVhbDsKICAgICAgYXR0YWNoRGF0YS5wbGFjZWhvbGRlciA9IHBsYWNlaG9sZGVyOwogIH0KICBmdW5jdGlvbiBhdHRhY2hUbyh0YXJnZXQsIHZub2RlKSB7CiAgICAgIGlmICh2bm9kZS5kYXRhID09PSB1bmRlZmluZWQpCiAgICAgICAgICB2bm9kZS5kYXRhID0ge307CiAgICAgIGlmICh2bm9kZS5kYXRhLmhvb2sgPT09IHVuZGVmaW5lZCkKICAgICAgICAgIHZub2RlLmRhdGEuaG9vayA9IHt9OwogICAgICBjb25zdCBkYXRhID0gdm5vZGUuZGF0YTsKICAgICAgY29uc3QgaG9vayA9IHZub2RlLmRhdGEuaG9vazsKICAgICAgZGF0YS5hdHRhY2hEYXRhID0geyB0YXJnZXQ6IHRhcmdldCwgcGxhY2Vob2xkZXI6IHVuZGVmaW5lZCwgcmVhbDogdW5kZWZpbmVkIH07CiAgICAgIGhvb2suY3JlYXRlID0gY3JlYXRlOwogICAgICBob29rLnByZXBhdGNoID0gcHJlOwogICAgICBob29rLnBvc3RwYXRjaCA9IHBvc3Q7CiAgICAgIGhvb2suZGVzdHJveSA9IGRlc3Ryb3k7CiAgICAgIHJldHVybiB2bm9kZTsKICB9CgogIGZ1bmN0aW9uIHRvVk5vZGUobm9kZSwgZG9tQXBpKSB7CiAgICAgIGNvbnN0IGFwaSA9IGRvbUFwaSAhPT0gdW5kZWZpbmVkID8gZG9tQXBpIDogaHRtbERvbUFwaTsKICAgICAgbGV0IHRleHQ7CiAgICAgIGlmIChhcGkuaXNFbGVtZW50KG5vZGUpKSB7CiAgICAgICAgICBjb25zdCBpZCA9IG5vZGUuaWQgPyAiIyIgKyBub2RlLmlkIDogIiI7CiAgICAgICAgICBjb25zdCBjbiA9IG5vZGUuZ2V0QXR0cmlidXRlKCJjbGFzcyIpOwogICAgICAgICAgY29uc3QgYyA9IGNuID8gIi4iICsgY24uc3BsaXQoIiAiKS5qb2luKCIuIikgOiAiIjsKICAgICAgICAgIGNvbnN0IHNlbCA9IGFwaS50YWdOYW1lKG5vZGUpLnRvTG93ZXJDYXNlKCkgKyBpZCArIGM7CiAgICAgICAgICBjb25zdCBhdHRycyA9IHt9OwogICAgICAgICAgY29uc3QgY2hpbGRyZW4gPSBbXTsKICAgICAgICAgIGxldCBuYW1lOwogICAgICAgICAgbGV0IGksIG47CiAgICAgICAgICBjb25zdCBlbG1BdHRycyA9IG5vZGUuYXR0cmlidXRlczsKICAgICAgICAgIGNvbnN0IGVsbUNoaWxkcmVuID0gbm9kZS5jaGlsZE5vZGVzOwogICAgICAgICAgZm9yIChpID0gMCwgbiA9IGVsbUF0dHJzLmxlbmd0aDsgaSA8IG47IGkrKykgewogICAgICAgICAgICAgIG5hbWUgPSBlbG1BdHRyc1tpXS5ub2RlTmFtZTsKICAgICAgICAgICAgICBpZiAobmFtZSAhPT0gImlkIiAmJiBuYW1lICE9PSAiY2xhc3MiKSB7CiAgICAgICAgICAgICAgICAgIGF0dHJzW25hbWVdID0gZWxtQXR0cnNbaV0ubm9kZVZhbHVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGZvciAoaSA9IDAsIG4gPSBlbG1DaGlsZHJlbi5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKHRvVk5vZGUoZWxtQ2hpbGRyZW5baV0sIGRvbUFwaSkpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHZub2RlKHNlbCwgeyBhdHRycyB9LCBjaGlsZHJlbiwgdW5kZWZpbmVkLCBub2RlKTsKICAgICAgfQogICAgICBlbHNlIGlmIChhcGkuaXNUZXh0KG5vZGUpKSB7CiAgICAgICAgICB0ZXh0ID0gYXBpLmdldFRleHRDb250ZW50KG5vZGUpOwogICAgICAgICAgcmV0dXJuIHZub2RlKHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHRleHQsIG5vZGUpOwogICAgICB9CiAgICAgIGVsc2UgaWYgKGFwaS5pc0NvbW1lbnQobm9kZSkpIHsKICAgICAgICAgIHRleHQgPSBhcGkuZ2V0VGV4dENvbnRlbnQobm9kZSk7CiAgICAgICAgICByZXR1cm4gdm5vZGUoIiEiLCB7fSwgW10sIHRleHQsIG5vZGUpOwogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgICAgcmV0dXJuIHZub2RlKCIiLCB7fSwgW10sIHVuZGVmaW5lZCwgbm9kZSk7CiAgICAgIH0KICB9CgogIGNvbnN0IHhsaW5rTlMgPSAiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI7CiAgY29uc3QgeG1sTlMgPSAiaHR0cDovL3d3dy53My5vcmcvWE1MLzE5OTgvbmFtZXNwYWNlIjsKICBjb25zdCBjb2xvbkNoYXIgPSA1ODsKICBjb25zdCB4Q2hhciA9IDEyMDsKICBmdW5jdGlvbiB1cGRhdGVBdHRycyhvbGRWbm9kZSwgdm5vZGUpIHsKICAgICAgbGV0IGtleTsKICAgICAgY29uc3QgZWxtID0gdm5vZGUuZWxtOwogICAgICBsZXQgb2xkQXR0cnMgPSBvbGRWbm9kZS5kYXRhLmF0dHJzOwogICAgICBsZXQgYXR0cnMgPSB2bm9kZS5kYXRhLmF0dHJzOwogICAgICBpZiAoIW9sZEF0dHJzICYmICFhdHRycykKICAgICAgICAgIHJldHVybjsKICAgICAgaWYgKG9sZEF0dHJzID09PSBhdHRycykKICAgICAgICAgIHJldHVybjsKICAgICAgb2xkQXR0cnMgPSBvbGRBdHRycyB8fCB7fTsKICAgICAgYXR0cnMgPSBhdHRycyB8fCB7fTsKICAgICAgLy8gdXBkYXRlIG1vZGlmaWVkIGF0dHJpYnV0ZXMsIGFkZCBuZXcgYXR0cmlidXRlcwogICAgICBmb3IgKGtleSBpbiBhdHRycykgewogICAgICAgICAgY29uc3QgY3VyID0gYXR0cnNba2V5XTsKICAgICAgICAgIGNvbnN0IG9sZCA9IG9sZEF0dHJzW2tleV07CiAgICAgICAgICBpZiAob2xkICE9PSBjdXIpIHsKICAgICAgICAgICAgICBpZiAoY3VyID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgIGVsbS5zZXRBdHRyaWJ1dGUoa2V5LCAiIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGVsc2UgaWYgKGN1ciA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgZWxtLnJlbW92ZUF0dHJpYnV0ZShrZXkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgaWYgKGtleS5jaGFyQ29kZUF0KDApICE9PSB4Q2hhcikgewogICAgICAgICAgICAgICAgICAgICAgZWxtLnNldEF0dHJpYnV0ZShrZXksIGN1cik7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoa2V5LmNoYXJDb2RlQXQoMykgPT09IGNvbG9uQ2hhcikgewogICAgICAgICAgICAgICAgICAgICAgLy8gQXNzdW1lIHhtbCBuYW1lc3BhY2UKICAgICAgICAgICAgICAgICAgICAgIGVsbS5zZXRBdHRyaWJ1dGVOUyh4bWxOUywga2V5LCBjdXIpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGtleS5jaGFyQ29kZUF0KDUpID09PSBjb2xvbkNoYXIpIHsKICAgICAgICAgICAgICAgICAgICAgIC8vIEFzc3VtZSB4bGluayBuYW1lc3BhY2UKICAgICAgICAgICAgICAgICAgICAgIGVsbS5zZXRBdHRyaWJ1dGVOUyh4bGlua05TLCBrZXksIGN1cik7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICBlbG0uc2V0QXR0cmlidXRlKGtleSwgY3VyKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgfQogICAgICAvLyByZW1vdmUgcmVtb3ZlZCBhdHRyaWJ1dGVzCiAgICAgIC8vIHVzZSBgaW5gIG9wZXJhdG9yIHNpbmNlIHRoZSBwcmV2aW91cyBgZm9yYCBpdGVyYXRpb24gdXNlcyBpdCAoLmkuZS4gYWRkIGV2ZW4gYXR0cmlidXRlcyB3aXRoIHVuZGVmaW5lZCB2YWx1ZSkKICAgICAgLy8gdGhlIG90aGVyIG9wdGlvbiBpcyB0byByZW1vdmUgYWxsIGF0dHJpYnV0ZXMgd2l0aCB2YWx1ZSA9PSB1bmRlZmluZWQKICAgICAgZm9yIChrZXkgaW4gb2xkQXR0cnMpIHsKICAgICAgICAgIGlmICghKGtleSBpbiBhdHRycykpIHsKICAgICAgICAgICAgICBlbG0ucmVtb3ZlQXR0cmlidXRlKGtleSk7CiAgICAgICAgICB9CiAgICAgIH0KICB9CiAgY29uc3QgYXR0cmlidXRlc01vZHVsZSA9IHsKICAgICAgY3JlYXRlOiB1cGRhdGVBdHRycywKICAgICAgdXBkYXRlOiB1cGRhdGVBdHRycywKICB9OwoKICBmdW5jdGlvbiB1cGRhdGVDbGFzcyhvbGRWbm9kZSwgdm5vZGUpIHsKICAgICAgbGV0IGN1cjsKICAgICAgbGV0IG5hbWU7CiAgICAgIGNvbnN0IGVsbSA9IHZub2RlLmVsbTsKICAgICAgbGV0IG9sZENsYXNzID0gb2xkVm5vZGUuZGF0YS5jbGFzczsKICAgICAgbGV0IGtsYXNzID0gdm5vZGUuZGF0YS5jbGFzczsKICAgICAgaWYgKCFvbGRDbGFzcyAmJiAha2xhc3MpCiAgICAgICAgICByZXR1cm47CiAgICAgIGlmIChvbGRDbGFzcyA9PT0ga2xhc3MpCiAgICAgICAgICByZXR1cm47CiAgICAgIG9sZENsYXNzID0gb2xkQ2xhc3MgfHwge307CiAgICAgIGtsYXNzID0ga2xhc3MgfHwge307CiAgICAgIGZvciAobmFtZSBpbiBvbGRDbGFzcykgewogICAgICAgICAgaWYgKG9sZENsYXNzW25hbWVdICYmICFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoa2xhc3MsIG5hbWUpKSB7CiAgICAgICAgICAgICAgLy8gd2FzIGB0cnVlYCBhbmQgbm93IG5vdCBwcm92aWRlZAogICAgICAgICAgICAgIGVsbS5jbGFzc0xpc3QucmVtb3ZlKG5hbWUpOwogICAgICAgICAgfQogICAgICB9CiAgICAgIGZvciAobmFtZSBpbiBrbGFzcykgewogICAgICAgICAgY3VyID0ga2xhc3NbbmFtZV07CiAgICAgICAgICBpZiAoY3VyICE9PSBvbGRDbGFzc1tuYW1lXSkgewogICAgICAgICAgICAgIGVsbS5jbGFzc0xpc3RbY3VyID8gImFkZCIgOiAicmVtb3ZlIl0obmFtZSk7CiAgICAgICAgICB9CiAgICAgIH0KICB9CiAgY29uc3QgY2xhc3NNb2R1bGUgPSB7IGNyZWF0ZTogdXBkYXRlQ2xhc3MsIHVwZGF0ZTogdXBkYXRlQ2xhc3MgfTsKCiAgY29uc3QgQ0FQU19SRUdFWCA9IC9bQS1aXS9nOwogIGZ1bmN0aW9uIHVwZGF0ZURhdGFzZXQob2xkVm5vZGUsIHZub2RlKSB7CiAgICAgIGNvbnN0IGVsbSA9IHZub2RlLmVsbTsKICAgICAgbGV0IG9sZERhdGFzZXQgPSBvbGRWbm9kZS5kYXRhLmRhdGFzZXQ7CiAgICAgIGxldCBkYXRhc2V0ID0gdm5vZGUuZGF0YS5kYXRhc2V0OwogICAgICBsZXQga2V5OwogICAgICBpZiAoIW9sZERhdGFzZXQgJiYgIWRhdGFzZXQpCiAgICAgICAgICByZXR1cm47CiAgICAgIGlmIChvbGREYXRhc2V0ID09PSBkYXRhc2V0KQogICAgICAgICAgcmV0dXJuOwogICAgICBvbGREYXRhc2V0ID0gb2xkRGF0YXNldCB8fCB7fTsKICAgICAgZGF0YXNldCA9IGRhdGFzZXQgfHwge307CiAgICAgIGNvbnN0IGQgPSBlbG0uZGF0YXNldDsKICAgICAgZm9yIChrZXkgaW4gb2xkRGF0YXNldCkgewogICAgICAgICAgaWYgKCFkYXRhc2V0W2tleV0pIHsKICAgICAgICAgICAgICBpZiAoZCkgewogICAgICAgICAgICAgICAgICBpZiAoa2V5IGluIGQpIHsKICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBkW2tleV07CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgIGVsbS5yZW1vdmVBdHRyaWJ1dGUoImRhdGEtIiArIGtleS5yZXBsYWNlKENBUFNfUkVHRVgsICItJCYiKS50b0xvd2VyQ2FzZSgpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgIH0KICAgICAgZm9yIChrZXkgaW4gZGF0YXNldCkgewogICAgICAgICAgaWYgKG9sZERhdGFzZXRba2V5XSAhPT0gZGF0YXNldFtrZXldKSB7CiAgICAgICAgICAgICAgaWYgKGQpIHsKICAgICAgICAgICAgICAgICAgZFtrZXldID0gZGF0YXNldFtrZXldOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgZWxtLnNldEF0dHJpYnV0ZSgiZGF0YS0iICsga2V5LnJlcGxhY2UoQ0FQU19SRUdFWCwgIi0kJiIpLnRvTG93ZXJDYXNlKCksIGRhdGFzZXRba2V5XSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICB9CiAgfQogIGNvbnN0IGRhdGFzZXRNb2R1bGUgPSB7CiAgICAgIGNyZWF0ZTogdXBkYXRlRGF0YXNldCwKICAgICAgdXBkYXRlOiB1cGRhdGVEYXRhc2V0LAogIH07CgogIGZ1bmN0aW9uIGludm9rZUhhbmRsZXIoaGFuZGxlciwgdm5vZGUsIGV2ZW50KSB7CiAgICAgIGlmICh0eXBlb2YgaGFuZGxlciA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgLy8gY2FsbCBmdW5jdGlvbiBoYW5kbGVyCiAgICAgICAgICBoYW5kbGVyLmNhbGwodm5vZGUsIGV2ZW50LCB2bm9kZSk7CiAgICAgIH0KICAgICAgZWxzZSBpZiAodHlwZW9mIGhhbmRsZXIgPT09ICJvYmplY3QiKSB7CiAgICAgICAgICAvLyBjYWxsIG11bHRpcGxlIGhhbmRsZXJzCiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGhhbmRsZXIubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBpbnZva2VIYW5kbGVyKGhhbmRsZXJbaV0sIHZub2RlLCBldmVudCk7CiAgICAgICAgICB9CiAgICAgIH0KICB9CiAgZnVuY3Rpb24gaGFuZGxlRXZlbnQoZXZlbnQsIHZub2RlKSB7CiAgICAgIGNvbnN0IG5hbWUgPSBldmVudC50eXBlOwogICAgICBjb25zdCBvbiA9IHZub2RlLmRhdGEub247CiAgICAgIC8vIGNhbGwgZXZlbnQgaGFuZGxlcihzKSBpZiBleGlzdHMKICAgICAgaWYgKG9uICYmIG9uW25hbWVdKSB7CiAgICAgICAgICBpbnZva2VIYW5kbGVyKG9uW25hbWVdLCB2bm9kZSwgZXZlbnQpOwogICAgICB9CiAgfQogIGZ1bmN0aW9uIGNyZWF0ZUxpc3RlbmVyKCkgewogICAgICByZXR1cm4gZnVuY3Rpb24gaGFuZGxlcihldmVudCkgewogICAgICAgICAgaGFuZGxlRXZlbnQoZXZlbnQsIGhhbmRsZXIudm5vZGUpOwogICAgICB9OwogIH0KICBmdW5jdGlvbiB1cGRhdGVFdmVudExpc3RlbmVycyhvbGRWbm9kZSwgdm5vZGUpIHsKICAgICAgY29uc3Qgb2xkT24gPSBvbGRWbm9kZS5kYXRhLm9uOwogICAgICBjb25zdCBvbGRMaXN0ZW5lciA9IG9sZFZub2RlLmxpc3RlbmVyOwogICAgICBjb25zdCBvbGRFbG0gPSBvbGRWbm9kZS5lbG07CiAgICAgIGNvbnN0IG9uID0gdm5vZGUgJiYgdm5vZGUuZGF0YS5vbjsKICAgICAgY29uc3QgZWxtID0gKHZub2RlICYmIHZub2RlLmVsbSk7CiAgICAgIGxldCBuYW1lOwogICAgICAvLyBvcHRpbWl6YXRpb24gZm9yIHJldXNlZCBpbW11dGFibGUgaGFuZGxlcnMKICAgICAgaWYgKG9sZE9uID09PSBvbikgewogICAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIC8vIHJlbW92ZSBleGlzdGluZyBsaXN0ZW5lcnMgd2hpY2ggbm8gbG9uZ2VyIHVzZWQKICAgICAgaWYgKG9sZE9uICYmIG9sZExpc3RlbmVyKSB7CiAgICAgICAgICAvLyBpZiBlbGVtZW50IGNoYW5nZWQgb3IgZGVsZXRlZCB3ZSByZW1vdmUgYWxsIGV4aXN0aW5nIGxpc3RlbmVycyB1bmNvbmRpdGlvbmFsbHkKICAgICAgICAgIGlmICghb24pIHsKICAgICAgICAgICAgICBmb3IgKG5hbWUgaW4gb2xkT24pIHsKICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZlIGxpc3RlbmVyIGlmIGVsZW1lbnQgd2FzIGNoYW5nZWQgb3IgZXhpc3RpbmcgbGlzdGVuZXJzIHJlbW92ZWQKICAgICAgICAgICAgICAgICAgb2xkRWxtLnJlbW92ZUV2ZW50TGlzdGVuZXIobmFtZSwgb2xkTGlzdGVuZXIsIGZhbHNlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICBmb3IgKG5hbWUgaW4gb2xkT24pIHsKICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZlIGxpc3RlbmVyIGlmIGV4aXN0aW5nIGxpc3RlbmVyIHJlbW92ZWQKICAgICAgICAgICAgICAgICAgaWYgKCFvbltuYW1lXSkgewogICAgICAgICAgICAgICAgICAgICAgb2xkRWxtLnJlbW92ZUV2ZW50TGlzdGVuZXIobmFtZSwgb2xkTGlzdGVuZXIsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgfQogICAgICAvLyBhZGQgbmV3IGxpc3RlbmVycyB3aGljaCBoYXMgbm90IGFscmVhZHkgYXR0YWNoZWQKICAgICAgaWYgKG9uKSB7CiAgICAgICAgICAvLyByZXVzZSBleGlzdGluZyBsaXN0ZW5lciBvciBjcmVhdGUgbmV3CiAgICAgICAgICBjb25zdCBsaXN0ZW5lciA9ICh2bm9kZS5saXN0ZW5lciA9CiAgICAgICAgICAgICAgb2xkVm5vZGUubGlzdGVuZXIgfHwgY3JlYXRlTGlzdGVuZXIoKSk7CiAgICAgICAgICAvLyB1cGRhdGUgdm5vZGUgZm9yIGxpc3RlbmVyCiAgICAgICAgICBsaXN0ZW5lci52bm9kZSA9IHZub2RlOwogICAgICAgICAgLy8gaWYgZWxlbWVudCBjaGFuZ2VkIG9yIGFkZGVkIHdlIGFkZCBhbGwgbmVlZGVkIGxpc3RlbmVycyB1bmNvbmRpdGlvbmFsbHkKICAgICAgICAgIGlmICghb2xkT24pIHsKICAgICAgICAgICAgICBmb3IgKG5hbWUgaW4gb24pIHsKICAgICAgICAgICAgICAgICAgLy8gYWRkIGxpc3RlbmVyIGlmIGVsZW1lbnQgd2FzIGNoYW5nZWQgb3IgbmV3IGxpc3RlbmVycyBhZGRlZAogICAgICAgICAgICAgICAgICBlbG0uYWRkRXZlbnRMaXN0ZW5lcihuYW1lLCBsaXN0ZW5lciwgZmFsc2UpOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIGZvciAobmFtZSBpbiBvbikgewogICAgICAgICAgICAgICAgICAvLyBhZGQgbGlzdGVuZXIgaWYgbmV3IGxpc3RlbmVyIGFkZGVkCiAgICAgICAgICAgICAgICAgIGlmICghb2xkT25bbmFtZV0pIHsKICAgICAgICAgICAgICAgICAgICAgIGVsbS5hZGRFdmVudExpc3RlbmVyKG5hbWUsIGxpc3RlbmVyLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgIH0KICB9CiAgY29uc3QgZXZlbnRMaXN0ZW5lcnNNb2R1bGUgPSB7CiAgICAgIGNyZWF0ZTogdXBkYXRlRXZlbnRMaXN0ZW5lcnMsCiAgICAgIHVwZGF0ZTogdXBkYXRlRXZlbnRMaXN0ZW5lcnMsCiAgICAgIGRlc3Ryb3k6IHVwZGF0ZUV2ZW50TGlzdGVuZXJzLAogIH07CgogIGZ1bmN0aW9uIHVwZGF0ZVByb3BzKG9sZFZub2RlLCB2bm9kZSkgewogICAgICBsZXQga2V5OwogICAgICBsZXQgY3VyOwogICAgICBsZXQgb2xkOwogICAgICBjb25zdCBlbG0gPSB2bm9kZS5lbG07CiAgICAgIGxldCBvbGRQcm9wcyA9IG9sZFZub2RlLmRhdGEucHJvcHM7CiAgICAgIGxldCBwcm9wcyA9IHZub2RlLmRhdGEucHJvcHM7CiAgICAgIGlmICghb2xkUHJvcHMgJiYgIXByb3BzKQogICAgICAgICAgcmV0dXJuOwogICAgICBpZiAob2xkUHJvcHMgPT09IHByb3BzKQogICAgICAgICAgcmV0dXJuOwogICAgICBvbGRQcm9wcyA9IG9sZFByb3BzIHx8IHt9OwogICAgICBwcm9wcyA9IHByb3BzIHx8IHt9OwogICAgICBmb3IgKGtleSBpbiBwcm9wcykgewogICAgICAgICAgY3VyID0gcHJvcHNba2V5XTsKICAgICAgICAgIG9sZCA9IG9sZFByb3BzW2tleV07CiAgICAgICAgICBpZiAob2xkICE9PSBjdXIgJiYgKGtleSAhPT0gInZhbHVlIiB8fCBlbG1ba2V5XSAhPT0gY3VyKSkgewogICAgICAgICAgICAgIGVsbVtrZXldID0gY3VyOwogICAgICAgICAgfQogICAgICB9CiAgfQogIGNvbnN0IHByb3BzTW9kdWxlID0geyBjcmVhdGU6IHVwZGF0ZVByb3BzLCB1cGRhdGU6IHVwZGF0ZVByb3BzIH07CgogIC8vIEJpbmRpZyBgcmVxdWVzdEFuaW1hdGlvbkZyYW1lYCBsaWtlIHRoaXMgZml4ZXMgYSBidWcgaW4gSUUvRWRnZS4gU2VlICMzNjAgYW5kICM0MDkuCiAgY29uc3QgcmFmID0gKHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiICYmCiAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuYmluZCh3aW5kb3cpKSB8fAogICAgICBzZXRUaW1lb3V0OwogIGNvbnN0IG5leHRGcmFtZSA9IGZ1bmN0aW9uIChmbikgewogICAgICByYWYoZnVuY3Rpb24gKCkgewogICAgICAgICAgcmFmKGZuKTsKICAgICAgfSk7CiAgfTsKICBsZXQgcmVmbG93Rm9yY2VkID0gZmFsc2U7CiAgZnVuY3Rpb24gc2V0TmV4dEZyYW1lKG9iaiwgcHJvcCwgdmFsKSB7CiAgICAgIG5leHRGcmFtZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICBvYmpbcHJvcF0gPSB2YWw7CiAgICAgIH0pOwogIH0KICBmdW5jdGlvbiB1cGRhdGVTdHlsZShvbGRWbm9kZSwgdm5vZGUpIHsKICAgICAgbGV0IGN1cjsKICAgICAgbGV0IG5hbWU7CiAgICAgIGNvbnN0IGVsbSA9IHZub2RlLmVsbTsKICAgICAgbGV0IG9sZFN0eWxlID0gb2xkVm5vZGUuZGF0YS5zdHlsZTsKICAgICAgbGV0IHN0eWxlID0gdm5vZGUuZGF0YS5zdHlsZTsKICAgICAgaWYgKCFvbGRTdHlsZSAmJiAhc3R5bGUpCiAgICAgICAgICByZXR1cm47CiAgICAgIGlmIChvbGRTdHlsZSA9PT0gc3R5bGUpCiAgICAgICAgICByZXR1cm47CiAgICAgIG9sZFN0eWxlID0gb2xkU3R5bGUgfHwge307CiAgICAgIHN0eWxlID0gc3R5bGUgfHwge307CiAgICAgIGNvbnN0IG9sZEhhc0RlbCA9ICJkZWxheWVkIiBpbiBvbGRTdHlsZTsKICAgICAgZm9yIChuYW1lIGluIG9sZFN0eWxlKSB7CiAgICAgICAgICBpZiAoIXN0eWxlW25hbWVdKSB7CiAgICAgICAgICAgICAgaWYgKG5hbWVbMF0gPT09ICItIiAmJiBuYW1lWzFdID09PSAiLSIpIHsKICAgICAgICAgICAgICAgICAgZWxtLnN0eWxlLnJlbW92ZVByb3BlcnR5KG5hbWUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgZWxtLnN0eWxlW25hbWVdID0gIiI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICB9CiAgICAgIGZvciAobmFtZSBpbiBzdHlsZSkgewogICAgICAgICAgY3VyID0gc3R5bGVbbmFtZV07CiAgICAgICAgICBpZiAobmFtZSA9PT0gImRlbGF5ZWQiICYmIHN0eWxlLmRlbGF5ZWQpIHsKICAgICAgICAgICAgICBmb3IgKGNvbnN0IG5hbWUyIGluIHN0eWxlLmRlbGF5ZWQpIHsKICAgICAgICAgICAgICAgICAgY3VyID0gc3R5bGUuZGVsYXllZFtuYW1lMl07CiAgICAgICAgICAgICAgICAgIGlmICghb2xkSGFzRGVsIHx8IGN1ciAhPT0gb2xkU3R5bGUuZGVsYXllZFtuYW1lMl0pIHsKICAgICAgICAgICAgICAgICAgICAgIHNldE5leHRGcmFtZShlbG0uc3R5bGUsIG5hbWUyLCBjdXIpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZWxzZSBpZiAobmFtZSAhPT0gInJlbW92ZSIgJiYgY3VyICE9PSBvbGRTdHlsZVtuYW1lXSkgewogICAgICAgICAgICAgIGlmIChuYW1lWzBdID09PSAiLSIgJiYgbmFtZVsxXSA9PT0gIi0iKSB7CiAgICAgICAgICAgICAgICAgIGVsbS5zdHlsZS5zZXRQcm9wZXJ0eShuYW1lLCBjdXIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgZWxtLnN0eWxlW25hbWVdID0gY3VyOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgfQogIH0KICBmdW5jdGlvbiBhcHBseURlc3Ryb3lTdHlsZSh2bm9kZSkgewogICAgICBsZXQgc3R5bGU7CiAgICAgIGxldCBuYW1lOwogICAgICBjb25zdCBlbG0gPSB2bm9kZS5lbG07CiAgICAgIGNvbnN0IHMgPSB2bm9kZS5kYXRhLnN0eWxlOwogICAgICBpZiAoIXMgfHwgIShzdHlsZSA9IHMuZGVzdHJveSkpCiAgICAgICAgICByZXR1cm47CiAgICAgIGZvciAobmFtZSBpbiBzdHlsZSkgewogICAgICAgICAgZWxtLnN0eWxlW25hbWVdID0gc3R5bGVbbmFtZV07CiAgICAgIH0KICB9CiAgZnVuY3Rpb24gYXBwbHlSZW1vdmVTdHlsZSh2bm9kZSwgcm0pIHsKICAgICAgY29uc3QgcyA9IHZub2RlLmRhdGEuc3R5bGU7CiAgICAgIGlmICghcyB8fCAhcy5yZW1vdmUpIHsKICAgICAgICAgIHJtKCk7CiAgICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKCFyZWZsb3dGb3JjZWQpIHsKICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLWV4cHJlc3Npb25zCiAgICAgICAgICB2bm9kZS5lbG0ub2Zmc2V0TGVmdDsKICAgICAgICAgIHJlZmxvd0ZvcmNlZCA9IHRydWU7CiAgICAgIH0KICAgICAgbGV0IG5hbWU7CiAgICAgIGNvbnN0IGVsbSA9IHZub2RlLmVsbTsKICAgICAgbGV0IGkgPSAwOwogICAgICBjb25zdCBzdHlsZSA9IHMucmVtb3ZlOwogICAgICBsZXQgYW1vdW50ID0gMDsKICAgICAgY29uc3QgYXBwbGllZCA9IFtdOwogICAgICBmb3IgKG5hbWUgaW4gc3R5bGUpIHsKICAgICAgICAgIGFwcGxpZWQucHVzaChuYW1lKTsKICAgICAgICAgIGVsbS5zdHlsZVtuYW1lXSA9IHN0eWxlW25hbWVdOwogICAgICB9CiAgICAgIGNvbnN0IGNvbXBTdHlsZSA9IGdldENvbXB1dGVkU3R5bGUoZWxtKTsKICAgICAgY29uc3QgcHJvcHMgPSBjb21wU3R5bGVbInRyYW5zaXRpb24tcHJvcGVydHkiXS5zcGxpdCgiLCAiKTsKICAgICAgZm9yICg7IGkgPCBwcm9wcy5sZW5ndGg7ICsraSkgewogICAgICAgICAgaWYgKGFwcGxpZWQuaW5kZXhPZihwcm9wc1tpXSkgIT09IC0xKQogICAgICAgICAgICAgIGFtb3VudCsrOwogICAgICB9CiAgICAgIGVsbS5hZGRFdmVudExpc3RlbmVyKCJ0cmFuc2l0aW9uZW5kIiwgZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICBpZiAoZXYudGFyZ2V0ID09PSBlbG0pCiAgICAgICAgICAgICAgLS1hbW91bnQ7CiAgICAgICAgICBpZiAoYW1vdW50ID09PSAwKQogICAgICAgICAgICAgIHJtKCk7CiAgICAgIH0pOwogIH0KICBmdW5jdGlvbiBmb3JjZVJlZmxvdygpIHsKICAgICAgcmVmbG93Rm9yY2VkID0gZmFsc2U7CiAgfQogIGNvbnN0IHN0eWxlTW9kdWxlID0gewogICAgICBwcmU6IGZvcmNlUmVmbG93LAogICAgICBjcmVhdGU6IHVwZGF0ZVN0eWxlLAogICAgICB1cGRhdGU6IHVwZGF0ZVN0eWxlLAogICAgICBkZXN0cm95OiBhcHBseURlc3Ryb3lTdHlsZSwKICAgICAgcmVtb3ZlOiBhcHBseVJlbW92ZVN0eWxlLAogIH07CgogIC8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9uby1uYW1lc3BhY2UsIGltcG9ydC9leHBvcnQgKi8KICBmdW5jdGlvbiBmbGF0dGVuQW5kRmlsdGVyKGNoaWxkcmVuLCBmbGF0dGVuZWQpIHsKICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBjaGlsZHJlbikgewogICAgICAgICAgLy8gZmlsdGVyIG91dCBmYWxzZXkgY2hpbGRyZW4sIGV4Y2VwdCAwIHNpbmNlIHplcm8gY2FuIGJlIGEgdmFsaWQgdmFsdWUgZS5nIGluc2lkZSBhIGNoYXJ0CiAgICAgICAgICBpZiAoY2hpbGQgIT09IHVuZGVmaW5lZCAmJgogICAgICAgICAgICAgIGNoaWxkICE9PSBudWxsICYmCiAgICAgICAgICAgICAgY2hpbGQgIT09IGZhbHNlICYmCiAgICAgICAgICAgICAgY2hpbGQgIT09ICIiKSB7CiAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY2hpbGQpKSB7CiAgICAgICAgICAgICAgICAgIGZsYXR0ZW5BbmRGaWx0ZXIoY2hpbGQsIGZsYXR0ZW5lZCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBjaGlsZCA9PT0gInN0cmluZyIgfHwKICAgICAgICAgICAgICAgICAgdHlwZW9mIGNoaWxkID09PSAibnVtYmVyIiB8fAogICAgICAgICAgICAgICAgICB0eXBlb2YgY2hpbGQgPT09ICJib29sZWFuIikgewogICAgICAgICAgICAgICAgICBmbGF0dGVuZWQucHVzaCh2bm9kZSh1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBTdHJpbmcoY2hpbGQpLCB1bmRlZmluZWQpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgIGZsYXR0ZW5lZC5wdXNoKGNoaWxkKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGZsYXR0ZW5lZDsKICB9CiAgLyoqCiAgICoganN4L3RzeCBjb21wYXRpYmxlIGZhY3RvcnkgZnVuY3Rpb24KICAgKiBzZWU6IGh0dHBzOi8vd3d3LnR5cGVzY3JpcHRsYW5nLm9yZy9kb2NzL2hhbmRib29rL2pzeC5odG1sI2ZhY3RvcnktZnVuY3Rpb25zCiAgICovCiAgZnVuY3Rpb24ganN4KHRhZywgZGF0YSwgLi4uY2hpbGRyZW4pIHsKICAgICAgY29uc3QgZmxhdENoaWxkcmVuID0gZmxhdHRlbkFuZEZpbHRlcihjaGlsZHJlbiwgW10pOwogICAgICBpZiAodHlwZW9mIHRhZyA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgLy8gdGFnIGlzIGEgZnVuY3Rpb24gY29tcG9uZW50CiAgICAgICAgICByZXR1cm4gdGFnKGRhdGEsIGZsYXRDaGlsZHJlbik7CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgICBpZiAoZmxhdENoaWxkcmVuLmxlbmd0aCA9PT0gMSAmJgogICAgICAgICAgICAgICFmbGF0Q2hpbGRyZW5bMF0uc2VsICYmCiAgICAgICAgICAgICAgZmxhdENoaWxkcmVuWzBdLnRleHQpIHsKICAgICAgICAgICAgICAvLyBvbmx5IGNoaWxkIGlzIGEgc2ltcGxlIHRleHQgbm9kZSwgcGFzcyBhcyB0ZXh0IGZvciBhIHNpbXBsZXIgdnRyZWUKICAgICAgICAgICAgICByZXR1cm4gaCh0YWcsIGRhdGEsIGZsYXRDaGlsZHJlblswXS50ZXh0KTsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIHJldHVybiBoKHRhZywgZGF0YSwgZmxhdENoaWxkcmVuKTsKICAgICAgICAgIH0KICAgICAgfQogIH0KICAoZnVuY3Rpb24gKGpzeCkgewogIH0pKGpzeCB8fCAoanN4ID0ge30pKTsKCiAgZXhwb3J0cy5hcnJheSA9IGFycmF5OwogIGV4cG9ydHMuYXR0YWNoVG8gPSBhdHRhY2hUbzsKICBleHBvcnRzLmF0dHJpYnV0ZXNNb2R1bGUgPSBhdHRyaWJ1dGVzTW9kdWxlOwogIGV4cG9ydHMuY2xhc3NNb2R1bGUgPSBjbGFzc01vZHVsZTsKICBleHBvcnRzLmRhdGFzZXRNb2R1bGUgPSBkYXRhc2V0TW9kdWxlOwogIGV4cG9ydHMuZXZlbnRMaXN0ZW5lcnNNb2R1bGUgPSBldmVudExpc3RlbmVyc01vZHVsZTsKICBleHBvcnRzLmggPSBoOwogIGV4cG9ydHMuaHRtbERvbUFwaSA9IGh0bWxEb21BcGk7CiAgZXhwb3J0cy5pbml0ID0gaW5pdCQxOwogIGV4cG9ydHMuanN4ID0ganN4OwogIGV4cG9ydHMucHJpbWl0aXZlID0gcHJpbWl0aXZlOwogIGV4cG9ydHMucHJvcHNNb2R1bGUgPSBwcm9wc01vZHVsZTsKICBleHBvcnRzLnN0eWxlTW9kdWxlID0gc3R5bGVNb2R1bGU7CiAgZXhwb3J0cy50aHVuayA9IHRodW5rOwogIGV4cG9ydHMudG9WTm9kZSA9IHRvVk5vZGU7CiAgZXhwb3J0cy52bm9kZSA9IHZub2RlOwogIH0pOwoKICAvKioKICAgKiBsb2Rhc2ggKEN1c3RvbSBCdWlsZCkgPGh0dHBzOi8vbG9kYXNoLmNvbS8+CiAgICogQnVpbGQ6IGBsb2Rhc2ggbW9kdWxhcml6ZSBleHBvcnRzPSJucG0iIC1vIC4vYAogICAqIENvcHlyaWdodCBqUXVlcnkgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzIDxodHRwczovL2pxdWVyeS5vcmcvPgogICAqIFJlbGVhc2VkIHVuZGVyIE1JVCBsaWNlbnNlIDxodHRwczovL2xvZGFzaC5jb20vbGljZW5zZT4KICAgKiBCYXNlZCBvbiBVbmRlcnNjb3JlLmpzIDEuOC4zIDxodHRwOi8vdW5kZXJzY29yZWpzLm9yZy9MSUNFTlNFPgogICAqIENvcHlyaWdodCBKZXJlbXkgQXNoa2VuYXMsIERvY3VtZW50Q2xvdWQgYW5kIEludmVzdGlnYXRpdmUgUmVwb3J0ZXJzICYgRWRpdG9ycwogICAqLwoKICAvKiogVXNlZCBhcyByZWZlcmVuY2VzIGZvciB2YXJpb3VzIGBOdW1iZXJgIGNvbnN0YW50cy4gKi8KICB2YXIgSU5GSU5JVFkgPSAxIC8gMDsKCiAgLyoqIGBPYmplY3QjdG9TdHJpbmdgIHJlc3VsdCByZWZlcmVuY2VzLiAqLwogIHZhciBzeW1ib2xUYWckMSA9ICdbb2JqZWN0IFN5bWJvbF0nOwoKICAvKiogVXNlZCB0byBtYXRjaCB3b3JkcyBjb21wb3NlZCBvZiBhbHBoYW51bWVyaWMgY2hhcmFjdGVycy4gKi8KICB2YXIgcmVBc2NpaVdvcmQgPSAvW15ceDAwLVx4MmZceDNhLVx4NDBceDViLVx4NjBceDdiLVx4N2ZdKy9nOwoKICAvKiogVXNlZCB0byBtYXRjaCBMYXRpbiBVbmljb2RlIGxldHRlcnMgKGV4Y2x1ZGluZyBtYXRoZW1hdGljYWwgb3BlcmF0b3JzKS4gKi8KICB2YXIgcmVMYXRpbiA9IC9bXHhjMC1ceGQ2XHhkOC1ceGY2XHhmOC1ceGZmXHUwMTAwLVx1MDE3Zl0vZzsKCiAgLyoqIFVzZWQgdG8gY29tcG9zZSB1bmljb2RlIGNoYXJhY3RlciBjbGFzc2VzLiAqLwogIHZhciByc0FzdHJhbFJhbmdlID0gJ1xcdWQ4MDAtXFx1ZGZmZicsCiAgICAgIHJzQ29tYm9NYXJrc1JhbmdlID0gJ1xcdTAzMDAtXFx1MDM2ZlxcdWZlMjAtXFx1ZmUyMycsCiAgICAgIHJzQ29tYm9TeW1ib2xzUmFuZ2UgPSAnXFx1MjBkMC1cXHUyMGYwJywKICAgICAgcnNEaW5nYmF0UmFuZ2UgPSAnXFx1MjcwMC1cXHUyN2JmJywKICAgICAgcnNMb3dlclJhbmdlID0gJ2EtelxceGRmLVxceGY2XFx4ZjgtXFx4ZmYnLAogICAgICByc01hdGhPcFJhbmdlID0gJ1xceGFjXFx4YjFcXHhkN1xceGY3JywKICAgICAgcnNOb25DaGFyUmFuZ2UgPSAnXFx4MDAtXFx4MmZcXHgzYS1cXHg0MFxceDViLVxceDYwXFx4N2ItXFx4YmYnLAogICAgICByc1B1bmN0dWF0aW9uUmFuZ2UgPSAnXFx1MjAwMC1cXHUyMDZmJywKICAgICAgcnNTcGFjZVJhbmdlID0gJyBcXHRcXHgwYlxcZlxceGEwXFx1ZmVmZlxcblxcclxcdTIwMjhcXHUyMDI5XFx1MTY4MFxcdTE4MGVcXHUyMDAwXFx1MjAwMVxcdTIwMDJcXHUyMDAzXFx1MjAwNFxcdTIwMDVcXHUyMDA2XFx1MjAwN1xcdTIwMDhcXHUyMDA5XFx1MjAwYVxcdTIwMmZcXHUyMDVmXFx1MzAwMCcsCiAgICAgIHJzVXBwZXJSYW5nZSA9ICdBLVpcXHhjMC1cXHhkNlxceGQ4LVxceGRlJywKICAgICAgcnNWYXJSYW5nZSA9ICdcXHVmZTBlXFx1ZmUwZicsCiAgICAgIHJzQnJlYWtSYW5nZSA9IHJzTWF0aE9wUmFuZ2UgKyByc05vbkNoYXJSYW5nZSArIHJzUHVuY3R1YXRpb25SYW5nZSArIHJzU3BhY2VSYW5nZTsKCiAgLyoqIFVzZWQgdG8gY29tcG9zZSB1bmljb2RlIGNhcHR1cmUgZ3JvdXBzLiAqLwogIHZhciByc0Fwb3MgPSAiWydcdTIwMTldIiwKICAgICAgcnNBc3RyYWwgPSAnWycgKyByc0FzdHJhbFJhbmdlICsgJ10nLAogICAgICByc0JyZWFrID0gJ1snICsgcnNCcmVha1JhbmdlICsgJ10nLAogICAgICByc0NvbWJvID0gJ1snICsgcnNDb21ib01hcmtzUmFuZ2UgKyByc0NvbWJvU3ltYm9sc1JhbmdlICsgJ10nLAogICAgICByc0RpZ2l0cyA9ICdcXGQrJywKICAgICAgcnNEaW5nYmF0ID0gJ1snICsgcnNEaW5nYmF0UmFuZ2UgKyAnXScsCiAgICAgIHJzTG93ZXIgPSAnWycgKyByc0xvd2VyUmFuZ2UgKyAnXScsCiAgICAgIHJzTWlzYyA9ICdbXicgKyByc0FzdHJhbFJhbmdlICsgcnNCcmVha1JhbmdlICsgcnNEaWdpdHMgKyByc0RpbmdiYXRSYW5nZSArIHJzTG93ZXJSYW5nZSArIHJzVXBwZXJSYW5nZSArICddJywKICAgICAgcnNGaXR6ID0gJ1xcdWQ4M2NbXFx1ZGZmYi1cXHVkZmZmXScsCiAgICAgIHJzTW9kaWZpZXIgPSAnKD86JyArIHJzQ29tYm8gKyAnfCcgKyByc0ZpdHogKyAnKScsCiAgICAgIHJzTm9uQXN0cmFsID0gJ1teJyArIHJzQXN0cmFsUmFuZ2UgKyAnXScsCiAgICAgIHJzUmVnaW9uYWwgPSAnKD86XFx1ZDgzY1tcXHVkZGU2LVxcdWRkZmZdKXsyfScsCiAgICAgIHJzU3VyclBhaXIgPSAnW1xcdWQ4MDAtXFx1ZGJmZl1bXFx1ZGMwMC1cXHVkZmZmXScsCiAgICAgIHJzVXBwZXIgPSAnWycgKyByc1VwcGVyUmFuZ2UgKyAnXScsCiAgICAgIHJzWldKID0gJ1xcdTIwMGQnOwoKICAvKiogVXNlZCB0byBjb21wb3NlIHVuaWNvZGUgcmVnZXhlcy4gKi8KICB2YXIgcnNMb3dlck1pc2MgPSAnKD86JyArIHJzTG93ZXIgKyAnfCcgKyByc01pc2MgKyAnKScsCiAgICAgIHJzVXBwZXJNaXNjID0gJyg/OicgKyByc1VwcGVyICsgJ3wnICsgcnNNaXNjICsgJyknLAogICAgICByc09wdExvd2VyQ29udHIgPSAnKD86JyArIHJzQXBvcyArICcoPzpkfGxsfG18cmV8c3x0fHZlKSk/JywKICAgICAgcnNPcHRVcHBlckNvbnRyID0gJyg/OicgKyByc0Fwb3MgKyAnKD86RHxMTHxNfFJFfFN8VHxWRSkpPycsCiAgICAgIHJlT3B0TW9kID0gcnNNb2RpZmllciArICc/JywKICAgICAgcnNPcHRWYXIgPSAnWycgKyByc1ZhclJhbmdlICsgJ10/JywKICAgICAgcnNPcHRKb2luID0gJyg/OicgKyByc1pXSiArICcoPzonICsgW3JzTm9uQXN0cmFsLCByc1JlZ2lvbmFsLCByc1N1cnJQYWlyXS5qb2luKCd8JykgKyAnKScgKyByc09wdFZhciArIHJlT3B0TW9kICsgJykqJywKICAgICAgcnNTZXEgPSByc09wdFZhciArIHJlT3B0TW9kICsgcnNPcHRKb2luLAogICAgICByc0Vtb2ppID0gJyg/OicgKyBbcnNEaW5nYmF0LCByc1JlZ2lvbmFsLCByc1N1cnJQYWlyXS5qb2luKCd8JykgKyAnKScgKyByc1NlcSwKICAgICAgcnNTeW1ib2wgPSAnKD86JyArIFtyc05vbkFzdHJhbCArIHJzQ29tYm8gKyAnPycsIHJzQ29tYm8sIHJzUmVnaW9uYWwsIHJzU3VyclBhaXIsIHJzQXN0cmFsXS5qb2luKCd8JykgKyAnKSc7CgogIC8qKiBVc2VkIHRvIG1hdGNoIGFwb3N0cm9waGVzLiAqLwogIHZhciByZUFwb3MgPSBSZWdFeHAocnNBcG9zLCAnZycpOwoKICAvKioKICAgKiBVc2VkIHRvIG1hdGNoIFtjb21iaW5pbmcgZGlhY3JpdGljYWwgbWFya3NdKGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0NvbWJpbmluZ19EaWFjcml0aWNhbF9NYXJrcykgYW5kCiAgICogW2NvbWJpbmluZyBkaWFjcml0aWNhbCBtYXJrcyBmb3Igc3ltYm9sc10oaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ29tYmluaW5nX0RpYWNyaXRpY2FsX01hcmtzX2Zvcl9TeW1ib2xzKS4KICAgKi8KICB2YXIgcmVDb21ib01hcmsgPSBSZWdFeHAocnNDb21ibywgJ2cnKTsKCiAgLyoqIFVzZWQgdG8gbWF0Y2ggW3N0cmluZyBzeW1ib2xzXShodHRwczovL21hdGhpYXNieW5lbnMuYmUvbm90ZXMvamF2YXNjcmlwdC11bmljb2RlKS4gKi8KICB2YXIgcmVVbmljb2RlID0gUmVnRXhwKHJzRml0eiArICcoPz0nICsgcnNGaXR6ICsgJyl8JyArIHJzU3ltYm9sICsgcnNTZXEsICdnJyk7CgogIC8qKiBVc2VkIHRvIG1hdGNoIGNvbXBsZXggb3IgY29tcG91bmQgd29yZHMuICovCiAgdmFyIHJlVW5pY29kZVdvcmQgPSBSZWdFeHAoWwogICAgcnNVcHBlciArICc/JyArIHJzTG93ZXIgKyAnKycgKyByc09wdExvd2VyQ29udHIgKyAnKD89JyArIFtyc0JyZWFrLCByc1VwcGVyLCAnJCddLmpvaW4oJ3wnKSArICcpJywKICAgIHJzVXBwZXJNaXNjICsgJysnICsgcnNPcHRVcHBlckNvbnRyICsgJyg/PScgKyBbcnNCcmVhaywgcnNVcHBlciArIHJzTG93ZXJNaXNjLCAnJCddLmpvaW4oJ3wnKSArICcpJywKICAgIHJzVXBwZXIgKyAnPycgKyByc0xvd2VyTWlzYyArICcrJyArIHJzT3B0TG93ZXJDb250ciwKICAgIHJzVXBwZXIgKyAnKycgKyByc09wdFVwcGVyQ29udHIsCiAgICByc0RpZ2l0cywKICAgIHJzRW1vamkKICBdLmpvaW4oJ3wnKSwgJ2cnKTsKCiAgLyoqIFVzZWQgdG8gZGV0ZWN0IHN0cmluZ3Mgd2l0aCBbemVyby13aWR0aCBqb2luZXJzIG9yIGNvZGUgcG9pbnRzIGZyb20gdGhlIGFzdHJhbCBwbGFuZXNdKGh0dHA6Ly9lZXYuZWUvYmxvZy8yMDE1LzA5LzEyL2RhcmstY29ybmVycy1vZi11bmljb2RlLykuICovCiAgdmFyIHJlSGFzVW5pY29kZSA9IFJlZ0V4cCgnWycgKyByc1pXSiArIHJzQXN0cmFsUmFuZ2UgICsgcnNDb21ib01hcmtzUmFuZ2UgKyByc0NvbWJvU3ltYm9sc1JhbmdlICsgcnNWYXJSYW5nZSArICddJyk7CgogIC8qKiBVc2VkIHRvIGRldGVjdCBzdHJpbmdzIHRoYXQgbmVlZCBhIG1vcmUgcm9idXN0IHJlZ2V4cCB0byBtYXRjaCB3b3Jkcy4gKi8KICB2YXIgcmVIYXNVbmljb2RlV29yZCA9IC9bYS16XVtBLVpdfFtBLVpdezIsfVthLXpdfFswLTldW2EtekEtWl18W2EtekEtWl1bMC05XXxbXmEtekEtWjAtOSBdLzsKCiAgLyoqIFVzZWQgdG8gbWFwIExhdGluIFVuaWNvZGUgbGV0dGVycyB0byBiYXNpYyBMYXRpbiBsZXR0ZXJzLiAqLwogIHZhciBkZWJ1cnJlZExldHRlcnMgPSB7CiAgICAvLyBMYXRpbi0xIFN1cHBsZW1lbnQgYmxvY2suCiAgICAnXHhjMCc6ICdBJywgICdceGMxJzogJ0EnLCAnXHhjMic6ICdBJywgJ1x4YzMnOiAnQScsICdceGM0JzogJ0EnLCAnXHhjNSc6ICdBJywKICAgICdceGUwJzogJ2EnLCAgJ1x4ZTEnOiAnYScsICdceGUyJzogJ2EnLCAnXHhlMyc6ICdhJywgJ1x4ZTQnOiAnYScsICdceGU1JzogJ2EnLAogICAgJ1x4YzcnOiAnQycsICAnXHhlNyc6ICdjJywKICAgICdceGQwJzogJ0QnLCAgJ1x4ZjAnOiAnZCcsCiAgICAnXHhjOCc6ICdFJywgICdceGM5JzogJ0UnLCAnXHhjYSc6ICdFJywgJ1x4Y2InOiAnRScsCiAgICAnXHhlOCc6ICdlJywgICdceGU5JzogJ2UnLCAnXHhlYSc6ICdlJywgJ1x4ZWInOiAnZScsCiAgICAnXHhjYyc6ICdJJywgICdceGNkJzogJ0knLCAnXHhjZSc6ICdJJywgJ1x4Y2YnOiAnSScsCiAgICAnXHhlYyc6ICdpJywgICdceGVkJzogJ2knLCAnXHhlZSc6ICdpJywgJ1x4ZWYnOiAnaScsCiAgICAnXHhkMSc6ICdOJywgICdceGYxJzogJ24nLAogICAgJ1x4ZDInOiAnTycsICAnXHhkMyc6ICdPJywgJ1x4ZDQnOiAnTycsICdceGQ1JzogJ08nLCAnXHhkNic6ICdPJywgJ1x4ZDgnOiAnTycsCiAgICAnXHhmMic6ICdvJywgICdceGYzJzogJ28nLCAnXHhmNCc6ICdvJywgJ1x4ZjUnOiAnbycsICdceGY2JzogJ28nLCAnXHhmOCc6ICdvJywKICAgICdceGQ5JzogJ1UnLCAgJ1x4ZGEnOiAnVScsICdceGRiJzogJ1UnLCAnXHhkYyc6ICdVJywKICAgICdceGY5JzogJ3UnLCAgJ1x4ZmEnOiAndScsICdceGZiJzogJ3UnLCAnXHhmYyc6ICd1JywKICAgICdceGRkJzogJ1knLCAgJ1x4ZmQnOiAneScsICdceGZmJzogJ3knLAogICAgJ1x4YzYnOiAnQWUnLCAnXHhlNic6ICdhZScsCiAgICAnXHhkZSc6ICdUaCcsICdceGZlJzogJ3RoJywKICAgICdceGRmJzogJ3NzJywKICAgIC8vIExhdGluIEV4dGVuZGVkLUEgYmxvY2suCiAgICAnXHUwMTAwJzogJ0EnLCAgJ1x1MDEwMic6ICdBJywgJ1x1MDEwNCc6ICdBJywKICAgICdcdTAxMDEnOiAnYScsICAnXHUwMTAzJzogJ2EnLCAnXHUwMTA1JzogJ2EnLAogICAgJ1x1MDEwNic6ICdDJywgICdcdTAxMDgnOiAnQycsICdcdTAxMGEnOiAnQycsICdcdTAxMGMnOiAnQycsCiAgICAnXHUwMTA3JzogJ2MnLCAgJ1x1MDEwOSc6ICdjJywgJ1x1MDEwYic6ICdjJywgJ1x1MDEwZCc6ICdjJywKICAgICdcdTAxMGUnOiAnRCcsICAnXHUwMTEwJzogJ0QnLCAnXHUwMTBmJzogJ2QnLCAnXHUwMTExJzogJ2QnLAogICAgJ1x1MDExMic6ICdFJywgICdcdTAxMTQnOiAnRScsICdcdTAxMTYnOiAnRScsICdcdTAxMTgnOiAnRScsICdcdTAxMWEnOiAnRScsCiAgICAnXHUwMTEzJzogJ2UnLCAgJ1x1MDExNSc6ICdlJywgJ1x1MDExNyc6ICdlJywgJ1x1MDExOSc6ICdlJywgJ1x1MDExYic6ICdlJywKICAgICdcdTAxMWMnOiAnRycsICAnXHUwMTFlJzogJ0cnLCAnXHUwMTIwJzogJ0cnLCAnXHUwMTIyJzogJ0cnLAogICAgJ1x1MDExZCc6ICdnJywgICdcdTAxMWYnOiAnZycsICdcdTAxMjEnOiAnZycsICdcdTAxMjMnOiAnZycsCiAgICAnXHUwMTI0JzogJ0gnLCAgJ1x1MDEyNic6ICdIJywgJ1x1MDEyNSc6ICdoJywgJ1x1MDEyNyc6ICdoJywKICAgICdcdTAxMjgnOiAnSScsICAnXHUwMTJhJzogJ0knLCAnXHUwMTJjJzogJ0knLCAnXHUwMTJlJzogJ0knLCAnXHUwMTMwJzogJ0knLAogICAgJ1x1MDEyOSc6ICdpJywgICdcdTAxMmInOiAnaScsICdcdTAxMmQnOiAnaScsICdcdTAxMmYnOiAnaScsICdcdTAxMzEnOiAnaScsCiAgICAnXHUwMTM0JzogJ0onLCAgJ1x1MDEzNSc6ICdqJywKICAgICdcdTAxMzYnOiAnSycsICAnXHUwMTM3JzogJ2snLCAnXHUwMTM4JzogJ2snLAogICAgJ1x1MDEzOSc6ICdMJywgICdcdTAxM2InOiAnTCcsICdcdTAxM2QnOiAnTCcsICdcdTAxM2YnOiAnTCcsICdcdTAxNDEnOiAnTCcsCiAgICAnXHUwMTNhJzogJ2wnLCAgJ1x1MDEzYyc6ICdsJywgJ1x1MDEzZSc6ICdsJywgJ1x1MDE0MCc6ICdsJywgJ1x1MDE0Mic6ICdsJywKICAgICdcdTAxNDMnOiAnTicsICAnXHUwMTQ1JzogJ04nLCAnXHUwMTQ3JzogJ04nLCAnXHUwMTRhJzogJ04nLAogICAgJ1x1MDE0NCc6ICduJywgICdcdTAxNDYnOiAnbicsICdcdTAxNDgnOiAnbicsICdcdTAxNGInOiAnbicsCiAgICAnXHUwMTRjJzogJ08nLCAgJ1x1MDE0ZSc6ICdPJywgJ1x1MDE1MCc6ICdPJywKICAgICdcdTAxNGQnOiAnbycsICAnXHUwMTRmJzogJ28nLCAnXHUwMTUxJzogJ28nLAogICAgJ1x1MDE1NCc6ICdSJywgICdcdTAxNTYnOiAnUicsICdcdTAxNTgnOiAnUicsCiAgICAnXHUwMTU1JzogJ3InLCAgJ1x1MDE1Nyc6ICdyJywgJ1x1MDE1OSc6ICdyJywKICAgICdcdTAxNWEnOiAnUycsICAnXHUwMTVjJzogJ1MnLCAnXHUwMTVlJzogJ1MnLCAnXHUwMTYwJzogJ1MnLAogICAgJ1x1MDE1Yic6ICdzJywgICdcdTAxNWQnOiAncycsICdcdTAxNWYnOiAncycsICdcdTAxNjEnOiAncycsCiAgICAnXHUwMTYyJzogJ1QnLCAgJ1x1MDE2NCc6ICdUJywgJ1x1MDE2Nic6ICdUJywKICAgICdcdTAxNjMnOiAndCcsICAnXHUwMTY1JzogJ3QnLCAnXHUwMTY3JzogJ3QnLAogICAgJ1x1MDE2OCc6ICdVJywgICdcdTAxNmEnOiAnVScsICdcdTAxNmMnOiAnVScsICdcdTAxNmUnOiAnVScsICdcdTAxNzAnOiAnVScsICdcdTAxNzInOiAnVScsCiAgICAnXHUwMTY5JzogJ3UnLCAgJ1x1MDE2Yic6ICd1JywgJ1x1MDE2ZCc6ICd1JywgJ1x1MDE2Zic6ICd1JywgJ1x1MDE3MSc6ICd1JywgJ1x1MDE3Myc6ICd1JywKICAgICdcdTAxNzQnOiAnVycsICAnXHUwMTc1JzogJ3cnLAogICAgJ1x1MDE3Nic6ICdZJywgICdcdTAxNzcnOiAneScsICdcdTAxNzgnOiAnWScsCiAgICAnXHUwMTc5JzogJ1onLCAgJ1x1MDE3Yic6ICdaJywgJ1x1MDE3ZCc6ICdaJywKICAgICdcdTAxN2EnOiAneicsICAnXHUwMTdjJzogJ3onLCAnXHUwMTdlJzogJ3onLAogICAgJ1x1MDEzMic6ICdJSicsICdcdTAxMzMnOiAnaWonLAogICAgJ1x1MDE1Mic6ICdPZScsICdcdTAxNTMnOiAnb2UnLAogICAgJ1x1MDE0OSc6ICInbiIsICdcdTAxN2YnOiAnc3MnCiAgfTsKCiAgLyoqIERldGVjdCBmcmVlIHZhcmlhYmxlIGBnbG9iYWxgIGZyb20gTm9kZS5qcy4gKi8KICB2YXIgZnJlZUdsb2JhbCQxID0gdHlwZW9mIGNvbW1vbmpzR2xvYmFsID09ICdvYmplY3QnICYmIGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLk9iamVjdCA9PT0gT2JqZWN0ICYmIGNvbW1vbmpzR2xvYmFsOwoKICAvKiogRGV0ZWN0IGZyZWUgdmFyaWFibGUgYHNlbGZgLiAqLwogIHZhciBmcmVlU2VsZiQxID0gdHlwZW9mIHNlbGYgPT0gJ29iamVjdCcgJiYgc2VsZiAmJiBzZWxmLk9iamVjdCA9PT0gT2JqZWN0ICYmIHNlbGY7CgogIC8qKiBVc2VkIGFzIGEgcmVmZXJlbmNlIHRvIHRoZSBnbG9iYWwgb2JqZWN0LiAqLwogIHZhciByb290JDEgPSBmcmVlR2xvYmFsJDEgfHwgZnJlZVNlbGYkMSB8fCBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpOwoKICAvKioKICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYF8ucmVkdWNlYCBmb3IgYXJyYXlzIHdpdGhvdXQgc3VwcG9ydCBmb3IKICAgKiBpdGVyYXRlZSBzaG9ydGhhbmRzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0FycmF5fSBbYXJyYXldIFRoZSBhcnJheSB0byBpdGVyYXRlIG92ZXIuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gaXRlcmF0ZWUgVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4KICAgKiBAcGFyYW0geyp9IFthY2N1bXVsYXRvcl0gVGhlIGluaXRpYWwgdmFsdWUuCiAgICogQHBhcmFtIHtib29sZWFufSBbaW5pdEFjY3VtXSBTcGVjaWZ5IHVzaW5nIHRoZSBmaXJzdCBlbGVtZW50IG9mIGBhcnJheWAgYXMKICAgKiAgdGhlIGluaXRpYWwgdmFsdWUuCiAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGFjY3VtdWxhdGVkIHZhbHVlLgogICAqLwogIGZ1bmN0aW9uIGFycmF5UmVkdWNlKGFycmF5LCBpdGVyYXRlZSwgYWNjdW11bGF0b3IsIGluaXRBY2N1bSkgewogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgbGVuZ3RoID0gYXJyYXkgPyBhcnJheS5sZW5ndGggOiAwOwoKICAgIGlmIChpbml0QWNjdW0gJiYgbGVuZ3RoKSB7CiAgICAgIGFjY3VtdWxhdG9yID0gYXJyYXlbKytpbmRleF07CiAgICB9CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICBhY2N1bXVsYXRvciA9IGl0ZXJhdGVlKGFjY3VtdWxhdG9yLCBhcnJheVtpbmRleF0sIGluZGV4LCBhcnJheSk7CiAgICB9CiAgICByZXR1cm4gYWNjdW11bGF0b3I7CiAgfQoKICAvKioKICAgKiBDb252ZXJ0cyBhbiBBU0NJSSBgc3RyaW5nYCB0byBhbiBhcnJheS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtzdHJpbmd9IHN0cmluZyBUaGUgc3RyaW5nIHRvIGNvbnZlcnQuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBjb252ZXJ0ZWQgYXJyYXkuCiAgICovCiAgZnVuY3Rpb24gYXNjaWlUb0FycmF5KHN0cmluZykgewogICAgcmV0dXJuIHN0cmluZy5zcGxpdCgnJyk7CiAgfQoKICAvKioKICAgKiBTcGxpdHMgYW4gQVNDSUkgYHN0cmluZ2AgaW50byBhbiBhcnJheSBvZiBpdHMgd29yZHMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7c3RyaW5nfSBUaGUgc3RyaW5nIHRvIGluc3BlY3QuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSB3b3JkcyBvZiBgc3RyaW5nYC4KICAgKi8KICBmdW5jdGlvbiBhc2NpaVdvcmRzKHN0cmluZykgewogICAgcmV0dXJuIHN0cmluZy5tYXRjaChyZUFzY2lpV29yZCkgfHwgW107CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5wcm9wZXJ0eU9mYCB3aXRob3V0IHN1cHBvcnQgZm9yIGRlZXAgcGF0aHMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS4KICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBhY2Nlc3NvciBmdW5jdGlvbi4KICAgKi8KICBmdW5jdGlvbiBiYXNlUHJvcGVydHlPZihvYmplY3QpIHsKICAgIHJldHVybiBmdW5jdGlvbihrZXkpIHsKICAgICAgcmV0dXJuIG9iamVjdCA9PSBudWxsID8gdW5kZWZpbmVkIDogb2JqZWN0W2tleV07CiAgICB9OwogIH0KCiAgLyoqCiAgICogVXNlZCBieSBgXy5kZWJ1cnJgIHRvIGNvbnZlcnQgTGF0aW4tMSBTdXBwbGVtZW50IGFuZCBMYXRpbiBFeHRlbmRlZC1BCiAgICogbGV0dGVycyB0byBiYXNpYyBMYXRpbiBsZXR0ZXJzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge3N0cmluZ30gbGV0dGVyIFRoZSBtYXRjaGVkIGxldHRlciB0byBkZWJ1cnIuCiAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgZGVidXJyZWQgbGV0dGVyLgogICAqLwogIHZhciBkZWJ1cnJMZXR0ZXIgPSBiYXNlUHJvcGVydHlPZihkZWJ1cnJlZExldHRlcnMpOwoKICAvKioKICAgKiBDaGVja3MgaWYgYHN0cmluZ2AgY29udGFpbnMgVW5pY29kZSBzeW1ib2xzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge3N0cmluZ30gc3RyaW5nIFRoZSBzdHJpbmcgdG8gaW5zcGVjdC4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYSBzeW1ib2wgaXMgZm91bmQsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBoYXNVbmljb2RlKHN0cmluZykgewogICAgcmV0dXJuIHJlSGFzVW5pY29kZS50ZXN0KHN0cmluZyk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHN0cmluZ2AgY29udGFpbnMgYSB3b3JkIGNvbXBvc2VkIG9mIFVuaWNvZGUgc3ltYm9scy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtzdHJpbmd9IHN0cmluZyBUaGUgc3RyaW5nIHRvIGluc3BlY3QuCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGEgd29yZCBpcyBmb3VuZCwgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGhhc1VuaWNvZGVXb3JkKHN0cmluZykgewogICAgcmV0dXJuIHJlSGFzVW5pY29kZVdvcmQudGVzdChzdHJpbmcpOwogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYHN0cmluZ2AgdG8gYW4gYXJyYXkuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7c3RyaW5nfSBzdHJpbmcgVGhlIHN0cmluZyB0byBjb252ZXJ0LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgY29udmVydGVkIGFycmF5LgogICAqLwogIGZ1bmN0aW9uIHN0cmluZ1RvQXJyYXkoc3RyaW5nKSB7CiAgICByZXR1cm4gaGFzVW5pY29kZShzdHJpbmcpCiAgICAgID8gdW5pY29kZVRvQXJyYXkoc3RyaW5nKQogICAgICA6IGFzY2lpVG9BcnJheShzdHJpbmcpOwogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYSBVbmljb2RlIGBzdHJpbmdgIHRvIGFuIGFycmF5LgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge3N0cmluZ30gc3RyaW5nIFRoZSBzdHJpbmcgdG8gY29udmVydC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGNvbnZlcnRlZCBhcnJheS4KICAgKi8KICBmdW5jdGlvbiB1bmljb2RlVG9BcnJheShzdHJpbmcpIHsKICAgIHJldHVybiBzdHJpbmcubWF0Y2gocmVVbmljb2RlKSB8fCBbXTsKICB9CgogIC8qKgogICAqIFNwbGl0cyBhIFVuaWNvZGUgYHN0cmluZ2AgaW50byBhbiBhcnJheSBvZiBpdHMgd29yZHMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7c3RyaW5nfSBUaGUgc3RyaW5nIHRvIGluc3BlY3QuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSB3b3JkcyBvZiBgc3RyaW5nYC4KICAgKi8KICBmdW5jdGlvbiB1bmljb2RlV29yZHMoc3RyaW5nKSB7CiAgICByZXR1cm4gc3RyaW5nLm1hdGNoKHJlVW5pY29kZVdvcmQpIHx8IFtdOwogIH0KCiAgLyoqIFVzZWQgZm9yIGJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzLiAqLwogIHZhciBvYmplY3RQcm90byQxID0gT2JqZWN0LnByb3RvdHlwZTsKCiAgLyoqCiAgICogVXNlZCB0byByZXNvbHZlIHRoZQogICAqIFtgdG9TdHJpbmdUYWdgXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1vYmplY3QucHJvdG90eXBlLnRvc3RyaW5nKQogICAqIG9mIHZhbHVlcy4KICAgKi8KICB2YXIgb2JqZWN0VG9TdHJpbmckMSA9IG9iamVjdFByb3RvJDEudG9TdHJpbmc7CgogIC8qKiBCdWlsdC1pbiB2YWx1ZSByZWZlcmVuY2VzLiAqLwogIHZhciBTeW1ib2wkMSA9IHJvb3QkMS5TeW1ib2w7CgogIC8qKiBVc2VkIHRvIGNvbnZlcnQgc3ltYm9scyB0byBwcmltaXRpdmVzIGFuZCBzdHJpbmdzLiAqLwogIHZhciBzeW1ib2xQcm90byA9IFN5bWJvbCQxID8gU3ltYm9sJDEucHJvdG90eXBlIDogdW5kZWZpbmVkLAogICAgICBzeW1ib2xUb1N0cmluZyA9IHN5bWJvbFByb3RvID8gc3ltYm9sUHJvdG8udG9TdHJpbmcgOiB1bmRlZmluZWQ7CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnNsaWNlYCB3aXRob3V0IGFuIGl0ZXJhdGVlIGNhbGwgZ3VhcmQuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBzbGljZS4KICAgKiBAcGFyYW0ge251bWJlcn0gW3N0YXJ0PTBdIFRoZSBzdGFydCBwb3NpdGlvbi4KICAgKiBAcGFyYW0ge251bWJlcn0gW2VuZD1hcnJheS5sZW5ndGhdIFRoZSBlbmQgcG9zaXRpb24uCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBzbGljZSBvZiBgYXJyYXlgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VTbGljZShhcnJheSwgc3RhcnQsIGVuZCkgewogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwoKICAgIGlmIChzdGFydCA8IDApIHsKICAgICAgc3RhcnQgPSAtc3RhcnQgPiBsZW5ndGggPyAwIDogKGxlbmd0aCArIHN0YXJ0KTsKICAgIH0KICAgIGVuZCA9IGVuZCA+IGxlbmd0aCA/IGxlbmd0aCA6IGVuZDsKICAgIGlmIChlbmQgPCAwKSB7CiAgICAgIGVuZCArPSBsZW5ndGg7CiAgICB9CiAgICBsZW5ndGggPSBzdGFydCA+IGVuZCA/IDAgOiAoKGVuZCAtIHN0YXJ0KSA+Pj4gMCk7CiAgICBzdGFydCA+Pj49IDA7CgogICAgdmFyIHJlc3VsdCA9IEFycmF5KGxlbmd0aCk7CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICByZXN1bHRbaW5kZXhdID0gYXJyYXlbaW5kZXggKyBzdGFydF07CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8udG9TdHJpbmdgIHdoaWNoIGRvZXNuJ3QgY29udmVydCBudWxsaXNoCiAgICogdmFsdWVzIHRvIGVtcHR5IHN0cmluZ3MuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHByb2Nlc3MuCiAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgc3RyaW5nLgogICAqLwogIGZ1bmN0aW9uIGJhc2VUb1N0cmluZyh2YWx1ZSkgewogICAgLy8gRXhpdCBlYXJseSBmb3Igc3RyaW5ncyB0byBhdm9pZCBhIHBlcmZvcm1hbmNlIGhpdCBpbiBzb21lIGVudmlyb25tZW50cy4KICAgIGlmICh0eXBlb2YgdmFsdWUgPT0gJ3N0cmluZycpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQogICAgaWYgKGlzU3ltYm9sJDEodmFsdWUpKSB7CiAgICAgIHJldHVybiBzeW1ib2xUb1N0cmluZyA/IHN5bWJvbFRvU3RyaW5nLmNhbGwodmFsdWUpIDogJyc7CiAgICB9CiAgICB2YXIgcmVzdWx0ID0gKHZhbHVlICsgJycpOwogICAgcmV0dXJuIChyZXN1bHQgPT0gJzAnICYmICgxIC8gdmFsdWUpID09IC1JTkZJTklUWSkgPyAnLTAnIDogcmVzdWx0OwogIH0KCiAgLyoqCiAgICogQ2FzdHMgYGFycmF5YCB0byBhIHNsaWNlIGlmIGl0J3MgbmVlZGVkLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0ge251bWJlcn0gc3RhcnQgVGhlIHN0YXJ0IHBvc2l0aW9uLgogICAqIEBwYXJhbSB7bnVtYmVyfSBbZW5kPWFycmF5Lmxlbmd0aF0gVGhlIGVuZCBwb3NpdGlvbi4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGNhc3Qgc2xpY2UuCiAgICovCiAgZnVuY3Rpb24gY2FzdFNsaWNlKGFycmF5LCBzdGFydCwgZW5kKSB7CiAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwogICAgZW5kID0gZW5kID09PSB1bmRlZmluZWQgPyBsZW5ndGggOiBlbmQ7CiAgICByZXR1cm4gKCFzdGFydCAmJiBlbmQgPj0gbGVuZ3RoKSA/IGFycmF5IDogYmFzZVNsaWNlKGFycmF5LCBzdGFydCwgZW5kKTsKICB9CgogIC8qKgogICAqIENyZWF0ZXMgYSBmdW5jdGlvbiBsaWtlIGBfLmxvd2VyRmlyc3RgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge3N0cmluZ30gbWV0aG9kTmFtZSBUaGUgbmFtZSBvZiB0aGUgYFN0cmluZ2AgY2FzZSBtZXRob2QgdG8gdXNlLgogICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gUmV0dXJucyB0aGUgbmV3IGNhc2UgZnVuY3Rpb24uCiAgICovCiAgZnVuY3Rpb24gY3JlYXRlQ2FzZUZpcnN0KG1ldGhvZE5hbWUpIHsKICAgIHJldHVybiBmdW5jdGlvbihzdHJpbmcpIHsKICAgICAgc3RyaW5nID0gdG9TdHJpbmcoc3RyaW5nKTsKCiAgICAgIHZhciBzdHJTeW1ib2xzID0gaGFzVW5pY29kZShzdHJpbmcpCiAgICAgICAgPyBzdHJpbmdUb0FycmF5KHN0cmluZykKICAgICAgICA6IHVuZGVmaW5lZDsKCiAgICAgIHZhciBjaHIgPSBzdHJTeW1ib2xzCiAgICAgICAgPyBzdHJTeW1ib2xzWzBdCiAgICAgICAgOiBzdHJpbmcuY2hhckF0KDApOwoKICAgICAgdmFyIHRyYWlsaW5nID0gc3RyU3ltYm9scwogICAgICAgID8gY2FzdFNsaWNlKHN0clN5bWJvbHMsIDEpLmpvaW4oJycpCiAgICAgICAgOiBzdHJpbmcuc2xpY2UoMSk7CgogICAgICByZXR1cm4gY2hyW21ldGhvZE5hbWVdKCkgKyB0cmFpbGluZzsKICAgIH07CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGEgZnVuY3Rpb24gbGlrZSBgXy5jYW1lbENhc2VgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBUaGUgZnVuY3Rpb24gdG8gY29tYmluZSBlYWNoIHdvcmQuCiAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgY29tcG91bmRlciBmdW5jdGlvbi4KICAgKi8KICBmdW5jdGlvbiBjcmVhdGVDb21wb3VuZGVyKGNhbGxiYWNrKSB7CiAgICByZXR1cm4gZnVuY3Rpb24oc3RyaW5nKSB7CiAgICAgIHJldHVybiBhcnJheVJlZHVjZSh3b3JkcyhkZWJ1cnIoc3RyaW5nKS5yZXBsYWNlKHJlQXBvcywgJycpKSwgY2FsbGJhY2ssICcnKTsKICAgIH07CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBvYmplY3QtbGlrZS4gQSB2YWx1ZSBpcyBvYmplY3QtbGlrZSBpZiBpdCdzIG5vdCBgbnVsbGAKICAgKiBhbmQgaGFzIGEgYHR5cGVvZmAgcmVzdWx0IG9mICJvYmplY3QiLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMC4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBvYmplY3QtbGlrZSwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzT2JqZWN0TGlrZSh7fSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc09iamVjdExpa2UoWzEsIDIsIDNdKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzT2JqZWN0TGlrZShfLm5vb3ApOwogICAqIC8vID0+IGZhbHNlCiAgICoKICAgKiBfLmlzT2JqZWN0TGlrZShudWxsKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIGZ1bmN0aW9uIGlzT2JqZWN0TGlrZSQxKHZhbHVlKSB7CiAgICByZXR1cm4gISF2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT0gJ29iamVjdCc7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBjbGFzc2lmaWVkIGFzIGEgYFN5bWJvbGAgcHJpbWl0aXZlIG9yIG9iamVjdC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBzeW1ib2wsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc1N5bWJvbChTeW1ib2wuaXRlcmF0b3IpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNTeW1ib2woJ2FiYycpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNTeW1ib2wkMSh2YWx1ZSkgewogICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PSAnc3ltYm9sJyB8fAogICAgICAoaXNPYmplY3RMaWtlJDEodmFsdWUpICYmIG9iamVjdFRvU3RyaW5nJDEuY2FsbCh2YWx1ZSkgPT0gc3ltYm9sVGFnJDEpOwogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYHZhbHVlYCB0byBhIHN0cmluZy4gQW4gZW1wdHkgc3RyaW5nIGlzIHJldHVybmVkIGZvciBgbnVsbGAKICAgKiBhbmQgYHVuZGVmaW5lZGAgdmFsdWVzLiBUaGUgc2lnbiBvZiBgLTBgIGlzIHByZXNlcnZlZC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcHJvY2Vzcy4KICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBzdHJpbmcuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8udG9TdHJpbmcobnVsbCk7CiAgICogLy8gPT4gJycKICAgKgogICAqIF8udG9TdHJpbmcoLTApOwogICAqIC8vID0+ICctMCcKICAgKgogICAqIF8udG9TdHJpbmcoWzEsIDIsIDNdKTsKICAgKiAvLyA9PiAnMSwyLDMnCiAgICovCiAgZnVuY3Rpb24gdG9TdHJpbmcodmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZSA9PSBudWxsID8gJycgOiBiYXNlVG9TdHJpbmcodmFsdWUpOwogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYHN0cmluZ2AgdG8gW2NhbWVsIGNhc2VdKGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0NhbWVsQ2FzZSkuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMy4wLjAKICAgKiBAY2F0ZWdvcnkgU3RyaW5nCiAgICogQHBhcmFtIHtzdHJpbmd9IFtzdHJpbmc9JyddIFRoZSBzdHJpbmcgdG8gY29udmVydC4KICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBjYW1lbCBjYXNlZCBzdHJpbmcuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uY2FtZWxDYXNlKCdGb28gQmFyJyk7CiAgICogLy8gPT4gJ2Zvb0JhcicKICAgKgogICAqIF8uY2FtZWxDYXNlKCctLWZvby1iYXItLScpOwogICAqIC8vID0+ICdmb29CYXInCiAgICoKICAgKiBfLmNhbWVsQ2FzZSgnX19GT09fQkFSX18nKTsKICAgKiAvLyA9PiAnZm9vQmFyJwogICAqLwogIHZhciBjYW1lbENhc2UgPSBjcmVhdGVDb21wb3VuZGVyKGZ1bmN0aW9uKHJlc3VsdCwgd29yZCwgaW5kZXgpIHsKICAgIHdvcmQgPSB3b3JkLnRvTG93ZXJDYXNlKCk7CiAgICByZXR1cm4gcmVzdWx0ICsgKGluZGV4ID8gY2FwaXRhbGl6ZSh3b3JkKSA6IHdvcmQpOwogIH0pOwoKICAvKioKICAgKiBDb252ZXJ0cyB0aGUgZmlyc3QgY2hhcmFjdGVyIG9mIGBzdHJpbmdgIHRvIHVwcGVyIGNhc2UgYW5kIHRoZSByZW1haW5pbmcKICAgKiB0byBsb3dlciBjYXNlLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDMuMC4wCiAgICogQGNhdGVnb3J5IFN0cmluZwogICAqIEBwYXJhbSB7c3RyaW5nfSBbc3RyaW5nPScnXSBUaGUgc3RyaW5nIHRvIGNhcGl0YWxpemUuCiAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgY2FwaXRhbGl6ZWQgc3RyaW5nLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmNhcGl0YWxpemUoJ0ZSRUQnKTsKICAgKiAvLyA9PiAnRnJlZCcKICAgKi8KICBmdW5jdGlvbiBjYXBpdGFsaXplKHN0cmluZykgewogICAgcmV0dXJuIHVwcGVyRmlyc3QodG9TdHJpbmcoc3RyaW5nKS50b0xvd2VyQ2FzZSgpKTsKICB9CgogIC8qKgogICAqIERlYnVycnMgYHN0cmluZ2AgYnkgY29udmVydGluZwogICAqIFtMYXRpbi0xIFN1cHBsZW1lbnRdKGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xhdGluLTFfU3VwcGxlbWVudF8oVW5pY29kZV9ibG9jaykjQ2hhcmFjdGVyX3RhYmxlKQogICAqIGFuZCBbTGF0aW4gRXh0ZW5kZWQtQV0oaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGF0aW5fRXh0ZW5kZWQtQSkKICAgKiBsZXR0ZXJzIHRvIGJhc2ljIExhdGluIGxldHRlcnMgYW5kIHJlbW92aW5nCiAgICogW2NvbWJpbmluZyBkaWFjcml0aWNhbCBtYXJrc10oaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ29tYmluaW5nX0RpYWNyaXRpY2FsX01hcmtzKS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAzLjAuMAogICAqIEBjYXRlZ29yeSBTdHJpbmcKICAgKiBAcGFyYW0ge3N0cmluZ30gW3N0cmluZz0nJ10gVGhlIHN0cmluZyB0byBkZWJ1cnIuCiAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgZGVidXJyZWQgc3RyaW5nLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmRlYnVycignZMOpasOgIHZ1Jyk7CiAgICogLy8gPT4gJ2RlamEgdnUnCiAgICovCiAgZnVuY3Rpb24gZGVidXJyKHN0cmluZykgewogICAgc3RyaW5nID0gdG9TdHJpbmcoc3RyaW5nKTsKICAgIHJldHVybiBzdHJpbmcgJiYgc3RyaW5nLnJlcGxhY2UocmVMYXRpbiwgZGVidXJyTGV0dGVyKS5yZXBsYWNlKHJlQ29tYm9NYXJrLCAnJyk7CiAgfQoKICAvKioKICAgKiBDb252ZXJ0cyB0aGUgZmlyc3QgY2hhcmFjdGVyIG9mIGBzdHJpbmdgIHRvIHVwcGVyIGNhc2UuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgU3RyaW5nCiAgICogQHBhcmFtIHtzdHJpbmd9IFtzdHJpbmc9JyddIFRoZSBzdHJpbmcgdG8gY29udmVydC4KICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBjb252ZXJ0ZWQgc3RyaW5nLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnVwcGVyRmlyc3QoJ2ZyZWQnKTsKICAgKiAvLyA9PiAnRnJlZCcKICAgKgogICAqIF8udXBwZXJGaXJzdCgnRlJFRCcpOwogICAqIC8vID0+ICdGUkVEJwogICAqLwogIHZhciB1cHBlckZpcnN0ID0gY3JlYXRlQ2FzZUZpcnN0KCd0b1VwcGVyQ2FzZScpOwoKICAvKioKICAgKiBTcGxpdHMgYHN0cmluZ2AgaW50byBhbiBhcnJheSBvZiBpdHMgd29yZHMuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMy4wLjAKICAgKiBAY2F0ZWdvcnkgU3RyaW5nCiAgICogQHBhcmFtIHtzdHJpbmd9IFtzdHJpbmc9JyddIFRoZSBzdHJpbmcgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0ge1JlZ0V4cHxzdHJpbmd9IFtwYXR0ZXJuXSBUaGUgcGF0dGVybiB0byBtYXRjaCB3b3Jkcy4KICAgKiBAcGFyYW0tIHtPYmplY3R9IFtndWFyZF0gRW5hYmxlcyB1c2UgYXMgYW4gaXRlcmF0ZWUgZm9yIG1ldGhvZHMgbGlrZSBgXy5tYXBgLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgd29yZHMgb2YgYHN0cmluZ2AuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8ud29yZHMoJ2ZyZWQsIGJhcm5leSwgJiBwZWJibGVzJyk7CiAgICogLy8gPT4gWydmcmVkJywgJ2Jhcm5leScsICdwZWJibGVzJ10KICAgKgogICAqIF8ud29yZHMoJ2ZyZWQsIGJhcm5leSwgJiBwZWJibGVzJywgL1teLCBdKy9nKTsKICAgKiAvLyA9PiBbJ2ZyZWQnLCAnYmFybmV5JywgJyYnLCAncGViYmxlcyddCiAgICovCiAgZnVuY3Rpb24gd29yZHMoc3RyaW5nLCBwYXR0ZXJuLCBndWFyZCkgewogICAgc3RyaW5nID0gdG9TdHJpbmcoc3RyaW5nKTsKICAgIHBhdHRlcm4gPSBndWFyZCA/IHVuZGVmaW5lZCA6IHBhdHRlcm47CgogICAgaWYgKHBhdHRlcm4gPT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4gaGFzVW5pY29kZVdvcmQoc3RyaW5nKSA/IHVuaWNvZGVXb3JkcyhzdHJpbmcpIDogYXNjaWlXb3JkcyhzdHJpbmcpOwogICAgfQogICAgcmV0dXJuIHN0cmluZy5tYXRjaChwYXR0ZXJuKSB8fCBbXTsKICB9CgogIHZhciBsb2Rhc2hfY2FtZWxjYXNlID0gY2FtZWxDYXNlOwoKICAvKioKICAgKiBDb25zdGFudHMuCiAgICovCgogIHZhciBJU19NQUMgPSB0eXBlb2Ygd2luZG93ICE9ICd1bmRlZmluZWQnICYmIC9NYWN8aVBvZHxpUGhvbmV8aVBhZC8udGVzdCh3aW5kb3cubmF2aWdhdG9yLnBsYXRmb3JtKTsKCiAgdmFyIE1PRElGSUVSUyA9IHsKICAgIGFsdDogJ2FsdEtleScsCiAgICBjb250cm9sOiAnY3RybEtleScsCiAgICBtZXRhOiAnbWV0YUtleScsCiAgICBzaGlmdDogJ3NoaWZ0S2V5JwogIH07CgogIHZhciBBTElBU0VTID0gewogICAgYWRkOiAnKycsCiAgICBicmVhazogJ3BhdXNlJywKICAgIGNtZDogJ21ldGEnLAogICAgY29tbWFuZDogJ21ldGEnLAogICAgY3RsOiAnY29udHJvbCcsCiAgICBjdHJsOiAnY29udHJvbCcsCiAgICBkZWw6ICdkZWxldGUnLAogICAgZG93bjogJ2Fycm93ZG93bicsCiAgICBlc2M6ICdlc2NhcGUnLAogICAgaW5zOiAnaW5zZXJ0JywKICAgIGxlZnQ6ICdhcnJvd2xlZnQnLAogICAgbW9kOiBJU19NQUMgPyAnbWV0YScgOiAnY29udHJvbCcsCiAgICBvcHQ6ICdhbHQnLAogICAgb3B0aW9uOiAnYWx0JywKICAgIHJldHVybjogJ2VudGVyJywKICAgIHJpZ2h0OiAnYXJyb3dyaWdodCcsCiAgICBzcGFjZTogJyAnLAogICAgc3BhY2ViYXI6ICcgJywKICAgIHVwOiAnYXJyb3d1cCcsCiAgICB3aW46ICdtZXRhJywKICAgIHdpbmRvd3M6ICdtZXRhJwogIH07CgogIHZhciBDT0RFUyA9IHsKICAgIGJhY2tzcGFjZTogOCwKICAgIHRhYjogOSwKICAgIGVudGVyOiAxMywKICAgIHNoaWZ0OiAxNiwKICAgIGNvbnRyb2w6IDE3LAogICAgYWx0OiAxOCwKICAgIHBhdXNlOiAxOSwKICAgIGNhcHNsb2NrOiAyMCwKICAgIGVzY2FwZTogMjcsCiAgICAnICc6IDMyLAogICAgcGFnZXVwOiAzMywKICAgIHBhZ2Vkb3duOiAzNCwKICAgIGVuZDogMzUsCiAgICBob21lOiAzNiwKICAgIGFycm93bGVmdDogMzcsCiAgICBhcnJvd3VwOiAzOCwKICAgIGFycm93cmlnaHQ6IDM5LAogICAgYXJyb3dkb3duOiA0MCwKICAgIGluc2VydDogNDUsCiAgICBkZWxldGU6IDQ2LAogICAgbWV0YTogOTEsCiAgICBudW1sb2NrOiAxNDQsCiAgICBzY3JvbGxsb2NrOiAxNDUsCiAgICAnOyc6IDE4NiwKICAgICc9JzogMTg3LAogICAgJywnOiAxODgsCiAgICAnLSc6IDE4OSwKICAgICcuJzogMTkwLAogICAgJy8nOiAxOTEsCiAgICAnYCc6IDE5MiwKICAgICdbJzogMjE5LAogICAgJ1xcJzogMjIwLAogICAgJ10nOiAyMjEsCiAgICAnXCcnOiAyMjIKICB9OwoKICBmb3IgKHZhciBmID0gMTsgZiA8IDIwOyBmKyspIHsKICAgIENPREVTWydmJyArIGZdID0gMTExICsgZjsKICB9CgogIC8qKgogICAqIElzIGhvdGtleT8KICAgKi8KCiAgZnVuY3Rpb24gaXNIb3RrZXkoaG90a2V5LCBvcHRpb25zLCBldmVudCkgewogICAgaWYgKG9wdGlvbnMgJiYgISgnYnlLZXknIGluIG9wdGlvbnMpKSB7CiAgICAgIGV2ZW50ID0gb3B0aW9uczsKICAgICAgb3B0aW9ucyA9IG51bGw7CiAgICB9CgogICAgaWYgKCFBcnJheS5pc0FycmF5KGhvdGtleSkpIHsKICAgICAgaG90a2V5ID0gW2hvdGtleV07CiAgICB9CgogICAgdmFyIGFycmF5ID0gaG90a2V5Lm1hcChmdW5jdGlvbiAoc3RyaW5nKSB7CiAgICAgIHJldHVybiBwYXJzZUhvdGtleShzdHJpbmcsIG9wdGlvbnMpOwogICAgfSk7CiAgICB2YXIgY2hlY2sgPSBmdW5jdGlvbiBjaGVjayhlKSB7CiAgICAgIHJldHVybiBhcnJheS5zb21lKGZ1bmN0aW9uIChvYmplY3QpIHsKICAgICAgICByZXR1cm4gY29tcGFyZUhvdGtleShvYmplY3QsIGUpOwogICAgICB9KTsKICAgIH07CiAgICB2YXIgcmV0ID0gZXZlbnQgPT0gbnVsbCA/IGNoZWNrIDogY2hlY2soZXZlbnQpOwogICAgcmV0dXJuIHJldDsKICB9CgogIGZ1bmN0aW9uIGlzQ29kZUhvdGtleShob3RrZXksIGV2ZW50KSB7CiAgICByZXR1cm4gaXNIb3RrZXkoaG90a2V5LCBldmVudCk7CiAgfQoKICBmdW5jdGlvbiBpc0tleUhvdGtleShob3RrZXksIGV2ZW50KSB7CiAgICByZXR1cm4gaXNIb3RrZXkoaG90a2V5LCB7IGJ5S2V5OiB0cnVlIH0sIGV2ZW50KTsKICB9CgogIC8qKgogICAqIFBhcnNlLgogICAqLwoKICBmdW5jdGlvbiBwYXJzZUhvdGtleShob3RrZXksIG9wdGlvbnMpIHsKICAgIHZhciBieUtleSA9IG9wdGlvbnMgJiYgb3B0aW9ucy5ieUtleTsKICAgIHZhciByZXQgPSB7fTsKCiAgICAvLyBTcGVjaWFsIGNhc2UgdG8gaGFuZGxlIHRoZSBgK2Aga2V5IHNpbmNlIHdlIHVzZSBpdCBhcyBhIHNlcGFyYXRvci4KICAgIGhvdGtleSA9IGhvdGtleS5yZXBsYWNlKCcrKycsICcrYWRkJyk7CiAgICB2YXIgdmFsdWVzID0gaG90a2V5LnNwbGl0KCcrJyk7CiAgICB2YXIgbGVuZ3RoID0gdmFsdWVzLmxlbmd0aDsKCiAgICAvLyBFbnN1cmUgdGhhdCBhbGwgdGhlIG1vZGlmaWVycyBhcmUgc2V0IHRvIGZhbHNlIHVubGVzcyB0aGUgaG90a2V5IGhhcyB0aGVtLgoKICAgIGZvciAodmFyIGsgaW4gTU9ESUZJRVJTKSB7CiAgICAgIHJldFtNT0RJRklFUlNba11dID0gZmFsc2U7CiAgICB9CgogICAgdmFyIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlOwogICAgdmFyIF9kaWRJdGVyYXRvckVycm9yID0gZmFsc2U7CiAgICB2YXIgX2l0ZXJhdG9yRXJyb3IgPSB1bmRlZmluZWQ7CgogICAgdHJ5IHsKICAgICAgZm9yICh2YXIgX2l0ZXJhdG9yID0gdmFsdWVzW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXA7ICEoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IChfc3RlcCA9IF9pdGVyYXRvci5uZXh0KCkpLmRvbmUpOyBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gdHJ1ZSkgewogICAgICAgIHZhciB2YWx1ZSA9IF9zdGVwLnZhbHVlOwoKICAgICAgICB2YXIgb3B0aW9uYWwgPSB2YWx1ZS5lbmRzV2l0aCgnPycpICYmIHZhbHVlLmxlbmd0aCA+IDE7CgogICAgICAgIGlmIChvcHRpb25hbCkgewogICAgICAgICAgdmFsdWUgPSB2YWx1ZS5zbGljZSgwLCAtMSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgbmFtZSA9IHRvS2V5TmFtZSh2YWx1ZSk7CiAgICAgICAgdmFyIG1vZGlmaWVyID0gTU9ESUZJRVJTW25hbWVdOwoKICAgICAgICBpZiAodmFsdWUubGVuZ3RoID4gMSAmJiAhbW9kaWZpZXIgJiYgIUFMSUFTRVNbdmFsdWVdICYmICFDT0RFU1tuYW1lXSkgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVW5rbm93biBtb2RpZmllcjogIicgKyB2YWx1ZSArICciJyk7CiAgICAgICAgfQoKICAgICAgICBpZiAobGVuZ3RoID09PSAxIHx8ICFtb2RpZmllcikgewogICAgICAgICAgaWYgKGJ5S2V5KSB7CiAgICAgICAgICAgIHJldC5rZXkgPSBuYW1lOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0LndoaWNoID0gdG9LZXlDb2RlKHZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChtb2RpZmllcikgewogICAgICAgICAgcmV0W21vZGlmaWVyXSA9IG9wdGlvbmFsID8gbnVsbCA6IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgX2RpZEl0ZXJhdG9yRXJyb3IgPSB0cnVlOwogICAgICBfaXRlcmF0b3JFcnJvciA9IGVycjsKICAgIH0gZmluYWxseSB7CiAgICAgIHRyeSB7CiAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uICYmIF9pdGVyYXRvci5yZXR1cm4pIHsKICAgICAgICAgIF9pdGVyYXRvci5yZXR1cm4oKTsKICAgICAgICB9CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgaWYgKF9kaWRJdGVyYXRvckVycm9yKSB7CiAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gcmV0OwogIH0KCiAgLyoqCiAgICogQ29tcGFyZS4KICAgKi8KCiAgZnVuY3Rpb24gY29tcGFyZUhvdGtleShvYmplY3QsIGV2ZW50KSB7CiAgICBmb3IgKHZhciBrZXkgaW4gb2JqZWN0KSB7CiAgICAgIHZhciBleHBlY3RlZCA9IG9iamVjdFtrZXldOwogICAgICB2YXIgYWN0dWFsID0gdm9pZCAwOwoKICAgICAgaWYgKGV4cGVjdGVkID09IG51bGwpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQoKICAgICAgaWYgKGtleSA9PT0gJ2tleScgJiYgZXZlbnQua2V5ICE9IG51bGwpIHsKICAgICAgICBhY3R1YWwgPSBldmVudC5rZXkudG9Mb3dlckNhc2UoKTsKICAgICAgfSBlbHNlIGlmIChrZXkgPT09ICd3aGljaCcpIHsKICAgICAgICBhY3R1YWwgPSBleHBlY3RlZCA9PT0gOTEgJiYgZXZlbnQud2hpY2ggPT09IDkzID8gOTEgOiBldmVudC53aGljaDsKICAgICAgfSBlbHNlIHsKICAgICAgICBhY3R1YWwgPSBldmVudFtrZXldOwogICAgICB9CgogICAgICBpZiAoYWN0dWFsID09IG51bGwgJiYgZXhwZWN0ZWQgPT09IGZhbHNlKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIGlmIChhY3R1YWwgIT09IGV4cGVjdGVkKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBVdGlscy4KICAgKi8KCiAgZnVuY3Rpb24gdG9LZXlDb2RlKG5hbWUpIHsKICAgIG5hbWUgPSB0b0tleU5hbWUobmFtZSk7CiAgICB2YXIgY29kZSA9IENPREVTW25hbWVdIHx8IG5hbWUudG9VcHBlckNhc2UoKS5jaGFyQ29kZUF0KDApOwogICAgcmV0dXJuIGNvZGU7CiAgfQoKICBmdW5jdGlvbiB0b0tleU5hbWUobmFtZSkgewogICAgbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKICAgIG5hbWUgPSBBTElBU0VTW25hbWVdIHx8IG5hbWU7CiAgICByZXR1cm4gbmFtZTsKICB9CgogIC8qKgogICAqIEV4cG9ydC4KICAgKi8KCiAgdmFyIF9kZWZhdWx0ID0gaXNIb3RrZXk7CiAgdmFyIGlzSG90a2V5XzEgPSBpc0hvdGtleTsKICB2YXIgaXNDb2RlSG90a2V5XzEgPSBpc0NvZGVIb3RrZXk7CiAgdmFyIGlzS2V5SG90a2V5XzEgPSBpc0tleUhvdGtleTsKICB2YXIgcGFyc2VIb3RrZXlfMSA9IHBhcnNlSG90a2V5OwogIHZhciBjb21wYXJlSG90a2V5XzEgPSBjb21wYXJlSG90a2V5OwogIHZhciB0b0tleUNvZGVfMSA9IHRvS2V5Q29kZTsKICB2YXIgdG9LZXlOYW1lXzEgPSB0b0tleU5hbWU7CgogIHZhciBsaWIkNCA9IC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogIAlkZWZhdWx0OiBfZGVmYXVsdCwKICAJaXNIb3RrZXk6IGlzSG90a2V5XzEsCiAgCWlzQ29kZUhvdGtleTogaXNDb2RlSG90a2V5XzEsCiAgCWlzS2V5SG90a2V5OiBpc0tleUhvdGtleV8xLAogIAlwYXJzZUhvdGtleTogcGFyc2VIb3RrZXlfMSwKICAJY29tcGFyZUhvdGtleTogY29tcGFyZUhvdGtleV8xLAogIAl0b0tleUNvZGU6IHRvS2V5Q29kZV8xLAogIAl0b0tleU5hbWU6IHRvS2V5TmFtZV8xCiAgfSwgJ19fZXNNb2R1bGUnLCB7dmFsdWU6IHRydWV9KTsKCiAgLyoqCiAgICogbG9kYXNoIChDdXN0b20gQnVpbGQpIDxodHRwczovL2xvZGFzaC5jb20vPgogICAqIEJ1aWxkOiBgbG9kYXNoIG1vZHVsYXJpemUgZXhwb3J0cz0ibnBtIiAtbyAuL2AKICAgKiBDb3B5cmlnaHQgalF1ZXJ5IEZvdW5kYXRpb24gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycyA8aHR0cHM6Ly9qcXVlcnkub3JnLz4KICAgKiBSZWxlYXNlZCB1bmRlciBNSVQgbGljZW5zZSA8aHR0cHM6Ly9sb2Rhc2guY29tL2xpY2Vuc2U+CiAgICogQmFzZWQgb24gVW5kZXJzY29yZS5qcyAxLjguMyA8aHR0cDovL3VuZGVyc2NvcmVqcy5vcmcvTElDRU5TRT4KICAgKiBDb3B5cmlnaHQgSmVyZW15IEFzaGtlbmFzLCBEb2N1bWVudENsb3VkIGFuZCBJbnZlc3RpZ2F0aXZlIFJlcG9ydGVycyAmIEVkaXRvcnMKICAgKi8KCiAgLyoqIFVzZWQgYXMgdGhlIGBUeXBlRXJyb3JgIG1lc3NhZ2UgZm9yICJGdW5jdGlvbnMiIG1ldGhvZHMuICovCiAgdmFyIEZVTkNfRVJST1JfVEVYVCA9ICdFeHBlY3RlZCBhIGZ1bmN0aW9uJzsKCiAgLyoqIFVzZWQgYXMgcmVmZXJlbmNlcyBmb3IgdmFyaW91cyBgTnVtYmVyYCBjb25zdGFudHMuICovCiAgdmFyIE5BTiA9IDAgLyAwOwoKICAvKiogYE9iamVjdCN0b1N0cmluZ2AgcmVzdWx0IHJlZmVyZW5jZXMuICovCiAgdmFyIHN5bWJvbFRhZyA9ICdbb2JqZWN0IFN5bWJvbF0nOwoKICAvKiogVXNlZCB0byBtYXRjaCBsZWFkaW5nIGFuZCB0cmFpbGluZyB3aGl0ZXNwYWNlLiAqLwogIHZhciByZVRyaW0gPSAvXlxzK3xccyskL2c7CgogIC8qKiBVc2VkIHRvIGRldGVjdCBiYWQgc2lnbmVkIGhleGFkZWNpbWFsIHN0cmluZyB2YWx1ZXMuICovCiAgdmFyIHJlSXNCYWRIZXggPSAvXlstK10weFswLTlhLWZdKyQvaTsKCiAgLyoqIFVzZWQgdG8gZGV0ZWN0IGJpbmFyeSBzdHJpbmcgdmFsdWVzLiAqLwogIHZhciByZUlzQmluYXJ5ID0gL14wYlswMV0rJC9pOwoKICAvKiogVXNlZCB0byBkZXRlY3Qgb2N0YWwgc3RyaW5nIHZhbHVlcy4gKi8KICB2YXIgcmVJc09jdGFsID0gL14wb1swLTddKyQvaTsKCiAgLyoqIEJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzIHdpdGhvdXQgYSBkZXBlbmRlbmN5IG9uIGByb290YC4gKi8KICB2YXIgZnJlZVBhcnNlSW50ID0gcGFyc2VJbnQ7CgogIC8qKiBEZXRlY3QgZnJlZSB2YXJpYWJsZSBgZ2xvYmFsYCBmcm9tIE5vZGUuanMuICovCiAgdmFyIGZyZWVHbG9iYWwgPSB0eXBlb2YgY29tbW9uanNHbG9iYWwgPT0gJ29iamVjdCcgJiYgY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuT2JqZWN0ID09PSBPYmplY3QgJiYgY29tbW9uanNHbG9iYWw7CgogIC8qKiBEZXRlY3QgZnJlZSB2YXJpYWJsZSBgc2VsZmAuICovCiAgdmFyIGZyZWVTZWxmID0gdHlwZW9mIHNlbGYgPT0gJ29iamVjdCcgJiYgc2VsZiAmJiBzZWxmLk9iamVjdCA9PT0gT2JqZWN0ICYmIHNlbGY7CgogIC8qKiBVc2VkIGFzIGEgcmVmZXJlbmNlIHRvIHRoZSBnbG9iYWwgb2JqZWN0LiAqLwogIHZhciByb290ID0gZnJlZUdsb2JhbCB8fCBmcmVlU2VsZiB8fCBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpOwoKICAvKiogVXNlZCBmb3IgYnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMuICovCiAgdmFyIG9iamVjdFByb3RvID0gT2JqZWN0LnByb3RvdHlwZTsKCiAgLyoqCiAgICogVXNlZCB0byByZXNvbHZlIHRoZQogICAqIFtgdG9TdHJpbmdUYWdgXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1vYmplY3QucHJvdG90eXBlLnRvc3RyaW5nKQogICAqIG9mIHZhbHVlcy4KICAgKi8KICB2YXIgb2JqZWN0VG9TdHJpbmcgPSBvYmplY3RQcm90by50b1N0cmluZzsKCiAgLyogQnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMgZm9yIHRob3NlIHdpdGggdGhlIHNhbWUgbmFtZSBhcyBvdGhlciBgbG9kYXNoYCBtZXRob2RzLiAqLwogIHZhciBuYXRpdmVNYXggPSBNYXRoLm1heCwKICAgICAgbmF0aXZlTWluID0gTWF0aC5taW47CgogIC8qKgogICAqIEdldHMgdGhlIHRpbWVzdGFtcCBvZiB0aGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0aGF0IGhhdmUgZWxhcHNlZCBzaW5jZQogICAqIHRoZSBVbml4IGVwb2NoICgxIEphbnVhcnkgMTk3MCAwMDowMDowMCBVVEMpLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDIuNC4wCiAgICogQGNhdGVnb3J5IERhdGUKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSB0aW1lc3RhbXAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uZGVmZXIoZnVuY3Rpb24oc3RhbXApIHsKICAgKiAgIGNvbnNvbGUubG9nKF8ubm93KCkgLSBzdGFtcCk7CiAgICogfSwgXy5ub3coKSk7CiAgICogLy8gPT4gTG9ncyB0aGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyBpdCB0b29rIGZvciB0aGUgZGVmZXJyZWQgaW52b2NhdGlvbi4KICAgKi8KICB2YXIgbm93ID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gcm9vdC5EYXRlLm5vdygpOwogIH07CgogIC8qKgogICAqIENyZWF0ZXMgYSBkZWJvdW5jZWQgZnVuY3Rpb24gdGhhdCBkZWxheXMgaW52b2tpbmcgYGZ1bmNgIHVudGlsIGFmdGVyIGB3YWl0YAogICAqIG1pbGxpc2Vjb25kcyBoYXZlIGVsYXBzZWQgc2luY2UgdGhlIGxhc3QgdGltZSB0aGUgZGVib3VuY2VkIGZ1bmN0aW9uIHdhcwogICAqIGludm9rZWQuIFRoZSBkZWJvdW5jZWQgZnVuY3Rpb24gY29tZXMgd2l0aCBhIGBjYW5jZWxgIG1ldGhvZCB0byBjYW5jZWwKICAgKiBkZWxheWVkIGBmdW5jYCBpbnZvY2F0aW9ucyBhbmQgYSBgZmx1c2hgIG1ldGhvZCB0byBpbW1lZGlhdGVseSBpbnZva2UgdGhlbS4KICAgKiBQcm92aWRlIGBvcHRpb25zYCB0byBpbmRpY2F0ZSB3aGV0aGVyIGBmdW5jYCBzaG91bGQgYmUgaW52b2tlZCBvbiB0aGUKICAgKiBsZWFkaW5nIGFuZC9vciB0cmFpbGluZyBlZGdlIG9mIHRoZSBgd2FpdGAgdGltZW91dC4gVGhlIGBmdW5jYCBpcyBpbnZva2VkCiAgICogd2l0aCB0aGUgbGFzdCBhcmd1bWVudHMgcHJvdmlkZWQgdG8gdGhlIGRlYm91bmNlZCBmdW5jdGlvbi4gU3Vic2VxdWVudAogICAqIGNhbGxzIHRvIHRoZSBkZWJvdW5jZWQgZnVuY3Rpb24gcmV0dXJuIHRoZSByZXN1bHQgb2YgdGhlIGxhc3QgYGZ1bmNgCiAgICogaW52b2NhdGlvbi4KICAgKgogICAqICoqTm90ZToqKiBJZiBgbGVhZGluZ2AgYW5kIGB0cmFpbGluZ2Agb3B0aW9ucyBhcmUgYHRydWVgLCBgZnVuY2AgaXMKICAgKiBpbnZva2VkIG9uIHRoZSB0cmFpbGluZyBlZGdlIG9mIHRoZSB0aW1lb3V0IG9ubHkgaWYgdGhlIGRlYm91bmNlZCBmdW5jdGlvbgogICAqIGlzIGludm9rZWQgbW9yZSB0aGFuIG9uY2UgZHVyaW5nIHRoZSBgd2FpdGAgdGltZW91dC4KICAgKgogICAqIElmIGB3YWl0YCBpcyBgMGAgYW5kIGBsZWFkaW5nYCBpcyBgZmFsc2VgLCBgZnVuY2AgaW52b2NhdGlvbiBpcyBkZWZlcnJlZAogICAqIHVudGlsIHRvIHRoZSBuZXh0IHRpY2ssIHNpbWlsYXIgdG8gYHNldFRpbWVvdXRgIHdpdGggYSB0aW1lb3V0IG9mIGAwYC4KICAgKgogICAqIFNlZSBbRGF2aWQgQ29yYmFjaG8ncyBhcnRpY2xlXShodHRwczovL2Nzcy10cmlja3MuY29tL2RlYm91bmNpbmctdGhyb3R0bGluZy1leHBsYWluZWQtZXhhbXBsZXMvKQogICAqIGZvciBkZXRhaWxzIG92ZXIgdGhlIGRpZmZlcmVuY2VzIGJldHdlZW4gYF8uZGVib3VuY2VgIGFuZCBgXy50aHJvdHRsZWAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgRnVuY3Rpb24KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBkZWJvdW5jZS4KICAgKiBAcGFyYW0ge251bWJlcn0gW3dhaXQ9MF0gVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gZGVsYXkuCiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zPXt9XSBUaGUgb3B0aW9ucyBvYmplY3QuCiAgICogQHBhcmFtIHtib29sZWFufSBbb3B0aW9ucy5sZWFkaW5nPWZhbHNlXQogICAqICBTcGVjaWZ5IGludm9raW5nIG9uIHRoZSBsZWFkaW5nIGVkZ2Ugb2YgdGhlIHRpbWVvdXQuCiAgICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLm1heFdhaXRdCiAgICogIFRoZSBtYXhpbXVtIHRpbWUgYGZ1bmNgIGlzIGFsbG93ZWQgdG8gYmUgZGVsYXllZCBiZWZvcmUgaXQncyBpbnZva2VkLgogICAqIEBwYXJhbSB7Ym9vbGVhbn0gW29wdGlvbnMudHJhaWxpbmc9dHJ1ZV0KICAgKiAgU3BlY2lmeSBpbnZva2luZyBvbiB0aGUgdHJhaWxpbmcgZWRnZSBvZiB0aGUgdGltZW91dC4KICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBkZWJvdW5jZWQgZnVuY3Rpb24uCiAgICogQGV4YW1wbGUKICAgKgogICAqIC8vIEF2b2lkIGNvc3RseSBjYWxjdWxhdGlvbnMgd2hpbGUgdGhlIHdpbmRvdyBzaXplIGlzIGluIGZsdXguCiAgICogalF1ZXJ5KHdpbmRvdykub24oJ3Jlc2l6ZScsIF8uZGVib3VuY2UoY2FsY3VsYXRlTGF5b3V0LCAxNTApKTsKICAgKgogICAqIC8vIEludm9rZSBgc2VuZE1haWxgIHdoZW4gY2xpY2tlZCwgZGVib3VuY2luZyBzdWJzZXF1ZW50IGNhbGxzLgogICAqIGpRdWVyeShlbGVtZW50KS5vbignY2xpY2snLCBfLmRlYm91bmNlKHNlbmRNYWlsLCAzMDAsIHsKICAgKiAgICdsZWFkaW5nJzogdHJ1ZSwKICAgKiAgICd0cmFpbGluZyc6IGZhbHNlCiAgICogfSkpOwogICAqCiAgICogLy8gRW5zdXJlIGBiYXRjaExvZ2AgaXMgaW52b2tlZCBvbmNlIGFmdGVyIDEgc2Vjb25kIG9mIGRlYm91bmNlZCBjYWxscy4KICAgKiB2YXIgZGVib3VuY2VkID0gXy5kZWJvdW5jZShiYXRjaExvZywgMjUwLCB7ICdtYXhXYWl0JzogMTAwMCB9KTsKICAgKiB2YXIgc291cmNlID0gbmV3IEV2ZW50U291cmNlKCcvc3RyZWFtJyk7CiAgICogalF1ZXJ5KHNvdXJjZSkub24oJ21lc3NhZ2UnLCBkZWJvdW5jZWQpOwogICAqCiAgICogLy8gQ2FuY2VsIHRoZSB0cmFpbGluZyBkZWJvdW5jZWQgaW52b2NhdGlvbi4KICAgKiBqUXVlcnkod2luZG93KS5vbigncG9wc3RhdGUnLCBkZWJvdW5jZWQuY2FuY2VsKTsKICAgKi8KICBmdW5jdGlvbiBkZWJvdW5jZSQxKGZ1bmMsIHdhaXQsIG9wdGlvbnMpIHsKICAgIHZhciBsYXN0QXJncywKICAgICAgICBsYXN0VGhpcywKICAgICAgICBtYXhXYWl0LAogICAgICAgIHJlc3VsdCwKICAgICAgICB0aW1lcklkLAogICAgICAgIGxhc3RDYWxsVGltZSwKICAgICAgICBsYXN0SW52b2tlVGltZSA9IDAsCiAgICAgICAgbGVhZGluZyA9IGZhbHNlLAogICAgICAgIG1heGluZyA9IGZhbHNlLAogICAgICAgIHRyYWlsaW5nID0gdHJ1ZTsKCiAgICBpZiAodHlwZW9mIGZ1bmMgIT0gJ2Z1bmN0aW9uJykgewogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKEZVTkNfRVJST1JfVEVYVCk7CiAgICB9CiAgICB3YWl0ID0gdG9OdW1iZXIod2FpdCkgfHwgMDsKICAgIGlmIChpc09iamVjdChvcHRpb25zKSkgewogICAgICBsZWFkaW5nID0gISFvcHRpb25zLmxlYWRpbmc7CiAgICAgIG1heGluZyA9ICdtYXhXYWl0JyBpbiBvcHRpb25zOwogICAgICBtYXhXYWl0ID0gbWF4aW5nID8gbmF0aXZlTWF4KHRvTnVtYmVyKG9wdGlvbnMubWF4V2FpdCkgfHwgMCwgd2FpdCkgOiBtYXhXYWl0OwogICAgICB0cmFpbGluZyA9ICd0cmFpbGluZycgaW4gb3B0aW9ucyA/ICEhb3B0aW9ucy50cmFpbGluZyA6IHRyYWlsaW5nOwogICAgfQoKICAgIGZ1bmN0aW9uIGludm9rZUZ1bmModGltZSkgewogICAgICB2YXIgYXJncyA9IGxhc3RBcmdzLAogICAgICAgICAgdGhpc0FyZyA9IGxhc3RUaGlzOwoKICAgICAgbGFzdEFyZ3MgPSBsYXN0VGhpcyA9IHVuZGVmaW5lZDsKICAgICAgbGFzdEludm9rZVRpbWUgPSB0aW1lOwogICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KHRoaXNBcmcsIGFyZ3MpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICAgIGZ1bmN0aW9uIGxlYWRpbmdFZGdlKHRpbWUpIHsKICAgICAgLy8gUmVzZXQgYW55IGBtYXhXYWl0YCB0aW1lci4KICAgICAgbGFzdEludm9rZVRpbWUgPSB0aW1lOwogICAgICAvLyBTdGFydCB0aGUgdGltZXIgZm9yIHRoZSB0cmFpbGluZyBlZGdlLgogICAgICB0aW1lcklkID0gc2V0VGltZW91dCh0aW1lckV4cGlyZWQsIHdhaXQpOwogICAgICAvLyBJbnZva2UgdGhlIGxlYWRpbmcgZWRnZS4KICAgICAgcmV0dXJuIGxlYWRpbmcgPyBpbnZva2VGdW5jKHRpbWUpIDogcmVzdWx0OwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbWFpbmluZ1dhaXQodGltZSkgewogICAgICB2YXIgdGltZVNpbmNlTGFzdENhbGwgPSB0aW1lIC0gbGFzdENhbGxUaW1lLAogICAgICAgICAgdGltZVNpbmNlTGFzdEludm9rZSA9IHRpbWUgLSBsYXN0SW52b2tlVGltZSwKICAgICAgICAgIHJlc3VsdCA9IHdhaXQgLSB0aW1lU2luY2VMYXN0Q2FsbDsKCiAgICAgIHJldHVybiBtYXhpbmcgPyBuYXRpdmVNaW4ocmVzdWx0LCBtYXhXYWl0IC0gdGltZVNpbmNlTGFzdEludm9rZSkgOiByZXN1bHQ7CiAgICB9CgogICAgZnVuY3Rpb24gc2hvdWxkSW52b2tlKHRpbWUpIHsKICAgICAgdmFyIHRpbWVTaW5jZUxhc3RDYWxsID0gdGltZSAtIGxhc3RDYWxsVGltZSwKICAgICAgICAgIHRpbWVTaW5jZUxhc3RJbnZva2UgPSB0aW1lIC0gbGFzdEludm9rZVRpbWU7CgogICAgICAvLyBFaXRoZXIgdGhpcyBpcyB0aGUgZmlyc3QgY2FsbCwgYWN0aXZpdHkgaGFzIHN0b3BwZWQgYW5kIHdlJ3JlIGF0IHRoZQogICAgICAvLyB0cmFpbGluZyBlZGdlLCB0aGUgc3lzdGVtIHRpbWUgaGFzIGdvbmUgYmFja3dhcmRzIGFuZCB3ZSdyZSB0cmVhdGluZwogICAgICAvLyBpdCBhcyB0aGUgdHJhaWxpbmcgZWRnZSwgb3Igd2UndmUgaGl0IHRoZSBgbWF4V2FpdGAgbGltaXQuCiAgICAgIHJldHVybiAobGFzdENhbGxUaW1lID09PSB1bmRlZmluZWQgfHwgKHRpbWVTaW5jZUxhc3RDYWxsID49IHdhaXQpIHx8CiAgICAgICAgKHRpbWVTaW5jZUxhc3RDYWxsIDwgMCkgfHwgKG1heGluZyAmJiB0aW1lU2luY2VMYXN0SW52b2tlID49IG1heFdhaXQpKTsKICAgIH0KCiAgICBmdW5jdGlvbiB0aW1lckV4cGlyZWQoKSB7CiAgICAgIHZhciB0aW1lID0gbm93KCk7CiAgICAgIGlmIChzaG91bGRJbnZva2UodGltZSkpIHsKICAgICAgICByZXR1cm4gdHJhaWxpbmdFZGdlKHRpbWUpOwogICAgICB9CiAgICAgIC8vIFJlc3RhcnQgdGhlIHRpbWVyLgogICAgICB0aW1lcklkID0gc2V0VGltZW91dCh0aW1lckV4cGlyZWQsIHJlbWFpbmluZ1dhaXQodGltZSkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyYWlsaW5nRWRnZSh0aW1lKSB7CiAgICAgIHRpbWVySWQgPSB1bmRlZmluZWQ7CgogICAgICAvLyBPbmx5IGludm9rZSBpZiB3ZSBoYXZlIGBsYXN0QXJnc2Agd2hpY2ggbWVhbnMgYGZ1bmNgIGhhcyBiZWVuCiAgICAgIC8vIGRlYm91bmNlZCBhdCBsZWFzdCBvbmNlLgogICAgICBpZiAodHJhaWxpbmcgJiYgbGFzdEFyZ3MpIHsKICAgICAgICByZXR1cm4gaW52b2tlRnVuYyh0aW1lKTsKICAgICAgfQogICAgICBsYXN0QXJncyA9IGxhc3RUaGlzID0gdW5kZWZpbmVkOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbmNlbCgpIHsKICAgICAgaWYgKHRpbWVySWQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGNsZWFyVGltZW91dCh0aW1lcklkKTsKICAgICAgfQogICAgICBsYXN0SW52b2tlVGltZSA9IDA7CiAgICAgIGxhc3RBcmdzID0gbGFzdENhbGxUaW1lID0gbGFzdFRoaXMgPSB0aW1lcklkID0gdW5kZWZpbmVkOwogICAgfQoKICAgIGZ1bmN0aW9uIGZsdXNoKCkgewogICAgICByZXR1cm4gdGltZXJJZCA9PT0gdW5kZWZpbmVkID8gcmVzdWx0IDogdHJhaWxpbmdFZGdlKG5vdygpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBkZWJvdW5jZWQoKSB7CiAgICAgIHZhciB0aW1lID0gbm93KCksCiAgICAgICAgICBpc0ludm9raW5nID0gc2hvdWxkSW52b2tlKHRpbWUpOwoKICAgICAgbGFzdEFyZ3MgPSBhcmd1bWVudHM7CiAgICAgIGxhc3RUaGlzID0gdGhpczsKICAgICAgbGFzdENhbGxUaW1lID0gdGltZTsKCiAgICAgIGlmIChpc0ludm9raW5nKSB7CiAgICAgICAgaWYgKHRpbWVySWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmV0dXJuIGxlYWRpbmdFZGdlKGxhc3RDYWxsVGltZSk7CiAgICAgICAgfQogICAgICAgIGlmIChtYXhpbmcpIHsKICAgICAgICAgIC8vIEhhbmRsZSBpbnZvY2F0aW9ucyBpbiBhIHRpZ2h0IGxvb3AuCiAgICAgICAgICB0aW1lcklkID0gc2V0VGltZW91dCh0aW1lckV4cGlyZWQsIHdhaXQpOwogICAgICAgICAgcmV0dXJuIGludm9rZUZ1bmMobGFzdENhbGxUaW1lKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHRpbWVySWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHRpbWVySWQgPSBzZXRUaW1lb3V0KHRpbWVyRXhwaXJlZCwgd2FpdCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIGRlYm91bmNlZC5jYW5jZWwgPSBjYW5jZWw7CiAgICBkZWJvdW5jZWQuZmx1c2ggPSBmbHVzaDsKICAgIHJldHVybiBkZWJvdW5jZWQ7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyB0aGUKICAgKiBbbGFuZ3VhZ2UgdHlwZV0oaHR0cDovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLWVjbWFzY3JpcHQtbGFuZ3VhZ2UtdHlwZXMpCiAgICogb2YgYE9iamVjdGAuIChlLmcuIGFycmF5cywgZnVuY3Rpb25zLCBvYmplY3RzLCByZWdleGVzLCBgbmV3IE51bWJlcigwKWAsIGFuZCBgbmV3IFN0cmluZygnJylgKQogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDAuMS4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhbiBvYmplY3QsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc09iamVjdCh7fSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc09iamVjdChbMSwgMiwgM10pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNPYmplY3QoXy5ub29wKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzT2JqZWN0KG51bGwpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNPYmplY3QodmFsdWUpIHsKICAgIHZhciB0eXBlID0gdHlwZW9mIHZhbHVlOwogICAgcmV0dXJuICEhdmFsdWUgJiYgKHR5cGUgPT0gJ29iamVjdCcgfHwgdHlwZSA9PSAnZnVuY3Rpb24nKTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIG9iamVjdC1saWtlLiBBIHZhbHVlIGlzIG9iamVjdC1saWtlIGlmIGl0J3Mgbm90IGBudWxsYAogICAqIGFuZCBoYXMgYSBgdHlwZW9mYCByZXN1bHQgb2YgIm9iamVjdCIuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIG9iamVjdC1saWtlLCBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uaXNPYmplY3RMaWtlKHt9KTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzT2JqZWN0TGlrZShbMSwgMiwgM10pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNPYmplY3RMaWtlKF8ubm9vcCk7CiAgICogLy8gPT4gZmFsc2UKICAgKgogICAqIF8uaXNPYmplY3RMaWtlKG51bGwpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNPYmplY3RMaWtlKHZhbHVlKSB7CiAgICByZXR1cm4gISF2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT0gJ29iamVjdCc7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBjbGFzc2lmaWVkIGFzIGEgYFN5bWJvbGAgcHJpbWl0aXZlIG9yIG9iamVjdC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBzeW1ib2wsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc1N5bWJvbChTeW1ib2wuaXRlcmF0b3IpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNTeW1ib2woJ2FiYycpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNTeW1ib2wodmFsdWUpIHsKICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ3N5bWJvbCcgfHwKICAgICAgKGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgb2JqZWN0VG9TdHJpbmcuY2FsbCh2YWx1ZSkgPT0gc3ltYm9sVGFnKTsKICB9CgogIC8qKgogICAqIENvbnZlcnRzIGB2YWx1ZWAgdG8gYSBudW1iZXIuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHByb2Nlc3MuCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgbnVtYmVyLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnRvTnVtYmVyKDMuMik7CiAgICogLy8gPT4gMy4yCiAgICoKICAgKiBfLnRvTnVtYmVyKE51bWJlci5NSU5fVkFMVUUpOwogICAqIC8vID0+IDVlLTMyNAogICAqCiAgICogXy50b051bWJlcihJbmZpbml0eSk7CiAgICogLy8gPT4gSW5maW5pdHkKICAgKgogICAqIF8udG9OdW1iZXIoJzMuMicpOwogICAqIC8vID0+IDMuMgogICAqLwogIGZ1bmN0aW9uIHRvTnVtYmVyKHZhbHVlKSB7CiAgICBpZiAodHlwZW9mIHZhbHVlID09ICdudW1iZXInKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICAgIGlmIChpc1N5bWJvbCh2YWx1ZSkpIHsKICAgICAgcmV0dXJuIE5BTjsKICAgIH0KICAgIGlmIChpc09iamVjdCh2YWx1ZSkpIHsKICAgICAgdmFyIG90aGVyID0gdHlwZW9mIHZhbHVlLnZhbHVlT2YgPT0gJ2Z1bmN0aW9uJyA/IHZhbHVlLnZhbHVlT2YoKSA6IHZhbHVlOwogICAgICB2YWx1ZSA9IGlzT2JqZWN0KG90aGVyKSA/IChvdGhlciArICcnKSA6IG90aGVyOwogICAgfQogICAgaWYgKHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgewogICAgICByZXR1cm4gdmFsdWUgPT09IDAgPyB2YWx1ZSA6ICt2YWx1ZTsKICAgIH0KICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZShyZVRyaW0sICcnKTsKICAgIHZhciBpc0JpbmFyeSA9IHJlSXNCaW5hcnkudGVzdCh2YWx1ZSk7CiAgICByZXR1cm4gKGlzQmluYXJ5IHx8IHJlSXNPY3RhbC50ZXN0KHZhbHVlKSkKICAgICAgPyBmcmVlUGFyc2VJbnQodmFsdWUuc2xpY2UoMiksIGlzQmluYXJ5ID8gMiA6IDgpCiAgICAgIDogKHJlSXNCYWRIZXgudGVzdCh2YWx1ZSkgPyBOQU4gOiArdmFsdWUpOwogIH0KCiAgdmFyIGxvZGFzaF9kZWJvdW5jZSA9IGRlYm91bmNlJDE7CgogIC8qKgogICAqIGxvZGFzaCAoQ3VzdG9tIEJ1aWxkKSA8aHR0cHM6Ly9sb2Rhc2guY29tLz4KICAgKiBCdWlsZDogYGxvZGFzaCBtb2R1bGFyaXplIGV4cG9ydHM9Im5wbSIgLW8gLi9gCiAgICogQ29weXJpZ2h0IGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMgPGh0dHBzOi8vanF1ZXJ5Lm9yZy8+CiAgICogUmVsZWFzZWQgdW5kZXIgTUlUIGxpY2Vuc2UgPGh0dHBzOi8vbG9kYXNoLmNvbS9saWNlbnNlPgogICAqIEJhc2VkIG9uIFVuZGVyc2NvcmUuanMgMS44LjMgPGh0dHA6Ly91bmRlcnNjb3JlanMub3JnL0xJQ0VOU0U+CiAgICogQ29weXJpZ2h0IEplcmVteSBBc2hrZW5hcywgRG9jdW1lbnRDbG91ZCBhbmQgSW52ZXN0aWdhdGl2ZSBSZXBvcnRlcnMgJiBFZGl0b3JzCiAgICovCgogIHZhciBsb2Rhc2hfY2xvbmVkZWVwID0gY3JlYXRlQ29tbW9uanNNb2R1bGUkMShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgLyoqIFVzZWQgYXMgdGhlIHNpemUgdG8gZW5hYmxlIGxhcmdlIGFycmF5IG9wdGltaXphdGlvbnMuICovCiAgdmFyIExBUkdFX0FSUkFZX1NJWkUgPSAyMDA7CgogIC8qKiBVc2VkIHRvIHN0YW5kLWluIGZvciBgdW5kZWZpbmVkYCBoYXNoIHZhbHVlcy4gKi8KICB2YXIgSEFTSF9VTkRFRklORUQgPSAnX19sb2Rhc2hfaGFzaF91bmRlZmluZWRfXyc7CgogIC8qKiBVc2VkIGFzIHJlZmVyZW5jZXMgZm9yIHZhcmlvdXMgYE51bWJlcmAgY29uc3RhbnRzLiAqLwogIHZhciBNQVhfU0FGRV9JTlRFR0VSID0gOTAwNzE5OTI1NDc0MDk5MTsKCiAgLyoqIGBPYmplY3QjdG9TdHJpbmdgIHJlc3VsdCByZWZlcmVuY2VzLiAqLwogIHZhciBhcmdzVGFnID0gJ1tvYmplY3QgQXJndW1lbnRzXScsCiAgICAgIGFycmF5VGFnID0gJ1tvYmplY3QgQXJyYXldJywKICAgICAgYm9vbFRhZyA9ICdbb2JqZWN0IEJvb2xlYW5dJywKICAgICAgZGF0ZVRhZyA9ICdbb2JqZWN0IERhdGVdJywKICAgICAgZXJyb3JUYWcgPSAnW29iamVjdCBFcnJvcl0nLAogICAgICBmdW5jVGFnID0gJ1tvYmplY3QgRnVuY3Rpb25dJywKICAgICAgZ2VuVGFnID0gJ1tvYmplY3QgR2VuZXJhdG9yRnVuY3Rpb25dJywKICAgICAgbWFwVGFnID0gJ1tvYmplY3QgTWFwXScsCiAgICAgIG51bWJlclRhZyA9ICdbb2JqZWN0IE51bWJlcl0nLAogICAgICBvYmplY3RUYWcgPSAnW29iamVjdCBPYmplY3RdJywKICAgICAgcHJvbWlzZVRhZyA9ICdbb2JqZWN0IFByb21pc2VdJywKICAgICAgcmVnZXhwVGFnID0gJ1tvYmplY3QgUmVnRXhwXScsCiAgICAgIHNldFRhZyA9ICdbb2JqZWN0IFNldF0nLAogICAgICBzdHJpbmdUYWcgPSAnW29iamVjdCBTdHJpbmddJywKICAgICAgc3ltYm9sVGFnID0gJ1tvYmplY3QgU3ltYm9sXScsCiAgICAgIHdlYWtNYXBUYWcgPSAnW29iamVjdCBXZWFrTWFwXSc7CgogIHZhciBhcnJheUJ1ZmZlclRhZyA9ICdbb2JqZWN0IEFycmF5QnVmZmVyXScsCiAgICAgIGRhdGFWaWV3VGFnID0gJ1tvYmplY3QgRGF0YVZpZXddJywKICAgICAgZmxvYXQzMlRhZyA9ICdbb2JqZWN0IEZsb2F0MzJBcnJheV0nLAogICAgICBmbG9hdDY0VGFnID0gJ1tvYmplY3QgRmxvYXQ2NEFycmF5XScsCiAgICAgIGludDhUYWcgPSAnW29iamVjdCBJbnQ4QXJyYXldJywKICAgICAgaW50MTZUYWcgPSAnW29iamVjdCBJbnQxNkFycmF5XScsCiAgICAgIGludDMyVGFnID0gJ1tvYmplY3QgSW50MzJBcnJheV0nLAogICAgICB1aW50OFRhZyA9ICdbb2JqZWN0IFVpbnQ4QXJyYXldJywKICAgICAgdWludDhDbGFtcGVkVGFnID0gJ1tvYmplY3QgVWludDhDbGFtcGVkQXJyYXldJywKICAgICAgdWludDE2VGFnID0gJ1tvYmplY3QgVWludDE2QXJyYXldJywKICAgICAgdWludDMyVGFnID0gJ1tvYmplY3QgVWludDMyQXJyYXldJzsKCiAgLyoqCiAgICogVXNlZCB0byBtYXRjaCBgUmVnRXhwYAogICAqIFtzeW50YXggY2hhcmFjdGVyc10oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtcGF0dGVybnMpLgogICAqLwogIHZhciByZVJlZ0V4cENoYXIgPSAvW1xcXiQuKis/KClbXF17fXxdL2c7CgogIC8qKiBVc2VkIHRvIG1hdGNoIGBSZWdFeHBgIGZsYWdzIGZyb20gdGhlaXIgY29lcmNlZCBzdHJpbmcgdmFsdWVzLiAqLwogIHZhciByZUZsYWdzID0gL1x3KiQvOwoKICAvKiogVXNlZCB0byBkZXRlY3QgaG9zdCBjb25zdHJ1Y3RvcnMgKFNhZmFyaSkuICovCiAgdmFyIHJlSXNIb3N0Q3RvciA9IC9eXFtvYmplY3QgLis/Q29uc3RydWN0b3JcXSQvOwoKICAvKiogVXNlZCB0byBkZXRlY3QgdW5zaWduZWQgaW50ZWdlciB2YWx1ZXMuICovCiAgdmFyIHJlSXNVaW50ID0gL14oPzowfFsxLTldXGQqKSQvOwoKICAvKiogVXNlZCB0byBpZGVudGlmeSBgdG9TdHJpbmdUYWdgIHZhbHVlcyBzdXBwb3J0ZWQgYnkgYF8uY2xvbmVgLiAqLwogIHZhciBjbG9uZWFibGVUYWdzID0ge307CiAgY2xvbmVhYmxlVGFnc1thcmdzVGFnXSA9IGNsb25lYWJsZVRhZ3NbYXJyYXlUYWddID0KICBjbG9uZWFibGVUYWdzW2FycmF5QnVmZmVyVGFnXSA9IGNsb25lYWJsZVRhZ3NbZGF0YVZpZXdUYWddID0KICBjbG9uZWFibGVUYWdzW2Jvb2xUYWddID0gY2xvbmVhYmxlVGFnc1tkYXRlVGFnXSA9CiAgY2xvbmVhYmxlVGFnc1tmbG9hdDMyVGFnXSA9IGNsb25lYWJsZVRhZ3NbZmxvYXQ2NFRhZ10gPQogIGNsb25lYWJsZVRhZ3NbaW50OFRhZ10gPSBjbG9uZWFibGVUYWdzW2ludDE2VGFnXSA9CiAgY2xvbmVhYmxlVGFnc1tpbnQzMlRhZ10gPSBjbG9uZWFibGVUYWdzW21hcFRhZ10gPQogIGNsb25lYWJsZVRhZ3NbbnVtYmVyVGFnXSA9IGNsb25lYWJsZVRhZ3Nbb2JqZWN0VGFnXSA9CiAgY2xvbmVhYmxlVGFnc1tyZWdleHBUYWddID0gY2xvbmVhYmxlVGFnc1tzZXRUYWddID0KICBjbG9uZWFibGVUYWdzW3N0cmluZ1RhZ10gPSBjbG9uZWFibGVUYWdzW3N5bWJvbFRhZ10gPQogIGNsb25lYWJsZVRhZ3NbdWludDhUYWddID0gY2xvbmVhYmxlVGFnc1t1aW50OENsYW1wZWRUYWddID0KICBjbG9uZWFibGVUYWdzW3VpbnQxNlRhZ10gPSBjbG9uZWFibGVUYWdzW3VpbnQzMlRhZ10gPSB0cnVlOwogIGNsb25lYWJsZVRhZ3NbZXJyb3JUYWddID0gY2xvbmVhYmxlVGFnc1tmdW5jVGFnXSA9CiAgY2xvbmVhYmxlVGFnc1t3ZWFrTWFwVGFnXSA9IGZhbHNlOwoKICAvKiogRGV0ZWN0IGZyZWUgdmFyaWFibGUgYGdsb2JhbGAgZnJvbSBOb2RlLmpzLiAqLwogIHZhciBmcmVlR2xvYmFsID0gdHlwZW9mIGNvbW1vbmpzR2xvYmFsID09ICdvYmplY3QnICYmIGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLk9iamVjdCA9PT0gT2JqZWN0ICYmIGNvbW1vbmpzR2xvYmFsOwoKICAvKiogRGV0ZWN0IGZyZWUgdmFyaWFibGUgYHNlbGZgLiAqLwogIHZhciBmcmVlU2VsZiA9IHR5cGVvZiBzZWxmID09ICdvYmplY3QnICYmIHNlbGYgJiYgc2VsZi5PYmplY3QgPT09IE9iamVjdCAmJiBzZWxmOwoKICAvKiogVXNlZCBhcyBhIHJlZmVyZW5jZSB0byB0aGUgZ2xvYmFsIG9iamVjdC4gKi8KICB2YXIgcm9vdCA9IGZyZWVHbG9iYWwgfHwgZnJlZVNlbGYgfHwgRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTsKCiAgLyoqIERldGVjdCBmcmVlIHZhcmlhYmxlIGBleHBvcnRzYC4gKi8KICB2YXIgZnJlZUV4cG9ydHMgPSBleHBvcnRzICYmICFleHBvcnRzLm5vZGVUeXBlICYmIGV4cG9ydHM7CgogIC8qKiBEZXRlY3QgZnJlZSB2YXJpYWJsZSBgbW9kdWxlYC4gKi8KICB2YXIgZnJlZU1vZHVsZSA9IGZyZWVFeHBvcnRzICYmICdvYmplY3QnID09ICdvYmplY3QnICYmIG1vZHVsZSAmJiAhbW9kdWxlLm5vZGVUeXBlICYmIG1vZHVsZTsKCiAgLyoqIERldGVjdCB0aGUgcG9wdWxhciBDb21tb25KUyBleHRlbnNpb24gYG1vZHVsZS5leHBvcnRzYC4gKi8KICB2YXIgbW9kdWxlRXhwb3J0cyA9IGZyZWVNb2R1bGUgJiYgZnJlZU1vZHVsZS5leHBvcnRzID09PSBmcmVlRXhwb3J0czsKCiAgLyoqCiAgICogQWRkcyB0aGUga2V5LXZhbHVlIGBwYWlyYCB0byBgbWFwYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG1hcCBUaGUgbWFwIHRvIG1vZGlmeS4KICAgKiBAcGFyYW0ge0FycmF5fSBwYWlyIFRoZSBrZXktdmFsdWUgcGFpciB0byBhZGQuCiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgbWFwYC4KICAgKi8KICBmdW5jdGlvbiBhZGRNYXBFbnRyeShtYXAsIHBhaXIpIHsKICAgIC8vIERvbid0IHJldHVybiBgbWFwLnNldGAgYmVjYXVzZSBpdCdzIG5vdCBjaGFpbmFibGUgaW4gSUUgMTEuCiAgICBtYXAuc2V0KHBhaXJbMF0sIHBhaXJbMV0pOwogICAgcmV0dXJuIG1hcDsKICB9CgogIC8qKgogICAqIEFkZHMgYHZhbHVlYCB0byBgc2V0YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IHNldCBUaGUgc2V0IHRvIG1vZGlmeS4KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBhZGQuCiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyBgc2V0YC4KICAgKi8KICBmdW5jdGlvbiBhZGRTZXRFbnRyeShzZXQsIHZhbHVlKSB7CiAgICAvLyBEb24ndCByZXR1cm4gYHNldC5hZGRgIGJlY2F1c2UgaXQncyBub3QgY2hhaW5hYmxlIGluIElFIDExLgogICAgc2V0LmFkZCh2YWx1ZSk7CiAgICByZXR1cm4gc2V0OwogIH0KCiAgLyoqCiAgICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBfLmZvckVhY2hgIGZvciBhcnJheXMgd2l0aG91dCBzdXBwb3J0IGZvcgogICAqIGl0ZXJhdGVlIHNob3J0aGFuZHMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IFthcnJheV0gVGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyBgYXJyYXlgLgogICAqLwogIGZ1bmN0aW9uIGFycmF5RWFjaChhcnJheSwgaXRlcmF0ZWUpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IGFycmF5ID8gYXJyYXkubGVuZ3RoIDogMDsKCiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICBpZiAoaXRlcmF0ZWUoYXJyYXlbaW5kZXhdLCBpbmRleCwgYXJyYXkpID09PSBmYWxzZSkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gYXJyYXk7CiAgfQoKICAvKioKICAgKiBBcHBlbmRzIHRoZSBlbGVtZW50cyBvZiBgdmFsdWVzYCB0byBgYXJyYXlgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gbW9kaWZ5LgogICAqIEBwYXJhbSB7QXJyYXl9IHZhbHVlcyBUaGUgdmFsdWVzIHRvIGFwcGVuZC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC4KICAgKi8KICBmdW5jdGlvbiBhcnJheVB1c2goYXJyYXksIHZhbHVlcykgewogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgbGVuZ3RoID0gdmFsdWVzLmxlbmd0aCwKICAgICAgICBvZmZzZXQgPSBhcnJheS5sZW5ndGg7CgogICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgYXJyYXlbb2Zmc2V0ICsgaW5kZXhdID0gdmFsdWVzW2luZGV4XTsKICAgIH0KICAgIHJldHVybiBhcnJheTsKICB9CgogIC8qKgogICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgXy5yZWR1Y2VgIGZvciBhcnJheXMgd2l0aG91dCBzdXBwb3J0IGZvcgogICAqIGl0ZXJhdGVlIHNob3J0aGFuZHMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IFthcnJheV0gVGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLgogICAqIEBwYXJhbSB7Kn0gW2FjY3VtdWxhdG9yXSBUaGUgaW5pdGlhbCB2YWx1ZS4KICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpbml0QWNjdW1dIFNwZWNpZnkgdXNpbmcgdGhlIGZpcnN0IGVsZW1lbnQgb2YgYGFycmF5YCBhcwogICAqICB0aGUgaW5pdGlhbCB2YWx1ZS4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgYWNjdW11bGF0ZWQgdmFsdWUuCiAgICovCiAgZnVuY3Rpb24gYXJyYXlSZWR1Y2UoYXJyYXksIGl0ZXJhdGVlLCBhY2N1bXVsYXRvciwgaW5pdEFjY3VtKSB7CiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICBsZW5ndGggPSBhcnJheSA/IGFycmF5Lmxlbmd0aCA6IDA7CgogICAgaWYgKGluaXRBY2N1bSAmJiBsZW5ndGgpIHsKICAgICAgYWNjdW11bGF0b3IgPSBhcnJheVsrK2luZGV4XTsKICAgIH0KICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIGFjY3VtdWxhdG9yID0gaXRlcmF0ZWUoYWNjdW11bGF0b3IsIGFycmF5W2luZGV4XSwgaW5kZXgsIGFycmF5KTsKICAgIH0KICAgIHJldHVybiBhY2N1bXVsYXRvcjsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnRpbWVzYCB3aXRob3V0IHN1cHBvcnQgZm9yIGl0ZXJhdGVlIHNob3J0aGFuZHMKICAgKiBvciBtYXggYXJyYXkgbGVuZ3RoIGNoZWNrcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtudW1iZXJ9IG4gVGhlIG51bWJlciBvZiB0aW1lcyB0byBpbnZva2UgYGl0ZXJhdGVlYC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2YgcmVzdWx0cy4KICAgKi8KICBmdW5jdGlvbiBiYXNlVGltZXMobiwgaXRlcmF0ZWUpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIHJlc3VsdCA9IEFycmF5KG4pOwoKICAgIHdoaWxlICgrK2luZGV4IDwgbikgewogICAgICByZXN1bHRbaW5kZXhdID0gaXRlcmF0ZWUoaW5kZXgpOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIEdldHMgdGhlIHZhbHVlIGF0IGBrZXlgIG9mIGBvYmplY3RgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gW29iamVjdF0gVGhlIG9iamVjdCB0byBxdWVyeS4KICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHByb3BlcnR5IHRvIGdldC4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgcHJvcGVydHkgdmFsdWUuCiAgICovCiAgZnVuY3Rpb24gZ2V0VmFsdWUob2JqZWN0LCBrZXkpIHsKICAgIHJldHVybiBvYmplY3QgPT0gbnVsbCA/IHVuZGVmaW5lZCA6IG9iamVjdFtrZXldOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYSBob3N0IG9iamVjdCBpbiBJRSA8IDkuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgaG9zdCBvYmplY3QsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBpc0hvc3RPYmplY3QodmFsdWUpIHsKICAgIC8vIE1hbnkgaG9zdCBvYmplY3RzIGFyZSBgT2JqZWN0YCBvYmplY3RzIHRoYXQgY2FuIGNvZXJjZSB0byBzdHJpbmdzCiAgICAvLyBkZXNwaXRlIGhhdmluZyBpbXByb3Blcmx5IGRlZmluZWQgYHRvU3RyaW5nYCBtZXRob2RzLgogICAgdmFyIHJlc3VsdCA9IGZhbHNlOwogICAgaWYgKHZhbHVlICE9IG51bGwgJiYgdHlwZW9mIHZhbHVlLnRvU3RyaW5nICE9ICdmdW5jdGlvbicpIHsKICAgICAgdHJ5IHsKICAgICAgICByZXN1bHQgPSAhISh2YWx1ZSArICcnKTsKICAgICAgfSBjYXRjaCAoZSkge30KICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBDb252ZXJ0cyBgbWFwYCB0byBpdHMga2V5LXZhbHVlIHBhaXJzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gbWFwIFRoZSBtYXAgdG8gY29udmVydC4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGtleS12YWx1ZSBwYWlycy4KICAgKi8KICBmdW5jdGlvbiBtYXBUb0FycmF5KG1hcCkgewogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgcmVzdWx0ID0gQXJyYXkobWFwLnNpemUpOwoKICAgIG1hcC5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHsKICAgICAgcmVzdWx0WysraW5kZXhdID0gW2tleSwgdmFsdWVdOwogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhIHVuYXJ5IGZ1bmN0aW9uIHRoYXQgaW52b2tlcyBgZnVuY2Agd2l0aCBpdHMgYXJndW1lbnQgdHJhbnNmb3JtZWQuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIHdyYXAuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gdHJhbnNmb3JtIFRoZSBhcmd1bWVudCB0cmFuc2Zvcm0uCiAgICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZnVuY3Rpb24uCiAgICovCiAgZnVuY3Rpb24gb3ZlckFyZyhmdW5jLCB0cmFuc2Zvcm0pIHsKICAgIHJldHVybiBmdW5jdGlvbihhcmcpIHsKICAgICAgcmV0dXJuIGZ1bmModHJhbnNmb3JtKGFyZykpOwogICAgfTsKICB9CgogIC8qKgogICAqIENvbnZlcnRzIGBzZXRgIHRvIGFuIGFycmF5IG9mIGl0cyB2YWx1ZXMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBzZXQgVGhlIHNldCB0byBjb252ZXJ0LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgdmFsdWVzLgogICAqLwogIGZ1bmN0aW9uIHNldFRvQXJyYXkoc2V0KSB7CiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICByZXN1bHQgPSBBcnJheShzZXQuc2l6ZSk7CgogICAgc2V0LmZvckVhY2goZnVuY3Rpb24odmFsdWUpIHsKICAgICAgcmVzdWx0WysraW5kZXhdID0gdmFsdWU7CiAgICB9KTsKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKiogVXNlZCBmb3IgYnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMuICovCiAgdmFyIGFycmF5UHJvdG8gPSBBcnJheS5wcm90b3R5cGUsCiAgICAgIGZ1bmNQcm90byA9IEZ1bmN0aW9uLnByb3RvdHlwZSwKICAgICAgb2JqZWN0UHJvdG8gPSBPYmplY3QucHJvdG90eXBlOwoKICAvKiogVXNlZCB0byBkZXRlY3Qgb3ZlcnJlYWNoaW5nIGNvcmUtanMgc2hpbXMuICovCiAgdmFyIGNvcmVKc0RhdGEgPSByb290WydfX2NvcmUtanNfc2hhcmVkX18nXTsKCiAgLyoqIFVzZWQgdG8gZGV0ZWN0IG1ldGhvZHMgbWFzcXVlcmFkaW5nIGFzIG5hdGl2ZS4gKi8KICB2YXIgbWFza1NyY0tleSA9IChmdW5jdGlvbigpIHsKICAgIHZhciB1aWQgPSAvW14uXSskLy5leGVjKGNvcmVKc0RhdGEgJiYgY29yZUpzRGF0YS5rZXlzICYmIGNvcmVKc0RhdGEua2V5cy5JRV9QUk9UTyB8fCAnJyk7CiAgICByZXR1cm4gdWlkID8gKCdTeW1ib2woc3JjKV8xLicgKyB1aWQpIDogJyc7CiAgfSgpKTsKCiAgLyoqIFVzZWQgdG8gcmVzb2x2ZSB0aGUgZGVjb21waWxlZCBzb3VyY2Ugb2YgZnVuY3Rpb25zLiAqLwogIHZhciBmdW5jVG9TdHJpbmcgPSBmdW5jUHJvdG8udG9TdHJpbmc7CgogIC8qKiBVc2VkIHRvIGNoZWNrIG9iamVjdHMgZm9yIG93biBwcm9wZXJ0aWVzLiAqLwogIHZhciBoYXNPd25Qcm9wZXJ0eSA9IG9iamVjdFByb3RvLmhhc093blByb3BlcnR5OwoKICAvKioKICAgKiBVc2VkIHRvIHJlc29sdmUgdGhlCiAgICogW2B0b1N0cmluZ1RhZ2BdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLW9iamVjdC5wcm90b3R5cGUudG9zdHJpbmcpCiAgICogb2YgdmFsdWVzLgogICAqLwogIHZhciBvYmplY3RUb1N0cmluZyA9IG9iamVjdFByb3RvLnRvU3RyaW5nOwoKICAvKiogVXNlZCB0byBkZXRlY3QgaWYgYSBtZXRob2QgaXMgbmF0aXZlLiAqLwogIHZhciByZUlzTmF0aXZlID0gUmVnRXhwKCdeJyArCiAgICBmdW5jVG9TdHJpbmcuY2FsbChoYXNPd25Qcm9wZXJ0eSkucmVwbGFjZShyZVJlZ0V4cENoYXIsICdcXCQmJykKICAgIC5yZXBsYWNlKC9oYXNPd25Qcm9wZXJ0eXwoZnVuY3Rpb24pLio/KD89XFxcKCl8IGZvciAuKz8oPz1cXFxdKS9nLCAnJDEuKj8nKSArICckJwogICk7CgogIC8qKiBCdWlsdC1pbiB2YWx1ZSByZWZlcmVuY2VzLiAqLwogIHZhciBCdWZmZXIgPSBtb2R1bGVFeHBvcnRzID8gcm9vdC5CdWZmZXIgOiB1bmRlZmluZWQsCiAgICAgIFN5bWJvbCA9IHJvb3QuU3ltYm9sLAogICAgICBVaW50OEFycmF5ID0gcm9vdC5VaW50OEFycmF5LAogICAgICBnZXRQcm90b3R5cGUgPSBvdmVyQXJnKE9iamVjdC5nZXRQcm90b3R5cGVPZiwgT2JqZWN0KSwKICAgICAgb2JqZWN0Q3JlYXRlID0gT2JqZWN0LmNyZWF0ZSwKICAgICAgcHJvcGVydHlJc0VudW1lcmFibGUgPSBvYmplY3RQcm90by5wcm9wZXJ0eUlzRW51bWVyYWJsZSwKICAgICAgc3BsaWNlID0gYXJyYXlQcm90by5zcGxpY2U7CgogIC8qIEJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzIGZvciB0aG9zZSB3aXRoIHRoZSBzYW1lIG5hbWUgYXMgb3RoZXIgYGxvZGFzaGAgbWV0aG9kcy4gKi8KICB2YXIgbmF0aXZlR2V0U3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMsCiAgICAgIG5hdGl2ZUlzQnVmZmVyID0gQnVmZmVyID8gQnVmZmVyLmlzQnVmZmVyIDogdW5kZWZpbmVkLAogICAgICBuYXRpdmVLZXlzID0gb3ZlckFyZyhPYmplY3Qua2V5cywgT2JqZWN0KTsKCiAgLyogQnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMgdGhhdCBhcmUgdmVyaWZpZWQgdG8gYmUgbmF0aXZlLiAqLwogIHZhciBEYXRhVmlldyA9IGdldE5hdGl2ZShyb290LCAnRGF0YVZpZXcnKSwKICAgICAgTWFwID0gZ2V0TmF0aXZlKHJvb3QsICdNYXAnKSwKICAgICAgUHJvbWlzZSA9IGdldE5hdGl2ZShyb290LCAnUHJvbWlzZScpLAogICAgICBTZXQgPSBnZXROYXRpdmUocm9vdCwgJ1NldCcpLAogICAgICBXZWFrTWFwID0gZ2V0TmF0aXZlKHJvb3QsICdXZWFrTWFwJyksCiAgICAgIG5hdGl2ZUNyZWF0ZSA9IGdldE5hdGl2ZShPYmplY3QsICdjcmVhdGUnKTsKCiAgLyoqIFVzZWQgdG8gZGV0ZWN0IG1hcHMsIHNldHMsIGFuZCB3ZWFrbWFwcy4gKi8KICB2YXIgZGF0YVZpZXdDdG9yU3RyaW5nID0gdG9Tb3VyY2UoRGF0YVZpZXcpLAogICAgICBtYXBDdG9yU3RyaW5nID0gdG9Tb3VyY2UoTWFwKSwKICAgICAgcHJvbWlzZUN0b3JTdHJpbmcgPSB0b1NvdXJjZShQcm9taXNlKSwKICAgICAgc2V0Q3RvclN0cmluZyA9IHRvU291cmNlKFNldCksCiAgICAgIHdlYWtNYXBDdG9yU3RyaW5nID0gdG9Tb3VyY2UoV2Vha01hcCk7CgogIC8qKiBVc2VkIHRvIGNvbnZlcnQgc3ltYm9scyB0byBwcmltaXRpdmVzIGFuZCBzdHJpbmdzLiAqLwogIHZhciBzeW1ib2xQcm90byA9IFN5bWJvbCA/IFN5bWJvbC5wcm90b3R5cGUgOiB1bmRlZmluZWQsCiAgICAgIHN5bWJvbFZhbHVlT2YgPSBzeW1ib2xQcm90byA/IHN5bWJvbFByb3RvLnZhbHVlT2YgOiB1bmRlZmluZWQ7CgogIC8qKgogICAqIENyZWF0ZXMgYSBoYXNoIG9iamVjdC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQGNvbnN0cnVjdG9yCiAgICogQHBhcmFtIHtBcnJheX0gW2VudHJpZXNdIFRoZSBrZXktdmFsdWUgcGFpcnMgdG8gY2FjaGUuCiAgICovCiAgZnVuY3Rpb24gSGFzaChlbnRyaWVzKSB7CiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICBsZW5ndGggPSBlbnRyaWVzID8gZW50cmllcy5sZW5ndGggOiAwOwoKICAgIHRoaXMuY2xlYXIoKTsKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIHZhciBlbnRyeSA9IGVudHJpZXNbaW5kZXhdOwogICAgICB0aGlzLnNldChlbnRyeVswXSwgZW50cnlbMV0pOwogICAgfQogIH0KCiAgLyoqCiAgICogUmVtb3ZlcyBhbGwga2V5LXZhbHVlIGVudHJpZXMgZnJvbSB0aGUgaGFzaC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgY2xlYXIKICAgKiBAbWVtYmVyT2YgSGFzaAogICAqLwogIGZ1bmN0aW9uIGhhc2hDbGVhcigpIHsKICAgIHRoaXMuX19kYXRhX18gPSBuYXRpdmVDcmVhdGUgPyBuYXRpdmVDcmVhdGUobnVsbCkgOiB7fTsKICB9CgogIC8qKgogICAqIFJlbW92ZXMgYGtleWAgYW5kIGl0cyB2YWx1ZSBmcm9tIHRoZSBoYXNoLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBkZWxldGUKICAgKiBAbWVtYmVyT2YgSGFzaAogICAqIEBwYXJhbSB7T2JqZWN0fSBoYXNoIFRoZSBoYXNoIHRvIG1vZGlmeS4KICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIHJlbW92ZS4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGVudHJ5IHdhcyByZW1vdmVkLCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gaGFzaERlbGV0ZShrZXkpIHsKICAgIHJldHVybiB0aGlzLmhhcyhrZXkpICYmIGRlbGV0ZSB0aGlzLl9fZGF0YV9fW2tleV07CiAgfQoKICAvKioKICAgKiBHZXRzIHRoZSBoYXNoIHZhbHVlIGZvciBga2V5YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgZ2V0CiAgICogQG1lbWJlck9mIEhhc2gKICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIGdldC4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgZW50cnkgdmFsdWUuCiAgICovCiAgZnVuY3Rpb24gaGFzaEdldChrZXkpIHsKICAgIHZhciBkYXRhID0gdGhpcy5fX2RhdGFfXzsKICAgIGlmIChuYXRpdmVDcmVhdGUpIHsKICAgICAgdmFyIHJlc3VsdCA9IGRhdGFba2V5XTsKICAgICAgcmV0dXJuIHJlc3VsdCA9PT0gSEFTSF9VTkRFRklORUQgPyB1bmRlZmluZWQgOiByZXN1bHQ7CiAgICB9CiAgICByZXR1cm4gaGFzT3duUHJvcGVydHkuY2FsbChkYXRhLCBrZXkpID8gZGF0YVtrZXldIDogdW5kZWZpbmVkOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGEgaGFzaCB2YWx1ZSBmb3IgYGtleWAgZXhpc3RzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBoYXMKICAgKiBAbWVtYmVyT2YgSGFzaAogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgZW50cnkgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGFuIGVudHJ5IGZvciBga2V5YCBleGlzdHMsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBoYXNoSGFzKGtleSkgewogICAgdmFyIGRhdGEgPSB0aGlzLl9fZGF0YV9fOwogICAgcmV0dXJuIG5hdGl2ZUNyZWF0ZSA/IGRhdGFba2V5XSAhPT0gdW5kZWZpbmVkIDogaGFzT3duUHJvcGVydHkuY2FsbChkYXRhLCBrZXkpOwogIH0KCiAgLyoqCiAgICogU2V0cyB0aGUgaGFzaCBga2V5YCB0byBgdmFsdWVgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBzZXQKICAgKiBAbWVtYmVyT2YgSGFzaAogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gc2V0LgogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHNldC4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBoYXNoIGluc3RhbmNlLgogICAqLwogIGZ1bmN0aW9uIGhhc2hTZXQoa2V5LCB2YWx1ZSkgewogICAgdmFyIGRhdGEgPSB0aGlzLl9fZGF0YV9fOwogICAgZGF0YVtrZXldID0gKG5hdGl2ZUNyZWF0ZSAmJiB2YWx1ZSA9PT0gdW5kZWZpbmVkKSA/IEhBU0hfVU5ERUZJTkVEIDogdmFsdWU7CiAgICByZXR1cm4gdGhpczsKICB9CgogIC8vIEFkZCBtZXRob2RzIHRvIGBIYXNoYC4KICBIYXNoLnByb3RvdHlwZS5jbGVhciA9IGhhc2hDbGVhcjsKICBIYXNoLnByb3RvdHlwZVsnZGVsZXRlJ10gPSBoYXNoRGVsZXRlOwogIEhhc2gucHJvdG90eXBlLmdldCA9IGhhc2hHZXQ7CiAgSGFzaC5wcm90b3R5cGUuaGFzID0gaGFzaEhhczsKICBIYXNoLnByb3RvdHlwZS5zZXQgPSBoYXNoU2V0OwoKICAvKioKICAgKiBDcmVhdGVzIGFuIGxpc3QgY2FjaGUgb2JqZWN0LgogICAqCiAgICogQHByaXZhdGUKICAgKiBAY29uc3RydWN0b3IKICAgKiBAcGFyYW0ge0FycmF5fSBbZW50cmllc10gVGhlIGtleS12YWx1ZSBwYWlycyB0byBjYWNoZS4KICAgKi8KICBmdW5jdGlvbiBMaXN0Q2FjaGUoZW50cmllcykgewogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgbGVuZ3RoID0gZW50cmllcyA/IGVudHJpZXMubGVuZ3RoIDogMDsKCiAgICB0aGlzLmNsZWFyKCk7CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICB2YXIgZW50cnkgPSBlbnRyaWVzW2luZGV4XTsKICAgICAgdGhpcy5zZXQoZW50cnlbMF0sIGVudHJ5WzFdKTsKICAgIH0KICB9CgogIC8qKgogICAqIFJlbW92ZXMgYWxsIGtleS12YWx1ZSBlbnRyaWVzIGZyb20gdGhlIGxpc3QgY2FjaGUuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIGNsZWFyCiAgICogQG1lbWJlck9mIExpc3RDYWNoZQogICAqLwogIGZ1bmN0aW9uIGxpc3RDYWNoZUNsZWFyKCkgewogICAgdGhpcy5fX2RhdGFfXyA9IFtdOwogIH0KCiAgLyoqCiAgICogUmVtb3ZlcyBga2V5YCBhbmQgaXRzIHZhbHVlIGZyb20gdGhlIGxpc3QgY2FjaGUuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIGRlbGV0ZQogICAqIEBtZW1iZXJPZiBMaXN0Q2FjaGUKICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIHJlbW92ZS4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGVudHJ5IHdhcyByZW1vdmVkLCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gbGlzdENhY2hlRGVsZXRlKGtleSkgewogICAgdmFyIGRhdGEgPSB0aGlzLl9fZGF0YV9fLAogICAgICAgIGluZGV4ID0gYXNzb2NJbmRleE9mKGRhdGEsIGtleSk7CgogICAgaWYgKGluZGV4IDwgMCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB2YXIgbGFzdEluZGV4ID0gZGF0YS5sZW5ndGggLSAxOwogICAgaWYgKGluZGV4ID09IGxhc3RJbmRleCkgewogICAgICBkYXRhLnBvcCgpOwogICAgfSBlbHNlIHsKICAgICAgc3BsaWNlLmNhbGwoZGF0YSwgaW5kZXgsIDEpOwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKiBHZXRzIHRoZSBsaXN0IGNhY2hlIHZhbHVlIGZvciBga2V5YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgZ2V0CiAgICogQG1lbWJlck9mIExpc3RDYWNoZQogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gZ2V0LgogICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBlbnRyeSB2YWx1ZS4KICAgKi8KICBmdW5jdGlvbiBsaXN0Q2FjaGVHZXQoa2V5KSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuX19kYXRhX18sCiAgICAgICAgaW5kZXggPSBhc3NvY0luZGV4T2YoZGF0YSwga2V5KTsKCiAgICByZXR1cm4gaW5kZXggPCAwID8gdW5kZWZpbmVkIDogZGF0YVtpbmRleF1bMV07CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYSBsaXN0IGNhY2hlIHZhbHVlIGZvciBga2V5YCBleGlzdHMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIGhhcwogICAqIEBtZW1iZXJPZiBMaXN0Q2FjaGUKICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIGVudHJ5IHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBhbiBlbnRyeSBmb3IgYGtleWAgZXhpc3RzLCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gbGlzdENhY2hlSGFzKGtleSkgewogICAgcmV0dXJuIGFzc29jSW5kZXhPZih0aGlzLl9fZGF0YV9fLCBrZXkpID4gLTE7CiAgfQoKICAvKioKICAgKiBTZXRzIHRoZSBsaXN0IGNhY2hlIGBrZXlgIHRvIGB2YWx1ZWAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIHNldAogICAqIEBtZW1iZXJPZiBMaXN0Q2FjaGUKICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIHNldC4KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZXQuCiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgbGlzdCBjYWNoZSBpbnN0YW5jZS4KICAgKi8KICBmdW5jdGlvbiBsaXN0Q2FjaGVTZXQoa2V5LCB2YWx1ZSkgewogICAgdmFyIGRhdGEgPSB0aGlzLl9fZGF0YV9fLAogICAgICAgIGluZGV4ID0gYXNzb2NJbmRleE9mKGRhdGEsIGtleSk7CgogICAgaWYgKGluZGV4IDwgMCkgewogICAgICBkYXRhLnB1c2goW2tleSwgdmFsdWVdKTsKICAgIH0gZWxzZSB7CiAgICAgIGRhdGFbaW5kZXhdWzFdID0gdmFsdWU7CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9CgogIC8vIEFkZCBtZXRob2RzIHRvIGBMaXN0Q2FjaGVgLgogIExpc3RDYWNoZS5wcm90b3R5cGUuY2xlYXIgPSBsaXN0Q2FjaGVDbGVhcjsKICBMaXN0Q2FjaGUucHJvdG90eXBlWydkZWxldGUnXSA9IGxpc3RDYWNoZURlbGV0ZTsKICBMaXN0Q2FjaGUucHJvdG90eXBlLmdldCA9IGxpc3RDYWNoZUdldDsKICBMaXN0Q2FjaGUucHJvdG90eXBlLmhhcyA9IGxpc3RDYWNoZUhhczsKICBMaXN0Q2FjaGUucHJvdG90eXBlLnNldCA9IGxpc3RDYWNoZVNldDsKCiAgLyoqCiAgICogQ3JlYXRlcyBhIG1hcCBjYWNoZSBvYmplY3QgdG8gc3RvcmUga2V5LXZhbHVlIHBhaXJzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAY29uc3RydWN0b3IKICAgKiBAcGFyYW0ge0FycmF5fSBbZW50cmllc10gVGhlIGtleS12YWx1ZSBwYWlycyB0byBjYWNoZS4KICAgKi8KICBmdW5jdGlvbiBNYXBDYWNoZShlbnRyaWVzKSB7CiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICBsZW5ndGggPSBlbnRyaWVzID8gZW50cmllcy5sZW5ndGggOiAwOwoKICAgIHRoaXMuY2xlYXIoKTsKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIHZhciBlbnRyeSA9IGVudHJpZXNbaW5kZXhdOwogICAgICB0aGlzLnNldChlbnRyeVswXSwgZW50cnlbMV0pOwogICAgfQogIH0KCiAgLyoqCiAgICogUmVtb3ZlcyBhbGwga2V5LXZhbHVlIGVudHJpZXMgZnJvbSB0aGUgbWFwLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBjbGVhcgogICAqIEBtZW1iZXJPZiBNYXBDYWNoZQogICAqLwogIGZ1bmN0aW9uIG1hcENhY2hlQ2xlYXIoKSB7CiAgICB0aGlzLl9fZGF0YV9fID0gewogICAgICAnaGFzaCc6IG5ldyBIYXNoLAogICAgICAnbWFwJzogbmV3IChNYXAgfHwgTGlzdENhY2hlKSwKICAgICAgJ3N0cmluZyc6IG5ldyBIYXNoCiAgICB9OwogIH0KCiAgLyoqCiAgICogUmVtb3ZlcyBga2V5YCBhbmQgaXRzIHZhbHVlIGZyb20gdGhlIG1hcC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgZGVsZXRlCiAgICogQG1lbWJlck9mIE1hcENhY2hlCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byByZW1vdmUuCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBlbnRyeSB3YXMgcmVtb3ZlZCwgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIG1hcENhY2hlRGVsZXRlKGtleSkgewogICAgcmV0dXJuIGdldE1hcERhdGEodGhpcywga2V5KVsnZGVsZXRlJ10oa2V5KTsKICB9CgogIC8qKgogICAqIEdldHMgdGhlIG1hcCB2YWx1ZSBmb3IgYGtleWAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIGdldAogICAqIEBtZW1iZXJPZiBNYXBDYWNoZQogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gZ2V0LgogICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBlbnRyeSB2YWx1ZS4KICAgKi8KICBmdW5jdGlvbiBtYXBDYWNoZUdldChrZXkpIHsKICAgIHJldHVybiBnZXRNYXBEYXRhKHRoaXMsIGtleSkuZ2V0KGtleSk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYSBtYXAgdmFsdWUgZm9yIGBrZXlgIGV4aXN0cy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgaGFzCiAgICogQG1lbWJlck9mIE1hcENhY2hlCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSBlbnRyeSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYW4gZW50cnkgZm9yIGBrZXlgIGV4aXN0cywgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIG1hcENhY2hlSGFzKGtleSkgewogICAgcmV0dXJuIGdldE1hcERhdGEodGhpcywga2V5KS5oYXMoa2V5KTsKICB9CgogIC8qKgogICAqIFNldHMgdGhlIG1hcCBga2V5YCB0byBgdmFsdWVgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBzZXQKICAgKiBAbWVtYmVyT2YgTWFwQ2FjaGUKICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIHNldC4KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZXQuCiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgbWFwIGNhY2hlIGluc3RhbmNlLgogICAqLwogIGZ1bmN0aW9uIG1hcENhY2hlU2V0KGtleSwgdmFsdWUpIHsKICAgIGdldE1hcERhdGEodGhpcywga2V5KS5zZXQoa2V5LCB2YWx1ZSk7CiAgICByZXR1cm4gdGhpczsKICB9CgogIC8vIEFkZCBtZXRob2RzIHRvIGBNYXBDYWNoZWAuCiAgTWFwQ2FjaGUucHJvdG90eXBlLmNsZWFyID0gbWFwQ2FjaGVDbGVhcjsKICBNYXBDYWNoZS5wcm90b3R5cGVbJ2RlbGV0ZSddID0gbWFwQ2FjaGVEZWxldGU7CiAgTWFwQ2FjaGUucHJvdG90eXBlLmdldCA9IG1hcENhY2hlR2V0OwogIE1hcENhY2hlLnByb3RvdHlwZS5oYXMgPSBtYXBDYWNoZUhhczsKICBNYXBDYWNoZS5wcm90b3R5cGUuc2V0ID0gbWFwQ2FjaGVTZXQ7CgogIC8qKgogICAqIENyZWF0ZXMgYSBzdGFjayBjYWNoZSBvYmplY3QgdG8gc3RvcmUga2V5LXZhbHVlIHBhaXJzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAY29uc3RydWN0b3IKICAgKiBAcGFyYW0ge0FycmF5fSBbZW50cmllc10gVGhlIGtleS12YWx1ZSBwYWlycyB0byBjYWNoZS4KICAgKi8KICBmdW5jdGlvbiBTdGFjayhlbnRyaWVzKSB7CiAgICB0aGlzLl9fZGF0YV9fID0gbmV3IExpc3RDYWNoZShlbnRyaWVzKTsKICB9CgogIC8qKgogICAqIFJlbW92ZXMgYWxsIGtleS12YWx1ZSBlbnRyaWVzIGZyb20gdGhlIHN0YWNrLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBjbGVhcgogICAqIEBtZW1iZXJPZiBTdGFjawogICAqLwogIGZ1bmN0aW9uIHN0YWNrQ2xlYXIoKSB7CiAgICB0aGlzLl9fZGF0YV9fID0gbmV3IExpc3RDYWNoZTsKICB9CgogIC8qKgogICAqIFJlbW92ZXMgYGtleWAgYW5kIGl0cyB2YWx1ZSBmcm9tIHRoZSBzdGFjay4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgZGVsZXRlCiAgICogQG1lbWJlck9mIFN0YWNrCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byByZW1vdmUuCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBlbnRyeSB3YXMgcmVtb3ZlZCwgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIHN0YWNrRGVsZXRlKGtleSkgewogICAgcmV0dXJuIHRoaXMuX19kYXRhX19bJ2RlbGV0ZSddKGtleSk7CiAgfQoKICAvKioKICAgKiBHZXRzIHRoZSBzdGFjayB2YWx1ZSBmb3IgYGtleWAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIGdldAogICAqIEBtZW1iZXJPZiBTdGFjawogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gZ2V0LgogICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBlbnRyeSB2YWx1ZS4KICAgKi8KICBmdW5jdGlvbiBzdGFja0dldChrZXkpIHsKICAgIHJldHVybiB0aGlzLl9fZGF0YV9fLmdldChrZXkpOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGEgc3RhY2sgdmFsdWUgZm9yIGBrZXlgIGV4aXN0cy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgaGFzCiAgICogQG1lbWJlck9mIFN0YWNrCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSBlbnRyeSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYW4gZW50cnkgZm9yIGBrZXlgIGV4aXN0cywgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIHN0YWNrSGFzKGtleSkgewogICAgcmV0dXJuIHRoaXMuX19kYXRhX18uaGFzKGtleSk7CiAgfQoKICAvKioKICAgKiBTZXRzIHRoZSBzdGFjayBga2V5YCB0byBgdmFsdWVgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBzZXQKICAgKiBAbWVtYmVyT2YgU3RhY2sKICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIHNldC4KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZXQuCiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgc3RhY2sgY2FjaGUgaW5zdGFuY2UuCiAgICovCiAgZnVuY3Rpb24gc3RhY2tTZXQoa2V5LCB2YWx1ZSkgewogICAgdmFyIGNhY2hlID0gdGhpcy5fX2RhdGFfXzsKICAgIGlmIChjYWNoZSBpbnN0YW5jZW9mIExpc3RDYWNoZSkgewogICAgICB2YXIgcGFpcnMgPSBjYWNoZS5fX2RhdGFfXzsKICAgICAgaWYgKCFNYXAgfHwgKHBhaXJzLmxlbmd0aCA8IExBUkdFX0FSUkFZX1NJWkUgLSAxKSkgewogICAgICAgIHBhaXJzLnB1c2goW2tleSwgdmFsdWVdKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBjYWNoZSA9IHRoaXMuX19kYXRhX18gPSBuZXcgTWFwQ2FjaGUocGFpcnMpOwogICAgfQogICAgY2FjaGUuc2V0KGtleSwgdmFsdWUpOwogICAgcmV0dXJuIHRoaXM7CiAgfQoKICAvLyBBZGQgbWV0aG9kcyB0byBgU3RhY2tgLgogIFN0YWNrLnByb3RvdHlwZS5jbGVhciA9IHN0YWNrQ2xlYXI7CiAgU3RhY2sucHJvdG90eXBlWydkZWxldGUnXSA9IHN0YWNrRGVsZXRlOwogIFN0YWNrLnByb3RvdHlwZS5nZXQgPSBzdGFja0dldDsKICBTdGFjay5wcm90b3R5cGUuaGFzID0gc3RhY2tIYXM7CiAgU3RhY2sucHJvdG90eXBlLnNldCA9IHN0YWNrU2V0OwoKICAvKioKICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIHRoZSBlbnVtZXJhYmxlIHByb3BlcnR5IG5hbWVzIG9mIHRoZSBhcnJheS1saWtlIGB2YWx1ZWAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHF1ZXJ5LgogICAqIEBwYXJhbSB7Ym9vbGVhbn0gaW5oZXJpdGVkIFNwZWNpZnkgcmV0dXJuaW5nIGluaGVyaXRlZCBwcm9wZXJ0eSBuYW1lcy4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IG5hbWVzLgogICAqLwogIGZ1bmN0aW9uIGFycmF5TGlrZUtleXModmFsdWUsIGluaGVyaXRlZCkgewogICAgLy8gU2FmYXJpIDguMSBtYWtlcyBgYXJndW1lbnRzLmNhbGxlZWAgZW51bWVyYWJsZSBpbiBzdHJpY3QgbW9kZS4KICAgIC8vIFNhZmFyaSA5IG1ha2VzIGBhcmd1bWVudHMubGVuZ3RoYCBlbnVtZXJhYmxlIGluIHN0cmljdCBtb2RlLgogICAgdmFyIHJlc3VsdCA9IChpc0FycmF5KHZhbHVlKSB8fCBpc0FyZ3VtZW50cyh2YWx1ZSkpCiAgICAgID8gYmFzZVRpbWVzKHZhbHVlLmxlbmd0aCwgU3RyaW5nKQogICAgICA6IFtdOwoKICAgIHZhciBsZW5ndGggPSByZXN1bHQubGVuZ3RoLAogICAgICAgIHNraXBJbmRleGVzID0gISFsZW5ndGg7CgogICAgZm9yICh2YXIga2V5IGluIHZhbHVlKSB7CiAgICAgIGlmICgoaW5oZXJpdGVkIHx8IGhhc093blByb3BlcnR5LmNhbGwodmFsdWUsIGtleSkpICYmCiAgICAgICAgICAhKHNraXBJbmRleGVzICYmIChrZXkgPT0gJ2xlbmd0aCcgfHwgaXNJbmRleChrZXksIGxlbmd0aCkpKSkgewogICAgICAgIHJlc3VsdC5wdXNoKGtleSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBBc3NpZ25zIGB2YWx1ZWAgdG8gYGtleWAgb2YgYG9iamVjdGAgaWYgdGhlIGV4aXN0aW5nIHZhbHVlIGlzIG5vdCBlcXVpdmFsZW50CiAgICogdXNpbmcgW2BTYW1lVmFsdWVaZXJvYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtc2FtZXZhbHVlemVybykKICAgKiBmb3IgZXF1YWxpdHkgY29tcGFyaXNvbnMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBtb2RpZnkuCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSBwcm9wZXJ0eSB0byBhc3NpZ24uCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gYXNzaWduLgogICAqLwogIGZ1bmN0aW9uIGFzc2lnblZhbHVlKG9iamVjdCwga2V5LCB2YWx1ZSkgewogICAgdmFyIG9ialZhbHVlID0gb2JqZWN0W2tleV07CiAgICBpZiAoIShoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwga2V5KSAmJiBlcShvYmpWYWx1ZSwgdmFsdWUpKSB8fAogICAgICAgICh2YWx1ZSA9PT0gdW5kZWZpbmVkICYmICEoa2V5IGluIG9iamVjdCkpKSB7CiAgICAgIG9iamVjdFtrZXldID0gdmFsdWU7CiAgICB9CiAgfQoKICAvKioKICAgKiBHZXRzIHRoZSBpbmRleCBhdCB3aGljaCB0aGUgYGtleWAgaXMgZm91bmQgaW4gYGFycmF5YCBvZiBrZXktdmFsdWUgcGFpcnMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpbnNwZWN0LgogICAqIEBwYXJhbSB7Kn0ga2V5IFRoZSBrZXkgdG8gc2VhcmNoIGZvci4KICAgKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgbWF0Y2hlZCB2YWx1ZSwgZWxzZSBgLTFgLgogICAqLwogIGZ1bmN0aW9uIGFzc29jSW5kZXhPZihhcnJheSwga2V5KSB7CiAgICB2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwogICAgd2hpbGUgKGxlbmd0aC0tKSB7CiAgICAgIGlmIChlcShhcnJheVtsZW5ndGhdWzBdLCBrZXkpKSB7CiAgICAgICAgcmV0dXJuIGxlbmd0aDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIC0xOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uYXNzaWduYCB3aXRob3V0IHN1cHBvcnQgZm9yIG11bHRpcGxlIHNvdXJjZXMKICAgKiBvciBgY3VzdG9taXplcmAgZnVuY3Rpb25zLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBkZXN0aW5hdGlvbiBvYmplY3QuCiAgICogQHBhcmFtIHtPYmplY3R9IHNvdXJjZSBUaGUgc291cmNlIG9iamVjdC4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VBc3NpZ24ob2JqZWN0LCBzb3VyY2UpIHsKICAgIHJldHVybiBvYmplY3QgJiYgY29weU9iamVjdChzb3VyY2UsIGtleXMoc291cmNlKSwgb2JqZWN0KTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmNsb25lYCBhbmQgYF8uY2xvbmVEZWVwYCB3aGljaCB0cmFja3MKICAgKiB0cmF2ZXJzZWQgb2JqZWN0cy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2xvbmUuCiAgICogQHBhcmFtIHtib29sZWFufSBbaXNEZWVwXSBTcGVjaWZ5IGEgZGVlcCBjbG9uZS4KICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc0Z1bGxdIFNwZWNpZnkgYSBjbG9uZSBpbmNsdWRpbmcgc3ltYm9scy4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY3VzdG9taXplcl0gVGhlIGZ1bmN0aW9uIHRvIGN1c3RvbWl6ZSBjbG9uaW5nLgogICAqIEBwYXJhbSB7c3RyaW5nfSBba2V5XSBUaGUga2V5IG9mIGB2YWx1ZWAuCiAgICogQHBhcmFtIHtPYmplY3R9IFtvYmplY3RdIFRoZSBwYXJlbnQgb2JqZWN0IG9mIGB2YWx1ZWAuCiAgICogQHBhcmFtIHtPYmplY3R9IFtzdGFja10gVHJhY2tzIHRyYXZlcnNlZCBvYmplY3RzIGFuZCB0aGVpciBjbG9uZSBjb3VudGVycGFydHMuCiAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGNsb25lZCB2YWx1ZS4KICAgKi8KICBmdW5jdGlvbiBiYXNlQ2xvbmUodmFsdWUsIGlzRGVlcCwgaXNGdWxsLCBjdXN0b21pemVyLCBrZXksIG9iamVjdCwgc3RhY2spIHsKICAgIHZhciByZXN1bHQ7CiAgICBpZiAoY3VzdG9taXplcikgewogICAgICByZXN1bHQgPSBvYmplY3QgPyBjdXN0b21pemVyKHZhbHVlLCBrZXksIG9iamVjdCwgc3RhY2spIDogY3VzdG9taXplcih2YWx1ZSk7CiAgICB9CiAgICBpZiAocmVzdWx0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIGlmICghaXNPYmplY3QodmFsdWUpKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICAgIHZhciBpc0FyciA9IGlzQXJyYXkodmFsdWUpOwogICAgaWYgKGlzQXJyKSB7CiAgICAgIHJlc3VsdCA9IGluaXRDbG9uZUFycmF5KHZhbHVlKTsKICAgICAgaWYgKCFpc0RlZXApIHsKICAgICAgICByZXR1cm4gY29weUFycmF5KHZhbHVlLCByZXN1bHQpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB2YXIgdGFnID0gZ2V0VGFnKHZhbHVlKSwKICAgICAgICAgIGlzRnVuYyA9IHRhZyA9PSBmdW5jVGFnIHx8IHRhZyA9PSBnZW5UYWc7CgogICAgICBpZiAoaXNCdWZmZXIodmFsdWUpKSB7CiAgICAgICAgcmV0dXJuIGNsb25lQnVmZmVyKHZhbHVlLCBpc0RlZXApOwogICAgICB9CiAgICAgIGlmICh0YWcgPT0gb2JqZWN0VGFnIHx8IHRhZyA9PSBhcmdzVGFnIHx8IChpc0Z1bmMgJiYgIW9iamVjdCkpIHsKICAgICAgICBpZiAoaXNIb3N0T2JqZWN0KHZhbHVlKSkgewogICAgICAgICAgcmV0dXJuIG9iamVjdCA/IHZhbHVlIDoge307CiAgICAgICAgfQogICAgICAgIHJlc3VsdCA9IGluaXRDbG9uZU9iamVjdChpc0Z1bmMgPyB7fSA6IHZhbHVlKTsKICAgICAgICBpZiAoIWlzRGVlcCkgewogICAgICAgICAgcmV0dXJuIGNvcHlTeW1ib2xzKHZhbHVlLCBiYXNlQXNzaWduKHJlc3VsdCwgdmFsdWUpKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKCFjbG9uZWFibGVUYWdzW3RhZ10pIHsKICAgICAgICAgIHJldHVybiBvYmplY3QgPyB2YWx1ZSA6IHt9OwogICAgICAgIH0KICAgICAgICByZXN1bHQgPSBpbml0Q2xvbmVCeVRhZyh2YWx1ZSwgdGFnLCBiYXNlQ2xvbmUsIGlzRGVlcCk7CiAgICAgIH0KICAgIH0KICAgIC8vIENoZWNrIGZvciBjaXJjdWxhciByZWZlcmVuY2VzIGFuZCByZXR1cm4gaXRzIGNvcnJlc3BvbmRpbmcgY2xvbmUuCiAgICBzdGFjayB8fCAoc3RhY2sgPSBuZXcgU3RhY2spOwogICAgdmFyIHN0YWNrZWQgPSBzdGFjay5nZXQodmFsdWUpOwogICAgaWYgKHN0YWNrZWQpIHsKICAgICAgcmV0dXJuIHN0YWNrZWQ7CiAgICB9CiAgICBzdGFjay5zZXQodmFsdWUsIHJlc3VsdCk7CgogICAgaWYgKCFpc0FycikgewogICAgICB2YXIgcHJvcHMgPSBpc0Z1bGwgPyBnZXRBbGxLZXlzKHZhbHVlKSA6IGtleXModmFsdWUpOwogICAgfQogICAgYXJyYXlFYWNoKHByb3BzIHx8IHZhbHVlLCBmdW5jdGlvbihzdWJWYWx1ZSwga2V5KSB7CiAgICAgIGlmIChwcm9wcykgewogICAgICAgIGtleSA9IHN1YlZhbHVlOwogICAgICAgIHN1YlZhbHVlID0gdmFsdWVba2V5XTsKICAgICAgfQogICAgICAvLyBSZWN1cnNpdmVseSBwb3B1bGF0ZSBjbG9uZSAoc3VzY2VwdGlibGUgdG8gY2FsbCBzdGFjayBsaW1pdHMpLgogICAgICBhc3NpZ25WYWx1ZShyZXN1bHQsIGtleSwgYmFzZUNsb25lKHN1YlZhbHVlLCBpc0RlZXAsIGlzRnVsbCwgY3VzdG9taXplciwga2V5LCB2YWx1ZSwgc3RhY2spKTsKICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmNyZWF0ZWAgd2l0aG91dCBzdXBwb3J0IGZvciBhc3NpZ25pbmcKICAgKiBwcm9wZXJ0aWVzIHRvIHRoZSBjcmVhdGVkIG9iamVjdC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IHByb3RvdHlwZSBUaGUgb2JqZWN0IHRvIGluaGVyaXQgZnJvbS4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBuZXcgb2JqZWN0LgogICAqLwogIGZ1bmN0aW9uIGJhc2VDcmVhdGUocHJvdG8pIHsKICAgIHJldHVybiBpc09iamVjdChwcm90bykgPyBvYmplY3RDcmVhdGUocHJvdG8pIDoge307CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgZ2V0QWxsS2V5c2AgYW5kIGBnZXRBbGxLZXlzSW5gIHdoaWNoIHVzZXMKICAgKiBga2V5c0Z1bmNgIGFuZCBgc3ltYm9sc0Z1bmNgIHRvIGdldCB0aGUgZW51bWVyYWJsZSBwcm9wZXJ0eSBuYW1lcyBhbmQKICAgKiBzeW1ib2xzIG9mIGBvYmplY3RgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0ga2V5c0Z1bmMgVGhlIGZ1bmN0aW9uIHRvIGdldCB0aGUga2V5cyBvZiBgb2JqZWN0YC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBzeW1ib2xzRnVuYyBUaGUgZnVuY3Rpb24gdG8gZ2V0IHRoZSBzeW1ib2xzIG9mIGBvYmplY3RgLgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2YgcHJvcGVydHkgbmFtZXMgYW5kIHN5bWJvbHMuCiAgICovCiAgZnVuY3Rpb24gYmFzZUdldEFsbEtleXMob2JqZWN0LCBrZXlzRnVuYywgc3ltYm9sc0Z1bmMpIHsKICAgIHZhciByZXN1bHQgPSBrZXlzRnVuYyhvYmplY3QpOwogICAgcmV0dXJuIGlzQXJyYXkob2JqZWN0KSA/IHJlc3VsdCA6IGFycmF5UHVzaChyZXN1bHQsIHN5bWJvbHNGdW5jKG9iamVjdCkpOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYGdldFRhZ2AuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHF1ZXJ5LgogICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIGB0b1N0cmluZ1RhZ2AuCiAgICovCiAgZnVuY3Rpb24gYmFzZUdldFRhZyh2YWx1ZSkgewogICAgcmV0dXJuIG9iamVjdFRvU3RyaW5nLmNhbGwodmFsdWUpOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uaXNOYXRpdmVgIHdpdGhvdXQgYmFkIHNoaW0gY2hlY2tzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIG5hdGl2ZSBmdW5jdGlvbiwKICAgKiAgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VJc05hdGl2ZSh2YWx1ZSkgewogICAgaWYgKCFpc09iamVjdCh2YWx1ZSkgfHwgaXNNYXNrZWQodmFsdWUpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHZhciBwYXR0ZXJuID0gKGlzRnVuY3Rpb24odmFsdWUpIHx8IGlzSG9zdE9iamVjdCh2YWx1ZSkpID8gcmVJc05hdGl2ZSA6IHJlSXNIb3N0Q3RvcjsKICAgIHJldHVybiBwYXR0ZXJuLnRlc3QodG9Tb3VyY2UodmFsdWUpKTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmtleXNgIHdoaWNoIGRvZXNuJ3QgdHJlYXQgc3BhcnNlIGFycmF5cyBhcyBkZW5zZS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2YgcHJvcGVydHkgbmFtZXMuCiAgICovCiAgZnVuY3Rpb24gYmFzZUtleXMob2JqZWN0KSB7CiAgICBpZiAoIWlzUHJvdG90eXBlKG9iamVjdCkpIHsKICAgICAgcmV0dXJuIG5hdGl2ZUtleXMob2JqZWN0KTsKICAgIH0KICAgIHZhciByZXN1bHQgPSBbXTsKICAgIGZvciAodmFyIGtleSBpbiBPYmplY3Qob2JqZWN0KSkgewogICAgICBpZiAoaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIGtleSkgJiYga2V5ICE9ICdjb25zdHJ1Y3RvcicpIHsKICAgICAgICByZXN1bHQucHVzaChrZXkpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhIGNsb25lIG9mICBgYnVmZmVyYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtCdWZmZXJ9IGJ1ZmZlciBUaGUgYnVmZmVyIHRvIGNsb25lLgogICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzRGVlcF0gU3BlY2lmeSBhIGRlZXAgY2xvbmUuCiAgICogQHJldHVybnMge0J1ZmZlcn0gUmV0dXJucyB0aGUgY2xvbmVkIGJ1ZmZlci4KICAgKi8KICBmdW5jdGlvbiBjbG9uZUJ1ZmZlcihidWZmZXIsIGlzRGVlcCkgewogICAgaWYgKGlzRGVlcCkgewogICAgICByZXR1cm4gYnVmZmVyLnNsaWNlKCk7CiAgICB9CiAgICB2YXIgcmVzdWx0ID0gbmV3IGJ1ZmZlci5jb25zdHJ1Y3RvcihidWZmZXIubGVuZ3RoKTsKICAgIGJ1ZmZlci5jb3B5KHJlc3VsdCk7CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhIGNsb25lIG9mIGBhcnJheUJ1ZmZlcmAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7QXJyYXlCdWZmZXJ9IGFycmF5QnVmZmVyIFRoZSBhcnJheSBidWZmZXIgdG8gY2xvbmUuCiAgICogQHJldHVybnMge0FycmF5QnVmZmVyfSBSZXR1cm5zIHRoZSBjbG9uZWQgYXJyYXkgYnVmZmVyLgogICAqLwogIGZ1bmN0aW9uIGNsb25lQXJyYXlCdWZmZXIoYXJyYXlCdWZmZXIpIHsKICAgIHZhciByZXN1bHQgPSBuZXcgYXJyYXlCdWZmZXIuY29uc3RydWN0b3IoYXJyYXlCdWZmZXIuYnl0ZUxlbmd0aCk7CiAgICBuZXcgVWludDhBcnJheShyZXN1bHQpLnNldChuZXcgVWludDhBcnJheShhcnJheUJ1ZmZlcikpOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIENyZWF0ZXMgYSBjbG9uZSBvZiBgZGF0YVZpZXdgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YVZpZXcgVGhlIGRhdGEgdmlldyB0byBjbG9uZS4KICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc0RlZXBdIFNwZWNpZnkgYSBkZWVwIGNsb25lLgogICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIGNsb25lZCBkYXRhIHZpZXcuCiAgICovCiAgZnVuY3Rpb24gY2xvbmVEYXRhVmlldyhkYXRhVmlldywgaXNEZWVwKSB7CiAgICB2YXIgYnVmZmVyID0gaXNEZWVwID8gY2xvbmVBcnJheUJ1ZmZlcihkYXRhVmlldy5idWZmZXIpIDogZGF0YVZpZXcuYnVmZmVyOwogICAgcmV0dXJuIG5ldyBkYXRhVmlldy5jb25zdHJ1Y3RvcihidWZmZXIsIGRhdGFWaWV3LmJ5dGVPZmZzZXQsIGRhdGFWaWV3LmJ5dGVMZW5ndGgpOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhIGNsb25lIG9mIGBtYXBgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gbWFwIFRoZSBtYXAgdG8gY2xvbmUuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2xvbmVGdW5jIFRoZSBmdW5jdGlvbiB0byBjbG9uZSB2YWx1ZXMuCiAgICogQHBhcmFtIHtib29sZWFufSBbaXNEZWVwXSBTcGVjaWZ5IGEgZGVlcCBjbG9uZS4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjbG9uZWQgbWFwLgogICAqLwogIGZ1bmN0aW9uIGNsb25lTWFwKG1hcCwgaXNEZWVwLCBjbG9uZUZ1bmMpIHsKICAgIHZhciBhcnJheSA9IGlzRGVlcCA/IGNsb25lRnVuYyhtYXBUb0FycmF5KG1hcCksIHRydWUpIDogbWFwVG9BcnJheShtYXApOwogICAgcmV0dXJuIGFycmF5UmVkdWNlKGFycmF5LCBhZGRNYXBFbnRyeSwgbmV3IG1hcC5jb25zdHJ1Y3Rvcik7CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGEgY2xvbmUgb2YgYHJlZ2V4cGAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSByZWdleHAgVGhlIHJlZ2V4cCB0byBjbG9uZS4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjbG9uZWQgcmVnZXhwLgogICAqLwogIGZ1bmN0aW9uIGNsb25lUmVnRXhwKHJlZ2V4cCkgewogICAgdmFyIHJlc3VsdCA9IG5ldyByZWdleHAuY29uc3RydWN0b3IocmVnZXhwLnNvdXJjZSwgcmVGbGFncy5leGVjKHJlZ2V4cCkpOwogICAgcmVzdWx0Lmxhc3RJbmRleCA9IHJlZ2V4cC5sYXN0SW5kZXg7CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhIGNsb25lIG9mIGBzZXRgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gc2V0IFRoZSBzZXQgdG8gY2xvbmUuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2xvbmVGdW5jIFRoZSBmdW5jdGlvbiB0byBjbG9uZSB2YWx1ZXMuCiAgICogQHBhcmFtIHtib29sZWFufSBbaXNEZWVwXSBTcGVjaWZ5IGEgZGVlcCBjbG9uZS4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjbG9uZWQgc2V0LgogICAqLwogIGZ1bmN0aW9uIGNsb25lU2V0KHNldCwgaXNEZWVwLCBjbG9uZUZ1bmMpIHsKICAgIHZhciBhcnJheSA9IGlzRGVlcCA/IGNsb25lRnVuYyhzZXRUb0FycmF5KHNldCksIHRydWUpIDogc2V0VG9BcnJheShzZXQpOwogICAgcmV0dXJuIGFycmF5UmVkdWNlKGFycmF5LCBhZGRTZXRFbnRyeSwgbmV3IHNldC5jb25zdHJ1Y3Rvcik7CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGEgY2xvbmUgb2YgdGhlIGBzeW1ib2xgIG9iamVjdC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IHN5bWJvbCBUaGUgc3ltYm9sIG9iamVjdCB0byBjbG9uZS4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjbG9uZWQgc3ltYm9sIG9iamVjdC4KICAgKi8KICBmdW5jdGlvbiBjbG9uZVN5bWJvbChzeW1ib2wpIHsKICAgIHJldHVybiBzeW1ib2xWYWx1ZU9mID8gT2JqZWN0KHN5bWJvbFZhbHVlT2YuY2FsbChzeW1ib2wpKSA6IHt9OwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhIGNsb25lIG9mIGB0eXBlZEFycmF5YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IHR5cGVkQXJyYXkgVGhlIHR5cGVkIGFycmF5IHRvIGNsb25lLgogICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2lzRGVlcF0gU3BlY2lmeSBhIGRlZXAgY2xvbmUuCiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgY2xvbmVkIHR5cGVkIGFycmF5LgogICAqLwogIGZ1bmN0aW9uIGNsb25lVHlwZWRBcnJheSh0eXBlZEFycmF5LCBpc0RlZXApIHsKICAgIHZhciBidWZmZXIgPSBpc0RlZXAgPyBjbG9uZUFycmF5QnVmZmVyKHR5cGVkQXJyYXkuYnVmZmVyKSA6IHR5cGVkQXJyYXkuYnVmZmVyOwogICAgcmV0dXJuIG5ldyB0eXBlZEFycmF5LmNvbnN0cnVjdG9yKGJ1ZmZlciwgdHlwZWRBcnJheS5ieXRlT2Zmc2V0LCB0eXBlZEFycmF5Lmxlbmd0aCk7CiAgfQoKICAvKioKICAgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiBgc291cmNlYCB0byBgYXJyYXlgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0FycmF5fSBzb3VyY2UgVGhlIGFycmF5IHRvIGNvcHkgdmFsdWVzIGZyb20uCiAgICogQHBhcmFtIHtBcnJheX0gW2FycmF5PVtdXSBUaGUgYXJyYXkgdG8gY29weSB2YWx1ZXMgdG8uCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGBhcnJheWAuCiAgICovCiAgZnVuY3Rpb24gY29weUFycmF5KHNvdXJjZSwgYXJyYXkpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IHNvdXJjZS5sZW5ndGg7CgogICAgYXJyYXkgfHwgKGFycmF5ID0gQXJyYXkobGVuZ3RoKSk7CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICBhcnJheVtpbmRleF0gPSBzb3VyY2VbaW5kZXhdOwogICAgfQogICAgcmV0dXJuIGFycmF5OwogIH0KCiAgLyoqCiAgICogQ29waWVzIHByb3BlcnRpZXMgb2YgYHNvdXJjZWAgdG8gYG9iamVjdGAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBzb3VyY2UgVGhlIG9iamVjdCB0byBjb3B5IHByb3BlcnRpZXMgZnJvbS4KICAgKiBAcGFyYW0ge0FycmF5fSBwcm9wcyBUaGUgcHJvcGVydHkgaWRlbnRpZmllcnMgdG8gY29weS4KICAgKiBAcGFyYW0ge09iamVjdH0gW29iamVjdD17fV0gVGhlIG9iamVjdCB0byBjb3B5IHByb3BlcnRpZXMgdG8uCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2N1c3RvbWl6ZXJdIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgY29waWVkIHZhbHVlcy4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLgogICAqLwogIGZ1bmN0aW9uIGNvcHlPYmplY3Qoc291cmNlLCBwcm9wcywgb2JqZWN0LCBjdXN0b21pemVyKSB7CiAgICBvYmplY3QgfHwgKG9iamVjdCA9IHt9KTsKCiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICBsZW5ndGggPSBwcm9wcy5sZW5ndGg7CgogICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgdmFyIGtleSA9IHByb3BzW2luZGV4XTsKCiAgICAgIHZhciBuZXdWYWx1ZSA9IGN1c3RvbWl6ZXIKICAgICAgICA/IGN1c3RvbWl6ZXIob2JqZWN0W2tleV0sIHNvdXJjZVtrZXldLCBrZXksIG9iamVjdCwgc291cmNlKQogICAgICAgIDogdW5kZWZpbmVkOwoKICAgICAgYXNzaWduVmFsdWUob2JqZWN0LCBrZXksIG5ld1ZhbHVlID09PSB1bmRlZmluZWQgPyBzb3VyY2Vba2V5XSA6IG5ld1ZhbHVlKTsKICAgIH0KICAgIHJldHVybiBvYmplY3Q7CiAgfQoKICAvKioKICAgKiBDb3BpZXMgb3duIHN5bWJvbCBwcm9wZXJ0aWVzIG9mIGBzb3VyY2VgIHRvIGBvYmplY3RgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gc291cmNlIFRoZSBvYmplY3QgdG8gY29weSBzeW1ib2xzIGZyb20uCiAgICogQHBhcmFtIHtPYmplY3R9IFtvYmplY3Q9e31dIFRoZSBvYmplY3QgdG8gY29weSBzeW1ib2xzIHRvLgogICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYG9iamVjdGAuCiAgICovCiAgZnVuY3Rpb24gY29weVN5bWJvbHMoc291cmNlLCBvYmplY3QpIHsKICAgIHJldHVybiBjb3B5T2JqZWN0KHNvdXJjZSwgZ2V0U3ltYm9scyhzb3VyY2UpLCBvYmplY3QpOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiBvd24gZW51bWVyYWJsZSBwcm9wZXJ0eSBuYW1lcyBhbmQgc3ltYm9scyBvZiBgb2JqZWN0YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2YgcHJvcGVydHkgbmFtZXMgYW5kIHN5bWJvbHMuCiAgICovCiAgZnVuY3Rpb24gZ2V0QWxsS2V5cyhvYmplY3QpIHsKICAgIHJldHVybiBiYXNlR2V0QWxsS2V5cyhvYmplY3QsIGtleXMsIGdldFN5bWJvbHMpOwogIH0KCiAgLyoqCiAgICogR2V0cyB0aGUgZGF0YSBmb3IgYG1hcGAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBtYXAgVGhlIG1hcCB0byBxdWVyeS4KICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSByZWZlcmVuY2Uga2V5LgogICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBtYXAgZGF0YS4KICAgKi8KICBmdW5jdGlvbiBnZXRNYXBEYXRhKG1hcCwga2V5KSB7CiAgICB2YXIgZGF0YSA9IG1hcC5fX2RhdGFfXzsKICAgIHJldHVybiBpc0tleWFibGUoa2V5KQogICAgICA/IGRhdGFbdHlwZW9mIGtleSA9PSAnc3RyaW5nJyA/ICdzdHJpbmcnIDogJ2hhc2gnXQogICAgICA6IGRhdGEubWFwOwogIH0KCiAgLyoqCiAgICogR2V0cyB0aGUgbmF0aXZlIGZ1bmN0aW9uIGF0IGBrZXlgIG9mIGBvYmplY3RgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSBtZXRob2QgdG8gZ2V0LgogICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBmdW5jdGlvbiBpZiBpdCdzIG5hdGl2ZSwgZWxzZSBgdW5kZWZpbmVkYC4KICAgKi8KICBmdW5jdGlvbiBnZXROYXRpdmUob2JqZWN0LCBrZXkpIHsKICAgIHZhciB2YWx1ZSA9IGdldFZhbHVlKG9iamVjdCwga2V5KTsKICAgIHJldHVybiBiYXNlSXNOYXRpdmUodmFsdWUpID8gdmFsdWUgOiB1bmRlZmluZWQ7CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIHRoZSBvd24gZW51bWVyYWJsZSBzeW1ib2wgcHJvcGVydGllcyBvZiBgb2JqZWN0YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2Ygc3ltYm9scy4KICAgKi8KICB2YXIgZ2V0U3ltYm9scyA9IG5hdGl2ZUdldFN5bWJvbHMgPyBvdmVyQXJnKG5hdGl2ZUdldFN5bWJvbHMsIE9iamVjdCkgOiBzdHViQXJyYXk7CgogIC8qKgogICAqIEdldHMgdGhlIGB0b1N0cmluZ1RhZ2Agb2YgYHZhbHVlYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcXVlcnkuCiAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgYHRvU3RyaW5nVGFnYC4KICAgKi8KICB2YXIgZ2V0VGFnID0gYmFzZUdldFRhZzsKCiAgLy8gRmFsbGJhY2sgZm9yIGRhdGEgdmlld3MsIG1hcHMsIHNldHMsIGFuZCB3ZWFrIG1hcHMgaW4gSUUgMTEsCiAgLy8gZm9yIGRhdGEgdmlld3MgaW4gRWRnZSA8IDE0LCBhbmQgcHJvbWlzZXMgaW4gTm9kZS5qcy4KICBpZiAoKERhdGFWaWV3ICYmIGdldFRhZyhuZXcgRGF0YVZpZXcobmV3IEFycmF5QnVmZmVyKDEpKSkgIT0gZGF0YVZpZXdUYWcpIHx8CiAgICAgIChNYXAgJiYgZ2V0VGFnKG5ldyBNYXApICE9IG1hcFRhZykgfHwKICAgICAgKFByb21pc2UgJiYgZ2V0VGFnKFByb21pc2UucmVzb2x2ZSgpKSAhPSBwcm9taXNlVGFnKSB8fAogICAgICAoU2V0ICYmIGdldFRhZyhuZXcgU2V0KSAhPSBzZXRUYWcpIHx8CiAgICAgIChXZWFrTWFwICYmIGdldFRhZyhuZXcgV2Vha01hcCkgIT0gd2Vha01hcFRhZykpIHsKICAgIGdldFRhZyA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHZhciByZXN1bHQgPSBvYmplY3RUb1N0cmluZy5jYWxsKHZhbHVlKSwKICAgICAgICAgIEN0b3IgPSByZXN1bHQgPT0gb2JqZWN0VGFnID8gdmFsdWUuY29uc3RydWN0b3IgOiB1bmRlZmluZWQsCiAgICAgICAgICBjdG9yU3RyaW5nID0gQ3RvciA/IHRvU291cmNlKEN0b3IpIDogdW5kZWZpbmVkOwoKICAgICAgaWYgKGN0b3JTdHJpbmcpIHsKICAgICAgICBzd2l0Y2ggKGN0b3JTdHJpbmcpIHsKICAgICAgICAgIGNhc2UgZGF0YVZpZXdDdG9yU3RyaW5nOiByZXR1cm4gZGF0YVZpZXdUYWc7CiAgICAgICAgICBjYXNlIG1hcEN0b3JTdHJpbmc6IHJldHVybiBtYXBUYWc7CiAgICAgICAgICBjYXNlIHByb21pc2VDdG9yU3RyaW5nOiByZXR1cm4gcHJvbWlzZVRhZzsKICAgICAgICAgIGNhc2Ugc2V0Q3RvclN0cmluZzogcmV0dXJuIHNldFRhZzsKICAgICAgICAgIGNhc2Ugd2Vha01hcEN0b3JTdHJpbmc6IHJldHVybiB3ZWFrTWFwVGFnOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKICB9CgogIC8qKgogICAqIEluaXRpYWxpemVzIGFuIGFycmF5IGNsb25lLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gY2xvbmUuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBpbml0aWFsaXplZCBjbG9uZS4KICAgKi8KICBmdW5jdGlvbiBpbml0Q2xvbmVBcnJheShhcnJheSkgewogICAgdmFyIGxlbmd0aCA9IGFycmF5Lmxlbmd0aCwKICAgICAgICByZXN1bHQgPSBhcnJheS5jb25zdHJ1Y3RvcihsZW5ndGgpOwoKICAgIC8vIEFkZCBwcm9wZXJ0aWVzIGFzc2lnbmVkIGJ5IGBSZWdFeHAjZXhlY2AuCiAgICBpZiAobGVuZ3RoICYmIHR5cGVvZiBhcnJheVswXSA9PSAnc3RyaW5nJyAmJiBoYXNPd25Qcm9wZXJ0eS5jYWxsKGFycmF5LCAnaW5kZXgnKSkgewogICAgICByZXN1bHQuaW5kZXggPSBhcnJheS5pbmRleDsKICAgICAgcmVzdWx0LmlucHV0ID0gYXJyYXkuaW5wdXQ7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogSW5pdGlhbGl6ZXMgYW4gb2JqZWN0IGNsb25lLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gY2xvbmUuCiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgaW5pdGlhbGl6ZWQgY2xvbmUuCiAgICovCiAgZnVuY3Rpb24gaW5pdENsb25lT2JqZWN0KG9iamVjdCkgewogICAgcmV0dXJuICh0eXBlb2Ygb2JqZWN0LmNvbnN0cnVjdG9yID09ICdmdW5jdGlvbicgJiYgIWlzUHJvdG90eXBlKG9iamVjdCkpCiAgICAgID8gYmFzZUNyZWF0ZShnZXRQcm90b3R5cGUob2JqZWN0KSkKICAgICAgOiB7fTsKICB9CgogIC8qKgogICAqIEluaXRpYWxpemVzIGFuIG9iamVjdCBjbG9uZSBiYXNlZCBvbiBpdHMgYHRvU3RyaW5nVGFnYC4KICAgKgogICAqICoqTm90ZToqKiBUaGlzIGZ1bmN0aW9uIG9ubHkgc3VwcG9ydHMgY2xvbmluZyB2YWx1ZXMgd2l0aCB0YWdzIG9mCiAgICogYEJvb2xlYW5gLCBgRGF0ZWAsIGBFcnJvcmAsIGBOdW1iZXJgLCBgUmVnRXhwYCwgb3IgYFN0cmluZ2AuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBjbG9uZS4KICAgKiBAcGFyYW0ge3N0cmluZ30gdGFnIFRoZSBgdG9TdHJpbmdUYWdgIG9mIHRoZSBvYmplY3QgdG8gY2xvbmUuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2xvbmVGdW5jIFRoZSBmdW5jdGlvbiB0byBjbG9uZSB2YWx1ZXMuCiAgICogQHBhcmFtIHtib29sZWFufSBbaXNEZWVwXSBTcGVjaWZ5IGEgZGVlcCBjbG9uZS4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBpbml0aWFsaXplZCBjbG9uZS4KICAgKi8KICBmdW5jdGlvbiBpbml0Q2xvbmVCeVRhZyhvYmplY3QsIHRhZywgY2xvbmVGdW5jLCBpc0RlZXApIHsKICAgIHZhciBDdG9yID0gb2JqZWN0LmNvbnN0cnVjdG9yOwogICAgc3dpdGNoICh0YWcpIHsKICAgICAgY2FzZSBhcnJheUJ1ZmZlclRhZzoKICAgICAgICByZXR1cm4gY2xvbmVBcnJheUJ1ZmZlcihvYmplY3QpOwoKICAgICAgY2FzZSBib29sVGFnOgogICAgICBjYXNlIGRhdGVUYWc6CiAgICAgICAgcmV0dXJuIG5ldyBDdG9yKCtvYmplY3QpOwoKICAgICAgY2FzZSBkYXRhVmlld1RhZzoKICAgICAgICByZXR1cm4gY2xvbmVEYXRhVmlldyhvYmplY3QsIGlzRGVlcCk7CgogICAgICBjYXNlIGZsb2F0MzJUYWc6IGNhc2UgZmxvYXQ2NFRhZzoKICAgICAgY2FzZSBpbnQ4VGFnOiBjYXNlIGludDE2VGFnOiBjYXNlIGludDMyVGFnOgogICAgICBjYXNlIHVpbnQ4VGFnOiBjYXNlIHVpbnQ4Q2xhbXBlZFRhZzogY2FzZSB1aW50MTZUYWc6IGNhc2UgdWludDMyVGFnOgogICAgICAgIHJldHVybiBjbG9uZVR5cGVkQXJyYXkob2JqZWN0LCBpc0RlZXApOwoKICAgICAgY2FzZSBtYXBUYWc6CiAgICAgICAgcmV0dXJuIGNsb25lTWFwKG9iamVjdCwgaXNEZWVwLCBjbG9uZUZ1bmMpOwoKICAgICAgY2FzZSBudW1iZXJUYWc6CiAgICAgIGNhc2Ugc3RyaW5nVGFnOgogICAgICAgIHJldHVybiBuZXcgQ3RvcihvYmplY3QpOwoKICAgICAgY2FzZSByZWdleHBUYWc6CiAgICAgICAgcmV0dXJuIGNsb25lUmVnRXhwKG9iamVjdCk7CgogICAgICBjYXNlIHNldFRhZzoKICAgICAgICByZXR1cm4gY2xvbmVTZXQob2JqZWN0LCBpc0RlZXAsIGNsb25lRnVuYyk7CgogICAgICBjYXNlIHN5bWJvbFRhZzoKICAgICAgICByZXR1cm4gY2xvbmVTeW1ib2wob2JqZWN0KTsKICAgIH0KICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGEgdmFsaWQgYXJyYXktbGlrZSBpbmRleC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHBhcmFtIHtudW1iZXJ9IFtsZW5ndGg9TUFYX1NBRkVfSU5URUdFUl0gVGhlIHVwcGVyIGJvdW5kcyBvZiBhIHZhbGlkIGluZGV4LgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgdmFsaWQgaW5kZXgsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBpc0luZGV4KHZhbHVlLCBsZW5ndGgpIHsKICAgIGxlbmd0aCA9IGxlbmd0aCA9PSBudWxsID8gTUFYX1NBRkVfSU5URUdFUiA6IGxlbmd0aDsKICAgIHJldHVybiAhIWxlbmd0aCAmJgogICAgICAodHlwZW9mIHZhbHVlID09ICdudW1iZXInIHx8IHJlSXNVaW50LnRlc3QodmFsdWUpKSAmJgogICAgICAodmFsdWUgPiAtMSAmJiB2YWx1ZSAlIDEgPT0gMCAmJiB2YWx1ZSA8IGxlbmd0aCk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBzdWl0YWJsZSBmb3IgdXNlIGFzIHVuaXF1ZSBvYmplY3Qga2V5LgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBzdWl0YWJsZSwgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGlzS2V5YWJsZSh2YWx1ZSkgewogICAgdmFyIHR5cGUgPSB0eXBlb2YgdmFsdWU7CiAgICByZXR1cm4gKHR5cGUgPT0gJ3N0cmluZycgfHwgdHlwZSA9PSAnbnVtYmVyJyB8fCB0eXBlID09ICdzeW1ib2wnIHx8IHR5cGUgPT0gJ2Jvb2xlYW4nKQogICAgICA/ICh2YWx1ZSAhPT0gJ19fcHJvdG9fXycpCiAgICAgIDogKHZhbHVlID09PSBudWxsKTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgZnVuY2AgaGFzIGl0cyBzb3VyY2UgbWFza2VkLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYGZ1bmNgIGlzIG1hc2tlZCwgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGlzTWFza2VkKGZ1bmMpIHsKICAgIHJldHVybiAhIW1hc2tTcmNLZXkgJiYgKG1hc2tTcmNLZXkgaW4gZnVuYyk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBsaWtlbHkgYSBwcm90b3R5cGUgb2JqZWN0LgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHByb3RvdHlwZSwgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGlzUHJvdG90eXBlKHZhbHVlKSB7CiAgICB2YXIgQ3RvciA9IHZhbHVlICYmIHZhbHVlLmNvbnN0cnVjdG9yLAogICAgICAgIHByb3RvID0gKHR5cGVvZiBDdG9yID09ICdmdW5jdGlvbicgJiYgQ3Rvci5wcm90b3R5cGUpIHx8IG9iamVjdFByb3RvOwoKICAgIHJldHVybiB2YWx1ZSA9PT0gcHJvdG87CiAgfQoKICAvKioKICAgKiBDb252ZXJ0cyBgZnVuY2AgdG8gaXRzIHNvdXJjZSBjb2RlLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBwcm9jZXNzLgogICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIHNvdXJjZSBjb2RlLgogICAqLwogIGZ1bmN0aW9uIHRvU291cmNlKGZ1bmMpIHsKICAgIGlmIChmdW5jICE9IG51bGwpIHsKICAgICAgdHJ5IHsKICAgICAgICByZXR1cm4gZnVuY1RvU3RyaW5nLmNhbGwoZnVuYyk7CiAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIChmdW5jICsgJycpOwogICAgICB9IGNhdGNoIChlKSB7fQogICAgfQogICAgcmV0dXJuICcnOwogIH0KCiAgLyoqCiAgICogVGhpcyBtZXRob2QgaXMgbGlrZSBgXy5jbG9uZWAgZXhjZXB0IHRoYXQgaXQgcmVjdXJzaXZlbHkgY2xvbmVzIGB2YWx1ZWAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMS4wLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHJlY3Vyc2l2ZWx5IGNsb25lLgogICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBkZWVwIGNsb25lZCB2YWx1ZS4KICAgKiBAc2VlIF8uY2xvbmUKICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIG9iamVjdHMgPSBbeyAnYSc6IDEgfSwgeyAnYic6IDIgfV07CiAgICoKICAgKiB2YXIgZGVlcCA9IF8uY2xvbmVEZWVwKG9iamVjdHMpOwogICAqIGNvbnNvbGUubG9nKGRlZXBbMF0gPT09IG9iamVjdHNbMF0pOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gY2xvbmVEZWVwKHZhbHVlKSB7CiAgICByZXR1cm4gYmFzZUNsb25lKHZhbHVlLCB0cnVlLCB0cnVlKTsKICB9CgogIC8qKgogICAqIFBlcmZvcm1zIGEKICAgKiBbYFNhbWVWYWx1ZVplcm9gXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1zYW1ldmFsdWV6ZXJvKQogICAqIGNvbXBhcmlzb24gYmV0d2VlbiB0d28gdmFsdWVzIHRvIGRldGVybWluZSBpZiB0aGV5IGFyZSBlcXVpdmFsZW50LgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMC4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb21wYXJlLgogICAqIEBwYXJhbSB7Kn0gb3RoZXIgVGhlIG90aGVyIHZhbHVlIHRvIGNvbXBhcmUuCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSB2YWx1ZXMgYXJlIGVxdWl2YWxlbnQsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIG9iamVjdCA9IHsgJ2EnOiAxIH07CiAgICogdmFyIG90aGVyID0geyAnYSc6IDEgfTsKICAgKgogICAqIF8uZXEob2JqZWN0LCBvYmplY3QpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uZXEob2JqZWN0LCBvdGhlcik7CiAgICogLy8gPT4gZmFsc2UKICAgKgogICAqIF8uZXEoJ2EnLCAnYScpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uZXEoJ2EnLCBPYmplY3QoJ2EnKSk7CiAgICogLy8gPT4gZmFsc2UKICAgKgogICAqIF8uZXEoTmFOLCBOYU4pOwogICAqIC8vID0+IHRydWUKICAgKi8KICBmdW5jdGlvbiBlcSh2YWx1ZSwgb3RoZXIpIHsKICAgIHJldHVybiB2YWx1ZSA9PT0gb3RoZXIgfHwgKHZhbHVlICE9PSB2YWx1ZSAmJiBvdGhlciAhPT0gb3RoZXIpOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgbGlrZWx5IGFuIGBhcmd1bWVudHNgIG9iamVjdC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYW4gYGFyZ3VtZW50c2Agb2JqZWN0LAogICAqICBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uaXNBcmd1bWVudHMoZnVuY3Rpb24oKSB7IHJldHVybiBhcmd1bWVudHM7IH0oKSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0FyZ3VtZW50cyhbMSwgMiwgM10pOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNBcmd1bWVudHModmFsdWUpIHsKICAgIC8vIFNhZmFyaSA4LjEgbWFrZXMgYGFyZ3VtZW50cy5jYWxsZWVgIGVudW1lcmFibGUgaW4gc3RyaWN0IG1vZGUuCiAgICByZXR1cm4gaXNBcnJheUxpa2VPYmplY3QodmFsdWUpICYmIGhhc093blByb3BlcnR5LmNhbGwodmFsdWUsICdjYWxsZWUnKSAmJgogICAgICAoIXByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwodmFsdWUsICdjYWxsZWUnKSB8fCBvYmplY3RUb1N0cmluZy5jYWxsKHZhbHVlKSA9PSBhcmdzVGFnKTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYW4gYEFycmF5YCBvYmplY3QuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGFuIGFycmF5LCBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uaXNBcnJheShbMSwgMiwgM10pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNBcnJheShkb2N1bWVudC5ib2R5LmNoaWxkcmVuKTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5pc0FycmF5KCdhYmMnKTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5pc0FycmF5KF8ubm9vcCk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICB2YXIgaXNBcnJheSA9IEFycmF5LmlzQXJyYXk7CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGFycmF5LWxpa2UuIEEgdmFsdWUgaXMgY29uc2lkZXJlZCBhcnJheS1saWtlIGlmIGl0J3MKICAgKiBub3QgYSBmdW5jdGlvbiBhbmQgaGFzIGEgYHZhbHVlLmxlbmd0aGAgdGhhdCdzIGFuIGludGVnZXIgZ3JlYXRlciB0aGFuIG9yCiAgICogZXF1YWwgdG8gYDBgIGFuZCBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gYE51bWJlci5NQVhfU0FGRV9JTlRFR0VSYC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYXJyYXktbGlrZSwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzQXJyYXlMaWtlKFsxLCAyLCAzXSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0FycmF5TGlrZShkb2N1bWVudC5ib2R5LmNoaWxkcmVuKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzQXJyYXlMaWtlKCdhYmMnKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzQXJyYXlMaWtlKF8ubm9vcCk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc0FycmF5TGlrZSh2YWx1ZSkgewogICAgcmV0dXJuIHZhbHVlICE9IG51bGwgJiYgaXNMZW5ndGgodmFsdWUubGVuZ3RoKSAmJiAhaXNGdW5jdGlvbih2YWx1ZSk7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCBpcyBsaWtlIGBfLmlzQXJyYXlMaWtlYCBleGNlcHQgdGhhdCBpdCBhbHNvIGNoZWNrcyBpZiBgdmFsdWVgCiAgICogaXMgYW4gb2JqZWN0LgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMC4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhbiBhcnJheS1saWtlIG9iamVjdCwKICAgKiAgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzQXJyYXlMaWtlT2JqZWN0KFsxLCAyLCAzXSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0FycmF5TGlrZU9iamVjdChkb2N1bWVudC5ib2R5LmNoaWxkcmVuKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzQXJyYXlMaWtlT2JqZWN0KCdhYmMnKTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5pc0FycmF5TGlrZU9iamVjdChfLm5vb3ApOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNBcnJheUxpa2VPYmplY3QodmFsdWUpIHsKICAgIHJldHVybiBpc09iamVjdExpa2UodmFsdWUpICYmIGlzQXJyYXlMaWtlKHZhbHVlKTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGEgYnVmZmVyLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMy4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIGJ1ZmZlciwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzQnVmZmVyKG5ldyBCdWZmZXIoMikpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNCdWZmZXIobmV3IFVpbnQ4QXJyYXkoMikpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgdmFyIGlzQnVmZmVyID0gbmF0aXZlSXNCdWZmZXIgfHwgc3R1YkZhbHNlOwoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBjbGFzc2lmaWVkIGFzIGEgYEZ1bmN0aW9uYCBvYmplY3QuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgZnVuY3Rpb24sIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc0Z1bmN0aW9uKF8pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNGdW5jdGlvbigvYWJjLyk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc0Z1bmN0aW9uKHZhbHVlKSB7CiAgICAvLyBUaGUgdXNlIG9mIGBPYmplY3QjdG9TdHJpbmdgIGF2b2lkcyBpc3N1ZXMgd2l0aCB0aGUgYHR5cGVvZmAgb3BlcmF0b3IKICAgIC8vIGluIFNhZmFyaSA4LTkgd2hpY2ggcmV0dXJucyAnb2JqZWN0JyBmb3IgdHlwZWQgYXJyYXkgYW5kIG90aGVyIGNvbnN0cnVjdG9ycy4KICAgIHZhciB0YWcgPSBpc09iamVjdCh2YWx1ZSkgPyBvYmplY3RUb1N0cmluZy5jYWxsKHZhbHVlKSA6ICcnOwogICAgcmV0dXJuIHRhZyA9PSBmdW5jVGFnIHx8IHRhZyA9PSBnZW5UYWc7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBhIHZhbGlkIGFycmF5LWxpa2UgbGVuZ3RoLgogICAqCiAgICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGlzIGxvb3NlbHkgYmFzZWQgb24KICAgKiBbYFRvTGVuZ3RoYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtdG9sZW5ndGgpLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMC4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHZhbGlkIGxlbmd0aCwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzTGVuZ3RoKDMpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNMZW5ndGgoTnVtYmVyLk1JTl9WQUxVRSk7CiAgICogLy8gPT4gZmFsc2UKICAgKgogICAqIF8uaXNMZW5ndGgoSW5maW5pdHkpOwogICAqIC8vID0+IGZhbHNlCiAgICoKICAgKiBfLmlzTGVuZ3RoKCczJyk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc0xlbmd0aCh2YWx1ZSkgewogICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJyAmJgogICAgICB2YWx1ZSA+IC0xICYmIHZhbHVlICUgMSA9PSAwICYmIHZhbHVlIDw9IE1BWF9TQUZFX0lOVEVHRVI7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyB0aGUKICAgKiBbbGFuZ3VhZ2UgdHlwZV0oaHR0cDovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLWVjbWFzY3JpcHQtbGFuZ3VhZ2UtdHlwZXMpCiAgICogb2YgYE9iamVjdGAuIChlLmcuIGFycmF5cywgZnVuY3Rpb25zLCBvYmplY3RzLCByZWdleGVzLCBgbmV3IE51bWJlcigwKWAsIGFuZCBgbmV3IFN0cmluZygnJylgKQogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDAuMS4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhbiBvYmplY3QsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc09iamVjdCh7fSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc09iamVjdChbMSwgMiwgM10pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNPYmplY3QoXy5ub29wKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzT2JqZWN0KG51bGwpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNPYmplY3QodmFsdWUpIHsKICAgIHZhciB0eXBlID0gdHlwZW9mIHZhbHVlOwogICAgcmV0dXJuICEhdmFsdWUgJiYgKHR5cGUgPT0gJ29iamVjdCcgfHwgdHlwZSA9PSAnZnVuY3Rpb24nKTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIG9iamVjdC1saWtlLiBBIHZhbHVlIGlzIG9iamVjdC1saWtlIGlmIGl0J3Mgbm90IGBudWxsYAogICAqIGFuZCBoYXMgYSBgdHlwZW9mYCByZXN1bHQgb2YgIm9iamVjdCIuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4wLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIG9iamVjdC1saWtlLCBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uaXNPYmplY3RMaWtlKHt9KTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzT2JqZWN0TGlrZShbMSwgMiwgM10pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNPYmplY3RMaWtlKF8ubm9vcCk7CiAgICogLy8gPT4gZmFsc2UKICAgKgogICAqIF8uaXNPYmplY3RMaWtlKG51bGwpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNPYmplY3RMaWtlKHZhbHVlKSB7CiAgICByZXR1cm4gISF2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT0gJ29iamVjdCc7CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIHRoZSBvd24gZW51bWVyYWJsZSBwcm9wZXJ0eSBuYW1lcyBvZiBgb2JqZWN0YC4KICAgKgogICAqICoqTm90ZToqKiBOb24tb2JqZWN0IHZhbHVlcyBhcmUgY29lcmNlZCB0byBvYmplY3RzLiBTZWUgdGhlCiAgICogW0VTIHNwZWNdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLW9iamVjdC5rZXlzKQogICAqIGZvciBtb3JlIGRldGFpbHMuCiAgICoKICAgKiBAc3RhdGljCiAgICogQHNpbmNlIDAuMS4wCiAgICogQG1lbWJlck9mIF8KICAgKiBAY2F0ZWdvcnkgT2JqZWN0CiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2YgcHJvcGVydHkgbmFtZXMuCiAgICogQGV4YW1wbGUKICAgKgogICAqIGZ1bmN0aW9uIEZvbygpIHsKICAgKiAgIHRoaXMuYSA9IDE7CiAgICogICB0aGlzLmIgPSAyOwogICAqIH0KICAgKgogICAqIEZvby5wcm90b3R5cGUuYyA9IDM7CiAgICoKICAgKiBfLmtleXMobmV3IEZvbyk7CiAgICogLy8gPT4gWydhJywgJ2InXSAoaXRlcmF0aW9uIG9yZGVyIGlzIG5vdCBndWFyYW50ZWVkKQogICAqCiAgICogXy5rZXlzKCdoaScpOwogICAqIC8vID0+IFsnMCcsICcxJ10KICAgKi8KICBmdW5jdGlvbiBrZXlzKG9iamVjdCkgewogICAgcmV0dXJuIGlzQXJyYXlMaWtlKG9iamVjdCkgPyBhcnJheUxpa2VLZXlzKG9iamVjdCkgOiBiYXNlS2V5cyhvYmplY3QpOwogIH0KCiAgLyoqCiAgICogVGhpcyBtZXRob2QgcmV0dXJucyBhIG5ldyBlbXB0eSBhcnJheS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjEzLjAKICAgKiBAY2F0ZWdvcnkgVXRpbAogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgbmV3IGVtcHR5IGFycmF5LgogICAqIEBleGFtcGxlCiAgICoKICAgKiB2YXIgYXJyYXlzID0gXy50aW1lcygyLCBfLnN0dWJBcnJheSk7CiAgICoKICAgKiBjb25zb2xlLmxvZyhhcnJheXMpOwogICAqIC8vID0+IFtbXSwgW11dCiAgICoKICAgKiBjb25zb2xlLmxvZyhhcnJheXNbMF0gPT09IGFycmF5c1sxXSk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBzdHViQXJyYXkoKSB7CiAgICByZXR1cm4gW107CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCByZXR1cm5zIGBmYWxzZWAuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgNC4xMy4wCiAgICogQGNhdGVnb3J5IFV0aWwKICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLnRpbWVzKDIsIF8uc3R1YkZhbHNlKTsKICAgKiAvLyA9PiBbZmFsc2UsIGZhbHNlXQogICAqLwogIGZ1bmN0aW9uIHN0dWJGYWxzZSgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIG1vZHVsZS5leHBvcnRzID0gY2xvbmVEZWVwOwogIH0pOwoKICB2YXIgaGFzUHJvcGVydHkgPSBmdW5jdGlvbiBoYXMob2JqZWN0LCBrZXkpIHsKICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBrZXkpOwogIH07CgogIHZhciBfYXBwbHk7CgogIGZ1bmN0aW9uIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ4KHJlY2VpdmVyLCBwcml2YXRlS2V5KSB7IGlmICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHJlY2VpdmVyLCBwcml2YXRlS2V5KSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJhdHRlbXB0ZWQgdG8gdXNlIHByaXZhdGUgZmllbGQgb24gbm9uLWluc3RhbmNlIik7IH0gcmV0dXJuIHJlY2VpdmVyOyB9CgogIHZhciBpZCQ4ID0gMDsKCiAgZnVuY3Rpb24gX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VLZXkkOChuYW1lKSB7IHJldHVybiAiX19wcml2YXRlXyIgKyBpZCQ4KysgKyAiXyIgKyBuYW1lOyB9CgoKCiAgZnVuY3Rpb24gaW5zZXJ0UmVwbGFjZW1lbnQoc291cmNlLCByeCwgcmVwbGFjZW1lbnQpIHsKICAgIGNvbnN0IG5ld1BhcnRzID0gW107CiAgICBzb3VyY2UuZm9yRWFjaChjaHVuayA9PiB7CiAgICAgIC8vIFdoZW4gdGhlIHNvdXJjZSBjb250YWlucyBtdWx0aXBsZSBwbGFjZWhvbGRlcnMgZm9yIGludGVycG9sYXRpb24sCiAgICAgIC8vIHdlIHNob3VsZCBpZ25vcmUgY2h1bmtzIHRoYXQgYXJlIG5vdCBzdHJpbmdzLCBiZWNhdXNlIHRob3NlCiAgICAgIC8vIGNhbiBiZSBKU1ggb2JqZWN0cyBhbmQgd2lsbCBiZSBvdGhlcndpc2UgaW5jb3JyZWN0bHkgdHVybmVkIGludG8gc3RyaW5ncy4KICAgICAgLy8gV2l0aG91dCB0aGlzIGNvbmRpdGlvbiB3ZeKAmWQgZ2V0IHRoaXM6IFtvYmplY3QgT2JqZWN0XSBoZWxsbyBbb2JqZWN0IE9iamVjdF0gbXkgPGJ1dHRvbj4KICAgICAgaWYgKHR5cGVvZiBjaHVuayAhPT0gJ3N0cmluZycpIHsKICAgICAgICByZXR1cm4gbmV3UGFydHMucHVzaChjaHVuayk7CiAgICAgIH0KCiAgICAgIHJldHVybiByeFtTeW1ib2wuc3BsaXRdKGNodW5rKS5mb3JFYWNoKChyYXcsIGksIGxpc3QpID0+IHsKICAgICAgICBpZiAocmF3ICE9PSAnJykgewogICAgICAgICAgbmV3UGFydHMucHVzaChyYXcpOwogICAgICAgIH0gLy8gSW50ZXJsYWNlIHdpdGggdGhlIGByZXBsYWNlbWVudGAgdmFsdWUKCgogICAgICAgIGlmIChpIDwgbGlzdC5sZW5ndGggLSAxKSB7CiAgICAgICAgICBuZXdQYXJ0cy5wdXNoKHJlcGxhY2VtZW50KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CiAgICByZXR1cm4gbmV3UGFydHM7CiAgfQogIC8qKgogICAqIFRha2VzIGEgc3RyaW5nIHdpdGggcGxhY2Vob2xkZXIgdmFyaWFibGVzIGxpa2UgYCV7c21hcnRfY291bnR9IGZpbGUgc2VsZWN0ZWRgCiAgICogYW5kIHJlcGxhY2VzIGl0IHdpdGggdmFsdWVzIGZyb20gb3B0aW9ucyBge3NtYXJ0X2NvdW50OiA1fWAKICAgKgogICAqIEBsaWNlbnNlIGh0dHBzOi8vZ2l0aHViLmNvbS9haXJibmIvcG9seWdsb3QuanMvYmxvYi9tYXN0ZXIvTElDRU5TRQogICAqIHRha2VuIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2FpcmJuYi9wb2x5Z2xvdC5qcy9ibG9iL21hc3Rlci9saWIvcG9seWdsb3QuanMjTDI5OQogICAqCiAgICogQHBhcmFtIHtzdHJpbmd9IHBocmFzZSB0aGF0IG5lZWRzIGludGVycG9sYXRpb24sIHdpdGggcGxhY2Vob2xkZXJzCiAgICogQHBhcmFtIHtvYmplY3R9IG9wdGlvbnMgd2l0aCB2YWx1ZXMgdGhhdCB3aWxsIGJlIHVzZWQgdG8gcmVwbGFjZSBwbGFjZWhvbGRlcnMKICAgKiBAcmV0dXJucyB7YW55W119IGludGVycG9sYXRlZAogICAqLwoKCiAgZnVuY3Rpb24gaW50ZXJwb2xhdGUocGhyYXNlLCBvcHRpb25zKSB7CiAgICBjb25zdCBkb2xsYXJSZWdleCA9IC9cJC9nOwogICAgY29uc3QgZG9sbGFyQmlsbHNZYWxsID0gJyQkJCQnOwogICAgbGV0IGludGVycG9sYXRlZCA9IFtwaHJhc2VdOwogICAgaWYgKG9wdGlvbnMgPT0gbnVsbCkgcmV0dXJuIGludGVycG9sYXRlZDsKCiAgICBmb3IgKGNvbnN0IGFyZyBvZiBPYmplY3Qua2V5cyhvcHRpb25zKSkgewogICAgICBpZiAoYXJnICE9PSAnXycpIHsKICAgICAgICAvLyBFbnN1cmUgcmVwbGFjZW1lbnQgdmFsdWUgaXMgZXNjYXBlZCB0byBwcmV2ZW50IHNwZWNpYWwgJC1wcmVmaXhlZAogICAgICAgIC8vIHJlZ2V4IHJlcGxhY2UgdG9rZW5zLiB0aGUgIiQkJCQiIGlzIG5lZWRlZCBiZWNhdXNlIGVhY2ggIiQiIG5lZWRzIHRvCiAgICAgICAgLy8gYmUgZXNjYXBlZCB3aXRoICIkIiBpdHNlbGYsIGFuZCB3ZSBuZWVkIHR3byBpbiB0aGUgcmVzdWx0aW5nIG91dHB1dC4KICAgICAgICBsZXQgcmVwbGFjZW1lbnQgPSBvcHRpb25zW2FyZ107CgogICAgICAgIGlmICh0eXBlb2YgcmVwbGFjZW1lbnQgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICByZXBsYWNlbWVudCA9IGRvbGxhclJlZ2V4W1N5bWJvbC5yZXBsYWNlXShyZXBsYWNlbWVudCwgZG9sbGFyQmlsbHNZYWxsKTsKICAgICAgICB9IC8vIFdlIGNyZWF0ZSBhIG5ldyBgUmVnRXhwYCBlYWNoIHRpbWUgaW5zdGVhZCBvZiB1c2luZyBhIG1vcmUtZWZmaWNpZW50CiAgICAgICAgLy8gc3RyaW5nIHJlcGxhY2Ugc28gdGhhdCB0aGUgc2FtZSBhcmd1bWVudCBjYW4gYmUgcmVwbGFjZWQgbXVsdGlwbGUgdGltZXMKICAgICAgICAvLyBpbiB0aGUgc2FtZSBwaHJhc2UuCgoKICAgICAgICBpbnRlcnBvbGF0ZWQgPSBpbnNlcnRSZXBsYWNlbWVudChpbnRlcnBvbGF0ZWQsIG5ldyBSZWdFeHAoYCVcXHske2FyZ31cXH1gLCAnZycpLCByZXBsYWNlbWVudCk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gaW50ZXJwb2xhdGVkOwogIH0KICAvKioKICAgKiBUcmFuc2xhdGVzIHN0cmluZ3Mgd2l0aCBpbnRlcnBvbGF0aW9uICYgcGx1cmFsaXphdGlvbiBzdXBwb3J0LgogICAqIEV4dGVuc2libGUgd2l0aCBjdXN0b20gZGljdGlvbmFyaWVzIGFuZCBwbHVyYWxpemF0aW9uIGZ1bmN0aW9ucy4KICAgKgogICAqIEJvcnJvd3MgaGVhdmlseSBmcm9tIGFuZCBpbnNwaXJlZCBieSBQb2x5Z2xvdCBodHRwczovL2dpdGh1Yi5jb20vYWlyYm5iL3BvbHlnbG90LmpzLAogICAqIGJhc2ljYWxseSBhIHN0cmlwcGVkLWRvd24gdmVyc2lvbiBvZiBpdC4gRGlmZmVyZW5jZXM6IHBsdXJhbGl6YXRpb24gZnVuY3Rpb25zIGFyZSBub3QgaGFyZGNvZGVkCiAgICogYW5kIGNhbiBiZSBlYXNpbHkgYWRkZWQgYW1vbmcgd2l0aCBkaWN0aW9uYXJpZXMsIG5lc3RlZCBvYmplY3RzIGFyZSB1c2VkIGZvciBwbHVyYWxpemF0aW9uCiAgICogYXMgb3Bwb3NlZCB0byBgfHx8fGAgZGVsaW1ldGVyCiAgICoKICAgKiBVc2FnZSBleGFtcGxlOiBgdHJhbnNsYXRvci50cmFuc2xhdGUoJ2ZpbGVzX2Nob3NlbicsIHtzbWFydF9jb3VudDogM30pYAogICAqLwoKCiAgdmFyIFRyYW5zbGF0b3JfMSA9IChfYXBwbHkgPSAvKiNfX1BVUkVfXyovX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VLZXkkOCgiYXBwbHkiKSwgY2xhc3MgVHJhbnNsYXRvciB7CiAgICAvKioKICAgICAqIEBwYXJhbSB7b2JqZWN0fEFycmF5PG9iamVjdD59IGxvY2FsZXMgLSBsb2NhbGUgb3IgbGlzdCBvZiBsb2NhbGVzLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihsb2NhbGVzKSB7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBfYXBwbHksIHsKICAgICAgICB2YWx1ZTogX2FwcGx5MgogICAgICB9KTsKICAgICAgdGhpcy5sb2NhbGUgPSB7CiAgICAgICAgc3RyaW5nczoge30sCgogICAgICAgIHBsdXJhbGl6ZShuKSB7CiAgICAgICAgICBpZiAobiA9PT0gMSkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gMTsKICAgICAgICB9CgogICAgICB9OwoKICAgICAgaWYgKEFycmF5LmlzQXJyYXkobG9jYWxlcykpIHsKICAgICAgICBsb2NhbGVzLmZvckVhY2goX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDgodGhpcywgX2FwcGx5KVtfYXBwbHldLCB0aGlzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkOCh0aGlzLCBfYXBwbHkpW19hcHBseV0obG9jYWxlcyk7CiAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFB1YmxpYyB0cmFuc2xhdGUgbWV0aG9kCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd9IGtleQogICAgICogQHBhcmFtIHtvYmplY3R9IG9wdGlvbnMgd2l0aCB2YWx1ZXMgdGhhdCB3aWxsIGJlIHVzZWQgbGF0ZXIgdG8gcmVwbGFjZSBwbGFjZWhvbGRlcnMgaW4gc3RyaW5nCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSB0cmFuc2xhdGVkIChhbmQgaW50ZXJwb2xhdGVkKQogICAgICovCiAgICB0cmFuc2xhdGUoa2V5LCBvcHRpb25zKSB7CiAgICAgIHJldHVybiB0aGlzLnRyYW5zbGF0ZUFycmF5KGtleSwgb3B0aW9ucykuam9pbignJyk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHRyYW5zbGF0aW9uIGFuZCByZXR1cm4gdGhlIHRyYW5zbGF0ZWQgYW5kIGludGVycG9sYXRlZCBwYXJ0cyBhcyBhbiBhcnJheS4KICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5CiAgICAgKiBAcGFyYW0ge29iamVjdH0gb3B0aW9ucyB3aXRoIHZhbHVlcyB0aGF0IHdpbGwgYmUgdXNlZCB0byByZXBsYWNlIHBsYWNlaG9sZGVycwogICAgICogQHJldHVybnMge0FycmF5fSBUaGUgdHJhbnNsYXRlZCBhbmQgaW50ZXJwb2xhdGVkIHBhcnRzLCBpbiBvcmRlci4KICAgICAqLwoKCiAgICB0cmFuc2xhdGVBcnJheShrZXksIG9wdGlvbnMpIHsKICAgICAgaWYgKCFoYXNQcm9wZXJ0eSh0aGlzLmxvY2FsZS5zdHJpbmdzLCBrZXkpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBtaXNzaW5nIHN0cmluZzogJHtrZXl9YCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHN0cmluZyA9IHRoaXMubG9jYWxlLnN0cmluZ3Nba2V5XTsKICAgICAgY29uc3QgaGFzUGx1cmFsRm9ybXMgPSB0eXBlb2Ygc3RyaW5nID09PSAnb2JqZWN0JzsKCiAgICAgIGlmIChoYXNQbHVyYWxGb3JtcykgewogICAgICAgIGlmIChvcHRpb25zICYmIHR5cGVvZiBvcHRpb25zLnNtYXJ0X2NvdW50ICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgY29uc3QgcGx1cmFsID0gdGhpcy5sb2NhbGUucGx1cmFsaXplKG9wdGlvbnMuc21hcnRfY291bnQpOwogICAgICAgICAgcmV0dXJuIGludGVycG9sYXRlKHN0cmluZ1twbHVyYWxdLCBvcHRpb25zKTsKICAgICAgICB9CgogICAgICAgIHRocm93IG5ldyBFcnJvcignQXR0ZW1wdGVkIHRvIHVzZSBhIHN0cmluZyB3aXRoIHBsdXJhbCBmb3JtcywgYnV0IG5vIHZhbHVlIHdhcyBnaXZlbiBmb3IgJXtzbWFydF9jb3VudH0nKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGludGVycG9sYXRlKHN0cmluZywgb3B0aW9ucyk7CiAgICB9CgogIH0pOwoKICBmdW5jdGlvbiBfYXBwbHkyKGxvY2FsZSkgewogICAgaWYgKCEobG9jYWxlICE9IG51bGwgJiYgbG9jYWxlLnN0cmluZ3MpKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCBwcmV2TG9jYWxlID0gdGhpcy5sb2NhbGU7CiAgICB0aGlzLmxvY2FsZSA9IHsgLi4ucHJldkxvY2FsZSwKICAgICAgc3RyaW5nczogeyAuLi5wcmV2TG9jYWxlLnN0cmluZ3MsCiAgICAgICAgLi4ubG9jYWxlLnN0cmluZ3MKICAgICAgfQogICAgfTsKICAgIHRoaXMubG9jYWxlLnBsdXJhbGl6ZSA9IGxvY2FsZS5wbHVyYWxpemUgfHwgcHJldkxvY2FsZS5wbHVyYWxpemU7CiAgfQoKICAvKioKICAqIENyZWF0ZSBhbiBldmVudCBlbWl0dGVyIHdpdGggbmFtZXNwYWNlcwogICogQG5hbWUgY3JlYXRlTmFtZXNwYWNlRW1pdHRlcgogICogQGV4YW1wbGUKICAqIHZhciBlbWl0dGVyID0gcmVxdWlyZSgnLi9pbmRleCcpKCkKICAqCiAgKiBlbWl0dGVyLm9uKCcqJywgZnVuY3Rpb24gKCkgewogICogICBjb25zb2xlLmxvZygnYWxsIGV2ZW50cyBlbWl0dGVkJywgdGhpcy5ldmVudCkKICAqIH0pCiAgKgogICogZW1pdHRlci5vbignZXhhbXBsZScsIGZ1bmN0aW9uICgpIHsKICAqICAgY29uc29sZS5sb2coJ2V4YW1wbGUgZXZlbnQgZW1pdHRlZCcpCiAgKiB9KQogICovCiAgdmFyIG5hbWVzcGFjZUVtaXR0ZXIgPSBmdW5jdGlvbiBjcmVhdGVOYW1lc3BhY2VFbWl0dGVyICgpIHsKICAgIHZhciBlbWl0dGVyID0ge307CiAgICB2YXIgX2ZucyA9IGVtaXR0ZXIuX2ZucyA9IHt9OwoKICAgIC8qKgogICAgKiBFbWl0IGFuIGV2ZW50LiBPcHRpb25hbGx5IG5hbWVzcGFjZSB0aGUgZXZlbnQuIEhhbmRsZXJzIGFyZSBmaXJlZCBpbiB0aGUgb3JkZXIgaW4gd2hpY2ggdGhleSB3ZXJlIGFkZGVkIHdpdGggZXhhY3QgbWF0Y2hlcyB0YWtpbmcgcHJlY2VkZW5jZS4gU2VwYXJhdGUgdGhlIG5hbWVzcGFjZSBhbmQgZXZlbnQgd2l0aCBhIGA6YAogICAgKiBAbmFtZSBlbWl0CiAgICAqIEBwYXJhbSB7U3RyaW5nfSBldmVudCDigJMgdGhlIG5hbWUgb2YgdGhlIGV2ZW50LCB3aXRoIG9wdGlvbmFsIG5hbWVzcGFjZQogICAgKiBAcGFyYW0gey4uLip9IGRhdGEg4oCTIHVwIHRvIDYgYXJndW1lbnRzIHRoYXQgYXJlIHBhc3NlZCB0byB0aGUgZXZlbnQgbGlzdGVuZXIKICAgICogQGV4YW1wbGUKICAgICogZW1pdHRlci5lbWl0KCdleGFtcGxlJykKICAgICogZW1pdHRlci5lbWl0KCdkZW1vOnRlc3QnKQogICAgKiBlbWl0dGVyLmVtaXQoJ2RhdGEnLCB7IGV4YW1wbGU6IHRydWV9LCAnYSBzdHJpbmcnLCAxKQogICAgKi8KICAgIGVtaXR0ZXIuZW1pdCA9IGZ1bmN0aW9uIGVtaXQgKGV2ZW50LCBhcmcxLCBhcmcyLCBhcmczLCBhcmc0LCBhcmc1LCBhcmc2KSB7CiAgICAgIHZhciB0b0VtaXQgPSBnZXRMaXN0ZW5lcnMoZXZlbnQpOwoKICAgICAgaWYgKHRvRW1pdC5sZW5ndGgpIHsKICAgICAgICBlbWl0QWxsKGV2ZW50LCB0b0VtaXQsIFthcmcxLCBhcmcyLCBhcmczLCBhcmc0LCBhcmc1LCBhcmc2XSk7CiAgICAgIH0KICAgIH07CgogICAgLyoqCiAgICAqIENyZWF0ZSBlbiBldmVudCBsaXN0ZW5lci4KICAgICogQG5hbWUgb24KICAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50CiAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZuCiAgICAqIEBleGFtcGxlCiAgICAqIGVtaXR0ZXIub24oJ2V4YW1wbGUnLCBmdW5jdGlvbiAoKSB7fSkKICAgICogZW1pdHRlci5vbignZGVtbycsIGZ1bmN0aW9uICgpIHt9KQogICAgKi8KICAgIGVtaXR0ZXIub24gPSBmdW5jdGlvbiBvbiAoZXZlbnQsIGZuKSB7CiAgICAgIGlmICghX2Zuc1tldmVudF0pIHsKICAgICAgICBfZm5zW2V2ZW50XSA9IFtdOwogICAgICB9CgogICAgICBfZm5zW2V2ZW50XS5wdXNoKGZuKTsKICAgIH07CgogICAgLyoqCiAgICAqIENyZWF0ZSBlbiBldmVudCBsaXN0ZW5lciB0aGF0IGZpcmVzIG9uY2UuCiAgICAqIEBuYW1lIG9uY2UKICAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50CiAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZuCiAgICAqIEBleGFtcGxlCiAgICAqIGVtaXR0ZXIub25jZSgnZXhhbXBsZScsIGZ1bmN0aW9uICgpIHt9KQogICAgKiBlbWl0dGVyLm9uY2UoJ2RlbW8nLCBmdW5jdGlvbiAoKSB7fSkKICAgICovCiAgICBlbWl0dGVyLm9uY2UgPSBmdW5jdGlvbiBvbmNlIChldmVudCwgZm4pIHsKICAgICAgZnVuY3Rpb24gb25lICgpIHsKICAgICAgICBmbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIGVtaXR0ZXIub2ZmKGV2ZW50LCBvbmUpOwogICAgICB9CiAgICAgIHRoaXMub24oZXZlbnQsIG9uZSk7CiAgICB9OwoKICAgIC8qKgogICAgKiBTdG9wIGxpc3RlbmluZyB0byBhbiBldmVudC4gU3RvcCBhbGwgbGlzdGVuZXJzIG9uIGFuIGV2ZW50IGJ5IG9ubHkgcGFzc2luZyB0aGUgZXZlbnQgbmFtZS4gU3RvcCBhIHNpbmdsZSBsaXN0ZW5lciBieSBwYXNzaW5nIHRoYXQgZXZlbnQgaGFuZGxlciBhcyBhIGNhbGxiYWNrLgogICAgKiBZb3UgbXVzdCBiZSBleHBsaWNpdCBhYm91dCB3aGF0IHdpbGwgYmUgdW5zdWJzY3JpYmVkOiBgZW1pdHRlci5vZmYoJ2RlbW8nKWAgd2lsbCB1bnN1YnNjcmliZSBhbiBgZW1pdHRlci5vbignZGVtbycpYCBsaXN0ZW5lciwKICAgICogYGVtaXR0ZXIub2ZmKCdkZW1vOmV4YW1wbGUnKWAgd2lsbCB1bnN1YnNjcmliZSBhbiBgZW1pdHRlci5vbignZGVtbzpleGFtcGxlJylgIGxpc3RlbmVyCiAgICAqIEBuYW1lIG9mZgogICAgKiBAcGFyYW0ge1N0cmluZ30gZXZlbnQKICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2ZuXSDigJMgdGhlIHNwZWNpZmljIGhhbmRsZXIKICAgICogQGV4YW1wbGUKICAgICogZW1pdHRlci5vZmYoJ2V4YW1wbGUnKQogICAgKiBlbWl0dGVyLm9mZignZGVtbycsIGZ1bmN0aW9uICgpIHt9KQogICAgKi8KICAgIGVtaXR0ZXIub2ZmID0gZnVuY3Rpb24gb2ZmIChldmVudCwgZm4pIHsKICAgICAgdmFyIGtlZXAgPSBbXTsKCiAgICAgIGlmIChldmVudCAmJiBmbikgewogICAgICAgIHZhciBmbnMgPSB0aGlzLl9mbnNbZXZlbnRdOwogICAgICAgIHZhciBpID0gMDsKICAgICAgICB2YXIgbCA9IGZucyA/IGZucy5sZW5ndGggOiAwOwoKICAgICAgICBmb3IgKGk7IGkgPCBsOyBpKyspIHsKICAgICAgICAgIGlmIChmbnNbaV0gIT09IGZuKSB7CiAgICAgICAgICAgIGtlZXAucHVzaChmbnNbaV0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAga2VlcC5sZW5ndGggPyB0aGlzLl9mbnNbZXZlbnRdID0ga2VlcCA6IGRlbGV0ZSB0aGlzLl9mbnNbZXZlbnRdOwogICAgfTsKCiAgICBmdW5jdGlvbiBnZXRMaXN0ZW5lcnMgKGUpIHsKICAgICAgdmFyIG91dCA9IF9mbnNbZV0gPyBfZm5zW2VdIDogW107CiAgICAgIHZhciBpZHggPSBlLmluZGV4T2YoJzonKTsKICAgICAgdmFyIGFyZ3MgPSAoaWR4ID09PSAtMSkgPyBbZV0gOiBbZS5zdWJzdHJpbmcoMCwgaWR4KSwgZS5zdWJzdHJpbmcoaWR4ICsgMSldOwoKICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhfZm5zKTsKICAgICAgdmFyIGkgPSAwOwogICAgICB2YXIgbCA9IGtleXMubGVuZ3RoOwoKICAgICAgZm9yIChpOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgdmFyIGtleSA9IGtleXNbaV07CiAgICAgICAgaWYgKGtleSA9PT0gJyonKSB7CiAgICAgICAgICBvdXQgPSBvdXQuY29uY2F0KF9mbnNba2V5XSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYXJncy5sZW5ndGggPT09IDIgJiYgYXJnc1swXSA9PT0ga2V5KSB7CiAgICAgICAgICBvdXQgPSBvdXQuY29uY2F0KF9mbnNba2V5XSk7CiAgICAgICAgICBicmVhawogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG91dAogICAgfQoKICAgIGZ1bmN0aW9uIGVtaXRBbGwgKGUsIGZucywgYXJncykgewogICAgICB2YXIgaSA9IDA7CiAgICAgIHZhciBsID0gZm5zLmxlbmd0aDsKCiAgICAgIGZvciAoaTsgaSA8IGw7IGkrKykgewogICAgICAgIGlmICghZm5zW2ldKSBicmVhawogICAgICAgIGZuc1tpXS5ldmVudCA9IGU7CiAgICAgICAgZm5zW2ldLmFwcGx5KGZuc1tpXSwgYXJncyk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZW1pdHRlcgogIH07CgogIC8vIEFkYXB0ZWQgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vRmxldC9wcmV0dGllci1ieXRlcy8KICAvLyBDaGFuZ2luZyAxMDAwIGJ5dGVzIHRvIDEwMjQsIHNvIHdlIGNhbiBrZWVwIHVwcGVyY2FzZSBLQiB2cyBrQgogIC8vIElTQyBMaWNlbnNlIChjKSBEYW4gRmxldHRyZSBodHRwczovL2dpdGh1Yi5jb20vRmxldC9wcmV0dGllci1ieXRlcy9ibG9iL21hc3Rlci9MSUNFTlNFCiAgdmFyIHByZXR0aWVyQnl0ZXMgPSBmdW5jdGlvbiBwcmV0dGllckJ5dGVzIChudW0pIHsKICAgIGlmICh0eXBlb2YgbnVtICE9PSAnbnVtYmVyJyB8fCBpc05hTihudW0pKSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0V4cGVjdGVkIGEgbnVtYmVyLCBnb3QgJyArIHR5cGVvZiBudW0pCiAgICB9CgogICAgdmFyIG5lZyA9IG51bSA8IDA7CiAgICB2YXIgdW5pdHMgPSBbJ0InLCAnS0InLCAnTUInLCAnR0InLCAnVEInLCAnUEInLCAnRUInLCAnWkInLCAnWUInXTsKCiAgICBpZiAobmVnKSB7CiAgICAgIG51bSA9IC1udW07CiAgICB9CgogICAgaWYgKG51bSA8IDEpIHsKICAgICAgcmV0dXJuIChuZWcgPyAnLScgOiAnJykgKyBudW0gKyAnIEInCiAgICB9CgogICAgdmFyIGV4cG9uZW50ID0gTWF0aC5taW4oTWF0aC5mbG9vcihNYXRoLmxvZyhudW0pIC8gTWF0aC5sb2coMTAyNCkpLCB1bml0cy5sZW5ndGggLSAxKTsKICAgIG51bSA9IE51bWJlcihudW0gLyBNYXRoLnBvdygxMDI0LCBleHBvbmVudCkpOwogICAgdmFyIHVuaXQgPSB1bml0c1tleHBvbmVudF07CgogICAgaWYgKG51bSA+PSAxMCB8fCBudW0gJSAxID09PSAwKSB7CiAgICAgIC8vIERvIG5vdCBzaG93IGRlY2ltYWxzIHdoZW4gdGhlIG51bWJlciBpcyB0d28tZGlnaXQsIG9yIGlmIHRoZSBudW1iZXIgaGFzIG5vCiAgICAgIC8vIGRlY2ltYWwgY29tcG9uZW50LgogICAgICByZXR1cm4gKG5lZyA/ICctJyA6ICcnKSArIG51bS50b0ZpeGVkKDApICsgJyAnICsgdW5pdAogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIChuZWcgPyAnLScgOiAnJykgKyBudW0udG9GaXhlZCgxKSArICcgJyArIHVuaXQKICAgIH0KICB9OwoKICAvKiBqc2hpbnQgbm9kZTogdHJ1ZSAqLwoKICAvKioKICAgICMgd2lsZGNhcmQKCiAgICBWZXJ5IHNpbXBsZSB3aWxkY2FyZCBtYXRjaGluZywgd2hpY2ggaXMgZGVzaWduZWQgdG8gcHJvdmlkZSB0aGUgc2FtZQogICAgZnVuY3Rpb25hbGl0eSB0aGF0IGlzIGZvdW5kIGluIHRoZQogICAgW2V2ZV0oaHR0cHM6Ly9naXRodWIuY29tL2Fkb2JlLXdlYnBsYXRmb3JtL2V2ZSkgZXZlbnRpbmcgbGlicmFyeS4KCiAgICAjIyBVc2FnZQoKICAgIEl0IHdvcmtzIHdpdGggc3RyaW5nczoKCiAgICA8PDwgZXhhbXBsZXMvc3RyaW5ncy5qcwoKICAgIEFycmF5czoKCiAgICA8PDwgZXhhbXBsZXMvYXJyYXlzLmpzCgogICAgT2JqZWN0cyAobWF0Y2hpbmcgYWdhaW5zdCBrZXlzKToKCiAgICA8PDwgZXhhbXBsZXMvb2JqZWN0cy5qcwoKICAgIFdoaWxlIHRoZSBsaWJyYXJ5IHdvcmtzIGluIE5vZGUsIGlmIHlvdSBhcmUgYXJlIGxvb2tpbmcgZm9yIGZpbGUtYmFzZWQKICAgIHdpbGRjYXJkIG1hdGNoaW5nIHRoZW4geW91IHNob3VsZCBoYXZlIGEgbG9vayBhdDoKCiAgICA8aHR0cHM6Ly9naXRodWIuY29tL2lzYWFjcy9ub2RlLWdsb2I+CiAgKiovCgogIGZ1bmN0aW9uIFdpbGRjYXJkTWF0Y2hlcih0ZXh0LCBzZXBhcmF0b3IpIHsKICAgIHRoaXMudGV4dCA9IHRleHQgPSB0ZXh0IHx8ICcnOwogICAgdGhpcy5oYXNXaWxkID0gfnRleHQuaW5kZXhPZignKicpOwogICAgdGhpcy5zZXBhcmF0b3IgPSBzZXBhcmF0b3I7CiAgICB0aGlzLnBhcnRzID0gdGV4dC5zcGxpdChzZXBhcmF0b3IpOwogIH0KCiAgV2lsZGNhcmRNYXRjaGVyLnByb3RvdHlwZS5tYXRjaCA9IGZ1bmN0aW9uKGlucHV0KSB7CiAgICB2YXIgbWF0Y2hlcyA9IHRydWU7CiAgICB2YXIgcGFydHMgPSB0aGlzLnBhcnRzOwogICAgdmFyIGlpOwogICAgdmFyIHBhcnRzQ291bnQgPSBwYXJ0cy5sZW5ndGg7CiAgICB2YXIgdGVzdFBhcnRzOwoKICAgIGlmICh0eXBlb2YgaW5wdXQgPT0gJ3N0cmluZycgfHwgaW5wdXQgaW5zdGFuY2VvZiBTdHJpbmcpIHsKICAgICAgaWYgKCF0aGlzLmhhc1dpbGQgJiYgdGhpcy50ZXh0ICE9IGlucHV0KSB7CiAgICAgICAgbWF0Y2hlcyA9IGZhbHNlOwogICAgICB9IGVsc2UgewogICAgICAgIHRlc3RQYXJ0cyA9IChpbnB1dCB8fCAnJykuc3BsaXQodGhpcy5zZXBhcmF0b3IpOwogICAgICAgIGZvciAoaWkgPSAwOyBtYXRjaGVzICYmIGlpIDwgcGFydHNDb3VudDsgaWkrKykgewogICAgICAgICAgaWYgKHBhcnRzW2lpXSA9PT0gJyonKSAgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0gZWxzZSBpZiAoaWkgPCB0ZXN0UGFydHMubGVuZ3RoKSB7CiAgICAgICAgICAgIG1hdGNoZXMgPSBwYXJ0c1tpaV0gPT09IHRlc3RQYXJ0c1tpaV07CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtYXRjaGVzID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBJZiBtYXRjaGVzLCB0aGVuIHJldHVybiB0aGUgY29tcG9uZW50IHBhcnRzCiAgICAgICAgbWF0Y2hlcyA9IG1hdGNoZXMgJiYgdGVzdFBhcnRzOwogICAgICB9CiAgICB9CiAgICBlbHNlIGlmICh0eXBlb2YgaW5wdXQuc3BsaWNlID09ICdmdW5jdGlvbicpIHsKICAgICAgbWF0Y2hlcyA9IFtdOwoKICAgICAgZm9yIChpaSA9IGlucHV0Lmxlbmd0aDsgaWktLTsgKSB7CiAgICAgICAgaWYgKHRoaXMubWF0Y2goaW5wdXRbaWldKSkgewogICAgICAgICAgbWF0Y2hlc1ttYXRjaGVzLmxlbmd0aF0gPSBpbnB1dFtpaV07CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBlbHNlIGlmICh0eXBlb2YgaW5wdXQgPT0gJ29iamVjdCcpIHsKICAgICAgbWF0Y2hlcyA9IHt9OwoKICAgICAgZm9yICh2YXIga2V5IGluIGlucHV0KSB7CiAgICAgICAgaWYgKHRoaXMubWF0Y2goa2V5KSkgewogICAgICAgICAgbWF0Y2hlc1trZXldID0gaW5wdXRba2V5XTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gbWF0Y2hlczsKICB9OwoKICB2YXIgd2lsZGNhcmQgPSBmdW5jdGlvbih0ZXh0LCB0ZXN0LCBzZXBhcmF0b3IpIHsKICAgIHZhciBtYXRjaGVyID0gbmV3IFdpbGRjYXJkTWF0Y2hlcih0ZXh0LCBzZXBhcmF0b3IgfHwgL1tcL1wuXS8pOwogICAgaWYgKHR5cGVvZiB0ZXN0ICE9ICd1bmRlZmluZWQnKSB7CiAgICAgIHJldHVybiBtYXRjaGVyLm1hdGNoKHRlc3QpOwogICAgfQoKICAgIHJldHVybiBtYXRjaGVyOwogIH07CgogIHZhciByZU1pbWVQYXJ0U3BsaXQgPSAvW1wvXCtcLl0vOwoKICAvKioKICAgICMgbWltZS1tYXRjaAoKICAgIEEgc2ltcGxlIGZ1bmN0aW9uIHRvIGNoZWNrZXIgd2hldGhlciBhIHRhcmdldCBtaW1lIHR5cGUgbWF0Y2hlcyBhIG1pbWUtdHlwZQogICAgcGF0dGVybiAoZS5nLiBpbWFnZS9qcGVnIG1hdGNoZXMgaW1hZ2UvanBlZyBPUiBpbWFnZS8qKS4KCiAgICAjIyBFeGFtcGxlIFVzYWdlCgogICAgPDw8IGV4YW1wbGUuanMKCiAgKiovCiAgdmFyIG1pbWVNYXRjaCA9IGZ1bmN0aW9uKHRhcmdldCwgcGF0dGVybikgewogICAgZnVuY3Rpb24gdGVzdChwYXR0ZXJuKSB7CiAgICAgIHZhciByZXN1bHQgPSB3aWxkY2FyZChwYXR0ZXJuLCB0YXJnZXQsIHJlTWltZVBhcnRTcGxpdCk7CgogICAgICAvLyBlbnN1cmUgdGhhdCB3ZSBoYXZlIGEgdmFsaWQgbWltZSB0eXBlIChzaG91bGQgaGF2ZSB0d28gcGFydHMpCiAgICAgIHJldHVybiByZXN1bHQgJiYgcmVzdWx0Lmxlbmd0aCA+PSAyOwogICAgfQoKICAgIHJldHVybiBwYXR0ZXJuID8gdGVzdChwYXR0ZXJuLnNwbGl0KCc7JylbMF0pIDogdGVzdDsKICB9OwoKICBmdW5jdGlvbiBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkNyhyZWNlaXZlciwgcHJpdmF0ZUtleSkgeyBpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChyZWNlaXZlciwgcHJpdmF0ZUtleSkpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiYXR0ZW1wdGVkIHRvIHVzZSBwcml2YXRlIGZpZWxkIG9uIG5vbi1pbnN0YW5jZSIpOyB9IHJldHVybiByZWNlaXZlcjsgfQoKICB2YXIgaWQkNyA9IDA7CgogIGZ1bmN0aW9uIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlS2V5JDcobmFtZSkgeyByZXR1cm4gIl9fcHJpdmF0ZV8iICsgaWQkNysrICsgIl8iICsgbmFtZTsgfQoKICB2YXIgX3B1Ymxpc2ggPSAvKiNfX1BVUkVfXyovX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VLZXkkNygicHVibGlzaCIpOwoKICAvKioKICAgKiBEZWZhdWx0IHN0b3JlIHRoYXQga2VlcHMgc3RhdGUgaW4gYSBzaW1wbGUgb2JqZWN0LgogICAqLwogIGNsYXNzIERlZmF1bHRTdG9yZSB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIF9wdWJsaXNoLCB7CiAgICAgICAgdmFsdWU6IF9wdWJsaXNoMgogICAgICB9KTsKICAgICAgdGhpcy5zdGF0ZSA9IHt9OwogICAgICB0aGlzLmNhbGxiYWNrcyA9IFtdOwogICAgfQoKICAgIGdldFN0YXRlKCkgewogICAgICByZXR1cm4gdGhpcy5zdGF0ZTsKICAgIH0KCiAgICBzZXRTdGF0ZShwYXRjaCkgewogICAgICBjb25zdCBwcmV2U3RhdGUgPSB7IC4uLnRoaXMuc3RhdGUKICAgICAgfTsKICAgICAgY29uc3QgbmV4dFN0YXRlID0geyAuLi50aGlzLnN0YXRlLAogICAgICAgIC4uLnBhdGNoCiAgICAgIH07CiAgICAgIHRoaXMuc3RhdGUgPSBuZXh0U3RhdGU7CgogICAgICBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkNyh0aGlzLCBfcHVibGlzaClbX3B1Ymxpc2hdKHByZXZTdGF0ZSwgbmV4dFN0YXRlLCBwYXRjaCk7CiAgICB9CgogICAgc3Vic2NyaWJlKGxpc3RlbmVyKSB7CiAgICAgIHRoaXMuY2FsbGJhY2tzLnB1c2gobGlzdGVuZXIpOwogICAgICByZXR1cm4gKCkgPT4gewogICAgICAgIC8vIFJlbW92ZSB0aGUgbGlzdGVuZXIuCiAgICAgICAgdGhpcy5jYWxsYmFja3Muc3BsaWNlKHRoaXMuY2FsbGJhY2tzLmluZGV4T2YobGlzdGVuZXIpLCAxKTsKICAgICAgfTsKICAgIH0KCiAgfQoKICBmdW5jdGlvbiBfcHVibGlzaDIoKSB7CiAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsKICAgICAgYXJnc1tfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTsKICAgIH0KCiAgICB0aGlzLmNhbGxiYWNrcy5mb3JFYWNoKGxpc3RlbmVyID0+IHsKICAgICAgbGlzdGVuZXIoLi4uYXJncyk7CiAgICB9KTsKICB9CgogIERlZmF1bHRTdG9yZS5WRVJTSU9OID0gIjIuMC4zIjsKCiAgdmFyIGxpYiQzID0gZnVuY3Rpb24gZGVmYXVsdFN0b3JlKCkgewogICAgcmV0dXJuIG5ldyBEZWZhdWx0U3RvcmUoKTsKICB9OwoKICAvKioKICAgKiBUYWtlcyBhIGZ1bGwgZmlsZW5hbWUgc3RyaW5nIGFuZCByZXR1cm5zIGFuIG9iamVjdCB7bmFtZSwgZXh0ZW5zaW9ufQogICAqCiAgICogQHBhcmFtIHtzdHJpbmd9IGZ1bGxGaWxlTmFtZQogICAqIEByZXR1cm5zIHtvYmplY3R9IHtuYW1lLCBleHRlbnNpb259CiAgICovCiAgdmFyIGdldEZpbGVOYW1lQW5kRXh0ZW5zaW9uID0gZnVuY3Rpb24gZ2V0RmlsZU5hbWVBbmRFeHRlbnNpb24oZnVsbEZpbGVOYW1lKSB7CiAgICBjb25zdCBsYXN0RG90ID0gZnVsbEZpbGVOYW1lLmxhc3RJbmRleE9mKCcuJyk7IC8vIHRoZXNlIGNvdW50IGFzIG5vIGV4dGVuc2lvbjogIm5vLWRvdCIsICJ0cmFpbGluZy1kb3QuIgoKICAgIGlmIChsYXN0RG90ID09PSAtMSB8fCBsYXN0RG90ID09PSBmdWxsRmlsZU5hbWUubGVuZ3RoIC0gMSkgewogICAgICByZXR1cm4gewogICAgICAgIG5hbWU6IGZ1bGxGaWxlTmFtZSwKICAgICAgICBleHRlbnNpb246IHVuZGVmaW5lZAogICAgICB9OwogICAgfQoKICAgIHJldHVybiB7CiAgICAgIG5hbWU6IGZ1bGxGaWxlTmFtZS5zbGljZSgwLCBsYXN0RG90KSwKICAgICAgZXh0ZW5zaW9uOiBmdWxsRmlsZU5hbWUuc2xpY2UobGFzdERvdCArIDEpCiAgICB9OwogIH07CgogIC8vIF9fX1doeSBub3QgYWRkIHRoZSBtaW1lLXR5cGVzIHBhY2thZ2U/CiAgLy8gICAgSXQncyAxOS43a0IgZ3ppcHBlZCwgYW5kIHdlIG9ubHkgbmVlZCBtaW1lIHR5cGVzIGZvciB3ZWxsLWtub3duIGV4dGVuc2lvbnMgKGZvciBmaWxlIHByZXZpZXdzKS4KICAvLyBfX19XaGVyZSB0byB0YWtlIG5ldyBleHRlbnNpb25zIGZyb20/CiAgLy8gICAgaHR0cHM6Ly9naXRodWIuY29tL2pzaHR0cC9taW1lLWRiL2Jsb2IvbWFzdGVyL2RiLmpzb24KICB2YXIgbWltZVR5cGVzID0gewogICAgbWQ6ICd0ZXh0L21hcmtkb3duJywKICAgIG1hcmtkb3duOiAndGV4dC9tYXJrZG93bicsCiAgICBtcDQ6ICd2aWRlby9tcDQnLAogICAgbXAzOiAnYXVkaW8vbXAzJywKICAgIHN2ZzogJ2ltYWdlL3N2Zyt4bWwnLAogICAganBnOiAnaW1hZ2UvanBlZycsCiAgICBwbmc6ICdpbWFnZS9wbmcnLAogICAgZ2lmOiAnaW1hZ2UvZ2lmJywKICAgIGhlaWM6ICdpbWFnZS9oZWljJywKICAgIGhlaWY6ICdpbWFnZS9oZWlmJywKICAgIHlhbWw6ICd0ZXh0L3lhbWwnLAogICAgeW1sOiAndGV4dC95YW1sJywKICAgIGNzdjogJ3RleHQvY3N2JywKICAgIHRzdjogJ3RleHQvdGFiLXNlcGFyYXRlZC12YWx1ZXMnLAogICAgdGFiOiAndGV4dC90YWItc2VwYXJhdGVkLXZhbHVlcycsCiAgICBhdmk6ICd2aWRlby94LW1zdmlkZW8nLAogICAgbWtzOiAndmlkZW8veC1tYXRyb3NrYScsCiAgICBta3Y6ICd2aWRlby94LW1hdHJvc2thJywKICAgIG1vdjogJ3ZpZGVvL3F1aWNrdGltZScsCiAgICBkb2M6ICdhcHBsaWNhdGlvbi9tc3dvcmQnLAogICAgZG9jbTogJ2FwcGxpY2F0aW9uL3ZuZC5tcy13b3JkLmRvY3VtZW50Lm1hY3JvZW5hYmxlZC4xMicsCiAgICBkb2N4OiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LndvcmRwcm9jZXNzaW5nbWwuZG9jdW1lbnQnLAogICAgZG90OiAnYXBwbGljYXRpb24vbXN3b3JkJywKICAgIGRvdG06ICdhcHBsaWNhdGlvbi92bmQubXMtd29yZC50ZW1wbGF0ZS5tYWNyb2VuYWJsZWQuMTInLAogICAgZG90eDogJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC53b3JkcHJvY2Vzc2luZ21sLnRlbXBsYXRlJywKICAgIHhsYTogJ2FwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbCcsCiAgICB4bGFtOiAnYXBwbGljYXRpb24vdm5kLm1zLWV4Y2VsLmFkZGluLm1hY3JvZW5hYmxlZC4xMicsCiAgICB4bGM6ICdhcHBsaWNhdGlvbi92bmQubXMtZXhjZWwnLAogICAgeGxmOiAnYXBwbGljYXRpb24veC14bGlmZit4bWwnLAogICAgeGxtOiAnYXBwbGljYXRpb24vdm5kLm1zLWV4Y2VsJywKICAgIHhsczogJ2FwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbCcsCiAgICB4bHNiOiAnYXBwbGljYXRpb24vdm5kLm1zLWV4Y2VsLnNoZWV0LmJpbmFyeS5tYWNyb2VuYWJsZWQuMTInLAogICAgeGxzbTogJ2FwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbC5zaGVldC5tYWNyb2VuYWJsZWQuMTInLAogICAgeGxzeDogJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5zcHJlYWRzaGVldG1sLnNoZWV0JywKICAgIHhsdDogJ2FwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbCcsCiAgICB4bHRtOiAnYXBwbGljYXRpb24vdm5kLm1zLWV4Y2VsLnRlbXBsYXRlLm1hY3JvZW5hYmxlZC4xMicsCiAgICB4bHR4OiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnNwcmVhZHNoZWV0bWwudGVtcGxhdGUnLAogICAgeGx3OiAnYXBwbGljYXRpb24vdm5kLm1zLWV4Y2VsJywKICAgIHR4dDogJ3RleHQvcGxhaW4nLAogICAgdGV4dDogJ3RleHQvcGxhaW4nLAogICAgY29uZjogJ3RleHQvcGxhaW4nLAogICAgbG9nOiAndGV4dC9wbGFpbicsCiAgICBwZGY6ICdhcHBsaWNhdGlvbi9wZGYnLAogICAgemlwOiAnYXBwbGljYXRpb24vemlwJywKICAgICc3eic6ICdhcHBsaWNhdGlvbi94LTd6LWNvbXByZXNzZWQnLAogICAgcmFyOiAnYXBwbGljYXRpb24veC1yYXItY29tcHJlc3NlZCcsCiAgICB0YXI6ICdhcHBsaWNhdGlvbi94LXRhcicsCiAgICBnejogJ2FwcGxpY2F0aW9uL2d6aXAnLAogICAgZG1nOiAnYXBwbGljYXRpb24veC1hcHBsZS1kaXNraW1hZ2UnCiAgfTsKCiAgdmFyIGdldEZpbGVUeXBlID0gZnVuY3Rpb24gZ2V0RmlsZVR5cGUoZmlsZSkgewogICAgdmFyIF9nZXRGaWxlTmFtZUFuZEV4dGVuczsKCiAgICBpZiAoZmlsZS50eXBlKSByZXR1cm4gZmlsZS50eXBlOwogICAgY29uc3QgZmlsZUV4dGVuc2lvbiA9IGZpbGUubmFtZSA/IChfZ2V0RmlsZU5hbWVBbmRFeHRlbnMgPSBnZXRGaWxlTmFtZUFuZEV4dGVuc2lvbihmaWxlLm5hbWUpLmV4dGVuc2lvbikgPT0gbnVsbCA/IHZvaWQgMCA6IF9nZXRGaWxlTmFtZUFuZEV4dGVucy50b0xvd2VyQ2FzZSgpIDogbnVsbDsKCiAgICBpZiAoZmlsZUV4dGVuc2lvbiAmJiBmaWxlRXh0ZW5zaW9uIGluIG1pbWVUeXBlcykgewogICAgICAvLyBlbHNlLCBzZWUgaWYgd2UgY2FuIG1hcCBleHRlbnNpb24gdG8gYSBtaW1lIHR5cGUKICAgICAgcmV0dXJuIG1pbWVUeXBlc1tmaWxlRXh0ZW5zaW9uXTsKICAgIH0gLy8gaWYgYWxsIGZhaWxzLCBmYWxsIGJhY2sgdG8gYSBnZW5lcmljIGJ5dGUgc3RyZWFtIHR5cGUKCgogICAgcmV0dXJuICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nOwogIH07CgogIGZ1bmN0aW9uIGVuY29kZUNoYXJhY3RlcihjaGFyYWN0ZXIpIHsKICAgIHJldHVybiBjaGFyYWN0ZXIuY2hhckNvZGVBdCgwKS50b1N0cmluZygzMik7CiAgfQoKICBmdW5jdGlvbiBlbmNvZGVGaWxlbmFtZShuYW1lKSB7CiAgICBsZXQgc3VmZml4ID0gJyc7CiAgICByZXR1cm4gbmFtZS5yZXBsYWNlKC9bXkEtWjAtOV0vaWcsIGNoYXJhY3RlciA9PiB7CiAgICAgIHN1ZmZpeCArPSBgLSR7ZW5jb2RlQ2hhcmFjdGVyKGNoYXJhY3Rlcil9YDsKICAgICAgcmV0dXJuICcvJzsKICAgIH0pICsgc3VmZml4OwogIH0KICAvKioKICAgKiBUYWtlcyBhIGZpbGUgb2JqZWN0IGFuZCB0dXJucyBpdCBpbnRvIGZpbGVJRCwgYnkgY29udmVydGluZyBmaWxlLm5hbWUgdG8gbG93ZXJjYXNlLAogICAqIHJlbW92aW5nIGV4dHJhIGNoYXJhY3RlcnMgYW5kIGFkZGluZyB0eXBlLCBzaXplIGFuZCBsYXN0TW9kaWZpZWQKICAgKgogICAqIEBwYXJhbSB7b2JqZWN0fSBmaWxlCiAgICogQHJldHVybnMge3N0cmluZ30gdGhlIGZpbGVJRAogICAqLwoKCiAgdmFyIGdlbmVyYXRlRmlsZUlEID0gZnVuY3Rpb24gZ2VuZXJhdGVGaWxlSUQoZmlsZSkgewogICAgLy8gSXQncyB0ZW1wdGluZyB0byBkbyBgW2l0ZW1zXS5maWx0ZXIoQm9vbGVhbikuam9pbignLScpYCBoZXJlLCBidXQgdGhhdAogICAgLy8gaXMgc2xvd2VyISBzaW1wbGUgc3RyaW5nIGNvbmNhdGVuYXRpb24gaXMgZmFzdAogICAgbGV0IGlkID0gJ3VwcHknOwoKICAgIGlmICh0eXBlb2YgZmlsZS5uYW1lID09PSAnc3RyaW5nJykgewogICAgICBpZCArPSBgLSR7ZW5jb2RlRmlsZW5hbWUoZmlsZS5uYW1lLnRvTG93ZXJDYXNlKCkpfWA7CiAgICB9CgogICAgaWYgKGZpbGUudHlwZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGlkICs9IGAtJHtmaWxlLnR5cGV9YDsKICAgIH0KCiAgICBpZiAoZmlsZS5tZXRhICYmIHR5cGVvZiBmaWxlLm1ldGEucmVsYXRpdmVQYXRoID09PSAnc3RyaW5nJykgewogICAgICBpZCArPSBgLSR7ZW5jb2RlRmlsZW5hbWUoZmlsZS5tZXRhLnJlbGF0aXZlUGF0aC50b0xvd2VyQ2FzZSgpKX1gOwogICAgfQoKICAgIGlmIChmaWxlLmRhdGEuc2l6ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGlkICs9IGAtJHtmaWxlLmRhdGEuc2l6ZX1gOwogICAgfQoKICAgIGlmIChmaWxlLmRhdGEubGFzdE1vZGlmaWVkICE9PSB1bmRlZmluZWQpIHsKICAgICAgaWQgKz0gYC0ke2ZpbGUuZGF0YS5sYXN0TW9kaWZpZWR9YDsKICAgIH0KCiAgICByZXR1cm4gaWQ7CiAgfTsKCiAgLy8gRWRnZSAxNS54IGRvZXMgbm90IGZpcmUgJ3Byb2dyZXNzJyBldmVudHMgb24gdXBsb2Fkcy4KICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3RyYW5zbG9hZGl0L3VwcHkvaXNzdWVzLzk0NQogIC8vIEFuZCBodHRwczovL2RldmVsb3Blci5taWNyb3NvZnQuY29tL2VuLXVzL21pY3Jvc29mdC1lZGdlL3BsYXRmb3JtL2lzc3Vlcy8xMjIyNDUxMC8KICB2YXIgc3VwcG9ydHNVcGxvYWRQcm9ncmVzcyA9IGZ1bmN0aW9uIHN1cHBvcnRzVXBsb2FkUHJvZ3Jlc3ModXNlckFnZW50KSB7CiAgICAvLyBBbGxvdyBwYXNzaW5nIGluIHVzZXJBZ2VudCBmb3IgdGVzdHMKICAgIGlmICh1c2VyQWdlbnQgPT0gbnVsbCkgewogICAgICB1c2VyQWdlbnQgPSB0eXBlb2YgbmF2aWdhdG9yICE9PSAndW5kZWZpbmVkJyA/IG5hdmlnYXRvci51c2VyQWdlbnQgOiBudWxsOwogICAgfSAvLyBBc3N1bWUgaXQgd29ya3MgYmVjYXVzZSBiYXNpY2FsbHkgZXZlcnl0aGluZyBzdXBwb3J0cyBwcm9ncmVzcyBldmVudHMuCgoKICAgIGlmICghdXNlckFnZW50KSByZXR1cm4gdHJ1ZTsKICAgIGNvbnN0IG0gPSAvRWRnZVwvKFxkK1wuXGQrKS8uZXhlYyh1c2VyQWdlbnQpOwogICAgaWYgKCFtKSByZXR1cm4gdHJ1ZTsKICAgIGNvbnN0IGVkZ2VWZXJzaW9uID0gbVsxXTsKICAgIGxldCBbbWFqb3IsIG1pbm9yXSA9IGVkZ2VWZXJzaW9uLnNwbGl0KCcuJyk7CiAgICBtYWpvciA9IHBhcnNlSW50KG1ham9yLCAxMCk7CiAgICBtaW5vciA9IHBhcnNlSW50KG1pbm9yLCAxMCk7IC8vIFdvcmtlZCBiZWZvcmU6CiAgICAvLyBFZGdlIDQwLjE1MDYzLjAuMAogICAgLy8gTWljcm9zb2Z0IEVkZ2VIVE1MIDE1LjE1MDYzCgogICAgaWYgKG1ham9yIDwgMTUgfHwgbWFqb3IgPT09IDE1ICYmIG1pbm9yIDwgMTUwNjMpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9IC8vIEZpeGVkIGluOgogICAgLy8gTWljcm9zb2Z0IEVkZ2VIVE1MIDE4LjE4MjE4CgoKICAgIGlmIChtYWpvciA+IDE4IHx8IG1ham9yID09PSAxOCAmJiBtaW5vciA+PSAxODIxOCkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0gLy8gb3RoZXIgdmVyc2lvbnMgZG9uJ3Qgd29yay4KCgogICAgcmV0dXJuIGZhbHNlOwogIH07CgogIHZhciBnZXRGaWxlTmFtZSA9IGZ1bmN0aW9uIGdldEZpbGVOYW1lKGZpbGVUeXBlLCBmaWxlRGVzY3JpcHRvcikgewogICAgaWYgKGZpbGVEZXNjcmlwdG9yLm5hbWUpIHsKICAgICAgcmV0dXJuIGZpbGVEZXNjcmlwdG9yLm5hbWU7CiAgICB9CgogICAgaWYgKGZpbGVUeXBlLnNwbGl0KCcvJylbMF0gPT09ICdpbWFnZScpIHsKICAgICAgcmV0dXJuIGAke2ZpbGVUeXBlLnNwbGl0KCcvJylbMF19LiR7ZmlsZVR5cGUuc3BsaXQoJy8nKVsxXX1gOwogICAgfQoKICAgIHJldHVybiAnbm9uYW1lJzsKICB9OwoKICAvKioKICAgKiBBZGRzIHplcm8gdG8gc3RyaW5ncyBzaG9ydGVyIHRoYW4gdHdvIGNoYXJhY3RlcnMuCiAgICoKICAgKiBAcGFyYW0ge251bWJlcn0gbnVtYmVyCiAgICogQHJldHVybnMge3N0cmluZ30KICAgKi8KICBmdW5jdGlvbiBwYWQobnVtYmVyKSB7CiAgICByZXR1cm4gbnVtYmVyIDwgMTAgPyBgMCR7bnVtYmVyfWAgOiBudW1iZXIudG9TdHJpbmcoKTsKICB9CiAgLyoqCiAgICogUmV0dXJucyBhIHRpbWVzdGFtcCBpbiB0aGUgZm9ybWF0IG9mIGBob3VyczptaW51dGVzOnNlY29uZHNgCiAgICovCgoKICB2YXIgZ2V0VGltZVN0YW1wID0gZnVuY3Rpb24gZ2V0VGltZVN0YW1wKCkgewogICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKCk7CiAgICBjb25zdCBob3VycyA9IHBhZChkYXRlLmdldEhvdXJzKCkpOwogICAgY29uc3QgbWludXRlcyA9IHBhZChkYXRlLmdldE1pbnV0ZXMoKSk7CiAgICBjb25zdCBzZWNvbmRzID0gcGFkKGRhdGUuZ2V0U2Vjb25kcygpKTsKICAgIHJldHVybiBgJHtob3Vyc306JHttaW51dGVzfToke3NlY29uZHN9YDsKICB9OwoKICAvKiBlc2xpbnQtZGlzYWJsZSBuby1jb25zb2xlICovCiAgIC8vIFN3YWxsb3cgYWxsIGxvZ3MsIGV4Y2VwdCBlcnJvcnMuCiAgLy8gZGVmYXVsdCBpZiBsb2dnZXIgaXMgbm90IHNldCBvciBkZWJ1ZzogZmFsc2UKCgogIGNvbnN0IGp1c3RFcnJvcnNMb2dnZXIkMSA9IHsKICAgIGRlYnVnOiAoKSA9PiB7fSwKICAgIHdhcm46ICgpID0+IHt9LAogICAgZXJyb3I6IGZ1bmN0aW9uICgpIHsKICAgICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7CiAgICAgICAgYXJnc1tfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTsKICAgICAgfQoKICAgICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IoYFtVcHB5XSBbJHtnZXRUaW1lU3RhbXAoKX1dYCwgLi4uYXJncyk7CiAgICB9CiAgfTsgLy8gUHJpbnQgbG9ncyB0byBjb25zb2xlIHdpdGggbmFtZXNwYWNlICsgdGltZXN0YW1wLAogIC8vIHNldCBieSBsb2dnZXI6IFVwcHkuZGVidWdMb2dnZXIgb3IgZGVidWc6IHRydWUKCiAgY29uc3QgZGVidWdMb2dnZXIkMiA9IHsKICAgIGRlYnVnOiBmdW5jdGlvbiAoKSB7CiAgICAgIGZvciAodmFyIF9sZW4yID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuMiksIF9rZXkyID0gMDsgX2tleTIgPCBfbGVuMjsgX2tleTIrKykgewogICAgICAgIGFyZ3NbX2tleTJdID0gYXJndW1lbnRzW19rZXkyXTsKICAgICAgfQoKICAgICAgcmV0dXJuIGNvbnNvbGUuZGVidWcoYFtVcHB5XSBbJHtnZXRUaW1lU3RhbXAoKX1dYCwgLi4uYXJncyk7CiAgICB9LAogICAgd2FybjogZnVuY3Rpb24gKCkgewogICAgICBmb3IgKHZhciBfbGVuMyA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbjMpLCBfa2V5MyA9IDA7IF9rZXkzIDwgX2xlbjM7IF9rZXkzKyspIHsKICAgICAgICBhcmdzW19rZXkzXSA9IGFyZ3VtZW50c1tfa2V5M107CiAgICAgIH0KCiAgICAgIHJldHVybiBjb25zb2xlLndhcm4oYFtVcHB5XSBbJHtnZXRUaW1lU3RhbXAoKX1dYCwgLi4uYXJncyk7CiAgICB9LAogICAgZXJyb3I6IGZ1bmN0aW9uICgpIHsKICAgICAgZm9yICh2YXIgX2xlbjQgPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW40KSwgX2tleTQgPSAwOyBfa2V5NCA8IF9sZW40OyBfa2V5NCsrKSB7CiAgICAgICAgYXJnc1tfa2V5NF0gPSBhcmd1bWVudHNbX2tleTRdOwogICAgICB9CgogICAgICByZXR1cm4gY29uc29sZS5lcnJvcihgW1VwcHldIFske2dldFRpbWVTdGFtcCgpfV1gLCAuLi5hcmdzKTsKICAgIH0KICB9OwogIHZhciBsb2dnZXJzID0gewogICAganVzdEVycm9yc0xvZ2dlcjoganVzdEVycm9yc0xvZ2dlciQxLAogICAgZGVidWdMb2dnZXI6IGRlYnVnTG9nZ2VyJDIKICB9OwoKICB2YXIgbG9jYWxlJDEgPSB7CiAgICBzdHJpbmdzOiB7CiAgICAgIGFkZEJ1bGtGaWxlc0ZhaWxlZDogewogICAgICAgIDA6ICdGYWlsZWQgdG8gYWRkICV7c21hcnRfY291bnR9IGZpbGUgZHVlIHRvIGFuIGludGVybmFsIGVycm9yJywKICAgICAgICAxOiAnRmFpbGVkIHRvIGFkZCAle3NtYXJ0X2NvdW50fSBmaWxlcyBkdWUgdG8gaW50ZXJuYWwgZXJyb3JzJwogICAgICB9LAogICAgICB5b3VDYW5Pbmx5VXBsb2FkWDogewogICAgICAgIDA6ICdZb3UgY2FuIG9ubHkgdXBsb2FkICV7c21hcnRfY291bnR9IGZpbGUnLAogICAgICAgIDE6ICdZb3UgY2FuIG9ubHkgdXBsb2FkICV7c21hcnRfY291bnR9IGZpbGVzJwogICAgICB9LAogICAgICB5b3VIYXZlVG9BdExlYXN0U2VsZWN0WDogewogICAgICAgIDA6ICdZb3UgaGF2ZSB0byBzZWxlY3QgYXQgbGVhc3QgJXtzbWFydF9jb3VudH0gZmlsZScsCiAgICAgICAgMTogJ1lvdSBoYXZlIHRvIHNlbGVjdCBhdCBsZWFzdCAle3NtYXJ0X2NvdW50fSBmaWxlcycKICAgICAgfSwKICAgICAgZXhjZWVkc1NpemU6ICcle2ZpbGV9IGV4Y2VlZHMgbWF4aW11bSBhbGxvd2VkIHNpemUgb2YgJXtzaXplfScsCiAgICAgIG1pc3NpbmdSZXF1aXJlZE1ldGFGaWVsZDogJ01pc3NpbmcgcmVxdWlyZWQgbWV0YSBmaWVsZHMnLAogICAgICBtaXNzaW5nUmVxdWlyZWRNZXRhRmllbGRPbkZpbGU6ICdNaXNzaW5nIHJlcXVpcmVkIG1ldGEgZmllbGRzIGluICV7ZmlsZU5hbWV9JywKICAgICAgaW5mZXJpb3JTaXplOiAnVGhpcyBmaWxlIGlzIHNtYWxsZXIgdGhhbiB0aGUgYWxsb3dlZCBzaXplIG9mICV7c2l6ZX0nLAogICAgICB5b3VDYW5Pbmx5VXBsb2FkRmlsZVR5cGVzOiAnWW91IGNhbiBvbmx5IHVwbG9hZDogJXt0eXBlc30nLAogICAgICBub01vcmVGaWxlc0FsbG93ZWQ6ICdDYW5ub3QgYWRkIG1vcmUgZmlsZXMnLAogICAgICBub0R1cGxpY2F0ZXM6ICJDYW5ub3QgYWRkIHRoZSBkdXBsaWNhdGUgZmlsZSAnJXtmaWxlTmFtZX0nLCBpdCBhbHJlYWR5IGV4aXN0cyIsCiAgICAgIGNvbXBhbmlvbkVycm9yOiAnQ29ubmVjdGlvbiB3aXRoIENvbXBhbmlvbiBmYWlsZWQnLAogICAgICBhdXRoQWJvcnRlZDogJ0F1dGhlbnRpY2F0aW9uIGFib3J0ZWQnLAogICAgICBjb21wYW5pb25VbmF1dGhvcml6ZUhpbnQ6ICdUbyB1bmF1dGhvcml6ZSB0byB5b3VyICV7cHJvdmlkZXJ9IGFjY291bnQsIHBsZWFzZSBnbyB0byAle3VybH0nLAogICAgICBmYWlsZWRUb1VwbG9hZDogJ0ZhaWxlZCB0byB1cGxvYWQgJXtmaWxlfScsCiAgICAgIG5vSW50ZXJuZXRDb25uZWN0aW9uOiAnTm8gSW50ZXJuZXQgY29ubmVjdGlvbicsCiAgICAgIGNvbm5lY3RlZFRvSW50ZXJuZXQ6ICdDb25uZWN0ZWQgdG8gdGhlIEludGVybmV0JywKICAgICAgLy8gU3RyaW5ncyBmb3IgcmVtb3RlIHByb3ZpZGVycwogICAgICBub0ZpbGVzRm91bmQ6ICdZb3UgaGF2ZSBubyBmaWxlcyBvciBmb2xkZXJzIGhlcmUnLAogICAgICBzZWxlY3RYOiB7CiAgICAgICAgMDogJ1NlbGVjdCAle3NtYXJ0X2NvdW50fScsCiAgICAgICAgMTogJ1NlbGVjdCAle3NtYXJ0X2NvdW50fScKICAgICAgfSwKICAgICAgYWxsRmlsZXNGcm9tRm9sZGVyTmFtZWQ6ICdBbGwgZmlsZXMgZnJvbSBmb2xkZXIgJXtuYW1lfScsCiAgICAgIG9wZW5Gb2xkZXJOYW1lZDogJ09wZW4gZm9sZGVyICV7bmFtZX0nLAogICAgICBjYW5jZWw6ICdDYW5jZWwnLAogICAgICBsb2dPdXQ6ICdMb2cgb3V0JywKICAgICAgZmlsdGVyOiAnRmlsdGVyJywKICAgICAgcmVzZXRGaWx0ZXI6ICdSZXNldCBmaWx0ZXInLAogICAgICBsb2FkaW5nOiAnTG9hZGluZy4uLicsCiAgICAgIGF1dGhlbnRpY2F0ZVdpdGhUaXRsZTogJ1BsZWFzZSBhdXRoZW50aWNhdGUgd2l0aCAle3BsdWdpbk5hbWV9IHRvIHNlbGVjdCBmaWxlcycsCiAgICAgIGF1dGhlbnRpY2F0ZVdpdGg6ICdDb25uZWN0IHRvICV7cGx1Z2luTmFtZX0nLAogICAgICBzaWduSW5XaXRoR29vZ2xlOiAnU2lnbiBpbiB3aXRoIEdvb2dsZScsCiAgICAgIHNlYXJjaEltYWdlczogJ1NlYXJjaCBmb3IgaW1hZ2VzJywKICAgICAgZW50ZXJUZXh0VG9TZWFyY2g6ICdFbnRlciB0ZXh0IHRvIHNlYXJjaCBmb3IgaW1hZ2VzJywKICAgICAgYmFja1RvU2VhcmNoOiAnQmFjayB0byBTZWFyY2gnLAogICAgICBlbXB0eUZvbGRlckFkZGVkOiAnTm8gZmlsZXMgd2VyZSBhZGRlZCBmcm9tIGVtcHR5IGZvbGRlcicsCiAgICAgIGZvbGRlckFscmVhZHlBZGRlZDogJ1RoZSBmb2xkZXIgIiV7Zm9sZGVyfSIgd2FzIGFscmVhZHkgYWRkZWQnLAogICAgICBmb2xkZXJBZGRlZDogewogICAgICAgIDA6ICdBZGRlZCAle3NtYXJ0X2NvdW50fSBmaWxlIGZyb20gJXtmb2xkZXJ9JywKICAgICAgICAxOiAnQWRkZWQgJXtzbWFydF9jb3VudH0gZmlsZXMgZnJvbSAle2ZvbGRlcn0nCiAgICAgIH0KICAgIH0KICB9OwoKICB2YXIgcmVxdWlyZSQkNCA9IGluZGV4X2Jyb3dzZXI7CgogIC8qIGdsb2JhbCBBZ2dyZWdhdGVFcnJvciAqLwoKICBsZXQgX1N5bWJvbCRmb3IkMSwgX1N5bWJvbCRmb3IyJDE7CgogIGZ1bmN0aW9uIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ2KHJlY2VpdmVyLCBwcml2YXRlS2V5KSB7IGlmICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHJlY2VpdmVyLCBwcml2YXRlS2V5KSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJhdHRlbXB0ZWQgdG8gdXNlIHByaXZhdGUgZmllbGQgb24gbm9uLWluc3RhbmNlIik7IH0gcmV0dXJuIHJlY2VpdmVyOyB9CgogIHZhciBpZCQ2ID0gMDsKCiAgZnVuY3Rpb24gX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VLZXkkNihuYW1lKSB7IHJldHVybiAiX19wcml2YXRlXyIgKyBpZCQ2KysgKyAiXyIgKyBuYW1lOyB9CgoKCgoKICBjb25zdCB7CiAgICBuYW5vaWQ6IG5hbm9pZCQxCiAgfSA9IHJlcXVpcmUkJDQ7CgoKCgoKCgoKCgoKCgoKCgoKCgogIGNvbnN0IHsKICAgIGp1c3RFcnJvcnNMb2dnZXIsCiAgICBkZWJ1Z0xvZ2dlcjogZGVidWdMb2dnZXIkMQogIH0gPSBsb2dnZXJzOwoKICAgLy8gRXhwb3J0ZWQgZnJvbSBoZXJlLgoKCiAgY2xhc3MgUmVzdHJpY3Rpb25FcnJvciBleHRlbmRzIEVycm9yIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICBzdXBlciguLi5hcmd1bWVudHMpOwogICAgICB0aGlzLmlzUmVzdHJpY3Rpb24gPSB0cnVlOwogICAgfQoKICB9CgogIGlmICh0eXBlb2YgQWdncmVnYXRlRXJyb3IgPT09ICd1bmRlZmluZWQnKSB7CiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tZ2xvYmFsLWFzc2lnbgogICAgZ2xvYmFsVGhpcy5BZ2dyZWdhdGVFcnJvciA9IGNsYXNzIEFnZ3JlZ2F0ZUVycm9yIGV4dGVuZHMgRXJyb3IgewogICAgICBjb25zdHJ1Y3RvcihlcnJvcnMsIG1lc3NhZ2UpIHsKICAgICAgICBzdXBlcihtZXNzYWdlKTsKICAgICAgICB0aGlzLmVycm9ycyA9IGVycm9yczsKICAgICAgfQoKICAgIH07CiAgfQoKICBjbGFzcyBBZ2dyZWdhdGVSZXN0cmljdGlvbkVycm9yIGV4dGVuZHMgQWdncmVnYXRlRXJyb3IgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7CiAgICAgIHRoaXMuaXNSZXN0cmljdGlvbiA9IHRydWU7CiAgICB9CgogIH0KICAvKioKICAgKiBVcHB5IENvcmUgbW9kdWxlLgogICAqIE1hbmFnZXMgcGx1Z2lucywgc3RhdGUgdXBkYXRlcywgYWN0cyBhcyBhbiBldmVudCBidXMsCiAgICogYWRkcy9yZW1vdmVzIGZpbGVzIGFuZCBtZXRhZGF0YS4KICAgKi8KCgogIHZhciBfcGx1Z2lucyA9IC8qI19fUFVSRV9fKi9fY2xhc3NQcml2YXRlRmllbGRMb29zZUtleSQ2KCJwbHVnaW5zIik7CgogIHZhciBfc3RvcmVVbnN1YnNjcmliZSA9IC8qI19fUFVSRV9fKi9fY2xhc3NQcml2YXRlRmllbGRMb29zZUtleSQ2KCJzdG9yZVVuc3Vic2NyaWJlIik7CgogIHZhciBfZW1pdHRlciQyID0gLyojX19QVVJFX18qL19jbGFzc1ByaXZhdGVGaWVsZExvb3NlS2V5JDYoImVtaXR0ZXIiKTsKCiAgdmFyIF9wcmVQcm9jZXNzb3JzID0gLyojX19QVVJFX18qL19jbGFzc1ByaXZhdGVGaWVsZExvb3NlS2V5JDYoInByZVByb2Nlc3NvcnMiKTsKCiAgdmFyIF91cGxvYWRlcnMgPSAvKiNfX1BVUkVfXyovX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VLZXkkNigidXBsb2FkZXJzIik7CgogIHZhciBfcG9zdFByb2Nlc3NvcnMgPSAvKiNfX1BVUkVfXyovX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VLZXkkNigicG9zdFByb2Nlc3NvcnMiKTsKCiAgdmFyIF9jaGVja1Jlc3RyaWN0aW9ucyA9IC8qI19fUFVSRV9fKi9fY2xhc3NQcml2YXRlRmllbGRMb29zZUtleSQ2KCJjaGVja1Jlc3RyaWN0aW9ucyIpOwoKICB2YXIgX2NoZWNrTWluTnVtYmVyT2ZGaWxlcyA9IC8qI19fUFVSRV9fKi9fY2xhc3NQcml2YXRlRmllbGRMb29zZUtleSQ2KCJjaGVja01pbk51bWJlck9mRmlsZXMiKTsKCiAgdmFyIF9jaGVja1JlcXVpcmVkTWV0YUZpZWxkc09uRmlsZSA9IC8qI19fUFVSRV9fKi9fY2xhc3NQcml2YXRlRmllbGRMb29zZUtleSQ2KCJjaGVja1JlcXVpcmVkTWV0YUZpZWxkc09uRmlsZSIpOwoKICB2YXIgX2NoZWNrUmVxdWlyZWRNZXRhRmllbGRzID0gLyojX19QVVJFX18qL19jbGFzc1ByaXZhdGVGaWVsZExvb3NlS2V5JDYoImNoZWNrUmVxdWlyZWRNZXRhRmllbGRzIik7CgogIHZhciBfc2hvd09yTG9nRXJyb3JBbmRUaHJvdyA9IC8qI19fUFVSRV9fKi9fY2xhc3NQcml2YXRlRmllbGRMb29zZUtleSQ2KCJzaG93T3JMb2dFcnJvckFuZFRocm93Iik7CgogIHZhciBfYXNzZXJ0TmV3VXBsb2FkQWxsb3dlZCA9IC8qI19fUFVSRV9fKi9fY2xhc3NQcml2YXRlRmllbGRMb29zZUtleSQ2KCJhc3NlcnROZXdVcGxvYWRBbGxvd2VkIik7CgogIHZhciBfY2hlY2tBbmRDcmVhdGVGaWxlU3RhdGVPYmplY3QgPSAvKiNfX1BVUkVfXyovX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VLZXkkNigiY2hlY2tBbmRDcmVhdGVGaWxlU3RhdGVPYmplY3QiKTsKCiAgdmFyIF9zdGFydElmQXV0b1Byb2NlZWQgPSAvKiNfX1BVUkVfXyovX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VLZXkkNigic3RhcnRJZkF1dG9Qcm9jZWVkIik7CgogIHZhciBfYWRkTGlzdGVuZXJzID0gLyojX19QVVJFX18qL19jbGFzc1ByaXZhdGVGaWVsZExvb3NlS2V5JDYoImFkZExpc3RlbmVycyIpOwoKICB2YXIgX3VwZGF0ZU9ubGluZVN0YXR1cyA9IC8qI19fUFVSRV9fKi9fY2xhc3NQcml2YXRlRmllbGRMb29zZUtleSQ2KCJ1cGRhdGVPbmxpbmVTdGF0dXMiKTsKCiAgdmFyIF9jcmVhdGVVcGxvYWQgPSAvKiNfX1BVUkVfXyovX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VLZXkkNigiY3JlYXRlVXBsb2FkIik7CgogIHZhciBfZ2V0VXBsb2FkID0gLyojX19QVVJFX18qL19jbGFzc1ByaXZhdGVGaWVsZExvb3NlS2V5JDYoImdldFVwbG9hZCIpOwoKICB2YXIgX3JlbW92ZVVwbG9hZCA9IC8qI19fUFVSRV9fKi9fY2xhc3NQcml2YXRlRmllbGRMb29zZUtleSQ2KCJyZW1vdmVVcGxvYWQiKTsKCiAgdmFyIF9ydW5VcGxvYWQgPSAvKiNfX1BVUkVfXyovX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VLZXkkNigicnVuVXBsb2FkIik7CgogIF9TeW1ib2wkZm9yJDEgPSBTeW1ib2wuZm9yKCd1cHB5IHRlc3Q6IGdldFBsdWdpbnMnKTsKICBfU3ltYm9sJGZvcjIkMSA9IFN5bWJvbC5mb3IoJ3VwcHkgdGVzdDogY3JlYXRlVXBsb2FkJyk7CgogIGNsYXNzIFVwcHkgewogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGdsb2JhbC1yZXF1aXJlCgogICAgLyoqIEB0eXBlIHtSZWNvcmQ8c3RyaW5nLCBCYXNlUGx1Z2luW10+fSAqLwoKICAgIC8qKgogICAgICogSW5zdGFudGlhdGUgVXBweQogICAgICoKICAgICAqIEBwYXJhbSB7b2JqZWN0fSBvcHRzIOKAlCBVcHB5IG9wdGlvbnMKICAgICAqLwogICAgY29uc3RydWN0b3IoX29wdHMpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIF9ydW5VcGxvYWQsIHsKICAgICAgICB2YWx1ZTogX3J1blVwbG9hZDIKICAgICAgfSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBfcmVtb3ZlVXBsb2FkLCB7CiAgICAgICAgdmFsdWU6IF9yZW1vdmVVcGxvYWQyCiAgICAgIH0pOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgX2dldFVwbG9hZCwgewogICAgICAgIHZhbHVlOiBfZ2V0VXBsb2FkMgogICAgICB9KTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIF9jcmVhdGVVcGxvYWQsIHsKICAgICAgICB2YWx1ZTogX2NyZWF0ZVVwbG9hZDIKICAgICAgfSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBfYWRkTGlzdGVuZXJzLCB7CiAgICAgICAgdmFsdWU6IF9hZGRMaXN0ZW5lcnMyCiAgICAgIH0pOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgX3N0YXJ0SWZBdXRvUHJvY2VlZCwgewogICAgICAgIHZhbHVlOiBfc3RhcnRJZkF1dG9Qcm9jZWVkMgogICAgICB9KTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIF9jaGVja0FuZENyZWF0ZUZpbGVTdGF0ZU9iamVjdCwgewogICAgICAgIHZhbHVlOiBfY2hlY2tBbmRDcmVhdGVGaWxlU3RhdGVPYmplY3QyCiAgICAgIH0pOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgX2Fzc2VydE5ld1VwbG9hZEFsbG93ZWQsIHsKICAgICAgICB2YWx1ZTogX2Fzc2VydE5ld1VwbG9hZEFsbG93ZWQyCiAgICAgIH0pOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgX3Nob3dPckxvZ0Vycm9yQW5kVGhyb3csIHsKICAgICAgICB2YWx1ZTogX3Nob3dPckxvZ0Vycm9yQW5kVGhyb3cyCiAgICAgIH0pOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgX2NoZWNrUmVxdWlyZWRNZXRhRmllbGRzLCB7CiAgICAgICAgdmFsdWU6IF9jaGVja1JlcXVpcmVkTWV0YUZpZWxkczIKICAgICAgfSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBfY2hlY2tSZXF1aXJlZE1ldGFGaWVsZHNPbkZpbGUsIHsKICAgICAgICB2YWx1ZTogX2NoZWNrUmVxdWlyZWRNZXRhRmllbGRzT25GaWxlMgogICAgICB9KTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIF9jaGVja01pbk51bWJlck9mRmlsZXMsIHsKICAgICAgICB2YWx1ZTogX2NoZWNrTWluTnVtYmVyT2ZGaWxlczIKICAgICAgfSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBfY2hlY2tSZXN0cmljdGlvbnMsIHsKICAgICAgICB2YWx1ZTogX2NoZWNrUmVzdHJpY3Rpb25zMgogICAgICB9KTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIF9wbHVnaW5zLCB7CiAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgdmFsdWU6IE9iamVjdC5jcmVhdGUobnVsbCkKICAgICAgfSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBfc3RvcmVVbnN1YnNjcmliZSwgewogICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgIHZhbHVlOiB2b2lkIDAKICAgICAgfSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBfZW1pdHRlciQyLCB7CiAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgdmFsdWU6IG5hbWVzcGFjZUVtaXR0ZXIoKQogICAgICB9KTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIF9wcmVQcm9jZXNzb3JzLCB7CiAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgdmFsdWU6IG5ldyBTZXQoKQogICAgICB9KTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIF91cGxvYWRlcnMsIHsKICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICB2YWx1ZTogbmV3IFNldCgpCiAgICAgIH0pOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgX3Bvc3RQcm9jZXNzb3JzLCB7CiAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgdmFsdWU6IG5ldyBTZXQoKQogICAgICB9KTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIF91cGRhdGVPbmxpbmVTdGF0dXMsIHsKICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICB2YWx1ZTogdGhpcy51cGRhdGVPbmxpbmVTdGF0dXMuYmluZCh0aGlzKQogICAgICB9KTsKICAgICAgdGhpcy5kZWZhdWx0TG9jYWxlID0gbG9jYWxlJDE7CiAgICAgIGNvbnN0IGRlZmF1bHRPcHRpb25zID0gewogICAgICAgIGlkOiAndXBweScsCiAgICAgICAgYXV0b1Byb2NlZWQ6IGZhbHNlLAoKICAgICAgICAvKioKICAgICAgICAgKiBAZGVwcmVjYXRlZCBUaGUgbWV0aG9kIHNob3VsZCBub3QgYmUgdXNlZAogICAgICAgICAqLwogICAgICAgIGFsbG93TXVsdGlwbGVVcGxvYWRzOiB0cnVlLAogICAgICAgIGFsbG93TXVsdGlwbGVVcGxvYWRCYXRjaGVzOiB0cnVlLAogICAgICAgIGRlYnVnOiBmYWxzZSwKICAgICAgICByZXN0cmljdGlvbnM6IHsKICAgICAgICAgIG1heEZpbGVTaXplOiBudWxsLAogICAgICAgICAgbWluRmlsZVNpemU6IG51bGwsCiAgICAgICAgICBtYXhUb3RhbEZpbGVTaXplOiBudWxsLAogICAgICAgICAgbWF4TnVtYmVyT2ZGaWxlczogbnVsbCwKICAgICAgICAgIG1pbk51bWJlck9mRmlsZXM6IG51bGwsCiAgICAgICAgICBhbGxvd2VkRmlsZVR5cGVzOiBudWxsLAogICAgICAgICAgcmVxdWlyZWRNZXRhRmllbGRzOiBbXQogICAgICAgIH0sCiAgICAgICAgbWV0YToge30sCiAgICAgICAgb25CZWZvcmVGaWxlQWRkZWQ6IGN1cnJlbnRGaWxlID0+IGN1cnJlbnRGaWxlLAogICAgICAgIG9uQmVmb3JlVXBsb2FkOiBmaWxlcyA9PiBmaWxlcywKICAgICAgICBzdG9yZTogbGliJDMoKSwKICAgICAgICBsb2dnZXI6IGp1c3RFcnJvcnNMb2dnZXIsCiAgICAgICAgaW5mb1RpbWVvdXQ6IDUwMDAKICAgICAgfTsgLy8gTWVyZ2UgZGVmYXVsdCBvcHRpb25zIHdpdGggdGhlIG9uZXMgc2V0IGJ5IHVzZXIsCiAgICAgIC8vIG1ha2luZyBzdXJlIHRvIG1lcmdlIHJlc3RyaWN0aW9ucyB0b28KCiAgICAgIHRoaXMub3B0cyA9IHsgLi4uZGVmYXVsdE9wdGlvbnMsCiAgICAgICAgLi4uX29wdHMsCiAgICAgICAgcmVzdHJpY3Rpb25zOiB7IC4uLmRlZmF1bHRPcHRpb25zLnJlc3RyaWN0aW9ucywKICAgICAgICAgIC4uLihfb3B0cyAmJiBfb3B0cy5yZXN0cmljdGlvbnMpCiAgICAgICAgfQogICAgICB9OyAvLyBTdXBwb3J0IGRlYnVnOiB0cnVlIGZvciBiYWNrd2FyZHMtY29tcGF0YWJpbGl0eSwgdW5sZXNzIGxvZ2dlciBpcyBzZXQgaW4gb3B0cwogICAgICAvLyBvcHRzIGluc3RlYWQgb2YgdGhpcy5vcHRzIHRvIGF2b2lkIGNvbXBhcmluZyBvYmplY3RzIOKAlCB3ZSBzZXQgbG9nZ2VyOiBqdXN0RXJyb3JzTG9nZ2VyIGluIGRlZmF1bHRPcHRpb25zCgogICAgICBpZiAoX29wdHMgJiYgX29wdHMubG9nZ2VyICYmIF9vcHRzLmRlYnVnKSB7CiAgICAgICAgdGhpcy5sb2coJ1lvdSBhcmUgdXNpbmcgYSBjdXN0b20gYGxvZ2dlcmAsIGJ1dCBhbHNvIHNldCBgZGVidWc6IHRydWVgLCB3aGljaCB1c2VzIGJ1aWx0LWluIGxvZ2dlciB0byBvdXRwdXQgbG9ncyB0byBjb25zb2xlLiBJZ25vcmluZyBgZGVidWc6IHRydWVgIGFuZCB1c2luZyB5b3VyIGN1c3RvbSBgbG9nZ2VyYC4nLCAnd2FybmluZycpOwogICAgICB9IGVsc2UgaWYgKF9vcHRzICYmIF9vcHRzLmRlYnVnKSB7CiAgICAgICAgdGhpcy5vcHRzLmxvZ2dlciA9IGRlYnVnTG9nZ2VyJDE7CiAgICAgIH0KCiAgICAgIHRoaXMubG9nKGBVc2luZyBDb3JlIHYke3RoaXMuY29uc3RydWN0b3IuVkVSU0lPTn1gKTsKCiAgICAgIGlmICh0aGlzLm9wdHMucmVzdHJpY3Rpb25zLmFsbG93ZWRGaWxlVHlwZXMgJiYgdGhpcy5vcHRzLnJlc3RyaWN0aW9ucy5hbGxvd2VkRmlsZVR5cGVzICE9PSBudWxsICYmICFBcnJheS5pc0FycmF5KHRoaXMub3B0cy5yZXN0cmljdGlvbnMuYWxsb3dlZEZpbGVUeXBlcykpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdgcmVzdHJpY3Rpb25zLmFsbG93ZWRGaWxlVHlwZXNgIG11c3QgYmUgYW4gYXJyYXknKTsKICAgICAgfQoKICAgICAgdGhpcy5pMThuSW5pdCgpOyAvLyBfX19XaHkgdGhyb3R0bGUgYXQgNTAwbXM/CiAgICAgIC8vICAgIC0gV2UgbXVzdCB0aHJvdHRsZSBhdCA+MjUwbXMgZm9yIHN1cGVyZm9jdXMgaW4gRGFzaGJvYXJkIHRvIHdvcmsgd2VsbAogICAgICAvLyAgICAoYmVjYXVzZSBhbmltYXRpb24gdGFrZXMgMC4yNXMsIGFuZCB3ZSB3YW50IHRvIHdhaXQgZm9yIGFsbCBhbmltYXRpb25zIHRvIGJlIG92ZXIgYmVmb3JlIHJlZm9jdXNpbmcpLgogICAgICAvLyAgICBbUHJhY3RpY2FsIENoZWNrXTogaWYgdGhvdHRsZSBpcyBhdCAxMDBtcywgdGhlbiBpZiB5b3UgYXJlIHVwbG9hZGluZyBhIGZpbGUsCiAgICAgIC8vICAgIGFuZCBjbGljayAnQUREIE1PUkUgRklMRVMnLCAtIGZvY3VzIHdvbid0IGFjdGl2YXRlIGluIEZpcmVmb3guCiAgICAgIC8vICAgIC0gV2UgbXVzdCB0aHJvdHRsZSBhdCBhcm91bmQgPjUwMG1zIHRvIGF2b2lkIHBlcmZvcm1hbmNlIGxhZ3MuCiAgICAgIC8vICAgIFtQcmFjdGljYWwgQ2hlY2tdIEZpcmVmb3gsIHRyeSB0byB1cGxvYWQgYSBiaWcgZmlsZSBmb3IgYSBwcm9sb25nZWQgcGVyaW9kIG9mIHRpbWUuIExhcHRvcCB3aWxsIHN0YXJ0IHRvIGhlYXQgdXAuCgogICAgICB0aGlzLmNhbGN1bGF0ZVByb2dyZXNzID0gbG9kYXNoX3Rocm90dGxlKHRoaXMuY2FsY3VsYXRlUHJvZ3Jlc3MuYmluZCh0aGlzKSwgNTAwLCB7CiAgICAgICAgbGVhZGluZzogdHJ1ZSwKICAgICAgICB0cmFpbGluZzogdHJ1ZQogICAgICB9KTsKICAgICAgdGhpcy5zdG9yZSA9IHRoaXMub3B0cy5zdG9yZTsKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgcGx1Z2luczoge30sCiAgICAgICAgZmlsZXM6IHt9LAogICAgICAgIGN1cnJlbnRVcGxvYWRzOiB7fSwKICAgICAgICBhbGxvd05ld1VwbG9hZDogdHJ1ZSwKICAgICAgICBjYXBhYmlsaXRpZXM6IHsKICAgICAgICAgIHVwbG9hZFByb2dyZXNzOiBzdXBwb3J0c1VwbG9hZFByb2dyZXNzKCksCiAgICAgICAgICBpbmRpdmlkdWFsQ2FuY2VsbGF0aW9uOiB0cnVlLAogICAgICAgICAgcmVzdW1hYmxlVXBsb2FkczogZmFsc2UKICAgICAgICB9LAogICAgICAgIHRvdGFsUHJvZ3Jlc3M6IDAsCiAgICAgICAgbWV0YTogeyAuLi50aGlzLm9wdHMubWV0YQogICAgICAgIH0sCiAgICAgICAgaW5mbzogW10sCiAgICAgICAgcmVjb3ZlcmVkU3RhdGU6IG51bGwKICAgICAgfSk7CiAgICAgIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ2KHRoaXMsIF9zdG9yZVVuc3Vic2NyaWJlKVtfc3RvcmVVbnN1YnNjcmliZV0gPSB0aGlzLnN0b3JlLnN1YnNjcmliZSgocHJldlN0YXRlLCBuZXh0U3RhdGUsIHBhdGNoKSA9PiB7CiAgICAgICAgdGhpcy5lbWl0KCdzdGF0ZS11cGRhdGUnLCBwcmV2U3RhdGUsIG5leHRTdGF0ZSwgcGF0Y2gpOwogICAgICAgIHRoaXMudXBkYXRlQWxsKG5leHRTdGF0ZSk7CiAgICAgIH0pOyAvLyBFeHBvc2luZyB1cHB5IG9iamVjdCBvbiB3aW5kb3cgZm9yIGRlYnVnZ2luZyBhbmQgdGVzdGluZwoKICAgICAgaWYgKHRoaXMub3B0cy5kZWJ1ZyAmJiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykgewogICAgICAgIHdpbmRvd1t0aGlzLm9wdHMuaWRdID0gdGhpczsKICAgICAgfQoKICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX2FkZExpc3RlbmVycylbX2FkZExpc3RlbmVyc10oKTsKICAgIH0KCiAgICBlbWl0KGV2ZW50KSB7CiAgICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4gPiAxID8gX2xlbiAtIDEgOiAwKSwgX2tleSA9IDE7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsKICAgICAgICBhcmdzW19rZXkgLSAxXSA9IGFyZ3VtZW50c1tfa2V5XTsKICAgICAgfQoKICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX2VtaXR0ZXIkMilbX2VtaXR0ZXIkMl0uZW1pdChldmVudCwgLi4uYXJncyk7CiAgICB9CgogICAgb24oZXZlbnQsIGNhbGxiYWNrKSB7CiAgICAgIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ2KHRoaXMsIF9lbWl0dGVyJDIpW19lbWl0dGVyJDJdLm9uKGV2ZW50LCBjYWxsYmFjayk7CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBvbmNlKGV2ZW50LCBjYWxsYmFjaykgewogICAgICBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkNih0aGlzLCBfZW1pdHRlciQyKVtfZW1pdHRlciQyXS5vbmNlKGV2ZW50LCBjYWxsYmFjayk7CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBvZmYoZXZlbnQsIGNhbGxiYWNrKSB7CiAgICAgIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ2KHRoaXMsIF9lbWl0dGVyJDIpW19lbWl0dGVyJDJdLm9mZihldmVudCwgY2FsbGJhY2spOwoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEl0ZXJhdGUgb24gYWxsIHBsdWdpbnMgYW5kIHJ1biBgdXBkYXRlYCBvbiB0aGVtLgogICAgICogQ2FsbGVkIGVhY2ggdGltZSBzdGF0ZSBjaGFuZ2VzLgogICAgICoKICAgICAqLwoKCiAgICB1cGRhdGVBbGwoc3RhdGUpIHsKICAgICAgdGhpcy5pdGVyYXRlUGx1Z2lucyhwbHVnaW4gPT4gewogICAgICAgIHBsdWdpbi51cGRhdGUoc3RhdGUpOwogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBzdGF0ZSB3aXRoIGEgcGF0Y2gKICAgICAqCiAgICAgKiBAcGFyYW0ge29iamVjdH0gcGF0Y2gge2ZvbzogJ2Jhcid9CiAgICAgKi8KCgogICAgc2V0U3RhdGUocGF0Y2gpIHsKICAgICAgdGhpcy5zdG9yZS5zZXRTdGF0ZShwYXRjaCk7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgY3VycmVudCBzdGF0ZS4KICAgICAqCiAgICAgKiBAcmV0dXJucyB7b2JqZWN0fQogICAgICovCgoKICAgIGdldFN0YXRlKCkgewogICAgICByZXR1cm4gdGhpcy5zdG9yZS5nZXRTdGF0ZSgpOwogICAgfQogICAgLyoqCiAgICAgKiBCYWNrIGNvbXBhdCBmb3Igd2hlbiB1cHB5LnN0YXRlIGlzIHVzZWQgaW5zdGVhZCBvZiB1cHB5LmdldFN0YXRlKCkuCiAgICAgKgogICAgICogQGRlcHJlY2F0ZWQKICAgICAqLwoKCiAgICBnZXQgc3RhdGUoKSB7CiAgICAgIC8vIEhlcmUsIHN0YXRlIGlzIGEgbm9uLWVudW1lcmFibGUgcHJvcGVydHkuCiAgICAgIHJldHVybiB0aGlzLmdldFN0YXRlKCk7CiAgICB9CiAgICAvKioKICAgICAqIFNob3J0aGFuZCB0byBzZXQgc3RhdGUgZm9yIGEgc3BlY2lmaWMgZmlsZS4KICAgICAqLwoKCiAgICBzZXRGaWxlU3RhdGUoZmlsZUlELCBzdGF0ZSkgewogICAgICBpZiAoIXRoaXMuZ2V0U3RhdGUoKS5maWxlc1tmaWxlSURdKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW7igJl0IHNldCBzdGF0ZSBmb3IgJHtmaWxlSUR9ICh0aGUgZmlsZSBjb3VsZCBoYXZlIGJlZW4gcmVtb3ZlZClgKTsKICAgICAgfQoKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgZmlsZXM6IHsgLi4udGhpcy5nZXRTdGF0ZSgpLmZpbGVzLAogICAgICAgICAgW2ZpbGVJRF06IHsgLi4udGhpcy5nZXRTdGF0ZSgpLmZpbGVzW2ZpbGVJRF0sCiAgICAgICAgICAgIC4uLnN0YXRlCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICBpMThuSW5pdCgpIHsKICAgICAgY29uc3QgdHJhbnNsYXRvciA9IG5ldyBUcmFuc2xhdG9yXzEoW3RoaXMuZGVmYXVsdExvY2FsZSwgdGhpcy5vcHRzLmxvY2FsZV0pOwogICAgICB0aGlzLmkxOG4gPSB0cmFuc2xhdG9yLnRyYW5zbGF0ZS5iaW5kKHRyYW5zbGF0b3IpOwogICAgICB0aGlzLmkxOG5BcnJheSA9IHRyYW5zbGF0b3IudHJhbnNsYXRlQXJyYXkuYmluZCh0cmFuc2xhdG9yKTsKICAgICAgdGhpcy5sb2NhbGUgPSB0cmFuc2xhdG9yLmxvY2FsZTsKICAgIH0KCiAgICBzZXRPcHRpb25zKG5ld09wdHMpIHsKICAgICAgdGhpcy5vcHRzID0geyAuLi50aGlzLm9wdHMsCiAgICAgICAgLi4ubmV3T3B0cywKICAgICAgICByZXN0cmljdGlvbnM6IHsgLi4udGhpcy5vcHRzLnJlc3RyaWN0aW9ucywKICAgICAgICAgIC4uLihuZXdPcHRzICYmIG5ld09wdHMucmVzdHJpY3Rpb25zKQogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGlmIChuZXdPcHRzLm1ldGEpIHsKICAgICAgICB0aGlzLnNldE1ldGEobmV3T3B0cy5tZXRhKTsKICAgICAgfQoKICAgICAgdGhpcy5pMThuSW5pdCgpOwoKICAgICAgaWYgKG5ld09wdHMubG9jYWxlKSB7CiAgICAgICAgdGhpcy5pdGVyYXRlUGx1Z2lucyhwbHVnaW4gPT4gewogICAgICAgICAgcGx1Z2luLnNldE9wdGlvbnMoKTsKICAgICAgICB9KTsKICAgICAgfSAvLyBOb3RlOiB0aGlzIGlzIG5vdCB0aGUgcHJlYWN0IGBzZXRTdGF0ZWAsIGl0J3MgYW4gaW50ZXJuYWwgZnVuY3Rpb24gdGhhdCBoYXMgdGhlIHNhbWUgbmFtZS4KCgogICAgICB0aGlzLnNldFN0YXRlKCk7IC8vIHNvIHRoYXQgVUkgcmUtcmVuZGVycyB3aXRoIG5ldyBvcHRpb25zCiAgICB9CgogICAgcmVzZXRQcm9ncmVzcygpIHsKICAgICAgY29uc3QgZGVmYXVsdFByb2dyZXNzID0gewogICAgICAgIHBlcmNlbnRhZ2U6IDAsCiAgICAgICAgYnl0ZXNVcGxvYWRlZDogMCwKICAgICAgICB1cGxvYWRDb21wbGV0ZTogZmFsc2UsCiAgICAgICAgdXBsb2FkU3RhcnRlZDogbnVsbAogICAgICB9OwogICAgICBjb25zdCBmaWxlcyA9IHsgLi4udGhpcy5nZXRTdGF0ZSgpLmZpbGVzCiAgICAgIH07CiAgICAgIGNvbnN0IHVwZGF0ZWRGaWxlcyA9IHt9OwogICAgICBPYmplY3Qua2V5cyhmaWxlcykuZm9yRWFjaChmaWxlSUQgPT4gewogICAgICAgIGNvbnN0IHVwZGF0ZWRGaWxlID0geyAuLi5maWxlc1tmaWxlSURdCiAgICAgICAgfTsKICAgICAgICB1cGRhdGVkRmlsZS5wcm9ncmVzcyA9IHsgLi4udXBkYXRlZEZpbGUucHJvZ3Jlc3MsCiAgICAgICAgICAuLi5kZWZhdWx0UHJvZ3Jlc3MKICAgICAgICB9OwogICAgICAgIHVwZGF0ZWRGaWxlc1tmaWxlSURdID0gdXBkYXRlZEZpbGU7CiAgICAgIH0pOwogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICBmaWxlczogdXBkYXRlZEZpbGVzLAogICAgICAgIHRvdGFsUHJvZ3Jlc3M6IDAKICAgICAgfSk7CiAgICAgIHRoaXMuZW1pdCgncmVzZXQtcHJvZ3Jlc3MnKTsKICAgIH0KCiAgICBhZGRQcmVQcm9jZXNzb3IoZm4pIHsKICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX3ByZVByb2Nlc3NvcnMpW19wcmVQcm9jZXNzb3JzXS5hZGQoZm4pOwogICAgfQoKICAgIHJlbW92ZVByZVByb2Nlc3NvcihmbikgewogICAgICByZXR1cm4gX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX3ByZVByb2Nlc3NvcnMpW19wcmVQcm9jZXNzb3JzXS5kZWxldGUoZm4pOwogICAgfQoKICAgIGFkZFBvc3RQcm9jZXNzb3IoZm4pIHsKICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX3Bvc3RQcm9jZXNzb3JzKVtfcG9zdFByb2Nlc3NvcnNdLmFkZChmbik7CiAgICB9CgogICAgcmVtb3ZlUG9zdFByb2Nlc3NvcihmbikgewogICAgICByZXR1cm4gX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX3Bvc3RQcm9jZXNzb3JzKVtfcG9zdFByb2Nlc3NvcnNdLmRlbGV0ZShmbik7CiAgICB9CgogICAgYWRkVXBsb2FkZXIoZm4pIHsKICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX3VwbG9hZGVycylbX3VwbG9hZGVyc10uYWRkKGZuKTsKICAgIH0KCiAgICByZW1vdmVVcGxvYWRlcihmbikgewogICAgICByZXR1cm4gX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX3VwbG9hZGVycylbX3VwbG9hZGVyc10uZGVsZXRlKGZuKTsKICAgIH0KCiAgICBzZXRNZXRhKGRhdGEpIHsKICAgICAgY29uc3QgdXBkYXRlZE1ldGEgPSB7IC4uLnRoaXMuZ2V0U3RhdGUoKS5tZXRhLAogICAgICAgIC4uLmRhdGEKICAgICAgfTsKICAgICAgY29uc3QgdXBkYXRlZEZpbGVzID0geyAuLi50aGlzLmdldFN0YXRlKCkuZmlsZXMKICAgICAgfTsKICAgICAgT2JqZWN0LmtleXModXBkYXRlZEZpbGVzKS5mb3JFYWNoKGZpbGVJRCA9PiB7CiAgICAgICAgdXBkYXRlZEZpbGVzW2ZpbGVJRF0gPSB7IC4uLnVwZGF0ZWRGaWxlc1tmaWxlSURdLAogICAgICAgICAgbWV0YTogeyAuLi51cGRhdGVkRmlsZXNbZmlsZUlEXS5tZXRhLAogICAgICAgICAgICAuLi5kYXRhCiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfSk7CiAgICAgIHRoaXMubG9nKCdBZGRpbmcgbWV0YWRhdGE6Jyk7CiAgICAgIHRoaXMubG9nKGRhdGEpOwogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICBtZXRhOiB1cGRhdGVkTWV0YSwKICAgICAgICBmaWxlczogdXBkYXRlZEZpbGVzCiAgICAgIH0pOwogICAgfQoKICAgIHNldEZpbGVNZXRhKGZpbGVJRCwgZGF0YSkgewogICAgICBjb25zdCB1cGRhdGVkRmlsZXMgPSB7IC4uLnRoaXMuZ2V0U3RhdGUoKS5maWxlcwogICAgICB9OwoKICAgICAgaWYgKCF1cGRhdGVkRmlsZXNbZmlsZUlEXSkgewogICAgICAgIHRoaXMubG9nKCdXYXMgdHJ5aW5nIHRvIHNldCBtZXRhZGF0YSBmb3IgYSBmaWxlIHRoYXQgaGFzIGJlZW4gcmVtb3ZlZDogJywgZmlsZUlEKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IG5ld01ldGEgPSB7IC4uLnVwZGF0ZWRGaWxlc1tmaWxlSURdLm1ldGEsCiAgICAgICAgLi4uZGF0YQogICAgICB9OwogICAgICB1cGRhdGVkRmlsZXNbZmlsZUlEXSA9IHsgLi4udXBkYXRlZEZpbGVzW2ZpbGVJRF0sCiAgICAgICAgbWV0YTogbmV3TWV0YQogICAgICB9OwogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICBmaWxlczogdXBkYXRlZEZpbGVzCiAgICAgIH0pOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSBmaWxlIG9iamVjdC4KICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZmlsZUlEIFRoZSBJRCBvZiB0aGUgZmlsZSBvYmplY3QgdG8gcmV0dXJuLgogICAgICovCgoKICAgIGdldEZpbGUoZmlsZUlEKSB7CiAgICAgIHJldHVybiB0aGlzLmdldFN0YXRlKCkuZmlsZXNbZmlsZUlEXTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBmaWxlcyBpbiBhbiBhcnJheS4KICAgICAqLwoKCiAgICBnZXRGaWxlcygpIHsKICAgICAgY29uc3QgewogICAgICAgIGZpbGVzCiAgICAgIH0gPSB0aGlzLmdldFN0YXRlKCk7CiAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKGZpbGVzKTsKICAgIH0KCiAgICBnZXRPYmplY3RPZkZpbGVzUGVyU3RhdGUoKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBmaWxlczogZmlsZXNPYmplY3QsCiAgICAgICAgdG90YWxQcm9ncmVzcywKICAgICAgICBlcnJvcgogICAgICB9ID0gdGhpcy5nZXRTdGF0ZSgpOwogICAgICBjb25zdCBmaWxlcyA9IE9iamVjdC52YWx1ZXMoZmlsZXNPYmplY3QpOwogICAgICBjb25zdCBpblByb2dyZXNzRmlsZXMgPSBmaWxlcy5maWx0ZXIoX3JlZiA9PiB7CiAgICAgICAgbGV0IHsKICAgICAgICAgIHByb2dyZXNzCiAgICAgICAgfSA9IF9yZWY7CiAgICAgICAgcmV0dXJuICFwcm9ncmVzcy51cGxvYWRDb21wbGV0ZSAmJiBwcm9ncmVzcy51cGxvYWRTdGFydGVkOwogICAgICB9KTsKICAgICAgY29uc3QgbmV3RmlsZXMgPSBmaWxlcy5maWx0ZXIoZmlsZSA9PiAhZmlsZS5wcm9ncmVzcy51cGxvYWRTdGFydGVkKTsKICAgICAgY29uc3Qgc3RhcnRlZEZpbGVzID0gZmlsZXMuZmlsdGVyKGZpbGUgPT4gZmlsZS5wcm9ncmVzcy51cGxvYWRTdGFydGVkIHx8IGZpbGUucHJvZ3Jlc3MucHJlcHJvY2VzcyB8fCBmaWxlLnByb2dyZXNzLnBvc3Rwcm9jZXNzKTsKICAgICAgY29uc3QgdXBsb2FkU3RhcnRlZEZpbGVzID0gZmlsZXMuZmlsdGVyKGZpbGUgPT4gZmlsZS5wcm9ncmVzcy51cGxvYWRTdGFydGVkKTsKICAgICAgY29uc3QgcGF1c2VkRmlsZXMgPSBmaWxlcy5maWx0ZXIoZmlsZSA9PiBmaWxlLmlzUGF1c2VkKTsKICAgICAgY29uc3QgY29tcGxldGVGaWxlcyA9IGZpbGVzLmZpbHRlcihmaWxlID0+IGZpbGUucHJvZ3Jlc3MudXBsb2FkQ29tcGxldGUpOwogICAgICBjb25zdCBlcnJvcmVkRmlsZXMgPSBmaWxlcy5maWx0ZXIoZmlsZSA9PiBmaWxlLmVycm9yKTsKICAgICAgY29uc3QgaW5Qcm9ncmVzc05vdFBhdXNlZEZpbGVzID0gaW5Qcm9ncmVzc0ZpbGVzLmZpbHRlcihmaWxlID0+ICFmaWxlLmlzUGF1c2VkKTsKICAgICAgY29uc3QgcHJvY2Vzc2luZ0ZpbGVzID0gZmlsZXMuZmlsdGVyKGZpbGUgPT4gZmlsZS5wcm9ncmVzcy5wcmVwcm9jZXNzIHx8IGZpbGUucHJvZ3Jlc3MucG9zdHByb2Nlc3MpOwogICAgICByZXR1cm4gewogICAgICAgIG5ld0ZpbGVzLAogICAgICAgIHN0YXJ0ZWRGaWxlcywKICAgICAgICB1cGxvYWRTdGFydGVkRmlsZXMsCiAgICAgICAgcGF1c2VkRmlsZXMsCiAgICAgICAgY29tcGxldGVGaWxlcywKICAgICAgICBlcnJvcmVkRmlsZXMsCiAgICAgICAgaW5Qcm9ncmVzc0ZpbGVzLAogICAgICAgIGluUHJvZ3Jlc3NOb3RQYXVzZWRGaWxlcywKICAgICAgICBwcm9jZXNzaW5nRmlsZXMsCiAgICAgICAgaXNVcGxvYWRTdGFydGVkOiB1cGxvYWRTdGFydGVkRmlsZXMubGVuZ3RoID4gMCwKICAgICAgICBpc0FsbENvbXBsZXRlOiB0b3RhbFByb2dyZXNzID09PSAxMDAgJiYgY29tcGxldGVGaWxlcy5sZW5ndGggPT09IGZpbGVzLmxlbmd0aCAmJiBwcm9jZXNzaW5nRmlsZXMubGVuZ3RoID09PSAwLAogICAgICAgIGlzQWxsRXJyb3JlZDogISFlcnJvciAmJiBlcnJvcmVkRmlsZXMubGVuZ3RoID09PSBmaWxlcy5sZW5ndGgsCiAgICAgICAgaXNBbGxQYXVzZWQ6IGluUHJvZ3Jlc3NGaWxlcy5sZW5ndGggIT09IDAgJiYgcGF1c2VkRmlsZXMubGVuZ3RoID09PSBpblByb2dyZXNzRmlsZXMubGVuZ3RoLAogICAgICAgIGlzVXBsb2FkSW5Qcm9ncmVzczogaW5Qcm9ncmVzc0ZpbGVzLmxlbmd0aCA+IDAsCiAgICAgICAgaXNTb21lR2hvc3Q6IGZpbGVzLnNvbWUoZmlsZSA9PiBmaWxlLmlzR2hvc3QpCiAgICAgIH07CiAgICB9CiAgICAvKioKICAgICAqIEEgcHVibGljIHdyYXBwZXIgZm9yIF9jaGVja1Jlc3RyaWN0aW9ucyDigJQgY2hlY2tzIGlmIGEgZmlsZSBwYXNzZXMgYSBzZXQgb2YgcmVzdHJpY3Rpb25zLgogICAgICogRm9yIHVzZSBpbiBVSSBwbHVpZ2lucyAobGlrZSBQcm92aWRlcnMpLCB0byBkaXNhbGxvdyBzZWxlY3RpbmcgZmlsZXMgdGhhdCB3b27igJl0IHBhc3MgcmVzdHJpY3Rpb25zLgogICAgICoKICAgICAqIEBwYXJhbSB7b2JqZWN0fSBmaWxlIG9iamVjdCB0byBjaGVjawogICAgICogQHBhcmFtIHtBcnJheX0gW2ZpbGVzXSBhcnJheSB0byBjaGVjayBtYXhOdW1iZXJPZkZpbGVzIGFuZCBtYXhUb3RhbEZpbGVTaXplCiAgICAgKiBAcmV0dXJucyB7b2JqZWN0fSB7IHJlc3VsdDogdHJ1ZS9mYWxzZSwgcmVhc29uOiB3aHkgZmlsZSBkaWRu4oCZdCBwYXNzIHJlc3RyaWN0aW9ucyB9CiAgICAgKi8KCgogICAgdmFsaWRhdGVSZXN0cmljdGlvbnMoZmlsZSwgZmlsZXMpIHsKICAgICAgdHJ5IHsKICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkNih0aGlzLCBfY2hlY2tSZXN0cmljdGlvbnMpW19jaGVja1Jlc3RyaWN0aW9uc10oZmlsZSwgZmlsZXMpOwoKICAgICAgICByZXR1cm4gewogICAgICAgICAgcmVzdWx0OiB0cnVlCiAgICAgICAgfTsKICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHJlc3VsdDogZmFsc2UsCiAgICAgICAgICByZWFzb246IGVyci5tZXNzYWdlCiAgICAgICAgfTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiBmaWxlIHBhc3NlcyBhIHNldCBvZiByZXN0cmljdGlvbnMgc2V0IGluIG9wdGlvbnM6IG1heEZpbGVTaXplLCBtaW5GaWxlU2l6ZSwKICAgICAqIG1heE51bWJlck9mRmlsZXMgYW5kIGFsbG93ZWRGaWxlVHlwZXMuCiAgICAgKgogICAgICogQHBhcmFtIHtvYmplY3R9IGZpbGUgb2JqZWN0IHRvIGNoZWNrCiAgICAgKiBAcGFyYW0ge0FycmF5fSBbZmlsZXNdIGFycmF5IHRvIGNoZWNrIG1heE51bWJlck9mRmlsZXMgYW5kIG1heFRvdGFsRmlsZVNpemUKICAgICAqIEBwcml2YXRlCiAgICAgKi8KCgogICAgY2hlY2tJZkZpbGVBbHJlYWR5RXhpc3RzKGZpbGVJRCkgewogICAgICBjb25zdCB7CiAgICAgICAgZmlsZXMKICAgICAgfSA9IHRoaXMuZ2V0U3RhdGUoKTsKCiAgICAgIGlmIChmaWxlc1tmaWxlSURdICYmICFmaWxlc1tmaWxlSURdLmlzR2hvc3QpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBmaWxlIHN0YXRlIG9iamVjdCBiYXNlZCBvbiB1c2VyLXByb3ZpZGVkIGBhZGRGaWxlKClgIG9wdGlvbnMuCiAgICAgKgogICAgICogTm90ZSB0aGlzIGlzIGV4dHJlbWVseSBzaWRlLWVmZmVjdGZ1bCBhbmQgc2hvdWxkIG9ubHkgYmUgZG9uZSB3aGVuIGEgZmlsZSBzdGF0ZSBvYmplY3QKICAgICAqIHdpbGwgYmUgYWRkZWQgdG8gc3RhdGUgaW1tZWRpYXRlbHkgYWZ0ZXJ3YXJkIQogICAgICoKICAgICAqIFRoZSBgZmlsZXNgIHZhbHVlIGlzIHBhc3NlZCBpbiBiZWNhdXNlIGl0IG1heSBiZSB1cGRhdGVkIGJ5IHRoZSBjYWxsZXIgd2l0aG91dCB1cGRhdGluZyB0aGUgc3RvcmUuCiAgICAgKi8KCgogICAgLyoqCiAgICAgKiBBZGQgYSBuZXcgZmlsZSB0byBgc3RhdGUuZmlsZXNgLiBUaGlzIHdpbGwgcnVuIGBvbkJlZm9yZUZpbGVBZGRlZGAsCiAgICAgKiB0cnkgdG8gZ3Vlc3MgZmlsZSB0eXBlIGluIGEgY2xldmVyIHdheSwgY2hlY2sgZmlsZSBhZ2FpbnN0IHJlc3RyaWN0aW9ucywKICAgICAqIGFuZCBzdGFydCBhbiB1cGxvYWQgaWYgYGF1dG9Qcm9jZWVkID09PSB0cnVlYC4KICAgICAqCiAgICAgKiBAcGFyYW0ge29iamVjdH0gZmlsZSBvYmplY3QgdG8gYWRkCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBpZCBmb3IgdGhlIGFkZGVkIGZpbGUKICAgICAqLwogICAgYWRkRmlsZShmaWxlKSB7CiAgICAgIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ2KHRoaXMsIF9hc3NlcnROZXdVcGxvYWRBbGxvd2VkKVtfYXNzZXJ0TmV3VXBsb2FkQWxsb3dlZF0oZmlsZSk7CgogICAgICBjb25zdCB7CiAgICAgICAgZmlsZXMKICAgICAgfSA9IHRoaXMuZ2V0U3RhdGUoKTsKCiAgICAgIGxldCBuZXdGaWxlID0gX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX2NoZWNrQW5kQ3JlYXRlRmlsZVN0YXRlT2JqZWN0KVtfY2hlY2tBbmRDcmVhdGVGaWxlU3RhdGVPYmplY3RdKGZpbGVzLCBmaWxlKTsgLy8gVXNlcnMgYXJlIGFza2VkIHRvIHJlLXNlbGVjdCByZWNvdmVyZWQgZmlsZXMgd2l0aG91dCBkYXRhLAogICAgICAvLyBhbmQgdG8ga2VlcCB0aGUgcHJvZ3Jlc3MsIG1ldGEgYW5kIGV2ZXJ0aGluZyBlbHNlLCB3ZSBvbmx5IHJlcGxhY2Ugc2FpZCBkYXRhCgoKICAgICAgaWYgKGZpbGVzW25ld0ZpbGUuaWRdICYmIGZpbGVzW25ld0ZpbGUuaWRdLmlzR2hvc3QpIHsKICAgICAgICBuZXdGaWxlID0geyAuLi5maWxlc1tuZXdGaWxlLmlkXSwKICAgICAgICAgIGRhdGE6IGZpbGUuZGF0YSwKICAgICAgICAgIGlzR2hvc3Q6IGZhbHNlCiAgICAgICAgfTsKICAgICAgICB0aGlzLmxvZyhgUmVwbGFjZWQgdGhlIGJsb2IgaW4gdGhlIHJlc3RvcmVkIGdob3N0IGZpbGU6ICR7bmV3RmlsZS5uYW1lfSwgJHtuZXdGaWxlLmlkfWApOwogICAgICB9CgogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICBmaWxlczogeyAuLi5maWxlcywKICAgICAgICAgIFtuZXdGaWxlLmlkXTogbmV3RmlsZQogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMuZW1pdCgnZmlsZS1hZGRlZCcsIG5ld0ZpbGUpOwogICAgICB0aGlzLmVtaXQoJ2ZpbGVzLWFkZGVkJywgW25ld0ZpbGVdKTsKICAgICAgdGhpcy5sb2coYEFkZGVkIGZpbGU6ICR7bmV3RmlsZS5uYW1lfSwgJHtuZXdGaWxlLmlkfSwgbWltZSB0eXBlOiAke25ld0ZpbGUudHlwZX1gKTsKCiAgICAgIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ2KHRoaXMsIF9zdGFydElmQXV0b1Byb2NlZWQpW19zdGFydElmQXV0b1Byb2NlZWRdKCk7CgogICAgICByZXR1cm4gbmV3RmlsZS5pZDsKICAgIH0KICAgIC8qKgogICAgICogQWRkIG11bHRpcGxlIGZpbGVzIHRvIGBzdGF0ZS5maWxlc2AuIFNlZSB0aGUgYGFkZEZpbGUoKWAgZG9jdW1lbnRhdGlvbi4KICAgICAqCiAgICAgKiBJZiBhbiBlcnJvciBvY2N1cnMgd2hpbGUgYWRkaW5nIGEgZmlsZSwgaXQgaXMgbG9nZ2VkIGFuZCB0aGUgdXNlciBpcyBub3RpZmllZC4KICAgICAqIFRoaXMgaXMgZ29vZCBmb3IgVUkgcGx1Z2lucywgYnV0IG5vdCBmb3IgcHJvZ3JhbW1hdGljIHVzZS4KICAgICAqIFByb2dyYW1tYXRpYyB1c2VycyBzaG91bGQgdXN1YWxseSBzdGlsbCB1c2UgYGFkZEZpbGUoKWAgb24gaW5kaXZpZHVhbCBmaWxlcy4KICAgICAqLwoKCiAgICBhZGRGaWxlcyhmaWxlRGVzY3JpcHRvcnMpIHsKICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX2Fzc2VydE5ld1VwbG9hZEFsbG93ZWQpW19hc3NlcnROZXdVcGxvYWRBbGxvd2VkXSgpOyAvLyBjcmVhdGUgYSBjb3B5IG9mIHRoZSBmaWxlcyBvYmplY3Qgb25seSBvbmNlCgoKICAgICAgY29uc3QgZmlsZXMgPSB7IC4uLnRoaXMuZ2V0U3RhdGUoKS5maWxlcwogICAgICB9OwogICAgICBjb25zdCBuZXdGaWxlcyA9IFtdOwogICAgICBjb25zdCBlcnJvcnMgPSBbXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlsZURlc2NyaXB0b3JzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGxldCBuZXdGaWxlID0gX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX2NoZWNrQW5kQ3JlYXRlRmlsZVN0YXRlT2JqZWN0KVtfY2hlY2tBbmRDcmVhdGVGaWxlU3RhdGVPYmplY3RdKGZpbGVzLCBmaWxlRGVzY3JpcHRvcnNbaV0pOyAvLyBVc2VycyBhcmUgYXNrZWQgdG8gcmUtc2VsZWN0IHJlY292ZXJlZCBmaWxlcyB3aXRob3V0IGRhdGEsCiAgICAgICAgICAvLyBhbmQgdG8ga2VlcCB0aGUgcHJvZ3Jlc3MsIG1ldGEgYW5kIGV2ZXJ0aGluZyBlbHNlLCB3ZSBvbmx5IHJlcGxhY2Ugc2FpZCBkYXRhCgoKICAgICAgICAgIGlmIChmaWxlc1tuZXdGaWxlLmlkXSAmJiBmaWxlc1tuZXdGaWxlLmlkXS5pc0dob3N0KSB7CiAgICAgICAgICAgIG5ld0ZpbGUgPSB7IC4uLmZpbGVzW25ld0ZpbGUuaWRdLAogICAgICAgICAgICAgIGRhdGE6IGZpbGVEZXNjcmlwdG9yc1tpXS5kYXRhLAogICAgICAgICAgICAgIGlzR2hvc3Q6IGZhbHNlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHRoaXMubG9nKGBSZXBsYWNlZCBibG9iIGluIGEgZ2hvc3QgZmlsZTogJHtuZXdGaWxlLm5hbWV9LCAke25ld0ZpbGUuaWR9YCk7CiAgICAgICAgICB9CgogICAgICAgICAgZmlsZXNbbmV3RmlsZS5pZF0gPSBuZXdGaWxlOwogICAgICAgICAgbmV3RmlsZXMucHVzaChuZXdGaWxlKTsKICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgIGlmICghZXJyLmlzUmVzdHJpY3Rpb24pIHsKICAgICAgICAgICAgZXJyb3JzLnB1c2goZXJyKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgIGZpbGVzCiAgICAgIH0pOwogICAgICBuZXdGaWxlcy5mb3JFYWNoKG5ld0ZpbGUgPT4gewogICAgICAgIHRoaXMuZW1pdCgnZmlsZS1hZGRlZCcsIG5ld0ZpbGUpOwogICAgICB9KTsKICAgICAgdGhpcy5lbWl0KCdmaWxlcy1hZGRlZCcsIG5ld0ZpbGVzKTsKCiAgICAgIGlmIChuZXdGaWxlcy5sZW5ndGggPiA1KSB7CiAgICAgICAgdGhpcy5sb2coYEFkZGVkIGJhdGNoIG9mICR7bmV3RmlsZXMubGVuZ3RofSBmaWxlc2ApOwogICAgICB9IGVsc2UgewogICAgICAgIE9iamVjdC5rZXlzKG5ld0ZpbGVzKS5mb3JFYWNoKGZpbGVJRCA9PiB7CiAgICAgICAgICB0aGlzLmxvZyhgQWRkZWQgZmlsZTogJHtuZXdGaWxlc1tmaWxlSURdLm5hbWV9XG4gaWQ6ICR7bmV3RmlsZXNbZmlsZUlEXS5pZH1cbiB0eXBlOiAke25ld0ZpbGVzW2ZpbGVJRF0udHlwZX1gKTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgaWYgKG5ld0ZpbGVzLmxlbmd0aCA+IDApIHsKICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkNih0aGlzLCBfc3RhcnRJZkF1dG9Qcm9jZWVkKVtfc3RhcnRJZkF1dG9Qcm9jZWVkXSgpOwogICAgICB9CgogICAgICBpZiAoZXJyb3JzLmxlbmd0aCA+IDApIHsKICAgICAgICBsZXQgbWVzc2FnZSA9ICdNdWx0aXBsZSBlcnJvcnMgb2NjdXJyZWQgd2hpbGUgYWRkaW5nIGZpbGVzOlxuJzsKICAgICAgICBlcnJvcnMuZm9yRWFjaChzdWJFcnJvciA9PiB7CiAgICAgICAgICBtZXNzYWdlICs9IGBcbiAqICR7c3ViRXJyb3IubWVzc2FnZX1gOwogICAgICAgIH0pOwogICAgICAgIHRoaXMuaW5mbyh7CiAgICAgICAgICBtZXNzYWdlOiB0aGlzLmkxOG4oJ2FkZEJ1bGtGaWxlc0ZhaWxlZCcsIHsKICAgICAgICAgICAgc21hcnRfY291bnQ6IGVycm9ycy5sZW5ndGgKICAgICAgICAgIH0pLAogICAgICAgICAgZGV0YWlsczogbWVzc2FnZQogICAgICAgIH0sICdlcnJvcicsIHRoaXMub3B0cy5pbmZvVGltZW91dCk7CgogICAgICAgIGlmICh0eXBlb2YgQWdncmVnYXRlRXJyb3IgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgIHRocm93IG5ldyBBZ2dyZWdhdGVFcnJvcihlcnJvcnMsIG1lc3NhZ2UpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBlcnIgPSBuZXcgRXJyb3IobWVzc2FnZSk7CiAgICAgICAgICBlcnIuZXJyb3JzID0gZXJyb3JzOwogICAgICAgICAgdGhyb3cgZXJyOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHJlbW92ZUZpbGVzKGZpbGVJRHMsIHJlYXNvbikgewogICAgICBjb25zdCB7CiAgICAgICAgZmlsZXMsCiAgICAgICAgY3VycmVudFVwbG9hZHMKICAgICAgfSA9IHRoaXMuZ2V0U3RhdGUoKTsKICAgICAgY29uc3QgdXBkYXRlZEZpbGVzID0geyAuLi5maWxlcwogICAgICB9OwogICAgICBjb25zdCB1cGRhdGVkVXBsb2FkcyA9IHsgLi4uY3VycmVudFVwbG9hZHMKICAgICAgfTsKICAgICAgY29uc3QgcmVtb3ZlZEZpbGVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgZmlsZUlEcy5mb3JFYWNoKGZpbGVJRCA9PiB7CiAgICAgICAgaWYgKGZpbGVzW2ZpbGVJRF0pIHsKICAgICAgICAgIHJlbW92ZWRGaWxlc1tmaWxlSURdID0gZmlsZXNbZmlsZUlEXTsKICAgICAgICAgIGRlbGV0ZSB1cGRhdGVkRmlsZXNbZmlsZUlEXTsKICAgICAgICB9CiAgICAgIH0pOyAvLyBSZW1vdmUgZmlsZXMgZnJvbSB0aGUgYGZpbGVJRHNgIGxpc3QgaW4gZWFjaCB1cGxvYWQuCgogICAgICBmdW5jdGlvbiBmaWxlSXNOb3RSZW1vdmVkKHVwbG9hZEZpbGVJRCkgewogICAgICAgIHJldHVybiByZW1vdmVkRmlsZXNbdXBsb2FkRmlsZUlEXSA9PT0gdW5kZWZpbmVkOwogICAgICB9CgogICAgICBPYmplY3Qua2V5cyh1cGRhdGVkVXBsb2FkcykuZm9yRWFjaCh1cGxvYWRJRCA9PiB7CiAgICAgICAgY29uc3QgbmV3RmlsZUlEcyA9IGN1cnJlbnRVcGxvYWRzW3VwbG9hZElEXS5maWxlSURzLmZpbHRlcihmaWxlSXNOb3RSZW1vdmVkKTsgLy8gUmVtb3ZlIHRoZSB1cGxvYWQgaWYgbm8gZmlsZXMgYXJlIGFzc29jaWF0ZWQgd2l0aCBpdCBhbnltb3JlLgoKICAgICAgICBpZiAobmV3RmlsZUlEcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgIGRlbGV0ZSB1cGRhdGVkVXBsb2Fkc1t1cGxvYWRJRF07CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB1cGRhdGVkVXBsb2Fkc1t1cGxvYWRJRF0gPSB7IC4uLmN1cnJlbnRVcGxvYWRzW3VwbG9hZElEXSwKICAgICAgICAgIGZpbGVJRHM6IG5ld0ZpbGVJRHMKICAgICAgICB9OwogICAgICB9KTsKICAgICAgY29uc3Qgc3RhdGVVcGRhdGUgPSB7CiAgICAgICAgY3VycmVudFVwbG9hZHM6IHVwZGF0ZWRVcGxvYWRzLAogICAgICAgIGZpbGVzOiB1cGRhdGVkRmlsZXMKICAgICAgfTsgLy8gSWYgYWxsIGZpbGVzIHdlcmUgcmVtb3ZlZCAtIGFsbG93IG5ldyB1cGxvYWRzLAogICAgICAvLyBhbmQgY2xlYXIgcmVjb3ZlcmVkU3RhdGUKCiAgICAgIGlmIChPYmplY3Qua2V5cyh1cGRhdGVkRmlsZXMpLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHN0YXRlVXBkYXRlLmFsbG93TmV3VXBsb2FkID0gdHJ1ZTsKICAgICAgICBzdGF0ZVVwZGF0ZS5lcnJvciA9IG51bGw7CiAgICAgICAgc3RhdGVVcGRhdGUucmVjb3ZlcmVkU3RhdGUgPSBudWxsOwogICAgICB9CgogICAgICB0aGlzLnNldFN0YXRlKHN0YXRlVXBkYXRlKTsKICAgICAgdGhpcy5jYWxjdWxhdGVUb3RhbFByb2dyZXNzKCk7CiAgICAgIGNvbnN0IHJlbW92ZWRGaWxlSURzID0gT2JqZWN0LmtleXMocmVtb3ZlZEZpbGVzKTsKICAgICAgcmVtb3ZlZEZpbGVJRHMuZm9yRWFjaChmaWxlSUQgPT4gewogICAgICAgIHRoaXMuZW1pdCgnZmlsZS1yZW1vdmVkJywgcmVtb3ZlZEZpbGVzW2ZpbGVJRF0sIHJlYXNvbik7CiAgICAgIH0pOwoKICAgICAgaWYgKHJlbW92ZWRGaWxlSURzLmxlbmd0aCA+IDUpIHsKICAgICAgICB0aGlzLmxvZyhgUmVtb3ZlZCAke3JlbW92ZWRGaWxlSURzLmxlbmd0aH0gZmlsZXNgKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmxvZyhgUmVtb3ZlZCBmaWxlczogJHtyZW1vdmVkRmlsZUlEcy5qb2luKCcsICcpfWApOwogICAgICB9CiAgICB9CgogICAgcmVtb3ZlRmlsZShmaWxlSUQsIHJlYXNvbikgewogICAgICBpZiAocmVhc29uID09PSB2b2lkIDApIHsKICAgICAgICByZWFzb24gPSBudWxsOwogICAgICB9CgogICAgICB0aGlzLnJlbW92ZUZpbGVzKFtmaWxlSURdLCByZWFzb24pOwogICAgfQoKICAgIHBhdXNlUmVzdW1lKGZpbGVJRCkgewogICAgICBpZiAoIXRoaXMuZ2V0U3RhdGUoKS5jYXBhYmlsaXRpZXMucmVzdW1hYmxlVXBsb2FkcyB8fCB0aGlzLmdldEZpbGUoZmlsZUlEKS51cGxvYWRDb21wbGV0ZSkgewogICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgIH0KCiAgICAgIGNvbnN0IHdhc1BhdXNlZCA9IHRoaXMuZ2V0RmlsZShmaWxlSUQpLmlzUGF1c2VkIHx8IGZhbHNlOwogICAgICBjb25zdCBpc1BhdXNlZCA9ICF3YXNQYXVzZWQ7CiAgICAgIHRoaXMuc2V0RmlsZVN0YXRlKGZpbGVJRCwgewogICAgICAgIGlzUGF1c2VkCiAgICAgIH0pOwogICAgICB0aGlzLmVtaXQoJ3VwbG9hZC1wYXVzZScsIGZpbGVJRCwgaXNQYXVzZWQpOwogICAgICByZXR1cm4gaXNQYXVzZWQ7CiAgICB9CgogICAgcGF1c2VBbGwoKSB7CiAgICAgIGNvbnN0IHVwZGF0ZWRGaWxlcyA9IHsgLi4udGhpcy5nZXRTdGF0ZSgpLmZpbGVzCiAgICAgIH07CiAgICAgIGNvbnN0IGluUHJvZ3Jlc3NVcGRhdGVkRmlsZXMgPSBPYmplY3Qua2V5cyh1cGRhdGVkRmlsZXMpLmZpbHRlcihmaWxlID0+IHsKICAgICAgICByZXR1cm4gIXVwZGF0ZWRGaWxlc1tmaWxlXS5wcm9ncmVzcy51cGxvYWRDb21wbGV0ZSAmJiB1cGRhdGVkRmlsZXNbZmlsZV0ucHJvZ3Jlc3MudXBsb2FkU3RhcnRlZDsKICAgICAgfSk7CiAgICAgIGluUHJvZ3Jlc3NVcGRhdGVkRmlsZXMuZm9yRWFjaChmaWxlID0+IHsKICAgICAgICBjb25zdCB1cGRhdGVkRmlsZSA9IHsgLi4udXBkYXRlZEZpbGVzW2ZpbGVdLAogICAgICAgICAgaXNQYXVzZWQ6IHRydWUKICAgICAgICB9OwogICAgICAgIHVwZGF0ZWRGaWxlc1tmaWxlXSA9IHVwZGF0ZWRGaWxlOwogICAgICB9KTsKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgZmlsZXM6IHVwZGF0ZWRGaWxlcwogICAgICB9KTsKICAgICAgdGhpcy5lbWl0KCdwYXVzZS1hbGwnKTsKICAgIH0KCiAgICByZXN1bWVBbGwoKSB7CiAgICAgIGNvbnN0IHVwZGF0ZWRGaWxlcyA9IHsgLi4udGhpcy5nZXRTdGF0ZSgpLmZpbGVzCiAgICAgIH07CiAgICAgIGNvbnN0IGluUHJvZ3Jlc3NVcGRhdGVkRmlsZXMgPSBPYmplY3Qua2V5cyh1cGRhdGVkRmlsZXMpLmZpbHRlcihmaWxlID0+IHsKICAgICAgICByZXR1cm4gIXVwZGF0ZWRGaWxlc1tmaWxlXS5wcm9ncmVzcy51cGxvYWRDb21wbGV0ZSAmJiB1cGRhdGVkRmlsZXNbZmlsZV0ucHJvZ3Jlc3MudXBsb2FkU3RhcnRlZDsKICAgICAgfSk7CiAgICAgIGluUHJvZ3Jlc3NVcGRhdGVkRmlsZXMuZm9yRWFjaChmaWxlID0+IHsKICAgICAgICBjb25zdCB1cGRhdGVkRmlsZSA9IHsgLi4udXBkYXRlZEZpbGVzW2ZpbGVdLAogICAgICAgICAgaXNQYXVzZWQ6IGZhbHNlLAogICAgICAgICAgZXJyb3I6IG51bGwKICAgICAgICB9OwogICAgICAgIHVwZGF0ZWRGaWxlc1tmaWxlXSA9IHVwZGF0ZWRGaWxlOwogICAgICB9KTsKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgZmlsZXM6IHVwZGF0ZWRGaWxlcwogICAgICB9KTsKICAgICAgdGhpcy5lbWl0KCdyZXN1bWUtYWxsJyk7CiAgICB9CgogICAgcmV0cnlBbGwoKSB7CiAgICAgIGNvbnN0IHVwZGF0ZWRGaWxlcyA9IHsgLi4udGhpcy5nZXRTdGF0ZSgpLmZpbGVzCiAgICAgIH07CiAgICAgIGNvbnN0IGZpbGVzVG9SZXRyeSA9IE9iamVjdC5rZXlzKHVwZGF0ZWRGaWxlcykuZmlsdGVyKGZpbGUgPT4gewogICAgICAgIHJldHVybiB1cGRhdGVkRmlsZXNbZmlsZV0uZXJyb3I7CiAgICAgIH0pOwogICAgICBmaWxlc1RvUmV0cnkuZm9yRWFjaChmaWxlID0+IHsKICAgICAgICBjb25zdCB1cGRhdGVkRmlsZSA9IHsgLi4udXBkYXRlZEZpbGVzW2ZpbGVdLAogICAgICAgICAgaXNQYXVzZWQ6IGZhbHNlLAogICAgICAgICAgZXJyb3I6IG51bGwKICAgICAgICB9OwogICAgICAgIHVwZGF0ZWRGaWxlc1tmaWxlXSA9IHVwZGF0ZWRGaWxlOwogICAgICB9KTsKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgZmlsZXM6IHVwZGF0ZWRGaWxlcywKICAgICAgICBlcnJvcjogbnVsbAogICAgICB9KTsKICAgICAgdGhpcy5lbWl0KCdyZXRyeS1hbGwnLCBmaWxlc1RvUmV0cnkpOwoKICAgICAgaWYgKGZpbGVzVG9SZXRyeS5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHsKICAgICAgICAgIHN1Y2Nlc3NmdWw6IFtdLAogICAgICAgICAgZmFpbGVkOiBbXQogICAgICAgIH0pOwogICAgICB9CgogICAgICBjb25zdCB1cGxvYWRJRCA9IF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ2KHRoaXMsIF9jcmVhdGVVcGxvYWQpW19jcmVhdGVVcGxvYWRdKGZpbGVzVG9SZXRyeSwgewogICAgICAgIGZvcmNlQWxsb3dOZXdVcGxvYWQ6IHRydWUgLy8gY3JlYXRlIG5ldyB1cGxvYWQgZXZlbiBpZiBhbGxvd05ld1VwbG9hZDogZmFsc2UKCiAgICAgIH0pOwoKICAgICAgcmV0dXJuIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ2KHRoaXMsIF9ydW5VcGxvYWQpW19ydW5VcGxvYWRdKHVwbG9hZElEKTsKICAgIH0KCiAgICBjYW5jZWxBbGwoKSB7CiAgICAgIHRoaXMuZW1pdCgnY2FuY2VsLWFsbCcpOwogICAgICBjb25zdCB7CiAgICAgICAgZmlsZXMKICAgICAgfSA9IHRoaXMuZ2V0U3RhdGUoKTsKICAgICAgY29uc3QgZmlsZUlEcyA9IE9iamVjdC5rZXlzKGZpbGVzKTsKCiAgICAgIGlmIChmaWxlSURzLmxlbmd0aCkgewogICAgICAgIHRoaXMucmVtb3ZlRmlsZXMoZmlsZUlEcywgJ2NhbmNlbC1hbGwnKTsKICAgICAgfQoKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgdG90YWxQcm9ncmVzczogMCwKICAgICAgICBlcnJvcjogbnVsbCwKICAgICAgICByZWNvdmVyZWRTdGF0ZTogbnVsbAogICAgICB9KTsKICAgIH0KCiAgICByZXRyeVVwbG9hZChmaWxlSUQpIHsKICAgICAgdGhpcy5zZXRGaWxlU3RhdGUoZmlsZUlELCB7CiAgICAgICAgZXJyb3I6IG51bGwsCiAgICAgICAgaXNQYXVzZWQ6IGZhbHNlCiAgICAgIH0pOwogICAgICB0aGlzLmVtaXQoJ3VwbG9hZC1yZXRyeScsIGZpbGVJRCk7CgogICAgICBjb25zdCB1cGxvYWRJRCA9IF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ2KHRoaXMsIF9jcmVhdGVVcGxvYWQpW19jcmVhdGVVcGxvYWRdKFtmaWxlSURdLCB7CiAgICAgICAgZm9yY2VBbGxvd05ld1VwbG9hZDogdHJ1ZSAvLyBjcmVhdGUgbmV3IHVwbG9hZCBldmVuIGlmIGFsbG93TmV3VXBsb2FkOiBmYWxzZQoKICAgICAgfSk7CgogICAgICByZXR1cm4gX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX3J1blVwbG9hZClbX3J1blVwbG9hZF0odXBsb2FkSUQpOwogICAgfQoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLmNhbmNlbEFsbCgpOwogICAgfQoKICAgIGxvZ291dCgpIHsKICAgICAgdGhpcy5pdGVyYXRlUGx1Z2lucyhwbHVnaW4gPT4gewogICAgICAgIGlmIChwbHVnaW4ucHJvdmlkZXIgJiYgcGx1Z2luLnByb3ZpZGVyLmxvZ291dCkgewogICAgICAgICAgcGx1Z2luLnByb3ZpZGVyLmxvZ291dCgpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgY2FsY3VsYXRlUHJvZ3Jlc3MoZmlsZSwgZGF0YSkgewogICAgICBpZiAoIXRoaXMuZ2V0RmlsZShmaWxlLmlkKSkgewogICAgICAgIHRoaXMubG9nKGBOb3Qgc2V0dGluZyBwcm9ncmVzcyBmb3IgYSBmaWxlIHRoYXQgaGFzIGJlZW4gcmVtb3ZlZDogJHtmaWxlLmlkfWApOwogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBieXRlc1RvdGFsIG1heSBiZSBudWxsIG9yIHplcm87IGluIHRoYXQgY2FzZSB3ZSBjYW4ndCBkaXZpZGUgYnkgaXQKCgogICAgICBjb25zdCBjYW5IYXZlUGVyY2VudGFnZSA9IE51bWJlci5pc0Zpbml0ZShkYXRhLmJ5dGVzVG90YWwpICYmIGRhdGEuYnl0ZXNUb3RhbCA+IDA7CiAgICAgIHRoaXMuc2V0RmlsZVN0YXRlKGZpbGUuaWQsIHsKICAgICAgICBwcm9ncmVzczogeyAuLi50aGlzLmdldEZpbGUoZmlsZS5pZCkucHJvZ3Jlc3MsCiAgICAgICAgICBieXRlc1VwbG9hZGVkOiBkYXRhLmJ5dGVzVXBsb2FkZWQsCiAgICAgICAgICBieXRlc1RvdGFsOiBkYXRhLmJ5dGVzVG90YWwsCiAgICAgICAgICBwZXJjZW50YWdlOiBjYW5IYXZlUGVyY2VudGFnZSA/IE1hdGgucm91bmQoZGF0YS5ieXRlc1VwbG9hZGVkIC8gZGF0YS5ieXRlc1RvdGFsICogMTAwKSA6IDAKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLmNhbGN1bGF0ZVRvdGFsUHJvZ3Jlc3MoKTsKICAgIH0KCiAgICBjYWxjdWxhdGVUb3RhbFByb2dyZXNzKCkgewogICAgICAvLyBjYWxjdWxhdGUgdG90YWwgcHJvZ3Jlc3MsIHVzaW5nIHRoZSBudW1iZXIgb2YgZmlsZXMgY3VycmVudGx5IHVwbG9hZGluZywKICAgICAgLy8gbXVsdGlwbGllZCBieSAxMDAgYW5kIHRoZSBzdW1tIG9mIGluZGl2aWR1YWwgcHJvZ3Jlc3Mgb2YgZWFjaCBmaWxlCiAgICAgIGNvbnN0IGZpbGVzID0gdGhpcy5nZXRGaWxlcygpOwogICAgICBjb25zdCBpblByb2dyZXNzID0gZmlsZXMuZmlsdGVyKGZpbGUgPT4gewogICAgICAgIHJldHVybiBmaWxlLnByb2dyZXNzLnVwbG9hZFN0YXJ0ZWQgfHwgZmlsZS5wcm9ncmVzcy5wcmVwcm9jZXNzIHx8IGZpbGUucHJvZ3Jlc3MucG9zdHByb2Nlc3M7CiAgICAgIH0pOwoKICAgICAgaWYgKGluUHJvZ3Jlc3MubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5lbWl0KCdwcm9ncmVzcycsIDApOwogICAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgICAgdG90YWxQcm9ncmVzczogMAogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgc2l6ZWRGaWxlcyA9IGluUHJvZ3Jlc3MuZmlsdGVyKGZpbGUgPT4gZmlsZS5wcm9ncmVzcy5ieXRlc1RvdGFsICE9IG51bGwpOwogICAgICBjb25zdCB1bnNpemVkRmlsZXMgPSBpblByb2dyZXNzLmZpbHRlcihmaWxlID0+IGZpbGUucHJvZ3Jlc3MuYnl0ZXNUb3RhbCA9PSBudWxsKTsKCiAgICAgIGlmIChzaXplZEZpbGVzLmxlbmd0aCA9PT0gMCkgewogICAgICAgIGNvbnN0IHByb2dyZXNzTWF4ID0gaW5Qcm9ncmVzcy5sZW5ndGggKiAxMDA7CiAgICAgICAgY29uc3QgY3VycmVudFByb2dyZXNzID0gdW5zaXplZEZpbGVzLnJlZHVjZSgoYWNjLCBmaWxlKSA9PiB7CiAgICAgICAgICByZXR1cm4gYWNjICsgZmlsZS5wcm9ncmVzcy5wZXJjZW50YWdlOwogICAgICAgIH0sIDApOwogICAgICAgIGNvbnN0IHRvdGFsUHJvZ3Jlc3MgPSBNYXRoLnJvdW5kKGN1cnJlbnRQcm9ncmVzcyAvIHByb2dyZXNzTWF4ICogMTAwKTsKICAgICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICAgIHRvdGFsUHJvZ3Jlc3MKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGxldCB0b3RhbFNpemUgPSBzaXplZEZpbGVzLnJlZHVjZSgoYWNjLCBmaWxlKSA9PiB7CiAgICAgICAgcmV0dXJuIGFjYyArIGZpbGUucHJvZ3Jlc3MuYnl0ZXNUb3RhbDsKICAgICAgfSwgMCk7CiAgICAgIGNvbnN0IGF2ZXJhZ2VTaXplID0gdG90YWxTaXplIC8gc2l6ZWRGaWxlcy5sZW5ndGg7CiAgICAgIHRvdGFsU2l6ZSArPSBhdmVyYWdlU2l6ZSAqIHVuc2l6ZWRGaWxlcy5sZW5ndGg7CiAgICAgIGxldCB1cGxvYWRlZFNpemUgPSAwOwogICAgICBzaXplZEZpbGVzLmZvckVhY2goZmlsZSA9PiB7CiAgICAgICAgdXBsb2FkZWRTaXplICs9IGZpbGUucHJvZ3Jlc3MuYnl0ZXNVcGxvYWRlZDsKICAgICAgfSk7CiAgICAgIHVuc2l6ZWRGaWxlcy5mb3JFYWNoKGZpbGUgPT4gewogICAgICAgIHVwbG9hZGVkU2l6ZSArPSBhdmVyYWdlU2l6ZSAqIChmaWxlLnByb2dyZXNzLnBlcmNlbnRhZ2UgfHwgMCkgLyAxMDA7CiAgICAgIH0pOwogICAgICBsZXQgdG90YWxQcm9ncmVzcyA9IHRvdGFsU2l6ZSA9PT0gMCA/IDAgOiBNYXRoLnJvdW5kKHVwbG9hZGVkU2l6ZSAvIHRvdGFsU2l6ZSAqIDEwMCk7IC8vIGhvdCBmaXgsIGJlY2F1c2U6CiAgICAgIC8vIHVwbG9hZGVkU2l6ZSBlbmRlZCB1cCBsYXJnZXIgdGhhbiB0b3RhbFNpemUsIHJlc3VsdGluZyBpbiAxMzI1JSB0b3RhbAoKICAgICAgaWYgKHRvdGFsUHJvZ3Jlc3MgPiAxMDApIHsKICAgICAgICB0b3RhbFByb2dyZXNzID0gMTAwOwogICAgICB9CgogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICB0b3RhbFByb2dyZXNzCiAgICAgIH0pOwogICAgICB0aGlzLmVtaXQoJ3Byb2dyZXNzJywgdG90YWxQcm9ncmVzcyk7CiAgICB9CiAgICAvKioKICAgICAqIFJlZ2lzdGVycyBsaXN0ZW5lcnMgZm9yIGFsbCBnbG9iYWwgYWN0aW9ucywgbGlrZToKICAgICAqIGBlcnJvcmAsIGBmaWxlLXJlbW92ZWRgLCBgdXBsb2FkLXByb2dyZXNzYAogICAgICovCgoKICAgIHVwZGF0ZU9ubGluZVN0YXR1cygpIHsKICAgICAgY29uc3Qgb25saW5lID0gdHlwZW9mIHdpbmRvdy5uYXZpZ2F0b3Iub25MaW5lICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdy5uYXZpZ2F0b3Iub25MaW5lIDogdHJ1ZTsKCiAgICAgIGlmICghb25saW5lKSB7CiAgICAgICAgdGhpcy5lbWl0KCdpcy1vZmZsaW5lJyk7CiAgICAgICAgdGhpcy5pbmZvKHRoaXMuaTE4bignbm9JbnRlcm5ldENvbm5lY3Rpb24nKSwgJ2Vycm9yJywgMCk7CiAgICAgICAgdGhpcy53YXNPZmZsaW5lID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmVtaXQoJ2lzLW9ubGluZScpOwoKICAgICAgICBpZiAodGhpcy53YXNPZmZsaW5lKSB7CiAgICAgICAgICB0aGlzLmVtaXQoJ2JhY2stb25saW5lJyk7CiAgICAgICAgICB0aGlzLmluZm8odGhpcy5pMThuKCdjb25uZWN0ZWRUb0ludGVybmV0JyksICdzdWNjZXNzJywgMzAwMCk7CiAgICAgICAgICB0aGlzLndhc09mZmxpbmUgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBnZXRJRCgpIHsKICAgICAgcmV0dXJuIHRoaXMub3B0cy5pZDsKICAgIH0KICAgIC8qKgogICAgICogUmVnaXN0ZXJzIGEgcGx1Z2luIHdpdGggQ29yZS4KICAgICAqCiAgICAgKiBAcGFyYW0ge29iamVjdH0gUGx1Z2luIG9iamVjdAogICAgICogQHBhcmFtIHtvYmplY3R9IFtvcHRzXSBvYmplY3Qgd2l0aCBvcHRpb25zIHRvIGJlIHBhc3NlZCB0byBQbHVnaW4KICAgICAqIEByZXR1cm5zIHtvYmplY3R9IHNlbGYgZm9yIGNoYWluaW5nCiAgICAgKi8KICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1zaGFkb3cKCgogICAgdXNlKFBsdWdpbiwgb3B0cykgewogICAgICBpZiAodHlwZW9mIFBsdWdpbiAhPT0gJ2Z1bmN0aW9uJykgewogICAgICAgIGNvbnN0IG1zZyA9IGBFeHBlY3RlZCBhIHBsdWdpbiBjbGFzcywgYnV0IGdvdCAke1BsdWdpbiA9PT0gbnVsbCA/ICdudWxsJyA6IHR5cGVvZiBQbHVnaW59LmAgKyAnIFBsZWFzZSB2ZXJpZnkgdGhhdCB0aGUgcGx1Z2luIHdhcyBpbXBvcnRlZCBhbmQgc3BlbGxlZCBjb3JyZWN0bHkuJzsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKG1zZyk7CiAgICAgIH0gLy8gSW5zdGFudGlhdGUKCgogICAgICBjb25zdCBwbHVnaW4gPSBuZXcgUGx1Z2luKHRoaXMsIG9wdHMpOwogICAgICBjb25zdCBwbHVnaW5JZCA9IHBsdWdpbi5pZDsKCiAgICAgIGlmICghcGx1Z2luSWQpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1lvdXIgcGx1Z2luIG11c3QgaGF2ZSBhbiBpZCcpOwogICAgICB9CgogICAgICBpZiAoIXBsdWdpbi50eXBlKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdZb3VyIHBsdWdpbiBtdXN0IGhhdmUgYSB0eXBlJyk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGV4aXN0c1BsdWdpbkFscmVhZHkgPSB0aGlzLmdldFBsdWdpbihwbHVnaW5JZCk7CgogICAgICBpZiAoZXhpc3RzUGx1Z2luQWxyZWFkeSkgewogICAgICAgIGNvbnN0IG1zZyA9IGBBbHJlYWR5IGZvdW5kIGEgcGx1Z2luIG5hbWVkICcke2V4aXN0c1BsdWdpbkFscmVhZHkuaWR9Jy4gYCArIGBUcmllZCB0byB1c2U6ICcke3BsdWdpbklkfScuXG5gICsgJ1VwcHkgcGx1Z2lucyBtdXN0IGhhdmUgdW5pcXVlIGBpZGAgb3B0aW9ucy4gU2VlIGh0dHBzOi8vdXBweS5pby9kb2NzL3BsdWdpbnMvI2lkLic7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1zZyk7CiAgICAgIH0KCiAgICAgIGlmIChQbHVnaW4uVkVSU0lPTikgewogICAgICAgIHRoaXMubG9nKGBVc2luZyAke3BsdWdpbklkfSB2JHtQbHVnaW4uVkVSU0lPTn1gKTsKICAgICAgfQoKICAgICAgaWYgKHBsdWdpbi50eXBlIGluIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ2KHRoaXMsIF9wbHVnaW5zKVtfcGx1Z2luc10pIHsKICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkNih0aGlzLCBfcGx1Z2lucylbX3BsdWdpbnNdW3BsdWdpbi50eXBlXS5wdXNoKHBsdWdpbik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX3BsdWdpbnMpW19wbHVnaW5zXVtwbHVnaW4udHlwZV0gPSBbcGx1Z2luXTsKICAgICAgfQoKICAgICAgcGx1Z2luLmluc3RhbGwoKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEZpbmQgb25lIFBsdWdpbiBieSBuYW1lLgogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBpZCBwbHVnaW4gaWQKICAgICAqIEByZXR1cm5zIHtCYXNlUGx1Z2lufHVuZGVmaW5lZH0KICAgICAqLwoKCiAgICBnZXRQbHVnaW4oaWQpIHsKICAgICAgZm9yIChjb25zdCBwbHVnaW5zIG9mIE9iamVjdC52YWx1ZXMoX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX3BsdWdpbnMpW19wbHVnaW5zXSkpIHsKICAgICAgICBjb25zdCBmb3VuZFBsdWdpbiA9IHBsdWdpbnMuZmluZChwbHVnaW4gPT4gcGx1Z2luLmlkID09PSBpZCk7CiAgICAgICAgaWYgKGZvdW5kUGx1Z2luICE9IG51bGwpIHJldHVybiBmb3VuZFBsdWdpbjsKICAgICAgfQoKICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KCiAgICBbX1N5bWJvbCRmb3IkMV0odHlwZSkgewogICAgICByZXR1cm4gX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX3BsdWdpbnMpW19wbHVnaW5zXVt0eXBlXTsKICAgIH0KICAgIC8qKgogICAgICogSXRlcmF0ZSB0aHJvdWdoIGFsbCBgdXNlYGQgcGx1Z2lucy4KICAgICAqCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBtZXRob2QgdGhhdCB3aWxsIGJlIHJ1biBvbiBlYWNoIHBsdWdpbgogICAgICovCgoKICAgIGl0ZXJhdGVQbHVnaW5zKG1ldGhvZCkgewogICAgICBPYmplY3QudmFsdWVzKF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ2KHRoaXMsIF9wbHVnaW5zKVtfcGx1Z2luc10pLmZsYXQoMSkuZm9yRWFjaChtZXRob2QpOwogICAgfQogICAgLyoqCiAgICAgKiBVbmluc3RhbGwgYW5kIHJlbW92ZSBhIHBsdWdpbi4KICAgICAqCiAgICAgKiBAcGFyYW0ge29iamVjdH0gaW5zdGFuY2UgVGhlIHBsdWdpbiBpbnN0YW5jZSB0byByZW1vdmUuCiAgICAgKi8KCgogICAgcmVtb3ZlUGx1Z2luKGluc3RhbmNlKSB7CiAgICAgIHRoaXMubG9nKGBSZW1vdmluZyBwbHVnaW4gJHtpbnN0YW5jZS5pZH1gKTsKICAgICAgdGhpcy5lbWl0KCdwbHVnaW4tcmVtb3ZlJywgaW5zdGFuY2UpOwoKICAgICAgaWYgKGluc3RhbmNlLnVuaW5zdGFsbCkgewogICAgICAgIGluc3RhbmNlLnVuaW5zdGFsbCgpOwogICAgICB9CgogICAgICBjb25zdCBsaXN0ID0gX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX3BsdWdpbnMpW19wbHVnaW5zXVtpbnN0YW5jZS50eXBlXTsgLy8gbGlzdC5pbmRleE9mIGZhaWxlZCBoZXJlLCBiZWNhdXNlIFZ1ZTMgY29udmVydGVkIHRoZSBwbHVnaW4gaW5zdGFuY2UKICAgICAgLy8gdG8gYSBQcm94eSBvYmplY3QsIHdoaWNoIGZhaWxlZCB0aGUgc3RyaWN0IGNvbXBhcmlzb24gdGVzdDoKICAgICAgLy8gb2JqICE9PSBvYmpQcm94eQoKCiAgICAgIGNvbnN0IGluZGV4ID0gbGlzdC5maW5kSW5kZXgoaXRlbSA9PiBpdGVtLmlkID09PSBpbnN0YW5jZS5pZCk7CgogICAgICBpZiAoaW5kZXggIT09IC0xKSB7CiAgICAgICAgbGlzdC5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICBjb25zdCBzdGF0ZSA9IHRoaXMuZ2V0U3RhdGUoKTsKICAgICAgY29uc3QgdXBkYXRlZFN0YXRlID0gewogICAgICAgIHBsdWdpbnM6IHsgLi4uc3RhdGUucGx1Z2lucywKICAgICAgICAgIFtpbnN0YW5jZS5pZF06IHVuZGVmaW5lZAogICAgICAgIH0KICAgICAgfTsKICAgICAgdGhpcy5zZXRTdGF0ZSh1cGRhdGVkU3RhdGUpOwogICAgfQogICAgLyoqCiAgICAgKiBVbmluc3RhbGwgYWxsIHBsdWdpbnMgYW5kIGNsb3NlIGRvd24gdGhpcyBVcHB5IGluc3RhbmNlLgogICAgICovCgoKICAgIGNsb3NlKCkgewogICAgICB0aGlzLmxvZyhgQ2xvc2luZyBVcHB5IGluc3RhbmNlICR7dGhpcy5vcHRzLmlkfTogcmVtb3ZpbmcgYWxsIGZpbGVzIGFuZCB1bmluc3RhbGxpbmcgcGx1Z2luc2ApOwogICAgICB0aGlzLnJlc2V0KCk7CgogICAgICBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkNih0aGlzLCBfc3RvcmVVbnN1YnNjcmliZSlbX3N0b3JlVW5zdWJzY3JpYmVdKCk7CgogICAgICB0aGlzLml0ZXJhdGVQbHVnaW5zKHBsdWdpbiA9PiB7CiAgICAgICAgdGhpcy5yZW1vdmVQbHVnaW4ocGx1Z2luKTsKICAgICAgfSk7CgogICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIpIHsKICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignb25saW5lJywgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX3VwZGF0ZU9ubGluZVN0YXR1cylbX3VwZGF0ZU9ubGluZVN0YXR1c10pOwogICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdvZmZsaW5lJywgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX3VwZGF0ZU9ubGluZVN0YXR1cylbX3VwZGF0ZU9ubGluZVN0YXR1c10pOwogICAgICB9CiAgICB9CgogICAgaGlkZUluZm8oKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBpbmZvCiAgICAgIH0gPSB0aGlzLmdldFN0YXRlKCk7CiAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgIGluZm86IGluZm8uc2xpY2UoMSkKICAgICAgfSk7CiAgICAgIHRoaXMuZW1pdCgnaW5mby1oaWRkZW4nKTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IGluZm8gbWVzc2FnZSBpbiBgc3RhdGUuaW5mb2AsIHNvIHRoYXQgVUkgcGx1Z2lucyBsaWtlIGBJbmZvcm1lcmAKICAgICAqIGNhbiBkaXNwbGF5IHRoZSBtZXNzYWdlLgogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nIHwgb2JqZWN0fSBtZXNzYWdlIE1lc3NhZ2UgdG8gYmUgZGlzcGxheWVkIGJ5IHRoZSBpbmZvcm1lcgogICAgICogQHBhcmFtIHtzdHJpbmd9IFt0eXBlXQogICAgICogQHBhcmFtIHtudW1iZXJ9IFtkdXJhdGlvbl0KICAgICAqLwoKCiAgICBpbmZvKG1lc3NhZ2UsIHR5cGUsIGR1cmF0aW9uKSB7CiAgICAgIGlmICh0eXBlID09PSB2b2lkIDApIHsKICAgICAgICB0eXBlID0gJ2luZm8nOwogICAgICB9CgogICAgICBpZiAoZHVyYXRpb24gPT09IHZvaWQgMCkgewogICAgICAgIGR1cmF0aW9uID0gMzAwMDsKICAgICAgfQoKICAgICAgY29uc3QgaXNDb21wbGV4TWVzc2FnZSA9IHR5cGVvZiBtZXNzYWdlID09PSAnb2JqZWN0JzsKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgaW5mbzogWy4uLnRoaXMuZ2V0U3RhdGUoKS5pbmZvLCB7CiAgICAgICAgICB0eXBlLAogICAgICAgICAgbWVzc2FnZTogaXNDb21wbGV4TWVzc2FnZSA/IG1lc3NhZ2UubWVzc2FnZSA6IG1lc3NhZ2UsCiAgICAgICAgICBkZXRhaWxzOiBpc0NvbXBsZXhNZXNzYWdlID8gbWVzc2FnZS5kZXRhaWxzIDogbnVsbAogICAgICAgIH1dCiAgICAgIH0pOwogICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuaGlkZUluZm8oKSwgZHVyYXRpb24pOwogICAgICB0aGlzLmVtaXQoJ2luZm8tdmlzaWJsZScpOwogICAgfQogICAgLyoqCiAgICAgKiBQYXNzZXMgbWVzc2FnZXMgdG8gYSBmdW5jdGlvbiwgcHJvdmlkZWQgaW4gYG9wdHMubG9nZ2VyYC4KICAgICAqIElmIGBvcHRzLmxvZ2dlcjogVXBweS5kZWJ1Z0xvZ2dlcmAgb3IgYG9wdHMuZGVidWc6IHRydWVgLCBsb2dzIHRvIHRoZSBicm93c2VyIGNvbnNvbGUuCiAgICAgKgogICAgICogQHBhcmFtIHtzdHJpbmd8b2JqZWN0fSBtZXNzYWdlIHRvIGxvZwogICAgICogQHBhcmFtIHtzdHJpbmd9IFt0eXBlXSBvcHRpb25hbCBgZXJyb3JgIG9yIGB3YXJuaW5nYAogICAgICovCgoKICAgIGxvZyhtZXNzYWdlLCB0eXBlKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBsb2dnZXIKICAgICAgfSA9IHRoaXMub3B0czsKCiAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgIGNhc2UgJ2Vycm9yJzoKICAgICAgICAgIGxvZ2dlci5lcnJvcihtZXNzYWdlKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICd3YXJuaW5nJzoKICAgICAgICAgIGxvZ2dlci53YXJuKG1lc3NhZ2UpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBsb2dnZXIuZGVidWcobWVzc2FnZSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXN0b3JlIGFuIHVwbG9hZCBieSBpdHMgSUQuCiAgICAgKi8KCgogICAgcmVzdG9yZSh1cGxvYWRJRCkgewogICAgICB0aGlzLmxvZyhgQ29yZTogYXR0ZW1wdGluZyB0byByZXN0b3JlIHVwbG9hZCAiJHt1cGxvYWRJRH0iYCk7CgogICAgICBpZiAoIXRoaXMuZ2V0U3RhdGUoKS5jdXJyZW50VXBsb2Fkc1t1cGxvYWRJRF0pIHsKICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkNih0aGlzLCBfcmVtb3ZlVXBsb2FkKVtfcmVtb3ZlVXBsb2FkXSh1cGxvYWRJRCk7CgogICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoJ05vbmV4aXN0ZW50IHVwbG9hZCcpKTsKICAgICAgfQoKICAgICAgcmV0dXJuIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ2KHRoaXMsIF9ydW5VcGxvYWQpW19ydW5VcGxvYWRdKHVwbG9hZElEKTsKICAgIH0KICAgIC8qKgogICAgICogQ3JlYXRlIGFuIHVwbG9hZCBmb3IgYSBidW5jaCBvZiBmaWxlcy4KICAgICAqCiAgICAgKiBAcGFyYW0ge0FycmF5PHN0cmluZz59IGZpbGVJRHMgRmlsZSBJRHMgdG8gaW5jbHVkZSBpbiB0aGlzIHVwbG9hZC4KICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IElEIG9mIHRoaXMgdXBsb2FkLgogICAgICovCgoKICAgIFtfU3ltYm9sJGZvcjIkMV0oKSB7CiAgICAgIHJldHVybiBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkNih0aGlzLCBfY3JlYXRlVXBsb2FkKVtfY3JlYXRlVXBsb2FkXSguLi5hcmd1bWVudHMpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGRhdGEgdG8gYW4gdXBsb2FkJ3MgcmVzdWx0IG9iamVjdC4KICAgICAqCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXBsb2FkSUQgVGhlIElEIG9mIHRoZSB1cGxvYWQuCiAgICAgKiBAcGFyYW0ge29iamVjdH0gZGF0YSBEYXRhIHByb3BlcnRpZXMgdG8gYWRkIHRvIHRoZSByZXN1bHQgb2JqZWN0LgogICAgICovCiAgICBhZGRSZXN1bHREYXRhKHVwbG9hZElELCBkYXRhKSB7CiAgICAgIGlmICghX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX2dldFVwbG9hZClbX2dldFVwbG9hZF0odXBsb2FkSUQpKSB7CiAgICAgICAgdGhpcy5sb2coYE5vdCBzZXR0aW5nIHJlc3VsdCBmb3IgYW4gdXBsb2FkIHRoYXQgaGFzIGJlZW4gcmVtb3ZlZDogJHt1cGxvYWRJRH1gKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHsKICAgICAgICBjdXJyZW50VXBsb2FkcwogICAgICB9ID0gdGhpcy5nZXRTdGF0ZSgpOwogICAgICBjb25zdCBjdXJyZW50VXBsb2FkID0geyAuLi5jdXJyZW50VXBsb2Fkc1t1cGxvYWRJRF0sCiAgICAgICAgcmVzdWx0OiB7IC4uLmN1cnJlbnRVcGxvYWRzW3VwbG9hZElEXS5yZXN1bHQsCiAgICAgICAgICAuLi5kYXRhCiAgICAgICAgfQogICAgICB9OwogICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICBjdXJyZW50VXBsb2FkczogeyAuLi5jdXJyZW50VXBsb2FkcywKICAgICAgICAgIFt1cGxvYWRJRF06IGN1cnJlbnRVcGxvYWQKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYW4gdXBsb2FkLCBlZy4gaWYgaXQgaGFzIGJlZW4gY2FuY2VsZWQgb3IgY29tcGxldGVkLgogICAgICoKICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cGxvYWRJRCBUaGUgSUQgb2YgdGhlIHVwbG9hZC4KICAgICAqLwoKCiAgICAvKioKICAgICAqIFN0YXJ0IGFuIHVwbG9hZCBmb3IgYWxsIHRoZSBmaWxlcyB0aGF0IGFyZSBub3QgY3VycmVudGx5IGJlaW5nIHVwbG9hZGVkLgogICAgICoKICAgICAqIEByZXR1cm5zIHtQcm9taXNlfQogICAgICovCiAgICB1cGxvYWQoKSB7CiAgICAgIHZhciBfY2xhc3NQcml2YXRlRmllbGRMb287CgogICAgICBpZiAoISgoX2NsYXNzUHJpdmF0ZUZpZWxkTG9vID0gX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX3BsdWdpbnMpW19wbHVnaW5zXS51cGxvYWRlcikgIT0gbnVsbCAmJiBfY2xhc3NQcml2YXRlRmllbGRMb28ubGVuZ3RoKSkgewogICAgICAgIHRoaXMubG9nKCdObyB1cGxvYWRlciB0eXBlIHBsdWdpbnMgYXJlIHVzZWQnLCAnd2FybmluZycpOwogICAgICB9CgogICAgICBsZXQgewogICAgICAgIGZpbGVzCiAgICAgIH0gPSB0aGlzLmdldFN0YXRlKCk7CiAgICAgIGNvbnN0IG9uQmVmb3JlVXBsb2FkUmVzdWx0ID0gdGhpcy5vcHRzLm9uQmVmb3JlVXBsb2FkKGZpbGVzKTsKCiAgICAgIGlmIChvbkJlZm9yZVVwbG9hZFJlc3VsdCA9PT0gZmFsc2UpIHsKICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKCdOb3Qgc3RhcnRpbmcgdGhlIHVwbG9hZCBiZWNhdXNlIG9uQmVmb3JlVXBsb2FkIHJldHVybmVkIGZhbHNlJykpOwogICAgICB9CgogICAgICBpZiAob25CZWZvcmVVcGxvYWRSZXN1bHQgJiYgdHlwZW9mIG9uQmVmb3JlVXBsb2FkUmVzdWx0ID09PSAnb2JqZWN0JykgewogICAgICAgIGZpbGVzID0gb25CZWZvcmVVcGxvYWRSZXN1bHQ7IC8vIFVwZGF0aW5nIGZpbGVzIGluIHN0YXRlLCBiZWNhdXNlIHVwbG9hZGVyIHBsdWdpbnMgcmVjZWl2ZSBmaWxlIElEcywKICAgICAgICAvLyBhbmQgdGhlbiBmZXRjaCB0aGUgYWN0dWFsIGZpbGUgb2JqZWN0IGZyb20gc3RhdGUKCiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICBmaWxlcwogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCkudGhlbigoKSA9PiB7CiAgICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX2NoZWNrTWluTnVtYmVyT2ZGaWxlcylbX2NoZWNrTWluTnVtYmVyT2ZGaWxlc10oZmlsZXMpOwoKICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkNih0aGlzLCBfY2hlY2tSZXF1aXJlZE1ldGFGaWVsZHMpW19jaGVja1JlcXVpcmVkTWV0YUZpZWxkc10oZmlsZXMpOwogICAgICB9KS5jYXRjaChlcnIgPT4gewogICAgICAgIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ2KHRoaXMsIF9zaG93T3JMb2dFcnJvckFuZFRocm93KVtfc2hvd09yTG9nRXJyb3JBbmRUaHJvd10oZXJyKTsKICAgICAgfSkudGhlbigoKSA9PiB7CiAgICAgICAgY29uc3QgewogICAgICAgICAgY3VycmVudFVwbG9hZHMKICAgICAgICB9ID0gdGhpcy5nZXRTdGF0ZSgpOyAvLyBnZXQgYSBsaXN0IG9mIGZpbGVzIHRoYXQgYXJlIGN1cnJlbnRseSBhc3NpZ25lZCB0byB1cGxvYWRzCgogICAgICAgIGNvbnN0IGN1cnJlbnRseVVwbG9hZGluZ0ZpbGVzID0gT2JqZWN0LnZhbHVlcyhjdXJyZW50VXBsb2FkcykuZmxhdE1hcChjdXJyID0+IGN1cnIuZmlsZUlEcyk7CiAgICAgICAgY29uc3Qgd2FpdGluZ0ZpbGVJRHMgPSBbXTsKICAgICAgICBPYmplY3Qua2V5cyhmaWxlcykuZm9yRWFjaChmaWxlSUQgPT4gewogICAgICAgICAgY29uc3QgZmlsZSA9IHRoaXMuZ2V0RmlsZShmaWxlSUQpOyAvLyBpZiB0aGUgZmlsZSBoYXNuJ3Qgc3RhcnRlZCB1cGxvYWRpbmcgYW5kIGhhc24ndCBhbHJlYWR5IGJlZW4gYXNzaWduZWQgdG8gYW4gdXBsb2FkLi4KCiAgICAgICAgICBpZiAoIWZpbGUucHJvZ3Jlc3MudXBsb2FkU3RhcnRlZCAmJiBjdXJyZW50bHlVcGxvYWRpbmdGaWxlcy5pbmRleE9mKGZpbGVJRCkgPT09IC0xKSB7CiAgICAgICAgICAgIHdhaXRpbmdGaWxlSURzLnB1c2goZmlsZS5pZCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGNvbnN0IHVwbG9hZElEID0gX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX2NyZWF0ZVVwbG9hZClbX2NyZWF0ZVVwbG9hZF0od2FpdGluZ0ZpbGVJRHMpOwoKICAgICAgICByZXR1cm4gX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX3J1blVwbG9hZClbX3J1blVwbG9hZF0odXBsb2FkSUQpOwogICAgICB9KS5jYXRjaChlcnIgPT4gewogICAgICAgIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ2KHRoaXMsIF9zaG93T3JMb2dFcnJvckFuZFRocm93KVtfc2hvd09yTG9nRXJyb3JBbmRUaHJvd10oZXJyLCB7CiAgICAgICAgICBzaG93SW5mb3JtZXI6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQoKICB9CgogIGZ1bmN0aW9uIF9jaGVja1Jlc3RyaWN0aW9uczIoZmlsZSwgZmlsZXMpIHsKICAgIGlmIChmaWxlcyA9PT0gdm9pZCAwKSB7CiAgICAgIGZpbGVzID0gdGhpcy5nZXRGaWxlcygpOwogICAgfQoKICAgIGNvbnN0IHsKICAgICAgbWF4RmlsZVNpemUsCiAgICAgIG1pbkZpbGVTaXplLAogICAgICBtYXhUb3RhbEZpbGVTaXplLAogICAgICBtYXhOdW1iZXJPZkZpbGVzLAogICAgICBhbGxvd2VkRmlsZVR5cGVzCiAgICB9ID0gdGhpcy5vcHRzLnJlc3RyaWN0aW9uczsKCiAgICBpZiAobWF4TnVtYmVyT2ZGaWxlcykgewogICAgICBpZiAoZmlsZXMubGVuZ3RoICsgMSA+IG1heE51bWJlck9mRmlsZXMpIHsKICAgICAgICB0aHJvdyBuZXcgUmVzdHJpY3Rpb25FcnJvcihgJHt0aGlzLmkxOG4oJ3lvdUNhbk9ubHlVcGxvYWRYJywgewogICAgICAgIHNtYXJ0X2NvdW50OiBtYXhOdW1iZXJPZkZpbGVzCiAgICAgIH0pfWApOwogICAgICB9CiAgICB9CgogICAgaWYgKGFsbG93ZWRGaWxlVHlwZXMpIHsKICAgICAgY29uc3QgaXNDb3JyZWN0RmlsZVR5cGUgPSBhbGxvd2VkRmlsZVR5cGVzLnNvbWUodHlwZSA9PiB7CiAgICAgICAgLy8gY2hlY2sgaWYgdGhpcyBpcyBhIG1pbWUtdHlwZQogICAgICAgIGlmICh0eXBlLmluZGV4T2YoJy8nKSA+IC0xKSB7CiAgICAgICAgICBpZiAoIWZpbGUudHlwZSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgcmV0dXJuIG1pbWVNYXRjaChmaWxlLnR5cGUucmVwbGFjZSgvOy4qPyQvLCAnJyksIHR5cGUpOwogICAgICAgIH0gLy8gb3RoZXJ3aXNlIHRoaXMgaXMgbGlrZWx5IGFuIGV4dGVuc2lvbgoKCiAgICAgICAgaWYgKHR5cGVbMF0gPT09ICcuJyAmJiBmaWxlLmV4dGVuc2lvbikgewogICAgICAgICAgcmV0dXJuIGZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCkgPT09IHR5cGUuc3Vic3RyKDEpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0pOwoKICAgICAgaWYgKCFpc0NvcnJlY3RGaWxlVHlwZSkgewogICAgICAgIGNvbnN0IGFsbG93ZWRGaWxlVHlwZXNTdHJpbmcgPSBhbGxvd2VkRmlsZVR5cGVzLmpvaW4oJywgJyk7CiAgICAgICAgdGhyb3cgbmV3IFJlc3RyaWN0aW9uRXJyb3IodGhpcy5pMThuKCd5b3VDYW5Pbmx5VXBsb2FkRmlsZVR5cGVzJywgewogICAgICAgICAgdHlwZXM6IGFsbG93ZWRGaWxlVHlwZXNTdHJpbmcKICAgICAgICB9KSk7CiAgICAgIH0KICAgIH0gLy8gV2UgY2FuJ3QgY2hlY2sgbWF4VG90YWxGaWxlU2l6ZSBpZiB0aGUgc2l6ZSBpcyB1bmtub3duLgoKCiAgICBpZiAobWF4VG90YWxGaWxlU2l6ZSAmJiBmaWxlLnNpemUgIT0gbnVsbCkgewogICAgICBsZXQgdG90YWxGaWxlc1NpemUgPSAwOwogICAgICB0b3RhbEZpbGVzU2l6ZSArPSBmaWxlLnNpemU7CiAgICAgIGZpbGVzLmZvckVhY2goZiA9PiB7CiAgICAgICAgdG90YWxGaWxlc1NpemUgKz0gZi5zaXplOwogICAgICB9KTsKCiAgICAgIGlmICh0b3RhbEZpbGVzU2l6ZSA+IG1heFRvdGFsRmlsZVNpemUpIHsKICAgICAgICB0aHJvdyBuZXcgUmVzdHJpY3Rpb25FcnJvcih0aGlzLmkxOG4oJ2V4Y2VlZHNTaXplJywgewogICAgICAgICAgc2l6ZTogcHJldHRpZXJCeXRlcyhtYXhUb3RhbEZpbGVTaXplKSwKICAgICAgICAgIGZpbGU6IGZpbGUubmFtZQogICAgICAgIH0pKTsKICAgICAgfQogICAgfSAvLyBXZSBjYW4ndCBjaGVjayBtYXhGaWxlU2l6ZSBpZiB0aGUgc2l6ZSBpcyB1bmtub3duLgoKCiAgICBpZiAobWF4RmlsZVNpemUgJiYgZmlsZS5zaXplICE9IG51bGwpIHsKICAgICAgaWYgKGZpbGUuc2l6ZSA+IG1heEZpbGVTaXplKSB7CiAgICAgICAgdGhyb3cgbmV3IFJlc3RyaWN0aW9uRXJyb3IodGhpcy5pMThuKCdleGNlZWRzU2l6ZScsIHsKICAgICAgICAgIHNpemU6IHByZXR0aWVyQnl0ZXMobWF4RmlsZVNpemUpLAogICAgICAgICAgZmlsZTogZmlsZS5uYW1lCiAgICAgICAgfSkpOwogICAgICB9CiAgICB9IC8vIFdlIGNhbid0IGNoZWNrIG1pbkZpbGVTaXplIGlmIHRoZSBzaXplIGlzIHVua25vd24uCgoKICAgIGlmIChtaW5GaWxlU2l6ZSAmJiBmaWxlLnNpemUgIT0gbnVsbCkgewogICAgICBpZiAoZmlsZS5zaXplIDwgbWluRmlsZVNpemUpIHsKICAgICAgICB0aHJvdyBuZXcgUmVzdHJpY3Rpb25FcnJvcih0aGlzLmkxOG4oJ2luZmVyaW9yU2l6ZScsIHsKICAgICAgICAgIHNpemU6IHByZXR0aWVyQnl0ZXMobWluRmlsZVNpemUpCiAgICAgICAgfSkpOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBfY2hlY2tNaW5OdW1iZXJPZkZpbGVzMihmaWxlcykgewogICAgY29uc3QgewogICAgICBtaW5OdW1iZXJPZkZpbGVzCiAgICB9ID0gdGhpcy5vcHRzLnJlc3RyaWN0aW9uczsKCiAgICBpZiAoT2JqZWN0LmtleXMoZmlsZXMpLmxlbmd0aCA8IG1pbk51bWJlck9mRmlsZXMpIHsKICAgICAgdGhyb3cgbmV3IFJlc3RyaWN0aW9uRXJyb3IoYCR7dGhpcy5pMThuKCd5b3VIYXZlVG9BdExlYXN0U2VsZWN0WCcsIHsKICAgICAgc21hcnRfY291bnQ6IG1pbk51bWJlck9mRmlsZXMKICAgIH0pfWApOwogICAgfQogIH0KCiAgZnVuY3Rpb24gX2NoZWNrUmVxdWlyZWRNZXRhRmllbGRzT25GaWxlMihmaWxlKSB7CiAgICBjb25zdCB7CiAgICAgIHJlcXVpcmVkTWV0YUZpZWxkcwogICAgfSA9IHRoaXMub3B0cy5yZXN0cmljdGlvbnM7CiAgICBjb25zdCB7CiAgICAgIGhhc093blByb3BlcnR5CiAgICB9ID0gT2JqZWN0LnByb3RvdHlwZTsKICAgIGNvbnN0IGVycm9ycyA9IFtdOwogICAgY29uc3QgbWlzc2luZ0ZpZWxkcyA9IFtdOwoKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVxdWlyZWRNZXRhRmllbGRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmICghaGFzT3duUHJvcGVydHkuY2FsbChmaWxlLm1ldGEsIHJlcXVpcmVkTWV0YUZpZWxkc1tpXSkgfHwgZmlsZS5tZXRhW3JlcXVpcmVkTWV0YUZpZWxkc1tpXV0gPT09ICcnKSB7CiAgICAgICAgY29uc3QgZXJyID0gbmV3IFJlc3RyaWN0aW9uRXJyb3IoYCR7dGhpcy5pMThuKCdtaXNzaW5nUmVxdWlyZWRNZXRhRmllbGRPbkZpbGUnLCB7CiAgICAgICAgZmlsZU5hbWU6IGZpbGUubmFtZQogICAgICB9KX1gKTsKICAgICAgICBlcnJvcnMucHVzaChlcnIpOwogICAgICAgIG1pc3NpbmdGaWVsZHMucHVzaChyZXF1aXJlZE1ldGFGaWVsZHNbaV0pOwoKICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkNih0aGlzLCBfc2hvd09yTG9nRXJyb3JBbmRUaHJvdylbX3Nob3dPckxvZ0Vycm9yQW5kVGhyb3ddKGVyciwgewogICAgICAgICAgZmlsZSwKICAgICAgICAgIHNob3dJbmZvcm1lcjogZmFsc2UsCiAgICAgICAgICB0aHJvd0VycjogZmFsc2UKICAgICAgICB9KTsKICAgICAgfQogICAgfQoKICAgIHRoaXMuc2V0RmlsZVN0YXRlKGZpbGUuaWQsIHsKICAgICAgbWlzc2luZ1JlcXVpcmVkTWV0YUZpZWxkczogbWlzc2luZ0ZpZWxkcwogICAgfSk7CiAgICByZXR1cm4gZXJyb3JzOwogIH0KCiAgZnVuY3Rpb24gX2NoZWNrUmVxdWlyZWRNZXRhRmllbGRzMihmaWxlcykgewogICAgY29uc3QgZXJyb3JzID0gT2JqZWN0LmtleXMoZmlsZXMpLmZsYXRNYXAoZmlsZUlEID0+IHsKICAgICAgY29uc3QgZmlsZSA9IHRoaXMuZ2V0RmlsZShmaWxlSUQpOwogICAgICByZXR1cm4gX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX2NoZWNrUmVxdWlyZWRNZXRhRmllbGRzT25GaWxlKVtfY2hlY2tSZXF1aXJlZE1ldGFGaWVsZHNPbkZpbGVdKGZpbGUpOwogICAgfSk7CgogICAgaWYgKGVycm9ycy5sZW5ndGgpIHsKICAgICAgdGhyb3cgbmV3IEFnZ3JlZ2F0ZVJlc3RyaWN0aW9uRXJyb3IoZXJyb3JzLCBgJHt0aGlzLmkxOG4oJ21pc3NpbmdSZXF1aXJlZE1ldGFGaWVsZCcpfWApOwogICAgfQogIH0KCiAgZnVuY3Rpb24gX3Nob3dPckxvZ0Vycm9yQW5kVGhyb3cyKGVyciwgX3RlbXApIHsKICAgIGxldCB7CiAgICAgIHNob3dJbmZvcm1lciA9IHRydWUsCiAgICAgIGZpbGUgPSBudWxsLAogICAgICB0aHJvd0VyciA9IHRydWUKICAgIH0gPSBfdGVtcCA9PT0gdm9pZCAwID8ge30gOiBfdGVtcDsKICAgIGNvbnN0IG1lc3NhZ2UgPSB0eXBlb2YgZXJyID09PSAnb2JqZWN0JyA/IGVyci5tZXNzYWdlIDogZXJyOwogICAgY29uc3QgZGV0YWlscyA9IHR5cGVvZiBlcnIgPT09ICdvYmplY3QnICYmIGVyci5kZXRhaWxzID8gZXJyLmRldGFpbHMgOiAnJzsgLy8gUmVzdHJpY3Rpb24gZXJyb3JzIHNob3VsZCBiZSBsb2dnZWQsIGJ1dCBub3QgYXMgZXJyb3JzLAogICAgLy8gYXMgdGhleSBhcmUgZXhwZWN0ZWQgYW5kIHNob3duIGluIHRoZSBVSS4KCiAgICBsZXQgbG9nTWVzc2FnZVdpdGhEZXRhaWxzID0gbWVzc2FnZTsKCiAgICBpZiAoZGV0YWlscykgewogICAgICBsb2dNZXNzYWdlV2l0aERldGFpbHMgKz0gYCAke2RldGFpbHN9YDsKICAgIH0KCiAgICBpZiAoZXJyLmlzUmVzdHJpY3Rpb24pIHsKICAgICAgdGhpcy5sb2cobG9nTWVzc2FnZVdpdGhEZXRhaWxzKTsKICAgICAgdGhpcy5lbWl0KCdyZXN0cmljdGlvbi1mYWlsZWQnLCBmaWxlLCBlcnIpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5sb2cobG9nTWVzc2FnZVdpdGhEZXRhaWxzLCAnZXJyb3InKTsKICAgIH0gLy8gU29tZXRpbWVzIGluZm9ybWVyIGhhcyB0byBiZSBzaG93biBtYW51YWxseSBieSB0aGUgZGV2ZWxvcGVyLAogICAgLy8gZm9yIGV4YW1wbGUsIGluIGBvbkJlZm9yZUZpbGVBZGRlZGAuCgoKICAgIGlmIChzaG93SW5mb3JtZXIpIHsKICAgICAgdGhpcy5pbmZvKHsKICAgICAgICBtZXNzYWdlLAogICAgICAgIGRldGFpbHMKICAgICAgfSwgJ2Vycm9yJywgdGhpcy5vcHRzLmluZm9UaW1lb3V0KTsKICAgIH0KCiAgICBpZiAodGhyb3dFcnIpIHsKICAgICAgdGhyb3cgdHlwZW9mIGVyciA9PT0gJ29iamVjdCcgPyBlcnIgOiBuZXcgRXJyb3IoZXJyKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIF9hc3NlcnROZXdVcGxvYWRBbGxvd2VkMihmaWxlKSB7CiAgICBjb25zdCB7CiAgICAgIGFsbG93TmV3VXBsb2FkCiAgICB9ID0gdGhpcy5nZXRTdGF0ZSgpOwoKICAgIGlmIChhbGxvd05ld1VwbG9hZCA9PT0gZmFsc2UpIHsKICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX3Nob3dPckxvZ0Vycm9yQW5kVGhyb3cpW19zaG93T3JMb2dFcnJvckFuZFRocm93XShuZXcgUmVzdHJpY3Rpb25FcnJvcih0aGlzLmkxOG4oJ25vTW9yZUZpbGVzQWxsb3dlZCcpKSwgewogICAgICAgIGZpbGUKICAgICAgfSk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBfY2hlY2tBbmRDcmVhdGVGaWxlU3RhdGVPYmplY3QyKGZpbGVzLCBmaWxlRGVzY3JpcHRvcikgewogICAgY29uc3QgZmlsZVR5cGUgPSBnZXRGaWxlVHlwZShmaWxlRGVzY3JpcHRvcik7CiAgICBjb25zdCBmaWxlTmFtZSA9IGdldEZpbGVOYW1lKGZpbGVUeXBlLCBmaWxlRGVzY3JpcHRvcik7CiAgICBjb25zdCBmaWxlRXh0ZW5zaW9uID0gZ2V0RmlsZU5hbWVBbmRFeHRlbnNpb24oZmlsZU5hbWUpLmV4dGVuc2lvbjsKICAgIGNvbnN0IGlzUmVtb3RlID0gQm9vbGVhbihmaWxlRGVzY3JpcHRvci5pc1JlbW90ZSk7CiAgICBjb25zdCBmaWxlSUQgPSBnZW5lcmF0ZUZpbGVJRCh7IC4uLmZpbGVEZXNjcmlwdG9yLAogICAgICB0eXBlOiBmaWxlVHlwZQogICAgfSk7CgogICAgaWYgKHRoaXMuY2hlY2tJZkZpbGVBbHJlYWR5RXhpc3RzKGZpbGVJRCkpIHsKICAgICAgY29uc3QgZXJyb3IgPSBuZXcgUmVzdHJpY3Rpb25FcnJvcih0aGlzLmkxOG4oJ25vRHVwbGljYXRlcycsIHsKICAgICAgICBmaWxlTmFtZQogICAgICB9KSk7CgogICAgICBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkNih0aGlzLCBfc2hvd09yTG9nRXJyb3JBbmRUaHJvdylbX3Nob3dPckxvZ0Vycm9yQW5kVGhyb3ddKGVycm9yLCB7CiAgICAgICAgZmlsZTogZmlsZURlc2NyaXB0b3IKICAgICAgfSk7CiAgICB9CgogICAgY29uc3QgbWV0YSA9IGZpbGVEZXNjcmlwdG9yLm1ldGEgfHwge307CiAgICBtZXRhLm5hbWUgPSBmaWxlTmFtZTsKICAgIG1ldGEudHlwZSA9IGZpbGVUeXBlOyAvLyBgbnVsbGAgbWVhbnMgdGhlIHNpemUgaXMgdW5rbm93bi4KCiAgICBjb25zdCBzaXplID0gTnVtYmVyLmlzRmluaXRlKGZpbGVEZXNjcmlwdG9yLmRhdGEuc2l6ZSkgPyBmaWxlRGVzY3JpcHRvci5kYXRhLnNpemUgOiBudWxsOwogICAgbGV0IG5ld0ZpbGUgPSB7CiAgICAgIHNvdXJjZTogZmlsZURlc2NyaXB0b3Iuc291cmNlIHx8ICcnLAogICAgICBpZDogZmlsZUlELAogICAgICBuYW1lOiBmaWxlTmFtZSwKICAgICAgZXh0ZW5zaW9uOiBmaWxlRXh0ZW5zaW9uIHx8ICcnLAogICAgICBtZXRhOiB7IC4uLnRoaXMuZ2V0U3RhdGUoKS5tZXRhLAogICAgICAgIC4uLm1ldGEKICAgICAgfSwKICAgICAgdHlwZTogZmlsZVR5cGUsCiAgICAgIGRhdGE6IGZpbGVEZXNjcmlwdG9yLmRhdGEsCiAgICAgIHByb2dyZXNzOiB7CiAgICAgICAgcGVyY2VudGFnZTogMCwKICAgICAgICBieXRlc1VwbG9hZGVkOiAwLAogICAgICAgIGJ5dGVzVG90YWw6IHNpemUsCiAgICAgICAgdXBsb2FkQ29tcGxldGU6IGZhbHNlLAogICAgICAgIHVwbG9hZFN0YXJ0ZWQ6IG51bGwKICAgICAgfSwKICAgICAgc2l6ZSwKICAgICAgaXNSZW1vdGUsCiAgICAgIHJlbW90ZTogZmlsZURlc2NyaXB0b3IucmVtb3RlIHx8ICcnLAogICAgICBwcmV2aWV3OiBmaWxlRGVzY3JpcHRvci5wcmV2aWV3CiAgICB9OwogICAgY29uc3Qgb25CZWZvcmVGaWxlQWRkZWRSZXN1bHQgPSB0aGlzLm9wdHMub25CZWZvcmVGaWxlQWRkZWQobmV3RmlsZSwgZmlsZXMpOwoKICAgIGlmIChvbkJlZm9yZUZpbGVBZGRlZFJlc3VsdCA9PT0gZmFsc2UpIHsKICAgICAgLy8gRG9u4oCZdCBzaG93IFVJIGluZm8gZm9yIHRoaXMgZXJyb3IsIGFzIGl0IHNob3VsZCBiZSBkb25lIGJ5IHRoZSBkZXZlbG9wZXIKICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX3Nob3dPckxvZ0Vycm9yQW5kVGhyb3cpW19zaG93T3JMb2dFcnJvckFuZFRocm93XShuZXcgUmVzdHJpY3Rpb25FcnJvcignQ2Fubm90IGFkZCB0aGUgZmlsZSBiZWNhdXNlIG9uQmVmb3JlRmlsZUFkZGVkIHJldHVybmVkIGZhbHNlLicpLCB7CiAgICAgICAgc2hvd0luZm9ybWVyOiBmYWxzZSwKICAgICAgICBmaWxlRGVzY3JpcHRvcgogICAgICB9KTsKICAgIH0gZWxzZSBpZiAodHlwZW9mIG9uQmVmb3JlRmlsZUFkZGVkUmVzdWx0ID09PSAnb2JqZWN0JyAmJiBvbkJlZm9yZUZpbGVBZGRlZFJlc3VsdCAhPT0gbnVsbCkgewogICAgICBuZXdGaWxlID0gb25CZWZvcmVGaWxlQWRkZWRSZXN1bHQ7CiAgICB9CgogICAgdHJ5IHsKICAgICAgY29uc3QgZmlsZXNBcnJheSA9IE9iamVjdC5rZXlzKGZpbGVzKS5tYXAoaSA9PiBmaWxlc1tpXSk7CgogICAgICBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkNih0aGlzLCBfY2hlY2tSZXN0cmljdGlvbnMpW19jaGVja1Jlc3RyaWN0aW9uc10obmV3RmlsZSwgZmlsZXNBcnJheSk7CiAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX3Nob3dPckxvZ0Vycm9yQW5kVGhyb3cpW19zaG93T3JMb2dFcnJvckFuZFRocm93XShlcnIsIHsKICAgICAgICBmaWxlOiBuZXdGaWxlCiAgICAgIH0pOwogICAgfQoKICAgIHJldHVybiBuZXdGaWxlOwogIH0KCiAgZnVuY3Rpb24gX3N0YXJ0SWZBdXRvUHJvY2VlZDIoKSB7CiAgICBpZiAodGhpcy5vcHRzLmF1dG9Qcm9jZWVkICYmICF0aGlzLnNjaGVkdWxlZEF1dG9Qcm9jZWVkKSB7CiAgICAgIHRoaXMuc2NoZWR1bGVkQXV0b1Byb2NlZWQgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICB0aGlzLnNjaGVkdWxlZEF1dG9Qcm9jZWVkID0gbnVsbDsKICAgICAgICB0aGlzLnVwbG9hZCgpLmNhdGNoKGVyciA9PiB7CiAgICAgICAgICBpZiAoIWVyci5pc1Jlc3RyaWN0aW9uKSB7CiAgICAgICAgICAgIHRoaXMubG9nKGVyci5zdGFjayB8fCBlcnIubWVzc2FnZSB8fCBlcnIpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9LCA0KTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIF9hZGRMaXN0ZW5lcnMyKCkgewogICAgLyoqCiAgICAgKiBAcGFyYW0ge0Vycm9yfSBlcnJvcgogICAgICogQHBhcmFtIHtvYmplY3R9IFtmaWxlXQogICAgICogQHBhcmFtIHtvYmplY3R9IFtyZXNwb25zZV0KICAgICAqLwogICAgY29uc3QgZXJyb3JIYW5kbGVyID0gKGVycm9yLCBmaWxlLCByZXNwb25zZSkgPT4gewogICAgICBsZXQgZXJyb3JNc2cgPSBlcnJvci5tZXNzYWdlIHx8ICdVbmtub3duIGVycm9yJzsKCiAgICAgIGlmIChlcnJvci5kZXRhaWxzKSB7CiAgICAgICAgZXJyb3JNc2cgKz0gYCAke2Vycm9yLmRldGFpbHN9YDsKICAgICAgfQoKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgZXJyb3I6IGVycm9yTXNnCiAgICAgIH0pOwoKICAgICAgaWYgKGZpbGUgIT0gbnVsbCAmJiBmaWxlLmlkIGluIHRoaXMuZ2V0U3RhdGUoKS5maWxlcykgewogICAgICAgIHRoaXMuc2V0RmlsZVN0YXRlKGZpbGUuaWQsIHsKICAgICAgICAgIGVycm9yOiBlcnJvck1zZywKICAgICAgICAgIHJlc3BvbnNlCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH07CgogICAgdGhpcy5vbignZXJyb3InLCBlcnJvckhhbmRsZXIpOwogICAgdGhpcy5vbigndXBsb2FkLWVycm9yJywgKGZpbGUsIGVycm9yLCByZXNwb25zZSkgPT4gewogICAgICBlcnJvckhhbmRsZXIoZXJyb3IsIGZpbGUsIHJlc3BvbnNlKTsKCiAgICAgIGlmICh0eXBlb2YgZXJyb3IgPT09ICdvYmplY3QnICYmIGVycm9yLm1lc3NhZ2UpIHsKICAgICAgICBjb25zdCBuZXdFcnJvciA9IG5ldyBFcnJvcihlcnJvci5tZXNzYWdlKTsKICAgICAgICBuZXdFcnJvci5kZXRhaWxzID0gZXJyb3IubWVzc2FnZTsKCiAgICAgICAgaWYgKGVycm9yLmRldGFpbHMpIHsKICAgICAgICAgIG5ld0Vycm9yLmRldGFpbHMgKz0gYCAke2Vycm9yLmRldGFpbHN9YDsKICAgICAgICB9CgogICAgICAgIG5ld0Vycm9yLm1lc3NhZ2UgPSB0aGlzLmkxOG4oJ2ZhaWxlZFRvVXBsb2FkJywgewogICAgICAgICAgZmlsZTogZmlsZS5uYW1lCiAgICAgICAgfSk7CgogICAgICAgIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ2KHRoaXMsIF9zaG93T3JMb2dFcnJvckFuZFRocm93KVtfc2hvd09yTG9nRXJyb3JBbmRUaHJvd10obmV3RXJyb3IsIHsKICAgICAgICAgIHRocm93RXJyOiBmYWxzZQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ2KHRoaXMsIF9zaG93T3JMb2dFcnJvckFuZFRocm93KVtfc2hvd09yTG9nRXJyb3JBbmRUaHJvd10oZXJyb3IsIHsKICAgICAgICAgIHRocm93RXJyOiBmYWxzZQogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKICAgIHRoaXMub24oJ3VwbG9hZCcsICgpID0+IHsKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgZXJyb3I6IG51bGwKICAgICAgfSk7CiAgICB9KTsKICAgIHRoaXMub24oJ3VwbG9hZC1zdGFydGVkJywgZmlsZSA9PiB7CiAgICAgIGlmICghdGhpcy5nZXRGaWxlKGZpbGUuaWQpKSB7CiAgICAgICAgdGhpcy5sb2coYE5vdCBzZXR0aW5nIHByb2dyZXNzIGZvciBhIGZpbGUgdGhhdCBoYXMgYmVlbiByZW1vdmVkOiAke2ZpbGUuaWR9YCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLnNldEZpbGVTdGF0ZShmaWxlLmlkLCB7CiAgICAgICAgcHJvZ3Jlc3M6IHsKICAgICAgICAgIHVwbG9hZFN0YXJ0ZWQ6IERhdGUubm93KCksCiAgICAgICAgICB1cGxvYWRDb21wbGV0ZTogZmFsc2UsCiAgICAgICAgICBwZXJjZW50YWdlOiAwLAogICAgICAgICAgYnl0ZXNVcGxvYWRlZDogMCwKICAgICAgICAgIGJ5dGVzVG90YWw6IGZpbGUuc2l6ZQogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKICAgIHRoaXMub24oJ3VwbG9hZC1wcm9ncmVzcycsIHRoaXMuY2FsY3VsYXRlUHJvZ3Jlc3MpOwogICAgdGhpcy5vbigndXBsb2FkLXN1Y2Nlc3MnLCAoZmlsZSwgdXBsb2FkUmVzcCkgPT4gewogICAgICBpZiAoIXRoaXMuZ2V0RmlsZShmaWxlLmlkKSkgewogICAgICAgIHRoaXMubG9nKGBOb3Qgc2V0dGluZyBwcm9ncmVzcyBmb3IgYSBmaWxlIHRoYXQgaGFzIGJlZW4gcmVtb3ZlZDogJHtmaWxlLmlkfWApOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgY3VycmVudFByb2dyZXNzID0gdGhpcy5nZXRGaWxlKGZpbGUuaWQpLnByb2dyZXNzOwogICAgICB0aGlzLnNldEZpbGVTdGF0ZShmaWxlLmlkLCB7CiAgICAgICAgcHJvZ3Jlc3M6IHsgLi4uY3VycmVudFByb2dyZXNzLAogICAgICAgICAgcG9zdHByb2Nlc3M6IF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ2KHRoaXMsIF9wb3N0UHJvY2Vzc29ycylbX3Bvc3RQcm9jZXNzb3JzXS5zaXplID4gMCA/IHsKICAgICAgICAgICAgbW9kZTogJ2luZGV0ZXJtaW5hdGUnCiAgICAgICAgICB9IDogbnVsbCwKICAgICAgICAgIHVwbG9hZENvbXBsZXRlOiB0cnVlLAogICAgICAgICAgcGVyY2VudGFnZTogMTAwLAogICAgICAgICAgYnl0ZXNVcGxvYWRlZDogY3VycmVudFByb2dyZXNzLmJ5dGVzVG90YWwKICAgICAgICB9LAogICAgICAgIHJlc3BvbnNlOiB1cGxvYWRSZXNwLAogICAgICAgIHVwbG9hZFVSTDogdXBsb2FkUmVzcC51cGxvYWRVUkwsCiAgICAgICAgaXNQYXVzZWQ6IGZhbHNlCiAgICAgIH0pOyAvLyBSZW1vdGUgcHJvdmlkZXJzIHNvbWV0aW1lcyBkb24ndCB0ZWxsIHVzIHRoZSBmaWxlIHNpemUsCiAgICAgIC8vIGJ1dCB3ZSBjYW4ga25vdyBob3cgbWFueSBieXRlcyB3ZSB1cGxvYWRlZCBvbmNlIHRoZSB1cGxvYWQgaXMgY29tcGxldGUuCgogICAgICBpZiAoZmlsZS5zaXplID09IG51bGwpIHsKICAgICAgICB0aGlzLnNldEZpbGVTdGF0ZShmaWxlLmlkLCB7CiAgICAgICAgICBzaXplOiB1cGxvYWRSZXNwLmJ5dGVzVXBsb2FkZWQgfHwgY3VycmVudFByb2dyZXNzLmJ5dGVzVG90YWwKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdGhpcy5jYWxjdWxhdGVUb3RhbFByb2dyZXNzKCk7CiAgICB9KTsKICAgIHRoaXMub24oJ3ByZXByb2Nlc3MtcHJvZ3Jlc3MnLCAoZmlsZSwgcHJvZ3Jlc3MpID0+IHsKICAgICAgaWYgKCF0aGlzLmdldEZpbGUoZmlsZS5pZCkpIHsKICAgICAgICB0aGlzLmxvZyhgTm90IHNldHRpbmcgcHJvZ3Jlc3MgZm9yIGEgZmlsZSB0aGF0IGhhcyBiZWVuIHJlbW92ZWQ6ICR7ZmlsZS5pZH1gKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuc2V0RmlsZVN0YXRlKGZpbGUuaWQsIHsKICAgICAgICBwcm9ncmVzczogeyAuLi50aGlzLmdldEZpbGUoZmlsZS5pZCkucHJvZ3Jlc3MsCiAgICAgICAgICBwcmVwcm9jZXNzOiBwcm9ncmVzcwogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKICAgIHRoaXMub24oJ3ByZXByb2Nlc3MtY29tcGxldGUnLCBmaWxlID0+IHsKICAgICAgaWYgKCF0aGlzLmdldEZpbGUoZmlsZS5pZCkpIHsKICAgICAgICB0aGlzLmxvZyhgTm90IHNldHRpbmcgcHJvZ3Jlc3MgZm9yIGEgZmlsZSB0aGF0IGhhcyBiZWVuIHJlbW92ZWQ6ICR7ZmlsZS5pZH1gKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGZpbGVzID0geyAuLi50aGlzLmdldFN0YXRlKCkuZmlsZXMKICAgICAgfTsKICAgICAgZmlsZXNbZmlsZS5pZF0gPSB7IC4uLmZpbGVzW2ZpbGUuaWRdLAogICAgICAgIHByb2dyZXNzOiB7IC4uLmZpbGVzW2ZpbGUuaWRdLnByb2dyZXNzCiAgICAgICAgfQogICAgICB9OwogICAgICBkZWxldGUgZmlsZXNbZmlsZS5pZF0ucHJvZ3Jlc3MucHJlcHJvY2VzczsKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgZmlsZXMKICAgICAgfSk7CiAgICB9KTsKICAgIHRoaXMub24oJ3Bvc3Rwcm9jZXNzLXByb2dyZXNzJywgKGZpbGUsIHByb2dyZXNzKSA9PiB7CiAgICAgIGlmICghdGhpcy5nZXRGaWxlKGZpbGUuaWQpKSB7CiAgICAgICAgdGhpcy5sb2coYE5vdCBzZXR0aW5nIHByb2dyZXNzIGZvciBhIGZpbGUgdGhhdCBoYXMgYmVlbiByZW1vdmVkOiAke2ZpbGUuaWR9YCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLnNldEZpbGVTdGF0ZShmaWxlLmlkLCB7CiAgICAgICAgcHJvZ3Jlc3M6IHsgLi4udGhpcy5nZXRTdGF0ZSgpLmZpbGVzW2ZpbGUuaWRdLnByb2dyZXNzLAogICAgICAgICAgcG9zdHByb2Nlc3M6IHByb2dyZXNzCiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwogICAgdGhpcy5vbigncG9zdHByb2Nlc3MtY29tcGxldGUnLCBmaWxlID0+IHsKICAgICAgaWYgKCF0aGlzLmdldEZpbGUoZmlsZS5pZCkpIHsKICAgICAgICB0aGlzLmxvZyhgTm90IHNldHRpbmcgcHJvZ3Jlc3MgZm9yIGEgZmlsZSB0aGF0IGhhcyBiZWVuIHJlbW92ZWQ6ICR7ZmlsZS5pZH1gKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGZpbGVzID0geyAuLi50aGlzLmdldFN0YXRlKCkuZmlsZXMKICAgICAgfTsKICAgICAgZmlsZXNbZmlsZS5pZF0gPSB7IC4uLmZpbGVzW2ZpbGUuaWRdLAogICAgICAgIHByb2dyZXNzOiB7IC4uLmZpbGVzW2ZpbGUuaWRdLnByb2dyZXNzCiAgICAgICAgfQogICAgICB9OwogICAgICBkZWxldGUgZmlsZXNbZmlsZS5pZF0ucHJvZ3Jlc3MucG9zdHByb2Nlc3M7CiAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgIGZpbGVzCiAgICAgIH0pOwogICAgfSk7CiAgICB0aGlzLm9uKCdyZXN0b3JlZCcsICgpID0+IHsKICAgICAgLy8gRmlsZXMgbWF5IGhhdmUgY2hhbmdlZC0tZW5zdXJlIHByb2dyZXNzIGlzIHN0aWxsIGFjY3VyYXRlLgogICAgICB0aGlzLmNhbGN1bGF0ZVRvdGFsUHJvZ3Jlc3MoKTsKICAgIH0pOwogICAgdGhpcy5vbignZGFzaGJvYXJkOmZpbGUtZWRpdC1jb21wbGV0ZScsIGZpbGUgPT4gewogICAgICBpZiAoZmlsZSkgewogICAgICAgIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ2KHRoaXMsIF9jaGVja1JlcXVpcmVkTWV0YUZpZWxkc09uRmlsZSlbX2NoZWNrUmVxdWlyZWRNZXRhRmllbGRzT25GaWxlXShmaWxlKTsKICAgICAgfQogICAgfSk7IC8vIHNob3cgaW5mb3JtZXIgaWYgb2ZmbGluZQoKICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcikgewogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb25saW5lJywgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX3VwZGF0ZU9ubGluZVN0YXR1cylbX3VwZGF0ZU9ubGluZVN0YXR1c10pOwogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb2ZmbGluZScsIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ2KHRoaXMsIF91cGRhdGVPbmxpbmVTdGF0dXMpW191cGRhdGVPbmxpbmVTdGF0dXNdKTsKICAgICAgc2V0VGltZW91dChfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkNih0aGlzLCBfdXBkYXRlT25saW5lU3RhdHVzKVtfdXBkYXRlT25saW5lU3RhdHVzXSwgMzAwMCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBfY3JlYXRlVXBsb2FkMihmaWxlSURzLCBvcHRzKSB7CiAgICBpZiAob3B0cyA9PT0gdm9pZCAwKSB7CiAgICAgIG9wdHMgPSB7fTsKICAgIH0KCiAgICAvLyB1cHB5LnJldHJ5QWxsIHNldHMgdGhpcyB0byB0cnVlIOKAlCB3aGVuIHJldHJ5aW5nIHdlIHdhbnQgdG8gaWdub3JlIGBhbGxvd05ld1VwbG9hZDogZmFsc2VgCiAgICBjb25zdCB7CiAgICAgIGZvcmNlQWxsb3dOZXdVcGxvYWQgPSBmYWxzZQogICAgfSA9IG9wdHM7CiAgICBjb25zdCB7CiAgICAgIGFsbG93TmV3VXBsb2FkLAogICAgICBjdXJyZW50VXBsb2FkcwogICAgfSA9IHRoaXMuZ2V0U3RhdGUoKTsKCiAgICBpZiAoIWFsbG93TmV3VXBsb2FkICYmICFmb3JjZUFsbG93TmV3VXBsb2FkKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGNyZWF0ZSBhIG5ldyB1cGxvYWQ6IGFscmVhZHkgdXBsb2FkaW5nLicpOwogICAgfQoKICAgIGNvbnN0IHVwbG9hZElEID0gbmFub2lkJDEoKTsKICAgIHRoaXMuZW1pdCgndXBsb2FkJywgewogICAgICBpZDogdXBsb2FkSUQsCiAgICAgIGZpbGVJRHMKICAgIH0pOwogICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgIGFsbG93TmV3VXBsb2FkOiB0aGlzLm9wdHMuYWxsb3dNdWx0aXBsZVVwbG9hZEJhdGNoZXMgIT09IGZhbHNlICYmIHRoaXMub3B0cy5hbGxvd011bHRpcGxlVXBsb2FkcyAhPT0gZmFsc2UsCiAgICAgIGN1cnJlbnRVcGxvYWRzOiB7IC4uLmN1cnJlbnRVcGxvYWRzLAogICAgICAgIFt1cGxvYWRJRF06IHsKICAgICAgICAgIGZpbGVJRHMsCiAgICAgICAgICBzdGVwOiAwLAogICAgICAgICAgcmVzdWx0OiB7fQogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gdXBsb2FkSUQ7CiAgfQoKICBmdW5jdGlvbiBfZ2V0VXBsb2FkMih1cGxvYWRJRCkgewogICAgY29uc3QgewogICAgICBjdXJyZW50VXBsb2FkcwogICAgfSA9IHRoaXMuZ2V0U3RhdGUoKTsKICAgIHJldHVybiBjdXJyZW50VXBsb2Fkc1t1cGxvYWRJRF07CiAgfQoKICBmdW5jdGlvbiBfcmVtb3ZlVXBsb2FkMih1cGxvYWRJRCkgewogICAgY29uc3QgY3VycmVudFVwbG9hZHMgPSB7IC4uLnRoaXMuZ2V0U3RhdGUoKS5jdXJyZW50VXBsb2FkcwogICAgfTsKICAgIGRlbGV0ZSBjdXJyZW50VXBsb2Fkc1t1cGxvYWRJRF07CiAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgY3VycmVudFVwbG9hZHMKICAgIH0pOwogIH0KCiAgYXN5bmMgZnVuY3Rpb24gX3J1blVwbG9hZDIodXBsb2FkSUQpIHsKICAgIGxldCB7CiAgICAgIGN1cnJlbnRVcGxvYWRzCiAgICB9ID0gdGhpcy5nZXRTdGF0ZSgpOwogICAgbGV0IGN1cnJlbnRVcGxvYWQgPSBjdXJyZW50VXBsb2Fkc1t1cGxvYWRJRF07CiAgICBjb25zdCByZXN0b3JlU3RlcCA9IGN1cnJlbnRVcGxvYWQuc3RlcCB8fCAwOwogICAgY29uc3Qgc3RlcHMgPSBbLi4uX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX3ByZVByb2Nlc3NvcnMpW19wcmVQcm9jZXNzb3JzXSwgLi4uX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX3VwbG9hZGVycylbX3VwbG9hZGVyc10sIC4uLl9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ2KHRoaXMsIF9wb3N0UHJvY2Vzc29ycylbX3Bvc3RQcm9jZXNzb3JzXV07CgogICAgdHJ5IHsKICAgICAgZm9yIChsZXQgc3RlcCA9IHJlc3RvcmVTdGVwOyBzdGVwIDwgc3RlcHMubGVuZ3RoOyBzdGVwKyspIHsKICAgICAgICBpZiAoIWN1cnJlbnRVcGxvYWQpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgZm4gPSBzdGVwc1tzdGVwXTsKICAgICAgICBjb25zdCB1cGRhdGVkVXBsb2FkID0geyAuLi5jdXJyZW50VXBsb2FkLAogICAgICAgICAgc3RlcAogICAgICAgIH07CiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICBjdXJyZW50VXBsb2FkczogeyAuLi5jdXJyZW50VXBsb2FkcywKICAgICAgICAgICAgW3VwbG9hZElEXTogdXBkYXRlZFVwbG9hZAogICAgICAgICAgfQogICAgICAgIH0pOyAvLyBUT0RPIGdpdmUgdGhpcyB0aGUgYHVwZGF0ZWRVcGxvYWRgIG9iamVjdCBhcyBpdHMgb25seSBwYXJhbWV0ZXIgbWF5YmU/CiAgICAgICAgLy8gT3RoZXJ3aXNlIHdoZW4gbW9yZSBtZXRhZGF0YSBtYXkgYmUgYWRkZWQgdG8gdGhlIHVwbG9hZCB0aGlzIHdvdWxkIGtlZXAgZ2V0dGluZyBtb3JlIHBhcmFtZXRlcnMKCiAgICAgICAgYXdhaXQgZm4odXBkYXRlZFVwbG9hZC5maWxlSURzLCB1cGxvYWRJRCk7IC8vIFVwZGF0ZSBjdXJyZW50VXBsb2FkIHZhbHVlIGluIGNhc2UgaXQgd2FzIG1vZGlmaWVkIGFzeW5jaHJvbm91c2x5LgoKICAgICAgICBjdXJyZW50VXBsb2FkcyA9IHRoaXMuZ2V0U3RhdGUoKS5jdXJyZW50VXBsb2FkczsKICAgICAgICBjdXJyZW50VXBsb2FkID0gY3VycmVudFVwbG9hZHNbdXBsb2FkSURdOwogICAgICB9CiAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgdGhpcy5lbWl0KCdlcnJvcicsIGVycik7CgogICAgICBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkNih0aGlzLCBfcmVtb3ZlVXBsb2FkKVtfcmVtb3ZlVXBsb2FkXSh1cGxvYWRJRCk7CgogICAgICB0aHJvdyBlcnI7CiAgICB9IC8vIFNldCByZXN1bHQgZGF0YS4KCgogICAgaWYgKGN1cnJlbnRVcGxvYWQpIHsKICAgICAgLy8gTWFyayBwb3N0cHJvY2Vzc2luZyBzdGVwIGFzIGNvbXBsZXRlIGlmIG5lY2Vzc2FyeTsgdGhpcyBhZGRyZXNzZXMgYSBjYXNlIHdoZXJlIHdlIG1pZ2h0IGdldAogICAgICAvLyBzdHVjayBpbiB0aGUgcG9zdHByb2Nlc3NpbmcgVUkgd2hpbGUgdGhlIHVwbG9hZCBpcyBmdWxseSBjb21wbGV0ZS4KICAgICAgLy8gSWYgdGhlIHBvc3Rwcm9jZXNzaW5nIHN0ZXBzIGRvIG5vdCBkbyBhbnkgd29yaywgdGhleSBtYXkgbm90IGVtaXQgcG9zdHByb2Nlc3NpbmcgZXZlbnRzIGF0CiAgICAgIC8vIGFsbCwgYW5kIG5ldmVyIG1hcmsgdGhlIHBvc3Rwcm9jZXNzaW5nIGFzIGNvbXBsZXRlLiBUaGlzIGlzIGZpbmUgb24gaXRzIG93biBidXQgd2UKICAgICAgLy8gaW50cm9kdWNlZCBjb2RlIGluIHRoZSBAdXBweS9jb3JlIHVwbG9hZC1zdWNjZXNzIGhhbmRsZXIgdG8gcHJlcGFyZSBwb3N0cHJvY2Vzc2luZyBwcm9ncmVzcwogICAgICAvLyBzdGF0ZSBpZiBhbnkgcG9zdHByb2Nlc3NvcnMgYXJlIHJlZ2lzdGVyZWQuIFRoYXQgaXMgdG8gYXZvaWQgYSAiZmxhc2ggb2YgY29tcGxldGVkIHN0YXRlIgogICAgICAvLyBiZWZvcmUgdGhlIHBvc3Rwcm9jZXNzaW5nIHBsdWdpbnMgY2FuIGVtaXQgZXZlbnRzLgogICAgICAvLwogICAgICAvLyBTbywganVzdCBpbiBjYXNlIGFuIHVwbG9hZCB3aXRoIHBvc3Rwcm9jZXNzaW5nIHBsdWdpbnMgKmhhcyogY29tcGxldGVkICp3aXRob3V0KiBlbWl0dGluZwogICAgICAvLyBwb3N0cHJvY2Vzc2luZyBjb21wbGV0aW9uLCB3ZSBkbyBpdCBpbnN0ZWFkLgogICAgICBjdXJyZW50VXBsb2FkLmZpbGVJRHMuZm9yRWFjaChmaWxlSUQgPT4gewogICAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmdldEZpbGUoZmlsZUlEKTsKCiAgICAgICAgaWYgKGZpbGUgJiYgZmlsZS5wcm9ncmVzcy5wb3N0cHJvY2VzcykgewogICAgICAgICAgdGhpcy5lbWl0KCdwb3N0cHJvY2Vzcy1jb21wbGV0ZScsIGZpbGUpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIGNvbnN0IGZpbGVzID0gY3VycmVudFVwbG9hZC5maWxlSURzLm1hcChmaWxlSUQgPT4gdGhpcy5nZXRGaWxlKGZpbGVJRCkpOwogICAgICBjb25zdCBzdWNjZXNzZnVsID0gZmlsZXMuZmlsdGVyKGZpbGUgPT4gIWZpbGUuZXJyb3IpOwogICAgICBjb25zdCBmYWlsZWQgPSBmaWxlcy5maWx0ZXIoZmlsZSA9PiBmaWxlLmVycm9yKTsKICAgICAgYXdhaXQgdGhpcy5hZGRSZXN1bHREYXRhKHVwbG9hZElELCB7CiAgICAgICAgc3VjY2Vzc2Z1bCwKICAgICAgICBmYWlsZWQsCiAgICAgICAgdXBsb2FkSUQKICAgICAgfSk7IC8vIFVwZGF0ZSBjdXJyZW50VXBsb2FkIHZhbHVlIGluIGNhc2UgaXQgd2FzIG1vZGlmaWVkIGFzeW5jaHJvbm91c2x5LgoKICAgICAgY3VycmVudFVwbG9hZHMgPSB0aGlzLmdldFN0YXRlKCkuY3VycmVudFVwbG9hZHM7CiAgICAgIGN1cnJlbnRVcGxvYWQgPSBjdXJyZW50VXBsb2Fkc1t1cGxvYWRJRF07CiAgICB9IC8vIEVtaXQgY29tcGxldGlvbiBldmVudHMuCiAgICAvLyBUaGlzIGlzIGluIGEgc2VwYXJhdGUgZnVuY3Rpb24gc28gdGhhdCB0aGUgYGN1cnJlbnRVcGxvYWRzYCB2YXJpYWJsZQogICAgLy8gYWx3YXlzIHJlZmVycyB0byB0aGUgbGF0ZXN0IHN0YXRlLiBJbiB0aGUgaGFuZGxlciByaWdodCBhYm92ZSBpdCByZWZlcnMKICAgIC8vIHRvIGFuIG91dGRhdGVkIG9iamVjdCB3aXRob3V0IHRoZSBgLnJlc3VsdGAgcHJvcGVydHkuCgoKICAgIGxldCByZXN1bHQ7CgogICAgaWYgKGN1cnJlbnRVcGxvYWQpIHsKICAgICAgcmVzdWx0ID0gY3VycmVudFVwbG9hZC5yZXN1bHQ7CiAgICAgIHRoaXMuZW1pdCgnY29tcGxldGUnLCByZXN1bHQpOwoKICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDYodGhpcywgX3JlbW92ZVVwbG9hZClbX3JlbW92ZVVwbG9hZF0odXBsb2FkSUQpOwogICAgfQoKICAgIGlmIChyZXN1bHQgPT0gbnVsbCkgewogICAgICB0aGlzLmxvZyhgTm90IHNldHRpbmcgcmVzdWx0IGZvciBhbiB1cGxvYWQgdGhhdCBoYXMgYmVlbiByZW1vdmVkOiAke3VwbG9hZElEfWApOwogICAgfQoKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICBVcHB5LlZFUlNJT04gPSAiMi4xLjMiOwogIHZhciBVcHB5XzEkMSA9IFVwcHk7CgogIHZhciBwcmVhY3QgPSBjcmVhdGVDb21tb25qc01vZHVsZSQxKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICB2YXIgbixsLHUsdCxpLHIsbyxmLGU9e30sYz1bXSxzPS9hY2l0fGV4KD86c3xnfG58cHwkKXxycGh8Z3JpZHxvd3N8bW5jfG50d3xpbmVbY2hdfHpvb3xeb3JkfGl0ZXJhL2k7ZnVuY3Rpb24gYShuLGwpe2Zvcih2YXIgdSBpbiBsKW5bdV09bFt1XTtyZXR1cm4gbn1mdW5jdGlvbiB2KG4pe3ZhciBsPW4ucGFyZW50Tm9kZTtsJiZsLnJlbW92ZUNoaWxkKG4pO31mdW5jdGlvbiBoKGwsdSx0KXt2YXIgaSxyLG8sZj17fTtmb3IobyBpbiB1KSJrZXkiPT1vP2k9dVtvXToicmVmIj09bz9yPXVbb106ZltvXT11W29dO2lmKGFyZ3VtZW50cy5sZW5ndGg+MiYmKGYuY2hpbGRyZW49YXJndW1lbnRzLmxlbmd0aD4zP24uY2FsbChhcmd1bWVudHMsMik6dCksImZ1bmN0aW9uIj09dHlwZW9mIGwmJm51bGwhPWwuZGVmYXVsdFByb3BzKWZvcihvIGluIGwuZGVmYXVsdFByb3BzKXZvaWQgMD09PWZbb10mJihmW29dPWwuZGVmYXVsdFByb3BzW29dKTtyZXR1cm4gcChsLGYsaSxyLG51bGwpfWZ1bmN0aW9uIHAobix0LGkscixvKXt2YXIgZj17dHlwZTpuLHByb3BzOnQsa2V5OmkscmVmOnIsX19rOm51bGwsX186bnVsbCxfX2I6MCxfX2U6bnVsbCxfX2Q6dm9pZCAwLF9fYzpudWxsLF9faDpudWxsLGNvbnN0cnVjdG9yOnZvaWQgMCxfX3Y6bnVsbD09bz8rK3U6b307cmV0dXJuIG51bGw9PW8mJm51bGwhPWwudm5vZGUmJmwudm5vZGUoZiksZn1mdW5jdGlvbiB5KG4pe3JldHVybiBuLmNoaWxkcmVufWZ1bmN0aW9uIGQobixsKXt0aGlzLnByb3BzPW4sdGhpcy5jb250ZXh0PWw7fWZ1bmN0aW9uIF8obixsKXtpZihudWxsPT1sKXJldHVybiBuLl9fP18obi5fXyxuLl9fLl9fay5pbmRleE9mKG4pKzEpOm51bGw7Zm9yKHZhciB1O2w8bi5fX2subGVuZ3RoO2wrKylpZihudWxsIT0odT1uLl9fa1tsXSkmJm51bGwhPXUuX19lKXJldHVybiB1Ll9fZTtyZXR1cm4gImZ1bmN0aW9uIj09dHlwZW9mIG4udHlwZT9fKG4pOm51bGx9ZnVuY3Rpb24gayhuKXt2YXIgbCx1O2lmKG51bGwhPShuPW4uX18pJiZudWxsIT1uLl9fYyl7Zm9yKG4uX19lPW4uX19jLmJhc2U9bnVsbCxsPTA7bDxuLl9fay5sZW5ndGg7bCsrKWlmKG51bGwhPSh1PW4uX19rW2xdKSYmbnVsbCE9dS5fX2Upe24uX19lPW4uX19jLmJhc2U9dS5fX2U7YnJlYWt9cmV0dXJuIGsobil9fWZ1bmN0aW9uIHgobil7KCFuLl9fZCYmKG4uX19kPSEwKSYmaS5wdXNoKG4pJiYhYi5fX3IrK3x8byE9PWwuZGVib3VuY2VSZW5kZXJpbmcpJiYoKG89bC5kZWJvdW5jZVJlbmRlcmluZyl8fHIpKGIpO31mdW5jdGlvbiBiKCl7Zm9yKHZhciBuO2IuX19yPWkubGVuZ3RoOyluPWkuc29ydChmdW5jdGlvbihuLGwpe3JldHVybiBuLl9fdi5fX2ItbC5fX3YuX19ifSksaT1bXSxuLnNvbWUoZnVuY3Rpb24obil7dmFyIGwsdSx0LGkscixvO24uX19kJiYocj0oaT0obD1uKS5fX3YpLl9fZSwobz1sLl9fUCkmJih1PVtdLCh0PWEoe30saSkpLl9fdj1pLl9fdisxLEkobyxpLHQsbC5fX24sdm9pZCAwIT09by5vd25lclNWR0VsZW1lbnQsbnVsbCE9aS5fX2g/W3JdOm51bGwsdSxudWxsPT1yP18oaSk6cixpLl9faCksVCh1LGkpLGkuX19lIT1yJiZrKGkpKSk7fSk7fWZ1bmN0aW9uIG0obixsLHUsdCxpLHIsbyxmLHMsYSl7dmFyIHYsaCxkLGsseCxiLG0sQT10JiZ0Ll9fa3x8YyxQPUEubGVuZ3RoO2Zvcih1Ll9faz1bXSx2PTA7djxsLmxlbmd0aDt2KyspaWYobnVsbCE9KGs9dS5fX2tbdl09bnVsbD09KGs9bFt2XSl8fCJib29sZWFuIj09dHlwZW9mIGs/bnVsbDoic3RyaW5nIj09dHlwZW9mIGt8fCJudW1iZXIiPT10eXBlb2Yga3x8ImJpZ2ludCI9PXR5cGVvZiBrP3AobnVsbCxrLG51bGwsbnVsbCxrKTpBcnJheS5pc0FycmF5KGspP3AoeSx7Y2hpbGRyZW46a30sbnVsbCxudWxsLG51bGwpOmsuX19iPjA/cChrLnR5cGUsay5wcm9wcyxrLmtleSxudWxsLGsuX192KTprKSl7aWYoay5fXz11LGsuX19iPXUuX19iKzEsbnVsbD09PShkPUFbdl0pfHxkJiZrLmtleT09ZC5rZXkmJmsudHlwZT09PWQudHlwZSlBW3ZdPXZvaWQgMDtlbHNlIGZvcihoPTA7aDxQO2grKyl7aWYoKGQ9QVtoXSkmJmsua2V5PT1kLmtleSYmay50eXBlPT09ZC50eXBlKXtBW2hdPXZvaWQgMDticmVha31kPW51bGw7fUkobixrLGQ9ZHx8ZSxpLHIsbyxmLHMsYSkseD1rLl9fZSwoaD1rLnJlZikmJmQucmVmIT1oJiYobXx8KG09W10pLGQucmVmJiZtLnB1c2goZC5yZWYsbnVsbCxrKSxtLnB1c2goaCxrLl9fY3x8eCxrKSksbnVsbCE9eD8obnVsbD09YiYmKGI9eCksImZ1bmN0aW9uIj09dHlwZW9mIGsudHlwZSYmay5fX2s9PT1kLl9faz9rLl9fZD1zPWcoayxzLG4pOnM9dyhuLGssZCxBLHgscyksImZ1bmN0aW9uIj09dHlwZW9mIHUudHlwZSYmKHUuX19kPXMpKTpzJiZkLl9fZT09cyYmcy5wYXJlbnROb2RlIT1uJiYocz1fKGQpKTt9Zm9yKHUuX19lPWIsdj1QO3YtLTspbnVsbCE9QVt2XSYmKCJmdW5jdGlvbiI9PXR5cGVvZiB1LnR5cGUmJm51bGwhPUFbdl0uX19lJiZBW3ZdLl9fZT09dS5fX2QmJih1Ll9fZD1fKHQsdisxKSksTChBW3ZdLEFbdl0pKTtpZihtKWZvcih2PTA7djxtLmxlbmd0aDt2KyspeihtW3ZdLG1bKyt2XSxtWysrdl0pO31mdW5jdGlvbiBnKG4sbCx1KXtmb3IodmFyIHQsaT1uLl9fayxyPTA7aSYmcjxpLmxlbmd0aDtyKyspKHQ9aVtyXSkmJih0Ll9fPW4sbD0iZnVuY3Rpb24iPT10eXBlb2YgdC50eXBlP2codCxsLHUpOncodSx0LHQsaSx0Ll9fZSxsKSk7cmV0dXJuIGx9ZnVuY3Rpb24gdyhuLGwsdSx0LGkscil7dmFyIG8sZixlO2lmKHZvaWQgMCE9PWwuX19kKW89bC5fX2QsbC5fX2Q9dm9pZCAwO2Vsc2UgaWYobnVsbD09dXx8aSE9cnx8bnVsbD09aS5wYXJlbnROb2RlKW46aWYobnVsbD09cnx8ci5wYXJlbnROb2RlIT09biluLmFwcGVuZENoaWxkKGkpLG89bnVsbDtlbHNlIHtmb3IoZj1yLGU9MDsoZj1mLm5leHRTaWJsaW5nKSYmZTx0Lmxlbmd0aDtlKz0yKWlmKGY9PWkpYnJlYWsgbjtuLmluc2VydEJlZm9yZShpLHIpLG89cjt9cmV0dXJuIHZvaWQgMCE9PW8/bzppLm5leHRTaWJsaW5nfWZ1bmN0aW9uIEEobixsLHUsdCxpKXt2YXIgcjtmb3IociBpbiB1KSJjaGlsZHJlbiI9PT1yfHwia2V5Ij09PXJ8fHIgaW4gbHx8QyhuLHIsbnVsbCx1W3JdLHQpO2ZvcihyIGluIGwpaSYmImZ1bmN0aW9uIiE9dHlwZW9mIGxbcl18fCJjaGlsZHJlbiI9PT1yfHwia2V5Ij09PXJ8fCJ2YWx1ZSI9PT1yfHwiY2hlY2tlZCI9PT1yfHx1W3JdPT09bFtyXXx8QyhuLHIsbFtyXSx1W3JdLHQpO31mdW5jdGlvbiBQKG4sbCx1KXsiLSI9PT1sWzBdP24uc2V0UHJvcGVydHkobCx1KTpuW2xdPW51bGw9PXU/IiI6Im51bWJlciIhPXR5cGVvZiB1fHxzLnRlc3QobCk/dTp1KyJweCI7fWZ1bmN0aW9uIEMobixsLHUsdCxpKXt2YXIgcjtuOmlmKCJzdHlsZSI9PT1sKWlmKCJzdHJpbmciPT10eXBlb2YgdSluLnN0eWxlLmNzc1RleHQ9dTtlbHNlIHtpZigic3RyaW5nIj09dHlwZW9mIHQmJihuLnN0eWxlLmNzc1RleHQ9dD0iIiksdClmb3IobCBpbiB0KXUmJmwgaW4gdXx8UChuLnN0eWxlLGwsIiIpO2lmKHUpZm9yKGwgaW4gdSl0JiZ1W2xdPT09dFtsXXx8UChuLnN0eWxlLGwsdVtsXSk7fWVsc2UgaWYoIm8iPT09bFswXSYmIm4iPT09bFsxXSlyPWwhPT0obD1sLnJlcGxhY2UoL0NhcHR1cmUkLywiIikpLGw9bC50b0xvd2VyQ2FzZSgpaW4gbj9sLnRvTG93ZXJDYXNlKCkuc2xpY2UoMik6bC5zbGljZSgyKSxuLmx8fChuLmw9e30pLG4ubFtsK3JdPXUsdT90fHxuLmFkZEV2ZW50TGlzdGVuZXIobCxyP0g6JCxyKTpuLnJlbW92ZUV2ZW50TGlzdGVuZXIobCxyP0g6JCxyKTtlbHNlIGlmKCJkYW5nZXJvdXNseVNldElubmVySFRNTCIhPT1sKXtpZihpKWw9bC5yZXBsYWNlKC94bGlua1tIOmhdLywiaCIpLnJlcGxhY2UoL3NOYW1lJC8sInMiKTtlbHNlIGlmKCJocmVmIiE9PWwmJiJsaXN0IiE9PWwmJiJmb3JtIiE9PWwmJiJ0YWJJbmRleCIhPT1sJiYiZG93bmxvYWQiIT09bCYmbCBpbiBuKXRyeXtuW2xdPW51bGw9PXU/IiI6dTticmVhayBufWNhdGNoKG4pe30iZnVuY3Rpb24iPT10eXBlb2YgdXx8KG51bGwhPXUmJighMSE9PXV8fCJhIj09PWxbMF0mJiJyIj09PWxbMV0pP24uc2V0QXR0cmlidXRlKGwsdSk6bi5yZW1vdmVBdHRyaWJ1dGUobCkpO319ZnVuY3Rpb24gJChuKXt0aGlzLmxbbi50eXBlKyExXShsLmV2ZW50P2wuZXZlbnQobik6bik7fWZ1bmN0aW9uIEgobil7dGhpcy5sW24udHlwZSshMF0obC5ldmVudD9sLmV2ZW50KG4pOm4pO31mdW5jdGlvbiBJKG4sdSx0LGkscixvLGYsZSxjKXt2YXIgcyx2LGgscCxfLGsseCxiLGcsdyxBLFA9dS50eXBlO2lmKHZvaWQgMCE9PXUuY29uc3RydWN0b3IpcmV0dXJuIG51bGw7bnVsbCE9dC5fX2gmJihjPXQuX19oLGU9dS5fX2U9dC5fX2UsdS5fX2g9bnVsbCxvPVtlXSksKHM9bC5fX2IpJiZzKHUpO3RyeXtuOmlmKCJmdW5jdGlvbiI9PXR5cGVvZiBQKXtpZihiPXUucHJvcHMsZz0ocz1QLmNvbnRleHRUeXBlKSYmaVtzLl9fY10sdz1zP2c/Zy5wcm9wcy52YWx1ZTpzLl9fOmksdC5fX2M/eD0odj11Ll9fYz10Ll9fYykuX189di5fX0U6KCJwcm90b3R5cGUiaW4gUCYmUC5wcm90b3R5cGUucmVuZGVyP3UuX19jPXY9bmV3IFAoYix3KToodS5fX2M9dj1uZXcgZChiLHcpLHYuY29uc3RydWN0b3I9UCx2LnJlbmRlcj1NKSxnJiZnLnN1Yih2KSx2LnByb3BzPWIsdi5zdGF0ZXx8KHYuc3RhdGU9e30pLHYuY29udGV4dD13LHYuX19uPWksaD12Ll9fZD0hMCx2Ll9faD1bXSksbnVsbD09di5fX3MmJih2Ll9fcz12LnN0YXRlKSxudWxsIT1QLmdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyYmKHYuX19zPT12LnN0YXRlJiYodi5fX3M9YSh7fSx2Ll9fcykpLGEodi5fX3MsUC5nZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMoYix2Ll9fcykpKSxwPXYucHJvcHMsXz12LnN0YXRlLGgpbnVsbD09UC5nZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMmJm51bGwhPXYuY29tcG9uZW50V2lsbE1vdW50JiZ2LmNvbXBvbmVudFdpbGxNb3VudCgpLG51bGwhPXYuY29tcG9uZW50RGlkTW91bnQmJnYuX19oLnB1c2godi5jb21wb25lbnREaWRNb3VudCk7ZWxzZSB7aWYobnVsbD09UC5nZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMmJmIhPT1wJiZudWxsIT12LmNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMmJnYuY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhiLHcpLCF2Ll9fZSYmbnVsbCE9di5zaG91bGRDb21wb25lbnRVcGRhdGUmJiExPT09di5zaG91bGRDb21wb25lbnRVcGRhdGUoYix2Ll9fcyx3KXx8dS5fX3Y9PT10Ll9fdil7di5wcm9wcz1iLHYuc3RhdGU9di5fX3MsdS5fX3YhPT10Ll9fdiYmKHYuX19kPSExKSx2Ll9fdj11LHUuX19lPXQuX19lLHUuX19rPXQuX19rLHUuX19rLmZvckVhY2goZnVuY3Rpb24obil7biYmKG4uX189dSk7fSksdi5fX2gubGVuZ3RoJiZmLnB1c2godik7YnJlYWsgbn1udWxsIT12LmNvbXBvbmVudFdpbGxVcGRhdGUmJnYuY29tcG9uZW50V2lsbFVwZGF0ZShiLHYuX19zLHcpLG51bGwhPXYuY29tcG9uZW50RGlkVXBkYXRlJiZ2Ll9faC5wdXNoKGZ1bmN0aW9uKCl7di5jb21wb25lbnREaWRVcGRhdGUocCxfLGspO30pO312LmNvbnRleHQ9dyx2LnByb3BzPWIsdi5zdGF0ZT12Ll9fcywocz1sLl9fcikmJnModSksdi5fX2Q9ITEsdi5fX3Y9dSx2Ll9fUD1uLHM9di5yZW5kZXIodi5wcm9wcyx2LnN0YXRlLHYuY29udGV4dCksdi5zdGF0ZT12Ll9fcyxudWxsIT12LmdldENoaWxkQ29udGV4dCYmKGk9YShhKHt9LGkpLHYuZ2V0Q2hpbGRDb250ZXh0KCkpKSxofHxudWxsPT12LmdldFNuYXBzaG90QmVmb3JlVXBkYXRlfHwoaz12LmdldFNuYXBzaG90QmVmb3JlVXBkYXRlKHAsXykpLEE9bnVsbCE9cyYmcy50eXBlPT09eSYmbnVsbD09cy5rZXk/cy5wcm9wcy5jaGlsZHJlbjpzLG0obixBcnJheS5pc0FycmF5KEEpP0E6W0FdLHUsdCxpLHIsbyxmLGUsYyksdi5iYXNlPXUuX19lLHUuX19oPW51bGwsdi5fX2gubGVuZ3RoJiZmLnB1c2godikseCYmKHYuX19FPXYuX189bnVsbCksdi5fX2U9ITE7fWVsc2UgbnVsbD09byYmdS5fX3Y9PT10Ll9fdj8odS5fX2s9dC5fX2ssdS5fX2U9dC5fX2UpOnUuX19lPWoodC5fX2UsdSx0LGkscixvLGYsYyk7KHM9bC5kaWZmZWQpJiZzKHUpO31jYXRjaChuKXt1Ll9fdj1udWxsLChjfHxudWxsIT1vKSYmKHUuX19lPWUsdS5fX2g9ISFjLG9bby5pbmRleE9mKGUpXT1udWxsKSxsLl9fZShuLHUsdCk7fX1mdW5jdGlvbiBUKG4sdSl7bC5fX2MmJmwuX19jKHUsbiksbi5zb21lKGZ1bmN0aW9uKHUpe3RyeXtuPXUuX19oLHUuX19oPVtdLG4uc29tZShmdW5jdGlvbihuKXtuLmNhbGwodSk7fSk7fWNhdGNoKG4pe2wuX19lKG4sdS5fX3YpO319KTt9ZnVuY3Rpb24gaihsLHUsdCxpLHIsbyxmLGMpe3ZhciBzLGEsaCxwPXQucHJvcHMseT11LnByb3BzLGQ9dS50eXBlLGs9MDtpZigic3ZnIj09PWQmJihyPSEwKSxudWxsIT1vKWZvcig7azxvLmxlbmd0aDtrKyspaWYoKHM9b1trXSkmJiJzZXRBdHRyaWJ1dGUiaW4gcz09ISFkJiYoZD9zLmxvY2FsTmFtZT09PWQ6Mz09PXMubm9kZVR5cGUpKXtsPXMsb1trXT1udWxsO2JyZWFrfWlmKG51bGw9PWwpe2lmKG51bGw9PT1kKXJldHVybiBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh5KTtsPXI/ZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsZCk6ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChkLHkuaXMmJnkpLG89bnVsbCxjPSExO31pZihudWxsPT09ZClwPT09eXx8YyYmbC5kYXRhPT09eXx8KGwuZGF0YT15KTtlbHNlIHtpZihvPW8mJm4uY2FsbChsLmNoaWxkTm9kZXMpLGE9KHA9dC5wcm9wc3x8ZSkuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwsaD15LmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MLCFjKXtpZihudWxsIT1vKWZvcihwPXt9LGs9MDtrPGwuYXR0cmlidXRlcy5sZW5ndGg7aysrKXBbbC5hdHRyaWJ1dGVzW2tdLm5hbWVdPWwuYXR0cmlidXRlc1trXS52YWx1ZTsoaHx8YSkmJihoJiYoYSYmaC5fX2h0bWw9PWEuX19odG1sfHxoLl9faHRtbD09PWwuaW5uZXJIVE1MKXx8KGwuaW5uZXJIVE1MPWgmJmguX19odG1sfHwiIikpO31pZihBKGwseSxwLHIsYyksaCl1Ll9faz1bXTtlbHNlIGlmKGs9dS5wcm9wcy5jaGlsZHJlbixtKGwsQXJyYXkuaXNBcnJheShrKT9rOltrXSx1LHQsaSxyJiYiZm9yZWlnbk9iamVjdCIhPT1kLG8sZixvP29bMF06dC5fX2smJl8odCwwKSxjKSxudWxsIT1vKWZvcihrPW8ubGVuZ3RoO2stLTspbnVsbCE9b1trXSYmdihvW2tdKTtjfHwoInZhbHVlImluIHkmJnZvaWQgMCE9PShrPXkudmFsdWUpJiYoayE9PXAudmFsdWV8fGshPT1sLnZhbHVlfHwicHJvZ3Jlc3MiPT09ZCYmIWspJiZDKGwsInZhbHVlIixrLHAudmFsdWUsITEpLCJjaGVja2VkImluIHkmJnZvaWQgMCE9PShrPXkuY2hlY2tlZCkmJmshPT1sLmNoZWNrZWQmJkMobCwiY2hlY2tlZCIsayxwLmNoZWNrZWQsITEpKTt9cmV0dXJuIGx9ZnVuY3Rpb24geihuLHUsdCl7dHJ5eyJmdW5jdGlvbiI9PXR5cGVvZiBuP24odSk6bi5jdXJyZW50PXU7fWNhdGNoKG4pe2wuX19lKG4sdCk7fX1mdW5jdGlvbiBMKG4sdSx0KXt2YXIgaSxyO2lmKGwudW5tb3VudCYmbC51bm1vdW50KG4pLChpPW4ucmVmKSYmKGkuY3VycmVudCYmaS5jdXJyZW50IT09bi5fX2V8fHooaSxudWxsLHUpKSxudWxsIT0oaT1uLl9fYykpe2lmKGkuY29tcG9uZW50V2lsbFVubW91bnQpdHJ5e2kuY29tcG9uZW50V2lsbFVubW91bnQoKTt9Y2F0Y2gobil7bC5fX2Uobix1KTt9aS5iYXNlPWkuX19QPW51bGw7fWlmKGk9bi5fX2spZm9yKHI9MDtyPGkubGVuZ3RoO3IrKylpW3JdJiZMKGlbcl0sdSwiZnVuY3Rpb24iIT10eXBlb2Ygbi50eXBlKTt0fHxudWxsPT1uLl9fZXx8dihuLl9fZSksbi5fX2U9bi5fX2Q9dm9pZCAwO31mdW5jdGlvbiBNKG4sbCx1KXtyZXR1cm4gdGhpcy5jb25zdHJ1Y3RvcihuLHUpfWZ1bmN0aW9uIE4odSx0LGkpe3ZhciByLG8sZjtsLl9fJiZsLl9fKHUsdCksbz0ocj0iZnVuY3Rpb24iPT10eXBlb2YgaSk/bnVsbDppJiZpLl9fa3x8dC5fX2ssZj1bXSxJKHQsdT0oIXImJml8fHQpLl9faz1oKHksbnVsbCxbdV0pLG98fGUsZSx2b2lkIDAhPT10Lm93bmVyU1ZHRWxlbWVudCwhciYmaT9baV06bz9udWxsOnQuZmlyc3RDaGlsZD9uLmNhbGwodC5jaGlsZE5vZGVzKTpudWxsLGYsIXImJmk/aTpvP28uX19lOnQuZmlyc3RDaGlsZCxyKSxUKGYsdSk7fW49Yy5zbGljZSxsPXtfX2U6ZnVuY3Rpb24obixsKXtmb3IodmFyIHUsdCxpO2w9bC5fXzspaWYoKHU9bC5fX2MpJiYhdS5fXyl0cnl7aWYoKHQ9dS5jb25zdHJ1Y3RvcikmJm51bGwhPXQuZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yJiYodS5zZXRTdGF0ZSh0LmdldERlcml2ZWRTdGF0ZUZyb21FcnJvcihuKSksaT11Ll9fZCksbnVsbCE9dS5jb21wb25lbnREaWRDYXRjaCYmKHUuY29tcG9uZW50RGlkQ2F0Y2gobiksaT11Ll9fZCksaSlyZXR1cm4gdS5fX0U9dX1jYXRjaChsKXtuPWw7fXRocm93IG59fSx1PTAsdD1mdW5jdGlvbihuKXtyZXR1cm4gbnVsbCE9biYmdm9pZCAwPT09bi5jb25zdHJ1Y3Rvcn0sZC5wcm90b3R5cGUuc2V0U3RhdGU9ZnVuY3Rpb24obixsKXt2YXIgdTt1PW51bGwhPXRoaXMuX19zJiZ0aGlzLl9fcyE9PXRoaXMuc3RhdGU/dGhpcy5fX3M6dGhpcy5fX3M9YSh7fSx0aGlzLnN0YXRlKSwiZnVuY3Rpb24iPT10eXBlb2YgbiYmKG49bihhKHt9LHUpLHRoaXMucHJvcHMpKSxuJiZhKHUsbiksbnVsbCE9biYmdGhpcy5fX3YmJihsJiZ0aGlzLl9faC5wdXNoKGwpLHgodGhpcykpO30sZC5wcm90b3R5cGUuZm9yY2VVcGRhdGU9ZnVuY3Rpb24obil7dGhpcy5fX3YmJih0aGlzLl9fZT0hMCxuJiZ0aGlzLl9faC5wdXNoKG4pLHgodGhpcykpO30sZC5wcm90b3R5cGUucmVuZGVyPXksaT1bXSxyPSJmdW5jdGlvbiI9PXR5cGVvZiBQcm9taXNlP1Byb21pc2UucHJvdG90eXBlLnRoZW4uYmluZChQcm9taXNlLnJlc29sdmUoKSk6c2V0VGltZW91dCxiLl9fcj0wLGY9MCxleHBvcnRzLkNvbXBvbmVudD1kLGV4cG9ydHMuRnJhZ21lbnQ9eSxleHBvcnRzLmNsb25lRWxlbWVudD1mdW5jdGlvbihsLHUsdCl7dmFyIGkscixvLGY9YSh7fSxsLnByb3BzKTtmb3IobyBpbiB1KSJrZXkiPT1vP2k9dVtvXToicmVmIj09bz9yPXVbb106ZltvXT11W29dO3JldHVybiBhcmd1bWVudHMubGVuZ3RoPjImJihmLmNoaWxkcmVuPWFyZ3VtZW50cy5sZW5ndGg+Mz9uLmNhbGwoYXJndW1lbnRzLDIpOnQpLHAobC50eXBlLGYsaXx8bC5rZXkscnx8bC5yZWYsbnVsbCl9LGV4cG9ydHMuY3JlYXRlQ29udGV4dD1mdW5jdGlvbihuLGwpe3ZhciB1PXtfX2M6bD0iX19jQyIrZisrLF9fOm4sQ29uc3VtZXI6ZnVuY3Rpb24obixsKXtyZXR1cm4gbi5jaGlsZHJlbihsKX0sUHJvdmlkZXI6ZnVuY3Rpb24obil7dmFyIHUsdDtyZXR1cm4gdGhpcy5nZXRDaGlsZENvbnRleHR8fCh1PVtdLCh0PXt9KVtsXT10aGlzLHRoaXMuZ2V0Q2hpbGRDb250ZXh0PWZ1bmN0aW9uKCl7cmV0dXJuIHR9LHRoaXMuc2hvdWxkQ29tcG9uZW50VXBkYXRlPWZ1bmN0aW9uKG4pe3RoaXMucHJvcHMudmFsdWUhPT1uLnZhbHVlJiZ1LnNvbWUoeCk7fSx0aGlzLnN1Yj1mdW5jdGlvbihuKXt1LnB1c2gobik7dmFyIGw9bi5jb21wb25lbnRXaWxsVW5tb3VudDtuLmNvbXBvbmVudFdpbGxVbm1vdW50PWZ1bmN0aW9uKCl7dS5zcGxpY2UodS5pbmRleE9mKG4pLDEpLGwmJmwuY2FsbChuKTt9O30pLG4uY2hpbGRyZW59fTtyZXR1cm4gdS5Qcm92aWRlci5fXz11LkNvbnN1bWVyLmNvbnRleHRUeXBlPXV9LGV4cG9ydHMuY3JlYXRlRWxlbWVudD1oLGV4cG9ydHMuY3JlYXRlUmVmPWZ1bmN0aW9uKCl7cmV0dXJuIHtjdXJyZW50Om51bGx9fSxleHBvcnRzLmg9aCxleHBvcnRzLmh5ZHJhdGU9ZnVuY3Rpb24gbihsLHUpe04obCx1LG4pO30sZXhwb3J0cy5pc1ZhbGlkRWxlbWVudD10LGV4cG9ydHMub3B0aW9ucz1sLGV4cG9ydHMucmVuZGVyPU4sZXhwb3J0cy50b0NoaWxkQXJyYXk9ZnVuY3Rpb24gbihsLHUpe3JldHVybiB1PXV8fFtdLG51bGw9PWx8fCJib29sZWFuIj09dHlwZW9mIGx8fChBcnJheS5pc0FycmF5KGwpP2wuc29tZShmdW5jdGlvbihsKXtuKGwsdSk7fSk6dS5wdXNoKGwpKSx1fTsKCiAgfSk7CgogIC8qKgogICAqIENoZWNrIGlmIGFuIG9iamVjdCBpcyBhIERPTSBlbGVtZW50LiBEdWNrLXR5cGluZyBiYXNlZCBvbiBgbm9kZVR5cGVgLgogICAqCiAgICogQHBhcmFtIHsqfSBvYmoKICAgKi8KICB2YXIgaXNET01FbGVtZW50ID0gZnVuY3Rpb24gaXNET01FbGVtZW50KG9iaikgewogICAgcmV0dXJuIChvYmogPT0gbnVsbCA/IHZvaWQgMCA6IG9iai5ub2RlVHlwZSkgPT09IE5vZGUuRUxFTUVOVF9OT0RFOwogIH07CgogIC8qKgogICAqIEZpbmQgYSBET00gZWxlbWVudC4KICAgKgogICAqIEBwYXJhbSB7Tm9kZXxzdHJpbmd9IGVsZW1lbnQKICAgKiBAcmV0dXJucyB7Tm9kZXxudWxsfQogICAqLwoKCiAgdmFyIGZpbmRET01FbGVtZW50ID0gZnVuY3Rpb24gZmluZERPTUVsZW1lbnQoZWxlbWVudCwgY29udGV4dCkgewogICAgaWYgKGNvbnRleHQgPT09IHZvaWQgMCkgewogICAgICBjb250ZXh0ID0gZG9jdW1lbnQ7CiAgICB9CgogICAgaWYgKHR5cGVvZiBlbGVtZW50ID09PSAnc3RyaW5nJykgewogICAgICByZXR1cm4gY29udGV4dC5xdWVyeVNlbGVjdG9yKGVsZW1lbnQpOwogICAgfQoKICAgIGlmIChpc0RPTUVsZW1lbnQoZWxlbWVudCkpIHsKICAgICAgcmV0dXJuIGVsZW1lbnQ7CiAgICB9CgogICAgcmV0dXJuIG51bGw7CiAgfTsKCiAgLyoqCiAgICogQ29yZSBwbHVnaW4gbG9naWMgdGhhdCBhbGwgcGx1Z2lucyBzaGFyZS4KICAgKgogICAqIEJhc2VQbHVnaW4gZG9lcyBub3QgY29udGFpbiBET00gcmVuZGVyaW5nIHNvIGl0IGNhbiBiZSB1c2VkIGZvciBwbHVnaW5zCiAgICogd2l0aG91dCBhIHVzZXIgaW50ZXJmYWNlLgogICAqCiAgICogU2VlIGBQbHVnaW5gIGZvciB0aGUgZXh0ZW5kZWQgdmVyc2lvbiB3aXRoIFByZWFjdCByZW5kZXJpbmcgZm9yIGludGVyZmFjZXMuCiAgICovCgoKICB2YXIgQmFzZVBsdWdpbl8xJDEgPSBjbGFzcyBCYXNlUGx1Z2luIHsKICAgIGNvbnN0cnVjdG9yKHVwcHksIG9wdHMpIHsKICAgICAgaWYgKG9wdHMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdHMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy51cHB5ID0gdXBweTsKICAgICAgdGhpcy5vcHRzID0gb3B0czsKICAgIH0KCiAgICBnZXRQbHVnaW5TdGF0ZSgpIHsKICAgICAgY29uc3QgewogICAgICAgIHBsdWdpbnMKICAgICAgfSA9IHRoaXMudXBweS5nZXRTdGF0ZSgpOwogICAgICByZXR1cm4gcGx1Z2luc1t0aGlzLmlkXSB8fCB7fTsKICAgIH0KCiAgICBzZXRQbHVnaW5TdGF0ZSh1cGRhdGUpIHsKICAgICAgY29uc3QgewogICAgICAgIHBsdWdpbnMKICAgICAgfSA9IHRoaXMudXBweS5nZXRTdGF0ZSgpOwogICAgICB0aGlzLnVwcHkuc2V0U3RhdGUoewogICAgICAgIHBsdWdpbnM6IHsgLi4ucGx1Z2lucywKICAgICAgICAgIFt0aGlzLmlkXTogeyAuLi5wbHVnaW5zW3RoaXMuaWRdLAogICAgICAgICAgICAuLi51cGRhdGUKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIHNldE9wdGlvbnMobmV3T3B0cykgewogICAgICB0aGlzLm9wdHMgPSB7IC4uLnRoaXMub3B0cywKICAgICAgICAuLi5uZXdPcHRzCiAgICAgIH07CiAgICAgIHRoaXMuc2V0UGx1Z2luU3RhdGUoKTsgLy8gc28gdGhhdCBVSSByZS1yZW5kZXJzIHdpdGggbmV3IG9wdGlvbnMKCiAgICAgIHRoaXMuaTE4bkluaXQoKTsKICAgIH0KCiAgICBpMThuSW5pdCgpIHsKICAgICAgY29uc3QgdHJhbnNsYXRvciA9IG5ldyBUcmFuc2xhdG9yXzEoW3RoaXMuZGVmYXVsdExvY2FsZSwgdGhpcy51cHB5LmxvY2FsZSwgdGhpcy5vcHRzLmxvY2FsZV0pOwogICAgICB0aGlzLmkxOG4gPSB0cmFuc2xhdG9yLnRyYW5zbGF0ZS5iaW5kKHRyYW5zbGF0b3IpOwogICAgICB0aGlzLmkxOG5BcnJheSA9IHRyYW5zbGF0b3IudHJhbnNsYXRlQXJyYXkuYmluZCh0cmFuc2xhdG9yKTsKICAgICAgdGhpcy5zZXRQbHVnaW5TdGF0ZSgpOyAvLyBzbyB0aGF0IFVJIHJlLXJlbmRlcnMgYW5kIHdlIHNlZSB0aGUgdXBkYXRlZCBsb2NhbGUKICAgIH0KICAgIC8qKgogICAgICogRXh0ZW5kYWJsZSBtZXRob2RzCiAgICAgKiA9PT09PT09PT09PT09PT09PT0KICAgICAqIFRoZXNlIG1ldGhvZHMgYXJlIGhlcmUgdG8gc2VydmUgYXMgYW4gb3ZlcnZpZXcgb2YgdGhlIGV4dGVuZGFibGUgbWV0aG9kcyBhcyB3ZWxsIGFzCiAgICAgKiBtYWtpbmcgdGhlbSBub3QgY29uZGl0aW9uYWwgaW4gdXNlLCBzdWNoIGFzIGBpZiAodGhpcy5hZnRlclVwZGF0ZSlgLgogICAgICovCiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY2xhc3MtbWV0aG9kcy11c2UtdGhpcwoKCiAgICBhZGRUYXJnZXQoKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignRXh0ZW5kIHRoZSBhZGRUYXJnZXQgbWV0aG9kIHRvIGFkZCB5b3VyIHBsdWdpbiB0byBhbm90aGVyIHBsdWdpblwncyB0YXJnZXQnKTsKICAgIH0gLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNsYXNzLW1ldGhvZHMtdXNlLXRoaXMKCgogICAgaW5zdGFsbCgpIHt9IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjbGFzcy1tZXRob2RzLXVzZS10aGlzCgoKICAgIHVuaW5zdGFsbCgpIHt9CiAgICAvKioKICAgICAqIENhbGxlZCB3aGVuIHBsdWdpbiBpcyBtb3VudGVkLCB3aGV0aGVyIGluIERPTSBvciBpbnRvIGFub3RoZXIgcGx1Z2luLgogICAgICogTmVlZGVkIGJlY2F1c2Ugc29tZXRpbWVzIHBsdWdpbnMgYXJlIG1vdW50ZWQgc2VwYXJhdGVseS9hZnRlciBgaW5zdGFsbGAsCiAgICAgKiBzbyB0aGlzLmVsIGFuZCB0aGlzLnBhcmVudCBtaWdodCBub3QgYmUgYXZhaWxhYmxlIGluIGBpbnN0YWxsYC4KICAgICAqIFRoaXMgaXMgdGhlIGNhc2Ugd2l0aCBAdXBweS9yZWFjdCBwbHVnaW5zLCBmb3IgZXhhbXBsZS4KICAgICAqLwoKCiAgICByZW5kZXIoKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignRXh0ZW5kIHRoZSByZW5kZXIgbWV0aG9kIHRvIGFkZCB5b3VyIHBsdWdpbiB0byBhIERPTSBlbGVtZW50Jyk7CiAgICB9IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjbGFzcy1tZXRob2RzLXVzZS10aGlzCgoKICAgIHVwZGF0ZSgpIHt9IC8vIENhbGxlZCBhZnRlciBldmVyeSBzdGF0ZSB1cGRhdGUsIGFmdGVyIGV2ZXJ5dGhpbmcncyBtb3VudGVkLiBEZWJvdW5jZWQuCiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY2xhc3MtbWV0aG9kcy11c2UtdGhpcwoKCiAgICBhZnRlclVwZGF0ZSgpIHt9CgogIH07CgogIGZ1bmN0aW9uIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ1KHJlY2VpdmVyLCBwcml2YXRlS2V5KSB7IGlmICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHJlY2VpdmVyLCBwcml2YXRlS2V5KSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJhdHRlbXB0ZWQgdG8gdXNlIHByaXZhdGUgZmllbGQgb24gbm9uLWluc3RhbmNlIik7IH0gcmV0dXJuIHJlY2VpdmVyOyB9CgogIHZhciBpZCQ1ID0gMDsKCiAgZnVuY3Rpb24gX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VLZXkkNShuYW1lKSB7IHJldHVybiAiX19wcml2YXRlXyIgKyBpZCQ1KysgKyAiXyIgKyBuYW1lOyB9CgogIGNvbnN0IHsKICAgIHJlbmRlcgogIH0gPSBwcmVhY3Q7CgoKCgogIC8qKgogICAqIERlZmVyIGEgZnJlcXVlbnQgY2FsbCB0byB0aGUgbWljcm90YXNrIHF1ZXVlLgogICAqCiAgICogQHBhcmFtIHsoKSA9PiBUfSBmbgogICAqIEByZXR1cm5zIHtQcm9taXNlPFQ+fQogICAqLwoKCiAgZnVuY3Rpb24gZGVib3VuY2UoZm4pIHsKICAgIGxldCBjYWxsaW5nID0gbnVsbDsKICAgIGxldCBsYXRlc3RBcmdzID0gbnVsbDsKICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4pLCBfa2V5ID0gMDsgX2tleSA8IF9sZW47IF9rZXkrKykgewogICAgICAgIGFyZ3NbX2tleV0gPSBhcmd1bWVudHNbX2tleV07CiAgICAgIH0KCiAgICAgIGxhdGVzdEFyZ3MgPSBhcmdzOwoKICAgICAgaWYgKCFjYWxsaW5nKSB7CiAgICAgICAgY2FsbGluZyA9IFByb21pc2UucmVzb2x2ZSgpLnRoZW4oKCkgPT4gewogICAgICAgICAgY2FsbGluZyA9IG51bGw7IC8vIEF0IHRoaXMgcG9pbnQgYGFyZ3NgIG1heSBiZSBkaWZmZXJlbnQgZnJvbSB0aGUgbW9zdAogICAgICAgICAgLy8gcmVjZW50IHN0YXRlLCBpZiBtdWx0aXBsZSBjYWxscyBoYXBwZW5lZCBzaW5jZSB0aGlzIHRhc2sKICAgICAgICAgIC8vIHdhcyBxdWV1ZWQuIFNvIHdlIHVzZSB0aGUgYGxhdGVzdEFyZ3NgLCB3aGljaCBkZWZpbml0ZWx5CiAgICAgICAgICAvLyBpcyB0aGUgbW9zdCByZWNlbnQgY2FsbC4KCiAgICAgICAgICByZXR1cm4gZm4oLi4ubGF0ZXN0QXJncyk7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBjYWxsaW5nOwogICAgfTsKICB9CiAgLyoqCiAgICogVUlQbHVnaW4gaXMgdGhlIGV4dGVuZGVkIHZlcnNpb24gb2YgQmFzZVBsdWdpbiB0byBpbmNvcnBvcmF0ZSByZW5kZXJpbmcgd2l0aCBQcmVhY3QuCiAgICogVXNlIHRoaXMgZm9yIHBsdWdpbnMgdGhhdCBuZWVkIGEgdXNlciBpbnRlcmZhY2UuCiAgICoKICAgKiBGb3IgcGx1Z2lucyB3aXRob3V0IGFuIHVzZXIgaW50ZXJmYWNlLCBzZWUgQmFzZVBsdWdpbi4KICAgKi8KCgogIHZhciBfdXBkYXRlVUkgPSAvKiNfX1BVUkVfXyovX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VLZXkkNSgidXBkYXRlVUkiKTsKCiAgY2xhc3MgVUlQbHVnaW4gZXh0ZW5kcyBCYXNlUGx1Z2luXzEkMSB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIF91cGRhdGVVSSwgewogICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgIHZhbHVlOiB2b2lkIDAKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBzdXBwbGllZCBgdGFyZ2V0YCBpcyBhIERPTSBlbGVtZW50IG9yIGFuIGBvYmplY3RgLgogICAgICogSWYgaXTigJlzIGFuIG9iamVjdCDigJQgdGFyZ2V0IGlzIGEgcGx1Z2luLCBhbmQgd2Ugc2VhcmNoIGBwbHVnaW5zYAogICAgICogZm9yIGEgcGx1Z2luIHdpdGggc2FtZSBuYW1lIGFuZCByZXR1cm4gaXRzIHRhcmdldC4KICAgICAqLwogICAgbW91bnQodGFyZ2V0LCBwbHVnaW4pIHsKICAgICAgY29uc3QgY2FsbGVyUGx1Z2luTmFtZSA9IHBsdWdpbi5pZDsKICAgICAgY29uc3QgdGFyZ2V0RWxlbWVudCA9IGZpbmRET01FbGVtZW50KHRhcmdldCk7CgogICAgICBpZiAodGFyZ2V0RWxlbWVudCkgewogICAgICAgIHRoaXMuaXNUYXJnZXRET01FbCA9IHRydWU7IC8vIFdoZW4gdGFyZ2V0IGlzIDxib2R5PiB3aXRoIGEgc2luZ2xlIDxkaXY+IGVsZW1lbnQsCiAgICAgICAgLy8gUHJlYWN0IHRoaW5rcyBpdOKAmXMgdGhlIFVwcHkgcm9vdCBlbGVtZW50IGluIHRoZXJlIHdoZW4gZG9pbmcgYSBkaWZmLAogICAgICAgIC8vIGFuZCBkZXN0cm95cyBpdC4gU28gd2UgYXJlIGNyZWF0aW5nIGEgZnJhZ21lbnQgKGNvdWxkIGJlIGVtcHR5IGRpdikKCiAgICAgICAgY29uc3QgdXBweVJvb3RFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOyAvLyBBUEkgZm9yIHBsdWdpbnMgdGhhdCByZXF1aXJlIGEgc3luY2hyb25vdXMgcmVyZW5kZXIuCgogICAgICAgIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ1KHRoaXMsIF91cGRhdGVVSSlbX3VwZGF0ZVVJXSA9IGRlYm91bmNlKHN0YXRlID0+IHsKICAgICAgICAgIC8vIHBsdWdpbiBjb3VsZCBiZSByZW1vdmVkLCBidXQgdGhpcy5yZXJlbmRlciBpcyBkZWJvdW5jZWQgYmVsb3csCiAgICAgICAgICAvLyBzbyBpdCBjb3VsZCBzdGlsbCBiZSBjYWxsZWQgZXZlbiBhZnRlciB1cHB5LnJlbW92ZVBsdWdpbiBvciB1cHB5LmNsb3NlCiAgICAgICAgICAvLyBoZW5jZSB0aGUgY2hlY2sKICAgICAgICAgIGlmICghdGhpcy51cHB5LmdldFBsdWdpbih0aGlzLmlkKSkgcmV0dXJuOwogICAgICAgICAgcmVuZGVyKHRoaXMucmVuZGVyKHN0YXRlKSwgdXBweVJvb3RFbGVtZW50KTsKICAgICAgICAgIHRoaXMuYWZ0ZXJVcGRhdGUoKTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLnVwcHkubG9nKGBJbnN0YWxsaW5nICR7Y2FsbGVyUGx1Z2luTmFtZX0gdG8gYSBET00gZWxlbWVudCAnJHt0YXJnZXR9J2ApOwoKICAgICAgICBpZiAodGhpcy5vcHRzLnJlcGxhY2VUYXJnZXRDb250ZW50KSB7CiAgICAgICAgICAvLyBEb2luZyByZW5kZXIoaChudWxsKSwgdGFyZ2V0RWxlbWVudCksIHdoaWNoIHNob3VsZCBoYXZlIGJlZW4KICAgICAgICAgIC8vIGEgYmV0dGVyIHdheSwgc2luY2UgYmVjYXVzZSB0aGUgY29tcG9uZW50IG1pZ2h0IG5lZWQgdG8gZG8gYWRkaXRpb25hbCBjbGVhbnVwIHdoZW4gaXQgaXMgcmVtb3ZlZCwKICAgICAgICAgIC8vIHN0b3BwZWQgd29ya2luZyDigJQgUHJlYWN0IGp1c3QgYWRkcyBudWxsIGludG8gdGFyZ2V0LCBub3QgcmVwbGFjaW5nCiAgICAgICAgICB0YXJnZXRFbGVtZW50LmlubmVySFRNTCA9ICcnOwogICAgICAgIH0KCiAgICAgICAgcmVuZGVyKHRoaXMucmVuZGVyKHRoaXMudXBweS5nZXRTdGF0ZSgpKSwgdXBweVJvb3RFbGVtZW50KTsKICAgICAgICB0aGlzLmVsID0gdXBweVJvb3RFbGVtZW50LmZpcnN0RWxlbWVudENoaWxkOwogICAgICAgIHRhcmdldEVsZW1lbnQuYXBwZW5kQ2hpbGQodXBweVJvb3RFbGVtZW50KTsKICAgICAgICB0aGlzLm9uTW91bnQoKTsKICAgICAgICByZXR1cm4gdGhpcy5lbDsKICAgICAgfQoKICAgICAgbGV0IHRhcmdldFBsdWdpbjsKCiAgICAgIGlmICh0eXBlb2YgdGFyZ2V0ID09PSAnb2JqZWN0JyAmJiB0YXJnZXQgaW5zdGFuY2VvZiBVSVBsdWdpbikgewogICAgICAgIC8vIFRhcmdldGluZyBhIHBsdWdpbiAqaW5zdGFuY2UqCiAgICAgICAgdGFyZ2V0UGx1Z2luID0gdGFyZ2V0OwogICAgICB9IGVsc2UgaWYgKHR5cGVvZiB0YXJnZXQgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAvLyBUYXJnZXRpbmcgYSBwbHVnaW4gdHlwZQogICAgICAgIGNvbnN0IFRhcmdldCA9IHRhcmdldDsgLy8gRmluZCB0aGUgdGFyZ2V0IHBsdWdpbiBpbnN0YW5jZS4KCiAgICAgICAgdGhpcy51cHB5Lml0ZXJhdGVQbHVnaW5zKHAgPT4gewogICAgICAgICAgaWYgKHAgaW5zdGFuY2VvZiBUYXJnZXQpIHsKICAgICAgICAgICAgdGFyZ2V0UGx1Z2luID0gcDsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CgogICAgICBpZiAodGFyZ2V0UGx1Z2luKSB7CiAgICAgICAgdGhpcy51cHB5LmxvZyhgSW5zdGFsbGluZyAke2NhbGxlclBsdWdpbk5hbWV9IHRvICR7dGFyZ2V0UGx1Z2luLmlkfWApOwogICAgICAgIHRoaXMucGFyZW50ID0gdGFyZ2V0UGx1Z2luOwogICAgICAgIHRoaXMuZWwgPSB0YXJnZXRQbHVnaW4uYWRkVGFyZ2V0KHBsdWdpbik7CiAgICAgICAgdGhpcy5vbk1vdW50KCk7CiAgICAgICAgcmV0dXJuIHRoaXMuZWw7CiAgICAgIH0KCiAgICAgIHRoaXMudXBweS5sb2coYE5vdCBpbnN0YWxsaW5nICR7Y2FsbGVyUGx1Z2luTmFtZX1gKTsKICAgICAgbGV0IG1lc3NhZ2UgPSBgSW52YWxpZCB0YXJnZXQgb3B0aW9uIGdpdmVuIHRvICR7Y2FsbGVyUGx1Z2luTmFtZX0uYDsKCiAgICAgIGlmICh0eXBlb2YgdGFyZ2V0ID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgbWVzc2FnZSArPSAnIFRoZSBnaXZlbiB0YXJnZXQgaXMgbm90IGEgUGx1Z2luIGNsYXNzLiAnICsgJ1BsZWFzZSBjaGVjayB0aGF0IHlvdVwncmUgbm90IHNwZWNpZnlpbmcgYSBSZWFjdCBDb21wb25lbnQgaW5zdGVhZCBvZiBhIHBsdWdpbi4gJyArICdJZiB5b3UgYXJlIHVzaW5nIEB1cHB5LyogcGFja2FnZXMgZGlyZWN0bHksIG1ha2Ugc3VyZSB5b3UgaGF2ZSBvbmx5IDEgdmVyc2lvbiBvZiBAdXBweS9jb3JlIGluc3RhbGxlZDogJyArICdydW4gYG5wbSBscyBAdXBweS9jb3JlYCBvbiB0aGUgY29tbWFuZCBsaW5lIGFuZCB2ZXJpZnkgdGhhdCBhbGwgdGhlIHZlcnNpb25zIG1hdGNoIGFuZCBhcmUgZGVkdXBlZCBjb3JyZWN0bHkuJzsKICAgICAgfSBlbHNlIHsKICAgICAgICBtZXNzYWdlICs9ICdJZiB5b3UgbWVhbnQgdG8gdGFyZ2V0IGFuIEhUTUwgZWxlbWVudCwgcGxlYXNlIG1ha2Ugc3VyZSB0aGF0IHRoZSBlbGVtZW50IGV4aXN0cy4gJyArICdDaGVjayB0aGF0IHRoZSA8c2NyaXB0PiB0YWcgaW5pdGlhbGl6aW5nIFVwcHkgaXMgcmlnaHQgYmVmb3JlIHRoZSBjbG9zaW5nIDwvYm9keT4gdGFnIGF0IHRoZSBlbmQgb2YgdGhlIHBhZ2UuICcgKyAnKHNlZSBodHRwczovL2dpdGh1Yi5jb20vdHJhbnNsb2FkaXQvdXBweS9pc3N1ZXMvMTA0MilcblxuJyArICdJZiB5b3UgbWVhbnQgdG8gdGFyZ2V0IGEgcGx1Z2luLCBwbGVhc2UgY29uZmlybSB0aGF0IHlvdXIgYGltcG9ydGAgc3RhdGVtZW50cyBvciBgcmVxdWlyZWAgY2FsbHMgYXJlIGNvcnJlY3QuJzsKICAgICAgfQoKICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpOwogICAgfQoKICAgIHVwZGF0ZShzdGF0ZSkgewogICAgICBpZiAodGhpcy5lbCAhPSBudWxsKSB7CiAgICAgICAgdmFyIF9jbGFzc1ByaXZhdGVGaWVsZExvbywgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vMjsKCiAgICAgICAgKF9jbGFzc1ByaXZhdGVGaWVsZExvbyA9IChfY2xhc3NQcml2YXRlRmllbGRMb28yID0gX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDUodGhpcywgX3VwZGF0ZVVJKSlbX3VwZGF0ZVVJXSkgPT0gbnVsbCA/IHZvaWQgMCA6IF9jbGFzc1ByaXZhdGVGaWVsZExvby5jYWxsKF9jbGFzc1ByaXZhdGVGaWVsZExvbzIsIHN0YXRlKTsKICAgICAgfQogICAgfQoKICAgIHVubW91bnQoKSB7CiAgICAgIGlmICh0aGlzLmlzVGFyZ2V0RE9NRWwpIHsKICAgICAgICB2YXIgX3RoaXMkZWw7CgogICAgICAgIChfdGhpcyRlbCA9IHRoaXMuZWwpID09IG51bGwgPyB2b2lkIDAgOiBfdGhpcyRlbC5yZW1vdmUoKTsKICAgICAgfQoKICAgICAgdGhpcy5vblVubW91bnQoKTsKICAgIH0gLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNsYXNzLW1ldGhvZHMtdXNlLXRoaXMKCgogICAgb25Nb3VudCgpIHt9IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjbGFzcy1tZXRob2RzLXVzZS10aGlzCgoKICAgIG9uVW5tb3VudCgpIHt9CgogIH0KCiAgdmFyIFVJUGx1Z2luXzEkMSA9IFVJUGx1Z2luOwoKICBjb25zdCB7CiAgICBkZWJ1Z0xvZ2dlcgogIH0gPSBsb2dnZXJzOwoKICB2YXIgbGliJDIgPSBVcHB5XzEkMTsKICB2YXIgVXBweV8xID0gVXBweV8xJDE7CiAgdmFyIFVJUGx1Z2luXzEgPSBVSVBsdWdpbl8xJDE7CiAgdmFyIEJhc2VQbHVnaW5fMSA9IEJhc2VQbHVnaW5fMSQxOwogIHZhciBkZWJ1Z0xvZ2dlcl8xID0gZGVidWdMb2dnZXI7CiAgbGliJDIuVXBweSA9IFVwcHlfMTsKICBsaWIkMi5VSVBsdWdpbiA9IFVJUGx1Z2luXzE7CiAgbGliJDIuQmFzZVBsdWdpbiA9IEJhc2VQbHVnaW5fMTsKICBsaWIkMi5kZWJ1Z0xvZ2dlciA9IGRlYnVnTG9nZ2VyXzE7CgogIGNsYXNzIE5ldHdvcmtFcnJvciBleHRlbmRzIEVycm9yIHsKICAgIGNvbnN0cnVjdG9yKGVycm9yLCB4aHIpIHsKICAgICAgaWYgKHhociA9PT0gdm9pZCAwKSB7CiAgICAgICAgeGhyID0gbnVsbDsKICAgICAgfQoKICAgICAgc3VwZXIoYFRoaXMgbG9va3MgbGlrZSBhIG5ldHdvcmsgZXJyb3IsIHRoZSBlbmRwb2ludCBtaWdodCBiZSBibG9ja2VkIGJ5IGFuIGludGVybmV0IHByb3ZpZGVyIG9yIGEgZmlyZXdhbGwuYCk7CiAgICAgIHRoaXMuY2F1c2UgPSBlcnJvcjsKICAgICAgdGhpcy5pc05ldHdvcmtFcnJvciA9IHRydWU7CiAgICAgIHRoaXMucmVxdWVzdCA9IHhocjsKICAgIH0KCiAgfQoKICB2YXIgTmV0d29ya0Vycm9yXzEgPSBOZXR3b3JrRXJyb3I7CgogIC8qKgogICAqIFdyYXBwZXIgYXJvdW5kIHdpbmRvdy5mZXRjaCB0aGF0IHRocm93cyBhIE5ldHdvcmtFcnJvciB3aGVuIGFwcHJvcHJpYXRlCiAgICovCgoKICB2YXIgZmV0Y2hXaXRoTmV0d29ya0Vycm9yID0gZnVuY3Rpb24gZmV0Y2hXaXRoTmV0d29ya0Vycm9yKCkgewogICAgcmV0dXJuIGZldGNoKC4uLmFyZ3VtZW50cykuY2F0Y2goZXJyID0+IHsKICAgICAgaWYgKGVyci5uYW1lID09PSAnQWJvcnRFcnJvcicpIHsKICAgICAgICB0aHJvdyBlcnI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhyb3cgbmV3IE5ldHdvcmtFcnJvcl8xKGVycik7CiAgICAgIH0KICAgIH0pOwogIH07CgogIGNsYXNzIEF1dGhFcnJvciBleHRlbmRzIEVycm9yIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICBzdXBlcignQXV0aG9yaXphdGlvbiByZXF1aXJlZCcpOwogICAgICB0aGlzLm5hbWUgPSAnQXV0aEVycm9yJzsKICAgICAgdGhpcy5pc0F1dGhFcnJvciA9IHRydWU7CiAgICB9CgogIH0KCiAgdmFyIEF1dGhFcnJvcl8xID0gQXV0aEVycm9yOwoKICB2YXIgX2NsYXNzJDEsIF9nZXRQb3N0UmVzcG9uc2VGdW5jLCBfZ2V0VXJsLCBfZXJyb3JIYW5kbGVyLCBfdGVtcCQxOwoKICBmdW5jdGlvbiBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkNChyZWNlaXZlciwgcHJpdmF0ZUtleSkgeyBpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChyZWNlaXZlciwgcHJpdmF0ZUtleSkpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiYXR0ZW1wdGVkIHRvIHVzZSBwcml2YXRlIGZpZWxkIG9uIG5vbi1pbnN0YW5jZSIpOyB9IHJldHVybiByZWNlaXZlcjsgfQoKICB2YXIgaWQkNCA9IDA7CgogIGZ1bmN0aW9uIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlS2V5JDQobmFtZSkgeyByZXR1cm4gIl9fcHJpdmF0ZV8iICsgaWQkNCsrICsgIl8iICsgbmFtZTsgfQoKCgogICAvLyBSZW1vdmUgdGhlIHRyYWlsaW5nIHNsYXNoIHNvIHdlIGNhbiBhbHdheXMgc2FmZWx5IGFwcGVuZCAveHl6LgoKCiAgZnVuY3Rpb24gc3RyaXBTbGFzaCh1cmwpIHsKICAgIHJldHVybiB1cmwucmVwbGFjZSgvXC8kLywgJycpOwogIH0KCiAgYXN5bmMgZnVuY3Rpb24gaGFuZGxlSlNPTlJlc3BvbnNlKHJlcykgewogICAgaWYgKHJlcy5zdGF0dXMgPT09IDQwMSkgewogICAgICB0aHJvdyBuZXcgQXV0aEVycm9yXzEoKTsKICAgIH0KCiAgICBjb25zdCBqc29uUHJvbWlzZSA9IHJlcy5qc29uKCk7CgogICAgaWYgKHJlcy5zdGF0dXMgPCAyMDAgfHwgcmVzLnN0YXR1cyA+IDMwMCkgewogICAgICBsZXQgZXJyTXNnID0gYEZhaWxlZCByZXF1ZXN0IHdpdGggc3RhdHVzOiAke3Jlcy5zdGF0dXN9LiAke3Jlcy5zdGF0dXNUZXh0fWA7CgogICAgICB0cnkgewogICAgICAgIGNvbnN0IGVyckRhdGEgPSBhd2FpdCBqc29uUHJvbWlzZTsKICAgICAgICBlcnJNc2cgPSBlcnJEYXRhLm1lc3NhZ2UgPyBgJHtlcnJNc2d9IG1lc3NhZ2U6ICR7ZXJyRGF0YS5tZXNzYWdlfWAgOiBlcnJNc2c7CiAgICAgICAgZXJyTXNnID0gZXJyRGF0YS5yZXF1ZXN0SWQgPyBgJHtlcnJNc2d9IHJlcXVlc3QtSWQ6ICR7ZXJyRGF0YS5yZXF1ZXN0SWR9YCA6IGVyck1zZzsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW5zYWZlLWZpbmFsbHkKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyTXNnKTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBqc29uUHJvbWlzZTsKICB9CgogIHZhciBSZXF1ZXN0Q2xpZW50XzEgPSAoX3RlbXAkMSA9IChfZ2V0UG9zdFJlc3BvbnNlRnVuYyA9IC8qI19fUFVSRV9fKi9fY2xhc3NQcml2YXRlRmllbGRMb29zZUtleSQ0KCJnZXRQb3N0UmVzcG9uc2VGdW5jIiksIF9nZXRVcmwgPSAvKiNfX1BVUkVfXyovX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VLZXkkNCgiZ2V0VXJsIiksIF9lcnJvckhhbmRsZXIgPSAvKiNfX1BVUkVfXyovX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VLZXkkNCgiZXJyb3JIYW5kbGVyIiksIF9jbGFzcyQxID0gY2xhc3MgUmVxdWVzdENsaWVudCB7CiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZ2xvYmFsLXJlcXVpcmUKICAgIGNvbnN0cnVjdG9yKHVwcHksIG9wdHMpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIF9lcnJvckhhbmRsZXIsIHsKICAgICAgICB2YWx1ZTogX2Vycm9ySGFuZGxlcjIKICAgICAgfSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBfZ2V0VXJsLCB7CiAgICAgICAgdmFsdWU6IF9nZXRVcmwyCiAgICAgIH0pOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgX2dldFBvc3RSZXNwb25zZUZ1bmMsIHsKICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICB2YWx1ZTogc2tpcCA9PiByZXNwb25zZSA9PiBza2lwID8gcmVzcG9uc2UgOiB0aGlzLm9uUmVjZWl2ZVJlc3BvbnNlKHJlc3BvbnNlKQogICAgICB9KTsKICAgICAgdGhpcy51cHB5ID0gdXBweTsKICAgICAgdGhpcy5vcHRzID0gb3B0czsKICAgICAgdGhpcy5vblJlY2VpdmVSZXNwb25zZSA9IHRoaXMub25SZWNlaXZlUmVzcG9uc2UuYmluZCh0aGlzKTsKICAgICAgdGhpcy5hbGxvd2VkSGVhZGVycyA9IFsnYWNjZXB0JywgJ2NvbnRlbnQtdHlwZScsICd1cHB5LWF1dGgtdG9rZW4nXTsKICAgICAgdGhpcy5wcmVmbGlnaHREb25lID0gZmFsc2U7CiAgICB9CgogICAgZ2V0IGhvc3RuYW1lKCkgewogICAgICBjb25zdCB7CiAgICAgICAgY29tcGFuaW9uCiAgICAgIH0gPSB0aGlzLnVwcHkuZ2V0U3RhdGUoKTsKICAgICAgY29uc3QgaG9zdCA9IHRoaXMub3B0cy5jb21wYW5pb25Vcmw7CiAgICAgIHJldHVybiBzdHJpcFNsYXNoKGNvbXBhbmlvbiAmJiBjb21wYW5pb25baG9zdF0gPyBjb21wYW5pb25baG9zdF0gOiBob3N0KTsKICAgIH0KCiAgICBoZWFkZXJzKCkgewogICAgICBjb25zdCB1c2VySGVhZGVycyA9IHRoaXMub3B0cy5jb21wYW5pb25IZWFkZXJzIHx8IHt9OwogICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHsgLi4uUmVxdWVzdENsaWVudC5kZWZhdWx0SGVhZGVycywKICAgICAgICAuLi51c2VySGVhZGVycwogICAgICB9KTsKICAgIH0KCiAgICBvblJlY2VpdmVSZXNwb25zZShyZXNwb25zZSkgewogICAgICBjb25zdCBzdGF0ZSA9IHRoaXMudXBweS5nZXRTdGF0ZSgpOwogICAgICBjb25zdCBjb21wYW5pb24gPSBzdGF0ZS5jb21wYW5pb24gfHwge307CiAgICAgIGNvbnN0IGhvc3QgPSB0aGlzLm9wdHMuY29tcGFuaW9uVXJsOwogICAgICBjb25zdCB7CiAgICAgICAgaGVhZGVycwogICAgICB9ID0gcmVzcG9uc2U7IC8vIFN0b3JlIHRoZSBzZWxmLWlkZW50aWZpZWQgZG9tYWluIG5hbWUgZm9yIHRoZSBDb21wYW5pb24gaW5zdGFuY2Ugd2UganVzdCBoaXQuCgogICAgICBpZiAoaGVhZGVycy5oYXMoJ2ktYW0nKSAmJiBoZWFkZXJzLmdldCgnaS1hbScpICE9PSBjb21wYW5pb25baG9zdF0pIHsKICAgICAgICB0aGlzLnVwcHkuc2V0U3RhdGUoewogICAgICAgICAgY29tcGFuaW9uOiB7IC4uLmNvbXBhbmlvbiwKICAgICAgICAgICAgW2hvc3RdOiBoZWFkZXJzLmdldCgnaS1hbScpCiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXNwb25zZTsKICAgIH0KCiAgICBwcmVmbGlnaHQocGF0aCkgewogICAgICBpZiAodGhpcy5wcmVmbGlnaHREb25lKSB7CiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0aGlzLmFsbG93ZWRIZWFkZXJzLnNsaWNlKCkpOwogICAgICB9CgogICAgICByZXR1cm4gZmV0Y2goX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDQodGhpcywgX2dldFVybClbX2dldFVybF0ocGF0aCksIHsKICAgICAgICBtZXRob2Q6ICdPUFRJT05TJwogICAgICB9KS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICBpZiAocmVzcG9uc2UuaGVhZGVycy5oYXMoJ2FjY2Vzcy1jb250cm9sLWFsbG93LWhlYWRlcnMnKSkgewogICAgICAgICAgdGhpcy5hbGxvd2VkSGVhZGVycyA9IHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdhY2Nlc3MtY29udHJvbC1hbGxvdy1oZWFkZXJzJykuc3BsaXQoJywnKS5tYXAoaGVhZGVyTmFtZSA9PiBoZWFkZXJOYW1lLnRyaW0oKS50b0xvd2VyQ2FzZSgpKTsKICAgICAgICB9CgogICAgICAgIHRoaXMucHJlZmxpZ2h0RG9uZSA9IHRydWU7CiAgICAgICAgcmV0dXJuIHRoaXMuYWxsb3dlZEhlYWRlcnMuc2xpY2UoKTsKICAgICAgfSkuY2F0Y2goZXJyID0+IHsKICAgICAgICB0aGlzLnVwcHkubG9nKGBbQ29tcGFuaW9uQ2xpZW50XSB1bmFibGUgdG8gbWFrZSBwcmVmbGlnaHQgcmVxdWVzdCAke2Vycn1gLCAnd2FybmluZycpOwogICAgICAgIHRoaXMucHJlZmxpZ2h0RG9uZSA9IHRydWU7CiAgICAgICAgcmV0dXJuIHRoaXMuYWxsb3dlZEhlYWRlcnMuc2xpY2UoKTsKICAgICAgfSk7CiAgICB9CgogICAgcHJlZmxpZ2h0QW5kSGVhZGVycyhwYXRoKSB7CiAgICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5wcmVmbGlnaHQocGF0aCksIHRoaXMuaGVhZGVycygpXSkudGhlbihfcmVmID0+IHsKICAgICAgICBsZXQgW2FsbG93ZWRIZWFkZXJzLCBoZWFkZXJzXSA9IF9yZWY7CiAgICAgICAgLy8gZmlsdGVyIHRvIGtlZXAgb25seSBhbGxvd2VkIEhlYWRlcnMKICAgICAgICBPYmplY3Qua2V5cyhoZWFkZXJzKS5mb3JFYWNoKGhlYWRlciA9PiB7CiAgICAgICAgICBpZiAoIWFsbG93ZWRIZWFkZXJzLmluY2x1ZGVzKGhlYWRlci50b0xvd2VyQ2FzZSgpKSkgewogICAgICAgICAgICB0aGlzLnVwcHkubG9nKGBbQ29tcGFuaW9uQ2xpZW50XSBleGNsdWRpbmcgZGlzYWxsb3dlZCBoZWFkZXIgJHtoZWFkZXJ9YCk7CiAgICAgICAgICAgIGRlbGV0ZSBoZWFkZXJzW2hlYWRlcl07IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcGFyYW0tcmVhc3NpZ24KICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gaGVhZGVyczsKICAgICAgfSk7CiAgICB9CgogICAgZ2V0KHBhdGgsIHNraXBQb3N0UmVzcG9uc2UpIHsKICAgICAgY29uc3QgbWV0aG9kID0gJ2dldCc7CiAgICAgIHJldHVybiB0aGlzLnByZWZsaWdodEFuZEhlYWRlcnMocGF0aCkudGhlbihoZWFkZXJzID0+IGZldGNoV2l0aE5ldHdvcmtFcnJvcihfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkNCh0aGlzLCBfZ2V0VXJsKVtfZ2V0VXJsXShwYXRoKSwgewogICAgICAgIG1ldGhvZCwKICAgICAgICBoZWFkZXJzLAogICAgICAgIGNyZWRlbnRpYWxzOiB0aGlzLm9wdHMuY29tcGFuaW9uQ29va2llc1J1bGUgfHwgJ3NhbWUtb3JpZ2luJwogICAgICB9KSkudGhlbihfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkNCh0aGlzLCBfZ2V0UG9zdFJlc3BvbnNlRnVuYylbX2dldFBvc3RSZXNwb25zZUZ1bmNdKHNraXBQb3N0UmVzcG9uc2UpKS50aGVuKGhhbmRsZUpTT05SZXNwb25zZSkuY2F0Y2goX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDQodGhpcywgX2Vycm9ySGFuZGxlcilbX2Vycm9ySGFuZGxlcl0obWV0aG9kLCBwYXRoKSk7CiAgICB9CgogICAgcG9zdChwYXRoLCBkYXRhLCBza2lwUG9zdFJlc3BvbnNlKSB7CiAgICAgIGNvbnN0IG1ldGhvZCA9ICdwb3N0JzsKICAgICAgcmV0dXJuIHRoaXMucHJlZmxpZ2h0QW5kSGVhZGVycyhwYXRoKS50aGVuKGhlYWRlcnMgPT4gZmV0Y2hXaXRoTmV0d29ya0Vycm9yKF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ0KHRoaXMsIF9nZXRVcmwpW19nZXRVcmxdKHBhdGgpLCB7CiAgICAgICAgbWV0aG9kLAogICAgICAgIGhlYWRlcnMsCiAgICAgICAgY3JlZGVudGlhbHM6IHRoaXMub3B0cy5jb21wYW5pb25Db29raWVzUnVsZSB8fCAnc2FtZS1vcmlnaW4nLAogICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGRhdGEpCiAgICAgIH0pKS50aGVuKF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ0KHRoaXMsIF9nZXRQb3N0UmVzcG9uc2VGdW5jKVtfZ2V0UG9zdFJlc3BvbnNlRnVuY10oc2tpcFBvc3RSZXNwb25zZSkpLnRoZW4oaGFuZGxlSlNPTlJlc3BvbnNlKS5jYXRjaChfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkNCh0aGlzLCBfZXJyb3JIYW5kbGVyKVtfZXJyb3JIYW5kbGVyXShtZXRob2QsIHBhdGgpKTsKICAgIH0KCiAgICBkZWxldGUocGF0aCwgZGF0YSwgc2tpcFBvc3RSZXNwb25zZSkgewogICAgICBjb25zdCBtZXRob2QgPSAnZGVsZXRlJzsKICAgICAgcmV0dXJuIHRoaXMucHJlZmxpZ2h0QW5kSGVhZGVycyhwYXRoKS50aGVuKGhlYWRlcnMgPT4gZmV0Y2hXaXRoTmV0d29ya0Vycm9yKGAke3RoaXMuaG9zdG5hbWV9LyR7cGF0aH1gLCB7CiAgICAgICAgbWV0aG9kLAogICAgICAgIGhlYWRlcnMsCiAgICAgICAgY3JlZGVudGlhbHM6IHRoaXMub3B0cy5jb21wYW5pb25Db29raWVzUnVsZSB8fCAnc2FtZS1vcmlnaW4nLAogICAgICAgIGJvZHk6IGRhdGEgPyBKU09OLnN0cmluZ2lmeShkYXRhKSA6IG51bGwKICAgICAgfSkpLnRoZW4oX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDQodGhpcywgX2dldFBvc3RSZXNwb25zZUZ1bmMpW19nZXRQb3N0UmVzcG9uc2VGdW5jXShza2lwUG9zdFJlc3BvbnNlKSkudGhlbihoYW5kbGVKU09OUmVzcG9uc2UpLmNhdGNoKF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ0KHRoaXMsIF9lcnJvckhhbmRsZXIpW19lcnJvckhhbmRsZXJdKG1ldGhvZCwgcGF0aCkpOwogICAgfQoKICB9KSwgX2NsYXNzJDEuVkVSU0lPTiA9ICIyLjAuNCIsIF9jbGFzcyQxLmRlZmF1bHRIZWFkZXJzID0gewogICAgQWNjZXB0OiAnYXBwbGljYXRpb24vanNvbicsCiAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLAogICAgJ1VwcHktVmVyc2lvbnMnOiBgQHVwcHkvY29tcGFuaW9uLWNsaWVudD0ke19jbGFzcyQxLlZFUlNJT059YAogIH0sIF90ZW1wJDEpOwoKICBmdW5jdGlvbiBfZ2V0VXJsMih1cmwpIHsKICAgIGlmICgvXihodHRwcz86fClcL1wvLy50ZXN0KHVybCkpIHsKICAgICAgcmV0dXJuIHVybDsKICAgIH0KCiAgICByZXR1cm4gYCR7dGhpcy5ob3N0bmFtZX0vJHt1cmx9YDsKICB9CgogIGZ1bmN0aW9uIF9lcnJvckhhbmRsZXIyKG1ldGhvZCwgcGF0aCkgewogICAgcmV0dXJuIGVyciA9PiB7CiAgICAgIHZhciBfZXJyOwoKICAgICAgaWYgKCEoKF9lcnIgPSBlcnIpICE9IG51bGwgJiYgX2Vyci5pc0F1dGhFcnJvcikpIHsKICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcihgQ291bGQgbm90ICR7bWV0aG9kfSAke19jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQ0KHRoaXMsIF9nZXRVcmwpW19nZXRVcmxdKHBhdGgpfWApOwogICAgICAgIGVycm9yLmNhdXNlID0gZXJyOwogICAgICAgIGVyciA9IGVycm9yOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXBhcmFtLXJlYXNzaWduCiAgICAgIH0KCiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnIpOwogICAgfTsKICB9CgogIC8qKgogICAqIFRoaXMgbW9kdWxlIHNlcnZlcyBhcyBhbiBBc3luYyB3cmFwcGVyIGZvciBMb2NhbFN0b3JhZ2UKICAgKi8KCiAgdmFyIHNldEl0ZW0gPSAoa2V5LCB2YWx1ZSkgPT4gewogICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIHZhbHVlKTsKICAgICAgcmVzb2x2ZSgpOwogICAgfSk7CiAgfTsKCiAgdmFyIGdldEl0ZW0gPSBrZXkgPT4gewogICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpKTsKICB9OwoKICB2YXIgcmVtb3ZlSXRlbSA9IGtleSA9PiB7CiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7CiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7CiAgICAgIHJlc29sdmUoKTsKICAgIH0pOwogIH07CgogIHZhciB0b2tlblN0b3JhZ2UgPSB7CiAgCXNldEl0ZW06IHNldEl0ZW0sCiAgCWdldEl0ZW06IGdldEl0ZW0sCiAgCXJlbW92ZUl0ZW06IHJlbW92ZUl0ZW0KICB9OwoKICBjb25zdCBnZXROYW1lJDEgPSBpZCA9PiB7CiAgICByZXR1cm4gaWQuc3BsaXQoJy0nKS5tYXAocyA9PiBzLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcy5zbGljZSgxKSkuam9pbignICcpOwogIH07CgogIHZhciBQcm92aWRlcl8xID0gY2xhc3MgUHJvdmlkZXIgZXh0ZW5kcyBSZXF1ZXN0Q2xpZW50XzEgewogICAgY29uc3RydWN0b3IodXBweSwgb3B0cykgewogICAgICBzdXBlcih1cHB5LCBvcHRzKTsKICAgICAgdGhpcy5wcm92aWRlciA9IG9wdHMucHJvdmlkZXI7CiAgICAgIHRoaXMuaWQgPSB0aGlzLnByb3ZpZGVyOwogICAgICB0aGlzLm5hbWUgPSB0aGlzLm9wdHMubmFtZSB8fCBnZXROYW1lJDEodGhpcy5pZCk7CiAgICAgIHRoaXMucGx1Z2luSWQgPSB0aGlzLm9wdHMucGx1Z2luSWQ7CiAgICAgIHRoaXMudG9rZW5LZXkgPSBgY29tcGFuaW9uLSR7dGhpcy5wbHVnaW5JZH0tYXV0aC10b2tlbmA7CiAgICAgIHRoaXMuY29tcGFuaW9uS2V5c1BhcmFtcyA9IHRoaXMub3B0cy5jb21wYW5pb25LZXlzUGFyYW1zOwogICAgICB0aGlzLnByZUF1dGhUb2tlbiA9IG51bGw7CiAgICB9CgogICAgaGVhZGVycygpIHsKICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFtzdXBlci5oZWFkZXJzKCksIHRoaXMuZ2V0QXV0aFRva2VuKCldKS50aGVuKF9yZWYgPT4gewogICAgICAgIGxldCBbaGVhZGVycywgdG9rZW5dID0gX3JlZjsKICAgICAgICBjb25zdCBhdXRoSGVhZGVycyA9IHt9OwoKICAgICAgICBpZiAodG9rZW4pIHsKICAgICAgICAgIGF1dGhIZWFkZXJzWyd1cHB5LWF1dGgtdG9rZW4nXSA9IHRva2VuOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuY29tcGFuaW9uS2V5c1BhcmFtcykgewogICAgICAgICAgYXV0aEhlYWRlcnNbJ3VwcHktY3JlZGVudGlhbHMtcGFyYW1zJ10gPSBidG9hKEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgcGFyYW1zOiB0aGlzLmNvbXBhbmlvbktleXNQYXJhbXMKICAgICAgICAgIH0pKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB7IC4uLmhlYWRlcnMsCiAgICAgICAgICAuLi5hdXRoSGVhZGVycwogICAgICAgIH07CiAgICAgIH0pOwogICAgfQoKICAgIG9uUmVjZWl2ZVJlc3BvbnNlKHJlc3BvbnNlKSB7CiAgICAgIHJlc3BvbnNlID0gc3VwZXIub25SZWNlaXZlUmVzcG9uc2UocmVzcG9uc2UpOwogICAgICBjb25zdCBwbHVnaW4gPSB0aGlzLnVwcHkuZ2V0UGx1Z2luKHRoaXMucGx1Z2luSWQpOwogICAgICBjb25zdCBvbGRBdXRoZW50aWNhdGVkID0gcGx1Z2luLmdldFBsdWdpblN0YXRlKCkuYXV0aGVudGljYXRlZDsKICAgICAgY29uc3QgYXV0aGVudGljYXRlZCA9IG9sZEF1dGhlbnRpY2F0ZWQgPyByZXNwb25zZS5zdGF0dXMgIT09IDQwMSA6IHJlc3BvbnNlLnN0YXR1cyA8IDQwMDsKICAgICAgcGx1Z2luLnNldFBsdWdpblN0YXRlKHsKICAgICAgICBhdXRoZW50aWNhdGVkCiAgICAgIH0pOwogICAgICByZXR1cm4gcmVzcG9uc2U7CiAgICB9CgogICAgc2V0QXV0aFRva2VuKHRva2VuKSB7CiAgICAgIHJldHVybiB0aGlzLnVwcHkuZ2V0UGx1Z2luKHRoaXMucGx1Z2luSWQpLnN0b3JhZ2Uuc2V0SXRlbSh0aGlzLnRva2VuS2V5LCB0b2tlbik7CiAgICB9CgogICAgZ2V0QXV0aFRva2VuKCkgewogICAgICByZXR1cm4gdGhpcy51cHB5LmdldFBsdWdpbih0aGlzLnBsdWdpbklkKS5zdG9yYWdlLmdldEl0ZW0odGhpcy50b2tlbktleSk7CiAgICB9CgogICAgYXV0aFVybChxdWVyaWVzKSB7CiAgICAgIGlmIChxdWVyaWVzID09PSB2b2lkIDApIHsKICAgICAgICBxdWVyaWVzID0ge307CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnByZUF1dGhUb2tlbikgewogICAgICAgIHF1ZXJpZXMudXBweVByZUF1dGhUb2tlbiA9IHRoaXMucHJlQXV0aFRva2VuOwogICAgICB9CgogICAgICByZXR1cm4gYCR7dGhpcy5ob3N0bmFtZX0vJHt0aGlzLmlkfS9jb25uZWN0PyR7bmV3IFVSTFNlYXJjaFBhcmFtcyhxdWVyaWVzKX1gOwogICAgfQoKICAgIGZpbGVVcmwoaWQpIHsKICAgICAgcmV0dXJuIGAke3RoaXMuaG9zdG5hbWV9LyR7dGhpcy5pZH0vZ2V0LyR7aWR9YDsKICAgIH0KCiAgICBmZXRjaFByZUF1dGhUb2tlbigpIHsKICAgICAgaWYgKCF0aGlzLmNvbXBhbmlvbktleXNQYXJhbXMpIHsKICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzLnBvc3QoYCR7dGhpcy5pZH0vcHJlYXV0aC9gLCB7CiAgICAgICAgcGFyYW1zOiB0aGlzLmNvbXBhbmlvbktleXNQYXJhbXMKICAgICAgfSkudGhlbihyZXMgPT4gewogICAgICAgIHRoaXMucHJlQXV0aFRva2VuID0gcmVzLnRva2VuOwogICAgICB9KS5jYXRjaChlcnIgPT4gewogICAgICAgIHRoaXMudXBweS5sb2coYFtDb21wYW5pb25DbGllbnRdIHVuYWJsZSB0byBmZXRjaCBwcmVBdXRoVG9rZW4gJHtlcnJ9YCwgJ3dhcm5pbmcnKTsKICAgICAgfSk7CiAgICB9CgogICAgbGlzdChkaXJlY3RvcnkpIHsKICAgICAgcmV0dXJuIHRoaXMuZ2V0KGAke3RoaXMuaWR9L2xpc3QvJHtkaXJlY3RvcnkgfHwgJyd9YCk7CiAgICB9CgogICAgbG9nb3V0KCkgewogICAgICByZXR1cm4gdGhpcy5nZXQoYCR7dGhpcy5pZH0vbG9nb3V0YCkudGhlbihyZXNwb25zZSA9PiBQcm9taXNlLmFsbChbcmVzcG9uc2UsIHRoaXMudXBweS5nZXRQbHVnaW4odGhpcy5wbHVnaW5JZCkuc3RvcmFnZS5yZW1vdmVJdGVtKHRoaXMudG9rZW5LZXkpXSkpLnRoZW4oX3JlZjIgPT4gewogICAgICAgIGxldCBbcmVzcG9uc2VdID0gX3JlZjI7CiAgICAgICAgcmV0dXJuIHJlc3BvbnNlOwogICAgICB9KTsKICAgIH0KCiAgICBzdGF0aWMgaW5pdFBsdWdpbihwbHVnaW4sIG9wdHMsIGRlZmF1bHRPcHRzKSB7CiAgICAgIHBsdWdpbi50eXBlID0gJ2FjcXVpcmVyJzsKICAgICAgcGx1Z2luLmZpbGVzID0gW107CgogICAgICBpZiAoZGVmYXVsdE9wdHMpIHsKICAgICAgICBwbHVnaW4ub3B0cyA9IHsgLi4uZGVmYXVsdE9wdHMsCiAgICAgICAgICAuLi5vcHRzCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgaWYgKG9wdHMuc2VydmVyVXJsIHx8IG9wdHMuc2VydmVyUGF0dGVybikgewogICAgICAgIHRocm93IG5ldyBFcnJvcignYHNlcnZlclVybGAgYW5kIGBzZXJ2ZXJQYXR0ZXJuYCBoYXZlIGJlZW4gcmVuYW1lZCB0byBgY29tcGFuaW9uVXJsYCBhbmQgYGNvbXBhbmlvbkFsbG93ZWRIb3N0c2AgcmVzcGVjdGl2ZWx5IGluIHRoZSAwLjMwLjUgcmVsZWFzZS4gUGxlYXNlIGNvbnN1bHQgdGhlIGRvY3MgKGZvciBleGFtcGxlLCBodHRwczovL3VwcHkuaW8vZG9jcy9pbnN0YWdyYW0vIGZvciB0aGUgSW5zdGFncmFtIHBsdWdpbikgYW5kIHVzZSB0aGUgdXBkYXRlZCBvcHRpb25zLmAnKTsKICAgICAgfQoKICAgICAgaWYgKG9wdHMuY29tcGFuaW9uQWxsb3dlZEhvc3RzKSB7CiAgICAgICAgY29uc3QgcGF0dGVybiA9IG9wdHMuY29tcGFuaW9uQWxsb3dlZEhvc3RzOyAvLyB2YWxpZGF0ZSBjb21wYW5pb25BbGxvd2VkSG9zdHMgcGFyYW0KCiAgICAgICAgaWYgKHR5cGVvZiBwYXR0ZXJuICE9PSAnc3RyaW5nJyAmJiAhQXJyYXkuaXNBcnJheShwYXR0ZXJuKSAmJiAhKHBhdHRlcm4gaW5zdGFuY2VvZiBSZWdFeHApKSB7CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKGAke3BsdWdpbi5pZH06IHRoZSBvcHRpb24gImNvbXBhbmlvbkFsbG93ZWRIb3N0cyIgbXVzdCBiZSBvbmUgb2Ygc3RyaW5nLCBBcnJheSwgUmVnRXhwYCk7CiAgICAgICAgfQoKICAgICAgICBwbHVnaW4ub3B0cy5jb21wYW5pb25BbGxvd2VkSG9zdHMgPSBwYXR0ZXJuOwogICAgICB9IGVsc2UgaWYgKC9eKD8haHR0cHM/OlwvXC8pLiokL2kudGVzdChvcHRzLmNvbXBhbmlvblVybCkpIHsKICAgICAgICAvLyBkb2VzIG5vdCBzdGFydCB3aXRoIGh0dHBzOi8vCiAgICAgICAgcGx1Z2luLm9wdHMuY29tcGFuaW9uQWxsb3dlZEhvc3RzID0gYGh0dHBzOi8vJHtvcHRzLmNvbXBhbmlvblVybC5yZXBsYWNlKC9eXC9cLy8sICcnKX1gOwogICAgICB9IGVsc2UgewogICAgICAgIHBsdWdpbi5vcHRzLmNvbXBhbmlvbkFsbG93ZWRIb3N0cyA9IG5ldyBVUkwob3B0cy5jb21wYW5pb25VcmwpLm9yaWdpbjsKICAgICAgfQoKICAgICAgcGx1Z2luLnN0b3JhZ2UgPSBwbHVnaW4ub3B0cy5zdG9yYWdlIHx8IHRva2VuU3RvcmFnZTsKICAgIH0KCiAgfTsKCiAgY29uc3QgZ2V0TmFtZSA9IGlkID0+IHsKICAgIHJldHVybiBpZC5zcGxpdCgnLScpLm1hcChzID0+IHMuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBzLnNsaWNlKDEpKS5qb2luKCcgJyk7CiAgfTsKCiAgdmFyIFNlYXJjaFByb3ZpZGVyXzEgPSBjbGFzcyBTZWFyY2hQcm92aWRlciBleHRlbmRzIFJlcXVlc3RDbGllbnRfMSB7CiAgICBjb25zdHJ1Y3Rvcih1cHB5LCBvcHRzKSB7CiAgICAgIHN1cGVyKHVwcHksIG9wdHMpOwogICAgICB0aGlzLnByb3ZpZGVyID0gb3B0cy5wcm92aWRlcjsKICAgICAgdGhpcy5pZCA9IHRoaXMucHJvdmlkZXI7CiAgICAgIHRoaXMubmFtZSA9IHRoaXMub3B0cy5uYW1lIHx8IGdldE5hbWUodGhpcy5pZCk7CiAgICAgIHRoaXMucGx1Z2luSWQgPSB0aGlzLm9wdHMucGx1Z2luSWQ7CiAgICB9CgogICAgZmlsZVVybChpZCkgewogICAgICByZXR1cm4gYCR7dGhpcy5ob3N0bmFtZX0vc2VhcmNoLyR7dGhpcy5pZH0vZ2V0LyR7aWR9YDsKICAgIH0KCiAgICBzZWFyY2godGV4dCwgcXVlcmllcykgewogICAgICBxdWVyaWVzID0gcXVlcmllcyA/IGAmJHtxdWVyaWVzfWAgOiAnJzsKICAgICAgcmV0dXJuIHRoaXMuZ2V0KGBzZWFyY2gvJHt0aGlzLmlkfS9saXN0P3E9JHtlbmNvZGVVUklDb21wb25lbnQodGV4dCl9JHtxdWVyaWVzfWApOwogICAgfQoKICB9OwoKICB2YXIgX3F1ZXVlZCwgX2VtaXR0ZXIkMSwgX2lzT3BlbiwgX3NvY2tldCwgX2hhbmRsZU1lc3NhZ2U7CgogIGxldCBfU3ltYm9sJGZvciwgX1N5bWJvbCRmb3IyOwoKICBmdW5jdGlvbiBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkMyhyZWNlaXZlciwgcHJpdmF0ZUtleSkgeyBpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChyZWNlaXZlciwgcHJpdmF0ZUtleSkpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiYXR0ZW1wdGVkIHRvIHVzZSBwcml2YXRlIGZpZWxkIG9uIG5vbi1pbnN0YW5jZSIpOyB9IHJldHVybiByZWNlaXZlcjsgfQoKICB2YXIgaWQkMyA9IDA7CgogIGZ1bmN0aW9uIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlS2V5JDMobmFtZSkgeyByZXR1cm4gIl9fcHJpdmF0ZV8iICsgaWQkMysrICsgIl8iICsgbmFtZTsgfQoKCgogIHZhciBTb2NrZXQkMSA9IChfcXVldWVkID0gLyojX19QVVJFX18qL19jbGFzc1ByaXZhdGVGaWVsZExvb3NlS2V5JDMoInF1ZXVlZCIpLCBfZW1pdHRlciQxID0gLyojX19QVVJFX18qL19jbGFzc1ByaXZhdGVGaWVsZExvb3NlS2V5JDMoImVtaXR0ZXIiKSwgX2lzT3BlbiA9IC8qI19fUFVSRV9fKi9fY2xhc3NQcml2YXRlRmllbGRMb29zZUtleSQzKCJpc09wZW4iKSwgX3NvY2tldCA9IC8qI19fUFVSRV9fKi9fY2xhc3NQcml2YXRlRmllbGRMb29zZUtleSQzKCJzb2NrZXQiKSwgX2hhbmRsZU1lc3NhZ2UgPSAvKiNfX1BVUkVfXyovX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VLZXkkMygiaGFuZGxlTWVzc2FnZSIpLCBfU3ltYm9sJGZvciA9IFN5bWJvbC5mb3IoJ3VwcHkgdGVzdDogZ2V0U29ja2V0JyksIF9TeW1ib2wkZm9yMiA9IFN5bWJvbC5mb3IoJ3VwcHkgdGVzdDogZ2V0UXVldWVkJyksIGNsYXNzIFVwcHlTb2NrZXQgewogICAgY29uc3RydWN0b3Iob3B0cykgewogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgX3F1ZXVlZCwgewogICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgIHZhbHVlOiBbXQogICAgICB9KTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIF9lbWl0dGVyJDEsIHsKICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICB2YWx1ZTogbmFtZXNwYWNlRW1pdHRlcigpCiAgICAgIH0pOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgX2lzT3BlbiwgewogICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgIHZhbHVlOiBmYWxzZQogICAgICB9KTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIF9zb2NrZXQsIHsKICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICB2YWx1ZTogdm9pZCAwCiAgICAgIH0pOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgX2hhbmRsZU1lc3NhZ2UsIHsKICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICB2YWx1ZTogZSA9PiB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gSlNPTi5wYXJzZShlLmRhdGEpOwogICAgICAgICAgICB0aGlzLmVtaXQobWVzc2FnZS5hY3Rpb24sIG1lc3NhZ2UucGF5bG9hZCk7CiAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgLy8gVE9ETzogdXNlIGEgbW9yZSByb2J1c3QgZXJyb3IgaGFuZGxlci4KICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zb2xlCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5vcHRzID0gb3B0czsKCiAgICAgIGlmICghb3B0cyB8fCBvcHRzLmF1dG9PcGVuICE9PSBmYWxzZSkgewogICAgICAgIHRoaXMub3BlbigpOwogICAgICB9CiAgICB9CgogICAgZ2V0IGlzT3BlbigpIHsKICAgICAgcmV0dXJuIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQzKHRoaXMsIF9pc09wZW4pW19pc09wZW5dOwogICAgfQoKICAgIFtfU3ltYm9sJGZvcl0oKSB7CiAgICAgIHJldHVybiBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkMyh0aGlzLCBfc29ja2V0KVtfc29ja2V0XTsKICAgIH0KCiAgICBbX1N5bWJvbCRmb3IyXSgpIHsKICAgICAgcmV0dXJuIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQzKHRoaXMsIF9xdWV1ZWQpW19xdWV1ZWRdOwogICAgfQoKICAgIG9wZW4oKSB7CiAgICAgIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQzKHRoaXMsIF9zb2NrZXQpW19zb2NrZXRdID0gbmV3IFdlYlNvY2tldCh0aGlzLm9wdHMudGFyZ2V0KTsKCiAgICAgIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQzKHRoaXMsIF9zb2NrZXQpW19zb2NrZXRdLm9ub3BlbiA9ICgpID0+IHsKICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkMyh0aGlzLCBfaXNPcGVuKVtfaXNPcGVuXSA9IHRydWU7CgogICAgICAgIHdoaWxlIChfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkMyh0aGlzLCBfcXVldWVkKVtfcXVldWVkXS5sZW5ndGggPiAwICYmIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQzKHRoaXMsIF9pc09wZW4pW19pc09wZW5dKSB7CiAgICAgICAgICBjb25zdCBmaXJzdCA9IF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQzKHRoaXMsIF9xdWV1ZWQpW19xdWV1ZWRdLnNoaWZ0KCk7CgogICAgICAgICAgdGhpcy5zZW5kKGZpcnN0LmFjdGlvbiwgZmlyc3QucGF5bG9hZCk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDModGhpcywgX3NvY2tldClbX3NvY2tldF0ub25jbG9zZSA9ICgpID0+IHsKICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkMyh0aGlzLCBfaXNPcGVuKVtfaXNPcGVuXSA9IGZhbHNlOwogICAgICB9OwoKICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDModGhpcywgX3NvY2tldClbX3NvY2tldF0ub25tZXNzYWdlID0gX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDModGhpcywgX2hhbmRsZU1lc3NhZ2UpW19oYW5kbGVNZXNzYWdlXTsKICAgIH0KCiAgICBjbG9zZSgpIHsKICAgICAgdmFyIF9jbGFzc1ByaXZhdGVGaWVsZExvbzsKCiAgICAgIChfY2xhc3NQcml2YXRlRmllbGRMb28gPSBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkMyh0aGlzLCBfc29ja2V0KVtfc29ja2V0XSkgPT0gbnVsbCA/IHZvaWQgMCA6IF9jbGFzc1ByaXZhdGVGaWVsZExvby5jbG9zZSgpOwogICAgfQoKICAgIHNlbmQoYWN0aW9uLCBwYXlsb2FkKSB7CiAgICAgIC8vIGF0dGFjaCB1dWlkCiAgICAgIGlmICghX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDModGhpcywgX2lzT3BlbilbX2lzT3Blbl0pIHsKICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkMyh0aGlzLCBfcXVldWVkKVtfcXVldWVkXS5wdXNoKHsKICAgICAgICAgIGFjdGlvbiwKICAgICAgICAgIHBheWxvYWQKICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkMyh0aGlzLCBfc29ja2V0KVtfc29ja2V0XS5zZW5kKEpTT04uc3RyaW5naWZ5KHsKICAgICAgICBhY3Rpb24sCiAgICAgICAgcGF5bG9hZAogICAgICB9KSk7CiAgICB9CgogICAgb24oYWN0aW9uLCBoYW5kbGVyKSB7CiAgICAgIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQzKHRoaXMsIF9lbWl0dGVyJDEpW19lbWl0dGVyJDFdLm9uKGFjdGlvbiwgaGFuZGxlcik7CiAgICB9CgogICAgZW1pdChhY3Rpb24sIHBheWxvYWQpIHsKICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDModGhpcywgX2VtaXR0ZXIkMSlbX2VtaXR0ZXIkMV0uZW1pdChhY3Rpb24sIHBheWxvYWQpOwogICAgfQoKICAgIG9uY2UoYWN0aW9uLCBoYW5kbGVyKSB7CiAgICAgIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQzKHRoaXMsIF9lbWl0dGVyJDEpW19lbWl0dGVyJDFdLm9uY2UoYWN0aW9uLCBoYW5kbGVyKTsKICAgIH0KCiAgfSk7CgogIC8qKgogICAqIE1hbmFnZXMgY29tbXVuaWNhdGlvbnMgd2l0aCBDb21wYW5pb24KICAgKi8KCgoKCgoKCgoKICB2YXIgbGliJDEgPSB7CiAgICBSZXF1ZXN0Q2xpZW50OiBSZXF1ZXN0Q2xpZW50XzEsCiAgICBQcm92aWRlcjogUHJvdmlkZXJfMSwKICAgIFNlYXJjaFByb3ZpZGVyOiBTZWFyY2hQcm92aWRlcl8xLAogICAgU29ja2V0OiBTb2NrZXQkMQogIH07CgogIGZ1bmN0aW9uIGVtaXRTb2NrZXRQcm9ncmVzcyh1cGxvYWRlciwgcHJvZ3Jlc3NEYXRhLCBmaWxlKSB7CiAgICBjb25zdCB7CiAgICAgIHByb2dyZXNzLAogICAgICBieXRlc1VwbG9hZGVkLAogICAgICBieXRlc1RvdGFsCiAgICB9ID0gcHJvZ3Jlc3NEYXRhOwoKICAgIGlmIChwcm9ncmVzcykgewogICAgICB1cGxvYWRlci51cHB5LmxvZyhgVXBsb2FkIHByb2dyZXNzOiAke3Byb2dyZXNzfWApOwogICAgICB1cGxvYWRlci51cHB5LmVtaXQoJ3VwbG9hZC1wcm9ncmVzcycsIGZpbGUsIHsKICAgICAgICB1cGxvYWRlciwKICAgICAgICBieXRlc1VwbG9hZGVkLAogICAgICAgIGJ5dGVzVG90YWwKICAgICAgfSk7CiAgICB9CiAgfQoKICB2YXIgZW1pdFNvY2tldFByb2dyZXNzXzEgPSBsb2Rhc2hfdGhyb3R0bGUoZW1pdFNvY2tldFByb2dyZXNzLCAzMDAsIHsKICAgIGxlYWRpbmc6IHRydWUsCiAgICB0cmFpbGluZzogdHJ1ZQogIH0pOwoKICB2YXIgZ2V0U29ja2V0SG9zdCA9IGZ1bmN0aW9uIGdldFNvY2tldEhvc3QodXJsKSB7CiAgICAvLyBnZXQgdGhlIGhvc3QgZG9tYWluCiAgICBjb25zdCByZWdleCA9IC9eKD86aHR0cHM/OlwvXC98XC9cLyk/KD86W15AXG5dK0ApPyg/Ond3d1wuKT8oW15cbl0rKS9pOwogICAgY29uc3QgaG9zdCA9IHJlZ2V4LmV4ZWModXJsKVsxXTsKICAgIGNvbnN0IHNvY2tldFByb3RvY29sID0gL15odHRwOlwvXC8vaS50ZXN0KHVybCkgPyAnd3MnIDogJ3dzcyc7CiAgICByZXR1cm4gYCR7c29ja2V0UHJvdG9jb2x9Oi8vJHtob3N0fWA7CiAgfTsKCiAgdmFyIHNldHRsZSA9IGZ1bmN0aW9uIHNldHRsZShwcm9taXNlcykgewogICAgY29uc3QgcmVzb2x1dGlvbnMgPSBbXTsKICAgIGNvbnN0IHJlamVjdGlvbnMgPSBbXTsKCiAgICBmdW5jdGlvbiByZXNvbHZlZCh2YWx1ZSkgewogICAgICByZXNvbHV0aW9ucy5wdXNoKHZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZWplY3RlZChlcnJvcikgewogICAgICByZWplY3Rpb25zLnB1c2goZXJyb3IpOwogICAgfQoKICAgIGNvbnN0IHdhaXQgPSBQcm9taXNlLmFsbChwcm9taXNlcy5tYXAocHJvbWlzZSA9PiBwcm9taXNlLnRoZW4ocmVzb2x2ZWQsIHJlamVjdGVkKSkpOwogICAgcmV0dXJuIHdhaXQudGhlbigoKSA9PiB7CiAgICAgIHJldHVybiB7CiAgICAgICAgc3VjY2Vzc2Z1bDogcmVzb2x1dGlvbnMsCiAgICAgICAgZmFpbGVkOiByZWplY3Rpb25zCiAgICAgIH07CiAgICB9KTsKICB9OwoKICB2YXIgX2VtaXR0ZXIsIF9ldmVudHM7CgogIGZ1bmN0aW9uIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQyKHJlY2VpdmVyLCBwcml2YXRlS2V5KSB7IGlmICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHJlY2VpdmVyLCBwcml2YXRlS2V5KSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJhdHRlbXB0ZWQgdG8gdXNlIHByaXZhdGUgZmllbGQgb24gbm9uLWluc3RhbmNlIik7IH0gcmV0dXJuIHJlY2VpdmVyOyB9CgogIHZhciBpZCQyID0gMDsKCiAgZnVuY3Rpb24gX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VLZXkkMihuYW1lKSB7IHJldHVybiAiX19wcml2YXRlXyIgKyBpZCQyKysgKyAiXyIgKyBuYW1lOyB9CgogIC8qKgogICAqIENyZWF0ZSBhIHdyYXBwZXIgYXJvdW5kIGFuIGV2ZW50IGVtaXR0ZXIgd2l0aCBhIGByZW1vdmVgIG1ldGhvZCB0byByZW1vdmUKICAgKiBhbGwgZXZlbnRzIHRoYXQgd2VyZSBhZGRlZCB1c2luZyB0aGUgd3JhcHBlZCBlbWl0dGVyLgogICAqLwogIHZhciBFdmVudFRyYWNrZXJfMSA9IChfZW1pdHRlciA9IC8qI19fUFVSRV9fKi9fY2xhc3NQcml2YXRlRmllbGRMb29zZUtleSQyKCJlbWl0dGVyIiksIF9ldmVudHMgPSAvKiNfX1BVUkVfXyovX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VLZXkkMigiZXZlbnRzIiksIGNsYXNzIEV2ZW50VHJhY2tlciB7CiAgICBjb25zdHJ1Y3RvcihlbWl0dGVyKSB7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBfZW1pdHRlciwgewogICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgIHZhbHVlOiB2b2lkIDAKICAgICAgfSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBfZXZlbnRzLCB7CiAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgdmFsdWU6IFtdCiAgICAgIH0pOwogICAgICBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkMih0aGlzLCBfZW1pdHRlcilbX2VtaXR0ZXJdID0gZW1pdHRlcjsKICAgIH0KCiAgICBvbihldmVudCwgZm4pIHsKICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDIodGhpcywgX2V2ZW50cylbX2V2ZW50c10ucHVzaChbZXZlbnQsIGZuXSk7CgogICAgICByZXR1cm4gX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDIodGhpcywgX2VtaXR0ZXIpW19lbWl0dGVyXS5vbihldmVudCwgZm4pOwogICAgfQoKICAgIHJlbW92ZSgpIHsKICAgICAgZm9yIChjb25zdCBbZXZlbnQsIGZuXSBvZiBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkMih0aGlzLCBfZXZlbnRzKVtfZXZlbnRzXS5zcGxpY2UoMCkpIHsKICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkMih0aGlzLCBfZW1pdHRlcilbX2VtaXR0ZXJdLm9mZihldmVudCwgZm4pOwogICAgICB9CiAgICB9CgogIH0pOwoKICBmdW5jdGlvbiBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkMShyZWNlaXZlciwgcHJpdmF0ZUtleSkgeyBpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChyZWNlaXZlciwgcHJpdmF0ZUtleSkpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiYXR0ZW1wdGVkIHRvIHVzZSBwcml2YXRlIGZpZWxkIG9uIG5vbi1pbnN0YW5jZSIpOyB9IHJldHVybiByZWNlaXZlcjsgfQoKICB2YXIgaWQkMSA9IDA7CgogIGZ1bmN0aW9uIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlS2V5JDEobmFtZSkgeyByZXR1cm4gIl9fcHJpdmF0ZV8iICsgaWQkMSsrICsgIl8iICsgbmFtZTsgfQoKICB2YXIgX2FsaXZlVGltZXIgPSAvKiNfX1BVUkVfXyovX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VLZXkkMSgiYWxpdmVUaW1lciIpOwoKICB2YXIgX2lzRG9uZSA9IC8qI19fUFVSRV9fKi9fY2xhc3NQcml2YXRlRmllbGRMb29zZUtleSQxKCJpc0RvbmUiKTsKCiAgdmFyIF9vblRpbWVkT3V0ID0gLyojX19QVVJFX18qL19jbGFzc1ByaXZhdGVGaWVsZExvb3NlS2V5JDEoIm9uVGltZWRPdXQiKTsKCiAgdmFyIF90aW1lb3V0ID0gLyojX19QVVJFX18qL19jbGFzc1ByaXZhdGVGaWVsZExvb3NlS2V5JDEoInRpbWVvdXQiKTsKCiAgLyoqCiAgICogSGVscGVyIHRvIGFib3J0IHVwbG9hZCByZXF1ZXN0cyBpZiB0aGVyZSBoYXMgbm90IGJlZW4gYW55IHByb2dyZXNzIGZvciBgdGltZW91dGAgbXMuCiAgICogQ3JlYXRlIGFuIGluc3RhbmNlIHVzaW5nIGB0aW1lciA9IG5ldyBQcm9ncmVzc1RpbWVvdXQoMTAwMDAsIG9uVGltZW91dClgCiAgICogQ2FsbCBgdGltZXIucHJvZ3Jlc3MoKWAgdG8gc2lnbmFsIHRoYXQgdGhlcmUgaGFzIGJlZW4gcHJvZ3Jlc3Mgb2YgYW55IGtpbmQuCiAgICogQ2FsbCBgdGltZXIuZG9uZSgpYCB3aGVuIHRoZSB1cGxvYWQgaGFzIGNvbXBsZXRlZC4KICAgKi8KICBjbGFzcyBQcm9ncmVzc1RpbWVvdXQgewogICAgY29uc3RydWN0b3IodGltZW91dCwgdGltZW91dEhhbmRsZXIpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIF9hbGl2ZVRpbWVyLCB7CiAgICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgICAgdmFsdWU6IHZvaWQgMAogICAgICB9KTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIF9pc0RvbmUsIHsKICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICB2YWx1ZTogZmFsc2UKICAgICAgfSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBfb25UaW1lZE91dCwgewogICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgIHZhbHVlOiB2b2lkIDAKICAgICAgfSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBfdGltZW91dCwgewogICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgIHZhbHVlOiB2b2lkIDAKICAgICAgfSk7CiAgICAgIF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSQxKHRoaXMsIF90aW1lb3V0KVtfdGltZW91dF0gPSB0aW1lb3V0OwogICAgICBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkMSh0aGlzLCBfb25UaW1lZE91dClbX29uVGltZWRPdXRdID0gdGltZW91dEhhbmRsZXI7CiAgICB9CgogICAgcHJvZ3Jlc3MoKSB7CiAgICAgIC8vIFNvbWUgYnJvd3NlcnMgZmlyZSBhbm90aGVyIHByb2dyZXNzIGV2ZW50IHdoZW4gdGhlIHVwbG9hZCBpcwogICAgICAvLyBjYW5jZWxsZWQsIHNvIHdlIGhhdmUgdG8gaWdub3JlIHByb2dyZXNzIGFmdGVyIHRoZSB0aW1lciB3YXMKICAgICAgLy8gdG9sZCB0byBzdG9wLgogICAgICBpZiAoX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDEodGhpcywgX2lzRG9uZSlbX2lzRG9uZV0pIHJldHVybjsKCiAgICAgIGlmIChfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkMSh0aGlzLCBfdGltZW91dClbX3RpbWVvdXRdID4gMCkgewogICAgICAgIGNsZWFyVGltZW91dChfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkMSh0aGlzLCBfYWxpdmVUaW1lcilbX2FsaXZlVGltZXJdKTsKICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkMSh0aGlzLCBfYWxpdmVUaW1lcilbX2FsaXZlVGltZXJdID0gc2V0VGltZW91dChfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkMSh0aGlzLCBfb25UaW1lZE91dClbX29uVGltZWRPdXRdLCBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UkMSh0aGlzLCBfdGltZW91dClbX3RpbWVvdXRdKTsKICAgICAgfQogICAgfQoKICAgIGRvbmUoKSB7CiAgICAgIGlmICghX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDEodGhpcywgX2lzRG9uZSlbX2lzRG9uZV0pIHsKICAgICAgICBjbGVhclRpbWVvdXQoX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDEodGhpcywgX2FsaXZlVGltZXIpW19hbGl2ZVRpbWVyXSk7CiAgICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDEodGhpcywgX2FsaXZlVGltZXIpW19hbGl2ZVRpbWVyXSA9IG51bGw7CiAgICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlJDEodGhpcywgX2lzRG9uZSlbX2lzRG9uZV0gPSB0cnVlOwogICAgICB9CiAgICB9CgogIH0KCiAgdmFyIFByb2dyZXNzVGltZW91dF8xID0gUHJvZ3Jlc3NUaW1lb3V0OwoKICBmdW5jdGlvbiBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UocmVjZWl2ZXIsIHByaXZhdGVLZXkpIHsgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocmVjZWl2ZXIsIHByaXZhdGVLZXkpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoImF0dGVtcHRlZCB0byB1c2UgcHJpdmF0ZSBmaWVsZCBvbiBub24taW5zdGFuY2UiKTsgfSByZXR1cm4gcmVjZWl2ZXI7IH0KCiAgdmFyIGlkID0gMDsKCiAgZnVuY3Rpb24gX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VLZXkobmFtZSkgeyByZXR1cm4gIl9fcHJpdmF0ZV8iICsgaWQrKyArICJfIiArIG5hbWU7IH0KCiAgZnVuY3Rpb24gY3JlYXRlQ2FuY2VsRXJyb3IoKSB7CiAgICByZXR1cm4gbmV3IEVycm9yKCdDYW5jZWxsZWQnKTsKICB9CgogIHZhciBfYWN0aXZlUmVxdWVzdHMgPSAvKiNfX1BVUkVfXyovX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VLZXkoImFjdGl2ZVJlcXVlc3RzIik7CgogIHZhciBfcXVldWVkSGFuZGxlcnMgPSAvKiNfX1BVUkVfXyovX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VLZXkoInF1ZXVlZEhhbmRsZXJzIik7CgogIHZhciBfY2FsbCA9IC8qI19fUFVSRV9fKi9fY2xhc3NQcml2YXRlRmllbGRMb29zZUtleSgiY2FsbCIpOwoKICB2YXIgX3F1ZXVlTmV4dCA9IC8qI19fUFVSRV9fKi9fY2xhc3NQcml2YXRlRmllbGRMb29zZUtleSgicXVldWVOZXh0Iik7CgogIHZhciBfbmV4dCA9IC8qI19fUFVSRV9fKi9fY2xhc3NQcml2YXRlRmllbGRMb29zZUtleSgibmV4dCIpOwoKICB2YXIgX3F1ZXVlID0gLyojX19QVVJFX18qL19jbGFzc1ByaXZhdGVGaWVsZExvb3NlS2V5KCJxdWV1ZSIpOwoKICB2YXIgX2RlcXVldWUgPSAvKiNfX1BVUkVfXyovX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VLZXkoImRlcXVldWUiKTsKCiAgY2xhc3MgUmF0ZUxpbWl0ZWRRdWV1ZSQxIHsKICAgIGNvbnN0cnVjdG9yKGxpbWl0KSB7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBfZGVxdWV1ZSwgewogICAgICAgIHZhbHVlOiBfZGVxdWV1ZTIKICAgICAgfSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBfcXVldWUsIHsKICAgICAgICB2YWx1ZTogX3F1ZXVlMgogICAgICB9KTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIF9uZXh0LCB7CiAgICAgICAgdmFsdWU6IF9uZXh0MgogICAgICB9KTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIF9xdWV1ZU5leHQsIHsKICAgICAgICB2YWx1ZTogX3F1ZXVlTmV4dDIKICAgICAgfSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBfY2FsbCwgewogICAgICAgIHZhbHVlOiBfY2FsbDIKICAgICAgfSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBfYWN0aXZlUmVxdWVzdHMsIHsKICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICB2YWx1ZTogMAogICAgICB9KTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIF9xdWV1ZWRIYW5kbGVycywgewogICAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICAgIHZhbHVlOiBbXQogICAgICB9KTsKCiAgICAgIGlmICh0eXBlb2YgbGltaXQgIT09ICdudW1iZXInIHx8IGxpbWl0ID09PSAwKSB7CiAgICAgICAgdGhpcy5saW1pdCA9IEluZmluaXR5OwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMubGltaXQgPSBsaW1pdDsKICAgICAgfQogICAgfQoKICAgIHJ1bihmbiwgcXVldWVPcHRpb25zKSB7CiAgICAgIGlmIChfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UodGhpcywgX2FjdGl2ZVJlcXVlc3RzKVtfYWN0aXZlUmVxdWVzdHNdIDwgdGhpcy5saW1pdCkgewogICAgICAgIHJldHVybiBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UodGhpcywgX2NhbGwpW19jYWxsXShmbik7CiAgICAgIH0KCiAgICAgIHJldHVybiBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UodGhpcywgX3F1ZXVlKVtfcXVldWVdKGZuLCBxdWV1ZU9wdGlvbnMpOwogICAgfQoKICAgIHdyYXBQcm9taXNlRnVuY3Rpb24oZm4sIHF1ZXVlT3B0aW9ucykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IG5ldyBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsKICAgICAgICAgIGFyZ3NbX2tleV0gPSBhcmd1bWVudHNbX2tleV07CiAgICAgICAgfQoKICAgICAgICBsZXQgcXVldWVkUmVxdWVzdDsKICAgICAgICBjb25zdCBvdXRlclByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgICBxdWV1ZWRSZXF1ZXN0ID0gX3RoaXMucnVuKCgpID0+IHsKICAgICAgICAgICAgbGV0IGNhbmNlbEVycm9yOwogICAgICAgICAgICBsZXQgaW5uZXJQcm9taXNlOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBpbm5lclByb21pc2UgPSBQcm9taXNlLnJlc29sdmUoZm4oLi4uYXJncykpOwogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICBpbm5lclByb21pc2UgPSBQcm9taXNlLnJlamVjdChlcnIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpbm5lclByb21pc2UudGhlbihyZXN1bHQgPT4gewogICAgICAgICAgICAgIGlmIChjYW5jZWxFcnJvcikgewogICAgICAgICAgICAgICAgcmVqZWN0KGNhbmNlbEVycm9yKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcXVldWVkUmVxdWVzdC5kb25lKCk7CiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBlcnIgPT4gewogICAgICAgICAgICAgIGlmIChjYW5jZWxFcnJvcikgewogICAgICAgICAgICAgICAgcmVqZWN0KGNhbmNlbEVycm9yKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcXVldWVkUmVxdWVzdC5kb25lKCk7CiAgICAgICAgICAgICAgICByZWplY3QoZXJyKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gKCkgPT4gewogICAgICAgICAgICAgIGNhbmNlbEVycm9yID0gY3JlYXRlQ2FuY2VsRXJyb3IoKTsKICAgICAgICAgICAgfTsKICAgICAgICAgIH0sIHF1ZXVlT3B0aW9ucyk7CiAgICAgICAgfSk7CgogICAgICAgIG91dGVyUHJvbWlzZS5hYm9ydCA9ICgpID0+IHsKICAgICAgICAgIHF1ZXVlZFJlcXVlc3QuYWJvcnQoKTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gb3V0ZXJQcm9taXNlOwogICAgICB9OwogICAgfQoKICB9CgogIGZ1bmN0aW9uIF9jYWxsMihmbikgewogICAgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlKHRoaXMsIF9hY3RpdmVSZXF1ZXN0cylbX2FjdGl2ZVJlcXVlc3RzXSArPSAxOwogICAgbGV0IGRvbmUgPSBmYWxzZTsKICAgIGxldCBjYW5jZWxBY3RpdmU7CgogICAgdHJ5IHsKICAgICAgY2FuY2VsQWN0aXZlID0gZm4oKTsKICAgIH0gY2F0Y2ggKGVycikgewogICAgICBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UodGhpcywgX2FjdGl2ZVJlcXVlc3RzKVtfYWN0aXZlUmVxdWVzdHNdIC09IDE7CiAgICAgIHRocm93IGVycjsKICAgIH0KCiAgICByZXR1cm4gewogICAgICBhYm9ydDogKCkgPT4gewogICAgICAgIGlmIChkb25lKSByZXR1cm47CiAgICAgICAgZG9uZSA9IHRydWU7CiAgICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlKHRoaXMsIF9hY3RpdmVSZXF1ZXN0cylbX2FjdGl2ZVJlcXVlc3RzXSAtPSAxOwogICAgICAgIGNhbmNlbEFjdGl2ZSgpOwoKICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UodGhpcywgX3F1ZXVlTmV4dClbX3F1ZXVlTmV4dF0oKTsKICAgICAgfSwKICAgICAgZG9uZTogKCkgPT4gewogICAgICAgIGlmIChkb25lKSByZXR1cm47CiAgICAgICAgZG9uZSA9IHRydWU7CiAgICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlKHRoaXMsIF9hY3RpdmVSZXF1ZXN0cylbX2FjdGl2ZVJlcXVlc3RzXSAtPSAxOwoKICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UodGhpcywgX3F1ZXVlTmV4dClbX3F1ZXVlTmV4dF0oKTsKICAgICAgfQogICAgfTsKICB9CgogIGZ1bmN0aW9uIF9xdWV1ZU5leHQyKCkgewogICAgLy8gRG8gaXQgc29vbiBidXQgbm90IGltbWVkaWF0ZWx5LCB0aGlzIGFsbG93cyBjbGVhcmluZyBvdXQgdGhlIGVudGlyZSBxdWV1ZSBzeW5jaHJvbm91c2x5CiAgICAvLyBvbmUgYnkgb25lIHdpdGhvdXQgY29udGludW91c2x5IF9hZHZhbmNpbmdfIGl0IChhbmQgc3RhcnRpbmcgbmV3IHRhc2tzIGJlZm9yZSBpbW1lZGlhdGVseQogICAgLy8gYWJvcnRpbmcgdGhlbSkKICAgIHF1ZXVlTWljcm90YXNrKCgpID0+IF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSh0aGlzLCBfbmV4dClbX25leHRdKCkpOwogIH0KCiAgZnVuY3Rpb24gX25leHQyKCkgewogICAgaWYgKF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSh0aGlzLCBfYWN0aXZlUmVxdWVzdHMpW19hY3RpdmVSZXF1ZXN0c10gPj0gdGhpcy5saW1pdCkgewogICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSh0aGlzLCBfcXVldWVkSGFuZGxlcnMpW19xdWV1ZWRIYW5kbGVyc10ubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybjsKICAgIH0gLy8gRGlzcGF0Y2ggdGhlIG5leHQgcmVxdWVzdCwgYW5kIHVwZGF0ZSB0aGUgYWJvcnQvZG9uZSBoYW5kbGVycwogICAgLy8gc28gdGhhdCBjYW5jZWxsaW5nIGl0IGRvZXMgdGhlIFJpZ2h0IFRoaW5nIChhbmQgZG9lc24ndCBqdXN0IHRyeQogICAgLy8gdG8gZGVxdWV1ZSBhbiBhbHJlYWR5LXJ1bm5pbmcgcmVxdWVzdCkuCgoKICAgIGNvbnN0IG5leHQgPSBfY2xhc3NQcml2YXRlRmllbGRMb29zZUJhc2UodGhpcywgX3F1ZXVlZEhhbmRsZXJzKVtfcXVldWVkSGFuZGxlcnNdLnNoaWZ0KCk7CgogICAgY29uc3QgaGFuZGxlciA9IF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSh0aGlzLCBfY2FsbClbX2NhbGxdKG5leHQuZm4pOwoKICAgIG5leHQuYWJvcnQgPSBoYW5kbGVyLmFib3J0OwogICAgbmV4dC5kb25lID0gaGFuZGxlci5kb25lOwogIH0KCiAgZnVuY3Rpb24gX3F1ZXVlMihmbiwgb3B0aW9ucykgewogICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICBvcHRpb25zID0ge307CiAgICB9CgogICAgY29uc3QgaGFuZGxlciA9IHsKICAgICAgZm4sCiAgICAgIHByaW9yaXR5OiBvcHRpb25zLnByaW9yaXR5IHx8IDAsCiAgICAgIGFib3J0OiAoKSA9PiB7CiAgICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlKHRoaXMsIF9kZXF1ZXVlKVtfZGVxdWV1ZV0oaGFuZGxlcik7CiAgICAgIH0sCiAgICAgIGRvbmU6ICgpID0+IHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBtYXJrIGEgcXVldWVkIHJlcXVlc3QgYXMgZG9uZTogdGhpcyBpbmRpY2F0ZXMgYSBidWcnKTsKICAgICAgfQogICAgfTsKCiAgICBjb25zdCBpbmRleCA9IF9jbGFzc1ByaXZhdGVGaWVsZExvb3NlQmFzZSh0aGlzLCBfcXVldWVkSGFuZGxlcnMpW19xdWV1ZWRIYW5kbGVyc10uZmluZEluZGV4KG90aGVyID0+IHsKICAgICAgcmV0dXJuIGhhbmRsZXIucHJpb3JpdHkgPiBvdGhlci5wcmlvcml0eTsKICAgIH0pOwoKICAgIGlmIChpbmRleCA9PT0gLTEpIHsKICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlKHRoaXMsIF9xdWV1ZWRIYW5kbGVycylbX3F1ZXVlZEhhbmRsZXJzXS5wdXNoKGhhbmRsZXIpOwogICAgfSBlbHNlIHsKICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlKHRoaXMsIF9xdWV1ZWRIYW5kbGVycylbX3F1ZXVlZEhhbmRsZXJzXS5zcGxpY2UoaW5kZXgsIDAsIGhhbmRsZXIpOwogICAgfQoKICAgIHJldHVybiBoYW5kbGVyOwogIH0KCiAgZnVuY3Rpb24gX2RlcXVldWUyKGhhbmRsZXIpIHsKICAgIGNvbnN0IGluZGV4ID0gX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlKHRoaXMsIF9xdWV1ZWRIYW5kbGVycylbX3F1ZXVlZEhhbmRsZXJzXS5pbmRleE9mKGhhbmRsZXIpOwoKICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkTG9vc2VCYXNlKHRoaXMsIF9xdWV1ZWRIYW5kbGVycylbX3F1ZXVlZEhhbmRsZXJzXS5zcGxpY2UoaW5kZXgsIDEpOwogICAgfQogIH0KCiAgdmFyIFJhdGVMaW1pdGVkUXVldWVfMSA9IHsKICAgIFJhdGVMaW1pdGVkUXVldWU6IFJhdGVMaW1pdGVkUXVldWUkMSwKICAgIGludGVybmFsUmF0ZUxpbWl0ZWRRdWV1ZTogU3ltYm9sKCdfX3F1ZXVlJykKICB9OwoKICBmdW5jdGlvbiBpc05ldHdvcmtFcnJvcih4aHIpIHsKICAgIGlmICgheGhyKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4geGhyLnJlYWR5U3RhdGUgIT09IDAgJiYgeGhyLnJlYWR5U3RhdGUgIT09IDQgfHwgeGhyLnN0YXR1cyA9PT0gMDsKICB9CgogIHZhciBpc05ldHdvcmtFcnJvcl8xID0gaXNOZXR3b3JrRXJyb3I7CgogIHZhciBsb2NhbGUgPSB7CiAgICBzdHJpbmdzOiB7CiAgICAgIC8vIFNob3duIGluIHRoZSBJbmZvcm1lciBpZiBhbiB1cGxvYWQgaXMgYmVpbmcgY2FuY2VsZWQgYmVjYXVzZSBpdCBzdGFsbGVkIGZvciB0b28gbG9uZy4KICAgICAgdGltZWRPdXQ6ICdVcGxvYWQgc3RhbGxlZCBmb3IgJXtzZWNvbmRzfSBzZWNvbmRzLCBhYm9ydGluZy4nCiAgICB9CiAgfTsKCiAgdmFyIF9jbGFzcywgX3RlbXA7CgoKCiAgY29uc3QgewogICAgbmFub2lkCiAgfSA9IHJlcXVpcmUkJDQ7CgogIGNvbnN0IHsKICAgIFByb3ZpZGVyLAogICAgUmVxdWVzdENsaWVudCwKICAgIFNvY2tldAogIH0gPSBsaWIkMTsKCgoKCgoKCgoKCgogIGNvbnN0IHsKICAgIFJhdGVMaW1pdGVkUXVldWUsCiAgICBpbnRlcm5hbFJhdGVMaW1pdGVkUXVldWUKICB9ID0gUmF0ZUxpbWl0ZWRRdWV1ZV8xOwoKCgoKCgoKICBmdW5jdGlvbiBidWlsZFJlc3BvbnNlRXJyb3IoeGhyLCBlcnIpIHsKICAgIGxldCBlcnJvciA9IGVycjsgLy8gTm8gZXJyb3IgbWVzc2FnZQoKICAgIGlmICghZXJyb3IpIGVycm9yID0gbmV3IEVycm9yKCdVcGxvYWQgZXJyb3InKTsgLy8gR290IGFuIGVycm9yIG1lc3NhZ2Ugc3RyaW5nCgogICAgaWYgKHR5cGVvZiBlcnJvciA9PT0gJ3N0cmluZycpIGVycm9yID0gbmV3IEVycm9yKGVycm9yKTsgLy8gR290IHNvbWV0aGluZyBlbHNlCgogICAgaWYgKCEoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikpIHsKICAgICAgZXJyb3IgPSBPYmplY3QuYXNzaWduKG5ldyBFcnJvcignVXBsb2FkIGVycm9yJyksIHsKICAgICAgICBkYXRhOiBlcnJvcgogICAgICB9KTsKICAgIH0KCiAgICBpZiAoaXNOZXR3b3JrRXJyb3JfMSh4aHIpKSB7CiAgICAgIGVycm9yID0gbmV3IE5ldHdvcmtFcnJvcl8xKGVycm9yLCB4aHIpOwogICAgICByZXR1cm4gZXJyb3I7CiAgICB9CgogICAgZXJyb3IucmVxdWVzdCA9IHhocjsKICAgIHJldHVybiBlcnJvcjsKICB9CiAgLyoqCiAgICogU2V0IGBkYXRhLnR5cGVgIGluIHRoZSBibG9iIHRvIGBmaWxlLm1ldGEudHlwZWAsCiAgICogYmVjYXVzZSB3ZSBtaWdodCBoYXZlIGRldGVjdGVkIGEgbW9yZSBhY2N1cmF0ZSBmaWxlIHR5cGUgaW4gVXBweQogICAqIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS81MDg3NTYxNQogICAqCiAgICogQHBhcmFtIHtvYmplY3R9IGZpbGUgRmlsZSBvYmplY3Qgd2l0aCBgZGF0YWAsIGBzaXplYCBhbmQgYG1ldGFgIHByb3BlcnRpZXMKICAgKiBAcmV0dXJucyB7b2JqZWN0fSBibG9iIHVwZGF0ZWQgd2l0aCB0aGUgbmV3IGB0eXBlYCBzZXQgZnJvbSBgZmlsZS5tZXRhLnR5cGVgCiAgICovCgoKICBmdW5jdGlvbiBzZXRUeXBlSW5CbG9iKGZpbGUpIHsKICAgIGNvbnN0IGRhdGFXaXRoVXBkYXRlZFR5cGUgPSBmaWxlLmRhdGEuc2xpY2UoMCwgZmlsZS5kYXRhLnNpemUsIGZpbGUubWV0YS50eXBlKTsKICAgIHJldHVybiBkYXRhV2l0aFVwZGF0ZWRUeXBlOwogIH0KCiAgdmFyIGxpYiA9IChfdGVtcCA9IF9jbGFzcyA9IGNsYXNzIFhIUlVwbG9hZCBleHRlbmRzIEJhc2VQbHVnaW5fMSQxIHsKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBnbG9iYWwtcmVxdWlyZQogICAgY29uc3RydWN0b3IodXBweSwgb3B0cykgewogICAgICBzdXBlcih1cHB5LCBvcHRzKTsKICAgICAgdGhpcy50eXBlID0gJ3VwbG9hZGVyJzsKICAgICAgdGhpcy5pZCA9IHRoaXMub3B0cy5pZCB8fCAnWEhSVXBsb2FkJzsKICAgICAgdGhpcy50aXRsZSA9ICdYSFJVcGxvYWQnOwogICAgICB0aGlzLmRlZmF1bHRMb2NhbGUgPSBsb2NhbGU7IC8vIERlZmF1bHQgb3B0aW9ucwoKICAgICAgY29uc3QgZGVmYXVsdE9wdGlvbnMgPSB7CiAgICAgICAgZm9ybURhdGE6IHRydWUsCiAgICAgICAgZmllbGROYW1lOiBvcHRzLmJ1bmRsZSA/ICdmaWxlc1tdJyA6ICdmaWxlJywKICAgICAgICBtZXRob2Q6ICdwb3N0JywKICAgICAgICBtZXRhRmllbGRzOiBudWxsLAogICAgICAgIHJlc3BvbnNlVXJsRmllbGROYW1lOiAndXJsJywKICAgICAgICBidW5kbGU6IGZhbHNlLAogICAgICAgIGhlYWRlcnM6IHt9LAogICAgICAgIHRpbWVvdXQ6IDMwICogMTAwMCwKICAgICAgICBsaW1pdDogNSwKICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IGZhbHNlLAogICAgICAgIHJlc3BvbnNlVHlwZTogJycsCgogICAgICAgIC8qKgogICAgICAgICAqIEB0eXBlZGVmIHJlc3BPYmoKICAgICAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gcmVzcG9uc2VUZXh0CiAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IHN0YXR1cwogICAgICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBzdGF0dXNUZXh0CiAgICAgICAgICogQHByb3BlcnR5IHtvYmplY3QuPHN0cmluZywgc3RyaW5nPn0gaGVhZGVycwogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHJlc3BvbnNlVGV4dCB0aGUgcmVzcG9uc2UgYm9keSBzdHJpbmcKICAgICAgICAgKiBAcGFyYW0ge1hNTEh0dHBSZXF1ZXN0IHwgcmVzcE9ian0gcmVzcG9uc2UgdGhlIHJlc3BvbnNlIG9iamVjdCAoWEhSIG9yIHNpbWlsYXIpCiAgICAgICAgICovCiAgICAgICAgZ2V0UmVzcG9uc2VEYXRhKHJlc3BvbnNlVGV4dCkgewogICAgICAgICAgbGV0IHBhcnNlZFJlc3BvbnNlID0ge307CgogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcGFyc2VkUmVzcG9uc2UgPSBKU09OLnBhcnNlKHJlc3BvbnNlVGV4dCk7CiAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgdXBweS5sb2coZXJyKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gcGFyc2VkUmVzcG9uc2U7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gcmVzcG9uc2VUZXh0IHRoZSByZXNwb25zZSBib2R5IHN0cmluZwogICAgICAgICAqIEBwYXJhbSB7WE1MSHR0cFJlcXVlc3QgfCByZXNwT2JqfSByZXNwb25zZSB0aGUgcmVzcG9uc2Ugb2JqZWN0IChYSFIgb3Igc2ltaWxhcikKICAgICAgICAgKi8KICAgICAgICBnZXRSZXNwb25zZUVycm9yKF8sIHJlc3BvbnNlKSB7CiAgICAgICAgICBsZXQgZXJyb3IgPSBuZXcgRXJyb3IoJ1VwbG9hZCBlcnJvcicpOwoKICAgICAgICAgIGlmIChpc05ldHdvcmtFcnJvcl8xKHJlc3BvbnNlKSkgewogICAgICAgICAgICBlcnJvciA9IG5ldyBOZXR3b3JrRXJyb3JfMShlcnJvciwgcmVzcG9uc2UpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBlcnJvcjsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBDaGVjayBpZiB0aGUgcmVzcG9uc2UgZnJvbSB0aGUgdXBsb2FkIGVuZHBvaW50IGluZGljYXRlcyB0aGF0IHRoZSB1cGxvYWQgd2FzIHN1Y2Nlc3NmdWwuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gc3RhdHVzIHRoZSByZXNwb25zZSBzdGF0dXMgY29kZQogICAgICAgICAqLwogICAgICAgIHZhbGlkYXRlU3RhdHVzKHN0YXR1cykgewogICAgICAgICAgcmV0dXJuIHN0YXR1cyA+PSAyMDAgJiYgc3RhdHVzIDwgMzAwOwogICAgICAgIH0KCiAgICAgIH07CiAgICAgIHRoaXMub3B0cyA9IHsgLi4uZGVmYXVsdE9wdGlvbnMsCiAgICAgICAgLi4ub3B0cwogICAgICB9OwogICAgICB0aGlzLmkxOG5Jbml0KCk7CiAgICAgIHRoaXMuaGFuZGxlVXBsb2FkID0gdGhpcy5oYW5kbGVVcGxvYWQuYmluZCh0aGlzKTsgLy8gU2ltdWx0YW5lb3VzIHVwbG9hZCBsaW1pdGluZyBpcyBzaGFyZWQgYWNyb3NzIGFsbCB1cGxvYWRzIHdpdGggdGhpcyBwbHVnaW4uCgogICAgICBpZiAoaW50ZXJuYWxSYXRlTGltaXRlZFF1ZXVlIGluIHRoaXMub3B0cykgewogICAgICAgIHRoaXMucmVxdWVzdHMgPSB0aGlzLm9wdHNbaW50ZXJuYWxSYXRlTGltaXRlZFF1ZXVlXTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnJlcXVlc3RzID0gbmV3IFJhdGVMaW1pdGVkUXVldWUodGhpcy5vcHRzLmxpbWl0KTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMub3B0cy5idW5kbGUgJiYgIXRoaXMub3B0cy5mb3JtRGF0YSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignYG9wdHMuZm9ybURhdGFgIG11c3QgYmUgdHJ1ZSB3aGVuIGBvcHRzLmJ1bmRsZWAgaXMgZW5hYmxlZC4nKTsKICAgICAgfQoKICAgICAgdGhpcy51cGxvYWRlckV2ZW50cyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICB9CgogICAgZ2V0T3B0aW9ucyhmaWxlKSB7CiAgICAgIGNvbnN0IG92ZXJyaWRlcyA9IHRoaXMudXBweS5nZXRTdGF0ZSgpLnhoclVwbG9hZDsKICAgICAgY29uc3QgewogICAgICAgIGhlYWRlcnMKICAgICAgfSA9IHRoaXMub3B0czsKICAgICAgY29uc3Qgb3B0cyA9IHsgLi4udGhpcy5vcHRzLAogICAgICAgIC4uLihvdmVycmlkZXMgfHwge30pLAogICAgICAgIC4uLihmaWxlLnhoclVwbG9hZCB8fCB7fSksCiAgICAgICAgaGVhZGVyczoge30KICAgICAgfTsgLy8gU3VwcG9ydCBmb3IgYGhlYWRlcnNgIGFzIGEgZnVuY3Rpb24sIG9ubHkgaW4gdGhlIFhIUlVwbG9hZCBzZXR0aW5ncy4KICAgICAgLy8gT3B0aW9ucyBzZXQgYnkgb3RoZXIgcGx1Z2lucyBpbiBVcHB5IHN0YXRlIG9yIG9uIHRoZSBmaWxlcyB0aGVtc2VsdmVzIGFyZSBzdGlsbCBtZXJnZWQgaW4gYWZ0ZXJ3YXJkLgogICAgICAvLwogICAgICAvLyBgYGBqcwogICAgICAvLyBoZWFkZXJzOiAoZmlsZSkgPT4gKHsgZXhwaXJlczogZmlsZS5tZXRhLmV4cGlyZXMgfSkKICAgICAgLy8gYGBgCgogICAgICBpZiAodHlwZW9mIGhlYWRlcnMgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICBvcHRzLmhlYWRlcnMgPSBoZWFkZXJzKGZpbGUpOwogICAgICB9IGVsc2UgewogICAgICAgIE9iamVjdC5hc3NpZ24ob3B0cy5oZWFkZXJzLCB0aGlzLm9wdHMuaGVhZGVycyk7CiAgICAgIH0KCiAgICAgIGlmIChvdmVycmlkZXMpIHsKICAgICAgICBPYmplY3QuYXNzaWduKG9wdHMuaGVhZGVycywgb3ZlcnJpZGVzLmhlYWRlcnMpOwogICAgICB9CgogICAgICBpZiAoZmlsZS54aHJVcGxvYWQpIHsKICAgICAgICBPYmplY3QuYXNzaWduKG9wdHMuaGVhZGVycywgZmlsZS54aHJVcGxvYWQuaGVhZGVycyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBvcHRzOwogICAgfSAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY2xhc3MtbWV0aG9kcy11c2UtdGhpcwoKCiAgICBhZGRNZXRhZGF0YShmb3JtRGF0YSwgbWV0YSwgb3B0cykgewogICAgICBjb25zdCBtZXRhRmllbGRzID0gQXJyYXkuaXNBcnJheShvcHRzLm1ldGFGaWVsZHMpID8gb3B0cy5tZXRhRmllbGRzIDogT2JqZWN0LmtleXMobWV0YSk7IC8vIFNlbmQgYWxvbmcgYWxsIGZpZWxkcyBieSBkZWZhdWx0LgoKICAgICAgbWV0YUZpZWxkcy5mb3JFYWNoKGl0ZW0gPT4gewogICAgICAgIGZvcm1EYXRhLmFwcGVuZChpdGVtLCBtZXRhW2l0ZW1dKTsKICAgICAgfSk7CiAgICB9CgogICAgY3JlYXRlRm9ybURhdGFVcGxvYWQoZmlsZSwgb3B0cykgewogICAgICBjb25zdCBmb3JtUG9zdCA9IG5ldyBGb3JtRGF0YSgpOwogICAgICB0aGlzLmFkZE1ldGFkYXRhKGZvcm1Qb3N0LCBmaWxlLm1ldGEsIG9wdHMpOwogICAgICBjb25zdCBkYXRhV2l0aFVwZGF0ZWRUeXBlID0gc2V0VHlwZUluQmxvYihmaWxlKTsKCiAgICAgIGlmIChmaWxlLm5hbWUpIHsKICAgICAgICBmb3JtUG9zdC5hcHBlbmQob3B0cy5maWVsZE5hbWUsIGRhdGFXaXRoVXBkYXRlZFR5cGUsIGZpbGUubWV0YS5uYW1lKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmb3JtUG9zdC5hcHBlbmQob3B0cy5maWVsZE5hbWUsIGRhdGFXaXRoVXBkYXRlZFR5cGUpOwogICAgICB9CgogICAgICByZXR1cm4gZm9ybVBvc3Q7CiAgICB9CgogICAgY3JlYXRlQnVuZGxlZFVwbG9hZChmaWxlcywgb3B0cykgewogICAgICBjb25zdCBmb3JtUG9zdCA9IG5ldyBGb3JtRGF0YSgpOwogICAgICBjb25zdCB7CiAgICAgICAgbWV0YQogICAgICB9ID0gdGhpcy51cHB5LmdldFN0YXRlKCk7CiAgICAgIHRoaXMuYWRkTWV0YWRhdGEoZm9ybVBvc3QsIG1ldGEsIG9wdHMpOwogICAgICBmaWxlcy5mb3JFYWNoKGZpbGUgPT4gewogICAgICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLmdldE9wdGlvbnMoZmlsZSk7CiAgICAgICAgY29uc3QgZGF0YVdpdGhVcGRhdGVkVHlwZSA9IHNldFR5cGVJbkJsb2IoZmlsZSk7CgogICAgICAgIGlmIChmaWxlLm5hbWUpIHsKICAgICAgICAgIGZvcm1Qb3N0LmFwcGVuZChvcHRpb25zLmZpZWxkTmFtZSwgZGF0YVdpdGhVcGRhdGVkVHlwZSwgZmlsZS5uYW1lKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZm9ybVBvc3QuYXBwZW5kKG9wdGlvbnMuZmllbGROYW1lLCBkYXRhV2l0aFVwZGF0ZWRUeXBlKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICByZXR1cm4gZm9ybVBvc3Q7CiAgICB9CgogICAgdXBsb2FkKGZpbGUsIGN1cnJlbnQsIHRvdGFsKSB7CiAgICAgIGNvbnN0IG9wdHMgPSB0aGlzLmdldE9wdGlvbnMoZmlsZSk7CiAgICAgIHRoaXMudXBweS5sb2coYHVwbG9hZGluZyAke2N1cnJlbnR9IG9mICR7dG90YWx9YCk7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgdGhpcy51cHB5LmVtaXQoJ3VwbG9hZC1zdGFydGVkJywgZmlsZSk7CiAgICAgICAgY29uc3QgZGF0YSA9IG9wdHMuZm9ybURhdGEgPyB0aGlzLmNyZWF0ZUZvcm1EYXRhVXBsb2FkKGZpbGUsIG9wdHMpIDogZmlsZS5kYXRhOwogICAgICAgIGNvbnN0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogICAgICAgIHRoaXMudXBsb2FkZXJFdmVudHNbZmlsZS5pZF0gPSBuZXcgRXZlbnRUcmFja2VyXzEodGhpcy51cHB5KTsKICAgICAgICBjb25zdCB0aW1lciA9IG5ldyBQcm9ncmVzc1RpbWVvdXRfMShvcHRzLnRpbWVvdXQsICgpID0+IHsKICAgICAgICAgIHhoci5hYm9ydCgpOwogICAgICAgICAgcXVldWVkUmVxdWVzdC5kb25lKCk7CiAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcih0aGlzLmkxOG4oJ3RpbWVkT3V0JywgewogICAgICAgICAgICBzZWNvbmRzOiBNYXRoLmNlaWwob3B0cy50aW1lb3V0IC8gMTAwMCkKICAgICAgICAgIH0pKTsKICAgICAgICAgIHRoaXMudXBweS5lbWl0KCd1cGxvYWQtZXJyb3InLCBmaWxlLCBlcnJvcik7CiAgICAgICAgICByZWplY3QoZXJyb3IpOwogICAgICAgIH0pOwogICAgICAgIGNvbnN0IGlkID0gbmFub2lkKCk7CiAgICAgICAgeGhyLnVwbG9hZC5hZGRFdmVudExpc3RlbmVyKCdsb2Fkc3RhcnQnLCAoKSA9PiB7CiAgICAgICAgICB0aGlzLnVwcHkubG9nKGBbWEhSVXBsb2FkXSAke2lkfSBzdGFydGVkYCk7CiAgICAgICAgfSk7CiAgICAgICAgeGhyLnVwbG9hZC5hZGRFdmVudExpc3RlbmVyKCdwcm9ncmVzcycsIGV2ID0+IHsKICAgICAgICAgIHRoaXMudXBweS5sb2coYFtYSFJVcGxvYWRdICR7aWR9IHByb2dyZXNzOiAke2V2LmxvYWRlZH0gLyAke2V2LnRvdGFsfWApOyAvLyBCZWdpbiBjaGVja2luZyBmb3IgdGltZW91dHMgd2hlbiBwcm9ncmVzcyBzdGFydHMsIGluc3RlYWQgb2YgbG9hZGluZywKICAgICAgICAgIC8vIHRvIGF2b2lkIHRpbWluZyBvdXQgcmVxdWVzdHMgb24gYnJvd3NlciBjb25jdXJyZW5jeSBxdWV1ZQoKICAgICAgICAgIHRpbWVyLnByb2dyZXNzKCk7CgogICAgICAgICAgaWYgKGV2Lmxlbmd0aENvbXB1dGFibGUpIHsKICAgICAgICAgICAgdGhpcy51cHB5LmVtaXQoJ3VwbG9hZC1wcm9ncmVzcycsIGZpbGUsIHsKICAgICAgICAgICAgICB1cGxvYWRlcjogdGhpcywKICAgICAgICAgICAgICBieXRlc1VwbG9hZGVkOiBldi5sb2FkZWQsCiAgICAgICAgICAgICAgYnl0ZXNUb3RhbDogZXYudG90YWwKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBldiA9PiB7CiAgICAgICAgICB0aGlzLnVwcHkubG9nKGBbWEhSVXBsb2FkXSAke2lkfSBmaW5pc2hlZGApOwogICAgICAgICAgdGltZXIuZG9uZSgpOwogICAgICAgICAgcXVldWVkUmVxdWVzdC5kb25lKCk7CgogICAgICAgICAgaWYgKHRoaXMudXBsb2FkZXJFdmVudHNbZmlsZS5pZF0pIHsKICAgICAgICAgICAgdGhpcy51cGxvYWRlckV2ZW50c1tmaWxlLmlkXS5yZW1vdmUoKTsKICAgICAgICAgICAgdGhpcy51cGxvYWRlckV2ZW50c1tmaWxlLmlkXSA9IG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKG9wdHMudmFsaWRhdGVTdGF0dXMoZXYudGFyZ2V0LnN0YXR1cywgeGhyLnJlc3BvbnNlVGV4dCwgeGhyKSkgewogICAgICAgICAgICBjb25zdCBib2R5ID0gb3B0cy5nZXRSZXNwb25zZURhdGEoeGhyLnJlc3BvbnNlVGV4dCwgeGhyKTsKICAgICAgICAgICAgY29uc3QgdXBsb2FkVVJMID0gYm9keVtvcHRzLnJlc3BvbnNlVXJsRmllbGROYW1lXTsKICAgICAgICAgICAgY29uc3QgdXBsb2FkUmVzcCA9IHsKICAgICAgICAgICAgICBzdGF0dXM6IGV2LnRhcmdldC5zdGF0dXMsCiAgICAgICAgICAgICAgYm9keSwKICAgICAgICAgICAgICB1cGxvYWRVUkwKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdGhpcy51cHB5LmVtaXQoJ3VwbG9hZC1zdWNjZXNzJywgZmlsZSwgdXBsb2FkUmVzcCk7CgogICAgICAgICAgICBpZiAodXBsb2FkVVJMKSB7CiAgICAgICAgICAgICAgdGhpcy51cHB5LmxvZyhgRG93bmxvYWQgJHtmaWxlLm5hbWV9IGZyb20gJHt1cGxvYWRVUkx9YCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByZXNvbHZlKGZpbGUpOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbnN0IGJvZHkgPSBvcHRzLmdldFJlc3BvbnNlRGF0YSh4aHIucmVzcG9uc2VUZXh0LCB4aHIpOwogICAgICAgICAgY29uc3QgZXJyb3IgPSBidWlsZFJlc3BvbnNlRXJyb3IoeGhyLCBvcHRzLmdldFJlc3BvbnNlRXJyb3IoeGhyLnJlc3BvbnNlVGV4dCwgeGhyKSk7CiAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHsKICAgICAgICAgICAgc3RhdHVzOiBldi50YXJnZXQuc3RhdHVzLAogICAgICAgICAgICBib2R5CiAgICAgICAgICB9OwogICAgICAgICAgdGhpcy51cHB5LmVtaXQoJ3VwbG9hZC1lcnJvcicsIGZpbGUsIGVycm9yLCByZXNwb25zZSk7CiAgICAgICAgICByZXR1cm4gcmVqZWN0KGVycm9yKTsKICAgICAgICB9KTsKICAgICAgICB4aHIuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCAoKSA9PiB7CiAgICAgICAgICB0aGlzLnVwcHkubG9nKGBbWEhSVXBsb2FkXSAke2lkfSBlcnJvcmVkYCk7CiAgICAgICAgICB0aW1lci5kb25lKCk7CiAgICAgICAgICBxdWV1ZWRSZXF1ZXN0LmRvbmUoKTsKCiAgICAgICAgICBpZiAodGhpcy51cGxvYWRlckV2ZW50c1tmaWxlLmlkXSkgewogICAgICAgICAgICB0aGlzLnVwbG9hZGVyRXZlbnRzW2ZpbGUuaWRdLnJlbW92ZSgpOwogICAgICAgICAgICB0aGlzLnVwbG9hZGVyRXZlbnRzW2ZpbGUuaWRdID0gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCBlcnJvciA9IGJ1aWxkUmVzcG9uc2VFcnJvcih4aHIsIG9wdHMuZ2V0UmVzcG9uc2VFcnJvcih4aHIucmVzcG9uc2VUZXh0LCB4aHIpKTsKICAgICAgICAgIHRoaXMudXBweS5lbWl0KCd1cGxvYWQtZXJyb3InLCBmaWxlLCBlcnJvcik7CiAgICAgICAgICByZXR1cm4gcmVqZWN0KGVycm9yKTsKICAgICAgICB9KTsKICAgICAgICB4aHIub3BlbihvcHRzLm1ldGhvZC50b1VwcGVyQ2FzZSgpLCBvcHRzLmVuZHBvaW50LCB0cnVlKTsgLy8gSUUxMCBkb2VzIG5vdCBhbGxvdyBzZXR0aW5nIGB3aXRoQ3JlZGVudGlhbHNgIGFuZCBgcmVzcG9uc2VUeXBlYAogICAgICAgIC8vIGJlZm9yZSBgb3BlbigpYCBpcyBjYWxsZWQuCgogICAgICAgIHhoci53aXRoQ3JlZGVudGlhbHMgPSBvcHRzLndpdGhDcmVkZW50aWFsczsKCiAgICAgICAgaWYgKG9wdHMucmVzcG9uc2VUeXBlICE9PSAnJykgewogICAgICAgICAgeGhyLnJlc3BvbnNlVHlwZSA9IG9wdHMucmVzcG9uc2VUeXBlOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgcXVldWVkUmVxdWVzdCA9IHRoaXMucmVxdWVzdHMucnVuKCgpID0+IHsKICAgICAgICAgIHRoaXMudXBweS5lbWl0KCd1cGxvYWQtc3RhcnRlZCcsIGZpbGUpOyAvLyBXaGVuIHVzaW5nIGFuIGF1dGhlbnRpY2F0aW9uIHN5c3RlbSBsaWtlIEpXVCwgdGhlIGJlYXJlciB0b2tlbiBnb2VzIGFzIGEgaGVhZGVyLiBUaGlzCiAgICAgICAgICAvLyBoZWFkZXIgbmVlZHMgdG8gYmUgZnJlc2ggZWFjaCB0aW1lIHRoZSB0b2tlbiBpcyByZWZyZXNoZWQgc28gY29tcHV0aW5nIGFuZCBzZXR0aW5nIHRoZQogICAgICAgICAgLy8gaGVhZGVycyBqdXN0IGJlZm9yZSB0aGUgdXBsb2FkIHN0YXJ0cyBlbmFibGVzIHRoaXMga2luZCBvZiBhdXRoZW50aWNhdGlvbiB0byB3b3JrIHByb3Blcmx5LgogICAgICAgICAgLy8gT3RoZXJ3aXNlLCBoYWxmLXdheSB0aHJvdWdoIHRoZSBsaXN0IG9mIHVwbG9hZHMgdGhlIHRva2VuIGNvdWxkIGJlIHN0YWxlIGFuZCB0aGUgdXBsb2FkIHdvdWxkIGZhaWwuCgogICAgICAgICAgY29uc3QgY3VycmVudE9wdHMgPSB0aGlzLmdldE9wdGlvbnMoZmlsZSk7CiAgICAgICAgICBPYmplY3Qua2V5cyhjdXJyZW50T3B0cy5oZWFkZXJzKS5mb3JFYWNoKGhlYWRlciA9PiB7CiAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKGhlYWRlciwgY3VycmVudE9wdHMuaGVhZGVyc1toZWFkZXJdKTsKICAgICAgICAgIH0pOwogICAgICAgICAgeGhyLnNlbmQoZGF0YSk7CiAgICAgICAgICByZXR1cm4gKCkgPT4gewogICAgICAgICAgICB0aW1lci5kb25lKCk7CiAgICAgICAgICAgIHhoci5hYm9ydCgpOwogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLm9uRmlsZVJlbW92ZShmaWxlLmlkLCAoKSA9PiB7CiAgICAgICAgICBxdWV1ZWRSZXF1ZXN0LmFib3J0KCk7CiAgICAgICAgICByZWplY3QobmV3IEVycm9yKCdGaWxlIHJlbW92ZWQnKSk7CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5vbkNhbmNlbEFsbChmaWxlLmlkLCAoKSA9PiB7CiAgICAgICAgICBxdWV1ZWRSZXF1ZXN0LmFib3J0KCk7CiAgICAgICAgICByZWplY3QobmV3IEVycm9yKCdVcGxvYWQgY2FuY2VsbGVkJykpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KCiAgICB1cGxvYWRSZW1vdGUoZmlsZSkgewogICAgICBjb25zdCBvcHRzID0gdGhpcy5nZXRPcHRpb25zKGZpbGUpOwogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgIHRoaXMudXBweS5lbWl0KCd1cGxvYWQtc3RhcnRlZCcsIGZpbGUpOwogICAgICAgIGNvbnN0IGZpZWxkcyA9IHt9OwogICAgICAgIGNvbnN0IG1ldGFGaWVsZHMgPSBBcnJheS5pc0FycmF5KG9wdHMubWV0YUZpZWxkcykgPyBvcHRzLm1ldGFGaWVsZHMgLy8gU2VuZCBhbG9uZyBhbGwgZmllbGRzIGJ5IGRlZmF1bHQuCiAgICAgICAgOiBPYmplY3Qua2V5cyhmaWxlLm1ldGEpOwogICAgICAgIG1ldGFGaWVsZHMuZm9yRWFjaChuYW1lID0+IHsKICAgICAgICAgIGZpZWxkc1tuYW1lXSA9IGZpbGUubWV0YVtuYW1lXTsKICAgICAgICB9KTsKICAgICAgICBjb25zdCBDbGllbnQgPSBmaWxlLnJlbW90ZS5wcm92aWRlck9wdGlvbnMucHJvdmlkZXIgPyBQcm92aWRlciA6IFJlcXVlc3RDbGllbnQ7CiAgICAgICAgY29uc3QgY2xpZW50ID0gbmV3IENsaWVudCh0aGlzLnVwcHksIGZpbGUucmVtb3RlLnByb3ZpZGVyT3B0aW9ucyk7CiAgICAgICAgY2xpZW50LnBvc3QoZmlsZS5yZW1vdGUudXJsLCB7IC4uLmZpbGUucmVtb3RlLmJvZHksCiAgICAgICAgICBlbmRwb2ludDogb3B0cy5lbmRwb2ludCwKICAgICAgICAgIHNpemU6IGZpbGUuZGF0YS5zaXplLAogICAgICAgICAgZmllbGRuYW1lOiBvcHRzLmZpZWxkTmFtZSwKICAgICAgICAgIG1ldGFkYXRhOiBmaWVsZHMsCiAgICAgICAgICBodHRwTWV0aG9kOiBvcHRzLm1ldGhvZCwKICAgICAgICAgIHVzZUZvcm1EYXRhOiBvcHRzLmZvcm1EYXRhLAogICAgICAgICAgaGVhZGVyczogb3B0cy5oZWFkZXJzCiAgICAgICAgfSkudGhlbihyZXMgPT4gewogICAgICAgICAgY29uc3QgewogICAgICAgICAgICB0b2tlbgogICAgICAgICAgfSA9IHJlczsKICAgICAgICAgIGNvbnN0IGhvc3QgPSBnZXRTb2NrZXRIb3N0KGZpbGUucmVtb3RlLmNvbXBhbmlvblVybCk7CiAgICAgICAgICBjb25zdCBzb2NrZXQgPSBuZXcgU29ja2V0KHsKICAgICAgICAgICAgdGFyZ2V0OiBgJHtob3N0fS9hcGkvJHt0b2tlbn1gLAogICAgICAgICAgICBhdXRvT3BlbjogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy51cGxvYWRlckV2ZW50c1tmaWxlLmlkXSA9IG5ldyBFdmVudFRyYWNrZXJfMSh0aGlzLnVwcHkpOwogICAgICAgICAgdGhpcy5vbkZpbGVSZW1vdmUoZmlsZS5pZCwgKCkgPT4gewogICAgICAgICAgICBzb2NrZXQuc2VuZCgnY2FuY2VsJywge30pOwogICAgICAgICAgICBxdWV1ZWRSZXF1ZXN0LmFib3J0KCk7CiAgICAgICAgICAgIHJlc29sdmUoYHVwbG9hZCAke2ZpbGUuaWR9IHdhcyByZW1vdmVkYCk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMub25DYW5jZWxBbGwoZmlsZS5pZCwgKCkgPT4gewogICAgICAgICAgICBzb2NrZXQuc2VuZCgnY2FuY2VsJywge30pOwogICAgICAgICAgICBxdWV1ZWRSZXF1ZXN0LmFib3J0KCk7CiAgICAgICAgICAgIHJlc29sdmUoYHVwbG9hZCAke2ZpbGUuaWR9IHdhcyBjYW5jZWxlZGApOwogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLm9uUmV0cnkoZmlsZS5pZCwgKCkgPT4gewogICAgICAgICAgICBzb2NrZXQuc2VuZCgncGF1c2UnLCB7fSk7CiAgICAgICAgICAgIHNvY2tldC5zZW5kKCdyZXN1bWUnLCB7fSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMub25SZXRyeUFsbChmaWxlLmlkLCAoKSA9PiB7CiAgICAgICAgICAgIHNvY2tldC5zZW5kKCdwYXVzZScsIHt9KTsKICAgICAgICAgICAgc29ja2V0LnNlbmQoJ3Jlc3VtZScsIHt9KTsKICAgICAgICAgIH0pOwogICAgICAgICAgc29ja2V0Lm9uKCdwcm9ncmVzcycsIHByb2dyZXNzRGF0YSA9PiBlbWl0U29ja2V0UHJvZ3Jlc3NfMSh0aGlzLCBwcm9ncmVzc0RhdGEsIGZpbGUpKTsKICAgICAgICAgIHNvY2tldC5vbignc3VjY2VzcycsIGRhdGEgPT4gewogICAgICAgICAgICBjb25zdCBib2R5ID0gb3B0cy5nZXRSZXNwb25zZURhdGEoZGF0YS5yZXNwb25zZS5yZXNwb25zZVRleHQsIGRhdGEucmVzcG9uc2UpOwogICAgICAgICAgICBjb25zdCB1cGxvYWRVUkwgPSBib2R5W29wdHMucmVzcG9uc2VVcmxGaWVsZE5hbWVdOwogICAgICAgICAgICBjb25zdCB1cGxvYWRSZXNwID0gewogICAgICAgICAgICAgIHN0YXR1czogZGF0YS5yZXNwb25zZS5zdGF0dXMsCiAgICAgICAgICAgICAgYm9keSwKICAgICAgICAgICAgICB1cGxvYWRVUkwKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdGhpcy51cHB5LmVtaXQoJ3VwbG9hZC1zdWNjZXNzJywgZmlsZSwgdXBsb2FkUmVzcCk7CiAgICAgICAgICAgIHF1ZXVlZFJlcXVlc3QuZG9uZSgpOwoKICAgICAgICAgICAgaWYgKHRoaXMudXBsb2FkZXJFdmVudHNbZmlsZS5pZF0pIHsKICAgICAgICAgICAgICB0aGlzLnVwbG9hZGVyRXZlbnRzW2ZpbGUuaWRdLnJlbW92ZSgpOwogICAgICAgICAgICAgIHRoaXMudXBsb2FkZXJFdmVudHNbZmlsZS5pZF0gPSBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcmVzb2x2ZSgpOwogICAgICAgICAgfSk7CiAgICAgICAgICBzb2NrZXQub24oJ2Vycm9yJywgZXJyRGF0YSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHJlc3AgPSBlcnJEYXRhLnJlc3BvbnNlOwogICAgICAgICAgICBjb25zdCBlcnJvciA9IHJlc3AgPyBvcHRzLmdldFJlc3BvbnNlRXJyb3IocmVzcC5yZXNwb25zZVRleHQsIHJlc3ApIDogT2JqZWN0LmFzc2lnbihuZXcgRXJyb3IoZXJyRGF0YS5lcnJvci5tZXNzYWdlKSwgewogICAgICAgICAgICAgIGNhdXNlOiBlcnJEYXRhLmVycm9yCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLnVwcHkuZW1pdCgndXBsb2FkLWVycm9yJywgZmlsZSwgZXJyb3IpOwogICAgICAgICAgICBxdWV1ZWRSZXF1ZXN0LmRvbmUoKTsKCiAgICAgICAgICAgIGlmICh0aGlzLnVwbG9hZGVyRXZlbnRzW2ZpbGUuaWRdKSB7CiAgICAgICAgICAgICAgdGhpcy51cGxvYWRlckV2ZW50c1tmaWxlLmlkXS5yZW1vdmUoKTsKICAgICAgICAgICAgICB0aGlzLnVwbG9hZGVyRXZlbnRzW2ZpbGUuaWRdID0gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmVqZWN0KGVycm9yKTsKICAgICAgICAgIH0pOwogICAgICAgICAgY29uc3QgcXVldWVkUmVxdWVzdCA9IHRoaXMucmVxdWVzdHMucnVuKCgpID0+IHsKICAgICAgICAgICAgc29ja2V0Lm9wZW4oKTsKCiAgICAgICAgICAgIGlmIChmaWxlLmlzUGF1c2VkKSB7CiAgICAgICAgICAgICAgc29ja2V0LnNlbmQoJ3BhdXNlJywge30pOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gKCkgPT4gc29ja2V0LmNsb3NlKCk7CiAgICAgICAgICB9KTsKICAgICAgICB9KS5jYXRjaChlcnIgPT4gewogICAgICAgICAgdGhpcy51cHB5LmVtaXQoJ3VwbG9hZC1lcnJvcicsIGZpbGUsIGVycik7CiAgICAgICAgICByZWplY3QoZXJyKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CgogICAgdXBsb2FkQnVuZGxlKGZpbGVzKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgY29uc3QgewogICAgICAgICAgZW5kcG9pbnQKICAgICAgICB9ID0gdGhpcy5vcHRzOwogICAgICAgIGNvbnN0IHsKICAgICAgICAgIG1ldGhvZAogICAgICAgIH0gPSB0aGlzLm9wdHM7CiAgICAgICAgY29uc3Qgb3B0c0Zyb21TdGF0ZSA9IHRoaXMudXBweS5nZXRTdGF0ZSgpLnhoclVwbG9hZDsKICAgICAgICBjb25zdCBmb3JtRGF0YSA9IHRoaXMuY3JlYXRlQnVuZGxlZFVwbG9hZChmaWxlcywgeyAuLi50aGlzLm9wdHMsCiAgICAgICAgICAuLi4ob3B0c0Zyb21TdGF0ZSB8fCB7fSkKICAgICAgICB9KTsKICAgICAgICBjb25zdCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICBjb25zdCB0aW1lciA9IG5ldyBQcm9ncmVzc1RpbWVvdXRfMSh0aGlzLm9wdHMudGltZW91dCwgKCkgPT4gewogICAgICAgICAgeGhyLmFib3J0KCk7CiAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcih0aGlzLmkxOG4oJ3RpbWVkT3V0JywgewogICAgICAgICAgICBzZWNvbmRzOiBNYXRoLmNlaWwodGhpcy5vcHRzLnRpbWVvdXQgLyAxMDAwKQogICAgICAgICAgfSkpOwogICAgICAgICAgZW1pdEVycm9yKGVycm9yKTsKICAgICAgICAgIHJlamVjdChlcnJvcik7CiAgICAgICAgfSk7CgogICAgICAgIGNvbnN0IGVtaXRFcnJvciA9IGVycm9yID0+IHsKICAgICAgICAgIGZpbGVzLmZvckVhY2goZmlsZSA9PiB7CiAgICAgICAgICAgIHRoaXMudXBweS5lbWl0KCd1cGxvYWQtZXJyb3InLCBmaWxlLCBlcnJvcik7CiAgICAgICAgICB9KTsKICAgICAgICB9OwoKICAgICAgICB4aHIudXBsb2FkLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWRzdGFydCcsICgpID0+IHsKICAgICAgICAgIHRoaXMudXBweS5sb2coJ1tYSFJVcGxvYWRdIHN0YXJ0ZWQgdXBsb2FkaW5nIGJ1bmRsZScpOwogICAgICAgICAgdGltZXIucHJvZ3Jlc3MoKTsKICAgICAgICB9KTsKICAgICAgICB4aHIudXBsb2FkLmFkZEV2ZW50TGlzdGVuZXIoJ3Byb2dyZXNzJywgZXYgPT4gewogICAgICAgICAgdGltZXIucHJvZ3Jlc3MoKTsKICAgICAgICAgIGlmICghZXYubGVuZ3RoQ29tcHV0YWJsZSkgcmV0dXJuOwogICAgICAgICAgZmlsZXMuZm9yRWFjaChmaWxlID0+IHsKICAgICAgICAgICAgdGhpcy51cHB5LmVtaXQoJ3VwbG9hZC1wcm9ncmVzcycsIGZpbGUsIHsKICAgICAgICAgICAgICB1cGxvYWRlcjogdGhpcywKICAgICAgICAgICAgICBieXRlc1VwbG9hZGVkOiBldi5sb2FkZWQgLyBldi50b3RhbCAqIGZpbGUuc2l6ZSwKICAgICAgICAgICAgICBieXRlc1RvdGFsOiBmaWxlLnNpemUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICB4aHIuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGV2ID0+IHsKICAgICAgICAgIHRpbWVyLmRvbmUoKTsKCiAgICAgICAgICBpZiAodGhpcy5vcHRzLnZhbGlkYXRlU3RhdHVzKGV2LnRhcmdldC5zdGF0dXMsIHhoci5yZXNwb25zZVRleHQsIHhocikpIHsKICAgICAgICAgICAgY29uc3QgYm9keSA9IHRoaXMub3B0cy5nZXRSZXNwb25zZURhdGEoeGhyLnJlc3BvbnNlVGV4dCwgeGhyKTsKICAgICAgICAgICAgY29uc3QgdXBsb2FkUmVzcCA9IHsKICAgICAgICAgICAgICBzdGF0dXM6IGV2LnRhcmdldC5zdGF0dXMsCiAgICAgICAgICAgICAgYm9keQogICAgICAgICAgICB9OwogICAgICAgICAgICBmaWxlcy5mb3JFYWNoKGZpbGUgPT4gewogICAgICAgICAgICAgIHRoaXMudXBweS5lbWl0KCd1cGxvYWQtc3VjY2VzcycsIGZpbGUsIHVwbG9hZFJlc3ApOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCBlcnJvciA9IHRoaXMub3B0cy5nZXRSZXNwb25zZUVycm9yKHhoci5yZXNwb25zZVRleHQsIHhocikgfHwgbmV3IEVycm9yKCdVcGxvYWQgZXJyb3InKTsKICAgICAgICAgIGVycm9yLnJlcXVlc3QgPSB4aHI7CiAgICAgICAgICBlbWl0RXJyb3IoZXJyb3IpOwogICAgICAgICAgcmV0dXJuIHJlamVjdChlcnJvcik7CiAgICAgICAgfSk7CiAgICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgKCkgPT4gewogICAgICAgICAgdGltZXIuZG9uZSgpOwogICAgICAgICAgY29uc3QgZXJyb3IgPSB0aGlzLm9wdHMuZ2V0UmVzcG9uc2VFcnJvcih4aHIucmVzcG9uc2VUZXh0LCB4aHIpIHx8IG5ldyBFcnJvcignVXBsb2FkIGVycm9yJyk7CiAgICAgICAgICBlbWl0RXJyb3IoZXJyb3IpOwogICAgICAgICAgcmV0dXJuIHJlamVjdChlcnJvcik7CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy51cHB5Lm9uKCdjYW5jZWwtYWxsJywgKCkgPT4gewogICAgICAgICAgdGltZXIuZG9uZSgpOwogICAgICAgICAgeGhyLmFib3J0KCk7CiAgICAgICAgfSk7CiAgICAgICAgeGhyLm9wZW4obWV0aG9kLnRvVXBwZXJDYXNlKCksIGVuZHBvaW50LCB0cnVlKTsgLy8gSUUxMCBkb2VzIG5vdCBhbGxvdyBzZXR0aW5nIGB3aXRoQ3JlZGVudGlhbHNgIGFuZCBgcmVzcG9uc2VUeXBlYAogICAgICAgIC8vIGJlZm9yZSBgb3BlbigpYCBpcyBjYWxsZWQuCgogICAgICAgIHhoci53aXRoQ3JlZGVudGlhbHMgPSB0aGlzLm9wdHMud2l0aENyZWRlbnRpYWxzOwoKICAgICAgICBpZiAodGhpcy5vcHRzLnJlc3BvbnNlVHlwZSAhPT0gJycpIHsKICAgICAgICAgIHhoci5yZXNwb25zZVR5cGUgPSB0aGlzLm9wdHMucmVzcG9uc2VUeXBlOwogICAgICAgIH0KCiAgICAgICAgT2JqZWN0LmtleXModGhpcy5vcHRzLmhlYWRlcnMpLmZvckVhY2goaGVhZGVyID0+IHsKICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKGhlYWRlciwgdGhpcy5vcHRzLmhlYWRlcnNbaGVhZGVyXSk7CiAgICAgICAgfSk7CiAgICAgICAgeGhyLnNlbmQoZm9ybURhdGEpOwogICAgICAgIGZpbGVzLmZvckVhY2goZmlsZSA9PiB7CiAgICAgICAgICB0aGlzLnVwcHkuZW1pdCgndXBsb2FkLXN0YXJ0ZWQnLCBmaWxlKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CgogICAgdXBsb2FkRmlsZXMoZmlsZXMpIHsKICAgICAgY29uc3QgcHJvbWlzZXMgPSBmaWxlcy5tYXAoKGZpbGUsIGkpID0+IHsKICAgICAgICBjb25zdCBjdXJyZW50ID0gcGFyc2VJbnQoaSwgMTApICsgMTsKICAgICAgICBjb25zdCB0b3RhbCA9IGZpbGVzLmxlbmd0aDsKCiAgICAgICAgaWYgKGZpbGUuZXJyb3IpIHsKICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoZmlsZS5lcnJvcikpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGZpbGUuaXNSZW1vdGUpIHsKICAgICAgICAgIHJldHVybiB0aGlzLnVwbG9hZFJlbW90ZShmaWxlLCBjdXJyZW50LCB0b3RhbCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGhpcy51cGxvYWQoZmlsZSwgY3VycmVudCwgdG90YWwpOwogICAgICB9KTsKICAgICAgcmV0dXJuIHNldHRsZShwcm9taXNlcyk7CiAgICB9CgogICAgb25GaWxlUmVtb3ZlKGZpbGVJRCwgY2IpIHsKICAgICAgdGhpcy51cGxvYWRlckV2ZW50c1tmaWxlSURdLm9uKCdmaWxlLXJlbW92ZWQnLCBmaWxlID0+IHsKICAgICAgICBpZiAoZmlsZUlEID09PSBmaWxlLmlkKSBjYihmaWxlLmlkKTsKICAgICAgfSk7CiAgICB9CgogICAgb25SZXRyeShmaWxlSUQsIGNiKSB7CiAgICAgIHRoaXMudXBsb2FkZXJFdmVudHNbZmlsZUlEXS5vbigndXBsb2FkLXJldHJ5JywgdGFyZ2V0RmlsZUlEID0+IHsKICAgICAgICBpZiAoZmlsZUlEID09PSB0YXJnZXRGaWxlSUQpIHsKICAgICAgICAgIGNiKCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICBvblJldHJ5QWxsKGZpbGVJRCwgY2IpIHsKICAgICAgdGhpcy51cGxvYWRlckV2ZW50c1tmaWxlSURdLm9uKCdyZXRyeS1hbGwnLCAoKSA9PiB7CiAgICAgICAgaWYgKCF0aGlzLnVwcHkuZ2V0RmlsZShmaWxlSUQpKSByZXR1cm47CiAgICAgICAgY2IoKTsKICAgICAgfSk7CiAgICB9CgogICAgb25DYW5jZWxBbGwoZmlsZUlELCBjYikgewogICAgICB0aGlzLnVwbG9hZGVyRXZlbnRzW2ZpbGVJRF0ub24oJ2NhbmNlbC1hbGwnLCAoKSA9PiB7CiAgICAgICAgaWYgKCF0aGlzLnVwcHkuZ2V0RmlsZShmaWxlSUQpKSByZXR1cm47CiAgICAgICAgY2IoKTsKICAgICAgfSk7CiAgICB9CgogICAgaGFuZGxlVXBsb2FkKGZpbGVJRHMpIHsKICAgICAgaWYgKGZpbGVJRHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy51cHB5LmxvZygnW1hIUlVwbG9hZF0gTm8gZmlsZXMgdG8gdXBsb2FkIScpOwogICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTsKICAgICAgfSAvLyBObyBsaW1pdCBjb25maWd1cmVkIGJ5IHRoZSB1c2VyLCBhbmQgbm8gUmF0ZUxpbWl0ZWRRdWV1ZSBwYXNzZWQgaW4gYnkgYSAicGFyZW50IiBwbHVnaW4KICAgICAgLy8gKGJhc2ljYWxseSBqdXN0IEF3c1MzKSB1c2luZyB0aGUgaW50ZXJuYWwgc3ltYm9sCgoKICAgICAgaWYgKHRoaXMub3B0cy5saW1pdCA9PT0gMCAmJiAhdGhpcy5vcHRzW2ludGVybmFsUmF0ZUxpbWl0ZWRRdWV1ZV0pIHsKICAgICAgICB0aGlzLnVwcHkubG9nKCdbWEhSVXBsb2FkXSBXaGVuIHVwbG9hZGluZyBtdWx0aXBsZSBmaWxlcyBhdCBvbmNlLCBjb25zaWRlciBzZXR0aW5nIHRoZSBgbGltaXRgIG9wdGlvbiAodG8gYDEwYCBmb3IgZXhhbXBsZSksIHRvIGxpbWl0IHRoZSBudW1iZXIgb2YgY29uY3VycmVudCB1cGxvYWRzLCB3aGljaCBoZWxwcyBwcmV2ZW50IG1lbW9yeSBhbmQgbmV0d29yayBpc3N1ZXM6IGh0dHBzOi8vdXBweS5pby9kb2NzL3hoci11cGxvYWQvI2xpbWl0LTAnLCAnd2FybmluZycpOwogICAgICB9CgogICAgICB0aGlzLnVwcHkubG9nKCdbWEhSVXBsb2FkXSBVcGxvYWRpbmcuLi4nKTsKICAgICAgY29uc3QgZmlsZXMgPSBmaWxlSURzLm1hcChmaWxlSUQgPT4gdGhpcy51cHB5LmdldEZpbGUoZmlsZUlEKSk7CgogICAgICBpZiAodGhpcy5vcHRzLmJ1bmRsZSkgewogICAgICAgIC8vIGlmIGJ1bmRsZTogdHJ1ZSwgd2UgZG9u4oCZdCBzdXBwb3J0IHJlbW90ZSB1cGxvYWRzCiAgICAgICAgY29uc3QgaXNTb21lRmlsZVJlbW90ZSA9IGZpbGVzLnNvbWUoZmlsZSA9PiBmaWxlLmlzUmVtb3RlKTsKCiAgICAgICAgaWYgKGlzU29tZUZpbGVSZW1vdGUpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fu4oCZdCB1cGxvYWQgcmVtb3RlIGZpbGVzIHdoZW4gdGhlIGBidW5kbGU6IHRydWVgIG9wdGlvbiBpcyBzZXQnKTsKICAgICAgICB9CgogICAgICAgIGlmICh0eXBlb2YgdGhpcy5vcHRzLmhlYWRlcnMgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ2BoZWFkZXJzYCBtYXkgbm90IGJlIGEgZnVuY3Rpb24gd2hlbiB0aGUgYGJ1bmRsZTogdHJ1ZWAgb3B0aW9uIGlzIHNldCcpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRoaXMudXBsb2FkQnVuZGxlKGZpbGVzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMudXBsb2FkRmlsZXMoZmlsZXMpLnRoZW4oKCkgPT4gbnVsbCk7CiAgICB9CgogICAgaW5zdGFsbCgpIHsKICAgICAgaWYgKHRoaXMub3B0cy5idW5kbGUpIHsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBjYXBhYmlsaXRpZXMKICAgICAgICB9ID0gdGhpcy51cHB5LmdldFN0YXRlKCk7CiAgICAgICAgdGhpcy51cHB5LnNldFN0YXRlKHsKICAgICAgICAgIGNhcGFiaWxpdGllczogeyAuLi5jYXBhYmlsaXRpZXMsCiAgICAgICAgICAgIGluZGl2aWR1YWxDYW5jZWxsYXRpb246IGZhbHNlCiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHRoaXMudXBweS5hZGRVcGxvYWRlcih0aGlzLmhhbmRsZVVwbG9hZCk7CiAgICB9CgogICAgdW5pbnN0YWxsKCkgewogICAgICBpZiAodGhpcy5vcHRzLmJ1bmRsZSkgewogICAgICAgIGNvbnN0IHsKICAgICAgICAgIGNhcGFiaWxpdGllcwogICAgICAgIH0gPSB0aGlzLnVwcHkuZ2V0U3RhdGUoKTsKICAgICAgICB0aGlzLnVwcHkuc2V0U3RhdGUoewogICAgICAgICAgY2FwYWJpbGl0aWVzOiB7IC4uLmNhcGFiaWxpdGllcywKICAgICAgICAgICAgaW5kaXZpZHVhbENhbmNlbGxhdGlvbjogdHJ1ZQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CgogICAgICB0aGlzLnVwcHkucmVtb3ZlVXBsb2FkZXIodGhpcy5oYW5kbGVVcGxvYWQpOwogICAgfQoKICB9LCBfY2xhc3MuVkVSU0lPTiA9ICIyLjAuNiIsIF90ZW1wKTsKCiAgdmFyIHJlcXVpcmUkJDIkMSA9IGRpc3QkNzsKCiAgdmFyIHJlcXVpcmUkJDEgPSBkb203X2NqczsKCiAgdmFyIHJlcXVpcmUkJDIgPSBzbmFiYmRvbV9janM7CgogIHZhciBkaXN0JDYgPSBjcmVhdGVDb21tb25qc01vZHVsZSQxKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAhZnVuY3Rpb24oZSx0KXt0KGV4cG9ydHMscmVxdWlyZSQkMiQxLGxvZGFzaF90b2FycmF5LHJlcXVpcmUkJDEsbG9kYXNoX2ZvcmVhY2gscmVxdWlyZSQkNCxsb2Rhc2hfdGhyb3R0bGUscmVxdWlyZSQkMixsb2Rhc2hfY2FtZWxjYXNlLGxpYiQ0LGxvZGFzaF9kZWJvdW5jZSxsb2Rhc2hfY2xvbmVkZWVwLGxpYiQyLGxpYik7fShjb21tb25qc0dsb2JhbCwoZnVuY3Rpb24oZSx0LG4scixvLGksYSxzLGwsdSxjLGYsZCxwKXtmdW5jdGlvbiBoKGUpe3JldHVybiBlJiYib2JqZWN0Ij09dHlwZW9mIGUmJiJkZWZhdWx0ImluIGU/ZTp7ZGVmYXVsdDplfX12YXIgZz1oKHQpLHY9aChuKSx5PWgociksbT1oKG8pLGI9aChhKSx3PWgobCkseD1oKGMpLEU9aChmKSxTPWgoZCksaz1oKHApLE89InVuZGVmaW5lZCIhPXR5cGVvZiBnbG9iYWxUaGlzP2dsb2JhbFRoaXM6InVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3c/d2luZG93OiJ1bmRlZmluZWQiIT10eXBlb2YgY29tbW9uanNHbG9iYWw/Y29tbW9uanNHbG9iYWw6InVuZGVmaW5lZCIhPXR5cGVvZiBzZWxmP3NlbGY6e307ZnVuY3Rpb24gQyhlKXtyZXR1cm4gZSYmZS5fX2VzTW9kdWxlJiZPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwiZGVmYXVsdCIpP2UuZGVmYXVsdDplfWZ1bmN0aW9uIFQoZSl7dmFyIHQ9e2V4cG9ydHM6e319O3JldHVybiBlKHQsdC5leHBvcnRzKSx0LmV4cG9ydHN9dmFyIE4sTSxMPWZ1bmN0aW9uKGUpe3JldHVybiBlJiZlLk1hdGg9PU1hdGgmJmV9LFA9TCgib2JqZWN0Ij09dHlwZW9mIGdsb2JhbFRoaXMmJmdsb2JhbFRoaXMpfHxMKCJvYmplY3QiPT10eXBlb2Ygd2luZG93JiZ3aW5kb3cpfHxMKCJvYmplY3QiPT10eXBlb2Ygc2VsZiYmc2VsZil8fEwoIm9iamVjdCI9PXR5cGVvZiBPJiZPKXx8ZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30oKXx8RnVuY3Rpb24oInJldHVybiB0aGlzIikoKSxSPU9iamVjdC5kZWZpbmVQcm9wZXJ0eSxEPWZ1bmN0aW9uKGUsdCl7dHJ5e1IoUCxlLHt2YWx1ZTp0LGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMH0pO31jYXRjaChuKXtQW2VdPXQ7fXJldHVybiB0fSxqPSJfX2NvcmUtanNfc2hhcmVkX18iLEE9UFtqXXx8RChqLHt9KSxfPVQoKGZ1bmN0aW9uKGUpeyhlLmV4cG9ydHM9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gQVtlXXx8KEFbZV09dm9pZCAwIT09dD90Ont9KX0pKCJ2ZXJzaW9ucyIsW10pLnB1c2goe3ZlcnNpb246IjMuMTkuMyIsbW9kZToiZ2xvYmFsIixjb3B5cmlnaHQ6IsKpIDIwMjEgRGVuaXMgUHVzaGthcmV2ICh6bG9pcm9jay5ydSkifSk7fSkpLEY9RnVuY3Rpb24ucHJvdG90eXBlLEk9Ri5iaW5kLEI9Ri5jYWxsLCQ9SSYmSS5iaW5kKEIpLFc9ST9mdW5jdGlvbihlKXtyZXR1cm4gZSYmJChCLGUpfTpmdW5jdGlvbihlKXtyZXR1cm4gZSYmZnVuY3Rpb24oKXtyZXR1cm4gQi5hcHBseShlLGFyZ3VtZW50cyl9fSxIPVAuVHlwZUVycm9yLFY9ZnVuY3Rpb24oZSl7aWYobnVsbD09ZSl0aHJvdyBIKCJDYW4ndCBjYWxsIG1ldGhvZCBvbiAiK2UpO3JldHVybiBlfSx6PVAuT2JqZWN0LFU9ZnVuY3Rpb24oZSl7cmV0dXJuIHooVihlKSl9LEs9Vyh7fS5oYXNPd25Qcm9wZXJ0eSkscT1PYmplY3QuaGFzT3dufHxmdW5jdGlvbihlLHQpe3JldHVybiBLKFUoZSksdCl9LEc9MCxKPU1hdGgucmFuZG9tKCksWT1XKDEuLnRvU3RyaW5nKSxYPWZ1bmN0aW9uKGUpe3JldHVybiAiU3ltYm9sKCIrKHZvaWQgMD09PWU/IiI6ZSkrIilfIitZKCsrRytKLDM2KX0sUT1mdW5jdGlvbihlKXtyZXR1cm4gImZ1bmN0aW9uIj09dHlwZW9mIGV9LFo9ZnVuY3Rpb24oZSl7cmV0dXJuIFEoZSk/ZTp2b2lkIDB9LGVlPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8Mj9aKFBbZV0pOlBbZV0mJlBbZV1bdF19LHRlPWVlKCJuYXZpZ2F0b3IiLCJ1c2VyQWdlbnQiKXx8IiIsbmU9UC5wcm9jZXNzLHJlPVAuRGVubyxvZT1uZSYmbmUudmVyc2lvbnN8fHJlJiZyZS52ZXJzaW9uLGllPW9lJiZvZS52ODtpZSYmKE09KE49aWUuc3BsaXQoIi4iKSlbMF0+MCYmTlswXTw0PzE6KyhOWzBdK05bMV0pKSwhTSYmdGUmJighKE49dGUubWF0Y2goL0VkZ2VcLyhcZCspLykpfHxOWzFdPj03NCkmJihOPXRlLm1hdGNoKC9DaHJvbWVcLyhcZCspLykpJiYoTT0rTlsxXSk7dmFyIGFlPU0sc2U9ZnVuY3Rpb24oZSl7dHJ5e3JldHVybiAhIWUoKX1jYXRjaChlKXtyZXR1cm4gITB9fSxsZT0hIU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMmJiFzZSgoZnVuY3Rpb24oKXt2YXIgZT1TeW1ib2woKTtyZXR1cm4gIVN0cmluZyhlKXx8IShPYmplY3QoZSlpbnN0YW5jZW9mIFN5bWJvbCl8fCFTeW1ib2wuc2hhbSYmYWUmJmFlPDQxfSkpLHVlPWxlJiYhU3ltYm9sLnNoYW0mJiJzeW1ib2wiPT10eXBlb2YgU3ltYm9sLml0ZXJhdG9yLGNlPV8oIndrcyIpLGZlPVAuU3ltYm9sLGRlPWZlJiZmZS5mb3IscGU9dWU/ZmU6ZmUmJmZlLndpdGhvdXRTZXR0ZXJ8fFgsaGU9ZnVuY3Rpb24oZSl7aWYoIXEoY2UsZSl8fCFsZSYmInN0cmluZyIhPXR5cGVvZiBjZVtlXSl7dmFyIHQ9IlN5bWJvbC4iK2U7bGUmJnEoZmUsZSk/Y2VbZV09ZmVbZV06Y2VbZV09dWUmJmRlP2RlKHQpOnBlKHQpO31yZXR1cm4gY2VbZV19LGdlPXt9O2dlW2hlKCJ0b1N0cmluZ1RhZyIpXT0ieiI7dmFyIHZlPSJbb2JqZWN0IHpdIj09PVN0cmluZyhnZSkseWU9IXNlKChmdW5jdGlvbigpe3JldHVybiA3IT1PYmplY3QuZGVmaW5lUHJvcGVydHkoe30sMSx7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIDd9fSlbMV19KSksbWU9ZnVuY3Rpb24oZSl7cmV0dXJuICJvYmplY3QiPT10eXBlb2YgZT9udWxsIT09ZTpRKGUpfSxiZT1QLmRvY3VtZW50LHdlPW1lKGJlKSYmbWUoYmUuY3JlYXRlRWxlbWVudCkseGU9ZnVuY3Rpb24oZSl7cmV0dXJuIHdlP2JlLmNyZWF0ZUVsZW1lbnQoZSk6e319LEVlPSF5ZSYmIXNlKChmdW5jdGlvbigpe3JldHVybiA3IT1PYmplY3QuZGVmaW5lUHJvcGVydHkoeGUoImRpdiIpLCJhIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIDd9fSkuYX0pKSxTZT1QLlN0cmluZyxrZT1QLlR5cGVFcnJvcixPZT1mdW5jdGlvbihlKXtpZihtZShlKSlyZXR1cm4gZTt0aHJvdyBrZShTZShlKSsiIGlzIG5vdCBhbiBvYmplY3QiKX0sQ2U9RnVuY3Rpb24ucHJvdG90eXBlLmNhbGwsVGU9Q2UuYmluZD9DZS5iaW5kKENlKTpmdW5jdGlvbigpe3JldHVybiBDZS5hcHBseShDZSxhcmd1bWVudHMpfSxOZT1XKHt9LmlzUHJvdG90eXBlT2YpLE1lPVAuT2JqZWN0LExlPXVlP2Z1bmN0aW9uKGUpe3JldHVybiAic3ltYm9sIj09dHlwZW9mIGV9OmZ1bmN0aW9uKGUpe3ZhciB0PWVlKCJTeW1ib2wiKTtyZXR1cm4gUSh0KSYmTmUodC5wcm90b3R5cGUsTWUoZSkpfSxQZT1QLlN0cmluZyxSZT1mdW5jdGlvbihlKXt0cnl7cmV0dXJuIFBlKGUpfWNhdGNoKGUpe3JldHVybiAiT2JqZWN0In19LERlPVAuVHlwZUVycm9yLGplPWZ1bmN0aW9uKGUpe2lmKFEoZSkpcmV0dXJuIGU7dGhyb3cgRGUoUmUoZSkrIiBpcyBub3QgYSBmdW5jdGlvbiIpfSxBZT1mdW5jdGlvbihlLHQpe3ZhciBuPWVbdF07cmV0dXJuIG51bGw9PW4/dm9pZCAwOmplKG4pfSxfZT1QLlR5cGVFcnJvcixGZT1QLlR5cGVFcnJvcixJZT1oZSgidG9QcmltaXRpdmUiKSxCZT1mdW5jdGlvbihlLHQpe2lmKCFtZShlKXx8TGUoZSkpcmV0dXJuIGU7dmFyIG4scj1BZShlLEllKTtpZihyKXtpZih2b2lkIDA9PT10JiYodD0iZGVmYXVsdCIpLG49VGUocixlLHQpLCFtZShuKXx8TGUobikpcmV0dXJuIG47dGhyb3cgRmUoIkNhbid0IGNvbnZlcnQgb2JqZWN0IHRvIHByaW1pdGl2ZSB2YWx1ZSIpfXJldHVybiB2b2lkIDA9PT10JiYodD0ibnVtYmVyIiksZnVuY3Rpb24oZSx0KXt2YXIgbixyO2lmKCJzdHJpbmciPT09dCYmUShuPWUudG9TdHJpbmcpJiYhbWUocj1UZShuLGUpKSlyZXR1cm4gcjtpZihRKG49ZS52YWx1ZU9mKSYmIW1lKHI9VGUobixlKSkpcmV0dXJuIHI7aWYoInN0cmluZyIhPT10JiZRKG49ZS50b1N0cmluZykmJiFtZShyPVRlKG4sZSkpKXJldHVybiByO3Rocm93IF9lKCJDYW4ndCBjb252ZXJ0IG9iamVjdCB0byBwcmltaXRpdmUgdmFsdWUiKX0oZSx0KX0sJGU9ZnVuY3Rpb24oZSl7dmFyIHQ9QmUoZSwic3RyaW5nIik7cmV0dXJuIExlKHQpP3Q6dCsiIn0sV2U9UC5UeXBlRXJyb3IsSGU9T2JqZWN0LmRlZmluZVByb3BlcnR5LFZlPXtmOnllP0hlOmZ1bmN0aW9uKGUsdCxuKXtpZihPZShlKSx0PSRlKHQpLE9lKG4pLEVlKXRyeXtyZXR1cm4gSGUoZSx0LG4pfWNhdGNoKGUpe31pZigiZ2V0ImluIG58fCJzZXQiaW4gbil0aHJvdyBXZSgiQWNjZXNzb3JzIG5vdCBzdXBwb3J0ZWQiKTtyZXR1cm4gInZhbHVlImluIG4mJihlW3RdPW4udmFsdWUpLGV9fSx6ZT1mdW5jdGlvbihlLHQpe3JldHVybiB7ZW51bWVyYWJsZTohKDEmZSksY29uZmlndXJhYmxlOiEoMiZlKSx3cml0YWJsZTohKDQmZSksdmFsdWU6dH19LFVlPXllP2Z1bmN0aW9uKGUsdCxuKXtyZXR1cm4gVmUuZihlLHQsemUoMSxuKSl9OmZ1bmN0aW9uKGUsdCxuKXtyZXR1cm4gZVt0XT1uLGV9LEtlPVcoRnVuY3Rpb24udG9TdHJpbmcpO1EoQS5pbnNwZWN0U291cmNlKXx8KEEuaW5zcGVjdFNvdXJjZT1mdW5jdGlvbihlKXtyZXR1cm4gS2UoZSl9KTt2YXIgcWUsR2UsSmUsWWU9QS5pbnNwZWN0U291cmNlLFhlPVAuV2Vha01hcCxRZT1RKFhlKSYmL25hdGl2ZSBjb2RlLy50ZXN0KFllKFhlKSksWmU9Xygia2V5cyIpLGV0PWZ1bmN0aW9uKGUpe3JldHVybiBaZVtlXXx8KFplW2VdPVgoZSkpfSx0dD17fSxudD0iT2JqZWN0IGFscmVhZHkgaW5pdGlhbGl6ZWQiLHJ0PVAuVHlwZUVycm9yLG90PVAuV2Vha01hcDtpZihRZXx8QS5zdGF0ZSl7dmFyIGl0PUEuc3RhdGV8fChBLnN0YXRlPW5ldyBvdCksYXQ9VyhpdC5nZXQpLHN0PVcoaXQuaGFzKSxsdD1XKGl0LnNldCk7cWU9ZnVuY3Rpb24oZSx0KXtpZihzdChpdCxlKSl0aHJvdyBuZXcgcnQobnQpO3JldHVybiB0LmZhY2FkZT1lLGx0KGl0LGUsdCksdH0sR2U9ZnVuY3Rpb24oZSl7cmV0dXJuIGF0KGl0LGUpfHx7fX0sSmU9ZnVuY3Rpb24oZSl7cmV0dXJuIHN0KGl0LGUpfTt9ZWxzZSB7dmFyIHV0PWV0KCJzdGF0ZSIpO3R0W3V0XT0hMCxxZT1mdW5jdGlvbihlLHQpe2lmKHEoZSx1dCkpdGhyb3cgbmV3IHJ0KG50KTtyZXR1cm4gdC5mYWNhZGU9ZSxVZShlLHV0LHQpLHR9LEdlPWZ1bmN0aW9uKGUpe3JldHVybiBxKGUsdXQpP2VbdXRdOnt9fSxKZT1mdW5jdGlvbihlKXtyZXR1cm4gcShlLHV0KX07fXZhciBjdD17c2V0OnFlLGdldDpHZSxoYXM6SmUsZW5mb3JjZTpmdW5jdGlvbihlKXtyZXR1cm4gSmUoZSk/R2UoZSk6cWUoZSx7fSl9LGdldHRlckZvcjpmdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24odCl7dmFyIG47aWYoIW1lKHQpfHwobj1HZSh0KSkudHlwZSE9PWUpdGhyb3cgcnQoIkluY29tcGF0aWJsZSByZWNlaXZlciwgIitlKyIgcmVxdWlyZWQiKTtyZXR1cm4gbn19fSxmdD1GdW5jdGlvbi5wcm90b3R5cGUsZHQ9eWUmJk9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IscHQ9cShmdCwibmFtZSIpLGh0PXtFWElTVFM6cHQsUFJPUEVSOnB0JiYic29tZXRoaW5nIj09PWZ1bmN0aW9uKCl7fS5uYW1lLENPTkZJR1VSQUJMRTpwdCYmKCF5ZXx8eWUmJmR0KGZ0LCJuYW1lIikuY29uZmlndXJhYmxlKX0sZ3Q9VCgoZnVuY3Rpb24oZSl7dmFyIHQ9aHQuQ09ORklHVVJBQkxFLG49Y3QuZ2V0LHI9Y3QuZW5mb3JjZSxvPVN0cmluZyhTdHJpbmcpLnNwbGl0KCJTdHJpbmciKTsoZS5leHBvcnRzPWZ1bmN0aW9uKGUsbixpLGEpe3ZhciBzLGw9ISFhJiYhIWEudW5zYWZlLHU9ISFhJiYhIWEuZW51bWVyYWJsZSxjPSEhYSYmISFhLm5vVGFyZ2V0R2V0LGY9YSYmdm9pZCAwIT09YS5uYW1lP2EubmFtZTpuO1EoaSkmJigiU3ltYm9sKCI9PT1TdHJpbmcoZikuc2xpY2UoMCw3KSYmKGY9IlsiK1N0cmluZyhmKS5yZXBsYWNlKC9eU3ltYm9sXCgoW14pXSopXCkvLCIkMSIpKyJdIiksKCFxKGksIm5hbWUiKXx8dCYmaS5uYW1lIT09ZikmJlVlKGksIm5hbWUiLGYpLChzPXIoaSkpLnNvdXJjZXx8KHMuc291cmNlPW8uam9pbigic3RyaW5nIj09dHlwZW9mIGY/ZjoiIikpKSxlIT09UD8obD8hYyYmZVtuXSYmKHU9ITApOmRlbGV0ZSBlW25dLHU/ZVtuXT1pOlVlKGUsbixpKSk6dT9lW25dPWk6RChuLGkpO30pKEZ1bmN0aW9uLnByb3RvdHlwZSwidG9TdHJpbmciLChmdW5jdGlvbigpe3JldHVybiBRKHRoaXMpJiZuKHRoaXMpLnNvdXJjZXx8WWUodGhpcyl9KSk7fSkpLHZ0PVcoe30udG9TdHJpbmcpLHl0PVcoIiIuc2xpY2UpLG10PWZ1bmN0aW9uKGUpe3JldHVybiB5dCh2dChlKSw4LC0xKX0sYnQ9aGUoInRvU3RyaW5nVGFnIiksd3Q9UC5PYmplY3QseHQ9IkFyZ3VtZW50cyI9PW10KGZ1bmN0aW9uKCl7cmV0dXJuIGFyZ3VtZW50c30oKSksRXQ9dmU/bXQ6ZnVuY3Rpb24oZSl7dmFyIHQsbixyO3JldHVybiB2b2lkIDA9PT1lPyJVbmRlZmluZWQiOm51bGw9PT1lPyJOdWxsIjoic3RyaW5nIj09dHlwZW9mKG49ZnVuY3Rpb24oZSx0KXt0cnl7cmV0dXJuIGVbdF19Y2F0Y2goZSl7fX0odD13dChlKSxidCkpP246eHQ/bXQodCk6Ik9iamVjdCI9PShyPW10KHQpKSYmUSh0LmNhbGxlZSk/IkFyZ3VtZW50cyI6cn0sU3Q9dmU/e30udG9TdHJpbmc6ZnVuY3Rpb24oKXtyZXR1cm4gIltvYmplY3QgIitFdCh0aGlzKSsiXSJ9O3ZlfHxndChPYmplY3QucHJvdG90eXBlLCJ0b1N0cmluZyIsU3Qse3Vuc2FmZTohMH0pO3ZhciBrdD17Q1NTUnVsZUxpc3Q6MCxDU1NTdHlsZURlY2xhcmF0aW9uOjAsQ1NTVmFsdWVMaXN0OjAsQ2xpZW50UmVjdExpc3Q6MCxET01SZWN0TGlzdDowLERPTVN0cmluZ0xpc3Q6MCxET01Ub2tlbkxpc3Q6MSxEYXRhVHJhbnNmZXJJdGVtTGlzdDowLEZpbGVMaXN0OjAsSFRNTEFsbENvbGxlY3Rpb246MCxIVE1MQ29sbGVjdGlvbjowLEhUTUxGb3JtRWxlbWVudDowLEhUTUxTZWxlY3RFbGVtZW50OjAsTWVkaWFMaXN0OjAsTWltZVR5cGVBcnJheTowLE5hbWVkTm9kZU1hcDowLE5vZGVMaXN0OjEsUGFpbnRSZXF1ZXN0TGlzdDowLFBsdWdpbjowLFBsdWdpbkFycmF5OjAsU1ZHTGVuZ3RoTGlzdDowLFNWR051bWJlckxpc3Q6MCxTVkdQYXRoU2VnTGlzdDowLFNWR1BvaW50TGlzdDowLFNWR1N0cmluZ0xpc3Q6MCxTVkdUcmFuc2Zvcm1MaXN0OjAsU291cmNlQnVmZmVyTGlzdDowLFN0eWxlU2hlZXRMaXN0OjAsVGV4dFRyYWNrQ3VlTGlzdDowLFRleHRUcmFja0xpc3Q6MCxUb3VjaExpc3Q6MH0sT3Q9eGUoInNwYW4iKS5jbGFzc0xpc3QsQ3Q9T3QmJk90LmNvbnN0cnVjdG9yJiZPdC5jb25zdHJ1Y3Rvci5wcm90b3R5cGUsVHQ9Q3Q9PT1PYmplY3QucHJvdG90eXBlP3ZvaWQgMDpDdCxOdD1XKFcuYmluZCksTXQ9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gamUoZSksdm9pZCAwPT09dD9lOk50P050KGUsdCk6ZnVuY3Rpb24oKXtyZXR1cm4gZS5hcHBseSh0LGFyZ3VtZW50cyl9fSxMdD1QLk9iamVjdCxQdD1XKCIiLnNwbGl0KSxSdD1zZSgoZnVuY3Rpb24oKXtyZXR1cm4gIUx0KCJ6IikucHJvcGVydHlJc0VudW1lcmFibGUoMCl9KSk/ZnVuY3Rpb24oZSl7cmV0dXJuICJTdHJpbmciPT1tdChlKT9QdChlLCIiKTpMdChlKX06THQsRHQ9TWF0aC5jZWlsLGp0PU1hdGguZmxvb3IsQXQ9ZnVuY3Rpb24oZSl7dmFyIHQ9K2U7cmV0dXJuIHQhPXR8fDA9PT10PzA6KHQ+MD9qdDpEdCkodCl9LF90PU1hdGgubWluLEZ0PWZ1bmN0aW9uKGUpe3JldHVybiBlPjA/X3QoQXQoZSksOTAwNzE5OTI1NDc0MDk5MSk6MH0sSXQ9ZnVuY3Rpb24oZSl7cmV0dXJuIEZ0KGUubGVuZ3RoKX0sQnQ9QXJyYXkuaXNBcnJheXx8ZnVuY3Rpb24oZSl7cmV0dXJuICJBcnJheSI9PW10KGUpfSwkdD1mdW5jdGlvbigpe30sV3Q9W10sSHQ9ZWUoIlJlZmxlY3QiLCJjb25zdHJ1Y3QiKSxWdD0vXlxzKig/OmNsYXNzfGZ1bmN0aW9uKVxiLyx6dD1XKFZ0LmV4ZWMpLFV0PSFWdC5leGVjKCR0KSxLdD1mdW5jdGlvbihlKXtpZighUShlKSlyZXR1cm4gITE7dHJ5e3JldHVybiBIdCgkdCxXdCxlKSwhMH1jYXRjaChlKXtyZXR1cm4gITF9fSxxdD0hSHR8fHNlKChmdW5jdGlvbigpe3ZhciBlO3JldHVybiBLdChLdC5jYWxsKXx8IUt0KE9iamVjdCl8fCFLdCgoZnVuY3Rpb24oKXtlPSEwO30pKXx8ZX0pKT9mdW5jdGlvbihlKXtpZighUShlKSlyZXR1cm4gITE7c3dpdGNoKEV0KGUpKXtjYXNlIkFzeW5jRnVuY3Rpb24iOmNhc2UiR2VuZXJhdG9yRnVuY3Rpb24iOmNhc2UiQXN5bmNHZW5lcmF0b3JGdW5jdGlvbiI6cmV0dXJuICExfXJldHVybiBVdHx8ISF6dChWdCxZZShlKSl9Okt0LEd0PWhlKCJzcGVjaWVzIiksSnQ9UC5BcnJheSxZdD1mdW5jdGlvbihlLHQpe3JldHVybiBuZXcoZnVuY3Rpb24oZSl7dmFyIHQ7cmV0dXJuIEJ0KGUpJiYodD1lLmNvbnN0cnVjdG9yLChxdCh0KSYmKHQ9PT1KdHx8QnQodC5wcm90b3R5cGUpKXx8bWUodCkmJm51bGw9PT0odD10W0d0XSkpJiYodD12b2lkIDApKSx2b2lkIDA9PT10P0p0OnR9KGUpKSgwPT09dD8wOnQpfSxYdD1XKFtdLnB1c2gpLFF0PWZ1bmN0aW9uKGUpe3ZhciB0PTE9PWUsbj0yPT1lLHI9Mz09ZSxvPTQ9PWUsaT02PT1lLGE9Nz09ZSxzPTU9PWV8fGk7cmV0dXJuIGZ1bmN0aW9uKGwsdSxjLGYpe2Zvcih2YXIgZCxwLGg9VShsKSxnPVJ0KGgpLHY9TXQodSxjKSx5PUl0KGcpLG09MCxiPWZ8fFl0LHc9dD9iKGwseSk6bnx8YT9iKGwsMCk6dm9pZCAwO3k+bTttKyspaWYoKHN8fG0gaW4gZykmJihwPXYoZD1nW21dLG0saCksZSkpaWYodCl3W21dPXA7ZWxzZSBpZihwKXN3aXRjaChlKXtjYXNlIDM6cmV0dXJuICEwO2Nhc2UgNTpyZXR1cm4gZDtjYXNlIDY6cmV0dXJuIG07Y2FzZSAyOlh0KHcsZCk7fWVsc2Ugc3dpdGNoKGUpe2Nhc2UgNDpyZXR1cm4gITE7Y2FzZSA3Olh0KHcsZCk7fXJldHVybiBpPy0xOnJ8fG8/bzp3fX0sWnQ9e2ZvckVhY2g6UXQoMCksbWFwOlF0KDEpLGZpbHRlcjpRdCgyKSxzb21lOlF0KDMpLGV2ZXJ5OlF0KDQpLGZpbmQ6UXQoNSksZmluZEluZGV4OlF0KDYpLGZpbHRlclJlamVjdDpRdCg3KX0sZW49ZnVuY3Rpb24oZSx0KXt2YXIgbj1bXVtlXTtyZXR1cm4gISFuJiZzZSgoZnVuY3Rpb24oKXtuLmNhbGwobnVsbCx0fHxmdW5jdGlvbigpe3Rocm93IDF9LDEpO30pKX0sdG49WnQuZm9yRWFjaCxubj1lbigiZm9yRWFjaCIpP1tdLmZvckVhY2g6ZnVuY3Rpb24oZSl7cmV0dXJuIHRuKHRoaXMsZSxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCl9LHJuPWZ1bmN0aW9uKGUpe2lmKGUmJmUuZm9yRWFjaCE9PW5uKXRyeXtVZShlLCJmb3JFYWNoIixubik7fWNhdGNoKHQpe2UuZm9yRWFjaD1ubjt9fTtmb3IodmFyIG9uIGluIGt0KWt0W29uXSYmcm4oUFtvbl0mJlBbb25dLnByb3RvdHlwZSk7cm4oVHQpO3ZhciBhbj17fS5wcm9wZXJ0eUlzRW51bWVyYWJsZSxzbj1PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLGxuPXNuJiYhYW4uY2FsbCh7MToyfSwxKT9mdW5jdGlvbihlKXt2YXIgdD1zbih0aGlzLGUpO3JldHVybiAhIXQmJnQuZW51bWVyYWJsZX06YW4sdW49e2Y6bG59LGNuPWZ1bmN0aW9uKGUpe3JldHVybiBSdChWKGUpKX0sZm49T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcixkbj17Zjp5ZT9mbjpmdW5jdGlvbihlLHQpe2lmKGU9Y24oZSksdD0kZSh0KSxFZSl0cnl7cmV0dXJuIGZuKGUsdCl9Y2F0Y2goZSl7fWlmKHEoZSx0KSlyZXR1cm4gemUoIVRlKHVuLmYsZSx0KSxlW3RdKX19LHBuPU1hdGgubWF4LGhuPU1hdGgubWluLGduPWZ1bmN0aW9uKGUsdCl7dmFyIG49QXQoZSk7cmV0dXJuIG48MD9wbihuK3QsMCk6aG4obix0KX0sdm49ZnVuY3Rpb24oZSl7cmV0dXJuIGZ1bmN0aW9uKHQsbixyKXt2YXIgbyxpPWNuKHQpLGE9SXQoaSkscz1nbihyLGEpO2lmKGUmJm4hPW4pe2Zvcig7YT5zOylpZigobz1pW3MrK10pIT1vKXJldHVybiAhMH1lbHNlIGZvcig7YT5zO3MrKylpZigoZXx8cyBpbiBpKSYmaVtzXT09PW4pcmV0dXJuIGV8fHN8fDA7cmV0dXJuICFlJiYtMX19LHluPXtpbmNsdWRlczp2bighMCksaW5kZXhPZjp2bighMSl9LG1uPXluLmluZGV4T2YsYm49VyhbXS5wdXNoKSx3bj1mdW5jdGlvbihlLHQpe3ZhciBuLHI9Y24oZSksbz0wLGk9W107Zm9yKG4gaW4gcikhcSh0dCxuKSYmcShyLG4pJiZibihpLG4pO2Zvcig7dC5sZW5ndGg+bzspcShyLG49dFtvKytdKSYmKH5tbihpLG4pfHxibihpLG4pKTtyZXR1cm4gaX0seG49WyJjb25zdHJ1Y3RvciIsImhhc093blByb3BlcnR5IiwiaXNQcm90b3R5cGVPZiIsInByb3BlcnR5SXNFbnVtZXJhYmxlIiwidG9Mb2NhbGVTdHJpbmciLCJ0b1N0cmluZyIsInZhbHVlT2YiXSxFbj14bi5jb25jYXQoImxlbmd0aCIsInByb3RvdHlwZSIpLFNuPXtmOk9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzfHxmdW5jdGlvbihlKXtyZXR1cm4gd24oZSxFbil9fSxrbj17ZjpPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzfSxPbj1XKFtdLmNvbmNhdCksQ249ZWUoIlJlZmxlY3QiLCJvd25LZXlzIil8fGZ1bmN0aW9uKGUpe3ZhciB0PVNuLmYoT2UoZSkpLG49a24uZjtyZXR1cm4gbj9Pbih0LG4oZSkpOnR9LFRuPWZ1bmN0aW9uKGUsdCl7Zm9yKHZhciBuPUNuKHQpLHI9VmUuZixvPWRuLmYsaT0wO2k8bi5sZW5ndGg7aSsrKXt2YXIgYT1uW2ldO3EoZSxhKXx8cihlLGEsbyh0LGEpKTt9fSxObj0vI3xcLnByb3RvdHlwZVwuLyxNbj1mdW5jdGlvbihlLHQpe3ZhciBuPVBuW0xuKGUpXTtyZXR1cm4gbj09RG58fG4hPVJuJiYoUSh0KT9zZSh0KTohIXQpfSxMbj1Nbi5ub3JtYWxpemU9ZnVuY3Rpb24oZSl7cmV0dXJuIFN0cmluZyhlKS5yZXBsYWNlKE5uLCIuIikudG9Mb3dlckNhc2UoKX0sUG49TW4uZGF0YT17fSxSbj1Nbi5OQVRJVkU9Ik4iLERuPU1uLlBPTFlGSUxMPSJQIixqbj1NbixBbj1kbi5mLF9uPWZ1bmN0aW9uKGUsdCl7dmFyIG4scixvLGksYSxzPWUudGFyZ2V0LGw9ZS5nbG9iYWwsdT1lLnN0YXQ7aWYobj1sP1A6dT9QW3NdfHxEKHMse30pOihQW3NdfHx7fSkucHJvdG90eXBlKWZvcihyIGluIHQpe2lmKGk9dFtyXSxvPWUubm9UYXJnZXRHZXQ/KGE9QW4obixyKSkmJmEudmFsdWU6bltyXSwham4obD9yOnMrKHU/Ii4iOiIjIikrcixlLmZvcmNlZCkmJnZvaWQgMCE9PW8pe2lmKHR5cGVvZiBpPT10eXBlb2Ygbyljb250aW51ZTtUbihpLG8pO30oZS5zaGFtfHxvJiZvLnNoYW0pJiZVZShpLCJzaGFtIiwhMCksZ3QobixyLGksZSk7fX0sRm49T2JqZWN0LmtleXN8fGZ1bmN0aW9uKGUpe3JldHVybiB3bihlLHhuKX0sSW49c2UoKGZ1bmN0aW9uKCl7Rm4oMSk7fSkpOwogIC8qIQogIAkgKiBpcy1wbGFpbi1vYmplY3QgPGh0dHBzOi8vZ2l0aHViLmNvbS9qb25zY2hsaW5rZXJ0L2lzLXBsYWluLW9iamVjdD4KICAJICoKICAJICogQ29weXJpZ2h0IChjKSAyMDE0LTIwMTcsIEpvbiBTY2hsaW5rZXJ0LgogIAkgKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuCiAgCSAqLwogIGZ1bmN0aW9uIEJuKGUpe3JldHVybiAiW29iamVjdCBPYmplY3RdIj09PU9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChlKX1fbih7dGFyZ2V0OiJPYmplY3QiLHN0YXQ6ITAsZm9yY2VkOklufSx7a2V5czpmdW5jdGlvbihlKXtyZXR1cm4gRm4oVShlKSl9fSk7dmFyICRuPWZ1bmN0aW9uKGUpe3ZhciB0LG47cmV0dXJuICExIT09Qm4oZSkmJih2b2lkIDA9PT0odD1lLmNvbnN0cnVjdG9yKXx8ITEhPT1CbihuPXQucHJvdG90eXBlKSYmITEhPT1uLmhhc093blByb3BlcnR5KCJpc1Byb3RvdHlwZU9mIikpfSxXbj1PYmplY3QuZGVmaW5lUHJvcGVydHkoe2lzUGxhaW5PYmplY3Q6JG59LCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KSxIbj1mdW5jdGlvbihlKXtyZXR1cm4gV24uaXNQbGFpbk9iamVjdChlKSYmQXJyYXkuaXNBcnJheShlLnJlZG9zKSYmQXJyYXkuaXNBcnJheShlLnVuZG9zKSYmKDA9PT1lLnJlZG9zLmxlbmd0aHx8Zy5kZWZhdWx0Lk9wZXJhdGlvbi5pc09wZXJhdGlvbkxpc3QoZS5yZWRvc1swXSkpJiYoMD09PWUudW5kb3MubGVuZ3RofHxnLmRlZmF1bHQuT3BlcmF0aW9uLmlzT3BlcmF0aW9uTGlzdChlLnVuZG9zWzBdKSl9LFZuPW5ldyBXZWFrTWFwLHpuPW5ldyBXZWFrTWFwLFVuPXtpc0hpc3RvcnlFZGl0b3I6ZnVuY3Rpb24oZSl7cmV0dXJuIEhuKGUuaGlzdG9yeSkmJmcuZGVmYXVsdC5FZGl0b3IuaXNFZGl0b3IoZSl9LGlzTWVyZ2luZzpmdW5jdGlvbihlKXtyZXR1cm4gem4uZ2V0KGUpfSxpc1NhdmluZzpmdW5jdGlvbihlKXtyZXR1cm4gVm4uZ2V0KGUpfSxyZWRvOmZ1bmN0aW9uKGUpe2UucmVkbygpO30sdW5kbzpmdW5jdGlvbihlKXtlLnVuZG8oKTt9LHdpdGhvdXRNZXJnaW5nOmZ1bmN0aW9uKGUsdCl7dmFyIG49VW4uaXNNZXJnaW5nKGUpO3puLnNldChlLCExKSx0KCksem4uc2V0KGUsbik7fSx3aXRob3V0U2F2aW5nOmZ1bmN0aW9uKGUsdCl7dmFyIG49VW4uaXNTYXZpbmcoZSk7Vm4uc2V0KGUsITEpLHQoKSxWbi5zZXQoZSxuKTt9fTtmdW5jdGlvbiBLbihlLHQpe3ZhciBuPSJ1bmRlZmluZWQiIT10eXBlb2YgU3ltYm9sJiZlW1N5bWJvbC5pdGVyYXRvcl18fGVbIkBAaXRlcmF0b3IiXTtpZighbil7aWYoQXJyYXkuaXNBcnJheShlKXx8KG49ZnVuY3Rpb24oZSx0KXtpZighZSlyZXR1cm47aWYoInN0cmluZyI9PXR5cGVvZiBlKXJldHVybiBxbihlLHQpO3ZhciBuPU9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChlKS5zbGljZSg4LC0xKTsiT2JqZWN0Ij09PW4mJmUuY29uc3RydWN0b3ImJihuPWUuY29uc3RydWN0b3IubmFtZSk7aWYoIk1hcCI9PT1ufHwiU2V0Ij09PW4pcmV0dXJuIEFycmF5LmZyb20oZSk7aWYoIkFyZ3VtZW50cyI9PT1ufHwvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSlyZXR1cm4gcW4oZSx0KX0oZSkpfHx0JiZlJiYibnVtYmVyIj09dHlwZW9mIGUubGVuZ3RoKXtuJiYoZT1uKTt2YXIgcj0wLG89ZnVuY3Rpb24oKXt9O3JldHVybiB7czpvLG46ZnVuY3Rpb24oKXtyZXR1cm4gcj49ZS5sZW5ndGg/e2RvbmU6ITB9Ontkb25lOiExLHZhbHVlOmVbcisrXX19LGU6ZnVuY3Rpb24oZSl7dGhyb3cgZX0sZjpvfX10aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gaXRlcmF0ZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIil9dmFyIGksYT0hMCxzPSExO3JldHVybiB7czpmdW5jdGlvbigpe249bi5jYWxsKGUpO30sbjpmdW5jdGlvbigpe3ZhciBlPW4ubmV4dCgpO3JldHVybiBhPWUuZG9uZSxlfSxlOmZ1bmN0aW9uKGUpe3M9ITAsaT1lO30sZjpmdW5jdGlvbigpe3RyeXthfHxudWxsPT1uLnJldHVybnx8bi5yZXR1cm4oKTt9ZmluYWxseXtpZihzKXRocm93IGl9fX19ZnVuY3Rpb24gcW4oZSx0KXsobnVsbD09dHx8dD5lLmxlbmd0aCkmJih0PWUubGVuZ3RoKTtmb3IodmFyIG49MCxyPW5ldyBBcnJheSh0KTtuPHQ7bisrKXJbbl09ZVtuXTtyZXR1cm4gcn12YXIgR249ZnVuY3Rpb24oZSx0KXtyZXR1cm4gInNldF9zZWxlY3Rpb24iPT09ZS50eXBlfHwoISghdHx8Imluc2VydF90ZXh0IiE9PWUudHlwZXx8Imluc2VydF90ZXh0IiE9PXQudHlwZXx8ZS5vZmZzZXQhPT10Lm9mZnNldCt0LnRleHQubGVuZ3RofHwhZy5kZWZhdWx0LlBhdGguZXF1YWxzKGUucGF0aCx0LnBhdGgpKXx8ISghdHx8InJlbW92ZV90ZXh0IiE9PWUudHlwZXx8InJlbW92ZV90ZXh0IiE9PXQudHlwZXx8ZS5vZmZzZXQrZS50ZXh0Lmxlbmd0aCE9PXQub2Zmc2V0fHwhZy5kZWZhdWx0LlBhdGguZXF1YWxzKGUucGF0aCx0LnBhdGgpKSl9LEpuPWZ1bmN0aW9uKGUsdCl7cmV0dXJuICJzZXRfc2VsZWN0aW9uIiE9PWUudHlwZXx8bnVsbCE9ZS5wcm9wZXJ0aWVzJiZudWxsIT1lLm5ld1Byb3BlcnRpZXN9LFluPWZ1bmN0aW9uKGUsdCl7cmV0dXJuICEoIXR8fCJzZXRfc2VsZWN0aW9uIiE9PWUudHlwZXx8InNldF9zZWxlY3Rpb24iIT09dC50eXBlKX0sWG49ZnVuY3Rpb24oZSl7cmV0dXJuICJzZXRfc2VsZWN0aW9uIiE9PWUudHlwZX0sUW49ZnVuY3Rpb24oZSl7dmFyIHQ9ZSxuPXQuYXBwbHk7cmV0dXJuIHQuaGlzdG9yeT17dW5kb3M6W10scmVkb3M6W119LHQucmVkbz1mdW5jdGlvbigpe3ZhciBlPXQuaGlzdG9yeSxuPWUucmVkb3M7aWYobi5sZW5ndGg+MCl7dmFyIHI9bltuLmxlbmd0aC0xXTtVbi53aXRob3V0U2F2aW5nKHQsKGZ1bmN0aW9uKCl7Zy5kZWZhdWx0LkVkaXRvci53aXRob3V0Tm9ybWFsaXppbmcodCwoZnVuY3Rpb24oKXt2YXIgZSxuPUtuKHIpO3RyeXtmb3Iobi5zKCk7IShlPW4ubigpKS5kb25lOyl7dmFyIG89ZS52YWx1ZTt0LmFwcGx5KG8pO319Y2F0Y2goZSl7bi5lKGUpO31maW5hbGx5e24uZigpO319KSk7fSkpLGUucmVkb3MucG9wKCksZS51bmRvcy5wdXNoKHIpO319LHQudW5kbz1mdW5jdGlvbigpe3ZhciBlPXQuaGlzdG9yeSxuPWUudW5kb3M7aWYobi5sZW5ndGg+MCl7dmFyIHI9bltuLmxlbmd0aC0xXTtVbi53aXRob3V0U2F2aW5nKHQsKGZ1bmN0aW9uKCl7Zy5kZWZhdWx0LkVkaXRvci53aXRob3V0Tm9ybWFsaXppbmcodCwoZnVuY3Rpb24oKXt2YXIgZSxuPUtuKHIubWFwKGcuZGVmYXVsdC5PcGVyYXRpb24uaW52ZXJzZSkucmV2ZXJzZSgpKTt0cnl7Zm9yKG4ucygpOyEoZT1uLm4oKSkuZG9uZTspe3ZhciBvPWUudmFsdWU7dC5hcHBseShvKTt9fWNhdGNoKGUpe24uZShlKTt9ZmluYWxseXtuLmYoKTt9fSkpO30pKSxlLnJlZG9zLnB1c2gociksZS51bmRvcy5wb3AoKTt9fSx0LmFwcGx5PWZ1bmN0aW9uKGUpe3ZhciByPXQub3BlcmF0aW9ucyxvPXQuaGlzdG9yeSxpPW8udW5kb3MsYT1pW2kubGVuZ3RoLTFdLHM9YSYmYVthLmxlbmd0aC0xXSxsPVluKGUscyksdT1Vbi5pc1NhdmluZyh0KSxjPVVuLmlzTWVyZ2luZyh0KTtpZihudWxsPT11JiYodT1KbihlKSksdSl7aWYobnVsbD09YyYmKGM9bnVsbCE9YSYmKDAhPT1yLmxlbmd0aHx8KEduKGUscyl8fGwpKSksYSYmYylsJiZhLnBvcCgpLGEucHVzaChlKTtlbHNlIHt2YXIgZj1bZV07aS5wdXNoKGYpO31mb3IoO2kubGVuZ3RoPjEwMDspaS5zaGlmdCgpO1huKGUpJiYoby5yZWRvcz1bXSk7fW4oZSk7fSx0fSxabj1QLlN0cmluZyxlcj1mdW5jdGlvbihlKXtpZigiU3ltYm9sIj09PUV0KGUpKXRocm93IFR5cGVFcnJvcigiQ2Fubm90IGNvbnZlcnQgYSBTeW1ib2wgdmFsdWUgdG8gYSBzdHJpbmciKTtyZXR1cm4gWm4oZSl9LHRyPWZ1bmN0aW9uKCl7dmFyIGU9T2UodGhpcyksdD0iIjtyZXR1cm4gZS5nbG9iYWwmJih0Kz0iZyIpLGUuaWdub3JlQ2FzZSYmKHQrPSJpIiksZS5tdWx0aWxpbmUmJih0Kz0ibSIpLGUuZG90QWxsJiYodCs9InMiKSxlLnVuaWNvZGUmJih0Kz0idSIpLGUuc3RpY2t5JiYodCs9InkiKSx0fSxucj1odC5QUk9QRVIscnI9InRvU3RyaW5nIixvcj1SZWdFeHAucHJvdG90eXBlLGlyPW9yLnRvU3RyaW5nLGFyPVcodHIpLHNyPXNlKChmdW5jdGlvbigpe3JldHVybiAiL2EvYiIhPWlyLmNhbGwoe3NvdXJjZToiYSIsZmxhZ3M6ImIifSl9KSksbHI9bnImJmlyLm5hbWUhPXJyOyhzcnx8bHIpJiZndChSZWdFeHAucHJvdG90eXBlLHJyLChmdW5jdGlvbigpe3ZhciBlPU9lKHRoaXMpLHQ9ZXIoZS5zb3VyY2UpLG49ZS5mbGFncztyZXR1cm4gIi8iK3QrIi8iK2VyKHZvaWQgMD09PW4mJk5lKG9yLGUpJiYhKCJmbGFncyJpbiBvcik/YXIoZSk6bil9KSx7dW5zYWZlOiEwfSk7dmFyIHVyLGNyPXllP09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzOmZ1bmN0aW9uKGUsdCl7T2UoZSk7Zm9yKHZhciBuLHI9Y24odCksbz1Gbih0KSxpPW8ubGVuZ3RoLGE9MDtpPmE7KVZlLmYoZSxuPW9bYSsrXSxyW25dKTtyZXR1cm4gZX0sZnI9ZWUoImRvY3VtZW50IiwiZG9jdW1lbnRFbGVtZW50IiksZHI9ZXQoIklFX1BST1RPIikscHI9ZnVuY3Rpb24oKXt9LGhyPWZ1bmN0aW9uKGUpe3JldHVybiAiPHNjcmlwdD4iK2UrIjwvIisic2NyaXB0PiJ9LGdyPWZ1bmN0aW9uKGUpe2Uud3JpdGUoaHIoIiIpKSxlLmNsb3NlKCk7dmFyIHQ9ZS5wYXJlbnRXaW5kb3cuT2JqZWN0O3JldHVybiBlPW51bGwsdH0sdnI9ZnVuY3Rpb24oKXt0cnl7dXI9bmV3IEFjdGl2ZVhPYmplY3QoImh0bWxmaWxlIik7fWNhdGNoKGUpe312YXIgZSx0O3ZyPSJ1bmRlZmluZWQiIT10eXBlb2YgZG9jdW1lbnQ/ZG9jdW1lbnQuZG9tYWluJiZ1cj9ncih1cik6KCh0PXhlKCJpZnJhbWUiKSkuc3R5bGUuZGlzcGxheT0ibm9uZSIsZnIuYXBwZW5kQ2hpbGQodCksdC5zcmM9U3RyaW5nKCJqYXZhc2NyaXB0OiIpLChlPXQuY29udGVudFdpbmRvdy5kb2N1bWVudCkub3BlbigpLGUud3JpdGUoaHIoImRvY3VtZW50LkY9T2JqZWN0IikpLGUuY2xvc2UoKSxlLkYpOmdyKHVyKTtmb3IodmFyIG49eG4ubGVuZ3RoO24tLTspZGVsZXRlIHZyLnByb3RvdHlwZVt4bltuXV07cmV0dXJuIHZyKCl9O3R0W2RyXT0hMDt2YXIgeXI9T2JqZWN0LmNyZWF0ZXx8ZnVuY3Rpb24oZSx0KXt2YXIgbjtyZXR1cm4gbnVsbCE9PWU/KHByLnByb3RvdHlwZT1PZShlKSxuPW5ldyBwcixwci5wcm90b3R5cGU9bnVsbCxuW2RyXT1lKTpuPXZyKCksdm9pZCAwPT09dD9uOmNyKG4sdCl9LG1yPWhlKCJ1bnNjb3BhYmxlcyIpLGJyPUFycmF5LnByb3RvdHlwZTtudWxsPT1iclttcl0mJlZlLmYoYnIsbXIse2NvbmZpZ3VyYWJsZTohMCx2YWx1ZTp5cihudWxsKX0pO3ZhciB3cj1mdW5jdGlvbihlKXticlttcl1bZV09ITA7fSx4cj15bi5pbmNsdWRlcztfbih7dGFyZ2V0OiJBcnJheSIscHJvdG86ITB9LHtpbmNsdWRlczpmdW5jdGlvbihlKXtyZXR1cm4geHIodGhpcyxlLGFyZ3VtZW50cy5sZW5ndGg+MT9hcmd1bWVudHNbMV06dm9pZCAwKX19KSx3cigiaW5jbHVkZXMiKTt2YXIgRXI9aGUoIm1hdGNoIiksU3I9ZnVuY3Rpb24oZSl7dmFyIHQ7cmV0dXJuIG1lKGUpJiYodm9pZCAwIT09KHQ9ZVtFcl0pPyEhdDoiUmVnRXhwIj09bXQoZSkpfSxrcj1QLlR5cGVFcnJvcixPcj1mdW5jdGlvbihlKXtpZihTcihlKSl0aHJvdyBrcigiVGhlIG1ldGhvZCBkb2Vzbid0IGFjY2VwdCByZWd1bGFyIGV4cHJlc3Npb25zIik7cmV0dXJuIGV9LENyPWhlKCJtYXRjaCIpLFRyPWZ1bmN0aW9uKGUpe3ZhciB0PS8uLzt0cnl7Ii8uLyJbZV0odCk7fWNhdGNoKG4pe3RyeXtyZXR1cm4gdFtDcl09ITEsIi8uLyJbZV0odCl9Y2F0Y2goZSl7fX1yZXR1cm4gITF9LE5yPVcoIiIuaW5kZXhPZik7X24oe3RhcmdldDoiU3RyaW5nIixwcm90bzohMCxmb3JjZWQ6IVRyKCJpbmNsdWRlcyIpfSx7aW5jbHVkZXM6ZnVuY3Rpb24oZSl7cmV0dXJuICEhfk5yKGVyKFYodGhpcykpLGVyKE9yKGUpKSxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCl9fSk7dmFyIE1yLExyPS8iL2csUHI9VygiIi5yZXBsYWNlKTtfbih7dGFyZ2V0OiJTdHJpbmciLHByb3RvOiEwLGZvcmNlZDooTXI9ImFuY2hvciIsc2UoKGZ1bmN0aW9uKCl7dmFyIGU9IiJbTXJdKCciJyk7cmV0dXJuIGUhPT1lLnRvTG93ZXJDYXNlKCl8fGUuc3BsaXQoJyInKS5sZW5ndGg+M30pKSl9LHthbmNob3I6ZnVuY3Rpb24oZSl7cmV0dXJuIHQ9ImEiLG49Im5hbWUiLHI9ZSxvPWVyKFYodGhpcykpLGk9IjwiK3QsIiIhPT1uJiYoaSs9IiAiK24rJz0iJytQcihlcihyKSxMciwiJnF1b3Q7IikrJyInKSxpKyI+IitvKyI8LyIrdCsiPiI7dmFyIHQsbixyLG8saTt9fSk7dmFyIFJyPWZ1bmN0aW9uKGUsdCxuKXt2YXIgcixvO09lKGUpO3RyeXtpZighKHI9QWUoZSwicmV0dXJuIikpKXtpZigidGhyb3ciPT09dCl0aHJvdyBuO3JldHVybiBufXI9VGUocixlKTt9Y2F0Y2goZSl7bz0hMCxyPWU7fWlmKCJ0aHJvdyI9PT10KXRocm93IG47aWYobyl0aHJvdyByO3JldHVybiBPZShyKSxufSxEcj1mdW5jdGlvbihlLHQsbixyKXt0cnl7cmV0dXJuIHI/dChPZShuKVswXSxuWzFdKTp0KG4pfWNhdGNoKHQpe1JyKGUsInRocm93Iix0KTt9fSxqcj17fSxBcj1oZSgiaXRlcmF0b3IiKSxfcj1BcnJheS5wcm90b3R5cGUsRnI9ZnVuY3Rpb24oZSl7cmV0dXJuIHZvaWQgMCE9PWUmJihqci5BcnJheT09PWV8fF9yW0FyXT09PWUpfSxJcj1mdW5jdGlvbihlLHQsbil7dmFyIHI9JGUodCk7ciBpbiBlP1ZlLmYoZSxyLHplKDAsbikpOmVbcl09bjt9LEJyPWhlKCJpdGVyYXRvciIpLCRyPWZ1bmN0aW9uKGUpe2lmKG51bGwhPWUpcmV0dXJuIEFlKGUsQnIpfHxBZShlLCJAQGl0ZXJhdG9yIil8fGpyW0V0KGUpXX0sV3I9UC5UeXBlRXJyb3IsSHI9ZnVuY3Rpb24oZSx0KXt2YXIgbj1hcmd1bWVudHMubGVuZ3RoPDI/JHIoZSk6dDtpZihqZShuKSlyZXR1cm4gT2UoVGUobixlKSk7dGhyb3cgV3IoUmUoZSkrIiBpcyBub3QgaXRlcmFibGUiKX0sVnI9UC5BcnJheSx6cj1oZSgiaXRlcmF0b3IiKSxVcj0hMTt0cnl7dmFyIEtyPTAscXI9e25leHQ6ZnVuY3Rpb24oKXtyZXR1cm4ge2RvbmU6ISFLcisrfX0scmV0dXJuOmZ1bmN0aW9uKCl7VXI9ITA7fX07cXJbenJdPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9LEFycmF5LmZyb20ocXIsKGZ1bmN0aW9uKCl7dGhyb3cgMn0pKTt9Y2F0Y2goZSl7fXZhciBHcj1mdW5jdGlvbihlLHQpe2lmKCF0JiYhVXIpcmV0dXJuICExO3ZhciBuPSExO3RyeXt2YXIgcj17fTtyW3pyXT1mdW5jdGlvbigpe3JldHVybiB7bmV4dDpmdW5jdGlvbigpe3JldHVybiB7ZG9uZTpuPSEwfX19fSxlKHIpO31jYXRjaChlKXt9cmV0dXJuIG59LEpyPSFHcigoZnVuY3Rpb24oZSl7QXJyYXkuZnJvbShlKTt9KSk7X24oe3RhcmdldDoiQXJyYXkiLHN0YXQ6ITAsZm9yY2VkOkpyfSx7ZnJvbTpmdW5jdGlvbihlKXt2YXIgdD1VKGUpLG49cXQodGhpcykscj1hcmd1bWVudHMubGVuZ3RoLG89cj4xP2FyZ3VtZW50c1sxXTp2b2lkIDAsaT12b2lkIDAhPT1vO2kmJihvPU10KG8scj4yP2FyZ3VtZW50c1syXTp2b2lkIDApKTt2YXIgYSxzLGwsdSxjLGYsZD0kcih0KSxwPTA7aWYoIWR8fHRoaXM9PVZyJiZGcihkKSlmb3IoYT1JdCh0KSxzPW4/bmV3IHRoaXMoYSk6VnIoYSk7YT5wO3ArKylmPWk/byh0W3BdLHApOnRbcF0sSXIocyxwLGYpO2Vsc2UgZm9yKGM9KHU9SHIodCxkKSkubmV4dCxzPW4/bmV3IHRoaXM6W107IShsPVRlKGMsdSkpLmRvbmU7cCsrKWY9aT9Ecih1LG8sW2wudmFsdWUscF0sITApOmwudmFsdWUsSXIocyxwLGYpO3JldHVybiBzLmxlbmd0aD1wLHN9fSk7dmFyIFlyLFhyLFFyLFpyPVcoIiIuY2hhckF0KSxlbz1XKCIiLmNoYXJDb2RlQXQpLHRvPVcoIiIuc2xpY2UpLG5vPWZ1bmN0aW9uKGUpe3JldHVybiBmdW5jdGlvbih0LG4pe3ZhciByLG8saT1lcihWKHQpKSxhPUF0KG4pLHM9aS5sZW5ndGg7cmV0dXJuIGE8MHx8YT49cz9lPyIiOnZvaWQgMDoocj1lbyhpLGEpKTw1NTI5Nnx8cj41NjMxOXx8YSsxPT09c3x8KG89ZW8oaSxhKzEpKTw1NjMyMHx8bz41NzM0Mz9lP1pyKGksYSk6cjplP3RvKGksYSxhKzIpOm8tNTYzMjArKHItNTUyOTY8PDEwKSs2NTUzNn19LHJvPXtjb2RlQXQ6bm8oITEpLGNoYXJBdDpubyghMCl9LG9vPSFzZSgoZnVuY3Rpb24oKXtmdW5jdGlvbiBlKCl7fXJldHVybiBlLnByb3RvdHlwZS5jb25zdHJ1Y3Rvcj1udWxsLE9iamVjdC5nZXRQcm90b3R5cGVPZihuZXcgZSkhPT1lLnByb3RvdHlwZX0pKSxpbz1ldCgiSUVfUFJPVE8iKSxhbz1QLk9iamVjdCxzbz1hby5wcm90b3R5cGUsbG89b28/YW8uZ2V0UHJvdG90eXBlT2Y6ZnVuY3Rpb24oZSl7dmFyIHQ9VShlKTtpZihxKHQsaW8pKXJldHVybiB0W2lvXTt2YXIgbj10LmNvbnN0cnVjdG9yO3JldHVybiBRKG4pJiZ0IGluc3RhbmNlb2Ygbj9uLnByb3RvdHlwZTp0IGluc3RhbmNlb2YgYW8/c286bnVsbH0sdW89aGUoIml0ZXJhdG9yIiksY289ITE7W10ua2V5cyYmKCJuZXh0ImluKFFyPVtdLmtleXMoKSk/KFhyPWxvKGxvKFFyKSkpIT09T2JqZWN0LnByb3RvdHlwZSYmKFlyPVhyKTpjbz0hMCk7dmFyIGZvPW51bGw9PVlyfHxzZSgoZnVuY3Rpb24oKXt2YXIgZT17fTtyZXR1cm4gWXJbdW9dLmNhbGwoZSkhPT1lfSkpO2ZvJiYoWXI9e30pLFEoWXJbdW9dKXx8Z3QoWXIsdW8sKGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9KSk7dmFyIHBvPXtJdGVyYXRvclByb3RvdHlwZTpZcixCVUdHWV9TQUZBUklfSVRFUkFUT1JTOmNvfSxobz1WZS5mLGdvPWhlKCJ0b1N0cmluZ1RhZyIpLHZvPWZ1bmN0aW9uKGUsdCxuKXtlJiYhcShlPW4/ZTplLnByb3RvdHlwZSxnbykmJmhvKGUsZ28se2NvbmZpZ3VyYWJsZTohMCx2YWx1ZTp0fSk7fSx5bz1wby5JdGVyYXRvclByb3RvdHlwZSxtbz1mdW5jdGlvbigpe3JldHVybiB0aGlzfSxibz1QLlN0cmluZyx3bz1QLlR5cGVFcnJvcix4bz1PYmplY3Quc2V0UHJvdG90eXBlT2Z8fCgiX19wcm90b19fImlue30/ZnVuY3Rpb24oKXt2YXIgZSx0PSExLG49e307dHJ5eyhlPVcoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihPYmplY3QucHJvdG90eXBlLCJfX3Byb3RvX18iKS5zZXQpKShuLFtdKSx0PW4gaW5zdGFuY2VvZiBBcnJheTt9Y2F0Y2goZSl7fXJldHVybiBmdW5jdGlvbihuLHIpe3JldHVybiBPZShuKSxmdW5jdGlvbihlKXtpZigib2JqZWN0Ij09dHlwZW9mIGV8fFEoZSkpcmV0dXJuIGU7dGhyb3cgd28oIkNhbid0IHNldCAiK2JvKGUpKyIgYXMgYSBwcm90b3R5cGUiKX0ociksdD9lKG4scik6bi5fX3Byb3RvX189cixufX0oKTp2b2lkIDApLEVvPWh0LlBST1BFUixTbz1odC5DT05GSUdVUkFCTEUsa289cG8uSXRlcmF0b3JQcm90b3R5cGUsT289cG8uQlVHR1lfU0FGQVJJX0lURVJBVE9SUyxDbz1oZSgiaXRlcmF0b3IiKSxUbz0ia2V5cyIsTm89InZhbHVlcyIsTW89ImVudHJpZXMiLExvPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9LFBvPWZ1bmN0aW9uKGUsdCxuLHIsbyxpLGEpeyFmdW5jdGlvbihlLHQsbixyKXt2YXIgbz10KyIgSXRlcmF0b3IiO2UucHJvdG90eXBlPXlyKHlvLHtuZXh0OnplKCshcixuKX0pLHZvKGUsbywhMSksanJbb109bW87fShuLHQscik7dmFyIHMsbCx1LGM9ZnVuY3Rpb24oZSl7aWYoZT09PW8mJmcpcmV0dXJuIGc7aWYoIU9vJiZlIGluIHApcmV0dXJuIHBbZV07c3dpdGNoKGUpe2Nhc2UgVG86Y2FzZSBObzpjYXNlIE1vOnJldHVybiBmdW5jdGlvbigpe3JldHVybiBuZXcgbih0aGlzLGUpfX1yZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gbmV3IG4odGhpcyl9fSxmPXQrIiBJdGVyYXRvciIsZD0hMSxwPWUucHJvdG90eXBlLGg9cFtDb118fHBbIkBAaXRlcmF0b3IiXXx8byYmcFtvXSxnPSFPbyYmaHx8YyhvKSx2PSJBcnJheSI9PXQmJnAuZW50cmllc3x8aDtpZih2JiYocz1sbyh2LmNhbGwobmV3IGUpKSkhPT1PYmplY3QucHJvdG90eXBlJiZzLm5leHQmJihsbyhzKSE9PWtvJiYoeG8/eG8ocyxrbyk6UShzW0NvXSl8fGd0KHMsQ28sTG8pKSx2byhzLGYsITApKSxFbyYmbz09Tm8mJmgmJmgubmFtZSE9PU5vJiYoU28/VWUocCwibmFtZSIsTm8pOihkPSEwLGc9ZnVuY3Rpb24oKXtyZXR1cm4gVGUoaCx0aGlzKX0pKSxvKWlmKGw9e3ZhbHVlczpjKE5vKSxrZXlzOmk/ZzpjKFRvKSxlbnRyaWVzOmMoTW8pfSxhKWZvcih1IGluIGwpKE9vfHxkfHwhKHUgaW4gcCkpJiZndChwLHUsbFt1XSk7ZWxzZSBfbih7dGFyZ2V0OnQscHJvdG86ITAsZm9yY2VkOk9vfHxkfSxsKTtyZXR1cm4gcFtDb10hPT1nJiZndChwLENvLGcse25hbWU6b30pLGpyW3RdPWcsbH0sUm89cm8uY2hhckF0LERvPSJTdHJpbmcgSXRlcmF0b3IiLGpvPWN0LnNldCxBbz1jdC5nZXR0ZXJGb3IoRG8pO1BvKFN0cmluZywiU3RyaW5nIiwoZnVuY3Rpb24oZSl7am8odGhpcyx7dHlwZTpEbyxzdHJpbmc6ZXIoZSksaW5kZXg6MH0pO30pLChmdW5jdGlvbigpe3ZhciBlLHQ9QW8odGhpcyksbj10LnN0cmluZyxyPXQuaW5kZXg7cmV0dXJuIHI+PW4ubGVuZ3RoP3t2YWx1ZTp2b2lkIDAsZG9uZTohMH06KGU9Um8obixyKSx0LmluZGV4Kz1lLmxlbmd0aCx7dmFsdWU6ZSxkb25lOiExfSl9KSk7dmFyIF9vLEZvPWRuLmYsSW89VygiIi5lbmRzV2l0aCksQm89VygiIi5zbGljZSksJG89TWF0aC5taW4sV289VHIoImVuZHNXaXRoIiksSG89IShXb3x8KF9vPUZvKFN0cmluZy5wcm90b3R5cGUsImVuZHNXaXRoIiksIV9vfHxfby53cml0YWJsZSkpO19uKHt0YXJnZXQ6IlN0cmluZyIscHJvdG86ITAsZm9yY2VkOiFIbyYmIVdvfSx7ZW5kc1dpdGg6ZnVuY3Rpb24oZSl7dmFyIHQ9ZXIoVih0aGlzKSk7T3IoZSk7dmFyIG49YXJndW1lbnRzLmxlbmd0aD4xP2FyZ3VtZW50c1sxXTp2b2lkIDAscj10Lmxlbmd0aCxvPXZvaWQgMD09PW4/cjokbyhGdChuKSxyKSxpPWVyKGUpO3JldHVybiBJbz9Jbyh0LGksbyk6Qm8odCxvLWkubGVuZ3RoLG8pPT09aX19KTt2YXIgVm89VyhbXS5qb2luKSx6bz1SdCE9T2JqZWN0LFVvPWVuKCJqb2luIiwiLCIpO19uKHt0YXJnZXQ6IkFycmF5Iixwcm90bzohMCxmb3JjZWQ6em98fCFVb30se2pvaW46ZnVuY3Rpb24oZSl7cmV0dXJuIFZvKGNuKHRoaXMpLHZvaWQgMD09PWU/IiwiOmUpfX0pO3ZhciBLbz1oZSgic3BlY2llcyIpLHFvPWZ1bmN0aW9uKGUpe3JldHVybiBhZT49NTF8fCFzZSgoZnVuY3Rpb24oKXt2YXIgdD1bXTtyZXR1cm4gKHQuY29uc3RydWN0b3I9e30pW0tvXT1mdW5jdGlvbigpe3JldHVybiB7Zm9vOjF9fSwxIT09dFtlXShCb29sZWFuKS5mb299KSl9LEdvPVp0Lm1hcCxKbz1xbygibWFwIik7X24oe3RhcmdldDoiQXJyYXkiLHByb3RvOiEwLGZvcmNlZDohSm99LHttYXA6ZnVuY3Rpb24oZSl7cmV0dXJuIEdvKHRoaXMsZSxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCl9fSk7dmFyIFlvPVAuUmVnRXhwLFhvPXNlKChmdW5jdGlvbigpe3ZhciBlPVlvKCJhIiwieSIpO3JldHVybiBlLmxhc3RJbmRleD0yLG51bGwhPWUuZXhlYygiYWJjZCIpfSkpLFFvPVhvfHxzZSgoZnVuY3Rpb24oKXtyZXR1cm4gIVlvKCJhIiwieSIpLnN0aWNreX0pKSxabz17QlJPS0VOX0NBUkVUOlhvfHxzZSgoZnVuY3Rpb24oKXt2YXIgZT1ZbygiXnIiLCJneSIpO3JldHVybiBlLmxhc3RJbmRleD0yLG51bGwhPWUuZXhlYygic3RyIil9KSksTUlTU0VEX1NUSUNLWTpRbyxVTlNVUFBPUlRFRF9ZOlhvfSxlaT1QLlJlZ0V4cCx0aT1zZSgoZnVuY3Rpb24oKXt2YXIgZT1laSgiLiIsInMiKTtyZXR1cm4gIShlLmRvdEFsbCYmZS5leGVjKCJcbiIpJiYicyI9PT1lLmZsYWdzKX0pKSxuaT1QLlJlZ0V4cCxyaT1zZSgoZnVuY3Rpb24oKXt2YXIgZT1uaSgiKD88YT5iKSIsImciKTtyZXR1cm4gImIiIT09ZS5leGVjKCJiIikuZ3JvdXBzLmF8fCJiYyIhPT0iYiIucmVwbGFjZShlLCIkPGE+YyIpfSkpLG9pPWN0LmdldCxpaT1fKCJuYXRpdmUtc3RyaW5nLXJlcGxhY2UiLFN0cmluZy5wcm90b3R5cGUucmVwbGFjZSksYWk9UmVnRXhwLnByb3RvdHlwZS5leGVjLHNpPWFpLGxpPVcoIiIuY2hhckF0KSx1aT1XKCIiLmluZGV4T2YpLGNpPVcoIiIucmVwbGFjZSksZmk9VygiIi5zbGljZSksZGk9ZnVuY3Rpb24oKXt2YXIgZT0vYS8sdD0vYiovZztyZXR1cm4gVGUoYWksZSwiYSIpLFRlKGFpLHQsImEiKSwwIT09ZS5sYXN0SW5kZXh8fDAhPT10Lmxhc3RJbmRleH0oKSxwaT1aby5CUk9LRU5fQ0FSRVQsaGk9dm9pZCAwIT09LygpPz8vLmV4ZWMoIiIpWzFdOyhkaXx8aGl8fHBpfHx0aXx8cmkpJiYoc2k9ZnVuY3Rpb24oZSl7dmFyIHQsbixyLG8saSxhLHMsbD10aGlzLHU9b2kobCksYz1lcihlKSxmPXUucmF3O2lmKGYpcmV0dXJuIGYubGFzdEluZGV4PWwubGFzdEluZGV4LHQ9VGUoc2ksZixjKSxsLmxhc3RJbmRleD1mLmxhc3RJbmRleCx0O3ZhciBkPXUuZ3JvdXBzLHA9cGkmJmwuc3RpY2t5LGg9VGUodHIsbCksZz1sLnNvdXJjZSx2PTAseT1jO2lmKHAmJihoPWNpKGgsInkiLCIiKSwtMT09PXVpKGgsImciKSYmKGgrPSJnIikseT1maShjLGwubGFzdEluZGV4KSxsLmxhc3RJbmRleD4wJiYoIWwubXVsdGlsaW5lfHxsLm11bHRpbGluZSYmIlxuIiE9PWxpKGMsbC5sYXN0SW5kZXgtMSkpJiYoZz0iKD86ICIrZysiKSIseT0iICIreSx2KyspLG49bmV3IFJlZ0V4cCgiXig/OiIrZysiKSIsaCkpLGhpJiYobj1uZXcgUmVnRXhwKCJeIitnKyIkKD8hXFxzKSIsaCkpLGRpJiYocj1sLmxhc3RJbmRleCksbz1UZShhaSxwP246bCx5KSxwP28/KG8uaW5wdXQ9Zmkoby5pbnB1dCx2KSxvWzBdPWZpKG9bMF0sdiksby5pbmRleD1sLmxhc3RJbmRleCxsLmxhc3RJbmRleCs9b1swXS5sZW5ndGgpOmwubGFzdEluZGV4PTA6ZGkmJm8mJihsLmxhc3RJbmRleD1sLmdsb2JhbD9vLmluZGV4K29bMF0ubGVuZ3RoOnIpLGhpJiZvJiZvLmxlbmd0aD4xJiZUZShpaSxvWzBdLG4sKGZ1bmN0aW9uKCl7Zm9yKGk9MTtpPGFyZ3VtZW50cy5sZW5ndGgtMjtpKyspdm9pZCAwPT09YXJndW1lbnRzW2ldJiYob1tpXT12b2lkIDApO30pKSxvJiZkKWZvcihvLmdyb3Vwcz1hPXlyKG51bGwpLGk9MDtpPGQubGVuZ3RoO2krKylhWyhzPWRbaV0pWzBdXT1vW3NbMV1dO3JldHVybiBvfSk7dmFyIGdpPXNpO19uKHt0YXJnZXQ6IlJlZ0V4cCIscHJvdG86ITAsZm9yY2VkOi8uLy5leGVjIT09Z2l9LHtleGVjOmdpfSk7dmFyIHZpPUZ1bmN0aW9uLnByb3RvdHlwZSx5aT12aS5hcHBseSxtaT12aS5iaW5kLGJpPXZpLmNhbGwsd2k9Im9iamVjdCI9PXR5cGVvZiBSZWZsZWN0JiZSZWZsZWN0LmFwcGx5fHwobWk/YmkuYmluZCh5aSk6ZnVuY3Rpb24oKXtyZXR1cm4gYmkuYXBwbHkoeWksYXJndW1lbnRzKX0pLHhpPWhlKCJzcGVjaWVzIiksRWk9UmVnRXhwLnByb3RvdHlwZSxTaT1mdW5jdGlvbihlLHQsbixyKXt2YXIgbz1oZShlKSxpPSFzZSgoZnVuY3Rpb24oKXt2YXIgdD17fTtyZXR1cm4gdFtvXT1mdW5jdGlvbigpe3JldHVybiA3fSw3IT0iIltlXSh0KX0pKSxhPWkmJiFzZSgoZnVuY3Rpb24oKXt2YXIgdD0hMSxuPS9hLztyZXR1cm4gInNwbGl0Ij09PWUmJigobj17fSkuY29uc3RydWN0b3I9e30sbi5jb25zdHJ1Y3Rvclt4aV09ZnVuY3Rpb24oKXtyZXR1cm4gbn0sbi5mbGFncz0iIixuW29dPS8uL1tvXSksbi5leGVjPWZ1bmN0aW9uKCl7cmV0dXJuIHQ9ITAsbnVsbH0sbltvXSgiIiksIXR9KSk7aWYoIWl8fCFhfHxuKXt2YXIgcz1XKC8uL1tvXSksbD10KG8sIiJbZV0sKGZ1bmN0aW9uKGUsdCxuLHIsbyl7dmFyIGE9VyhlKSxsPXQuZXhlYztyZXR1cm4gbD09PWdpfHxsPT09RWkuZXhlYz9pJiYhbz97ZG9uZTohMCx2YWx1ZTpzKHQsbixyKX06e2RvbmU6ITAsdmFsdWU6YShuLHQscil9Ontkb25lOiExfX0pKTtndChTdHJpbmcucHJvdG90eXBlLGUsbFswXSksZ3QoRWksbyxsWzFdKTt9ciYmVWUoRWlbb10sInNoYW0iLCEwKTt9LGtpPXJvLmNoYXJBdCxPaT1mdW5jdGlvbihlLHQsbil7cmV0dXJuIHQrKG4/a2koZSx0KS5sZW5ndGg6MSl9LENpPU1hdGguZmxvb3IsVGk9VygiIi5jaGFyQXQpLE5pPVcoIiIucmVwbGFjZSksTWk9VygiIi5zbGljZSksTGk9L1wkKFskJidgXXxcZHsxLDJ9fDxbXj5dKj4pL2csUGk9L1wkKFskJidgXXxcZHsxLDJ9KS9nLFJpPWZ1bmN0aW9uKGUsdCxuLHIsbyxpKXt2YXIgYT1uK2UubGVuZ3RoLHM9ci5sZW5ndGgsbD1QaTtyZXR1cm4gdm9pZCAwIT09byYmKG89VShvKSxsPUxpKSxOaShpLGwsKGZ1bmN0aW9uKGksbCl7dmFyIHU7c3dpdGNoKFRpKGwsMCkpe2Nhc2UiJCI6cmV0dXJuICIkIjtjYXNlIiYiOnJldHVybiBlO2Nhc2UiYCI6cmV0dXJuIE1pKHQsMCxuKTtjYXNlIiciOnJldHVybiBNaSh0LGEpO2Nhc2UiPCI6dT1vW01pKGwsMSwtMSldO2JyZWFrO2RlZmF1bHQ6dmFyIGM9K2w7aWYoMD09PWMpcmV0dXJuIGk7aWYoYz5zKXt2YXIgZj1DaShjLzEwKTtyZXR1cm4gMD09PWY/aTpmPD1zP3ZvaWQgMD09PXJbZi0xXT9UaShsLDEpOnJbZi0xXStUaShsLDEpOml9dT1yW2MtMV07fXJldHVybiB2b2lkIDA9PT11PyIiOnV9KSl9LERpPVAuVHlwZUVycm9yLGppPWZ1bmN0aW9uKGUsdCl7dmFyIG49ZS5leGVjO2lmKFEobikpe3ZhciByPVRlKG4sZSx0KTtyZXR1cm4gbnVsbCE9PXImJk9lKHIpLHJ9aWYoIlJlZ0V4cCI9PT1tdChlKSlyZXR1cm4gVGUoZ2ksZSx0KTt0aHJvdyBEaSgiUmVnRXhwI2V4ZWMgY2FsbGVkIG9uIGluY29tcGF0aWJsZSByZWNlaXZlciIpfSxBaT1oZSgicmVwbGFjZSIpLF9pPU1hdGgubWF4LEZpPU1hdGgubWluLElpPVcoW10uY29uY2F0KSxCaT1XKFtdLnB1c2gpLCRpPVcoIiIuaW5kZXhPZiksV2k9VygiIi5zbGljZSksSGk9IiQwIj09PSJhIi5yZXBsYWNlKC8uLywiJDAiKSxWaT0hIS8uL1tBaV0mJiIiPT09Ly4vW0FpXSgiYSIsIiQwIik7U2koInJlcGxhY2UiLChmdW5jdGlvbihlLHQsbil7dmFyIHI9Vmk/IiQiOiIkMCI7cmV0dXJuIFtmdW5jdGlvbihlLG4pe3ZhciByPVYodGhpcyksbz1udWxsPT1lP3ZvaWQgMDpBZShlLEFpKTtyZXR1cm4gbz9UZShvLGUscixuKTpUZSh0LGVyKHIpLGUsbil9LGZ1bmN0aW9uKGUsbyl7dmFyIGk9T2UodGhpcyksYT1lcihlKTtpZigic3RyaW5nIj09dHlwZW9mIG8mJi0xPT09JGkobyxyKSYmLTE9PT0kaShvLCIkPCIpKXt2YXIgcz1uKHQsaSxhLG8pO2lmKHMuZG9uZSlyZXR1cm4gcy52YWx1ZX12YXIgbD1RKG8pO2x8fChvPWVyKG8pKTt2YXIgdT1pLmdsb2JhbDtpZih1KXt2YXIgYz1pLnVuaWNvZGU7aS5sYXN0SW5kZXg9MDt9Zm9yKHZhciBmPVtdOzspe3ZhciBkPWppKGksYSk7aWYobnVsbD09PWQpYnJlYWs7aWYoQmkoZixkKSwhdSlicmVhazsiIj09PWVyKGRbMF0pJiYoaS5sYXN0SW5kZXg9T2koYSxGdChpLmxhc3RJbmRleCksYykpO31mb3IodmFyIHAsaD0iIixnPTAsdj0wO3Y8Zi5sZW5ndGg7disrKXtmb3IodmFyIHk9ZXIoKGQ9Zlt2XSlbMF0pLG09X2koRmkoQXQoZC5pbmRleCksYS5sZW5ndGgpLDApLGI9W10sdz0xO3c8ZC5sZW5ndGg7dysrKUJpKGIsdm9pZCAwPT09KHA9ZFt3XSk/cDpTdHJpbmcocCkpO3ZhciB4PWQuZ3JvdXBzO2lmKGwpe3ZhciBFPUlpKFt5XSxiLG0sYSk7dm9pZCAwIT09eCYmQmkoRSx4KTt2YXIgUz1lcih3aShvLHZvaWQgMCxFKSk7fWVsc2UgUz1SaSh5LGEsbSxiLHgsbyk7bT49ZyYmKGgrPVdpKGEsZyxtKStTLGc9bSt5Lmxlbmd0aCk7fXJldHVybiBoK1dpKGEsZyl9XX0pLCEhc2UoKGZ1bmN0aW9uKCl7dmFyIGU9Ly4vO3JldHVybiBlLmV4ZWM9ZnVuY3Rpb24oKXt2YXIgZT1bXTtyZXR1cm4gZS5ncm91cHM9e2E6IjcifSxlfSwiNyIhPT0iIi5yZXBsYWNlKGUsIiQ8YT4iKX0pKXx8IUhpfHxWaSk7CiAgLyohICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgCUNvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLgoKICAJUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55CiAgCXB1cnBvc2Ugd2l0aCBvciB3aXRob3V0IGZlZSBpcyBoZXJlYnkgZ3JhbnRlZC4KCiAgCVRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiIEFORCBUSEUgQVVUSE9SIERJU0NMQUlNUyBBTEwgV0FSUkFOVElFUyBXSVRICiAgCVJFR0FSRCBUTyBUSElTIFNPRlRXQVJFIElOQ0xVRElORyBBTEwgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWQogIAlBTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsCiAgCUlORElSRUNULCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgT1IgQU5ZIERBTUFHRVMgV0hBVFNPRVZFUiBSRVNVTFRJTkcgRlJPTQogIAlMT1NTIE9GIFVTRSwgREFUQSBPUiBQUk9GSVRTLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgTkVHTElHRU5DRSBPUgogIAlPVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SCiAgCVBFUkZPUk1BTkNFIE9GIFRISVMgU09GVFdBUkUuCiAgCSoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovCiAgdmFyIHppPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHppPU9iamVjdC5zZXRQcm90b3R5cGVPZnx8e19fcHJvdG9fXzpbXX1pbnN0YW5jZW9mIEFycmF5JiZmdW5jdGlvbihlLHQpe2UuX19wcm90b19fPXQ7fXx8ZnVuY3Rpb24oZSx0KXtmb3IodmFyIG4gaW4gdClPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodCxuKSYmKGVbbl09dFtuXSk7fSx6aShlLHQpfTtmdW5jdGlvbiBVaShlLHQpe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiB0JiZudWxsIT09dCl0aHJvdyBuZXcgVHlwZUVycm9yKCJDbGFzcyBleHRlbmRzIHZhbHVlICIrU3RyaW5nKHQpKyIgaXMgbm90IGEgY29uc3RydWN0b3Igb3IgbnVsbCIpO2Z1bmN0aW9uIG4oKXt0aGlzLmNvbnN0cnVjdG9yPWU7fXppKGUsdCksZS5wcm90b3R5cGU9bnVsbD09PXQ/T2JqZWN0LmNyZWF0ZSh0KToobi5wcm90b3R5cGU9dC5wcm90b3R5cGUsbmV3IG4pO312YXIgS2k9ZnVuY3Rpb24oKXtyZXR1cm4gS2k9T2JqZWN0LmFzc2lnbnx8ZnVuY3Rpb24oZSl7Zm9yKHZhciB0LG49MSxyPWFyZ3VtZW50cy5sZW5ndGg7bjxyO24rKylmb3IodmFyIG8gaW4gdD1hcmd1bWVudHNbbl0pT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHQsbykmJihlW29dPXRbb10pO3JldHVybiBlfSxLaS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9O2Z1bmN0aW9uIHFpKGUpe3ZhciB0PSJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2wmJlN5bWJvbC5pdGVyYXRvcixuPXQmJmVbdF0scj0wO2lmKG4pcmV0dXJuIG4uY2FsbChlKTtpZihlJiYibnVtYmVyIj09dHlwZW9mIGUubGVuZ3RoKXJldHVybiB7bmV4dDpmdW5jdGlvbigpe3JldHVybiBlJiZyPj1lLmxlbmd0aCYmKGU9dm9pZCAwKSx7dmFsdWU6ZSYmZVtyKytdLGRvbmU6IWV9fX07dGhyb3cgbmV3IFR5cGVFcnJvcih0PyJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLiI6IlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKX1mdW5jdGlvbiBHaShlLHQpe3ZhciBuPSJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2wmJmVbU3ltYm9sLml0ZXJhdG9yXTtpZighbilyZXR1cm4gZTt2YXIgcixvLGk9bi5jYWxsKGUpLGE9W107dHJ5e2Zvcig7KHZvaWQgMD09PXR8fHQtLSA+MCkmJiEocj1pLm5leHQoKSkuZG9uZTspYS5wdXNoKHIudmFsdWUpO31jYXRjaChlKXtvPXtlcnJvcjplfTt9ZmluYWxseXt0cnl7ciYmIXIuZG9uZSYmKG49aS5yZXR1cm4pJiZuLmNhbGwoaSk7fWZpbmFsbHl7aWYobyl0aHJvdyBvLmVycm9yfX1yZXR1cm4gYX1mdW5jdGlvbiBKaShlLHQpe2Zvcih2YXIgbj0wLHI9dC5sZW5ndGgsbz1lLmxlbmd0aDtuPHI7bisrLG8rKyllW29dPXRbbl07cmV0dXJuIGV9dmFyIFlpPTAsWGk9ZnVuY3Rpb24oKXt0aGlzLmlkPSIiK1lpKys7fSxRaT0iQXJyYXkgSXRlcmF0b3IiLFppPWN0LnNldCxlYT1jdC5nZXR0ZXJGb3IoUWkpLHRhPVBvKEFycmF5LCJBcnJheSIsKGZ1bmN0aW9uKGUsdCl7WmkodGhpcyx7dHlwZTpRaSx0YXJnZXQ6Y24oZSksaW5kZXg6MCxraW5kOnR9KTt9KSwoZnVuY3Rpb24oKXt2YXIgZT1lYSh0aGlzKSx0PWUudGFyZ2V0LG49ZS5raW5kLHI9ZS5pbmRleCsrO3JldHVybiAhdHx8cj49dC5sZW5ndGg/KGUudGFyZ2V0PXZvaWQgMCx7dmFsdWU6dm9pZCAwLGRvbmU6ITB9KToia2V5cyI9PW4/e3ZhbHVlOnIsZG9uZTohMX06InZhbHVlcyI9PW4/e3ZhbHVlOnRbcl0sZG9uZTohMX06e3ZhbHVlOltyLHRbcl1dLGRvbmU6ITF9fSksInZhbHVlcyIpO2pyLkFyZ3VtZW50cz1qci5BcnJheSx3cigia2V5cyIpLHdyKCJ2YWx1ZXMiKSx3cigiZW50cmllcyIpO3ZhciBuYT1mdW5jdGlvbihlLHQsbil7Zm9yKHZhciByIGluIHQpZ3QoZSxyLHRbcl0sbik7cmV0dXJuIGV9LHJhPVAuQXJyYXksb2E9TWF0aC5tYXgsaWE9ZnVuY3Rpb24oZSx0LG4pe2Zvcih2YXIgcj1JdChlKSxvPWduKHQsciksaT1nbih2b2lkIDA9PT1uP3I6bixyKSxhPXJhKG9hKGktbywwKSkscz0wO288aTtvKysscysrKUlyKGEscyxlW29dKTtyZXR1cm4gYS5sZW5ndGg9cyxhfSxhYT1Tbi5mLHNhPSJvYmplY3QiPT10eXBlb2Ygd2luZG93JiZ3aW5kb3cmJk9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzP09iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHdpbmRvdyk6W10sbGE9e2Y6ZnVuY3Rpb24oZSl7cmV0dXJuIHNhJiYiV2luZG93Ij09bXQoZSk/ZnVuY3Rpb24oZSl7dHJ5e3JldHVybiBhYShlKX1jYXRjaChlKXtyZXR1cm4gaWEoc2EpfX0oZSk6YWEoY24oZSkpfX0sdWE9c2UoKGZ1bmN0aW9uKCl7aWYoImZ1bmN0aW9uIj09dHlwZW9mIEFycmF5QnVmZmVyKXt2YXIgZT1uZXcgQXJyYXlCdWZmZXIoOCk7T2JqZWN0LmlzRXh0ZW5zaWJsZShlKSYmT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsImEiLHt2YWx1ZTo4fSk7fX0pKSxjYT1PYmplY3QuaXNFeHRlbnNpYmxlLGZhPXNlKChmdW5jdGlvbigpe2NhKDEpO30pKXx8dWE/ZnVuY3Rpb24oZSl7cmV0dXJuICEhbWUoZSkmJigoIXVhfHwiQXJyYXlCdWZmZXIiIT1tdChlKSkmJighY2F8fGNhKGUpKSl9OmNhLGRhPSFzZSgoZnVuY3Rpb24oKXtyZXR1cm4gT2JqZWN0LmlzRXh0ZW5zaWJsZShPYmplY3QucHJldmVudEV4dGVuc2lvbnMoe30pKX0pKSxwYT1UKChmdW5jdGlvbihlKXt2YXIgdD1WZS5mLG49ITEscj1YKCJtZXRhIiksbz0wLGk9ZnVuY3Rpb24oZSl7dChlLHIse3ZhbHVlOntvYmplY3RJRDoiTyIrbysrLHdlYWtEYXRhOnt9fX0pO30sYT1lLmV4cG9ydHM9e2VuYWJsZTpmdW5jdGlvbigpe2EuZW5hYmxlPWZ1bmN0aW9uKCl7fSxuPSEwO3ZhciBlPVNuLmYsdD1XKFtdLnNwbGljZSksbz17fTtvW3JdPTEsZShvKS5sZW5ndGgmJihTbi5mPWZ1bmN0aW9uKG4pe2Zvcih2YXIgbz1lKG4pLGk9MCxhPW8ubGVuZ3RoO2k8YTtpKyspaWYob1tpXT09PXIpe3QobyxpLDEpO2JyZWFrfXJldHVybiBvfSxfbih7dGFyZ2V0OiJPYmplY3QiLHN0YXQ6ITAsZm9yY2VkOiEwfSx7Z2V0T3duUHJvcGVydHlOYW1lczpsYS5mfSkpO30sZmFzdEtleTpmdW5jdGlvbihlLHQpe2lmKCFtZShlKSlyZXR1cm4gInN5bWJvbCI9PXR5cGVvZiBlP2U6KCJzdHJpbmciPT10eXBlb2YgZT8iUyI6IlAiKStlO2lmKCFxKGUscikpe2lmKCFmYShlKSlyZXR1cm4gIkYiO2lmKCF0KXJldHVybiAiRSI7aShlKTt9cmV0dXJuIGVbcl0ub2JqZWN0SUR9LGdldFdlYWtEYXRhOmZ1bmN0aW9uKGUsdCl7aWYoIXEoZSxyKSl7aWYoIWZhKGUpKXJldHVybiAhMDtpZighdClyZXR1cm4gITE7aShlKTt9cmV0dXJuIGVbcl0ud2Vha0RhdGF9LG9uRnJlZXplOmZ1bmN0aW9uKGUpe3JldHVybiBkYSYmbiYmZmEoZSkmJiFxKGUscikmJmkoZSksZX19O3R0W3JdPSEwO30pKSxoYT1QLlR5cGVFcnJvcixnYT1mdW5jdGlvbihlLHQpe3RoaXMuc3RvcHBlZD1lLHRoaXMucmVzdWx0PXQ7fSx2YT1nYS5wcm90b3R5cGUseWE9ZnVuY3Rpb24oZSx0LG4pe3ZhciByLG8saSxhLHMsbCx1LGM9biYmbi50aGF0LGY9ISghbnx8IW4uQVNfRU5UUklFUyksZD0hKCFufHwhbi5JU19JVEVSQVRPUikscD0hKCFufHwhbi5JTlRFUlJVUFRFRCksaD1NdCh0LGMpLGc9ZnVuY3Rpb24oZSl7cmV0dXJuIHImJlJyKHIsIm5vcm1hbCIsZSksbmV3IGdhKCEwLGUpfSx2PWZ1bmN0aW9uKGUpe3JldHVybiBmPyhPZShlKSxwP2goZVswXSxlWzFdLGcpOmgoZVswXSxlWzFdKSk6cD9oKGUsZyk6aChlKX07aWYoZClyPWU7ZWxzZSB7aWYoIShvPSRyKGUpKSl0aHJvdyBoYShSZShlKSsiIGlzIG5vdCBpdGVyYWJsZSIpO2lmKEZyKG8pKXtmb3IoaT0wLGE9SXQoZSk7YT5pO2krKylpZigocz12KGVbaV0pKSYmTmUodmEscykpcmV0dXJuIHM7cmV0dXJuIG5ldyBnYSghMSl9cj1IcihlLG8pO31mb3IobD1yLm5leHQ7ISh1PVRlKGwscikpLmRvbmU7KXt0cnl7cz12KHUudmFsdWUpO31jYXRjaChlKXtScihyLCJ0aHJvdyIsZSk7fWlmKCJvYmplY3QiPT10eXBlb2YgcyYmcyYmTmUodmEscykpcmV0dXJuIHN9cmV0dXJuIG5ldyBnYSghMSl9LG1hPVAuVHlwZUVycm9yLGJhPWZ1bmN0aW9uKGUsdCl7aWYoTmUodCxlKSlyZXR1cm4gZTt0aHJvdyBtYSgiSW5jb3JyZWN0IGludm9jYXRpb24iKX0sd2E9ZnVuY3Rpb24oZSx0LG4pe3ZhciByLG87cmV0dXJuIHhvJiZRKHI9dC5jb25zdHJ1Y3RvcikmJnIhPT1uJiZtZShvPXIucHJvdG90eXBlKSYmbyE9PW4ucHJvdG90eXBlJiZ4byhlLG8pLGV9LHhhPWZ1bmN0aW9uKGUsdCxuKXt2YXIgcj0tMSE9PWUuaW5kZXhPZigiTWFwIiksbz0tMSE9PWUuaW5kZXhPZigiV2VhayIpLGk9cj8ic2V0IjoiYWRkIixhPVBbZV0scz1hJiZhLnByb3RvdHlwZSxsPWEsdT17fSxjPWZ1bmN0aW9uKGUpe3ZhciB0PVcoc1tlXSk7Z3QocyxlLCJhZGQiPT1lP2Z1bmN0aW9uKGUpe3JldHVybiB0KHRoaXMsMD09PWU/MDplKSx0aGlzfToiZGVsZXRlIj09ZT9mdW5jdGlvbihlKXtyZXR1cm4gIShvJiYhbWUoZSkpJiZ0KHRoaXMsMD09PWU/MDplKX06ImdldCI9PWU/ZnVuY3Rpb24oZSl7cmV0dXJuIG8mJiFtZShlKT92b2lkIDA6dCh0aGlzLDA9PT1lPzA6ZSl9OiJoYXMiPT1lP2Z1bmN0aW9uKGUpe3JldHVybiAhKG8mJiFtZShlKSkmJnQodGhpcywwPT09ZT8wOmUpfTpmdW5jdGlvbihlLG4pe3JldHVybiB0KHRoaXMsMD09PWU/MDplLG4pLHRoaXN9KTt9O2lmKGpuKGUsIVEoYSl8fCEob3x8cy5mb3JFYWNoJiYhc2UoKGZ1bmN0aW9uKCl7KG5ldyBhKS5lbnRyaWVzKCkubmV4dCgpO30pKSkpKWw9bi5nZXRDb25zdHJ1Y3Rvcih0LGUscixpKSxwYS5lbmFibGUoKTtlbHNlIGlmKGpuKGUsITApKXt2YXIgZj1uZXcgbCxkPWZbaV0obz97fTotMCwxKSE9ZixwPXNlKChmdW5jdGlvbigpe2YuaGFzKDEpO30pKSxoPUdyKChmdW5jdGlvbihlKXtuZXcgYShlKTt9KSksZz0hbyYmc2UoKGZ1bmN0aW9uKCl7Zm9yKHZhciBlPW5ldyBhLHQ9NTt0LS07KWVbaV0odCx0KTtyZXR1cm4gIWUuaGFzKC0wKX0pKTtofHwoKGw9dCgoZnVuY3Rpb24oZSx0KXtiYShlLHMpO3ZhciBuPXdhKG5ldyBhLGUsbCk7cmV0dXJuIG51bGwhPXQmJnlhKHQsbltpXSx7dGhhdDpuLEFTX0VOVFJJRVM6cn0pLG59KSkpLnByb3RvdHlwZT1zLHMuY29uc3RydWN0b3I9bCksKHB8fGcpJiYoYygiZGVsZXRlIiksYygiaGFzIiksciYmYygiZ2V0IikpLChnfHxkKSYmYyhpKSxvJiZzLmNsZWFyJiZkZWxldGUgcy5jbGVhcjt9cmV0dXJuIHVbZV09bCxfbih7Z2xvYmFsOiEwLGZvcmNlZDpsIT1hfSx1KSx2byhsLGUpLG98fG4uc2V0U3Ryb25nKGwsZSxyKSxsfSxFYT1wYS5nZXRXZWFrRGF0YSxTYT1jdC5zZXQsa2E9Y3QuZ2V0dGVyRm9yLE9hPVp0LmZpbmQsQ2E9WnQuZmluZEluZGV4LFRhPVcoW10uc3BsaWNlKSxOYT0wLE1hPWZ1bmN0aW9uKGUpe3JldHVybiBlLmZyb3plbnx8KGUuZnJvemVuPW5ldyBMYSl9LExhPWZ1bmN0aW9uKCl7dGhpcy5lbnRyaWVzPVtdO30sUGE9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gT2EoZS5lbnRyaWVzLChmdW5jdGlvbihlKXtyZXR1cm4gZVswXT09PXR9KSl9O0xhLnByb3RvdHlwZT17Z2V0OmZ1bmN0aW9uKGUpe3ZhciB0PVBhKHRoaXMsZSk7aWYodClyZXR1cm4gdFsxXX0saGFzOmZ1bmN0aW9uKGUpe3JldHVybiAhIVBhKHRoaXMsZSl9LHNldDpmdW5jdGlvbihlLHQpe3ZhciBuPVBhKHRoaXMsZSk7bj9uWzFdPXQ6dGhpcy5lbnRyaWVzLnB1c2goW2UsdF0pO30sZGVsZXRlOmZ1bmN0aW9uKGUpe3ZhciB0PUNhKHRoaXMuZW50cmllcywoZnVuY3Rpb24odCl7cmV0dXJuIHRbMF09PT1lfSkpO3JldHVybiB+dCYmVGEodGhpcy5lbnRyaWVzLHQsMSksISF+dH19O3ZhciBSYSxEYT17Z2V0Q29uc3RydWN0b3I6ZnVuY3Rpb24oZSx0LG4scil7dmFyIG89ZSgoZnVuY3Rpb24oZSxvKXtiYShlLGkpLFNhKGUse3R5cGU6dCxpZDpOYSsrLGZyb3plbjp2b2lkIDB9KSxudWxsIT1vJiZ5YShvLGVbcl0se3RoYXQ6ZSxBU19FTlRSSUVTOm59KTt9KSksaT1vLnByb3RvdHlwZSxhPWthKHQpLHM9ZnVuY3Rpb24oZSx0LG4pe3ZhciByPWEoZSksbz1FYShPZSh0KSwhMCk7cmV0dXJuICEwPT09bz9NYShyKS5zZXQodCxuKTpvW3IuaWRdPW4sZX07cmV0dXJuIG5hKGkse2RlbGV0ZTpmdW5jdGlvbihlKXt2YXIgdD1hKHRoaXMpO2lmKCFtZShlKSlyZXR1cm4gITE7dmFyIG49RWEoZSk7cmV0dXJuICEwPT09bj9NYSh0KS5kZWxldGUoZSk6biYmcShuLHQuaWQpJiZkZWxldGUgblt0LmlkXX0saGFzOmZ1bmN0aW9uKGUpe3ZhciB0PWEodGhpcyk7aWYoIW1lKGUpKXJldHVybiAhMTt2YXIgbj1FYShlKTtyZXR1cm4gITA9PT1uP01hKHQpLmhhcyhlKTpuJiZxKG4sdC5pZCl9fSksbmEoaSxuP3tnZXQ6ZnVuY3Rpb24oZSl7dmFyIHQ9YSh0aGlzKTtpZihtZShlKSl7dmFyIG49RWEoZSk7cmV0dXJuICEwPT09bj9NYSh0KS5nZXQoZSk6bj9uW3QuaWRdOnZvaWQgMH19LHNldDpmdW5jdGlvbihlLHQpe3JldHVybiBzKHRoaXMsZSx0KX19OnthZGQ6ZnVuY3Rpb24oZSl7cmV0dXJuIHModGhpcyxlLCEwKX19KSxvfX0samE9Y3QuZW5mb3JjZSxBYT0hUC5BY3RpdmVYT2JqZWN0JiYiQWN0aXZlWE9iamVjdCJpbiBQLF9hPWZ1bmN0aW9uKGUpe3JldHVybiBmdW5jdGlvbigpe3JldHVybiBlKHRoaXMsYXJndW1lbnRzLmxlbmd0aD9hcmd1bWVudHNbMF06dm9pZCAwKX19LEZhPXhhKCJXZWFrTWFwIixfYSxEYSk7aWYoUWUmJkFhKXtSYT1EYS5nZXRDb25zdHJ1Y3RvcihfYSwiV2Vha01hcCIsITApLHBhLmVuYWJsZSgpO3ZhciBJYT1GYS5wcm90b3R5cGUsQmE9VyhJYS5kZWxldGUpLCRhPVcoSWEuaGFzKSxXYT1XKElhLmdldCksSGE9VyhJYS5zZXQpO25hKElhLHtkZWxldGU6ZnVuY3Rpb24oZSl7aWYobWUoZSkmJiFmYShlKSl7dmFyIHQ9amEodGhpcyk7cmV0dXJuIHQuZnJvemVufHwodC5mcm96ZW49bmV3IFJhKSxCYSh0aGlzLGUpfHx0LmZyb3plbi5kZWxldGUoZSl9cmV0dXJuIEJhKHRoaXMsZSl9LGhhczpmdW5jdGlvbihlKXtpZihtZShlKSYmIWZhKGUpKXt2YXIgdD1qYSh0aGlzKTtyZXR1cm4gdC5mcm96ZW58fCh0LmZyb3plbj1uZXcgUmEpLCRhKHRoaXMsZSl8fHQuZnJvemVuLmhhcyhlKX1yZXR1cm4gJGEodGhpcyxlKX0sZ2V0OmZ1bmN0aW9uKGUpe2lmKG1lKGUpJiYhZmEoZSkpe3ZhciB0PWphKHRoaXMpO3JldHVybiB0LmZyb3plbnx8KHQuZnJvemVuPW5ldyBSYSksJGEodGhpcyxlKT9XYSh0aGlzLGUpOnQuZnJvemVuLmdldChlKX1yZXR1cm4gV2EodGhpcyxlKX0sc2V0OmZ1bmN0aW9uKGUsdCl7aWYobWUoZSkmJiFmYShlKSl7dmFyIG49amEodGhpcyk7bi5mcm96ZW58fChuLmZyb3plbj1uZXcgUmEpLCRhKHRoaXMsZSk/SGEodGhpcyxlLHQpOm4uZnJvemVuLnNldChlLHQpO31lbHNlIEhhKHRoaXMsZSx0KTtyZXR1cm4gdGhpc319KTt9dmFyIFZhPWhlKCJpdGVyYXRvciIpLHphPWhlKCJ0b1N0cmluZ1RhZyIpLFVhPXRhLnZhbHVlcyxLYT1mdW5jdGlvbihlLHQpe2lmKGUpe2lmKGVbVmFdIT09VWEpdHJ5e1VlKGUsVmEsVWEpO31jYXRjaCh0KXtlW1ZhXT1VYTt9aWYoZVt6YV18fFVlKGUsemEsdCksa3RbdF0pZm9yKHZhciBuIGluIHRhKWlmKGVbbl0hPT10YVtuXSl0cnl7VWUoZSxuLHRhW25dKTt9Y2F0Y2godCl7ZVtuXT10YVtuXTt9fX07Zm9yKHZhciBxYSBpbiBrdClLYShQW3FhXSYmUFtxYV0ucHJvdG90eXBlLHFhKTtLYShUdCwiRE9NVG9rZW5MaXN0Iik7dmFyIEdhPW5ldyBXZWFrTWFwLEphPW5ldyBXZWFrTWFwLFlhPW5ldyBXZWFrTWFwLFhhPW5ldyBXZWFrTWFwLFFhPW5ldyBXZWFrTWFwLFphPW5ldyBXZWFrTWFwLGVzPW5ldyBXZWFrTWFwLHRzPW5ldyBXZWFrTWFwLG5zPW5ldyBXZWFrTWFwLHJzPW5ldyBXZWFrTWFwLG9zPW5ldyBXZWFrTWFwLGlzPW5ldyBXZWFrTWFwLGFzPW5ldyBXZWFrTWFwLHNzPW5ldyBXZWFrTWFwLGxzPW5ldyBXZWFrTWFwLHVzPW5ldyBXZWFrTWFwLGNzPW5ldyBXZWFrTWFwLGZzPW5ldyBXZWFrTWFwLGRzPW5ldyBXZWFrTWFwLHBzPW5ldyBXZWFrTWFwLGhzPW5ldyBXZWFrTWFwLGdzPW5ldyBXZWFrTWFwLHZzPW5ldyBXZWFrTWFwLHlzPW5ldyBXZWFrTWFwLG1zPW5ldyBXZWFrTWFwLGJzPVp0LmZpbmQsd3M9ImZpbmQiLHhzPSEwO3dzIGluW10mJkFycmF5KDEpLmZpbmQoKGZ1bmN0aW9uKCl7eHM9ITE7fSkpLF9uKHt0YXJnZXQ6IkFycmF5Iixwcm90bzohMCxmb3JjZWQ6eHN9LHtmaW5kOmZ1bmN0aW9uKGUpe3JldHVybiBicyh0aGlzLGUsYXJndW1lbnRzLmxlbmd0aD4xP2FyZ3VtZW50c1sxXTp2b2lkIDApfX0pLHdyKHdzKSxfbih7Z2xvYmFsOiEwfSx7Z2xvYmFsVGhpczpQfSk7Y29uc3QgRXM9WyJhcmVhIiwiYmFzZSIsImJhc2Vmb250IiwiYmdzb3VuZCIsImJyIiwiY29sIiwiY29tbWFuZCIsImVtYmVkIiwiZnJhbWUiLCJociIsImltYWdlIiwiaW1nIiwiaW5wdXQiLCJpc2luZGV4Iiwia2V5Z2VuIiwibGluayIsIm1lbnVpdGVtIiwibWV0YSIsIm5leHRpZCIsInBhcmFtIiwic291cmNlIiwidHJhY2siLCJ3YnIiXTtyLmNzcyYmKHkuZGVmYXVsdC5mbi5jc3M9ci5jc3MpLHIuYXBwZW5kJiYoeS5kZWZhdWx0LmZuLmFwcGVuZD1yLmFwcGVuZCksci5hZGRDbGFzcyYmKHkuZGVmYXVsdC5mbi5hZGRDbGFzcz1yLmFkZENsYXNzKSxyLnJlbW92ZUNsYXNzJiYoeS5kZWZhdWx0LmZuLnJlbW92ZUNsYXNzPXIucmVtb3ZlQ2xhc3MpLHIuaGFzQ2xhc3MmJih5LmRlZmF1bHQuZm4uaGFzQ2xhc3M9ci5oYXNDbGFzcyksci5vbiYmKHkuZGVmYXVsdC5mbi5vbj1yLm9uKSxyLmZvY3VzJiYoeS5kZWZhdWx0LmZuLmZvY3VzPXIuZm9jdXMpLHIuYXR0ciYmKHkuZGVmYXVsdC5mbi5hdHRyPXIuYXR0ciksci5yZW1vdmVBdHRyJiYoeS5kZWZhdWx0LmZuLnJlbW92ZUF0dHI9ci5yZW1vdmVBdHRyKSxyLmhpZGUmJih5LmRlZmF1bHQuZm4uaGlkZT1yLmhpZGUpLHIuc2hvdyYmKHkuZGVmYXVsdC5mbi5zaG93PXIuc2hvdyksci5vZmZzZXQmJih5LmRlZmF1bHQuZm4ub2Zmc2V0PXIub2Zmc2V0KSxyLndpZHRoJiYoeS5kZWZhdWx0LmZuLndpZHRoPXIud2lkdGgpLHIuaGVpZ2h0JiYoeS5kZWZhdWx0LmZuLmhlaWdodD1yLmhlaWdodCksci5wYXJlbnQmJih5LmRlZmF1bHQuZm4ucGFyZW50PXIucGFyZW50KSxyLnBhcmVudHMmJih5LmRlZmF1bHQuZm4ucGFyZW50cz1yLnBhcmVudHMpLHIuaXMmJih5LmRlZmF1bHQuZm4uaXM9ci5pcyksci5kYXRhc2V0JiYoeS5kZWZhdWx0LmZuLmRhdGFzZXQ9ci5kYXRhc2V0KSxyLnZhbCYmKHkuZGVmYXVsdC5mbi52YWw9ci52YWwpLHIudGV4dCYmKHkuZGVmYXVsdC5mbi50ZXh0PXIudGV4dCksci5odG1sJiYoeS5kZWZhdWx0LmZuLmh0bWw9ci5odG1sKSxyLmNoaWxkcmVuJiYoeS5kZWZhdWx0LmZuLmNoaWxkcmVuPXIuY2hpbGRyZW4pLHIucmVtb3ZlJiYoeS5kZWZhdWx0LmZuLnJlbW92ZT1yLnJlbW92ZSksci5maW5kJiYoeS5kZWZhdWx0LmZuLmZpbmQ9ci5maW5kKSxyLmVhY2gmJih5LmRlZmF1bHQuZm4uZWFjaD1yLmVhY2gpLHIuZW1wdHkmJih5LmRlZmF1bHQuZm4uZW1wdHk9ci5lbXB0eSk7dmFyIFNzLGtzPWZ1bmN0aW9uKGUpe3JldHVybiBlJiZlLm93bmVyRG9jdW1lbnQmJmUub3duZXJEb2N1bWVudC5kZWZhdWx0Vmlld3x8bnVsbH0sT3M9ZnVuY3Rpb24oZSl7cmV0dXJuIENzKGUpJiYxPT09ZS5ub2RlVHlwZX0sQ3M9ZnVuY3Rpb24oZSl7dmFyIHQ9a3MoZSk7cmV0dXJuICEhdCYmZSBpbnN0YW5jZW9mIHQuTm9kZX0sVHM9ZnVuY3Rpb24oZSl7dmFyIHQ9ZSYmZS5hbmNob3JOb2RlJiZrcyhlLmFuY2hvck5vZGUpO3JldHVybiAhIXQmJmUgaW5zdGFuY2VvZiB0LlNlbGVjdGlvbn0sTnM9ZnVuY3Rpb24oZSl7cmV0dXJuIENzKGUpJiYzPT09ZS5ub2RlVHlwZX0sTXM9ZnVuY3Rpb24oZSl7dmFyIHQsbixyO3JldHVybiBudWxsIT09KHQ9d2luZG93LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGUpKSYmdm9pZCAwIT09dD90OihudWxsPT09KHI9bnVsbD09PShuPXdpbmRvdy5kb2N1bWVudC5hY3RpdmVFbGVtZW50KXx8dm9pZCAwPT09bj92b2lkIDA6bi5zaGFkb3dSb290KXx8dm9pZCAwPT09cj92b2lkIDA6ci5nZXRFbGVtZW50QnlJZChlKSl8fG51bGx9LExzPWZ1bmN0aW9uKGUsdCxuKXtmb3IodmFyIHIsbz1lLmNoaWxkTm9kZXMsaT1vW3RdLGE9dCxzPSExLGw9ITE7KENzKHI9aSkmJjg9PT1yLm5vZGVUeXBlfHxPcyhpKSYmMD09PWkuY2hpbGROb2Rlcy5sZW5ndGh8fE9zKGkpJiYiZmFsc2UiPT09aS5nZXRBdHRyaWJ1dGUoImNvbnRlbnRlZGl0YWJsZSIpKSYmKCFzfHwhbCk7KWE+PW8ubGVuZ3RoPyhzPSEwLGE9dC0xLG49ImJhY2t3YXJkIik6YTwwPyhsPSEwLGE9dCsxLG49ImZvcndhcmQiKTooaT1vW2FdLHQ9YSxhKz0iZm9yd2FyZCI9PT1uPzE6LTEpO3JldHVybiBbaSx0XX0sUHM9ZnVuY3Rpb24oZSx0LG4pe3JldHVybiBHaShMcyhlLHQsbiksMSlbMF19LFJzPWZ1bmN0aW9uIGUodCl7dmFyIG4scixvPSIiO2lmKE5zKHQpJiZ0Lm5vZGVWYWx1ZSlyZXR1cm4gdC5ub2RlVmFsdWU7aWYoT3ModCkpe3RyeXtmb3IodmFyIGk9cWkoQXJyYXkuZnJvbSh0LmNoaWxkTm9kZXMpKSxhPWkubmV4dCgpOyFhLmRvbmU7YT1pLm5leHQoKSl7bys9ZShhLnZhbHVlKTt9fWNhdGNoKGUpe249e2Vycm9yOmV9O31maW5hbGx5e3RyeXthJiYhYS5kb25lJiYocj1pLnJldHVybikmJnIuY2FsbChpKTt9ZmluYWxseXtpZihuKXRocm93IG4uZXJyb3J9fXZhciBzPWdldENvbXB1dGVkU3R5bGUodCkuZ2V0UHJvcGVydHlWYWx1ZSgiZGlzcGxheSIpOyJibG9jayIhPT1zJiYibGlzdCIhPT1zJiYidGFibGUtcm93IiE9PXMmJiJCUiIhPT10LnRhZ05hbWV8fChvKz0iXG4iKTt9cmV0dXJuIG99O2Z1bmN0aW9uIERzKGUsdCl7aWYoIShlIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQmJiJ0cnVlIj09PWUuZGF0YXNldC5zbGF0ZVZvaWQpKWZvcih2YXIgbj1lLmNoaWxkTm9kZXMscj1uLmxlbmd0aDtyLS07KXt2YXIgbz1uW3JdLGk9by5ub2RlVHlwZTszPT1pP3QobyxlKToxIT1pJiY5IT1pJiYxMSE9aXx8RHMobyx0KTt9fWZ1bmN0aW9uIGpzKGUpe2lmKDA9PT1lLmxlbmd0aClyZXR1cm4gIiI7dmFyIHQ9ZVswXTtyZXR1cm4gdC5ub2RlVHlwZSE9PVNzLkVMRU1FTlRfTk9ERT8iIjp0LnRhZ05hbWUudG9Mb3dlckNhc2UoKX0hZnVuY3Rpb24oZSl7ZVtlLkVMRU1FTlRfTk9ERT0xXT0iRUxFTUVOVF9OT0RFIixlW2UuVEVYVF9OT0RFPTNdPSJURVhUX05PREUiLGVbZS5DREFUQV9TRUNUSU9OX05PREU9NF09IkNEQVRBX1NFQ1RJT05fTk9ERSIsZVtlLlBST0NFU1NJTkdfSU5TVFJVQ1RJT05fTk9ERT03XT0iUFJPQ0VTU0lOR19JTlNUUlVDVElPTl9OT0RFIixlW2UuQ09NTUVOVF9OT0RFPThdPSJDT01NRU5UX05PREUiLGVbZS5ET0NVTUVOVF9OT0RFPTldPSJET0NVTUVOVF9OT0RFIixlW2UuRE9DVU1FTlRfVFlQRV9OT0RFPTEwXT0iRE9DVU1FTlRfVFlQRV9OT0RFIixlW2UuRE9DVU1FTlRfRlJBR01FTlRfTk9ERT0xMV09IkRPQ1VNRU5UX0ZSQUdNRU5UX05PREUiO30oU3N8fChTcz17fSkpLHZvaWQgMCE9PWdsb2JhbFRoaXMubmF2aWdhdG9yJiZ2b2lkIDAhPT1nbG9iYWxUaGlzLndpbmRvdyYmL2lQYWR8aVBob25lfGlQb2QvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkmJmdsb2JhbFRoaXMud2luZG93Lk1TU3RyZWFtO3ZhciBBcz0idW5kZWZpbmVkIiE9dHlwZW9mIG5hdmlnYXRvciYmL01hYyBPUyBYLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpLF9zPSJ1bmRlZmluZWQiIT10eXBlb2YgbmF2aWdhdG9yJiYvXig/IS4qU2VhbW9ua2V5KSg/PS4qRmlyZWZveCkuKi9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCk7InVuZGVmaW5lZCIhPXR5cGVvZiBuYXZpZ2F0b3ImJi9eKD8hLipTZWFtb25rZXkpKD89LipGaXJlZm94XC8oPzpbMC03XVswLTldfFswLThdWzAtNl0pKD86XC4pKS4qL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTt2YXIgRnM9InVuZGVmaW5lZCIhPXR5cGVvZiBuYXZpZ2F0b3ImJi9WZXJzaW9uXC9bXGRcLl0rLipTYWZhcmkvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCksSXM9InVuZGVmaW5lZCIhPXR5cGVvZiBuYXZpZ2F0b3ImJi9FZGdlP1wvKD86WzAtNl1bMC05XXxbMC03XVswLThdKSg/OlwuKS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCksQnM9InVuZGVmaW5lZCIhPXR5cGVvZiBuYXZpZ2F0b3ImJi9DaHJvbWU/XC8oPzpbMC03XVswLTVdfFswLTZdWzAtOV0pKD86XC4pL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSwkcz0idW5kZWZpbmVkIiE9dHlwZW9mIG5hdmlnYXRvciYmL0Nocm9tZS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCk7InVuZGVmaW5lZCIhPXR5cGVvZiBuYXZpZ2F0b3ImJi8uKlFRQnJvd3Nlci8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTt2YXIgV3M9IUJzJiYhSXMmJiJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsVGhpcyYmZ2xvYmFsVGhpcy5JbnB1dEV2ZW50JiYiZnVuY3Rpb24iPT10eXBlb2YgZ2xvYmFsVGhpcy5JbnB1dEV2ZW50LnByb3RvdHlwZS5nZXRUYXJnZXRSYW5nZXMsSHM9e2dldFdpbmRvdzpmdW5jdGlvbihlKXt2YXIgdD1ocy5nZXQoZSk7aWYoIXQpdGhyb3cgbmV3IEVycm9yKCJVbmFibGUgdG8gZmluZCBhIGhvc3Qgd2luZG93IGVsZW1lbnQgZm9yIHRoaXMgZWRpdG9yIik7cmV0dXJuIHR9LGZpbmRLZXk6ZnVuY3Rpb24oZSx0KXt2YXIgbj1wcy5nZXQodCk7cmV0dXJuIG58fChuPW5ldyBYaSxwcy5zZXQodCxuKSksbn0sc2V0TmV3S2V5OmZ1bmN0aW9uKGUpe3ZhciB0PW5ldyBYaTtwcy5zZXQoZSx0KTt9LGZpbmRQYXRoOmZ1bmN0aW9uKGUsbil7Zm9yKHZhciByPVtdLG89bjs7KXt2YXIgaT1scy5nZXQobyk7aWYobnVsbD09aSl7aWYodC5FZGl0b3IuaXNFZGl0b3IobykpcmV0dXJuIHI7YnJlYWt9dmFyIGE9c3MuZ2V0KG8pO2lmKG51bGw9PWEpYnJlYWs7ci51bnNoaWZ0KGEpLG89aTt9dGhyb3cgbmV3IEVycm9yKCJVbmFibGUgdG8gZmluZCB0aGUgcGF0aCBmb3IgU2xhdGUgbm9kZTogIitKU09OLnN0cmluZ2lmeShuKSl9LGZpbmREb2N1bWVudE9yU2hhZG93Um9vdDpmdW5jdGlvbihlKXtpZihlLmlzRGVzdHJveWVkKXJldHVybiB3aW5kb3cuZG9jdW1lbnQ7dmFyIHQ9SHMudG9ET01Ob2RlKGUsZSksbj10LmdldFJvb3ROb2RlKCk7cmV0dXJuIChuIGluc3RhbmNlb2YgRG9jdW1lbnR8fG4gaW5zdGFuY2VvZiBTaGFkb3dSb290KSYmbnVsbCE9bi5nZXRTZWxlY3Rpb24/bjp0Lm93bmVyRG9jdW1lbnR9LGdldFBhcmVudE5vZGU6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gbHMuZ2V0KHQpfHxudWxsfSxnZXRQYXJlbnRzTm9kZXM6ZnVuY3Rpb24oZSx0KXtmb3IodmFyIG49W10scj10O3IhPT1lJiZudWxsIT1yOyl7dmFyIG89SHMuZ2V0UGFyZW50Tm9kZShlLHIpO2lmKG51bGw9PW8pYnJlYWs7bi5wdXNoKG8pLHI9bzt9cmV0dXJuIG59LGdldFRvcE5vZGU6ZnVuY3Rpb24oZSxuKXt2YXIgcj1bSHMuZmluZFBhdGgoZSxuKVswXV07cmV0dXJuIHQuTm9kZS5nZXQoZSxyKX0sdG9ET01Ob2RlOmZ1bmN0aW9uKGUsbil7dmFyIHI7aWYodC5FZGl0b3IuaXNFZGl0b3Iobikpcj11cy5nZXQoZSk7ZWxzZSB7dmFyIG89SHMuZmluZEtleShlLG4pO3I9ZnMuZ2V0KG8pO31pZighcil0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCByZXNvbHZlIGEgRE9NIG5vZGUgZnJvbSBTbGF0ZSBub2RlOiAiK0pTT04uc3RyaW5naWZ5KG4pKTtyZXR1cm4gcn0saGFzRE9NTm9kZTpmdW5jdGlvbihlLHQsbil7dm9pZCAwPT09biYmKG49e30pO3ZhciByLG89bi5lZGl0YWJsZSxpPXZvaWQgMCE9PW8mJm8sYT1Icy50b0RPTU5vZGUoZSxlKTt0cnl7cj1Pcyh0KT90OnQucGFyZW50RWxlbWVudDt9Y2F0Y2goZSl7aWYoIWUubWVzc2FnZS5pbmNsdWRlcygnUGVybWlzc2lvbiBkZW5pZWQgdG8gYWNjZXNzIHByb3BlcnR5ICJub2RlVHlwZSInKSl0aHJvdyBlfXJldHVybiAhIXImJihyLmNsb3Nlc3QoIltkYXRhLXNsYXRlLWVkaXRvcl0iKT09PWEmJighaXx8ci5pc0NvbnRlbnRFZGl0YWJsZXx8ISFyLmdldEF0dHJpYnV0ZSgiZGF0YS1zbGF0ZS16ZXJvLXdpZHRoIikpKX0sdG9ET01SYW5nZTpmdW5jdGlvbihlLG4pe3ZhciByPW4uYW5jaG9yLG89bi5mb2N1cyxpPXQuUmFuZ2UuaXNCYWNrd2FyZChuKSxhPUhzLnRvRE9NUG9pbnQoZSxyKSxzPXQuUmFuZ2UuaXNDb2xsYXBzZWQobik/YTpIcy50b0RPTVBvaW50KGUsbyksbD1Icy5nZXRXaW5kb3coZSkuZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKSx1PUdpKGk/czphLDIpLGM9dVswXSxmPXVbMV0sZD1HaShpP2E6cywyKSxwPWRbMF0saD1kWzFdLGc9ISEoT3MoYyk/YzpjLnBhcmVudEVsZW1lbnQpLmdldEF0dHJpYnV0ZSgiZGF0YS1zbGF0ZS16ZXJvLXdpZHRoIiksdj0hIShPcyhwKT9wOnAucGFyZW50RWxlbWVudCkuZ2V0QXR0cmlidXRlKCJkYXRhLXNsYXRlLXplcm8td2lkdGgiKTtyZXR1cm4gbC5zZXRTdGFydChjLGc/MTpmKSxsLnNldEVuZChwLHY/MTpoKSxsfSx0b0RPTVBvaW50OmZ1bmN0aW9uKGUsbil7dmFyIHIsbyxpLGE9R2kodC5FZGl0b3Iubm9kZShlLG4ucGF0aCksMSlbMF0scz1Icy50b0RPTU5vZGUoZSxhKTt0LkVkaXRvci52b2lkKGUse2F0Om59KSYmKG49e3BhdGg6bi5wYXRoLG9mZnNldDowfSk7dmFyIGw9QXJyYXkuZnJvbShzLnF1ZXJ5U2VsZWN0b3JBbGwoIltkYXRhLXNsYXRlLXN0cmluZ10sIFtkYXRhLXNsYXRlLXplcm8td2lkdGhdIikpLHU9MDt0cnl7Zm9yKHZhciBjPXFpKGwpLGY9Yy5uZXh0KCk7IWYuZG9uZTtmPWMubmV4dCgpKXt2YXIgZD1mLnZhbHVlLHA9ZC5jaGlsZE5vZGVzWzBdO2lmKG51bGwhPXAmJm51bGwhPXAudGV4dENvbnRlbnQpe3ZhciBoPXAudGV4dENvbnRlbnQubGVuZ3RoLGc9ZC5nZXRBdHRyaWJ1dGUoImRhdGEtc2xhdGUtbGVuZ3RoIiksdj11KyhudWxsPT1nP2g6cGFyc2VJbnQoZywxMCkpO2lmKG4ub2Zmc2V0PD12KXtpPVtwLE1hdGgubWluKGgsTWF0aC5tYXgoMCxuLm9mZnNldC11KSldO2JyZWFrfXU9djt9fX1jYXRjaChlKXtyPXtlcnJvcjplfTt9ZmluYWxseXt0cnl7ZiYmIWYuZG9uZSYmKG89Yy5yZXR1cm4pJiZvLmNhbGwoYyk7fWZpbmFsbHl7aWYocil0aHJvdyByLmVycm9yfX1pZighaSl0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCByZXNvbHZlIGEgRE9NIHBvaW50IGZyb20gU2xhdGUgcG9pbnQ6ICIrSlNPTi5zdHJpbmdpZnkobikpO3JldHVybiBpfSx0b1NsYXRlTm9kZTpmdW5jdGlvbihlLHQpe3ZhciBuPU9zKHQpP3Q6dC5wYXJlbnRFbGVtZW50O24mJiFuLmhhc0F0dHJpYnV0ZSgiZGF0YS1zbGF0ZS1ub2RlIikmJihuPW4uY2xvc2VzdCgiW2RhdGEtc2xhdGUtbm9kZV0iKSk7dmFyIHI9bj9jcy5nZXQobik6bnVsbDtpZighcil0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCByZXNvbHZlIGEgU2xhdGUgbm9kZSBmcm9tIERPTSBub2RlOiAiK24pO3JldHVybiByfSxmaW5kRXZlbnRSYW5nZTpmdW5jdGlvbihlLG4peyJuYXRpdmVFdmVudCJpbiBuJiYobj1uLm5hdGl2ZUV2ZW50KTt2YXIgcj1uLmNsaWVudFgsbz1uLmNsaWVudFksaT1uLnRhcmdldDtpZihudWxsPT1yfHxudWxsPT1vKXRocm93IG5ldyBFcnJvcigiQ2Fubm90IHJlc29sdmUgYSBTbGF0ZSByYW5nZSBmcm9tIGEgRE9NIGV2ZW50OiAiK24pO3ZhciBhLHM9SHMudG9TbGF0ZU5vZGUoZSxuLnRhcmdldCksbD1Icy5maW5kUGF0aChlLHMpO2lmKHQuRWRpdG9yLmlzVm9pZChlLHMpKXt2YXIgdT1pLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLGM9ZS5pc0lubGluZShzKT9yLXUubGVmdDx1LmxlZnQrdS53aWR0aC1yOm8tdS50b3A8dS50b3ArdS5oZWlnaHQtbyxmPXQuRWRpdG9yLnBvaW50KGUsbCx7ZWRnZTpjPyJzdGFydCI6ImVuZCJ9KSxkPWM/dC5FZGl0b3IuYmVmb3JlKGUsZik6dC5FZGl0b3IuYWZ0ZXIoZSxmKTtpZihkKXJldHVybiB0LkVkaXRvci5yYW5nZShlLGQpfXZhciBwPXRoaXMuZ2V0V2luZG93KGUpLmRvY3VtZW50O2lmKHAuY2FyZXRSYW5nZUZyb21Qb2ludClhPXAuY2FyZXRSYW5nZUZyb21Qb2ludChyLG8pO2Vsc2Uge3ZhciBoPXAuY2FyZXRQb3NpdGlvbkZyb21Qb2ludChyLG8pO2gmJigoYT1wLmNyZWF0ZVJhbmdlKCkpLnNldFN0YXJ0KGgub2Zmc2V0Tm9kZSxoLm9mZnNldCksYS5zZXRFbmQoaC5vZmZzZXROb2RlLGgub2Zmc2V0KSk7fWlmKCFhKXRocm93IG5ldyBFcnJvcigiQ2Fubm90IHJlc29sdmUgYSBTbGF0ZSByYW5nZSBmcm9tIGEgRE9NIGV2ZW50OiAiK24pO3JldHVybiBIcy50b1NsYXRlUmFuZ2UoZSxhLHtleGFjdE1hdGNoOiExLHN1cHByZXNzVGhyb3c6ITF9KX0sdG9TbGF0ZVJhbmdlOmZ1bmN0aW9uKGUsbixyKXt2YXIgbyxpLGEscyxsLHU9ci5leGFjdE1hdGNoLGM9ci5zdXBwcmVzc1Rocm93O2lmKChUcyhuKT9uLmFuY2hvck5vZGU6bi5zdGFydENvbnRhaW5lcikmJihUcyhuKT8obz1uLmFuY2hvck5vZGUsaT1uLmFuY2hvck9mZnNldCxhPW4uZm9jdXNOb2RlLHM9bi5mb2N1c09mZnNldCxsPSRzJiZ3aW5kb3cuZG9jdW1lbnQuYWN0aXZlRWxlbWVudCYmd2luZG93LmRvY3VtZW50LmFjdGl2ZUVsZW1lbnQuc2hhZG93Um9vdD9uLmFuY2hvck5vZGU9PT1uLmZvY3VzTm9kZSYmbi5hbmNob3JPZmZzZXQ9PT1uLmZvY3VzT2Zmc2V0Om4uaXNDb2xsYXBzZWQpOihvPW4uc3RhcnRDb250YWluZXIsaT1uLnN0YXJ0T2Zmc2V0LGE9bi5lbmRDb250YWluZXIscz1uLmVuZE9mZnNldCxsPW4uY29sbGFwc2VkKSksbnVsbD09b3x8bnVsbD09YXx8bnVsbD09aXx8bnVsbD09cyl0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCByZXNvbHZlIGEgU2xhdGUgcmFuZ2UgZnJvbSBET00gcmFuZ2U6ICIrbik7dmFyIGY9SHMudG9TbGF0ZVBvaW50KGUsW28saV0se2V4YWN0TWF0Y2g6dSxzdXBwcmVzc1Rocm93OmN9KTtpZighZilyZXR1cm4gbnVsbDt2YXIgZD1sP2Y6SHMudG9TbGF0ZVBvaW50KGUsW2Esc10se2V4YWN0TWF0Y2g6dSxzdXBwcmVzc1Rocm93OmN9KTtpZighZClyZXR1cm4gbnVsbDt2YXIgcD17YW5jaG9yOmYsZm9jdXM6ZH07cmV0dXJuIHQuUmFuZ2UuaXNFeHBhbmRlZChwKSYmdC5SYW5nZS5pc0ZvcndhcmQocCkmJk9zKGEpJiZ0LkVkaXRvci52b2lkKGUse2F0OnAuZm9jdXMsbW9kZToiaGlnaGVzdCJ9KSYmKHA9dC5FZGl0b3IudW5oYW5nUmFuZ2UoZSxwLHt2b2lkczohMH0pKSxwfSx0b1NsYXRlUG9pbnQ6ZnVuY3Rpb24oZSx0LG4pe3ZhciByLG89bi5leGFjdE1hdGNoLGk9bi5zdXBwcmVzc1Rocm93LGE9R2kobz90OmZ1bmN0aW9uKGUpe3ZhciB0LG49R2koZSwyKSxyPW5bMF0sbz1uWzFdO2lmKE9zKHIpJiZyLmNoaWxkTm9kZXMubGVuZ3RoKXt2YXIgaT1vPT09ci5jaGlsZE5vZGVzLmxlbmd0aCxhPWk/by0xOm87Zm9yKHI9KHQ9R2koTHMocixhLGk/ImJhY2t3YXJkIjoiZm9yd2FyZCIpLDIpKVswXSxpPShhPXRbMV0pPG87T3MocikmJnIuY2hpbGROb2Rlcy5sZW5ndGg7KXt2YXIgcz1pP3IuY2hpbGROb2Rlcy5sZW5ndGgtMTowO3I9UHMocixzLGk/ImJhY2t3YXJkIjoiZm9yd2FyZCIpO31vPWkmJm51bGwhPXIudGV4dENvbnRlbnQ/ci50ZXh0Q29udGVudC5sZW5ndGg6MDt9cmV0dXJuIFtyLG9dfSh0KSwyKSxzPWFbMF0sbD1hWzFdLHU9cy5wYXJlbnROb2RlLGM9bnVsbCxmPTA7aWYodSl7dmFyIGQ9dS5jbG9zZXN0KCdbZGF0YS1zbGF0ZS12b2lkPSJ0cnVlIl0nKSxwPXUuY2xvc2VzdCgiW2RhdGEtc2xhdGUtbGVhZl0iKSxoPW51bGw7aWYocCl7Yz1wLmNsb3Nlc3QoJ1tkYXRhLXNsYXRlLW5vZGU9InRleHQiXScpO3ZhciBnPUhzLmdldFdpbmRvdyhlKS5kb2N1bWVudC5jcmVhdGVSYW5nZSgpO2cuc2V0U3RhcnQoYywwKSxnLnNldEVuZChzLGwpO3ZhciB5PWcuY2xvbmVDb250ZW50cygpO0ppKEppKFtdLEdpKHYuZGVmYXVsdCh5LnF1ZXJ5U2VsZWN0b3JBbGwoIltkYXRhLXNsYXRlLXplcm8td2lkdGhdIikpKSksR2kodi5kZWZhdWx0KHkucXVlcnlTZWxlY3RvckFsbCgiW2NvbnRlbnRlZGl0YWJsZT1mYWxzZV0iKSkpKS5mb3JFYWNoKChmdW5jdGlvbihlKXtlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZSk7fSkpLGY9eS50ZXh0Q29udGVudC5sZW5ndGgsaD1jO31lbHNlIGQmJigocD1kLnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXNsYXRlLWxlYWZdIikpPyhjPXAuY2xvc2VzdCgnW2RhdGEtc2xhdGUtbm9kZT0idGV4dCJdJyksZj0oaD1wKS50ZXh0Q29udGVudC5sZW5ndGgsaC5xdWVyeVNlbGVjdG9yQWxsKCJbZGF0YS1zbGF0ZS16ZXJvLXdpZHRoXSIpLmZvckVhY2goKGZ1bmN0aW9uKGUpe2YtPWUudGV4dENvbnRlbnQubGVuZ3RoO30pKSk6Zj0xKTtoJiZmPT09aC50ZXh0Q29udGVudC5sZW5ndGgmJih1Lmhhc0F0dHJpYnV0ZSgiZGF0YS1zbGF0ZS16ZXJvLXdpZHRoIil8fF9zJiYobnVsbD09PShyPWgudGV4dENvbnRlbnQpfHx2b2lkIDA9PT1yP3ZvaWQgMDpyLmVuZHNXaXRoKCJcbiIpKSkmJmYtLTt9aWYoIWMpe2lmKGkpcmV0dXJuIG51bGw7dGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgcmVzb2x2ZSBhIFNsYXRlIHBvaW50IGZyb20gRE9NIHBvaW50OiAiK3QpfXZhciBtPUhzLnRvU2xhdGVOb2RlKGUsYyk7cmV0dXJuIHtwYXRoOkhzLmZpbmRQYXRoKGUsbSksb2Zmc2V0OmZ9fSxoYXNSYW5nZTpmdW5jdGlvbihlLG4pe3ZhciByPW4uYW5jaG9yLG89bi5mb2N1cztyZXR1cm4gdC5FZGl0b3IuaGFzUGF0aChlLHIucGF0aCkmJnQuRWRpdG9yLmhhc1BhdGgoZSxvLnBhdGgpfSxnZXROb2RlVHlwZTpmdW5jdGlvbihlKXtyZXR1cm4gdC5FbGVtZW50LmlzRWxlbWVudChlKT9lLnR5cGU6IiJ9LGNoZWNrTm9kZVR5cGU6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdGhpcy5nZXROb2RlVHlwZShlKT09PXR9LGdldE5vZGVzU3RyOmZ1bmN0aW9uKGUpe3JldHVybiBlLm1hcCgoZnVuY3Rpb24oZSl7cmV0dXJuIHQuTm9kZS5zdHJpbmcoZSl9KSkuam9pbigiIil9LGdldFNlbGVjdGVkRWxlbXM6ZnVuY3Rpb24oZSl7dmFyIG4scixvPVtdLGk9dC5FZGl0b3Iubm9kZXMoZSx7dW5pdmVyc2FsOiEwfSk7dHJ5e2Zvcih2YXIgYT1xaShpKSxzPWEubmV4dCgpOyFzLmRvbmU7cz1hLm5leHQoKSl7dmFyIGw9R2kocy52YWx1ZSwxKVswXTt0LkVsZW1lbnQuaXNFbGVtZW50KGwpJiZvLnB1c2gobCk7fX1jYXRjaChlKXtuPXtlcnJvcjplfTt9ZmluYWxseXt0cnl7cyYmIXMuZG9uZSYmKHI9YS5yZXR1cm4pJiZyLmNhbGwoYSk7fWZpbmFsbHl7aWYobil0aHJvdyBuLmVycm9yfX1yZXR1cm4gb30sZ2V0U2VsZWN0ZWROb2RlQnlUeXBlOmZ1bmN0aW9uKGUsbil7dmFyIHI9dGhpcyxvPUdpKHQuRWRpdG9yLm5vZGVzKGUse21hdGNoOmZ1bmN0aW9uKGUpe3JldHVybiByLmNoZWNrTm9kZVR5cGUoZSxuKX0sdW5pdmVyc2FsOiEwfSksMSksaT1vWzBdO3JldHVybiBudWxsPT1pP251bGw6aVswXX0sZ2V0U2VsZWN0ZWRUZXh0Tm9kZTpmdW5jdGlvbihlKXt2YXIgbj1HaSh0LkVkaXRvci5ub2RlcyhlLHttYXRjaDpmdW5jdGlvbihlKXtyZXR1cm4gdC5UZXh0LmlzVGV4dChlKX0sdW5pdmVyc2FsOiEwfSksMSkscj1uWzBdO3JldHVybiBudWxsPT1yP251bGw6clswXX0saXNOb2RlU2VsZWN0ZWQ6ZnVuY3Rpb24oZSxuKXt2YXIgcj1HaSh0LkVkaXRvci5ub2RlcyhlLHttYXRjaDpmdW5jdGlvbihlKXtyZXR1cm4gZT09PW59LHVuaXZlcnNhbDohMH0pLDEpLG89clswXTtyZXR1cm4gbnVsbCE9byYmR2kobywxKVswXT09PW59LGlzU2VsZWN0aW9uQXRMaW5lRW5kOmZ1bmN0aW9uKGUsbil7dmFyIHI9ZS5zZWxlY3Rpb247cmV0dXJuICEhciYmKHQuRWRpdG9yLmlzRW5kKGUsci5hbmNob3Isbil8fHQuRWRpdG9yLmlzRW5kKGUsci5mb2N1cyxuKSl9LGdldFRleHRhcmVhOmZ1bmN0aW9uKGUpe3ZhciB0PUdhLmdldChlKTtpZihudWxsPT10KXRocm93IG5ldyBFcnJvcigiQ2Fubm90IGZpbmQgdGV4dGFyZWEgaW5zdGFuY2UgYnkgZWRpdG9yIik7cmV0dXJuIHR9LGdldFRvb2xiYXI6ZnVuY3Rpb24oZSl7cmV0dXJuIFhhLmdldChlKXx8bnVsbH0sZ2V0SG92ZXJiYXI6ZnVuY3Rpb24oZSl7cmV0dXJuIFphLmdldChlKXx8bnVsbH0sbm9ybWFsaXplQ29udGVudDpmdW5jdGlvbihlKXtlLmNoaWxkcmVuLmZvckVhY2goKGZ1bmN0aW9uKHQsbil7ZS5ub3JtYWxpemVOb2RlKFt0LFtuXV0pO30pKTt9LGdldExlZnRMZW5ndGhPZk1heExlbmd0aDpmdW5jdGlvbihlKXt2YXIgdD1lLmdldENvbmZpZygpLG49dC5tYXhMZW5ndGgscj10Lm9uTWF4TGVuZ3RoO2lmKCJudW1iZXIiIT10eXBlb2Ygbnx8bjw9MClyZXR1cm4gMS8wO3ZhciBvPW4tZS5nZXRUZXh0KCkucmVwbGFjZSgvXHJ8XG58KFxyXG4pL2csIiIpLmxlbmd0aDtyZXR1cm4gbzw9MCYmciYmcihlKSxvfSxjbGVhbkV4cG9zZWRUZXhOb2RlSW5TZWxlY3Rpb25CbG9jazpmdW5jdGlvbihlKXt2YXIgbixyLG8saSxhPUhzLmdldFRleHRhcmVhKGUpLiR0ZXh0QXJlYSxzPW51bGw9PWE/dm9pZCAwOmFbMF0uY2hpbGROb2RlcztpZihzKXRyeXtmb3IodmFyIGw9cWkoQXJyYXkuZnJvbShzKSksdT1sLm5leHQoKTshdS5kb25lO3U9bC5uZXh0KCkpe3ZhciBjPXUudmFsdWU7aWYoMyE9PWMubm9kZVR5cGUpYnJlYWs7Yy5yZW1vdmUoKTt9fWNhdGNoKGUpe249e2Vycm9yOmV9O31maW5hbGx5e3RyeXt1JiYhdS5kb25lJiYocj1sLnJldHVybikmJnIuY2FsbChsKTt9ZmluYWxseXtpZihuKXRocm93IG4uZXJyb3J9fXZhciBmPXQuRWRpdG9yLm5vZGVzKGUse21hdGNoOmZ1bmN0aW9uKG4pe3JldHVybiAhKCF0LkVsZW1lbnQuaXNFbGVtZW50KG4pfHxlLmlzSW5saW5lKG4pKX0sdW5pdmVyc2FsOiEwfSk7dHJ5e2Zvcih2YXIgZD1xaShmKSxwPWQubmV4dCgpOyFwLmRvbmU7cD1kLm5leHQoKSl7dmFyIGg9cC52YWx1ZTtpZihudWxsIT1oKXt2YXIgZz1oWzBdO0RzKEhzLnRvRE9NTm9kZShlLGcpLChmdW5jdGlvbihlLHQpe3ZhciBuPXkuZGVmYXVsdCh0KTtuLmF0dHIoImRhdGEtc2xhdGUtc3RyaW5nIil8fG4uYXR0cigiZGF0YS1zbGF0ZS16ZXJvLXdpZHRoIil8fG4uYXR0cigiZGF0YS13LWUtcmVzZXJ2ZSIpfHx0LnJlbW92ZUNoaWxkKGUpO30pKTt9fX1jYXRjaChlKXtvPXtlcnJvcjplfTt9ZmluYWxseXt0cnl7cCYmIXAuZG9uZSYmKGk9ZC5yZXR1cm4pJiZpLmNhbGwoZCk7fWZpbmFsbHl7aWYobyl0aHJvdyBvLmVycm9yfX19LGlzTGFzdE5vZGU6ZnVuY3Rpb24oZSx0KXt2YXIgbj1lLmNoaWxkcmVufHxbXTtyZXR1cm4gbltuLmxlbmd0aC0xXT09PXR9LGdlbkVtcHR5UGFyYWdyYXBoOmZ1bmN0aW9uKCl7cmV0dXJuIHt0eXBlOiJwYXJhZ3JhcGgiLGNoaWxkcmVuOlt7dGV4dDoiIn1dfX0saXNTZWxlY3RlZFZvaWROb2RlOmZ1bmN0aW9uKGUpe3ZhciBuLHIsbz10LkVkaXRvci5ub2RlcyhlLHttYXRjaDpmdW5jdGlvbih0KXtyZXR1cm4gZS5pc1ZvaWQodCl9fSksaT0wO3RyeXtmb3IodmFyIGE9cWkobykscz1hLm5leHQoKTshcy5kb25lO3M9YS5uZXh0KCkpe3MudmFsdWU7aSsrO319Y2F0Y2goZSl7bj17ZXJyb3I6ZX07fWZpbmFsbHl7dHJ5e3MmJiFzLmRvbmUmJihyPWEucmV0dXJuKSYmci5jYWxsKGEpO31maW5hbGx5e2lmKG4pdGhyb3cgbi5lcnJvcn19cmV0dXJuIGk+MH0saXNTZWxlY3RlZEVtcHR5UGFyYWdyYXBoOmZ1bmN0aW9uKGUpe3ZhciBuPWUuc2VsZWN0aW9uO2lmKG51bGw9PW4pcmV0dXJuICExO2lmKHQuUmFuZ2UuaXNFeHBhbmRlZChuKSlyZXR1cm4gITE7dmFyIHI9SHMuZ2V0U2VsZWN0ZWROb2RlQnlUeXBlKGUsInBhcmFncmFwaCIpO2lmKG51bGw9PT1yKXJldHVybiAhMTt2YXIgbz1yLmNoaWxkcmVuO3JldHVybiAxPT09by5sZW5ndGgmJigiIj09PW9bMF0udGV4dHx8dm9pZCAwKX0saXNFbXB0eVBhdGg6ZnVuY3Rpb24oZSxuKXt2YXIgcj10LkVkaXRvci5ub2RlKGUsbik7aWYobnVsbD09cilyZXR1cm4gITE7dmFyIG89R2kociwxKVswXS5jaGlsZHJlbjtpZigxPT09by5sZW5ndGgmJiIiPT09b1swXS50ZXh0KXJldHVybiAhMDtyZXR1cm4gITF9fSxWcz0xLHpzPXt9O3ZhciBVcz17fTt2YXIgS3M9WnQuZmlsdGVyLHFzPXFvKCJmaWx0ZXIiKTtfbih7dGFyZ2V0OiJBcnJheSIscHJvdG86ITAsZm9yY2VkOiFxc30se2ZpbHRlcjpmdW5jdGlvbihlKXtyZXR1cm4gS3ModGhpcyxlLGFyZ3VtZW50cy5sZW5ndGg+MT9hcmd1bWVudHNbMV06dm9pZCAwKX19KTt2YXIgR3M9Ilx0XG5cdlxmXHIgwqDhmoDigIDigIHigILigIPigITigIXigIbigIfigIjigInigIrigK/igZ/jgIBcdTIwMjhcdTIwMjlcdWZlZmYiLEpzPVcoIiIucmVwbGFjZSksWXM9IlsiK0dzKyJdIixYcz1SZWdFeHAoIl4iK1lzK1lzKyIqIiksUXM9UmVnRXhwKFlzK1lzKyIqJCIpLFpzPWZ1bmN0aW9uKGUpe3JldHVybiBmdW5jdGlvbih0KXt2YXIgbj1lcihWKHQpKTtyZXR1cm4gMSZlJiYobj1KcyhuLFhzLCIiKSksMiZlJiYobj1KcyhuLFFzLCIiKSksbn19LGVsPXtzdGFydDpacygxKSxlbmQ6WnMoMiksdHJpbTpacygzKX0sdGw9aHQuUFJPUEVSLG5sPWVsLnRyaW07X24oe3RhcmdldDoiU3RyaW5nIixwcm90bzohMCxmb3JjZWQ6ZnVuY3Rpb24oZSl7cmV0dXJuIHNlKChmdW5jdGlvbigpe3JldHVybiAhIUdzW2VdKCl8fCLigIvCheGgjiIhPT0i4oCLwoXhoI4iW2VdKCl8fHRsJiZHc1tlXS5uYW1lIT09ZX0pKX0oInRyaW0iKX0se3RyaW06ZnVuY3Rpb24oKXtyZXR1cm4gbmwodGhpcyl9fSk7dmFyIHJsPVtdO3ZhciBvbD17fTtmdW5jdGlvbiBpbChlLHQsbil7dmFyIHI9bi5pc0lubGluZShlKT8ic3BhbiI6ImRpdiI7cmV0dXJuICI8IityKyI+Iit0KyI8LyIrcisiPiJ9ZnVuY3Rpb24gYWwoZSxuKXt2YXIgcj1lLnR5cGUsbz12b2lkIDA9PT1yPyIiOnIsaT1lLmNoaWxkcmVuLGE9dm9pZCAwPT09aT9bXTppLHM9dC5FZGl0b3IuaXNWb2lkKG4sZSksbD0iIjtzfHwobD1hLm1hcCgoZnVuY3Rpb24oZSl7cmV0dXJuIEt1KGUsbil9KSkuam9pbigiIikpO3ZhciB1PWZ1bmN0aW9uKGUpe3JldHVybiBvbFtlXXx8aWx9KG8pLGM9dShlLGwsbiksZj0iIjtpZihmPSJzdHJpbmciPT10eXBlb2YgYz9jOmMuaHRtbHx8IiIsc3x8cmwuZm9yRWFjaCgoZnVuY3Rpb24odCl7cmV0dXJuIGY9dChlLGYpfSkpLCJzdHJpbmciPT10eXBlb2YgYylyZXR1cm4gZjt2YXIgZD1jLnByZWZpeCxwPXZvaWQgMD09PWQ/IiI6ZCxoPWMuc3VmZml4LGc9dm9pZCAwPT09aD8iIjpoO3JldHVybiBwJiYoZj1wK2YpLGcmJihmKz1nKSxmfXZhciBzbCxsbCx1bCxjbCxmbD1QLlByb21pc2UsZGw9aGUoInNwZWNpZXMiKSxwbD1mdW5jdGlvbihlKXt2YXIgdD1lZShlKSxuPVZlLmY7eWUmJnQmJiF0W2RsXSYmbih0LGRsLHtjb25maWd1cmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9fSk7fSxobD1QLlR5cGVFcnJvcixnbD1oZSgic3BlY2llcyIpLHZsPWZ1bmN0aW9uKGUsdCl7dmFyIG4scj1PZShlKS5jb25zdHJ1Y3RvcjtyZXR1cm4gdm9pZCAwPT09cnx8bnVsbD09KG49T2UocilbZ2xdKT90OmZ1bmN0aW9uKGUpe2lmKHF0KGUpKXJldHVybiBlO3Rocm93IGhsKFJlKGUpKyIgaXMgbm90IGEgY29uc3RydWN0b3IiKX0obil9LHlsPVcoW10uc2xpY2UpLG1sPS8oPzppcGFkfGlwaG9uZXxpcG9kKS4qYXBwbGV3ZWJraXQvaS50ZXN0KHRlKSxibD0icHJvY2VzcyI9PW10KFAucHJvY2Vzcyksd2w9UC5zZXRJbW1lZGlhdGUseGw9UC5jbGVhckltbWVkaWF0ZSxFbD1QLnByb2Nlc3MsU2w9UC5EaXNwYXRjaCxrbD1QLkZ1bmN0aW9uLE9sPVAuTWVzc2FnZUNoYW5uZWwsQ2w9UC5TdHJpbmcsVGw9MCxObD17fSxNbD0ib25yZWFkeXN0YXRlY2hhbmdlIjt0cnl7c2w9UC5sb2NhdGlvbjt9Y2F0Y2goZSl7fXZhciBMbD1mdW5jdGlvbihlKXtpZihxKE5sLGUpKXt2YXIgdD1ObFtlXTtkZWxldGUgTmxbZV0sdCgpO319LFBsPWZ1bmN0aW9uKGUpe3JldHVybiBmdW5jdGlvbigpe0xsKGUpO319LFJsPWZ1bmN0aW9uKGUpe0xsKGUuZGF0YSk7fSxEbD1mdW5jdGlvbihlKXtQLnBvc3RNZXNzYWdlKENsKGUpLHNsLnByb3RvY29sKyIvLyIrc2wuaG9zdCk7fTt3bCYmeGx8fCh3bD1mdW5jdGlvbihlKXt2YXIgdD15bChhcmd1bWVudHMsMSk7cmV0dXJuIE5sWysrVGxdPWZ1bmN0aW9uKCl7d2koUShlKT9lOmtsKGUpLHZvaWQgMCx0KTt9LGxsKFRsKSxUbH0seGw9ZnVuY3Rpb24oZSl7ZGVsZXRlIE5sW2VdO30sYmw/bGw9ZnVuY3Rpb24oZSl7RWwubmV4dFRpY2soUGwoZSkpO306U2wmJlNsLm5vdz9sbD1mdW5jdGlvbihlKXtTbC5ub3coUGwoZSkpO306T2wmJiFtbD8oY2w9KHVsPW5ldyBPbCkucG9ydDIsdWwucG9ydDEub25tZXNzYWdlPVJsLGxsPU10KGNsLnBvc3RNZXNzYWdlLGNsKSk6UC5hZGRFdmVudExpc3RlbmVyJiZRKFAucG9zdE1lc3NhZ2UpJiYhUC5pbXBvcnRTY3JpcHRzJiZzbCYmImZpbGU6IiE9PXNsLnByb3RvY29sJiYhc2UoRGwpPyhsbD1EbCxQLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLFJsLCExKSk6bGw9TWwgaW4geGUoInNjcmlwdCIpP2Z1bmN0aW9uKGUpe2ZyLmFwcGVuZENoaWxkKHhlKCJzY3JpcHQiKSkub25yZWFkeXN0YXRlY2hhbmdlPWZ1bmN0aW9uKCl7ZnIucmVtb3ZlQ2hpbGQodGhpcyksTGwoZSk7fTt9OmZ1bmN0aW9uKGUpe3NldFRpbWVvdXQoUGwoZSksMCk7fSk7dmFyIGpsLEFsLF9sLEZsLElsLEJsLCRsLFdsLEhsPXtzZXQ6d2wsY2xlYXI6eGx9LFZsPS9pcGFkfGlwaG9uZXxpcG9kL2kudGVzdCh0ZSkmJnZvaWQgMCE9PVAuUGViYmxlLHpsPS93ZWIwcyg/IS4qY2hyb21lKS9pLnRlc3QodGUpLFVsPWRuLmYsS2w9SGwuc2V0LHFsPVAuTXV0YXRpb25PYnNlcnZlcnx8UC5XZWJLaXRNdXRhdGlvbk9ic2VydmVyLEdsPVAuZG9jdW1lbnQsSmw9UC5wcm9jZXNzLFlsPVAuUHJvbWlzZSxYbD1VbChQLCJxdWV1ZU1pY3JvdGFzayIpLFFsPVhsJiZYbC52YWx1ZTtRbHx8KGpsPWZ1bmN0aW9uKCl7dmFyIGUsdDtmb3IoYmwmJihlPUpsLmRvbWFpbikmJmUuZXhpdCgpO0FsOyl7dD1BbC5mbixBbD1BbC5uZXh0O3RyeXt0KCk7fWNhdGNoKGUpe3Rocm93IEFsP0ZsKCk6X2w9dm9pZCAwLGV9fV9sPXZvaWQgMCxlJiZlLmVudGVyKCk7fSxtbHx8Ymx8fHpsfHwhcWx8fCFHbD8hVmwmJllsJiZZbC5yZXNvbHZlPygoJGw9WWwucmVzb2x2ZSh2b2lkIDApKS5jb25zdHJ1Y3Rvcj1ZbCxXbD1NdCgkbC50aGVuLCRsKSxGbD1mdW5jdGlvbigpe1dsKGpsKTt9KTpibD9GbD1mdW5jdGlvbigpe0psLm5leHRUaWNrKGpsKTt9OihLbD1NdChLbCxQKSxGbD1mdW5jdGlvbigpe0tsKGpsKTt9KTooSWw9ITAsQmw9R2wuY3JlYXRlVGV4dE5vZGUoIiIpLG5ldyBxbChqbCkub2JzZXJ2ZShCbCx7Y2hhcmFjdGVyRGF0YTohMH0pLEZsPWZ1bmN0aW9uKCl7QmwuZGF0YT1JbD0hSWw7fSkpO3ZhciBabCxldSx0dSxudSxydT1RbHx8ZnVuY3Rpb24oZSl7dmFyIHQ9e2ZuOmUsbmV4dDp2b2lkIDB9O19sJiYoX2wubmV4dD10KSxBbHx8KEFsPXQsRmwoKSksX2w9dDt9LG91PWZ1bmN0aW9uKGUpe3ZhciB0LG47dGhpcy5wcm9taXNlPW5ldyBlKChmdW5jdGlvbihlLHIpe2lmKHZvaWQgMCE9PXR8fHZvaWQgMCE9PW4pdGhyb3cgVHlwZUVycm9yKCJCYWQgUHJvbWlzZSBjb25zdHJ1Y3RvciIpO3Q9ZSxuPXI7fSkpLHRoaXMucmVzb2x2ZT1qZSh0KSx0aGlzLnJlamVjdD1qZShuKTt9LGl1PXtmOmZ1bmN0aW9uKGUpe3JldHVybiBuZXcgb3UoZSl9fSxhdT1mdW5jdGlvbihlKXt0cnl7cmV0dXJuIHtlcnJvcjohMSx2YWx1ZTplKCl9fWNhdGNoKGUpe3JldHVybiB7ZXJyb3I6ITAsdmFsdWU6ZX19fSxzdT0ib2JqZWN0Ij09dHlwZW9mIHdpbmRvdyxsdT1IbC5zZXQsdXU9aGUoInNwZWNpZXMiKSxjdT0iUHJvbWlzZSIsZnU9Y3QuZ2V0dGVyRm9yKGN1KSxkdT1jdC5zZXQscHU9Y3QuZ2V0dGVyRm9yKGN1KSxodT1mbCYmZmwucHJvdG90eXBlLGd1PWZsLHZ1PWh1LHl1PVAuVHlwZUVycm9yLG11PVAuZG9jdW1lbnQsYnU9UC5wcm9jZXNzLHd1PWl1LmYseHU9d3UsRXU9ISEobXUmJm11LmNyZWF0ZUV2ZW50JiZQLmRpc3BhdGNoRXZlbnQpLFN1PVEoUC5Qcm9taXNlUmVqZWN0aW9uRXZlbnQpLGt1PSJ1bmhhbmRsZWRyZWplY3Rpb24iLE91PSExLEN1PWpuKGN1LChmdW5jdGlvbigpe3ZhciBlPVllKGd1KSx0PWUhPT1TdHJpbmcoZ3UpO2lmKCF0JiY2Nj09PWFlKXJldHVybiAhMDtpZihhZT49NTEmJi9uYXRpdmUgY29kZS8udGVzdChlKSlyZXR1cm4gITE7dmFyIG49bmV3IGd1KChmdW5jdGlvbihlKXtlKDEpO30pKSxyPWZ1bmN0aW9uKGUpe2UoKGZ1bmN0aW9uKCl7fSksKGZ1bmN0aW9uKCl7fSkpO307cmV0dXJuIChuLmNvbnN0cnVjdG9yPXt9KVt1dV09ciwhKE91PW4udGhlbigoZnVuY3Rpb24oKXt9KSlpbnN0YW5jZW9mIHIpfHwhdCYmc3UmJiFTdX0pKSxUdT1DdXx8IUdyKChmdW5jdGlvbihlKXtndS5hbGwoZSkuY2F0Y2goKGZ1bmN0aW9uKCl7fSkpO30pKSxOdT1mdW5jdGlvbihlKXt2YXIgdDtyZXR1cm4gISghbWUoZSl8fCFRKHQ9ZS50aGVuKSkmJnR9LE11PWZ1bmN0aW9uKGUsdCl7aWYoIWUubm90aWZpZWQpe2Uubm90aWZpZWQ9ITA7dmFyIG49ZS5yZWFjdGlvbnM7cnUoKGZ1bmN0aW9uKCl7Zm9yKHZhciByPWUudmFsdWUsbz0xPT1lLnN0YXRlLGk9MDtuLmxlbmd0aD5pOyl7dmFyIGEscyxsLHU9bltpKytdLGM9bz91Lm9rOnUuZmFpbCxmPXUucmVzb2x2ZSxkPXUucmVqZWN0LHA9dS5kb21haW47dHJ5e2M/KG98fCgyPT09ZS5yZWplY3Rpb24mJkR1KGUpLGUucmVqZWN0aW9uPTEpLCEwPT09Yz9hPXI6KHAmJnAuZW50ZXIoKSxhPWMocikscCYmKHAuZXhpdCgpLGw9ITApKSxhPT09dS5wcm9taXNlP2QoeXUoIlByb21pc2UtY2hhaW4gY3ljbGUiKSk6KHM9TnUoYSkpP1RlKHMsYSxmLGQpOmYoYSkpOmQocik7fWNhdGNoKGUpe3AmJiFsJiZwLmV4aXQoKSxkKGUpO319ZS5yZWFjdGlvbnM9W10sZS5ub3RpZmllZD0hMSx0JiYhZS5yZWplY3Rpb24mJlB1KGUpO30pKTt9fSxMdT1mdW5jdGlvbihlLHQsbil7dmFyIHIsbztFdT8oKHI9bXUuY3JlYXRlRXZlbnQoIkV2ZW50IikpLnByb21pc2U9dCxyLnJlYXNvbj1uLHIuaW5pdEV2ZW50KGUsITEsITApLFAuZGlzcGF0Y2hFdmVudChyKSk6cj17cHJvbWlzZTp0LHJlYXNvbjpufSwhU3UmJihvPVBbIm9uIitlXSk/byhyKTplPT09a3UmJmZ1bmN0aW9uKGUsdCl7dmFyIG49UC5jb25zb2xlO24mJm4uZXJyb3ImJigxPT1hcmd1bWVudHMubGVuZ3RoP24uZXJyb3IoZSk6bi5lcnJvcihlLHQpKTt9KCJVbmhhbmRsZWQgcHJvbWlzZSByZWplY3Rpb24iLG4pO30sUHU9ZnVuY3Rpb24oZSl7VGUobHUsUCwoZnVuY3Rpb24oKXt2YXIgdCxuPWUuZmFjYWRlLHI9ZS52YWx1ZTtpZihSdShlKSYmKHQ9YXUoKGZ1bmN0aW9uKCl7Ymw/YnUuZW1pdCgidW5oYW5kbGVkUmVqZWN0aW9uIixyLG4pOkx1KGt1LG4scik7fSkpLGUucmVqZWN0aW9uPWJsfHxSdShlKT8yOjEsdC5lcnJvcikpdGhyb3cgdC52YWx1ZX0pKTt9LFJ1PWZ1bmN0aW9uKGUpe3JldHVybiAxIT09ZS5yZWplY3Rpb24mJiFlLnBhcmVudH0sRHU9ZnVuY3Rpb24oZSl7VGUobHUsUCwoZnVuY3Rpb24oKXt2YXIgdD1lLmZhY2FkZTtibD9idS5lbWl0KCJyZWplY3Rpb25IYW5kbGVkIix0KTpMdSgicmVqZWN0aW9uaGFuZGxlZCIsdCxlLnZhbHVlKTt9KSk7fSxqdT1mdW5jdGlvbihlLHQsbil7cmV0dXJuIGZ1bmN0aW9uKHIpe2UodCxyLG4pO319LEF1PWZ1bmN0aW9uKGUsdCxuKXtlLmRvbmV8fChlLmRvbmU9ITAsbiYmKGU9biksZS52YWx1ZT10LGUuc3RhdGU9MixNdShlLCEwKSk7fSxfdT1mdW5jdGlvbihlLHQsbil7aWYoIWUuZG9uZSl7ZS5kb25lPSEwLG4mJihlPW4pO3RyeXtpZihlLmZhY2FkZT09PXQpdGhyb3cgeXUoIlByb21pc2UgY2FuJ3QgYmUgcmVzb2x2ZWQgaXRzZWxmIik7dmFyIHI9TnUodCk7cj9ydSgoZnVuY3Rpb24oKXt2YXIgbj17ZG9uZTohMX07dHJ5e1RlKHIsdCxqdShfdSxuLGUpLGp1KEF1LG4sZSkpO31jYXRjaCh0KXtBdShuLHQsZSk7fX0pKTooZS52YWx1ZT10LGUuc3RhdGU9MSxNdShlLCExKSk7fWNhdGNoKHQpe0F1KHtkb25lOiExfSx0LGUpO319fTtpZihDdSYmKHZ1PShndT1mdW5jdGlvbihlKXtiYSh0aGlzLHZ1KSxqZShlKSxUZShabCx0aGlzKTt2YXIgdD1mdSh0aGlzKTt0cnl7ZShqdShfdSx0KSxqdShBdSx0KSk7fWNhdGNoKGUpe0F1KHQsZSk7fX0pLnByb3RvdHlwZSwoWmw9ZnVuY3Rpb24oZSl7ZHUodGhpcyx7dHlwZTpjdSxkb25lOiExLG5vdGlmaWVkOiExLHBhcmVudDohMSxyZWFjdGlvbnM6W10scmVqZWN0aW9uOiExLHN0YXRlOjAsdmFsdWU6dm9pZCAwfSk7fSkucHJvdG90eXBlPW5hKHZ1LHt0aGVuOmZ1bmN0aW9uKGUsdCl7dmFyIG49cHUodGhpcykscj1uLnJlYWN0aW9ucyxvPXd1KHZsKHRoaXMsZ3UpKTtyZXR1cm4gby5vaz0hUShlKXx8ZSxvLmZhaWw9USh0KSYmdCxvLmRvbWFpbj1ibD9idS5kb21haW46dm9pZCAwLG4ucGFyZW50PSEwLHJbci5sZW5ndGhdPW8sMCE9bi5zdGF0ZSYmTXUobiwhMSksby5wcm9taXNlfSxjYXRjaDpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy50aGVuKHZvaWQgMCxlKX19KSxldT1mdW5jdGlvbigpe3ZhciBlPW5ldyBabCx0PWZ1KGUpO3RoaXMucHJvbWlzZT1lLHRoaXMucmVzb2x2ZT1qdShfdSx0KSx0aGlzLnJlamVjdD1qdShBdSx0KTt9LGl1LmY9d3U9ZnVuY3Rpb24oZSl7cmV0dXJuIGU9PT1ndXx8ZT09PXR1P25ldyBldShlKTp4dShlKX0sUShmbCkmJmh1IT09T2JqZWN0LnByb3RvdHlwZSkpe251PWh1LnRoZW4sT3V8fChndChodSwidGhlbiIsKGZ1bmN0aW9uKGUsdCl7dmFyIG49dGhpcztyZXR1cm4gbmV3IGd1KChmdW5jdGlvbihlLHQpe1RlKG51LG4sZSx0KTt9KSkudGhlbihlLHQpfSkse3Vuc2FmZTohMH0pLGd0KGh1LCJjYXRjaCIsdnUuY2F0Y2gse3Vuc2FmZTohMH0pKTt0cnl7ZGVsZXRlIGh1LmNvbnN0cnVjdG9yO31jYXRjaChlKXt9eG8mJnhvKGh1LHZ1KTt9X24oe2dsb2JhbDohMCx3cmFwOiEwLGZvcmNlZDpDdX0se1Byb21pc2U6Z3V9KSx2byhndSxjdSwhMSkscGwoY3UpLHR1PWVlKGN1KSxfbih7dGFyZ2V0OmN1LHN0YXQ6ITAsZm9yY2VkOkN1fSx7cmVqZWN0OmZ1bmN0aW9uKGUpe3ZhciB0PXd1KHRoaXMpO3JldHVybiBUZSh0LnJlamVjdCx2b2lkIDAsZSksdC5wcm9taXNlfX0pLF9uKHt0YXJnZXQ6Y3Usc3RhdDohMCxmb3JjZWQ6Q3V9LHtyZXNvbHZlOmZ1bmN0aW9uKGUpe3JldHVybiBmdW5jdGlvbihlLHQpe2lmKE9lKGUpLG1lKHQpJiZ0LmNvbnN0cnVjdG9yPT09ZSlyZXR1cm4gdDt2YXIgbj1pdS5mKGUpO3JldHVybiAoMCwgbi5yZXNvbHZlKSh0KSxuLnByb21pc2V9KHRoaXMsZSl9fSksX24oe3RhcmdldDpjdSxzdGF0OiEwLGZvcmNlZDpUdX0se2FsbDpmdW5jdGlvbihlKXt2YXIgdD10aGlzLG49d3UodCkscj1uLnJlc29sdmUsbz1uLnJlamVjdCxpPWF1KChmdW5jdGlvbigpe3ZhciBuPWplKHQucmVzb2x2ZSksaT1bXSxhPTAscz0xO3lhKGUsKGZ1bmN0aW9uKGUpe3ZhciBsPWErKyx1PSExO3MrKyxUZShuLHQsZSkudGhlbigoZnVuY3Rpb24oZSl7dXx8KHU9ITAsaVtsXT1lLC0tc3x8cihpKSk7fSksbyk7fSkpLC0tc3x8cihpKTt9KSk7cmV0dXJuIGkuZXJyb3ImJm8oaS52YWx1ZSksbi5wcm9taXNlfSxyYWNlOmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMsbj13dSh0KSxyPW4ucmVqZWN0LG89YXUoKGZ1bmN0aW9uKCl7dmFyIG89amUodC5yZXNvbHZlKTt5YShlLChmdW5jdGlvbihlKXtUZShvLHQsZSkudGhlbihuLnJlc29sdmUscik7fSkpO30pKTtyZXR1cm4gby5lcnJvciYmcihvLnZhbHVlKSxuLnByb21pc2V9fSk7dmFyIEZ1PVpvLlVOU1VQUE9SVEVEX1ksSXU9NDI5NDk2NzI5NSxCdT1NYXRoLm1pbiwkdT1bXS5wdXNoLFd1PVcoLy4vLmV4ZWMpLEh1PVcoJHUpLFZ1PVcoIiIuc2xpY2UpLHp1PSFzZSgoZnVuY3Rpb24oKXt2YXIgZT0vKD86KS8sdD1lLmV4ZWM7ZS5leGVjPWZ1bmN0aW9uKCl7cmV0dXJuIHQuYXBwbHkodGhpcyxhcmd1bWVudHMpfTt2YXIgbj0iYWIiLnNwbGl0KGUpO3JldHVybiAyIT09bi5sZW5ndGh8fCJhIiE9PW5bMF18fCJiIiE9PW5bMV19KSk7ZnVuY3Rpb24gVXUoZSl7UHJvbWlzZS5yZXNvbHZlKCkudGhlbihlKTt9ZnVuY3Rpb24gS3UoZSxuKXtyZXR1cm4gdC5FbGVtZW50LmlzRWxlbWVudChlKT9hbChlLG4pOmZ1bmN0aW9uKGUsdCl7dmFyIG49ZS50ZXh0O2lmKG51bGw9PW4pdGhyb3cgbmV3IEVycm9yKCJDdXJyZW50IG5vZGUgaXMgbm90IHNsYXRlIFRleHQgIitKU09OLnN0cmluZ2lmeShlKSk7dmFyIHI9bjtyPWZ1bmN0aW9uKGUpe3JldHVybiBlLnJlcGxhY2UoLyB7Mn0vZywiICZuYnNwOyIpLnJlcGxhY2UoLzwvZywiJmx0OyIpLnJlcGxhY2UoLz4vZywiJmd0OyIpLnJlcGxhY2UoL8KuL2csIiZyZWc7IikucmVwbGFjZSgvwqkvZywiJmNvcHk7IikucmVwbGFjZSgv4oSiL2csIiZ0cmFkZTsiKX0ocik7dmFyIG89SHMuZ2V0UGFyZW50c05vZGVzKHQsZSkuc29tZSgoZnVuY3Rpb24oZSl7cmV0dXJuICJwcmUiPT09SHMuZ2V0Tm9kZVR5cGUoZSl9KSk7aWYob3x8KHI9ci5yZXBsYWNlKC9cclxufFxyfFxuL2csIjxicj4iKSksbyYmKHI9ci5yZXBsYWNlKC8mbmJzcDsvZywiICIpKSwiIj09PXIpe3ZhciBpPUhzLmdldFBhcmVudE5vZGUobnVsbCxlKTtpZighaXx8MCE9PWkuY2hpbGRyZW4ubGVuZ3RoKXJldHVybiByO3I9Ijxicj4iO31yZXR1cm4gcmwuZm9yRWFjaCgoZnVuY3Rpb24odCl7cmV0dXJuIHI9dChlLHIpfSkpLHJ9KGUsbil9ZnVuY3Rpb24gcXUoZSl7cmV0dXJuICJ3LWUtZWxlbWVudC0iK2V9U2koInNwbGl0IiwoZnVuY3Rpb24oZSx0LG4pe3ZhciByO3JldHVybiByPSJjIj09ImFiYmMiLnNwbGl0KC8oYikqLylbMV18fDQhPSJ0ZXN0Ii5zcGxpdCgvKD86KS8sLTEpLmxlbmd0aHx8MiE9ImFiIi5zcGxpdCgvKD86YWIpKi8pLmxlbmd0aHx8NCE9Ii4iLnNwbGl0KC8oLj8pKC4/KS8pLmxlbmd0aHx8Ii4iLnNwbGl0KC8oKSgpLykubGVuZ3RoPjF8fCIiLnNwbGl0KC8uPy8pLmxlbmd0aD9mdW5jdGlvbihlLG4pe3ZhciByPWVyKFYodGhpcykpLG89dm9pZCAwPT09bj9JdTpuPj4+MDtpZigwPT09bylyZXR1cm4gW107aWYodm9pZCAwPT09ZSlyZXR1cm4gW3JdO2lmKCFTcihlKSlyZXR1cm4gVGUodCxyLGUsbyk7Zm9yKHZhciBpLGEscyxsPVtdLHU9KGUuaWdub3JlQ2FzZT8iaSI6IiIpKyhlLm11bHRpbGluZT8ibSI6IiIpKyhlLnVuaWNvZGU/InUiOiIiKSsoZS5zdGlja3k/InkiOiIiKSxjPTAsZj1uZXcgUmVnRXhwKGUuc291cmNlLHUrImciKTsoaT1UZShnaSxmLHIpKSYmISgoYT1mLmxhc3RJbmRleCk+YyYmKEh1KGwsVnUocixjLGkuaW5kZXgpKSxpLmxlbmd0aD4xJiZpLmluZGV4PHIubGVuZ3RoJiZ3aSgkdSxsLGlhKGksMSkpLHM9aVswXS5sZW5ndGgsYz1hLGwubGVuZ3RoPj1vKSk7KWYubGFzdEluZGV4PT09aS5pbmRleCYmZi5sYXN0SW5kZXgrKztyZXR1cm4gYz09PXIubGVuZ3RoPyFzJiZXdShmLCIiKXx8SHUobCwiIik6SHUobCxWdShyLGMpKSxsLmxlbmd0aD5vP2lhKGwsMCxvKTpsfToiMCIuc3BsaXQodm9pZCAwLDApLmxlbmd0aD9mdW5jdGlvbihlLG4pe3JldHVybiB2b2lkIDA9PT1lJiYwPT09bj9bXTpUZSh0LHRoaXMsZSxuKX06dCxbZnVuY3Rpb24odCxuKXt2YXIgbz1WKHRoaXMpLGk9bnVsbD09dD92b2lkIDA6QWUodCxlKTtyZXR1cm4gaT9UZShpLHQsbyxuKTpUZShyLGVyKG8pLHQsbil9LGZ1bmN0aW9uKGUsbyl7dmFyIGk9T2UodGhpcyksYT1lcihlKSxzPW4ocixpLGEsbyxyIT09dCk7aWYocy5kb25lKXJldHVybiBzLnZhbHVlO3ZhciBsPXZsKGksUmVnRXhwKSx1PWkudW5pY29kZSxjPShpLmlnbm9yZUNhc2U/ImkiOiIiKSsoaS5tdWx0aWxpbmU/Im0iOiIiKSsoaS51bmljb2RlPyJ1IjoiIikrKEZ1PyJnIjoieSIpLGY9bmV3IGwoRnU/Il4oPzoiK2kuc291cmNlKyIpIjppLGMpLGQ9dm9pZCAwPT09bz9JdTpvPj4+MDtpZigwPT09ZClyZXR1cm4gW107aWYoMD09PWEubGVuZ3RoKXJldHVybiBudWxsPT09amkoZixhKT9bYV06W107Zm9yKHZhciBwPTAsaD0wLGc9W107aDxhLmxlbmd0aDspe2YubGFzdEluZGV4PUZ1PzA6aDt2YXIgdix5PWppKGYsRnU/VnUoYSxoKTphKTtpZihudWxsPT09eXx8KHY9QnUoRnQoZi5sYXN0SW5kZXgrKEZ1P2g6MCkpLGEubGVuZ3RoKSk9PT1wKWg9T2koYSxoLHUpO2Vsc2Uge2lmKEh1KGcsVnUoYSxwLGgpKSxnLmxlbmd0aD09PWQpcmV0dXJuIGc7Zm9yKHZhciBtPTE7bTw9eS5sZW5ndGgtMTttKyspaWYoSHUoZyx5W21dKSxnLmxlbmd0aD09PWQpcmV0dXJuIGc7aD1wPXY7fX1yZXR1cm4gSHUoZyxWdShhLHApKSxnfV19KSwhenUsRnUpO3ZhciBHdT1mdW5jdGlvbihlLHQpe3ZhciBuPSh0LnRvcCt0LmJvdHRvbSkvMjtyZXR1cm4gZS50b3A8PW4mJmUuYm90dG9tPj1ufSxKdT1mdW5jdGlvbihlLHQsbil7dmFyIHI9SHMudG9ET01SYW5nZShlLHQpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLG89SHMudG9ET01SYW5nZShlLG4pLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO3JldHVybiBHdShyLG8pJiZHdShvLHIpfSxZdT1bInNwYW4iLCJiIiwic3Ryb25nIiwiaSIsImVtIiwicyIsInN0cmlrZSIsInUiLCJmb250Iiwic3ViIiwic3VwIl0sWHU9W107dmFyIFF1PVtdO3ZhciBadT17fTt2YXIgZWM9VmUuZix0Yz1Tbi5mLG5jPWN0LmVuZm9yY2UscmM9aGUoIm1hdGNoIiksb2M9UC5SZWdFeHAsaWM9b2MucHJvdG90eXBlLGFjPVAuU3ludGF4RXJyb3Isc2M9Vyh0ciksbGM9VyhpYy5leGVjKSx1Yz1XKCIiLmNoYXJBdCksY2M9VygiIi5yZXBsYWNlKSxmYz1XKCIiLmluZGV4T2YpLGRjPVcoIiIuc2xpY2UpLHBjPS9eXD88W15cc1xkISMlJiorPD0+QF5dW15ccyEjJSYqKzw9PkBeXSo+LyxoYz0vYS9nLGdjPS9hL2csdmM9bmV3IG9jKGhjKSE9PWhjLHljPVpvLk1JU1NFRF9TVElDS1ksbWM9Wm8uVU5TVVBQT1JURURfWSxiYz15ZSYmKCF2Y3x8eWN8fHRpfHxyaXx8c2UoKGZ1bmN0aW9uKCl7cmV0dXJuIGdjW3JjXT0hMSxvYyhoYykhPWhjfHxvYyhnYyk9PWdjfHwiL2EvaSIhPW9jKGhjLCJpIil9KSkpO2lmKGpuKCJSZWdFeHAiLGJjKSl7Zm9yKHZhciB3Yz1mdW5jdGlvbihlLHQpe3ZhciBuLHIsbyxpLGEscyxsPU5lKGljLHRoaXMpLHU9U3IoZSksYz12b2lkIDA9PT10LGY9W10sZD1lO2lmKCFsJiZ1JiZjJiZlLmNvbnN0cnVjdG9yPT09d2MpcmV0dXJuIGU7aWYoKHV8fE5lKGljLGUpKSYmKGU9ZS5zb3VyY2UsYyYmKHQ9ImZsYWdzImluIGQ/ZC5mbGFnczpzYyhkKSkpLGU9dm9pZCAwPT09ZT8iIjplcihlKSx0PXZvaWQgMD09PXQ/IiI6ZXIodCksZD1lLHRpJiYiZG90QWxsImluIGhjJiYocj0hIXQmJmZjKHQsInMiKT4tMSkmJih0PWNjKHQsL3MvZywiIikpLG49dCx5YyYmInN0aWNreSJpbiBoYyYmKG89ISF0JiZmYyh0LCJ5Iik+LTEpJiZtYyYmKHQ9Y2ModCwveS9nLCIiKSkscmkmJihpPWZ1bmN0aW9uKGUpe2Zvcih2YXIgdCxuPWUubGVuZ3RoLHI9MCxvPSIiLGk9W10sYT17fSxzPSExLGw9ITEsdT0wLGM9IiI7cjw9bjtyKyspe2lmKCJcXCI9PT0odD11YyhlLHIpKSl0Kz11YyhlLCsrcik7ZWxzZSBpZigiXSI9PT10KXM9ITE7ZWxzZSBpZighcylzd2l0Y2goITApe2Nhc2UiWyI9PT10OnM9ITA7YnJlYWs7Y2FzZSIoIj09PXQ6bGMocGMsZGMoZSxyKzEpKSYmKHIrPTIsbD0hMCksbys9dCx1Kys7Y29udGludWU7Y2FzZSI+Ij09PXQmJmw6aWYoIiI9PT1jfHxxKGEsYykpdGhyb3cgbmV3IGFjKCJJbnZhbGlkIGNhcHR1cmUgZ3JvdXAgbmFtZSIpO2FbY109ITAsaVtpLmxlbmd0aF09W2MsdV0sbD0hMSxjPSIiO2NvbnRpbnVlfWw/Yys9dDpvKz10O31yZXR1cm4gW28saV19KGUpLGU9aVswXSxmPWlbMV0pLGE9d2Eob2MoZSx0KSxsP3RoaXM6aWMsd2MpLChyfHxvfHxmLmxlbmd0aCkmJihzPW5jKGEpLHImJihzLmRvdEFsbD0hMCxzLnJhdz13YyhmdW5jdGlvbihlKXtmb3IodmFyIHQsbj1lLmxlbmd0aCxyPTAsbz0iIixpPSExO3I8PW47cisrKSJcXCIhPT0odD11YyhlLHIpKT9pfHwiLiIhPT10PygiWyI9PT10P2k9ITA6Il0iPT09dCYmKGk9ITEpLG8rPXQpOm8rPSJbXFxzXFxTXSI6bys9dCt1YyhlLCsrcik7cmV0dXJuIG99KGUpLG4pKSxvJiYocy5zdGlja3k9ITApLGYubGVuZ3RoJiYocy5ncm91cHM9ZikpLGUhPT1kKXRyeXtVZShhLCJzb3VyY2UiLCIiPT09ZD8iKD86KSI6ZCk7fWNhdGNoKGUpe31yZXR1cm4gYX0seGM9ZnVuY3Rpb24oZSl7ZSBpbiB3Y3x8ZWMod2MsZSx7Y29uZmlndXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiBvY1tlXX0sc2V0OmZ1bmN0aW9uKHQpe29jW2VdPXQ7fX0pO30sRWM9dGMob2MpLFNjPTA7RWMubGVuZ3RoPlNjOyl4YyhFY1tTYysrXSk7aWMuY29uc3RydWN0b3I9d2Msd2MucHJvdG90eXBlPWljLGd0KFAsIlJlZ0V4cCIsd2MpO31wbCgiUmVnRXhwIik7dmFyIGtjPW5ldyBSZWdFeHAoU3RyaW5nLmZyb21DaGFyQ29kZSgxNjApLCJnIik7ZnVuY3Rpb24gT2MoZSl7cmV0dXJuIGUucmVwbGFjZShrYywiICIpfWZ1bmN0aW9uIENjKGUsbil7dmFyIHI9ZS5sZW5ndGg7aWYocil7dmFyIG89ZVtyLTFdO2lmKHQuVGV4dC5pc1RleHQobykpe3ZhciBpPU9iamVjdC5rZXlzKG8pO2lmKDE9PT1pLmxlbmd0aCYmInRleHQiPT09aVswXSlyZXR1cm4gby50ZXh0PW8udGV4dCtuLCEwfX1yZXR1cm4gITF9ZnVuY3Rpb24gVGMoZSx0LG4pe3JldHVybiB7dHlwZToicGFyYWdyYXBoIixjaGlsZHJlbjpbe3RleHQ6eS5kZWZhdWx0KGUpLnRleHQoKS5yZXBsYWNlKC9ccysvZ20sIiAiKX1dfX1mdW5jdGlvbiBOYyhlLG4pe3ZhciByPWZ1bmN0aW9uKGUsdCl7dmFyIG49W107aWYobnVsbCE9ZS5hdHRyKCJkYXRhLXctZS1pcy12b2lkIikpcmV0dXJuIG47dmFyIHI9ZVswXS5jaGlsZE5vZGVzO3JldHVybiAxPT09ci5sZW5ndGgmJiJCUiI9PT1yWzBdLm5vZGVOYW1lPyhuLnB1c2goe3RleHQ6IiJ9KSxuKTooci5mb3JFYWNoKChmdW5jdGlvbihlKXtpZihlLm5vZGVUeXBlIT09U3MuRUxFTUVOVF9OT0RFKWlmKGUubm9kZVR5cGUhPT1Tcy5URVhUX05PREUpO2Vsc2Uge3ZhciByPWUudGV4dENvbnRlbnR8fCIiO2lmKCIiPT09ci50cmltKCkmJnIuaW5kZXhPZigiXG4iKT49MClyZXR1cm47ciYmKHI9T2MociksQ2MobixyKXx8bi5wdXNoKHt0ZXh0OnJ9KSk7fWVsc2Uge2lmKCJCUiI9PT1lLm5vZGVOYW1lKXJldHVybiB2b2lkKENjKG4sIlxuIil8fG4ucHVzaCh7dGV4dDoiXG4ifSkpO3ZhciBvPUxjKHkuZGVmYXVsdChlKSx0KTtBcnJheS5pc0FycmF5KG8pP28uZm9yRWFjaCgoZnVuY3Rpb24oZSl7cmV0dXJuIG4ucHVzaChlKX0pKTpuLnB1c2gobyk7fX0pKSxuKX0oZSxuKSxvPWZ1bmN0aW9uKGUpe2Zvcih2YXIgdCBpbiBadSlpZihlWzBdLm1hdGNoZXModCkpcmV0dXJuIFp1W3RdO3JldHVybiBUY30oZSksaT1vKGVbMF0scixuKTtyZXR1cm4gQXJyYXkuaXNBcnJheShpKXx8KGk9W2ldKSxpLmZvckVhY2goKGZ1bmN0aW9uKG8pe3QuRWRpdG9yLmlzVm9pZChuLG8pfHwoMD09PXIubGVuZ3RoJiYoby5jaGlsZHJlbj1be3RleHQ6ZS50ZXh0KCkucmVwbGFjZSgvXHMrL2dtLCIgIil9XSksUXUuZm9yRWFjaCgoZnVuY3Rpb24odCl7bz10KGVbMF0sbyxuKTt9KSkpO30pKSxpfWZ1bmN0aW9uIE1jKGUsdCl7MD09PWUucGFyZW50cygicHJlIikubGVuZ3RoJiYoZVswXS5pbm5lckhUTUw9ZVswXS5pbm5lckhUTUwucmVwbGFjZSgvXHMrL2dtLCIgIikucmVwbGFjZSgvPGJyPi9nLCJcbiIpKTt2YXIgbj1lWzBdLnRleHRDb250ZW50fHwiIjtuPWZ1bmN0aW9uKGUpe3JldHVybiBlLnJlcGxhY2UoLyZuYnNwOy9nLCIgIikucmVwbGFjZSgvJmx0Oy9nLCI8IikucmVwbGFjZSgvJmd0Oy9nLCI+IikucmVwbGFjZSgvJnJlZzsvZywiwq4iKS5yZXBsYWNlKC8mY29weTsvZywiwqkiKS5yZXBsYWNlKC8mdHJhZGU7L2csIuKEoiIpLnJlcGxhY2UoLyZxdW90Oy9nLCciJyl9KG4pO3ZhciByPXt0ZXh0Om49T2Mobil9O3JldHVybiBRdS5mb3JFYWNoKChmdW5jdGlvbihuKXtyPW4oZVswXSxyLHQpO30pKSxyfWZ1bmN0aW9uIExjKGUsdCl7WHUuZm9yRWFjaCgoZnVuY3Rpb24odCl7dmFyIG49dC5zZWxlY3RvcixyPXQucHJlUGFyc2VIdG1sO2VbMF0ubWF0Y2hlcyhuKSYmKGU9eS5kZWZhdWx0KHIoZVswXSkpKTt9KSk7dmFyIG49anMoZSk7cmV0dXJuICJzcGFuIj09PW4/ZS5hdHRyKCJkYXRhLXctZS10eXBlIik/TmMoZSx0KTpNYyhlLHQpOiJjb2RlIj09PW4/InByZSI9PT1qcyhlLnBhcmVudCgpKT9OYyhlLHQpOk1jKGUsdCk6WXUuaW5jbHVkZXMobik/TWMoZSx0KTpOYyhlLHQpfWZ1bmN0aW9uIFBjKGUsdCxuKXt2YXIgcj15LmRlZmF1bHQobik7cmV0dXJuICEhci5hdHRyKHQpfHwoci5hdHRyKHQsInRydWUiKSxlLm9uKCJkZXN0cm95ZWQiLChmdW5jdGlvbigpe3IucmVtb3ZlQXR0cih0KTt9KSksITEpfWZ1bmN0aW9uIFJjKGUsdCl7dm9pZCAwPT09dCYmKHQ9IiIpO3ZhciBuPVtdOyIiPT09dCYmKHQ9IjxwPjxicj48L3A+IiksMCE9PXQuaW5kZXhPZigiPCIpJiYodD10LnNwbGl0KC9cbi8pLm1hcCgoZnVuY3Rpb24oZSl7cmV0dXJuICI8cD4iK2UrIjwvcD4ifSkpLmpvaW4oIiIpKTt2YXIgcj15LmRlZmF1bHQoIjxkaXY+Iit0KyI8L2Rpdj4iKTtyZXR1cm4gQXJyYXkuZnJvbShyLmNoaWxkcmVuKCkpLmZvckVhY2goKGZ1bmN0aW9uKHQpe3ZhciByPUxjKHkuZGVmYXVsdCh0KSxlKTtBcnJheS5pc0FycmF5KHIpP3IuZm9yRWFjaCgoZnVuY3Rpb24oZSl7cmV0dXJuIG4ucHVzaChlKX0pKTpuLnB1c2gocik7fSkpLG59dmFyIERjPVZlLmYsamM9cGEuZmFzdEtleSxBYz1jdC5zZXQsX2M9Y3QuZ2V0dGVyRm9yLEZjPXtnZXRDb25zdHJ1Y3RvcjpmdW5jdGlvbihlLHQsbixyKXt2YXIgbz1lKChmdW5jdGlvbihlLG8pe2JhKGUsaSksQWMoZSx7dHlwZTp0LGluZGV4OnlyKG51bGwpLGZpcnN0OnZvaWQgMCxsYXN0OnZvaWQgMCxzaXplOjB9KSx5ZXx8KGUuc2l6ZT0wKSxudWxsIT1vJiZ5YShvLGVbcl0se3RoYXQ6ZSxBU19FTlRSSUVTOm59KTt9KSksaT1vLnByb3RvdHlwZSxhPV9jKHQpLHM9ZnVuY3Rpb24oZSx0LG4pe3ZhciByLG8saT1hKGUpLHM9bChlLHQpO3JldHVybiBzP3MudmFsdWU9bjooaS5sYXN0PXM9e2luZGV4Om89amModCwhMCksa2V5OnQsdmFsdWU6bixwcmV2aW91czpyPWkubGFzdCxuZXh0OnZvaWQgMCxyZW1vdmVkOiExfSxpLmZpcnN0fHwoaS5maXJzdD1zKSxyJiYoci5uZXh0PXMpLHllP2kuc2l6ZSsrOmUuc2l6ZSsrLCJGIiE9PW8mJihpLmluZGV4W29dPXMpKSxlfSxsPWZ1bmN0aW9uKGUsdCl7dmFyIG4scj1hKGUpLG89amModCk7aWYoIkYiIT09bylyZXR1cm4gci5pbmRleFtvXTtmb3Iobj1yLmZpcnN0O247bj1uLm5leHQpaWYobi5rZXk9PXQpcmV0dXJuIG59O3JldHVybiBuYShpLHtjbGVhcjpmdW5jdGlvbigpe2Zvcih2YXIgZT1hKHRoaXMpLHQ9ZS5pbmRleCxuPWUuZmlyc3Q7bjspbi5yZW1vdmVkPSEwLG4ucHJldmlvdXMmJihuLnByZXZpb3VzPW4ucHJldmlvdXMubmV4dD12b2lkIDApLGRlbGV0ZSB0W24uaW5kZXhdLG49bi5uZXh0O2UuZmlyc3Q9ZS5sYXN0PXZvaWQgMCx5ZT9lLnNpemU9MDp0aGlzLnNpemU9MDt9LGRlbGV0ZTpmdW5jdGlvbihlKXt2YXIgdD10aGlzLG49YSh0KSxyPWwodCxlKTtpZihyKXt2YXIgbz1yLm5leHQsaT1yLnByZXZpb3VzO2RlbGV0ZSBuLmluZGV4W3IuaW5kZXhdLHIucmVtb3ZlZD0hMCxpJiYoaS5uZXh0PW8pLG8mJihvLnByZXZpb3VzPWkpLG4uZmlyc3Q9PXImJihuLmZpcnN0PW8pLG4ubGFzdD09ciYmKG4ubGFzdD1pKSx5ZT9uLnNpemUtLTp0LnNpemUtLTt9cmV0dXJuICEhcn0sZm9yRWFjaDpmdW5jdGlvbihlKXtmb3IodmFyIHQsbj1hKHRoaXMpLHI9TXQoZSxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCk7dD10P3QubmV4dDpuLmZpcnN0Oylmb3Iocih0LnZhbHVlLHQua2V5LHRoaXMpO3QmJnQucmVtb3ZlZDspdD10LnByZXZpb3VzO30saGFzOmZ1bmN0aW9uKGUpe3JldHVybiAhIWwodGhpcyxlKX19KSxuYShpLG4/e2dldDpmdW5jdGlvbihlKXt2YXIgdD1sKHRoaXMsZSk7cmV0dXJuIHQmJnQudmFsdWV9LHNldDpmdW5jdGlvbihlLHQpe3JldHVybiBzKHRoaXMsMD09PWU/MDplLHQpfX06e2FkZDpmdW5jdGlvbihlKXtyZXR1cm4gcyh0aGlzLGU9MD09PWU/MDplLGUpfX0pLHllJiZEYyhpLCJzaXplIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGEodGhpcykuc2l6ZX19KSxvfSxzZXRTdHJvbmc6ZnVuY3Rpb24oZSx0LG4pe3ZhciByPXQrIiBJdGVyYXRvciIsbz1fYyh0KSxpPV9jKHIpO1BvKGUsdCwoZnVuY3Rpb24oZSx0KXtBYyh0aGlzLHt0eXBlOnIsdGFyZ2V0OmUsc3RhdGU6byhlKSxraW5kOnQsbGFzdDp2b2lkIDB9KTt9KSwoZnVuY3Rpb24oKXtmb3IodmFyIGU9aSh0aGlzKSx0PWUua2luZCxuPWUubGFzdDtuJiZuLnJlbW92ZWQ7KW49bi5wcmV2aW91cztyZXR1cm4gZS50YXJnZXQmJihlLmxhc3Q9bj1uP24ubmV4dDplLnN0YXRlLmZpcnN0KT8ia2V5cyI9PXQ/e3ZhbHVlOm4ua2V5LGRvbmU6ITF9OiJ2YWx1ZXMiPT10P3t2YWx1ZTpuLnZhbHVlLGRvbmU6ITF9Ont2YWx1ZTpbbi5rZXksbi52YWx1ZV0sZG9uZTohMX06KGUudGFyZ2V0PXZvaWQgMCx7dmFsdWU6dm9pZCAwLGRvbmU6ITB9KX0pLG4/ImVudHJpZXMiOiJ2YWx1ZXMiLCFuLCEwKSxwbCh0KTt9fTt4YSgiU2V0IiwoZnVuY3Rpb24oZSl7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIGUodGhpcyxhcmd1bWVudHMubGVuZ3RoP2FyZ3VtZW50c1swXTp2b2lkIDApfX0pLEZjKTt2YXIgSWM9bmV3IFNldChbImRvY3R5cGUiLCIhZG9jdHlwZSIsIm1ldGEiLCJzY3JpcHQiLCJzdHlsZSIsImxpbmsiLCJmcmFtZSIsImlmcmFtZSIsInRpdGxlIiwic3ZnIl0pO2Z1bmN0aW9uIEJjKGUsbil7ZS5pc0lubGluZShuKT8oZS5pbnNlcnROb2RlKG4pLCJsaW5rIj09PW4udHlwZSYmZS5pbnNlcnRGcmFnbWVudChbe3RleHQ6IiJ9XSkpOnQuVHJhbnNmb3Jtcy5pbnNlcnROb2RlcyhlLG4se21vZGU6ImhpZ2hlc3QifSk7fXZhciAkYz1mdW5jdGlvbihlKXt2YXIgbj1lLHI9bi5vbkNoYW5nZSxvPW4uaW5zZXJ0VGV4dCxpPW4uYXBwbHksYT1uLmRlbGV0ZUJhY2t3YXJkO3JldHVybiBuLmluc2VydFRleHQ9ZnVuY3Rpb24oZSl7bi5nZXRDb25maWcoKS5yZWFkT25seXx8byhlKTt9LG4uYXBwbHk9ZnVuY3Rpb24oZSl7dmFyIHIsbyxhLHMsbCx1LGMsZixkPVtdO3N3aXRjaChlLnR5cGUpe2Nhc2UiaW5zZXJ0X3RleHQiOmNhc2UicmVtb3ZlX3RleHQiOmNhc2Uic2V0X25vZGUiOnRyeXtmb3IodmFyIHA9cWkodC5FZGl0b3IubGV2ZWxzKG4se2F0OmUucGF0aH0pKSxoPXAubmV4dCgpOyFoLmRvbmU7aD1wLm5leHQoKSl7dmFyIGc9R2koaC52YWx1ZSwyKSx2PWdbMF0seT1nWzFdLG09SHMuZmluZEtleShuLHYpO2QucHVzaChbeSxtXSk7fX1jYXRjaChlKXtyPXtlcnJvcjplfTt9ZmluYWxseXt0cnl7aCYmIWguZG9uZSYmKG89cC5yZXR1cm4pJiZvLmNhbGwocCk7fWZpbmFsbHl7aWYocil0aHJvdyByLmVycm9yfX1icmVhaztjYXNlImluc2VydF9ub2RlIjpjYXNlInJlbW92ZV9ub2RlIjpjYXNlIm1lcmdlX25vZGUiOmNhc2Uic3BsaXRfbm9kZSI6dHJ5e2Zvcih2YXIgYj1xaSh0LkVkaXRvci5sZXZlbHMobix7YXQ6dC5QYXRoLnBhcmVudChlLnBhdGgpfSkpLHc9Yi5uZXh0KCk7IXcuZG9uZTt3PWIubmV4dCgpKXt2YXIgeD1HaSh3LnZhbHVlLDIpO3Y9eFswXSx5PXhbMV0sbT1Icy5maW5kS2V5KG4sdik7ZC5wdXNoKFt5LG1dKTt9fWNhdGNoKGUpe2E9e2Vycm9yOmV9O31maW5hbGx5e3RyeXt3JiYhdy5kb25lJiYocz1iLnJldHVybikmJnMuY2FsbChiKTt9ZmluYWxseXtpZihhKXRocm93IGEuZXJyb3J9fWJyZWFrO2Nhc2UibW92ZV9ub2RlIjp0cnl7Zm9yKHZhciBFPXFpKHQuRWRpdG9yLmxldmVscyhuLHthdDp0LlBhdGguY29tbW9uKHQuUGF0aC5wYXJlbnQoZS5wYXRoKSx0LlBhdGgucGFyZW50KGUubmV3UGF0aCkpfSkpLFM9RS5uZXh0KCk7IVMuZG9uZTtTPUUubmV4dCgpKXt2YXIgaz1HaShTLnZhbHVlLDIpO3Y9a1swXSx5PWtbMV0sbT1Icy5maW5kS2V5KG4sdik7ZC5wdXNoKFt5LG1dKTt9fWNhdGNoKGUpe2w9e2Vycm9yOmV9O31maW5hbGx5e3RyeXtTJiYhUy5kb25lJiYodT1FLnJldHVybikmJnUuY2FsbChFKTt9ZmluYWxseXtpZihsKXRocm93IGwuZXJyb3J9fX1pKGUpO3RyeXtmb3IodmFyIE89cWkoZCksQz1PLm5leHQoKTshQy5kb25lO0M9Ty5uZXh0KCkpe3ZhciBUPUdpKEMudmFsdWUsMik7eT1UWzBdLG09VFsxXSx2PUdpKHQuRWRpdG9yLm5vZGUobix5KSwxKVswXTtwcy5zZXQodixtKTt9fWNhdGNoKGUpe2M9e2Vycm9yOmV9O31maW5hbGx5e3RyeXtDJiYhQy5kb25lJiYoZj1PLnJldHVybikmJmYuY2FsbChPKTt9ZmluYWxseXtpZihjKXRocm93IGMuZXJyb3J9fX0sbi5kZWxldGVCYWNrd2FyZD1mdW5jdGlvbihyKXtpZigibGluZSIhPT1yKXJldHVybiBhKHIpO2lmKGUuc2VsZWN0aW9uJiZ0LlJhbmdlLmlzQ29sbGFwc2VkKGUuc2VsZWN0aW9uKSl7dmFyIG89dC5FZGl0b3IuYWJvdmUoZSx7bWF0Y2g6ZnVuY3Rpb24obil7cmV0dXJuIHQuRWRpdG9yLmlzQmxvY2soZSxuKX0sYXQ6ZS5zZWxlY3Rpb259KTtpZihvKXt2YXIgaT1HaShvLDIpWzFdLHM9dC5FZGl0b3IucmFuZ2UoZSxpLGUuc2VsZWN0aW9uLmFuY2hvciksbD1mdW5jdGlvbihlLG4pe3ZhciByPXQuRWRpdG9yLnJhbmdlKGUsdC5SYW5nZS5lbmQobikpLG89QXJyYXkuZnJvbSh0LkVkaXRvci5wb3NpdGlvbnMoZSx7YXQ6bn0pKSxpPTAsYT1vLmxlbmd0aCxzPU1hdGguZmxvb3IoYS8yKTtpZihKdShlLHQuRWRpdG9yLnJhbmdlKGUsb1tpXSkscikpcmV0dXJuIHQuRWRpdG9yLnJhbmdlKGUsb1tpXSxyKTtpZihvLmxlbmd0aDwyKXJldHVybiB0LkVkaXRvci5yYW5nZShlLG9bby5sZW5ndGgtMV0scik7Zm9yKDtzIT09by5sZW5ndGgmJnMhPT1pOylKdShlLHQuRWRpdG9yLnJhbmdlKGUsb1tzXSkscik/YT1zOmk9cyxzPU1hdGguZmxvb3IoKGkrYSkvMik7cmV0dXJuIHQuRWRpdG9yLnJhbmdlKGUsb1thXSxyKX0obixzKTt0LlJhbmdlLmlzQ29sbGFwc2VkKGwpfHx0LlRyYW5zZm9ybXMuZGVsZXRlKGUse2F0Omx9KTt9fX0sbi5vbkNoYW5nZT1mdW5jdGlvbigpe3ZhciBlPW4uc2VsZWN0aW9uO251bGwhPWUmJnZzLnNldChuLGUpLG4uZW1pdCgiY2hhbmdlIikscigpO30sbi5oYW5kbGVUYWI9ZnVuY3Rpb24oKXtuLmluc2VydFRleHQoIiAgICAiKTt9LG4uZ2V0SHRtbD1mdW5jdGlvbigpe3ZhciBlPW4uY2hpbGRyZW47cmV0dXJuICh2b2lkIDA9PT1lP1tdOmUpLm1hcCgoZnVuY3Rpb24oZSl7cmV0dXJuIEt1KGUsbil9KSkuam9pbigiIil9LG4uZ2V0VGV4dD1mdW5jdGlvbigpe3ZhciBlPW4uY2hpbGRyZW47cmV0dXJuICh2b2lkIDA9PT1lP1tdOmUpLm1hcCgoZnVuY3Rpb24oZSl7cmV0dXJuIHQuTm9kZS5zdHJpbmcoZSl9KSkuam9pbigiXG4iKX0sbi5nZXRTZWxlY3Rpb25UZXh0PWZ1bmN0aW9uKCl7dmFyIHI9bi5zZWxlY3Rpb247cmV0dXJuIG51bGw9PXI/IiI6dC5FZGl0b3Iuc3RyaW5nKGUscil9LG4uZ2V0RWxlbXNCeVR5cGU9ZnVuY3Rpb24oZSxyKXt2YXIgbyxpO3ZvaWQgMD09PXImJihyPSExKTt2YXIgYT1bXSxzPXQuRWRpdG9yLm5vZGVzKG4se2F0OltdLHVuaXZlcnNhbDohMH0pO3RyeXtmb3IodmFyIGw9cWkocyksdT1sLm5leHQoKTshdS5kb25lO3U9bC5uZXh0KCkpe3ZhciBjPUdpKHUudmFsdWUsMSlbMF07aWYodC5FbGVtZW50LmlzRWxlbWVudChjKSlpZihyP2MudHlwZS5pbmRleE9mKGUpPj0wOmMudHlwZT09PWUpe3ZhciBmPXF1KEhzLmZpbmRLZXkobixjKS5pZCk7YS5wdXNoKEtpKEtpKHt9LGMpLHtpZDpmfSkpO319fWNhdGNoKGUpe289e2Vycm9yOmV9O31maW5hbGx5e3RyeXt1JiYhdS5kb25lJiYoaT1sLnJldHVybikmJmkuY2FsbChsKTt9ZmluYWxseXtpZihvKXRocm93IG8uZXJyb3J9fXJldHVybiBhfSxuLmdldEVsZW1zQnlUeXBlUHJlZml4PWZ1bmN0aW9uKGUpe3JldHVybiBuLmdldEVsZW1zQnlUeXBlKGUsITApfSxuLmlzRW1wdHk9ZnVuY3Rpb24oKXt2YXIgZT1uLmNoaWxkcmVuLHI9dm9pZCAwPT09ZT9bXTplO2lmKHIubGVuZ3RoPjEpcmV0dXJuICExO3ZhciBvPXJbMF07aWYobnVsbD09bylyZXR1cm4gITA7aWYodC5FbGVtZW50LmlzRWxlbWVudChvKSYmInBhcmFncmFwaCI9PT1vLnR5cGUpe3ZhciBpPW8uY2hpbGRyZW4sYT12b2lkIDA9PT1pP1tdOmk7aWYoYS5sZW5ndGg+MSlyZXR1cm4gITE7dmFyIHM9YVswXTtpZihudWxsPT1zKXJldHVybiAhMDtpZih0LlRleHQuaXNUZXh0KHMpJiYiIj09PXMudGV4dClyZXR1cm4gITB9cmV0dXJuICExfSxuLmNsZWFyPWZ1bmN0aW9uKCl7dC5UcmFuc2Zvcm1zLmRlbGV0ZShuLHthdDp7YW5jaG9yOnQuRWRpdG9yLnN0YXJ0KG4sW10pLGZvY3VzOnQuRWRpdG9yLmVuZChuLFtdKX19KSwwPT09bi5jaGlsZHJlbi5sZW5ndGgmJnQuVHJhbnNmb3Jtcy5pbnNlcnROb2RlcyhuLFt7dHlwZToicGFyYWdyYXBoIixjaGlsZHJlbjpbe3RleHQ6IiJ9XX1dKTt9LG4uZ2V0UGFyZW50Tm9kZT1mdW5jdGlvbihlKXtyZXR1cm4gSHMuZ2V0UGFyZW50Tm9kZShuLGUpfSxuLmRhbmdlcm91c2x5SW5zZXJ0SHRtbD1mdW5jdGlvbihlLHIpe2lmKHZvaWQgMD09PWUmJihlPSIiKSx2b2lkIDA9PT1yJiYocj0hMSksZSl7dmFyIG89ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7by5pbm5lckhUTUw9ZTt2YXIgaT1BcnJheS5mcm9tKG8uY2hpbGROb2Rlcyk7aWYoaT1pLmZpbHRlcigoZnVuY3Rpb24oZSl7dmFyIHQ9ZS5ub2RlVHlwZSxuPWUubm9kZU5hbWU7cmV0dXJuIHQ9PT1Tcy5URVhUX05PREV8fHQ9PT1Tcy5FTEVNRU5UX05PREUmJiFJYy5oYXMobi50b0xvd2VyQ2FzZSgpKX0pKSwwIT09aS5sZW5ndGgpe3ZhciBhPW4uc2VsZWN0aW9uO2lmKG51bGwhPWEpe3ZhciBzPW51bGw7aWYoSHMuaXNTZWxlY3RlZEVtcHR5UGFyYWdyYXBoKG4pJiYhcilzPVthLmZvY3VzLnBhdGhbMF1dO28uc2V0QXR0cmlidXRlKCJoaWRkZW4iLCJ0cnVlIiksZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChvKTt2YXIgbD0wO2kuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dmFyIHQ9ZS5ub2RlVHlwZSxyPWUubm9kZU5hbWUsbz1lLnRleHRDb250ZW50LGk9dm9pZCAwPT09bz8iIjpvO2lmKHQhPT1Tcy5URVhUX05PREUpaWYoIkJSIiE9PXIpe3ZhciBhPWUscz0hMTtpZihZdS5pbmNsdWRlcyhyLnRvTG93ZXJDYXNlKCkpKXM9ITA7ZWxzZSBmb3IodmFyIHUgaW4gWnUpaWYoYS5tYXRjaGVzKHUpKXtzPSEwO2JyZWFrfWlmKHMpe3ZhciBjPUxjKHkuZGVmYXVsdChhKSxuKTtyZXR1cm4gQXJyYXkuaXNBcnJheShjKT8oYy5mb3JFYWNoKChmdW5jdGlvbihlKXtyZXR1cm4gQmMobixlKX0pKSxsKyspOihCYyhuLGMpLGwrKyksdm9pZChIcy5pc1NlbGVjdGVkVm9pZE5vZGUobikmJm4ubW92ZSgxKSl9dmFyIGY9d2luZG93LmdldENvbXB1dGVkU3R5bGUoYSkuZGlzcGxheTtIcy5pc1NlbGVjdGVkRW1wdHlQYXJhZ3JhcGgobil8fGYuaW5kZXhPZigiaW5saW5lIik8MCYmbi5pbnNlcnRCcmVhaygpLG4uZGFuZ2Vyb3VzbHlJbnNlcnRIdG1sKGEuaW5uZXJIVE1MLCEwKTt9ZWxzZSBuLmluc2VydFRleHQoIlxuIik7ZWxzZSB7aWYoIWl8fCFpLnRyaW0oKSlyZXR1cm47bi5pbnNlcnROb2RlKHt0ZXh0Oml9KTt9fSkpLGwmJnMmJkhzLmlzRW1wdHlQYXRoKG4scykmJnQuVHJhbnNmb3Jtcy5yZW1vdmVOb2RlcyhuLHthdDpzfSksby5yZW1vdmUoKTt9fX19LG4uc2V0SHRtbD1mdW5jdGlvbihlKXt2b2lkIDA9PT1lJiYoZT0iIik7dmFyIHI9bi5pc0Rpc2FibGVkKCksbz1uLmlzRm9jdXNlZCgpLGk9SlNPTi5zdHJpbmdpZnkobi5zZWxlY3Rpb24pO24uZW5hYmxlKCksbi5mb2N1cygpLG4uY2xlYXIoKTt2YXIgYT1SYyhuLGUpO2lmKHQuVHJhbnNmb3Jtcy5pbnNlcnRGcmFnbWVudChuLGEpLG98fChuLmRlc2VsZWN0KCksbi5ibHVyKCkpLHImJihuLmRlc2VsZWN0KCksbi5kaXNhYmxlKCkpLG4uaXNGb2N1c2VkKCkpdHJ5e24uc2VsZWN0KEpTT04ucGFyc2UoaSkpO31jYXRjaChlKXtuLnNlbGVjdCh0LkVkaXRvci5zdGFydChuLFtdKSk7fX0sbn0sV2M9ZnVuY3Rpb24oZSl7dmFyIG49ZSxyPW4uaW5zZXJ0VGV4dDtyZXR1cm4gbi5pbnNlcnRGcmFnbWVudCxuLnNldEZyYWdtZW50RGF0YT1mdW5jdGlvbihlKXt2YXIgcj1uLnNlbGVjdGlvbjtpZihyKXt2YXIgbz1HaSh0LlJhbmdlLmVkZ2VzKHIpLDIpLGk9b1swXSxhPW9bMV0scz10LkVkaXRvci52b2lkKG4se2F0OmkucGF0aH0pLGw9dC5FZGl0b3Iudm9pZChuLHthdDphLnBhdGh9KTtpZighdC5SYW5nZS5pc0NvbGxhcHNlZChyKXx8cyl7dmFyIHU9SHMudG9ET01SYW5nZShuLHIpLGM9dS5jbG9uZUNvbnRlbnRzKCksZj1jLmNoaWxkTm9kZXNbMF07aWYoYy5jaGlsZE5vZGVzLmZvckVhY2goKGZ1bmN0aW9uKGUpe2UudGV4dENvbnRlbnQmJiIiIT09ZS50ZXh0Q29udGVudC50cmltKCkmJihmPWUpO30pKSxsKXt2YXIgZD1HaShsLDEpWzBdLHA9dS5jbG9uZVJhbmdlKCksaD1Icy50b0RPTU5vZGUobixkKTtwLnNldEVuZEFmdGVyKGgpLGM9cC5jbG9uZUNvbnRlbnRzKCk7fWlmKHMmJihmPWMucXVlcnlTZWxlY3RvcigiW2RhdGEtc2xhdGUtc3BhY2VyXSIpKSxBcnJheS5mcm9tKGMucXVlcnlTZWxlY3RvckFsbCgiW2RhdGEtc2xhdGUtemVyby13aWR0aF0iKSkuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dmFyIHQ9Im4iPT09ZS5nZXRBdHRyaWJ1dGUoImRhdGEtc2xhdGUtemVyby13aWR0aCIpO2UudGV4dENvbnRlbnQ9dD8iXG4iOiIiO30pKSxOcyhmKSl7dmFyIGc9Zi5vd25lckRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTtnLnN0eWxlLndoaXRlU3BhY2U9InByZSIsZy5hcHBlbmRDaGlsZChmKSxjLmFwcGVuZENoaWxkKGcpLGY9Zzt9dmFyIHY9bi5nZXRGcmFnbWVudCgpLHk9SlNPTi5zdHJpbmdpZnkodiksbT13aW5kb3cuYnRvYShlbmNvZGVVUklDb21wb25lbnQoeSkpO2Yuc2V0QXR0cmlidXRlKCJkYXRhLXNsYXRlLWZyYWdtZW50IixtKSxlLnNldERhdGEoImFwcGxpY2F0aW9uL3gtc2xhdGUtZnJhZ21lbnQiLG0pO3ZhciBiPWMub3duZXJEb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTtyZXR1cm4gYi5hcHBlbmRDaGlsZChjKSxiLnNldEF0dHJpYnV0ZSgiaGlkZGVuIiwidHJ1ZSIpLGMub3duZXJEb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGIpLGUuc2V0RGF0YSgidGV4dC9odG1sIixiLmlubmVySFRNTCksZS5zZXREYXRhKCJ0ZXh0L3BsYWluIixScyhiKSksYy5vd25lckRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoYiksZX19fSxuLmluc2VydERhdGE9ZnVuY3Rpb24oZSl7dmFyIG8saSxhPWUuZ2V0RGF0YSgiYXBwbGljYXRpb24veC1zbGF0ZS1mcmFnbWVudCIpO2lmKGEpe3ZhciBzPWRlY29kZVVSSUNvbXBvbmVudCh3aW5kb3cuYXRvYihhKSksbD1KU09OLnBhcnNlKHMpO24uaW5zZXJ0RnJhZ21lbnQobCk7fWVsc2Uge3ZhciB1PWUuZ2V0RGF0YSgidGV4dC9wbGFpbiIpLGM9ZS5nZXREYXRhKCJ0ZXh0L2h0bWwiKTtpZihjKW4uZGFuZ2Vyb3VzbHlJbnNlcnRIdG1sKGMpO2Vsc2UgaWYodSl7dmFyIGY9dS5zcGxpdCgvXHJcbnxccnxcbi8pLGQ9ITE7dHJ5e2Zvcih2YXIgcD1xaShmKSxoPXAubmV4dCgpOyFoLmRvbmU7aD1wLm5leHQoKSl7dmFyIGc9aC52YWx1ZTtkJiZ0LlRyYW5zZm9ybXMuc3BsaXROb2RlcyhuLHthbHdheXM6ITB9KSxyKGcpLGQ9ITA7fX1jYXRjaChlKXtvPXtlcnJvcjplfTt9ZmluYWxseXt0cnl7aCYmIWguZG9uZSYmKGk9cC5yZXR1cm4pJiZpLmNhbGwocCk7fWZpbmFsbHl7aWYobyl0aHJvdyBvLmVycm9yfX19ZWxzZTt9fSxufSxIYz1mdW5jdGlvbihlKXtyZXR1cm4gbnVsbCE9ZX0sVmM9e29iamVjdDohMCxmdW5jdGlvbjohMCx1bmRlZmluZWQ6ITB9LHpjPWZ1bmN0aW9uKGUpe2lmKCFmdW5jdGlvbihlKXtyZXR1cm4gISFIYyhlKSYmaGFzT3duUHJvcGVydHkuY2FsbChWYyx0eXBlb2YgZSl9KGUpKXJldHVybiAhMTt0cnl7cmV0dXJuICEhZS5jb25zdHJ1Y3RvciYmZS5jb25zdHJ1Y3Rvci5wcm90b3R5cGU9PT1lfWNhdGNoKGUpe3JldHVybiAhMX19LFVjPS9eXHMqY2xhc3NbXHN7L31dLyxLYz1GdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcscWM9ZnVuY3Rpb24oZSl7cmV0dXJuICEhZnVuY3Rpb24oZSl7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIGUpcmV0dXJuICExO2lmKCFoYXNPd25Qcm9wZXJ0eS5jYWxsKGUsImxlbmd0aCIpKXJldHVybiAhMTt0cnl7aWYoIm51bWJlciIhPXR5cGVvZiBlLmxlbmd0aClyZXR1cm4gITE7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIGUuY2FsbClyZXR1cm4gITE7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIGUuYXBwbHkpcmV0dXJuICExfWNhdGNoKGUpe3JldHVybiAhMX1yZXR1cm4gIXpjKGUpfShlKSYmIVVjLnRlc3QoS2MuY2FsbChlKSl9LEdjPWZ1bmN0aW9uKGUpe3JldHVybiBudWxsIT1lfSxKYz1PYmplY3Qua2V5cyxZYz1mdW5jdGlvbigpe3RyeXtyZXR1cm4gT2JqZWN0LmtleXMoInByaW1pdGl2ZSIpLCEwfWNhdGNoKGUpe3JldHVybiAhMX19KCk/T2JqZWN0LmtleXM6ZnVuY3Rpb24oZSl7cmV0dXJuIEpjKEdjKGUpP09iamVjdChlKTplKX0sWGM9ZnVuY3Rpb24oZSl7aWYoIUdjKGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCB1c2UgbnVsbCBvciB1bmRlZmluZWQiKTtyZXR1cm4gZX0sUWM9TWF0aC5tYXgsWmM9ZnVuY3Rpb24oKXt2YXIgZSx0PU9iamVjdC5hc3NpZ247cmV0dXJuICJmdW5jdGlvbiI9PXR5cGVvZiB0JiYodChlPXtmb286InJheiJ9LHtiYXI6ImR3YSJ9LHt0cnp5OiJ0cnp5In0pLGUuZm9vK2UuYmFyK2UudHJ6eT09PSJyYXpkd2F0cnp5Iil9KCk/T2JqZWN0LmFzc2lnbjpmdW5jdGlvbihlLHQpe3ZhciBuLHIsbyxpPVFjKGFyZ3VtZW50cy5sZW5ndGgsMik7Zm9yKGU9T2JqZWN0KFhjKGUpKSxvPWZ1bmN0aW9uKHIpe3RyeXtlW3JdPXRbcl07fWNhdGNoKGUpe258fChuPWUpO319LHI9MTtyPGk7KytyKVljKHQ9YXJndW1lbnRzW3JdKS5mb3JFYWNoKG8pO2lmKHZvaWQgMCE9PW4pdGhyb3cgbjtyZXR1cm4gZX0sZWY9QXJyYXkucHJvdG90eXBlLmZvckVhY2gsdGY9T2JqZWN0LmNyZWF0ZSxuZj1mdW5jdGlvbihlLHQpe3ZhciBuO2ZvcihuIGluIGUpdFtuXT1lW25dO30scmY9ZnVuY3Rpb24oZSl7dmFyIHQ9dGYobnVsbCk7cmV0dXJuIGVmLmNhbGwoYXJndW1lbnRzLChmdW5jdGlvbihlKXtHYyhlKSYmbmYoT2JqZWN0KGUpLHQpO30pKSx0fSxvZj0icmF6ZHdhdHJ6eSIsYWY9U3RyaW5nLnByb3RvdHlwZS5pbmRleE9mLHNmPSJmdW5jdGlvbiI9PXR5cGVvZiBvZi5jb250YWlucyYmITA9PT1vZi5jb250YWlucygiZHdhIikmJiExPT09b2YuY29udGFpbnMoImZvbyIpP1N0cmluZy5wcm90b3R5cGUuY29udGFpbnM6ZnVuY3Rpb24oZSl7cmV0dXJuIGFmLmNhbGwodGhpcyxlLGFyZ3VtZW50c1sxXSk+LTF9LGxmPVQoKGZ1bmN0aW9uKGUpe3ZhciB0PWUuZXhwb3J0cz1mdW5jdGlvbihlLHQpe3ZhciBuLHIsbyxpLGE7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8Mnx8InN0cmluZyIhPXR5cGVvZiBlPyhpPXQsdD1lLGU9bnVsbCk6aT1hcmd1bWVudHNbMl0sSGMoZSk/KG49c2YuY2FsbChlLCJjIikscj1zZi5jYWxsKGUsImUiKSxvPXNmLmNhbGwoZSwidyIpKToobj1vPSEwLHI9ITEpLGE9e3ZhbHVlOnQsY29uZmlndXJhYmxlOm4sZW51bWVyYWJsZTpyLHdyaXRhYmxlOm99LGk/WmMocmYoaSksYSk6YX07dC5ncz1mdW5jdGlvbihlLHQsbil7dmFyIHIsbyxpLGE7cmV0dXJuICJzdHJpbmciIT10eXBlb2YgZT8oaT1uLG49dCx0PWUsZT1udWxsKTppPWFyZ3VtZW50c1szXSxIYyh0KT9xYyh0KT9IYyhuKT9xYyhuKXx8KGk9bixuPXZvaWQgMCk6bj12b2lkIDA6KGk9dCx0PW49dm9pZCAwKTp0PXZvaWQgMCxIYyhlKT8ocj1zZi5jYWxsKGUsImMiKSxvPXNmLmNhbGwoZSwiZSIpKToocj0hMCxvPSExKSxhPXtnZXQ6dCxzZXQ6bixjb25maWd1cmFibGU6cixlbnVtZXJhYmxlOm99LGk/WmMocmYoaSksYSk6YX07fSkpLHVmPWZ1bmN0aW9uKGUpe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiBlKXRocm93IG5ldyBUeXBlRXJyb3IoZSsiIGlzIG5vdCBhIGZ1bmN0aW9uIik7cmV0dXJuIGV9LGNmPVQoKGZ1bmN0aW9uKGUsdCl7dmFyIG4scixvLGksYSxzLGwsdT1GdW5jdGlvbi5wcm90b3R5cGUuYXBwbHksYz1GdW5jdGlvbi5wcm90b3R5cGUuY2FsbCxmPU9iamVjdC5jcmVhdGUsZD1PYmplY3QuZGVmaW5lUHJvcGVydHkscD1PYmplY3QuZGVmaW5lUHJvcGVydGllcyxoPU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksZz17Y29uZmlndXJhYmxlOiEwLGVudW1lcmFibGU6ITEsd3JpdGFibGU6ITB9O249ZnVuY3Rpb24oZSx0KXt2YXIgbjtyZXR1cm4gdWYodCksaC5jYWxsKHRoaXMsIl9fZWVfXyIpP249dGhpcy5fX2VlX186KG49Zy52YWx1ZT1mKG51bGwpLGQodGhpcywiX19lZV9fIixnKSxnLnZhbHVlPW51bGwpLG5bZV0/Im9iamVjdCI9PXR5cGVvZiBuW2VdP25bZV0ucHVzaCh0KTpuW2VdPVtuW2VdLHRdOm5bZV09dCx0aGlzfSxyPWZ1bmN0aW9uKGUsdCl7dmFyIHIsaTtyZXR1cm4gdWYodCksaT10aGlzLG4uY2FsbCh0aGlzLGUscj1mdW5jdGlvbigpe28uY2FsbChpLGUsciksdS5jYWxsKHQsdGhpcyxhcmd1bWVudHMpO30pLHIuX19lZU9uY2VMaXN0ZW5lcl9fPXQsdGhpc30sbz1mdW5jdGlvbihlLHQpe3ZhciBuLHIsbyxpO2lmKHVmKHQpLCFoLmNhbGwodGhpcywiX19lZV9fIikpcmV0dXJuIHRoaXM7aWYoIShuPXRoaXMuX19lZV9fKVtlXSlyZXR1cm4gdGhpcztpZigib2JqZWN0Ij09dHlwZW9mKHI9bltlXSkpZm9yKGk9MDtvPXJbaV07KytpKW8hPT10JiZvLl9fZWVPbmNlTGlzdGVuZXJfXyE9PXR8fCgyPT09ci5sZW5ndGg/bltlXT1yW2k/MDoxXTpyLnNwbGljZShpLDEpKTtlbHNlIHIhPT10JiZyLl9fZWVPbmNlTGlzdGVuZXJfXyE9PXR8fGRlbGV0ZSBuW2VdO3JldHVybiB0aGlzfSxpPWZ1bmN0aW9uKGUpe3ZhciB0LG4scixvLGk7aWYoaC5jYWxsKHRoaXMsIl9fZWVfXyIpJiYobz10aGlzLl9fZWVfX1tlXSkpaWYoIm9iamVjdCI9PXR5cGVvZiBvKXtmb3Iobj1hcmd1bWVudHMubGVuZ3RoLGk9bmV3IEFycmF5KG4tMSksdD0xO3Q8bjsrK3QpaVt0LTFdPWFyZ3VtZW50c1t0XTtmb3Iobz1vLnNsaWNlKCksdD0wO3I9b1t0XTsrK3QpdS5jYWxsKHIsdGhpcyxpKTt9ZWxzZSBzd2l0Y2goYXJndW1lbnRzLmxlbmd0aCl7Y2FzZSAxOmMuY2FsbChvLHRoaXMpO2JyZWFrO2Nhc2UgMjpjLmNhbGwobyx0aGlzLGFyZ3VtZW50c1sxXSk7YnJlYWs7Y2FzZSAzOmMuY2FsbChvLHRoaXMsYXJndW1lbnRzWzFdLGFyZ3VtZW50c1syXSk7YnJlYWs7ZGVmYXVsdDpmb3Iobj1hcmd1bWVudHMubGVuZ3RoLGk9bmV3IEFycmF5KG4tMSksdD0xO3Q8bjsrK3QpaVt0LTFdPWFyZ3VtZW50c1t0XTt1LmNhbGwobyx0aGlzLGkpO319LGE9e29uOm4sb25jZTpyLG9mZjpvLGVtaXQ6aX0scz17b246bGYobiksb25jZTpsZihyKSxvZmY6bGYobyksZW1pdDpsZihpKX0sbD1wKHt9LHMpLGUuZXhwb3J0cz10PWZ1bmN0aW9uKGUpe3JldHVybiBudWxsPT1lP2YobCk6cChPYmplY3QoZSkscyl9LHQubWV0aG9kcz1hO30pKTtmdW5jdGlvbiBmZihlKXt2YXIgdD15cy5nZXQoZSk7cmV0dXJuIG51bGw9PXQmJih0PWNmKCkseXMuc2V0KGUsdCkpLHR9dmFyIGRmPW5ldyBXZWFrTWFwO2Z1bmN0aW9uIHBmKGUsdCl7dmFyIG49ZGYuZ2V0KGUpO251bGw9PW4mJihuPW5ldyBTZXQsZGYuc2V0KGUsbikpLG4uYWRkKHQpO31mdW5jdGlvbiBoZihlKXtyZXR1cm4gZGYuZ2V0KGUpfHxuZXcgU2V0fWZ1bmN0aW9uIGdmKGUpe2RmLnNldChlLG5ldyBTZXQpO31mdW5jdGlvbiB2ZihlKXt2YXIgdD1Icy5nZXRUZXh0YXJlYShlKS4kdGV4dEFyZWFDb250YWluZXIsbj10LndpZHRoKCkscj10LmhlaWdodCgpLG89dC5vZmZzZXQoKTtyZXR1cm4ge3RvcDpvLnRvcCxsZWZ0Om8ubGVmdCx3aWR0aDpuLGhlaWdodDpyfX1mdW5jdGlvbiB5ZihlKXt2YXIgdD17dG9wOiIwIixsZWZ0OiIwIn0sbj1lLnNlbGVjdGlvbjtpZihudWxsPT1uKXJldHVybiB0O3ZhciByPXZmKGUpO2lmKG51bGw9PXIpcmV0dXJuIHQ7dmFyIG89ci50b3AsaT1yLmxlZnQsYT1yLndpZHRoLHM9ci5oZWlnaHQsbD1Icy50b0RPTVJhbmdlKGUsbikuZ2V0Q2xpZW50UmVjdHMoKVswXTtpZihudWxsPT1sKXJldHVybiB0O2wud2lkdGg7dmFyIHU9bC5oZWlnaHQsYz17fSxmPWwudG9wLW8sZD1sLmxlZnQtaTtpZihkPmEvMil7dmFyIHA9YS1kO2MucmlnaHQ9cCs1KyJweCI7fWVsc2UgYy5sZWZ0PWQrNSsicHgiO2lmKGY+cy8yKXt2YXIgaD1zLWY7Yy5ib3R0b209aCs1KyJweCI7fWVsc2Uge3ZhciBnPWYrdTtnPDAmJihnPTApLGMudG9wPWcrNSsicHgiO31yZXR1cm4gY31mdW5jdGlvbiBtZihlLG4scil7dm9pZCAwPT09ciYmKHI9Im1vZGFsIik7dmFyIG89e3RvcDoiMCIsbGVmdDoiMCJ9O2lmKG51bGw9PWUuc2VsZWN0aW9uKXJldHVybiBvO3ZhciBpPXQuRWxlbWVudC5pc0VsZW1lbnQobikmJmUuaXNWb2lkKG4pLGE9dC5FbGVtZW50LmlzRWxlbWVudChuKSYmZS5pc0lubGluZShuKSxzPWRzLmdldChuKTtpZihudWxsPT1zKXJldHVybiBvO3ZhciBsPXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksdT1sLnRvcCxjPWwubGVmdCxmPWwuaGVpZ2h0LGQ9bC53aWR0aDtpZihpKXt2YXIgcD1mdW5jdGlvbihlKXt2YXIgdD1bXTt0LnB1c2goZSk7Zm9yKHZhciBuPTA7dC5sZW5ndGg+MDspe3ZhciByPXQucG9wKCk7aWYobnVsbD09cilicmVhaztpZigrK24+MWU0KWJyZWFrO3ZhciBvPXIubm9kZU5hbWU7aWYoMT09PXIubm9kZVR5cGUpe3ZhciBpPW8udG9Mb3dlckNhc2UoKTtpZihFcy5pbmNsdWRlcyhpKXx8ImlmcmFtZSI9PT1pfHwidmlkZW8iPT09aSlyZXR1cm4gcjt2YXIgYT1yLmNoaWxkcmVufHxbXSxzPWEubGVuZ3RoO2lmKHMpZm9yKHZhciBsPXMtMTtsPj0wO2wtLSl0LnB1c2goYVtsXSk7fX1yZXR1cm4gbnVsbH0ocyk7aWYobnVsbCE9cCl7dmFyIGg9cC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTt1PWgudG9wLGY9aC5oZWlnaHQ7fX12YXIgZz12ZihlKTtpZihudWxsPT1nKXJldHVybiBvO3ZhciB2PWcudG9wLHk9Zy5sZWZ0LG09Zy53aWR0aCxiPWcuaGVpZ2h0LHc9e30seD11LXYsRT1jLXk7aWYoImJhciI9PT1yKXJldHVybiB3LmxlZnQ9RSsicHgiLHg+NDA/dy5ib3R0b209Yi14KzUrInB4Ijp3LnRvcD14K2YrNSsicHgiLHc7aWYoIm1vZGFsIj09PXIpe3ZhciBTO2lmKGk/YT9FPihtLWQpLzI/dy5yaWdodD1tLUUrNSsicHgiOncubGVmdD1FK2QrNSsicHgiOncubGVmdD0iMjBweCI6dy5sZWZ0PUUrInB4IixpKShTPXgpPDAmJihTPTApLHcudG9wPVMrInB4IjtlbHNlIGlmKHg+KGItZikvMil3LmJvdHRvbT1iLXgrNSsicHgiO2Vsc2UgKFM9eCtmKTwwJiYoUz0wKSx3LnRvcD1TKzUrInB4IjtyZXR1cm4gd310aHJvdyBuZXcgRXJyb3IoInR5cGUgJyIrcisiJyBpcyBpbnZhbGlkIil9ZnVuY3Rpb24gYmYoZSx0KXtVdSgoZnVuY3Rpb24oKXt2YXIgbj12ZihlKTtpZihudWxsIT1uKXt2YXIgcixvPW4udG9wLGk9bi5sZWZ0LGE9bi53aWR0aCxzPW4uaGVpZ2h0LGw9dC5vZmZzZXQoKSx1PWwudG9wLGM9bC5sZWZ0LGY9dC53aWR0aCgpLGQ9dC5oZWlnaHQoKSxwPXUtbyxoPWMtaSxnPXQuYXR0cigic3R5bGUiKTtpZihnLmluZGV4T2YoInRvcCIpPj0wKWlmKChyPXArZC1zKT4wKXt2YXIgdj10LmNzcygidG9wIikseT1wYXJzZUludCh2LnRvU3RyaW5nKCkpLXI7eTwwJiYoeT0wKSx0LmNzcygidG9wIix5KyJweCIpO31pZihnLmluZGV4T2YoImJvdHRvbSIpPj0wJiZ1PDApe3ZhciBtPXQuY3NzKCJib3R0b20iKSxiPXBhcnNlSW50KG0udG9TdHJpbmcoKSktTWF0aC5hYnModSk7dC5jc3MoImJvdHRvbSIsYisicHgiKTt9aWYoZy5pbmRleE9mKCJsZWZ0Iik+PTApaWYoKHI9aCtmLWEpPjApe3ZhciB3PXQuY3NzKCJsZWZ0IikseD1wYXJzZUludCh3LnRvU3RyaW5nKCkpLXI7eDwwJiYoeD0wKSx0LmNzcygibGVmdCIseCsicHgiKTt9aWYoZy5pbmRleE9mKCJyaWdodCIpPj0wJiZjPDApe3ZhciBFPXQuY3NzKCJyaWdodCIpLFM9cGFyc2VJbnQoRS50b1N0cmluZygpKS1NYXRoLmFicyhjKTt0LmNzcygicmlnaHQiLFMrInB4Iik7fX19KSk7fXZhciB3Zj1xbygic2xpY2UiKSx4Zj1oZSgic3BlY2llcyIpLEVmPVAuQXJyYXksU2Y9TWF0aC5tYXg7X24oe3RhcmdldDoiQXJyYXkiLHByb3RvOiEwLGZvcmNlZDohd2Z9LHtzbGljZTpmdW5jdGlvbihlLHQpe3ZhciBuLHIsbyxpPWNuKHRoaXMpLGE9SXQoaSkscz1nbihlLGEpLGw9Z24odm9pZCAwPT09dD9hOnQsYSk7aWYoQnQoaSkmJihuPWkuY29uc3RydWN0b3IsKHF0KG4pJiYobj09PUVmfHxCdChuLnByb3RvdHlwZSkpfHxtZShuKSYmbnVsbD09PShuPW5beGZdKSkmJihuPXZvaWQgMCksbj09PUVmfHx2b2lkIDA9PT1uKSlyZXR1cm4geWwoaSxzLGwpO2ZvcihyPW5ldyh2b2lkIDA9PT1uP0VmOm4pKFNmKGwtcywwKSksbz0wO3M8bDtzKyssbysrKXMgaW4gaSYmSXIocixvLGlbc10pO3JldHVybiByLmxlbmd0aD1vLHJ9fSk7dmFyIGtmPWRuLmYsT2Y9VygiIi5zdGFydHNXaXRoKSxDZj1XKCIiLnNsaWNlKSxUZj1NYXRoLm1pbixOZj1Ucigic3RhcnRzV2l0aCIpLE1mPSFOZiYmISFmdW5jdGlvbigpe3ZhciBlPWtmKFN0cmluZy5wcm90b3R5cGUsInN0YXJ0c1dpdGgiKTtyZXR1cm4gZSYmIWUud3JpdGFibGV9KCk7X24oe3RhcmdldDoiU3RyaW5nIixwcm90bzohMCxmb3JjZWQ6IU1mJiYhTmZ9LHtzdGFydHNXaXRoOmZ1bmN0aW9uKGUpe3ZhciB0PWVyKFYodGhpcykpO09yKGUpO3ZhciBuPUZ0KFRmKGFyZ3VtZW50cy5sZW5ndGg+MT9hcmd1bWVudHNbMV06dm9pZCAwLHQubGVuZ3RoKSkscj1lcihlKTtyZXR1cm4gT2Y/T2YodCxyLG4pOkNmKHQsbixuK3IubGVuZ3RoKT09PXJ9fSk7dmFyIExmPU9iamVjdC5hc3NpZ24sUGY9T2JqZWN0LmRlZmluZVByb3BlcnR5LFJmPVcoW10uY29uY2F0KSxEZj0hTGZ8fHNlKChmdW5jdGlvbigpe2lmKHllJiYxIT09TGYoe2I6MX0sTGYoUGYoe30sImEiLHtlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe1BmKHRoaXMsImIiLHt2YWx1ZTozLGVudW1lcmFibGU6ITF9KTt9fSkse2I6Mn0pKS5iKXJldHVybiAhMDt2YXIgZT17fSx0PXt9LG49U3ltYm9sKCkscj0iYWJjZGVmZ2hpamtsbW5vcHFyc3QiO3JldHVybiBlW25dPTcsci5zcGxpdCgiIikuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dFtlXT1lO30pKSw3IT1MZih7fSxlKVtuXXx8Rm4oTGYoe30sdCkpLmpvaW4oIiIpIT1yfSkpP2Z1bmN0aW9uKGUsdCl7Zm9yKHZhciBuPVUoZSkscj1hcmd1bWVudHMubGVuZ3RoLG89MSxpPWtuLmYsYT11bi5mO3I+bzspZm9yKHZhciBzLGw9UnQoYXJndW1lbnRzW28rK10pLHU9aT9SZihGbihsKSxpKGwpKTpGbihsKSxjPXUubGVuZ3RoLGY9MDtjPmY7KXM9dVtmKytdLHllJiYhVGUoYSxsLHMpfHwobltzXT1sW3NdKTtyZXR1cm4gbn06TGY7X24oe3RhcmdldDoiT2JqZWN0IixzdGF0OiEwLGZvcmNlZDpPYmplY3QuYXNzaWduIT09RGZ9LHthc3NpZ246RGZ9KTt2YXIgamY9WyJwcm9wcyIsImF0dHJzIiwic3R5bGUiLCJkYXRhc2V0Iiwib24iLCJob29rIl07ZnVuY3Rpb24gQWYoZSl7dmFyIHQ9ZS5kYXRhLG49dm9pZCAwPT09dD97fTp0LHI9ZS5jaGlsZHJlbixvPXZvaWQgMD09PXI/W106cjtPYmplY3Qua2V5cyhuKS5mb3JFYWNoKChmdW5jdGlvbih0KXt2YXIgcixvLGk9blt0XTtpZigia2V5IiE9PXQpe2lmKCFqZi5pbmNsdWRlcyh0KSl7aWYodC5zdGFydHNXaXRoKCJkYXRhLSIpKXt2YXIgYT10LnNsaWNlKDUpO3JldHVybiBhPXcuZGVmYXVsdChhKSxmdW5jdGlvbihlLHQpe251bGw9PWUuZGF0YSYmKGUuZGF0YT17fSk7dmFyIG49ZS5kYXRhO251bGw9PW4uZGF0YXNldCYmKG4uZGF0YXNldD17fSk7T2JqZWN0LmFzc2lnbihuLmRhdGFzZXQsdCk7fShlLCgocj17fSlbYV09aSxyKSksdm9pZCBkZWxldGUgblt0XX0hZnVuY3Rpb24oZSx0KXtudWxsPT1lLmRhdGEmJihlLmRhdGE9e30pO3ZhciBuPWUuZGF0YTtudWxsPT1uLnByb3BzJiYobi5wcm9wcz17fSk7T2JqZWN0LmFzc2lnbihuLnByb3BzLHQpO30oZSwobz17fSxvW3RdPWksbykpLGRlbGV0ZSBuW3RdO319ZWxzZSBlLmtleT1pO30pKSxvLmxlbmd0aD4wJiZvLmZvckVhY2goKGZ1bmN0aW9uKGUpeyJzdHJpbmciIT10eXBlb2YgZSYmQWYoZSk7fSkpO312YXIgX2Y9W107dmFyIEZmPXt9O2Z1bmN0aW9uIElmKGUsdCxuKXt2YXIgcj1uLmlzSW5saW5lKGUpPyJzcGFuIjoiZGl2IjtyZXR1cm4gcy5qc3gocixudWxsLHQpfWZ1bmN0aW9uIEJmKGUsbil7dmFyIHIsbz1Icy5maW5kS2V5KG4sZSksaT1uLmlzSW5saW5lKGUpLGE9dC5FZGl0b3IuaXNWb2lkKG4sZSksbD1xdShvLmlkKSx1PXtpZDpsLGtleTpvLmlkLCJkYXRhLXNsYXRlLW5vZGUiOiJlbGVtZW50IiwiZGF0YS1zbGF0ZS1pbmxpbmUiOml9LGM9ZS50eXBlLGY9ZS5jaGlsZHJlbixkPXZvaWQgMD09PWY/W106ZixwPWZ1bmN0aW9uKGUpe3JldHVybiBGZltlXXx8SWZ9KGMpO3I9YT9udWxsOmQubWFwKChmdW5jdGlvbih0LHIpe3JldHVybiBWZih0LHIsZSxuKX0pKTt2YXIgaD1wKGUscixuKTtpZihhKXt1WyJkYXRhLXNsYXRlLXZvaWQiXT0hMDt2YXIgZz1pPyJzcGFuIjoiZGl2Iix2PUdpKHQuTm9kZS50ZXh0cyhlKSwxKSx5PUdpKHZbMF0sMSlbMF0sbT1WZih5LDAsZSxuKSxiPXMuanN4KGcseyJkYXRhLXNsYXRlLXNwYWNlciI6ITAsc3R5bGU6e2hlaWdodDoiMCIsY29sb3I6InRyYW5zcGFyZW50IixvdXRsaW5lOiJub25lIixwb3NpdGlvbjoiYWJzb2x1dGUifX0sbSk7aD1zLmpzeChnLHtzdHlsZTp7cG9zaXRpb246InJlbGF0aXZlIn19LGgsYiksc3Muc2V0KHksMCksbHMuc2V0KHksZSk7fXJldHVybiBudWxsPT1oLmRhdGEmJihoLmRhdGE9e30pLE9iamVjdC5hc3NpZ24oaC5kYXRhLHUpLGF8fGl8fChoPWZ1bmN0aW9uKGUsdCl7dmFyIG49dDtyZXR1cm4gX2YuZm9yRWFjaCgoZnVuY3Rpb24ocil7bj1yKGUsdCk7fSkpLG59KGUsaCkpLFV1KChmdW5jdGlvbigpe3ZhciB0PU1zKGwpO251bGwhPXQmJihmcy5zZXQobyx0KSxkcy5zZXQoZSx0KSxjcy5zZXQodCxlKSk7fSkpLGh9ZnVuY3Rpb24gJGYoZSx0KXtyZXR1cm4gdm9pZCAwPT09dCYmKHQ9ITEpLHMuanN4KCJzcGFuIix7ImRhdGEtc2xhdGUtc3RyaW5nIjohMH0sdD9lKyJcbiI6ZSl9ZnVuY3Rpb24gV2YoZSx0KXtyZXR1cm4gdm9pZCAwPT09ZSYmKGU9MCksdm9pZCAwPT09dCYmKHQ9ITEpLHMuanN4KCJzcGFuIix7ImRhdGEtc2xhdGUtemVyby13aWR0aCI6dD8ibiI6InoiLCJkYXRhLXNsYXRlLWxlbmd0aCI6ZX0sIlx1ZmVmZiIsdD9zLmpzeCgiYnIiLG51bGwpOm51bGwpfWZ1bmN0aW9uIEhmKGUsbixyKXtpZihudWxsPT1lLnRleHQpdGhyb3cgbmV3IEVycm9yKCJDdXJyZW50IG5vZGUgaXMgbm90IHNsYXRlIFRleHQgIitKU09OLnN0cmluZ2lmeShlKSk7dmFyIG89SHMuZmluZEtleShyLGUpLGk9ci5nZXRDb25maWcoKS5kZWNvcmF0ZTtpZihudWxsPT1pKXRocm93IG5ldyBFcnJvcigiQ2FuIG5vdCBnZXQgY29uZmlnLmRlY29yYXRlIik7dmFyIGE9SHMuZmluZFBhdGgocixlKSxsPWkoW2UsYV0pLHU9dC5UZXh0LmRlY29yYXRpb25zKGUsbCksYz11Lm1hcCgoZnVuY3Rpb24obyxpKXt2YXIgYT1mdW5jdGlvbihlLG4scixvLGkpe3ZvaWQgMD09PW4mJihuPSExKTt2YXIgYT1lLnRleHQscz1Icy5maW5kUGF0aChpLHIpLGw9dC5QYXRoLnBhcmVudChzKTtpZih0LkVkaXRvci5pc0VkaXRvcihvKSl0aHJvdyBuZXcgRXJyb3IoIlRleHQgbm9kZSAiK0pTT04uc3RyaW5naWZ5KHIpKyIgcGFyZW50IGlzIEVkaXRvciIpO3JldHVybiBpLmlzVm9pZChvKT9XZih0Lk5vZGUuc3RyaW5nKG8pLmxlbmd0aCk6IiIhPT1hfHxvLmNoaWxkcmVuW28uY2hpbGRyZW4ubGVuZ3RoLTFdIT09cnx8aS5pc0lubGluZShvKXx8IiIhPT10LkVkaXRvci5zdHJpbmcoaSxsKT8iIj09PWE/V2YoKTpuJiYiXG4iPT09YS5zbGljZSgtMSk/JGYoYSwhMCk6JGYoYSk6V2YoMCwhMCl9KG8saT09PXUubGVuZ3RoLTEsZSxuLHIpO3JldHVybiBhPWZ1bmN0aW9uKGUsdCl7dmFyIG49dDtyZXR1cm4gX2YuZm9yRWFjaCgoZnVuY3Rpb24odCl7bj10KGUsbik7fSkpLG59KG8sYSkscy5qc3goInNwYW4iLHsiZGF0YS1zbGF0ZS1sZWFmIjohMH0sYSl9KSksZj1mdW5jdGlvbihlKXtyZXR1cm4gInctZS10ZXh0LSIrZX0oby5pZCksZD1zLmpzeCgic3BhbiIseyJkYXRhLXNsYXRlLW5vZGUiOiJ0ZXh0IixpZDpmLGtleTpvLmlkfSxjKTtyZXR1cm4gVXUoKGZ1bmN0aW9uKCl7dmFyIHQ9TXMoZik7bnVsbCE9dCYmKGZzLnNldChvLHQpLGRzLnNldChlLHQpLGNzLnNldCh0LGUpKTt9KSksZH1mdW5jdGlvbiBWZihlLG4scixvKXtyZXR1cm4gc3Muc2V0KGUsbiksbHMuc2V0KGUsciksdC5FbGVtZW50LmlzRWxlbWVudChlKT9CZihlLG8pOkhmKGUscixvKX1mdW5jdGlvbiB6ZihlLHQpe3ZhciBuLHI9ZS4kc2Nyb2xsLG89ZnVuY3Rpb24oZSl7cmV0dXJuICJ3LWUtdGV4dGFyZWEtIitlfShlLmlkKSxpPXQuZ2V0Q29uZmlnKCksYT1pLnJlYWRPbmx5LGw9aS5hdXRvRm9jdXMsdT1mdW5jdGlvbihlLHQpe3JldHVybiB2b2lkIDA9PT10JiYodD0hMSkscy5oKCJkaXYjIitlLHtwcm9wczp7Y29udGVudEVkaXRhYmxlOiF0fX0pfShvLGEpLGM9dC5jaGlsZHJlbnx8W107dS5jaGlsZHJlbj1jLm1hcCgoZnVuY3Rpb24oZSxuKXt2YXIgcj1WZihlLG4sdCx0KTtyZXR1cm4gQWYocikscn0pKTt2YXIgZj1vcy5nZXQoZSk7aWYobnVsbD09ZiYmKGY9ITApLGYpe3ZhciBkPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHkuZGVmYXVsdCgnPGRpdlxuICAgICAgICBpZD0iJytlKyciXG4gICAgICAgIGRhdGEtc2xhdGUtZWRpdG9yXG4gICAgICAgIGRhdGEtc2xhdGUtbm9kZT0idmFsdWUiXG4gICAgICAgIHN1cHByZXNzQ29udGVudEVkaXRhYmxlV2FybmluZ1xuICAgICAgICByb2xlPSJ0ZXh0YXJlYSJcbiAgICAgICAgc3BlbGxDaGVjaz0idHJ1ZSJcbiAgICAgICAgYXV0b0NvcnJlY3Q9InRydWUiXG4gICAgICAgIGF1dG9DYXBpdGFsaXplPSJ0cnVlIlxuICAgID48L2Rpdj4nKX0obyk7ci5hcHBlbmQoZCksZS4kdGV4dEFyZWE9ZCxuPWRbMF0sKGg9cy5pbml0KFtzLmNsYXNzTW9kdWxlLHMucHJvcHNNb2R1bGUscy5zdHlsZU1vZHVsZSxzLmRhdGFzZXRNb2R1bGUscy5ldmVudExpc3RlbmVyc01vZHVsZSxzLmF0dHJpYnV0ZXNNb2R1bGVdKSkobix1KSxvcy5zZXQoZSwhMSksaXMuc2V0KGUsaCk7fWVsc2Uge3ZhciBwPWFzLmdldChlKSxoPWlzLmdldChlKTtpZihudWxsPT1wfHxudWxsPT1oKXJldHVybjtuPXAuZWxtLGgocCx1KTt9aWYobnVsbCE9bnx8bnVsbCE9KG49TXMobykpKXtpZigoZj9sOnQuaXNGb2N1c2VkKCkpJiZuLmZvY3VzKHtwcmV2ZW50U2Nyb2xsOiEwfSksZil7dmFyIGc9a3Mobik7ZyYmaHMuc2V0KHQsZyk7fXVzLnNldCh0LG4pLGRzLnNldCh0LG4pLGNzLnNldChuLHQpLGFzLnNldChlLHUpO319ZnVuY3Rpb24gVWYoZSl7cmV0dXJuICJvYmplY3QiPT10eXBlb2YgZSYmbnVsbCE9ZSYmMT09PWUubm9kZVR5cGV9ZnVuY3Rpb24gS2YoZSx0KXtyZXR1cm4gKCF0fHwiaGlkZGVuIiE9PWUpJiYidmlzaWJsZSIhPT1lJiYiY2xpcCIhPT1lfWZ1bmN0aW9uIHFmKGUsdCl7aWYoZS5jbGllbnRIZWlnaHQ8ZS5zY3JvbGxIZWlnaHR8fGUuY2xpZW50V2lkdGg8ZS5zY3JvbGxXaWR0aCl7dmFyIG49Z2V0Q29tcHV0ZWRTdHlsZShlLG51bGwpO3JldHVybiBLZihuLm92ZXJmbG93WSx0KXx8S2Yobi5vdmVyZmxvd1gsdCl8fGZ1bmN0aW9uKGUpe3ZhciB0PWZ1bmN0aW9uKGUpe2lmKCFlLm93bmVyRG9jdW1lbnR8fCFlLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXcpcmV0dXJuIG51bGw7dHJ5e3JldHVybiBlLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXcuZnJhbWVFbGVtZW50fWNhdGNoKGUpe3JldHVybiBudWxsfX0oZSk7cmV0dXJuICEhdCYmKHQuY2xpZW50SGVpZ2h0PGUuc2Nyb2xsSGVpZ2h0fHx0LmNsaWVudFdpZHRoPGUuc2Nyb2xsV2lkdGgpfShlKX1yZXR1cm4gITF9ZnVuY3Rpb24gR2YoZSx0LG4scixvLGksYSxzKXtyZXR1cm4gaTxlJiZhPnR8fGk+ZSYmYTx0PzA6aTw9ZSYmczw9bnx8YT49dCYmcz49bj9pLWUtcjphPnQmJnM8bnx8aTxlJiZzPm4/YS10K286MH12YXIgSmY9ZnVuY3Rpb24oZSx0KXt2YXIgbj13aW5kb3cscj10LnNjcm9sbE1vZGUsbz10LmJsb2NrLGk9dC5pbmxpbmUsYT10LmJvdW5kYXJ5LHM9dC5za2lwT3ZlcmZsb3dIaWRkZW5FbGVtZW50cyxsPSJmdW5jdGlvbiI9PXR5cGVvZiBhP2E6ZnVuY3Rpb24oZSl7cmV0dXJuIGUhPT1hfTtpZighVWYoZSkpdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCB0YXJnZXQiKTtmb3IodmFyIHU9ZG9jdW1lbnQuc2Nyb2xsaW5nRWxlbWVudHx8ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LGM9W10sZj1lO1VmKGYpJiZsKGYpOyl7aWYoKGY9Zi5wYXJlbnRFbGVtZW50KT09PXUpe2MucHVzaChmKTticmVha31udWxsIT1mJiZmPT09ZG9jdW1lbnQuYm9keSYmcWYoZikmJiFxZihkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpfHxudWxsIT1mJiZxZihmLHMpJiZjLnB1c2goZik7fWZvcih2YXIgZD1uLnZpc3VhbFZpZXdwb3J0P24udmlzdWFsVmlld3BvcnQud2lkdGg6aW5uZXJXaWR0aCxwPW4udmlzdWFsVmlld3BvcnQ/bi52aXN1YWxWaWV3cG9ydC5oZWlnaHQ6aW5uZXJIZWlnaHQsaD13aW5kb3cuc2Nyb2xsWHx8cGFnZVhPZmZzZXQsZz13aW5kb3cuc2Nyb2xsWXx8cGFnZVlPZmZzZXQsdj1lLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLHk9di5oZWlnaHQsbT12LndpZHRoLGI9di50b3Asdz12LnJpZ2h0LHg9di5ib3R0b20sRT12LmxlZnQsUz0ic3RhcnQiPT09b3x8Im5lYXJlc3QiPT09bz9iOiJlbmQiPT09bz94OmIreS8yLGs9ImNlbnRlciI9PT1pP0UrbS8yOiJlbmQiPT09aT93OkUsTz1bXSxDPTA7QzxjLmxlbmd0aDtDKyspe3ZhciBUPWNbQ10sTj1ULmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLE09Ti5oZWlnaHQsTD1OLndpZHRoLFA9Ti50b3AsUj1OLnJpZ2h0LEQ9Ti5ib3R0b20saj1OLmxlZnQ7aWYoImlmLW5lZWRlZCI9PT1yJiZiPj0wJiZFPj0wJiZ4PD1wJiZ3PD1kJiZiPj1QJiZ4PD1EJiZFPj1qJiZ3PD1SKXJldHVybiBPO3ZhciBBPWdldENvbXB1dGVkU3R5bGUoVCksXz1wYXJzZUludChBLmJvcmRlckxlZnRXaWR0aCwxMCksRj1wYXJzZUludChBLmJvcmRlclRvcFdpZHRoLDEwKSxJPXBhcnNlSW50KEEuYm9yZGVyUmlnaHRXaWR0aCwxMCksQj1wYXJzZUludChBLmJvcmRlckJvdHRvbVdpZHRoLDEwKSwkPTAsVz0wLEg9Im9mZnNldFdpZHRoImluIFQ/VC5vZmZzZXRXaWR0aC1ULmNsaWVudFdpZHRoLV8tSTowLFY9Im9mZnNldEhlaWdodCJpbiBUP1Qub2Zmc2V0SGVpZ2h0LVQuY2xpZW50SGVpZ2h0LUYtQjowO2lmKHU9PT1UKSQ9InN0YXJ0Ij09PW8/UzoiZW5kIj09PW8/Uy1wOiJuZWFyZXN0Ij09PW8/R2YoZyxnK3AscCxGLEIsZytTLGcrUyt5LHkpOlMtcC8yLFc9InN0YXJ0Ij09PWk/azoiY2VudGVyIj09PWk/ay1kLzI6ImVuZCI9PT1pP2stZDpHZihoLGgrZCxkLF8sSSxoK2ssaCtrK20sbSksJD1NYXRoLm1heCgwLCQrZyksVz1NYXRoLm1heCgwLFcraCk7ZWxzZSB7JD0ic3RhcnQiPT09bz9TLVAtRjoiZW5kIj09PW8/Uy1EK0IrVjoibmVhcmVzdCI9PT1vP0dmKFAsRCxNLEYsQitWLFMsUyt5LHkpOlMtKFArTS8yKStWLzIsVz0ic3RhcnQiPT09aT9rLWotXzoiY2VudGVyIj09PWk/ay0oaitMLzIpK0gvMjoiZW5kIj09PWk/ay1SK0krSDpHZihqLFIsTCxfLEkrSCxrLGsrbSxtKTt2YXIgej1ULnNjcm9sbExlZnQsVT1ULnNjcm9sbFRvcDtTKz1VLSgkPU1hdGgubWF4KDAsTWF0aC5taW4oVSskLFQuc2Nyb2xsSGVpZ2h0LU0rVikpKSxrKz16LShXPU1hdGgubWF4KDAsTWF0aC5taW4oeitXLFQuc2Nyb2xsV2lkdGgtTCtIKSkpO31PLnB1c2goe2VsOlQsdG9wOiQsbGVmdDpXfSk7fXJldHVybiBPfSxZZj1UKChmdW5jdGlvbihlLHQpe3QuX19lc01vZHVsZT0hMCx0LmRlZmF1bHQ9dm9pZCAwO3ZhciBuLHI9KG49SmYpJiZuLl9fZXNNb2R1bGU/bjp7ZGVmYXVsdDpufTtmdW5jdGlvbiBvKGUpe3JldHVybiBlPT09T2JqZWN0KGUpJiYwIT09T2JqZWN0LmtleXMoZSkubGVuZ3RofXZhciBpPWZ1bmN0aW9uKGUsdCl7dmFyIG49IWUub3duZXJEb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY29udGFpbnMoZSk7aWYobyh0KSYmImZ1bmN0aW9uIj09dHlwZW9mIHQuYmVoYXZpb3IpcmV0dXJuIHQuYmVoYXZpb3Iobj9bXTooMCwgci5kZWZhdWx0KShlLHQpKTtpZighbil7dmFyIGk9ZnVuY3Rpb24oZSl7cmV0dXJuICExPT09ZT97YmxvY2s6ImVuZCIsaW5saW5lOiJuZWFyZXN0In06byhlKT9lOntibG9jazoic3RhcnQiLGlubGluZToibmVhcmVzdCJ9fSh0KTtyZXR1cm4gZnVuY3Rpb24oZSx0KXt2b2lkIDA9PT10JiYodD0iYXV0byIpO3ZhciBuPSJzY3JvbGxCZWhhdmlvciJpbiBkb2N1bWVudC5ib2R5LnN0eWxlO2UuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dmFyIHI9ZS5lbCxvPWUudG9wLGk9ZS5sZWZ0O3Iuc2Nyb2xsJiZuP3Iuc2Nyb2xsKHt0b3A6byxsZWZ0OmksYmVoYXZpb3I6dH0pOihyLnNjcm9sbFRvcD1vLHIuc2Nyb2xsTGVmdD1pKTt9KSk7fSgoMCwgci5kZWZhdWx0KShlLGkpLGkuYmVoYXZpb3IpfX07dC5kZWZhdWx0PWksZS5leHBvcnRzPXQuZGVmYXVsdDt9KSksWGY9QyhZZik7ZnVuY3Rpb24gUWYoZSx0KXtyZXR1cm4gQ3ModCkmJkhzLmhhc0RPTU5vZGUoZSx0LHtlZGl0YWJsZTohMH0pfWZ1bmN0aW9uIFpmKGUsbil7aWYoZS5nZXRDb25maWcoKS5yZWFkT25seSlyZXR1cm4gITE7dmFyIHI9ZWQoZSxuKSYmSHMudG9TbGF0ZU5vZGUoZSxuKTtyZXR1cm4gdC5FZGl0b3IuaXNWb2lkKGUscil9ZnVuY3Rpb24gZWQoZSx0KXtyZXR1cm4gQ3ModCkmJkhzLmhhc0RPTU5vZGUoZSx0KX1mdW5jdGlvbiB0ZChlLG4scil7dm9pZCAwPT09ciYmKHI9ITEpO3ZhciBvPW4uc2VsZWN0aW9uLGk9bi5nZXRDb25maWcoKSxhPUhzLmZpbmREb2N1bWVudE9yU2hhZG93Um9vdChuKS5nZXRTZWxlY3Rpb24oKTtpZihhJiYoIWUuaXNDb21wb3Npbmd8fHIpJiZuLmlzRm9jdXNlZCgpKXt2YXIgcz0iTm9uZSIhPT1hLnR5cGU7aWYob3x8cyl7dmFyIGw9dXMuZ2V0KG4pLHU9ITE7aWYobC5jb250YWlucyhhLmFuY2hvck5vZGUpJiZsLmNvbnRhaW5zKGEuZm9jdXNOb2RlKSYmKHU9ITApLHMmJnUmJm8pe3ZhciBjPUhzLnRvU2xhdGVSYW5nZShuLGEse2V4YWN0TWF0Y2g6ITAsc3VwcHJlc3NUaHJvdzohMH0pO2lmKGMmJnQuUmFuZ2UuZXF1YWxzKGMsbykpe3ZhciBmPSEwO2lmKHQuUmFuZ2UuaXNDb2xsYXBzZWQobykpe3ZhciBkPWEuYW5jaG9yTm9kZSxwPWEuYW5jaG9yT2Zmc2V0O2lmKGQ9PT1sKXt2YXIgaD1sLmNoaWxkTm9kZXMsZz12b2lkIDA7KGc9aFtwXSkmJmcubWF0Y2hlcygidGFibGUiKSYmKGY9ITEpLChnPWhbcC0xXSkmJmcubWF0Y2hlcygidGFibGUiKSYmKGY9ITEpO319aWYoZilyZXR1cm59fWlmKCFvfHxIcy5oYXNSYW5nZShuLG8pKXtlLmlzVXBkYXRpbmdTZWxlY3Rpb249ITA7dmFyIHY9byYmSHMudG9ET01SYW5nZShuLG8pO2lmKHYpe3QuUmFuZ2UuaXNCYWNrd2FyZChvKT9hLnNldEJhc2VBbmRFeHRlbnQodi5lbmRDb250YWluZXIsdi5lbmRPZmZzZXQsdi5zdGFydENvbnRhaW5lcix2LnN0YXJ0T2Zmc2V0KTphLnNldEJhc2VBbmRFeHRlbnQodi5zdGFydENvbnRhaW5lcix2LnN0YXJ0T2Zmc2V0LHYuZW5kQ29udGFpbmVyLHYuZW5kT2Zmc2V0KTt2YXIgeT12LnN0YXJ0Q29udGFpbmVyLnBhcmVudEVsZW1lbnQ7aWYoIXkuY2xvc2VzdCgiW2RhdGEtc2xhdGUtc3BhY2VyXSIpKXt5LmdldEJvdW5kaW5nQ2xpZW50UmVjdD12LmdldEJvdW5kaW5nQ2xpZW50UmVjdC5iaW5kKHYpO3ZhciBtPWRvY3VtZW50LmJvZHk7WGYoeSx7c2Nyb2xsTW9kZToiaWYtbmVlZGVkIixib3VuZGFyeTppLnNjcm9sbD9sLnBhcmVudEVsZW1lbnQ6bSxibG9jazoiZW5kIixiZWhhdmlvcjoic21vb3RoIn0pLGRlbGV0ZSB5LmdldEJvdW5kaW5nQ2xpZW50UmVjdDt9fWVsc2UgYS5yZW1vdmVBbGxSYW5nZXMoKTtzZXRUaW1lb3V0KChmdW5jdGlvbigpe3YmJl9zJiZsLmZvY3VzKCksZS5pc1VwZGF0aW5nU2VsZWN0aW9uPSExO30pKTt9ZWxzZSBuLnNlbGVjdGlvbj1Icy50b1NsYXRlUmFuZ2UobixhLHtleGFjdE1hdGNoOiExLHN1cHByZXNzVGhyb3c6ITF9KTt9fX12YXIgbmQ9bmV3IFdlYWtNYXAscmQ9bmV3IFdlYWtNYXA7dmFyIG9kPXtib2xkOiJtb2QrYiIsY29tcG9zZTpbImRvd24iLCJsZWZ0IiwicmlnaHQiLCJ1cCIsImJhY2tzcGFjZSIsImVudGVyIl0sbW92ZUJhY2t3YXJkOiJsZWZ0Iixtb3ZlRm9yd2FyZDoicmlnaHQiLG1vdmVXb3JkQmFja3dhcmQ6ImN0cmwrbGVmdCIsbW92ZVdvcmRGb3J3YXJkOiJjdHJsK3JpZ2h0IixkZWxldGVCYWNrd2FyZDoic2hpZnQ/K2JhY2tzcGFjZSIsZGVsZXRlRm9yd2FyZDoic2hpZnQ/K2RlbGV0ZSIsZXh0ZW5kQmFja3dhcmQ6InNoaWZ0K2xlZnQiLGV4dGVuZEZvcndhcmQ6InNoaWZ0K3JpZ2h0IixpdGFsaWM6Im1vZCtpIixzcGxpdEJsb2NrOiJzaGlmdD8rZW50ZXIiLHVuZG86Im1vZCt6Iix0YWI6InRhYiIsc2VsZWN0QWxsOiJtb2QrYSJ9LGlkPXttb3ZlTGluZUJhY2t3YXJkOiJvcHQrdXAiLG1vdmVMaW5lRm9yd2FyZDoib3B0K2Rvd24iLG1vdmVXb3JkQmFja3dhcmQ6Im9wdCtsZWZ0Iixtb3ZlV29yZEZvcndhcmQ6Im9wdCtyaWdodCIsZGVsZXRlQmFja3dhcmQ6WyJjdHJsK2JhY2tzcGFjZSIsImN0cmwraCJdLGRlbGV0ZUZvcndhcmQ6WyJjdHJsK2RlbGV0ZSIsImN0cmwrZCJdLGRlbGV0ZUxpbmVCYWNrd2FyZDoiY21kK3NoaWZ0PytiYWNrc3BhY2UiLGRlbGV0ZUxpbmVGb3J3YXJkOlsiY21kK3NoaWZ0PytkZWxldGUiLCJjdHJsK2siXSxkZWxldGVXb3JkQmFja3dhcmQ6Im9wdCtzaGlmdD8rYmFja3NwYWNlIixkZWxldGVXb3JkRm9yd2FyZDoib3B0K3NoaWZ0PytkZWxldGUiLGV4dGVuZExpbmVCYWNrd2FyZDoib3B0K3NoaWZ0K3VwIixleHRlbmRMaW5lRm9yd2FyZDoib3B0K3NoaWZ0K2Rvd24iLHJlZG86ImNtZCtzaGlmdCt6Iix0cmFuc3Bvc2VDaGFyYWN0ZXI6ImN0cmwrdCJ9LGFkPXtkZWxldGVXb3JkQmFja3dhcmQ6ImN0cmwrc2hpZnQ/K2JhY2tzcGFjZSIsZGVsZXRlV29yZEZvcndhcmQ6ImN0cmwrc2hpZnQ/K2RlbGV0ZSIscmVkbzpbImN0cmwreSIsImN0cmwrc2hpZnQreiJdfSxzZD1mdW5jdGlvbihlKXt2YXIgdD1vZFtlXSxuPWlkW2VdLHI9YWRbZV0sbz10JiZ1LmlzS2V5SG90a2V5KHQpLGk9biYmdS5pc0tleUhvdGtleShuKSxhPXImJnUuaXNLZXlIb3RrZXkocik7cmV0dXJuIGZ1bmN0aW9uKGUpe3JldHVybiAhKCFvfHwhbyhlKSl8fCghIShBcyYmaSYmaShlKSl8fCEoQXN8fCFhfHwhYShlKSkpfX0sbGQ9e2lzQm9sZDpzZCgiYm9sZCIpLGlzQ29tcG9zZTpzZCgiY29tcG9zZSIpLGlzTW92ZUJhY2t3YXJkOnNkKCJtb3ZlQmFja3dhcmQiKSxpc01vdmVGb3J3YXJkOnNkKCJtb3ZlRm9yd2FyZCIpLGlzRGVsZXRlQmFja3dhcmQ6c2QoImRlbGV0ZUJhY2t3YXJkIiksaXNEZWxldGVGb3J3YXJkOnNkKCJkZWxldGVGb3J3YXJkIiksaXNEZWxldGVMaW5lQmFja3dhcmQ6c2QoImRlbGV0ZUxpbmVCYWNrd2FyZCIpLGlzRGVsZXRlTGluZUZvcndhcmQ6c2QoImRlbGV0ZUxpbmVGb3J3YXJkIiksaXNEZWxldGVXb3JkQmFja3dhcmQ6c2QoImRlbGV0ZVdvcmRCYWNrd2FyZCIpLGlzRGVsZXRlV29yZEZvcndhcmQ6c2QoImRlbGV0ZVdvcmRGb3J3YXJkIiksaXNFeHRlbmRCYWNrd2FyZDpzZCgiZXh0ZW5kQmFja3dhcmQiKSxpc0V4dGVuZEZvcndhcmQ6c2QoImV4dGVuZEZvcndhcmQiKSxpc0V4dGVuZExpbmVCYWNrd2FyZDpzZCgiZXh0ZW5kTGluZUJhY2t3YXJkIiksaXNFeHRlbmRMaW5lRm9yd2FyZDpzZCgiZXh0ZW5kTGluZUZvcndhcmQiKSxpc0l0YWxpYzpzZCgiaXRhbGljIiksaXNNb3ZlTGluZUJhY2t3YXJkOnNkKCJtb3ZlTGluZUJhY2t3YXJkIiksaXNNb3ZlTGluZUZvcndhcmQ6c2QoIm1vdmVMaW5lRm9yd2FyZCIpLGlzTW92ZVdvcmRCYWNrd2FyZDpzZCgibW92ZVdvcmRCYWNrd2FyZCIpLGlzTW92ZVdvcmRGb3J3YXJkOnNkKCJtb3ZlV29yZEZvcndhcmQiKSxpc1JlZG86c2QoInJlZG8iKSxpc1NwbGl0QmxvY2s6c2QoInNwbGl0QmxvY2siKSxpc1RyYW5zcG9zZUNoYXJhY3RlcjpzZCgidHJhbnNwb3NlQ2hhcmFjdGVyIiksaXNVbmRvOnNkKCJ1bmRvIiksaXNUYWI6c2QoInRhYiIpLGlzU2VsZWN0QWxsOnNkKCJzZWxlY3RBbGwiKX07ZnVuY3Rpb24gdWQoZSl7ZS5wcmV2ZW50RGVmYXVsdCgpO312YXIgY2Q9e2JlZm9yZWlucHV0OmZ1bmN0aW9uKGUsbixyKXt2YXIgbz1lLGk9ci5nZXRDb25maWcoKS5yZWFkT25seTtpZihXcyYmIWkmJlFmKHIsby50YXJnZXQpKXt2YXIgYT1yLnNlbGVjdGlvbixzPW8uaW5wdXRUeXBlLGw9by5kYXRhVHJhbnNmZXJ8fG8uZGF0YXx8dm9pZCAwO2lmKCJpbnNlcnRDb21wb3NpdGlvblRleHQiIT09cyYmImRlbGV0ZUNvbXBvc2l0aW9uVGV4dCIhPT1zKXtpZihvLnByZXZlbnREZWZhdWx0KCksIXMuc3RhcnRzV2l0aCgiZGVsZXRlIil8fHMuc3RhcnRzV2l0aCgiZGVsZXRlQnkiKSl7dmFyIHU9R2koby5nZXRUYXJnZXRSYW5nZXMoKSwxKVswXTtpZih1KXt2YXIgYz1Icy50b1NsYXRlUmFuZ2Uocix1LHtleGFjdE1hdGNoOiExLHN1cHByZXNzVGhyb3c6ITF9KTthJiZ0LlJhbmdlLmVxdWFscyhhLGMpfHx0LlRyYW5zZm9ybXMuc2VsZWN0KHIsYyk7fX1pZihhJiZ0LlJhbmdlLmlzRXhwYW5kZWQoYSkmJnMuc3RhcnRzV2l0aCgiZGVsZXRlIikpe3ZhciBmPXMuZW5kc1dpdGgoIkJhY2t3YXJkIik/ImJhY2t3YXJkIjoiZm9yd2FyZCI7dC5FZGl0b3IuZGVsZXRlRnJhZ21lbnQocix7ZGlyZWN0aW9uOmZ9KTt9ZWxzZSBzd2l0Y2gocyl7Y2FzZSJkZWxldGVCeUNvbXBvc2l0aW9uIjpjYXNlImRlbGV0ZUJ5Q3V0IjpjYXNlImRlbGV0ZUJ5RHJhZyI6dC5FZGl0b3IuZGVsZXRlRnJhZ21lbnQocik7YnJlYWs7Y2FzZSJkZWxldGVDb250ZW50IjpjYXNlImRlbGV0ZUNvbnRlbnRGb3J3YXJkIjp0LkVkaXRvci5kZWxldGVGb3J3YXJkKHIpO2JyZWFrO2Nhc2UiZGVsZXRlQ29udGVudEJhY2t3YXJkIjp0LkVkaXRvci5kZWxldGVCYWNrd2FyZChyKTticmVhaztjYXNlImRlbGV0ZUVudGlyZVNvZnRMaW5lIjp0LkVkaXRvci5kZWxldGVCYWNrd2FyZChyLHt1bml0OiJsaW5lIn0pLHQuRWRpdG9yLmRlbGV0ZUZvcndhcmQocix7dW5pdDoibGluZSJ9KTticmVhaztjYXNlImRlbGV0ZUhhcmRMaW5lQmFja3dhcmQiOnQuRWRpdG9yLmRlbGV0ZUJhY2t3YXJkKHIse3VuaXQ6ImJsb2NrIn0pO2JyZWFrO2Nhc2UiZGVsZXRlU29mdExpbmVCYWNrd2FyZCI6dC5FZGl0b3IuZGVsZXRlQmFja3dhcmQocix7dW5pdDoibGluZSJ9KTticmVhaztjYXNlImRlbGV0ZUhhcmRMaW5lRm9yd2FyZCI6dC5FZGl0b3IuZGVsZXRlRm9yd2FyZChyLHt1bml0OiJibG9jayJ9KTticmVhaztjYXNlImRlbGV0ZVNvZnRMaW5lRm9yd2FyZCI6dC5FZGl0b3IuZGVsZXRlRm9yd2FyZChyLHt1bml0OiJsaW5lIn0pO2JyZWFrO2Nhc2UiZGVsZXRlV29yZEJhY2t3YXJkIjp0LkVkaXRvci5kZWxldGVCYWNrd2FyZChyLHt1bml0OiJ3b3JkIn0pO2JyZWFrO2Nhc2UiZGVsZXRlV29yZEZvcndhcmQiOnQuRWRpdG9yLmRlbGV0ZUZvcndhcmQocix7dW5pdDoid29yZCJ9KTticmVhaztjYXNlImluc2VydExpbmVCcmVhayI6Y2FzZSJpbnNlcnRQYXJhZ3JhcGgiOnQuRWRpdG9yLmluc2VydEJyZWFrKHIpO2JyZWFrO2Nhc2UiaW5zZXJ0RnJvbURyb3AiOmNhc2UiaW5zZXJ0RnJvbVBhc3RlIjpjYXNlImluc2VydEZyb21ZYW5rIjpjYXNlImluc2VydFJlcGxhY2VtZW50VGV4dCI6Y2FzZSJpbnNlcnRUZXh0IjppZigiaW5zZXJ0RnJvbVBhc3RlIj09PXMmJiFtcy5nZXQocikpYnJlYWs7bCBpbnN0YW5jZW9mIERhdGFUcmFuc2Zlcj9yLmluc2VydERhdGEobCk6InN0cmluZyI9PXR5cGVvZiBsJiZ0LkVkaXRvci5pbnNlcnRUZXh0KHIsbCk7fX19fSxibHVyOmZ1bmN0aW9uKGUsbixyKXt2YXIgbz1lLGk9bi5pc1VwZGF0aW5nU2VsZWN0aW9uLGE9bi5sYXRlc3RFbGVtZW50O2lmKCFyLmdldENvbmZpZygpLnJlYWRPbmx5JiYhaSYmUWYocixvLnRhcmdldCkpe3ZhciBzPUhzLmZpbmREb2N1bWVudE9yU2hhZG93Um9vdChyKTtpZihhIT09cy5hY3RpdmVFbGVtZW50KXt2YXIgbD1vLnJlbGF0ZWRUYXJnZXQ7aWYoIShsPT09SHMudG9ET01Ob2RlKHIscil8fE9zKGwpJiZsLmhhc0F0dHJpYnV0ZSgiZGF0YS1zbGF0ZS1zcGFjZXIiKSkpe2lmKG51bGwhPWwmJkNzKGwpJiZIcy5oYXNET01Ob2RlKHIsbCkpe3ZhciB1PUhzLnRvU2xhdGVOb2RlKHIsbCk7aWYodC5FbGVtZW50LmlzRWxlbWVudCh1KSYmIXIuaXNWb2lkKHUpKXJldHVybn1pZihGcyl7dmFyIGM9cy5nZXRTZWxlY3Rpb24oKTtudWxsPT1jfHxjLnJlbW92ZUFsbFJhbmdlcygpO31ncy5kZWxldGUocik7fX19fSxmb2N1czpmdW5jdGlvbihlLHQsbil7dmFyIHI9SHMudG9ET01Ob2RlKG4sbiksbz1Icy5maW5kRG9jdW1lbnRPclNoYWRvd1Jvb3Qobik7dC5sYXRlc3RFbGVtZW50PW8uYWN0aXZlRWxlbWVudCxfcyYmZS50YXJnZXQhPT1yP3IuZm9jdXMoKTpncy5zZXQobiwhMCk7fSxjbGljazpmdW5jdGlvbihlLG4scil7aWYoIXIuZ2V0Q29uZmlnKCkucmVhZE9ubHkmJmVkKHIsZS50YXJnZXQpJiZDcyhlLnRhcmdldCkpe3ZhciBvPUhzLnRvU2xhdGVOb2RlKHIsZS50YXJnZXQpLGk9SHMuZmluZFBhdGgocixvKTtpZih0LkVkaXRvci5oYXNQYXRoKHIsaSkpaWYodC5Ob2RlLmdldChyLGkpPT09byl7dmFyIGE9dC5FZGl0b3Iuc3RhcnQocixpKSxzPXQuRWRpdG9yLmVuZChyLGkpLGw9dC5FZGl0b3Iudm9pZChyLHthdDphfSksdT10LkVkaXRvci52b2lkKHIse2F0OnN9KTtpZihsJiZ1JiZ0LlBhdGguZXF1YWxzKGxbMV0sdVsxXSkpe3ZhciBjPXQuRWRpdG9yLnJhbmdlKHIsYSk7dC5UcmFuc2Zvcm1zLnNlbGVjdChyLGMpO319fX0sY29tcG9zaXRpb25zdGFydDpmdW5jdGlvbihlLG4scil7aWYoUWYocixlLnRhcmdldCkpe3ZhciBvPXIuc2VsZWN0aW9uO2lmKG8mJnQuUmFuZ2UuaXNFeHBhbmRlZChvKSYmKHQuRWRpdG9yLmRlbGV0ZUZyYWdtZW50KHIpLFByb21pc2UucmVzb2x2ZSgpLnRoZW4oKGZ1bmN0aW9uKCl7dGQobixyLCEwKTt9KSkpLG8mJnQuUmFuZ2UuaXNDb2xsYXBzZWQobykpe3ZhciBpPUhzLnRvRE9NUmFuZ2UocixvKS5zdGFydENvbnRhaW5lcixhPWkudGV4dENvbnRlbnR8fCIiO25kLnNldChyLGEpLHJkLnNldChyLGkpO31uLmlzQ29tcG9zaW5nPSEwLGZ1bmN0aW9uKGUsdCl7dmFyIG47dC5nZXRDb25maWcoKS5wbGFjZWhvbGRlciYmdC5pc0VtcHR5KCkmJmUuc2hvd1BsYWNlaG9sZGVyJiYobnVsbD09PShuPWUuJHBsYWNlaG9sZGVyKXx8dm9pZCAwPT09bnx8bi5oaWRlKCksZS5zaG93UGxhY2Vob2xkZXI9ITEpO30obixyKTt9fSxjb21wb3NpdGlvbmVuZDpmdW5jdGlvbihlLG4scil7dmFyIG89ZTtpZihRZihyLG8udGFyZ2V0KSl7bi5pc0NvbXBvc2luZz0hMTt2YXIgaT1yLnNlbGVjdGlvbjtpZihudWxsIT1pKXsoJHN8fF9zKSYmSHMuY2xlYW5FeHBvc2VkVGV4Tm9kZUluU2VsZWN0aW9uQmxvY2socik7Zm9yKHZhciBhPXQuUmFuZ2UuaXNCYWNrd2FyZChpKT9pLmZvY3VzOmkuYW5jaG9yLHM9R2kodC5FZGl0b3Iubm9kZShyLFthLnBhdGhbMF1dKSwxKVswXSxsPTA7bDxhLnBhdGgubGVuZ3RoO2wrKyl7dmFyIHU9R2kodC5FZGl0b3Iubm9kZShyLGEucGF0aC5zbGljZSgwLGwrMSkpLDEpWzBdO2lmKHQuRWxlbWVudC5pc0VsZW1lbnQodSkmJigoRnN8fF9zKSYmImxpbmsiPT09dS50eXBlfHwiY29kZSI9PT11LnR5cGUpKXtIcy5zZXROZXdLZXkocyk7YnJlYWt9fXZhciBjPW8uZGF0YTtpZihjKXtpZihyLmdldENvbmZpZygpLm1heExlbmd0aCl7dmFyIGY9SHMuZ2V0TGVmdExlbmd0aE9mTWF4TGVuZ3RoKHIpO2lmKGY8Yy5sZW5ndGgpSHMudG9ET01SYW5nZShyLGkpLnN0YXJ0Q29udGFpbmVyLnRleHRDb250ZW50PW5kLmdldChyKXx8IiIsZj4wJiZ0LkVkaXRvci5pbnNlcnRUZXh0KHIsYy5zbGljZSgwLGYpKSxuLmNoYW5nZVZpZXdTdGF0ZSgpO2Vsc2UgdC5FZGl0b3IuaW5zZXJ0VGV4dChyLGMpO31lbHNlIHQuRWRpdG9yLmluc2VydFRleHQocixjKTtGc3x8c2V0VGltZW91dCgoZnVuY3Rpb24oKXt2YXIgZT1yLnNlbGVjdGlvbjtpZihudWxsIT1lKXt2YXIgdD1yZC5nZXQocik7aWYobnVsbCE9dClIcy50b0RPTVJhbmdlKHIsZSkuc3RhcnRDb250YWluZXIhPT10JiYodC50ZXh0Q29udGVudD1uZC5nZXQocil8fCIiKTt9fSkpO319fX0sY29tcG9zaXRpb251cGRhdGU6ZnVuY3Rpb24oZSx0LG4pe1FmKG4sZS50YXJnZXQpJiYodC5pc0NvbXBvc2luZz0hMCk7fSxrZXlkb3duOmZ1bmN0aW9uKGUsbixyKXt2YXIgbz1lLGk9ci5zZWxlY3Rpb247aWYoIXIuZ2V0Q29uZmlnKCkucmVhZE9ubHkmJiFuLmlzQ29tcG9zaW5nJiZRZihyLG8udGFyZ2V0KSl7aWYoZnVuY3Rpb24oZSx0KXt2YXIgbj1YYS5nZXQoZSkscj1uJiZuLmdldE1lbnVzKCksbz1aYS5nZXQoZSksaT1vJiZvLmdldE1lbnVzKCksYT1LaShLaSh7fSxyKSxpKTtmb3IodmFyIHMgaW4gYSl7dmFyIGw9YVtzXSxjPWwuaG90a2V5O2lmKGMmJnUuaXNIb3RrZXkoYyx0KSYmIWwuaXNEaXNhYmxlZChlKSl7dmFyIGY9bC5nZXRWYWx1ZShlKTtsLmV4ZWMoZSxmKTt9fX0ocixvKSxsZC5pc1RhYihvKSlyZXR1cm4gdWQobyksdm9pZCByLmhhbmRsZVRhYigpO2lmKGxkLmlzUmVkbyhvKSlyZXR1cm4gdWQobyksdm9pZCgiZnVuY3Rpb24iPT10eXBlb2Ygci5yZWRvJiZyLnJlZG8oKSk7aWYobGQuaXNVbmRvKG8pKXJldHVybiB1ZChvKSx2b2lkKCJmdW5jdGlvbiI9PXR5cGVvZiByLnVuZG8mJnIudW5kbygpKTtpZihsZC5pc01vdmVMaW5lQmFja3dhcmQobykpcmV0dXJuIHVkKG8pLHZvaWQgdC5UcmFuc2Zvcm1zLm1vdmUocix7dW5pdDoibGluZSIscmV2ZXJzZTohMH0pO2lmKGxkLmlzTW92ZUxpbmVGb3J3YXJkKG8pKXJldHVybiB1ZChvKSx2b2lkIHQuVHJhbnNmb3Jtcy5tb3ZlKHIse3VuaXQ6ImxpbmUifSk7aWYobGQuaXNFeHRlbmRMaW5lQmFja3dhcmQobykpcmV0dXJuIHVkKG8pLHZvaWQgdC5UcmFuc2Zvcm1zLm1vdmUocix7dW5pdDoibGluZSIsZWRnZToiZm9jdXMiLHJldmVyc2U6ITB9KTtpZihsZC5pc0V4dGVuZExpbmVGb3J3YXJkKG8pKXJldHVybiB1ZChvKSx2b2lkIHQuVHJhbnNmb3Jtcy5tb3ZlKHIse3VuaXQ6ImxpbmUiLGVkZ2U6ImZvY3VzIn0pO2lmKGxkLmlzTW92ZUJhY2t3YXJkKG8pKXJldHVybiB1ZChvKSx2b2lkKGkmJnQuUmFuZ2UuaXNDb2xsYXBzZWQoaSk/dC5UcmFuc2Zvcm1zLm1vdmUocix7cmV2ZXJzZTohMH0pOnQuVHJhbnNmb3Jtcy5jb2xsYXBzZShyLHtlZGdlOiJzdGFydCJ9KSk7aWYobGQuaXNNb3ZlRm9yd2FyZChvKSlyZXR1cm4gdWQobyksdm9pZChpJiZ0LlJhbmdlLmlzQ29sbGFwc2VkKGkpP3QuVHJhbnNmb3Jtcy5tb3ZlKHIpOnQuVHJhbnNmb3Jtcy5jb2xsYXBzZShyLHtlZGdlOiJlbmQifSkpO2lmKGxkLmlzTW92ZVdvcmRCYWNrd2FyZChvKSlyZXR1cm4gdWQobyksaSYmdC5SYW5nZS5pc0V4cGFuZGVkKGkpJiZ0LlRyYW5zZm9ybXMuY29sbGFwc2Uocix7ZWRnZToiZm9jdXMifSksdm9pZCB0LlRyYW5zZm9ybXMubW92ZShyLHt1bml0OiJ3b3JkIixyZXZlcnNlOiEwfSk7aWYobGQuaXNNb3ZlV29yZEZvcndhcmQobykpcmV0dXJuIHVkKG8pLGkmJnQuUmFuZ2UuaXNFeHBhbmRlZChpKSYmdC5UcmFuc2Zvcm1zLmNvbGxhcHNlKHIse2VkZ2U6ImZvY3VzIn0pLHZvaWQgdC5UcmFuc2Zvcm1zLm1vdmUocix7dW5pdDoid29yZCJ9KTtpZihsZC5pc1NlbGVjdEFsbChvKSlyZXR1cm4gdWQobyksdm9pZCByLnNlbGVjdEFsbCgpO2lmKFdzKXtpZigoJHN8fEZzKSYmaSYmKGxkLmlzRGVsZXRlQmFja3dhcmQobyl8fGxkLmlzRGVsZXRlRm9yd2FyZChvKSkmJnQuUmFuZ2UuaXNDb2xsYXBzZWQoaSkpe3ZhciBhPXQuTm9kZS5wYXJlbnQocixpLmFuY2hvci5wYXRoKTtpZih0LkVsZW1lbnQuaXNFbGVtZW50KGEpJiZ0LkVkaXRvci5pc1ZvaWQocixhKSYmdC5FZGl0b3IuaXNJbmxpbmUocixhKSlyZXR1cm4gby5wcmV2ZW50RGVmYXVsdCgpLHZvaWQgdC5UcmFuc2Zvcm1zLmRlbGV0ZShyLHt1bml0OiJibG9jayJ9KX19ZWxzZSB7aWYobGQuaXNCb2xkKG8pfHxsZC5pc0l0YWxpYyhvKXx8bGQuaXNUcmFuc3Bvc2VDaGFyYWN0ZXIobykpcmV0dXJuIHZvaWQgdWQobyk7aWYobGQuaXNTcGxpdEJsb2NrKG8pKXJldHVybiB1ZChvKSx2b2lkIHQuRWRpdG9yLmluc2VydEJyZWFrKHIpO2lmKGxkLmlzRGVsZXRlQmFja3dhcmQobykpcmV0dXJuIHVkKG8pLHZvaWQoaSYmdC5SYW5nZS5pc0V4cGFuZGVkKGkpP3QuRWRpdG9yLmRlbGV0ZUZyYWdtZW50KHIse2RpcmVjdGlvbjoiYmFja3dhcmQifSk6dC5FZGl0b3IuZGVsZXRlQmFja3dhcmQocikpO2lmKGxkLmlzRGVsZXRlRm9yd2FyZChvKSlyZXR1cm4gdWQobyksdm9pZChpJiZ0LlJhbmdlLmlzRXhwYW5kZWQoaSk/dC5FZGl0b3IuZGVsZXRlRnJhZ21lbnQocix7ZGlyZWN0aW9uOiJmb3J3YXJkIn0pOnQuRWRpdG9yLmRlbGV0ZUZvcndhcmQocikpO2lmKGxkLmlzRGVsZXRlTGluZUJhY2t3YXJkKG8pKXJldHVybiB1ZChvKSx2b2lkKGkmJnQuUmFuZ2UuaXNFeHBhbmRlZChpKT90LkVkaXRvci5kZWxldGVGcmFnbWVudChyLHtkaXJlY3Rpb246ImJhY2t3YXJkIn0pOnQuRWRpdG9yLmRlbGV0ZUJhY2t3YXJkKHIse3VuaXQ6ImxpbmUifSkpO2lmKGxkLmlzRGVsZXRlTGluZUZvcndhcmQobykpcmV0dXJuIHVkKG8pLHZvaWQoaSYmdC5SYW5nZS5pc0V4cGFuZGVkKGkpP3QuRWRpdG9yLmRlbGV0ZUZyYWdtZW50KHIse2RpcmVjdGlvbjoiZm9yd2FyZCJ9KTp0LkVkaXRvci5kZWxldGVGb3J3YXJkKHIse3VuaXQ6ImxpbmUifSkpO2lmKGxkLmlzRGVsZXRlV29yZEJhY2t3YXJkKG8pKXJldHVybiB1ZChvKSx2b2lkKGkmJnQuUmFuZ2UuaXNFeHBhbmRlZChpKT90LkVkaXRvci5kZWxldGVGcmFnbWVudChyLHtkaXJlY3Rpb246ImJhY2t3YXJkIn0pOnQuRWRpdG9yLmRlbGV0ZUJhY2t3YXJkKHIse3VuaXQ6IndvcmQifSkpO2lmKGxkLmlzRGVsZXRlV29yZEZvcndhcmQobykpcmV0dXJuIHVkKG8pLHZvaWQoaSYmdC5SYW5nZS5pc0V4cGFuZGVkKGkpP3QuRWRpdG9yLmRlbGV0ZUZyYWdtZW50KHIse2RpcmVjdGlvbjoiZm9yd2FyZCJ9KTp0LkVkaXRvci5kZWxldGVGb3J3YXJkKHIse3VuaXQ6IndvcmQifSkpfX19LGtleXByZXNzOmZ1bmN0aW9uKGUsbixyKXtpZighV3MmJiFyLmdldENvbmZpZygpLnJlYWRPbmx5JiZRZihyLGUudGFyZ2V0KSl7ZS5wcmV2ZW50RGVmYXVsdCgpO3ZhciBvPWUua2V5O3QuRWRpdG9yLmluc2VydFRleHQocixvKTt9fSxjb3B5OmZ1bmN0aW9uKGUsdCxuKXt2YXIgcj1lO2lmKFFmKG4sci50YXJnZXQpKXtyLnByZXZlbnREZWZhdWx0KCk7dmFyIG89ci5jbGlwYm9hcmREYXRhO251bGwhPW8mJm4uc2V0RnJhZ21lbnREYXRhKG8pO319LGN1dDpmdW5jdGlvbihlLG4scil7dmFyIG89ZSxpPXIuc2VsZWN0aW9uO2lmKCFyLmdldENvbmZpZygpLnJlYWRPbmx5JiZRZihyLG8udGFyZ2V0KSl7by5wcmV2ZW50RGVmYXVsdCgpO3ZhciBhPW8uY2xpcGJvYXJkRGF0YTtpZihudWxsIT1hJiYoci5zZXRGcmFnbWVudERhdGEoYSksaSkpaWYodC5SYW5nZS5pc0V4cGFuZGVkKGkpKXQuRWRpdG9yLmRlbGV0ZUZyYWdtZW50KHIpO2Vsc2Uge3ZhciBzPXQuTm9kZS5wYXJlbnQocixpLmFuY2hvci5wYXRoKTt0LkVkaXRvci5pc1ZvaWQocixzKSYmdC5UcmFuc2Zvcm1zLmRlbGV0ZShyKTt9fX0scGFzdGU6ZnVuY3Rpb24oZSx0LG4pe21zLnNldChuLCEwKTt2YXIgcj1lO2lmKCFuLmdldENvbmZpZygpLnJlYWRPbmx5JiZRZihuLHIudGFyZ2V0KSl7dmFyIG89bi5nZXRDb25maWcoKS5jdXN0b21QYXN0ZTtpZihvKWlmKCExPT09byhuLHIpKXJldHVybiB2b2lkIG1zLnNldChuLCExKTtpZighV3N8fGZ1bmN0aW9uKGUpe3JldHVybiBlLmNsaXBib2FyZERhdGEmJiIiIT09ZS5jbGlwYm9hcmREYXRhLmdldERhdGEoInRleHQvcGxhaW4iKSYmMT09PWUuY2xpcGJvYXJkRGF0YS50eXBlcy5sZW5ndGh9KHIpKXtyLnByZXZlbnREZWZhdWx0KCk7dmFyIGk9ci5jbGlwYm9hcmREYXRhO251bGwhPWkmJm4uaW5zZXJ0RGF0YShpKTt9fX0sZHJhZ292ZXI6ZnVuY3Rpb24oZSxuLHIpe2lmKGVkKHIsZS50YXJnZXQpKXt2YXIgbz1Icy50b1NsYXRlTm9kZShyLGUudGFyZ2V0KTt0LkVkaXRvci5pc1ZvaWQocixvKSYmZS5wcmV2ZW50RGVmYXVsdCgpO319LGRyYWdzdGFydDpmdW5jdGlvbihlLG4scil7dmFyIG89ZTtpZihlZChyLG8udGFyZ2V0KSYmIXIuZ2V0Q29uZmlnKCkucmVhZE9ubHkpe3ZhciBpPUhzLnRvU2xhdGVOb2RlKHIsby50YXJnZXQpLGE9SHMuZmluZFBhdGgocixpKTtpZih0LkVkaXRvci5pc1ZvaWQocixpKXx8dC5FZGl0b3Iudm9pZChyLHthdDphLHZvaWRzOiEwfSkpe3ZhciBzPXQuRWRpdG9yLnJhbmdlKHIsYSk7dC5UcmFuc2Zvcm1zLnNlbGVjdChyLHMpO312YXIgbD1vLmRhdGFUcmFuc2ZlcjtudWxsIT1sJiYobi5pc0RyYWdnaW5nSW50ZXJuYWxseT0hMCxyLnNldEZyYWdtZW50RGF0YShsKSk7fX0sZHJhZ2VuZDpmdW5jdGlvbihlLHQsbil7dmFyIHI9ZTtuLmdldENvbmZpZygpLnJlYWRPbmx5fHx0LmlzRHJhZ2dpbmdJbnRlcm5hbGx5JiZlZChuLHIudGFyZ2V0KSYmKHQuaXNEcmFnZ2luZ0ludGVybmFsbHk9ITEpO30sZHJvcDpmdW5jdGlvbihlLG4scil7dmFyIG89ZSxpPW8uZGF0YVRyYW5zZmVyO2lmKCFyLmdldENvbmZpZygpLnJlYWRPbmx5JiZlZChyLG8udGFyZ2V0KSYmbnVsbCE9aSYmIShXcyYmRnMmJmkuZmlsZXMubGVuZ3RoPjApKXtvLnByZXZlbnREZWZhdWx0KCk7dmFyIGE9ci5zZWxlY3Rpb24scz1Icy5maW5kRXZlbnRSYW5nZShyLG8pO3QuVHJhbnNmb3Jtcy5zZWxlY3QocixzKSxuLmlzRHJhZ2dpbmdJbnRlcm5hbGx5JiYoYSYmdC5UcmFuc2Zvcm1zLmRlbGV0ZShyLHthdDphfSksbi5pc0RyYWdnaW5nSW50ZXJuYWxseT0hMSksci5pbnNlcnREYXRhKGkpLHIuaXNGb2N1c2VkKCl8fHIuZm9jdXMoKTt9fX0sZmQ9MSxkZD1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoZSl7dmFyIG49dGhpczt0aGlzLmlkPWZkKyssdGhpcy4kdGV4dEFyZWE9bnVsbCx0aGlzLiRwcm9ncmVzc0Jhcj15LmRlZmF1bHQoJzxkaXYgY2xhc3M9InctZS1wcm9ncmVzcy1iYXIiPjwvZGl2PicpLHRoaXMuJG1heExlbmd0aEluZm89eS5kZWZhdWx0KCc8ZGl2IGNsYXNzPSJ3LWUtbWF4LWxlbmd0aC1pbmZvIj48L2Rpdj4nKSx0aGlzLmlzQ29tcG9zaW5nPSExLHRoaXMuaXNVcGRhdGluZ1NlbGVjdGlvbj0hMSx0aGlzLmlzRHJhZ2dpbmdJbnRlcm5hbGx5PSExLHRoaXMubGF0ZXN0RWxlbWVudD1udWxsLHRoaXMuc2hvd1BsYWNlaG9sZGVyPSExLHRoaXMuJHBsYWNlaG9sZGVyPW51bGwsdGhpcy5sYXRlc3RFZGl0b3JTZWxlY3Rpb249bnVsbCx0aGlzLm9uRE9NU2VsZWN0aW9uQ2hhbmdlPWIuZGVmYXVsdCgoZnVuY3Rpb24oKXt2YXIgZT1uLmVkaXRvckluc3RhbmNlOyFmdW5jdGlvbihlLG4pe3ZhciByPWUuaXNDb21wb3Npbmcsbz1lLmlzVXBkYXRpbmdTZWxlY3Rpb24saT1lLmlzRHJhZ2dpbmdJbnRlcm5hbGx5O2lmKCEobi5nZXRDb25maWcoKS5yZWFkT25seXx8cnx8b3x8aSkpe3ZhciBhPUhzLmZpbmREb2N1bWVudE9yU2hhZG93Um9vdChuKSxzPWEuYWN0aXZlRWxlbWVudCxsPUhzLnRvRE9NTm9kZShuLG4pLHU9YS5nZXRTZWxlY3Rpb24oKTtpZihzPT09bD8oZS5sYXRlc3RFbGVtZW50PXMsZ3Muc2V0KG4sITApKTpncy5kZWxldGUobiksIXUpcmV0dXJuIHQuVHJhbnNmb3Jtcy5kZXNlbGVjdChuKTt2YXIgYz11LmFuY2hvck5vZGUsZj11LmZvY3VzTm9kZSxkPVFmKG4sYyl8fFpmKG4sYykscD1RZihuLGYpfHxaZihuLGYpO2lmKGQmJnApe3ZhciBoPUhzLnRvU2xhdGVSYW5nZShuLHUse2V4YWN0TWF0Y2g6ITEsc3VwcHJlc3NUaHJvdzohMX0pO3QuVHJhbnNmb3Jtcy5zZWxlY3QobixoKTt9ZWxzZSB0LlRyYW5zZm9ybXMuZGVzZWxlY3Qobik7fX0obixlKTt9KSwxMDApO3ZhciByPXkuZGVmYXVsdChlKTtpZigwPT09ci5sZW5ndGgpdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgZmluZCB0ZXh0YXJlYSBET00gYnkgc2VsZWN0b3IgJyIrZSsiJyIpO3RoaXMuJGJveD1yO3ZhciBvPXkuZGVmYXVsdCgnPGRpdiBjbGFzcz0idy1lLXRleHQtY29udGFpbmVyIj48L2Rpdj4nKTtvLmFwcGVuZCh0aGlzLiRwcm9ncmVzc0Jhciksby5hcHBlbmQodGhpcy4kbWF4TGVuZ3RoSW5mbyksci5hcHBlbmQobyk7dmFyIGk9eS5kZWZhdWx0KCc8ZGl2IGNsYXNzPSJ3LWUtc2Nyb2xsIj48L2Rpdj4nKTtvLmFwcGVuZChpKSx0aGlzLiRzY3JvbGw9aSx0aGlzLiR0ZXh0QXJlYUNvbnRhaW5lcj1vLFV1KChmdW5jdGlvbigpe3ZhciBlPW4uZWRpdG9ySW5zdGFuY2UsdD1Icy5nZXRXaW5kb3coZSk7dC5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJzZWxlY3Rpb25jaGFuZ2UiLG4ub25ET01TZWxlY3Rpb25DaGFuZ2UpLGUub24oImRlc3Ryb3llZCIsKGZ1bmN0aW9uKCl7dC5kb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJzZWxlY3Rpb25jaGFuZ2UiLG4ub25ET01TZWxlY3Rpb25DaGFuZ2UpO30pKSxvLm9uKCJjbGljayIsKGZ1bmN0aW9uKCl7cmV0dXJuIGUuaGlkZVBhbmVsT3JNb2RhbCgpfSkpLGUub24oImNoYW5nZSIsbi5jaGFuZ2VWaWV3U3RhdGUuYmluZChuKSk7dmFyIHI9ZS5nZXRDb25maWcoKS5vbkNoYW5nZTtyJiZlLm9uKCJjaGFuZ2UiLChmdW5jdGlvbigpe3JldHVybiByKGUpfSkpLG4ub25Gb2N1c0FuZE9uQmx1cigpLGUub24oImNoYW5nZSIsbi5jaGFuZ2VNYXhMZW5ndGhJbmZvLmJpbmQobikpLG4uYmluZEV2ZW50KCk7fSkpO31yZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KGUucHJvdG90eXBlLCJlZGl0b3JJbnN0YW5jZSIse2dldDpmdW5jdGlvbigpe3ZhciBlPUphLmdldCh0aGlzKTtpZihudWxsPT1lKXRocm93IG5ldyBFcnJvcigiQ2FuIG5vdCBnZXQgZWRpdG9yIGluc3RhbmNlIik7cmV0dXJuIGV9LGVudW1lcmFibGU6ITEsY29uZmlndXJhYmxlOiEwfSksZS5wcm90b3R5cGUuYmluZEV2ZW50PWZ1bmN0aW9uKCl7dmFyIGU9dGhpcyx0PXRoaXMuJHRleHRBcmVhLG49dGhpcy4kc2Nyb2xsLHI9dGhpcy5lZGl0b3JJbnN0YW5jZTtudWxsIT10JiYobS5kZWZhdWx0KGNkLChmdW5jdGlvbihuLG8pe3Qub24obywoZnVuY3Rpb24odCl7bih0LGUscik7fSkpO30pKSxyLmdldENvbmZpZygpLnNjcm9sbCYmKG4uY3NzKCJvdmVyZmxvdy15IiwiYXV0byIpLG4ub24oInNjcm9sbCIsYi5kZWZhdWx0KChmdW5jdGlvbigpe3IuZW1pdCgic2Nyb2xsIik7fSksMTAwKSkpKTt9LGUucHJvdG90eXBlLm9uRm9jdXNBbmRPbkJsdXI9ZnVuY3Rpb24oKXt2YXIgZT10aGlzLHQ9dGhpcy5lZGl0b3JJbnN0YW5jZSxuPXQuZ2V0Q29uZmlnKCkscj1uLm9uQmx1cixvPW4ub25Gb2N1czt0aGlzLmxhdGVzdEVkaXRvclNlbGVjdGlvbj10LnNlbGVjdGlvbix0Lm9uKCJjaGFuZ2UiLChmdW5jdGlvbigpe251bGw9PWUubGF0ZXN0RWRpdG9yU2VsZWN0aW9uJiZudWxsIT10LnNlbGVjdGlvbj9zZXRUaW1lb3V0KChmdW5jdGlvbigpe3JldHVybiBvJiZvKHQpfSkpOm51bGwhPWUubGF0ZXN0RWRpdG9yU2VsZWN0aW9uJiZudWxsPT10LnNlbGVjdGlvbiYmc2V0VGltZW91dCgoZnVuY3Rpb24oKXtyZXR1cm4gciYmcih0KX0pKSxlLmxhdGVzdEVkaXRvclNlbGVjdGlvbj10LnNlbGVjdGlvbjt9KSk7fSxlLnByb3RvdHlwZS5jaGFuZ2VNYXhMZW5ndGhJbmZvPWZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5lZGl0b3JJbnN0YW5jZSx0PWUuZ2V0Q29uZmlnKCkubWF4TGVuZ3RoO2lmKHQpe3ZhciBuPXQtSHMuZ2V0TGVmdExlbmd0aE9mTWF4TGVuZ3RoKGUpO3RoaXMuJG1heExlbmd0aEluZm9bMF0uaW5uZXJIVE1MPW4rIi8iK3Q7fX0sZS5wcm90b3R5cGUuY2hhbmdlUHJvZ3Jlc3M9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy4kcHJvZ3Jlc3NCYXI7dC5jc3MoIndpZHRoIixlKyIlIiksZT49MTAwJiZzZXRUaW1lb3V0KChmdW5jdGlvbigpe3QuaGlkZSgpLHQuY3NzKCJ3aWR0aCIsIjAiKSx0LnNob3coKTt9KSwxZTMpO30sZS5wcm90b3R5cGUuY2hhbmdlVmlld1N0YXRlPWZ1bmN0aW9uKCl7dmFyIGU9dGhpcyx0PXRoaXMuZWRpdG9ySW5zdGFuY2U7emYodGhpcyx0KSxmdW5jdGlvbihlLHQpe3ZhciBuLHI9dC5nZXRDb25maWcoKS5wbGFjZWhvbGRlcjtpZihyKXt2YXIgbz10LmlzRW1wdHkoKTtpZihvJiYhZS5zaG93UGxhY2Vob2xkZXImJiFlLmlzQ29tcG9zaW5nKXtpZihudWxsPT1lLiRwbGFjZWhvbGRlcil7dmFyIGk9eS5kZWZhdWx0KCc8ZGl2IGNsYXNzPSJ3LWUtdGV4dC1wbGFjZWhvbGRlciI+JytyKyI8L2Rpdj4iKTtlLiR0ZXh0QXJlYUNvbnRhaW5lci5hcHBlbmQoaSksZS4kcGxhY2Vob2xkZXI9aTt9cmV0dXJuIGUuJHBsYWNlaG9sZGVyLnNob3coKSx2b2lkKGUuc2hvd1BsYWNlaG9sZGVyPSEwKX0hbyYmZS5zaG93UGxhY2Vob2xkZXImJihudWxsPT09KG49ZS4kcGxhY2Vob2xkZXIpfHx2b2lkIDA9PT1ufHxuLmhpZGUoKSxlLnNob3dQbGFjZWhvbGRlcj0hMSk7fX0odGhpcyx0KSxVdSgoZnVuY3Rpb24oKXt0ZChlLHQpO30pKTt9LGUucHJvdG90eXBlLmRlc3Ryb3k9ZnVuY3Rpb24oKXt0aGlzLiR0ZXh0QXJlYUNvbnRhaW5lci5yZW1vdmUoKTt9LGV9KCk7U2koIm1hdGNoIiwoZnVuY3Rpb24oZSx0LG4pe3JldHVybiBbZnVuY3Rpb24odCl7dmFyIG49Vih0aGlzKSxyPW51bGw9PXQ/dm9pZCAwOkFlKHQsZSk7cmV0dXJuIHI/VGUocix0LG4pOm5ldyBSZWdFeHAodClbZV0oZXIobikpfSxmdW5jdGlvbihlKXt2YXIgcj1PZSh0aGlzKSxvPWVyKGUpLGk9bih0LHIsbyk7aWYoaS5kb25lKXJldHVybiBpLnZhbHVlO2lmKCFyLmdsb2JhbClyZXR1cm4gamkocixvKTt2YXIgYT1yLnVuaWNvZGU7ci5sYXN0SW5kZXg9MDtmb3IodmFyIHMsbD1bXSx1PTA7bnVsbCE9PShzPWppKHIsbykpOyl7dmFyIGM9ZXIoc1swXSk7bFt1XT1jLCIiPT09YyYmKHIubGFzdEluZGV4PU9pKG8sRnQoci5sYXN0SW5kZXgpLGEpKSx1Kys7fXJldHVybiAwPT09dT9udWxsOmx9XX0pKTtmdW5jdGlvbiBwZChlKXtlLnJlbW92ZUF0dHIoIndpZHRoIiksZS5yZW1vdmVBdHRyKCJoZWlnaHQiKSxlLnJlbW92ZUF0dHIoImZpbGwiKSxlLnJlbW92ZUF0dHIoImNsYXNzIiksZS5yZW1vdmVBdHRyKCJ0IiksZS5yZW1vdmVBdHRyKCJwLWlkIik7dmFyIHQ9ZS5jaGlsZHJlbigpO3QubGVuZ3RoJiZwZCh0KTt9ZnVuY3Rpb24gaGQoKXtyZXR1cm4geS5kZWZhdWx0KCc8c3ZnIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik00OTguNyA2NTUuOGwtMTk3LjYtMjY4Yy04LjEtMTAuOS0wLjMtMjYuNCAxMy4zLTI2LjRoMzk1LjJjMTMuNiAwIDIxLjQgMTUuNCAxMy4zIDI2LjRsLTE5Ny42IDI2OGMtNi42IDktMjAgOS0yNi42IDB6Ij48L3BhdGg+PC9zdmc+Jyl9ZnVuY3Rpb24gZ2QoKXtyZXR1cm4geS5kZWZhdWx0KCc8ZGl2IGNsYXNzPSJ3LWUtYmFyLWRpdmlkZXIiPjwvZGl2PicpfWZ1bmN0aW9uIHZkKGUsdCxuLHIsbyl7aWYodm9pZCAwPT09byYmKG89ITEpLHQpe2lmKHIpe3ZhciBpPUFzPyJjbWQiOiJjdHJsIjtyPXIucmVwbGFjZSgibW9kIixpKTt9aWYobylyJiYoZS5hdHRyKCJkYXRhLXRvb2x0aXAiLHIpLGUuYWRkQ2xhc3MoInctZS1tZW51LXRvb2x0aXAtdjUiKSxlLmFkZENsYXNzKCJ0b29sdGlwLXJpZ2h0IikpO2Vsc2Uge3ZhciBhPXI/bisiXG4iK3I6bjtlLmF0dHIoImRhdGEtdG9vbHRpcCIsYSksZS5hZGRDbGFzcygidy1lLW1lbnUtdG9vbHRpcC12NSIpO319fXZhciB5ZD1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoZSx0LG4pe3ZhciByPXRoaXM7dm9pZCAwPT09biYmKG49ITEpLHRoaXMuJGVsZW09eS5kZWZhdWx0KCc8ZGl2IGNsYXNzPSJ3LWUtYmFyLWl0ZW0iPjwvZGl2PicpLHRoaXMuJGJ1dHRvbj15LmRlZmF1bHQoJzxidXR0b24gdHlwZT0iYnV0dG9uIj48L2J1dHRvbj4nKSx0aGlzLmRpc2FibGVkPSExLHRoaXMubWVudT10O3ZhciBvPXQudGFnLGk9dC53aWR0aDtpZigiYnV0dG9uIiE9PW8pdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHRhZyAnIitvKyInLCBleHBlY3RlZCAnYnV0dG9uJyIpO3ZhciBhPXQudGl0bGUscz10LmhvdGtleSxsPXZvaWQgMD09PXM/IiI6cyx1PXQuaWNvblN2ZyxjPXZvaWQgMD09PXU/IiI6dSxmPXRoaXMuJGJ1dHRvbjtpZihjKXt2YXIgZD15LmRlZmF1bHQoYyk7cGQoZCksZi5hcHBlbmQoZCk7fWVsc2UgZi50ZXh0KGEpO3ZkKGYsYyxhLGwsbiksbiYmYyYmZi5hcHBlbmQoeS5kZWZhdWx0KCc8c3BhbiBjbGFzcz0idGl0bGUiPicrYSsiPC9zcGFuPiIpKSxpJiZmLmNzcygid2lkdGgiLGkrInB4IiksZi5hdHRyKCJkYXRhLW1lbnUta2V5IixlKSx0aGlzLiRlbGVtLmFwcGVuZChmKSxVdSgoZnVuY3Rpb24oKXtyZXR1cm4gci5pbml0KCl9KSk7fXJldHVybiBlLnByb3RvdHlwZS5pbml0PWZ1bmN0aW9uKCl7dmFyIGU9dGhpczt0aGlzLnNldEFjdGl2ZSgpLHRoaXMuc2V0RGlzYWJsZWQoKSx0aGlzLiRidXR0b24ub24oImNsaWNrIiwoZnVuY3Rpb24odCl7dC5wcmV2ZW50RGVmYXVsdCgpLE5kKGUpLmhpZGVQYW5lbE9yTW9kYWwoKSxlLmRpc2FibGVkfHwoZS5leGVjKCksZS5vbkJ1dHRvbkNsaWNrKCkpO30pKTt9LGUucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24oKXt2YXIgZT1OZCh0aGlzKSx0PXRoaXMubWVudSxuPXQuZ2V0VmFsdWUoZSk7dC5leGVjKGUsbik7fSxlLnByb3RvdHlwZS5zZXRBY3RpdmU9ZnVuY3Rpb24oKXt2YXIgZT1OZCh0aGlzKSx0PXRoaXMuJGJ1dHRvbixuPSJhY3RpdmUiO3RoaXMubWVudS5pc0FjdGl2ZShlKT90LmFkZENsYXNzKG4pOnQucmVtb3ZlQ2xhc3Mobik7fSxlLnByb3RvdHlwZS5zZXREaXNhYmxlZD1mdW5jdGlvbigpe3ZhciBlPU5kKHRoaXMpLHQ9dGhpcy4kYnV0dG9uLG49dGhpcy5tZW51LmlzRGlzYWJsZWQoZSk7KG51bGw9PWUuc2VsZWN0aW9ufHxlLmlzRGlzYWJsZWQoKSkmJihuPSEwKSx0aGlzLm1lbnUuYWx3YXlzRW5hYmxlJiYobj0hMSk7dmFyIHI9ImRpc2FibGVkIjtuP3QuYWRkQ2xhc3Mocik6dC5yZW1vdmVDbGFzcyhyKSx0aGlzLmRpc2FibGVkPW47fSxlLnByb3RvdHlwZS5jaGFuZ2VNZW51U3RhdGU9ZnVuY3Rpb24oKXt0aGlzLnNldEFjdGl2ZSgpLHRoaXMuc2V0RGlzYWJsZWQoKTt9LGV9KCksbWQ9ZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdCh0LG4scil7cmV0dXJuIHZvaWQgMD09PXImJihyPSExKSxlLmNhbGwodGhpcyx0LG4scil8fHRoaXN9cmV0dXJuIFVpKHQsZSksdC5wcm90b3R5cGUub25CdXR0b25DbGljaz1mdW5jdGlvbigpe30sdH0oeWQpLGJkPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZShlKXt0aGlzLmlzU2hvdz0hMSx0aGlzLnNob3dUaW1lPTAsdGhpcy5yZWNvcmQoZSk7fXJldHVybiBlLnByb3RvdHlwZS5yZWNvcmQ9ZnVuY3Rpb24oZSl7dmFyIHQ9dHMuZ2V0KGUpO251bGw9PXQmJih0PW5ldyBTZXQsdHMuc2V0KGUsdCkpLHQuYWRkKHRoaXMpLG5zLnNldCh0aGlzLGUpO30sZS5wcm90b3R5cGUucmVuZGVyQ29udGVudD1mdW5jdGlvbihlKXt2YXIgdD10aGlzLiRlbGVtO3QuZW1wdHkoKSx0LmFwcGVuZChlKTt2YXIgbj10aGlzLmdlblNlbGZFbGVtKCk7biYmdC5hcHBlbmQobik7fSxlLnByb3RvdHlwZS5hcHBlbmRUbz1mdW5jdGlvbihlKXt2YXIgdD10aGlzLiRlbGVtO2UuYXBwZW5kKHQpO30sZS5wcm90b3R5cGUuc2hvdz1mdW5jdGlvbigpe2lmKCF0aGlzLmlzU2hvdyl7dGhpcy5zaG93VGltZT1EYXRlLm5vdygpLHRoaXMuJGVsZW0uc2hvdygpLHRoaXMuaXNTaG93PSEwO3ZhciBlPW5zLmdldCh0aGlzKTtlJiZlLmVtaXQoIm1vZGFsT3JQYW5lbFNob3ciLHRoaXMpO319LGUucHJvdG90eXBlLmhpZGU9ZnVuY3Rpb24oKXtpZih0aGlzLmlzU2hvdyYmIShEYXRlLm5vdygpLXRoaXMuc2hvd1RpbWU8MjAwKSl7dGhpcy4kZWxlbS5oaWRlKCksdGhpcy5pc1Nob3c9ITE7dmFyIGU9bnMuZ2V0KHRoaXMpO2UmJmUuZW1pdCgibW9kYWxPclBhbmVsSGlkZSIpO319LGV9KCksd2Q9ZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdCh0KXt2YXIgbj1lLmNhbGwodGhpcyx0KXx8dGhpcztyZXR1cm4gbi50eXBlPSJkcm9wUGFuZWwiLG4uJGVsZW09eS5kZWZhdWx0KCc8ZGl2IGNsYXNzPSJ3LWUtZHJvcC1wYW5lbCI+PC9kaXY+Jyksbn1yZXR1cm4gVWkodCxlKSx0LnByb3RvdHlwZS5nZW5TZWxmRWxlbT1mdW5jdGlvbigpe3JldHVybiBudWxsfSx0fShiZCkseGQ9ZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdCh0LG4scil7dm9pZCAwPT09ciYmKHI9ITEpO3ZhciBvPWUuY2FsbCh0aGlzLHQsbixyKXx8dGhpcztpZihvLmRyb3BQYW5lbD1udWxsLG8ubWVudT1uLG4uc2hvd0Ryb3BQYW5lbCl7dmFyIGk9aGQoKTtvLiRidXR0b24uYXBwZW5kKGkpO31yZXR1cm4gb31yZXR1cm4gVWkodCxlKSx0LnByb3RvdHlwZS5vbkJ1dHRvbkNsaWNrPWZ1bmN0aW9uKCl7dGhpcy5tZW51LnNob3dEcm9wUGFuZWwmJnRoaXMuaGFuZGxlRHJvcFBhbmVsKCk7fSx0LnByb3RvdHlwZS5oYW5kbGVEcm9wUGFuZWw9ZnVuY3Rpb24oKXt2YXIgZT10aGlzLm1lbnU7aWYobnVsbCE9ZS5nZXRQYW5lbENvbnRlbnRFbGVtKXt2YXIgdD1OZCh0aGlzKTtpZihudWxsPT10aGlzLmRyb3BQYW5lbCl7dmFyIG49bmV3IHdkKHQpLHI9ZS5nZXRQYW5lbENvbnRlbnRFbGVtKHQpO24ucmVuZGVyQ29udGVudChyKSxuLmFwcGVuZFRvKHRoaXMuJGVsZW0pLG4uc2hvdygpLHRoaXMuZHJvcFBhbmVsPW47fWVsc2Uge3ZhciBvPXRoaXMuZHJvcFBhbmVsO2lmKG8uaXNTaG93KW8uaGlkZSgpO2Vsc2Uge3I9ZS5nZXRQYW5lbENvbnRlbnRFbGVtKHQpO28ucmVuZGVyQ29udGVudChyKSxvLnNob3coKTt9fXZhciBpPXRoaXMuZHJvcFBhbmVsO2lmKGkuaXNTaG93KXt2YXIgYT10aGlzLiRlbGVtLHM9YS5vZmZzZXQoKS5sZWZ0LGw9YS5wYXJlbnRzKCIudy1lLWJhciIpO3MtbC5vZmZzZXQoKS5sZWZ0Pj1sLndpZHRoKCkvMj9pLiRlbGVtLmNzcyh7bGVmdDoibm9uZSIscmlnaHQ6IjAifSk6aS4kZWxlbS5jc3Moe2xlZnQ6IjAiLHJpZ2h0OiJub25lIn0pO319fSx0fSh5ZCksRWQ9ZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdCh0LG4pe3ZvaWQgMD09PW4mJihuPTApO3ZhciByPWUuY2FsbCh0aGlzLHQpfHx0aGlzO3IudHlwZT0ibW9kYWwiLHIuJGVsZW09eS5kZWZhdWx0KCc8ZGl2IGNsYXNzPSJ3LWUtbW9kYWwiPjwvZGl2PicpLHIud2lkdGg9MCxuJiYoci53aWR0aD1uKTt2YXIgbz1yLiRlbGVtO3JldHVybiBvLm9uKCJjbGljayIsKGZ1bmN0aW9uKGUpe3JldHVybiBlLnN0b3BQcm9wYWdhdGlvbigpfSkpLG8ub24oImtleXVwIiwoZnVuY3Rpb24oZSl7IkVzY2FwZSI9PT1lLmNvZGUmJihyLmhpZGUoKSx0LnJlc3RvcmVTZWxlY3Rpb24oKSk7fSkpLHJ9cmV0dXJuIFVpKHQsZSksdC5wcm90b3R5cGUuZ2VuU2VsZkVsZW09ZnVuY3Rpb24oKXt2YXIgZT10aGlzLHQ9eS5kZWZhdWx0KCc8c3BhbiBjbGFzcz0iYnRuLWNsb3NlIj48c3ZnIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik0xMDI0IDg5Ni4xMDI0bC0xMjggMTI4TDUxMiA2NDAgMTI4IDEwMjQgMCA4OTYgMzg0IDUxMiAwIDEyOCAxMjggMCA1MTIgMzg0IDg5Ni4xMDI0IDBsMTI4IDEyOEw2NDAgNTEyeiI+PC9wYXRoPjwvc3ZnPjwvc3Bhbj4nKSxuPW5zLmdldCh0aGlzKTtyZXR1cm4gdC5vbigiY2xpY2siLChmdW5jdGlvbigpe2UuaGlkZSgpLG51bGw9PW58fG4ucmVzdG9yZVNlbGVjdGlvbigpO30pKSx0fSx0LnByb3RvdHlwZS5zZXRTdHlsZT1mdW5jdGlvbihlKXt2YXIgdD10aGlzLndpZHRoLG49dGhpcy4kZWxlbTtuLmF0dHIoInN0eWxlIiwiIiksdCYmbi5jc3MoIndpZHRoIix0KyJweCIpLG4uY3NzKGUpO30sdH0oYmQpO3ZhciBTZD1mdW5jdGlvbihlKXtmdW5jdGlvbiBuKHQsbixyKXt2b2lkIDA9PT1yJiYocj0hMSk7dmFyIG89ZS5jYWxsKHRoaXMsdCxuLHIpfHx0aGlzO3JldHVybiBvLiRib2R5PXkuZGVmYXVsdCgiYm9keSIpLG8ubW9kYWw9bnVsbCxvLm1lbnU9bixvfXJldHVybiBVaShuLGUpLG4ucHJvdG90eXBlLm9uQnV0dG9uQ2xpY2s9ZnVuY3Rpb24oKXt0aGlzLm1lbnUuc2hvd01vZGFsJiZ0aGlzLmhhbmRsZU1vZGFsKCk7fSxuLnByb3RvdHlwZS5nZXRQb3NpdGlvbj1mdW5jdGlvbigpe3ZhciBlPU5kKHRoaXMpLG49dGhpcy5tZW51LmdldE1vZGFsUG9zaXRpb25Ob2RlKGUpO3JldHVybiB0LkVsZW1lbnQuaXNFbGVtZW50KG4pP21mKGUsbiwibW9kYWwiKTp5ZihlKX0sbi5wcm90b3R5cGUuaGFuZGxlTW9kYWw9ZnVuY3Rpb24oKXt2YXIgZT1OZCh0aGlzKSx0PXRoaXMubWVudTtpZihudWxsPT10aGlzLm1vZGFsKXt2YXIgbj1uZXcgRWQoZSx0Lm1vZGFsV2lkdGgpO3RoaXMucmVuZGVyQW5kU2hvd01vZGFsKG4sITApLHRoaXMubW9kYWw9bjt9ZWxzZSB7KG49dGhpcy5tb2RhbCkuaXNTaG93P24uaGlkZSgpOnRoaXMucmVuZGVyQW5kU2hvd01vZGFsKG4sITEpO319LG4ucHJvdG90eXBlLnJlbmRlckFuZFNob3dNb2RhbD1mdW5jdGlvbihlLHQpe3ZvaWQgMD09PXQmJih0PSExKTt2YXIgbj1OZCh0aGlzKSxyPXRoaXMubWVudTtpZihudWxsIT1yLmdldE1vZGFsQ29udGVudEVsZW0pe3ZhciBvPUhzLmdldFRleHRhcmVhKG4pLGk9SHMuZ2V0VG9vbGJhcihuKSxhPSgobnVsbD09aT92b2lkIDA6aS5nZXRDb25maWcoKSl8fHt9KS5tb2RhbEFwcGVuZFRvQm9keSxzPXIuZ2V0TW9kYWxDb250ZW50RWxlbShuKTtpZihlLnJlbmRlckNvbnRlbnQocyksYSllLnNldFN0eWxlKHtsZWZ0OiIwIixyaWdodDoiMCJ9KTtlbHNlIHt2YXIgbD10aGlzLmdldFBvc2l0aW9uKCk7ZS5zZXRTdHlsZShsKTt9dCYmKGE/ZS5hcHBlbmRUbyh0aGlzLiRib2R5KTplLmFwcGVuZFRvKG8uJHRleHRBcmVhQ29udGFpbmVyKSksZS5zaG93KCksYXx8YmYobixlLiRlbGVtKSxzZXRUaW1lb3V0KChmdW5jdGlvbigpe24uYmx1cigpO30pKTt9fSxufSh5ZCk7dmFyIGtkPWZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHQodCxuKXt2YXIgcj1lLmNhbGwodGhpcyx0KXx8dGhpcztyZXR1cm4gci50eXBlPSJzZWxlY3RMaXN0IixyLiRlbGVtPXkuZGVmYXVsdCgnPGRpdiBjbGFzcz0idy1lLXNlbGVjdC1saXN0Ij48L2Rpdj4nKSxuJiZyLiRlbGVtLmNzcygid2lkdGgiLG4rInB4Iiksci4kZWxlbS5vbigiY2xpY2siLChmdW5jdGlvbihlKXtlLnN0b3BQcm9wYWdhdGlvbigpO30pKSxyfXJldHVybiBVaSh0LGUpLHQucHJvdG90eXBlLnJlbmRlckxpc3Q9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy4kZWxlbTt0LmVtcHR5KCk7dmFyIG49eS5kZWZhdWx0KCI8dWw+PC91bD4iKTtlLmZvckVhY2goKGZ1bmN0aW9uKGUpe3ZhciB0PWUudmFsdWUscj1lLnRleHQsbz1lLnNlbGVjdGVkLGk9ZS5zdHlsZUZvclJlbmRlck1lbnVMaXN0LGE9eS5kZWZhdWx0KCc8bGkgZGF0YS12YWx1ZT0iJyt0KyciPjwvbGk+Jyk7aWYoaSYmYS5jc3MoaSksbyl7dmFyIHM9eS5kZWZhdWx0KCc8c3ZnIHZpZXdCb3g9IjAgMCAxNDQ2IDEwMjQiPjxwYXRoIGQ9Ik01NzQuMTE2Mjk5IDc4Ni43MzYzOTIgMTIzOC44MTEyNDkgNDguNTE3ODYyQzEyNzIuMzkwMjIyIDExLjIyNDYzNSAxMzI5LjQxNDc5OSA3LjgyNzcxOCAxMzY2Ljc1NjY0IDQxLjQ1MDQ2MiAxNDAzLjg0MDAxNSA3NC44NDA0ODQgMTQwNi43MzEwNDMgMTMyLjA4NDc0MSAxMzczLjEwMTg5IDE2OS40MzM2OTlMNjU1LjExODg4OCA5NjYuODM0NjA3QzY1My4wNzI0MjEgOTY5LjcxNjg3NSA2NTAuODM1ODA3IDk3Mi41MTQzMzcgNjQ4LjQwNzkzOCA5NzUuMjEwNzU5IDYxNS4wMTc5NTcgMTAxMi4yOTQwOSA1NTguMjkyMTU1IDEwMTUuNjUyMDE5IDUyMS4xOTU2NjQgOTgyLjI1MDE4OEw3Mi43NzgyMTggNTc4LjQ5MzMwNkMzNS45MTA4MjYgNTQ1LjI5Nzc1OCAzMi44NTkwNDEgNDg4LjU4NDAxOSA2Ni40ODE4MjUgNDUxLjI0MjEzNCA5OS44NzE4MDcgNDE0LjE1ODgwMyAxNTYuNTk3NTYzIDQxMC44MDA4MzQgMTkzLjY5NDA1NSA0NDQuMjAyNjY1TDU3NC4xMTYyOTkgNzg2LjczNjM5MloiPjwvcGF0aD48L3N2Zz4nKTthLmFwcGVuZChzKSxhLmFkZENsYXNzKCJzZWxlY3RlZCIpO31hLmFwcGVuZCh5LmRlZmF1bHQoJzxzcGFuIGRhdGEtdmFsdWU9IicrdCsnIj4nK3IrIjwvc3Bhbj4iKSksYS5hdHRyKCJ0aXRsZSIsciksbi5hcHBlbmQoYSk7fSkpLHQuYXBwZW5kKG4pO30sdC5wcm90b3R5cGUuZ2VuU2VsZkVsZW09ZnVuY3Rpb24oKXtyZXR1cm4gbnVsbH0sdH0oYmQpO3ZhciBPZD1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoZSx0LG4pe3ZhciByPXRoaXM7dm9pZCAwPT09biYmKG49ITEpLHRoaXMuJGVsZW09eS5kZWZhdWx0KCc8ZGl2IGNsYXNzPSJ3LWUtYmFyLWl0ZW0iPjwvZGl2PicpLHRoaXMuJGJ1dHRvbj15LmRlZmF1bHQoJzxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0ic2VsZWN0LWJ1dHRvbiI+PC9idXR0b24+JyksdGhpcy5kaXNhYmxlZD0hMSx0aGlzLnNlbGVjdExpc3Q9bnVsbDt2YXIgbz10LnRhZyxpPXQudGl0bGUsYT10LndpZHRoLHM9dC5pY29uU3ZnLGw9dm9pZCAwPT09cz8iIjpzLHU9dC5ob3RrZXksYz12b2lkIDA9PT11PyIiOnU7aWYoInNlbGVjdCIhPT1vKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCB0YWcgJyIrbysiJywgZXhwZWN0ZWQgJ3NlbGVjdCciKTt2YXIgZj10aGlzLiRidXR0b247YSYmZi5jc3MoIndpZHRoIixhKyJweCIpLGYuYXR0cigiZGF0YS1tZW51LWtleSIsZSksdmQoZixsLGksYyxuKSx0aGlzLiRlbGVtLmFwcGVuZChmKSx0aGlzLm1lbnU9dCxVdSgoZnVuY3Rpb24oKXtyZXR1cm4gci5pbml0KCl9KSk7fXJldHVybiBlLnByb3RvdHlwZS5pbml0PWZ1bmN0aW9uKCl7dmFyIGU9dGhpczt0aGlzLnNldFNlbGVjdGVkVmFsdWUoKSx0aGlzLiRidXR0b24ub24oImNsaWNrIiwoZnVuY3Rpb24odCl7dC5wcmV2ZW50RGVmYXVsdCgpLE5kKGUpLmhpZGVQYW5lbE9yTW9kYWwoKSxlLnRyaWdnZXIoKTt9KSk7fSxlLnByb3RvdHlwZS50cmlnZ2VyPWZ1bmN0aW9uKCl7dmFyIGU9dGhpcyx0PU5kKHRoaXMpO2lmKCF0LmlzRGlzYWJsZWQoKSYmIXRoaXMuZGlzYWJsZWQpe3ZhciBuPXRoaXMubWVudTtpZihudWxsPT10aGlzLnNlbGVjdExpc3Qpe3RoaXMuc2VsZWN0TGlzdD1uZXcga2QodCxuLnNlbGVjdFBhbmVsV2lkdGgpO3ZhciByPXRoaXMuc2VsZWN0TGlzdCxvPW4uZ2V0T3B0aW9ucyh0KTtyLnJlbmRlckxpc3Qobyksci5hcHBlbmRUbyh0aGlzLiRlbGVtKSxyLnNob3coKSxyLiRlbGVtLm9uKCJjbGljayIsImxpIiwoZnVuY3Rpb24odCl7dmFyIG49dC50YXJnZXQ7aWYobnVsbCE9bil7dC5wcmV2ZW50RGVmYXVsdCgpO3ZhciByPXkuZGVmYXVsdChuKS5hdHRyKCJkYXRhLXZhbHVlIik7ZS5vbkNoYW5nZShyKTt9fSkpO31lbHNlIHtpZigocj10aGlzLnNlbGVjdExpc3QpLmlzU2hvdylyLmhpZGUoKTtlbHNlIHtvPW4uZ2V0T3B0aW9ucyh0KTtyLnJlbmRlckxpc3Qobyksci5zaG93KCk7fX19fSxlLnByb3RvdHlwZS5vbkNoYW5nZT1mdW5jdGlvbihlKXt2YXIgdD1OZCh0aGlzKSxuPXRoaXMubWVudTtuLmV4ZWMmJm4uZXhlYyh0LGUpO30sZS5wcm90b3R5cGUuc2V0U2VsZWN0ZWRWYWx1ZT1mdW5jdGlvbigpe3ZhciBlPU5kKHRoaXMpLHQ9dGhpcy5tZW51LG49dC5nZXRWYWx1ZShlKSxyPWZ1bmN0aW9uKGUsdCl7Zm9yKHZhciBuPWUubGVuZ3RoLHI9IiIsbz0wO288bjtvKyspe3ZhciBpPWVbb107aWYoaS52YWx1ZT09PXQpe3I9aS50ZXh0O2JyZWFrfX1yZXR1cm4gcn0odC5nZXRPcHRpb25zKGUpLG4udG9TdHJpbmcoKSksbz10aGlzLiRidXR0b24saT1oZCgpO28uZW1wdHkoKSxvLnRleHQociksby5hcHBlbmQoaSk7fSxlLnByb3RvdHlwZS5zZXREaXNhYmxlZD1mdW5jdGlvbigpe3ZhciBlPU5kKHRoaXMpLHQ9dGhpcy5tZW51LmlzRGlzYWJsZWQoZSksbj10aGlzLiRidXR0b247KG51bGw9PWUuc2VsZWN0aW9ufHxlLmlzRGlzYWJsZWQoKSkmJih0PSEwKTt2YXIgcj0iZGlzYWJsZWQiO3Q/bi5hZGRDbGFzcyhyKTpuLnJlbW92ZUNsYXNzKHIpLHRoaXMuZGlzYWJsZWQ9dDt9LGUucHJvdG90eXBlLmNoYW5nZU1lbnVTdGF0ZT1mdW5jdGlvbigpe3RoaXMuc2V0U2VsZWN0ZWRWYWx1ZSgpLHRoaXMuc2V0RGlzYWJsZWQoKTt9LGV9KCksQ2Q9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKGUpe3RoaXMuJGVsZW09eS5kZWZhdWx0KCc8ZGl2IGNsYXNzPSJ3LWUtYmFyLWl0ZW0gdy1lLWJhci1pdGVtLWdyb3VwIj48L2Rpdj4nKSx0aGlzLiRjb250YWluZXI9eS5kZWZhdWx0KCc8ZGl2IGNsYXNzPSJ3LWUtYmFyLWl0ZW0tbWVudXMtY29udGFpbmVyIj48L2Rpdj4nKSx0aGlzLiRidXR0b249eS5kZWZhdWx0KCc8YnV0dG9uIHR5cGU9ImJ1dHRvbiI+PC9idXR0b24+Jyk7dmFyIHQ9ZS5rZXksbj1lLmljb25Tdmcscj1lLnRpdGxlLG89dGhpcy4kZWxlbSxpPXRoaXMuJGJ1dHRvbjtpZihuKXt2YXIgYT15LmRlZmF1bHQobik7cGQoYSksaS5hcHBlbmQoYSk7fWVsc2UgaS50ZXh0KHIpO2kuYXR0cigiZGF0YS1tZW51LWtleSIsdCk7dmFyIHM9aGQoKTtpLmFwcGVuZChzKSxvLmFwcGVuZChpKTt2YXIgbD10aGlzLiRjb250YWluZXI7by5hcHBlbmQobCk7dmFyIHU9dGhpcy5jcmVhdGVPYnNlcnZlcigpO3RoaXMub2JzZXJ2ZSh1KTt9cmV0dXJuIGUucHJvdG90eXBlLmFwcGVuZEJhckl0ZW09ZnVuY3Rpb24oZSl7dmFyIHQ9ZS4kZWxlbTt0aGlzLiRjb250YWluZXIuYXBwZW5kKHQpO30sZS5wcm90b3R5cGUub2JzZXJ2ZT1mdW5jdGlvbihlKXt2YXIgdD10aGlzLiRjb250YWluZXI7ZS5vYnNlcnZlKHRbMF0se2NoaWxkTGlzdDohMCxzdWJ0cmVlOiEwLGF0dHJpYnV0ZXM6ITB9KTt9LGUucHJvdG90eXBlLmNyZWF0ZU9ic2VydmVyPWZ1bmN0aW9uKCl7dmFyIGU9dGhpcyx0PXRoaXMuJGNvbnRhaW5lcixuPXRoaXMuJGJ1dHRvbixyPW5ldyBNdXRhdGlvbk9ic2VydmVyKChmdW5jdGlvbigpe3ZhciBvPXQuZmluZCgiYnV0dG9uIiksaT1vLmxlbmd0aDtpZigwIT09aSl7dmFyIGE9MDtvLmVhY2goKGZ1bmN0aW9uKGUpe3kuZGVmYXVsdChlKS5oYXNDbGFzcygiZGlzYWJsZWQiKSYmYSsrO30pKSxyLmRpc2Nvbm5lY3QoKSxhPT09aT9uLmFkZENsYXNzKCJkaXNhYmxlZCIpOm4ucmVtb3ZlQ2xhc3MoImRpc2FibGVkIiksZS5vYnNlcnZlKHIpO319KSk7cmV0dXJuIHJ9LGV9KCksVGQ9bmV3IFdlYWtNYXA7ZnVuY3Rpb24gTmQoZSl7dmFyIHQ9ZXMuZ2V0KGUpO2lmKG51bGw9PXQpdGhyb3cgbmV3IEVycm9yKCJDYW4gbm90IGdldCBlZGl0b3IgaW5zdGFuY2UiKTtyZXR1cm4gdH1mdW5jdGlvbiBNZChlLHQsbil7dm9pZCAwPT09biYmKG49ITEpO3ZhciByPVRkLmdldCh0KTtpZihyKXJldHVybiByO3ZhciBvPXQudGFnO2lmKCJidXR0b24iPT09byl7dmFyIGk9dC5zaG93RHJvcFBhbmVsLGE9dC5zaG93TW9kYWw7cj1pP25ldyB4ZChlLHQsbik6YT9uZXcgU2QoZSx0LG4pOm5ldyBtZChlLHQsbik7fWlmKCJzZWxlY3QiPT09byYmKHI9bmV3IE9kKGUsdCxuKSksbnVsbD09cil0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgdGFnIGluIG1lbnUgIitKU09OLnN0cmluZ2lmeSh0KSk7cmV0dXJuIFRkLnNldCh0LHIpLHJ9ZnVuY3Rpb24gTGQoZSxuKXt2YXIgcj1lLnNlbGVjdGlvbjtyZXR1cm4gbnVsbCE9ciYmKCF0LlJhbmdlLmlzQ29sbGFwc2VkKHIpJiYoIUhzLmdldFNlbGVjdGVkRWxlbXMoZSkuc29tZSgoZnVuY3Rpb24odCl7aWYoZS5pc1ZvaWQodCkpcmV0dXJuICEwO3ZhciBuPXQudHlwZTtyZXR1cm4gISFbInByZSIsImNvZGUiLCJ0YWJsZSJdLmluY2x1ZGVzKG4pfHx2b2lkIDB9KSkmJiEhdC5UZXh0LmlzVGV4dChuKSkpfXZhciBQZD1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoKXt2YXIgZT10aGlzO3RoaXMuJGVsZW09eS5kZWZhdWx0KCc8ZGl2IGNsYXNzPSJ3LWUtYmFyIHctZS1iYXItaGlkZGVuIHctZS1ob3Zlci1iYXIiPjwvZGl2PicpLHRoaXMubWVudXM9e30sdGhpcy5ob3ZlcmJhckl0ZW1zPVtdLHRoaXMucHJldlNlbGVjdGVkTm9kZT1udWxsLHRoaXMuaXNTaG93PSExLHRoaXMuY2hhbmdlSG92ZXJiYXJTdGF0ZT14LmRlZmF1bHQoKGZ1bmN0aW9uKCl7dmFyIG49ZS5pc1Nob3cscj1lLmdldFNlbGVjdGVkTm9kZUFuZE1lbnVLZXlzKCl8fHt9LG89ci5ub2RlLGk9dm9pZCAwPT09bz9udWxsOm8sYT1yLm1lbnVLZXlzLHM9dm9pZCAwPT09YT9bXTphO2lmKChudWxsIT1pJiZlLmNoYW5nZUl0ZW1zU3RhdGUoKSxpJiZ0LkVsZW1lbnQuaXNFbGVtZW50KGkpKSYmKG4mJmUuaXNTYW1lUGF0aChpLGUucHJldlNlbGVjdGVkTm9kZSkpKXJldHVybjtlLmhpZGVBbmRDbGVhbigpLG51bGwhPWkmJihlLnJlZ2lzdGVySXRlbXMocyksZS5zZXRQb3NpdGlvbihpKSxlLnNob3coKSksZS5wcmV2U2VsZWN0ZWROb2RlPWk7fSksMjAwKSxVdSgoZnVuY3Rpb24oKXt2YXIgdD1lLmdldEVkaXRvckluc3RhbmNlKCksbj1lLiRlbGVtO24ub24oIm1vdXNlZG93biIsKGZ1bmN0aW9uKGUpe3JldHVybiBlLnByZXZlbnREZWZhdWx0KCl9KSx7cGFzc2l2ZTohMX0pLEhzLmdldFRleHRhcmVhKHQpLiR0ZXh0QXJlYUNvbnRhaW5lci5hcHBlbmQobiksdC5vbigiY2hhbmdlIixlLmNoYW5nZUhvdmVyYmFyU3RhdGUpO3ZhciByPWUuaGlkZUFuZENsZWFuLmJpbmQoZSk7dC5vbigic2Nyb2xsIixyKSx0Lm9uKCJmdWxsU2NyZWVuIixyKSx0Lm9uKCJ1bkZ1bGxTY3JlZW4iLHIpO30pKTt9cmV0dXJuIGUucHJvdG90eXBlLmdldE1lbnVzPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubWVudXN9LGUucHJvdG90eXBlLmhpZGVBbmRDbGVhbj1mdW5jdGlvbigpe3ZhciBlPXRoaXMuJGVsZW07ZS5yZW1vdmVDbGFzcygidy1lLWJhci1zaG93IikuYWRkQ2xhc3MoInctZS1iYXItaGlkZGVuIiksdGhpcy5ob3ZlcmJhckl0ZW1zPVtdLGUuZW1wdHkoKSx0aGlzLmlzU2hvdz0hMTt9LGUucHJvdG90eXBlLmNoZWNrUG9zaXRpb25Cb3R0b209ZnVuY3Rpb24oKXt2YXIgZT10aGlzLiRlbGVtLHQ9ITEsbj13aW5kb3cuaW5uZXJIZWlnaHQ7biYmbj49MzYwJiYobi1lWzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmJvdHRvbTwzNjAmJih0PSEwKSk7dD9lLmFkZENsYXNzKCJ3LWUtYmFyLWJvdHRvbSIpOmUucmVtb3ZlQ2xhc3MoInctZS1iYXItYm90dG9tIik7fSxlLnByb3RvdHlwZS5zaG93PWZ1bmN0aW9uKCl7dGhpcy4kZWxlbS5yZW1vdmVDbGFzcygidy1lLWJhci1oaWRkZW4iKS5hZGRDbGFzcygidy1lLWJhci1zaG93IiksdGhpcy5pc1Nob3c9ITAsdGhpcy5jaGVja1Bvc2l0aW9uQm90dG9tKCk7fSxlLnByb3RvdHlwZS5jaGFuZ2VJdGVtc1N0YXRlPWZ1bmN0aW9uKCl7dmFyIGU9dGhpcztVdSgoZnVuY3Rpb24oKXtlLmhvdmVyYmFySXRlbXMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7ZS5jaGFuZ2VNZW51U3RhdGUoKTt9KSk7fSkpO30sZS5wcm90b3R5cGUucmVnaXN0ZXJJdGVtcz1mdW5jdGlvbihlKXt2YXIgdD10aGlzLG49dGhpcy4kZWxlbTtlLmZvckVhY2goKGZ1bmN0aW9uKGUpe2lmKCJ8IiE9PWUpdC5yZWdpc3RlclNpbmdsZUl0ZW0oZSk7ZWxzZSB7dmFyIHI9Z2QoKTtuLmFwcGVuZChyKTt9fSkpO30sZS5wcm90b3R5cGUucmVnaXN0ZXJTaW5nbGVJdGVtPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMuZ2V0RWRpdG9ySW5zdGFuY2UoKSxuPXRoaXMubWVudXMscj1uW2VdO2lmKG51bGw9PXIpe3ZhciBvPVVzW2VdO2lmKG51bGw9PW8pdGhyb3cgbmV3IEVycm9yKCJOb3QgZm91bmQgbWVudSBpdGVtIGZhY3RvcnkgYnkga2V5ICciK2UrIiciKTtpZigiZnVuY3Rpb24iIT10eXBlb2Ygbyl0aHJvdyBuZXcgRXJyb3IoIk1lbnUgaXRlbSBmYWN0b3J5IChrZXk9JyIrZSsiJykgaXMgbm90IGEgZnVuY3Rpb24iKTtyPW8oKSxuW2VdPXI7fXZhciBpPU1kKGUscik7dGhpcy5ob3ZlcmJhckl0ZW1zLnB1c2goaSksZXMuc2V0KGksdCksdGhpcy4kZWxlbS5hcHBlbmQoaS4kZWxlbSk7fSxlLnByb3RvdHlwZS5zZXRQb3NpdGlvbj1mdW5jdGlvbihlKXt2YXIgbj10aGlzLmdldEVkaXRvckluc3RhbmNlKCkscj10aGlzLiRlbGVtO2lmKHIuYXR0cigic3R5bGUiLCIiKSx0LkVsZW1lbnQuaXNFbGVtZW50KGUpKXt2YXIgbz1tZihuLGUsImJhciIpO3JldHVybiByLmNzcyhvKSx2b2lkIGJmKG4scil9aWYodC5UZXh0LmlzVGV4dChlKSl7bz15ZihuKTtyZXR1cm4gci5jc3Mobyksdm9pZCBiZihuLHIpfXRocm93IG5ldyBFcnJvcigiaG92ZXJiYXIuc2V0UG9zaXRpb24gZXJyb3IsIGN1cnJlbnQgc2VsZWN0ZWQgbm9kZSBpcyBub3QgZWxlbSBub3IgdGV4dCIpfSxlLnByb3RvdHlwZS5nZXRTZWxlY3RlZE5vZGVBbmRNZW51S2V5cz1mdW5jdGlvbigpe3ZhciBlPXRoaXMuZ2V0RWRpdG9ySW5zdGFuY2UoKTtpZihudWxsPT1lLnNlbGVjdGlvbilyZXR1cm4gbnVsbDt2YXIgbj10aGlzLmdldEhvdmVyYmFyS2V5c0NvbmYoKSxyPW51bGwsbz1bXSxpPWZ1bmN0aW9uKGkpe3ZhciBhPW5baV0scz1hLm1hdGNoLGw9YS5tZW51S2V5cyx1PXZvaWQgMD09PWw/W106bCxjPXN8fGZ1bmN0aW9uKGUsdCl7cmV0dXJuIEhzLmNoZWNrTm9kZVR5cGUodCxpKX0sZj1HaSh0LkVkaXRvci5ub2RlcyhlLHttYXRjaDpmdW5jdGlvbih0KXtyZXR1cm4gYyhlLHQpfSx1bml2ZXJzYWw6ITB9KSwxKSxkPWZbMF07aWYobnVsbCE9ZClyZXR1cm4gcj1kWzBdLG89dSwiYnJlYWsifTtmb3IodmFyIGEgaW4gbil7aWYoImJyZWFrIj09PWkoYSkpYnJlYWt9cmV0dXJuIG51bGw9PXJ8fDA9PT1vLmxlbmd0aD9udWxsOntub2RlOnIsbWVudUtleXM6b319LGUucHJvdG90eXBlLmdldEVkaXRvckluc3RhbmNlPWZ1bmN0aW9uKCl7dmFyIGU9UWEuZ2V0KHRoaXMpO2lmKG51bGw9PWUpdGhyb3cgbmV3IEVycm9yKCJDYW4gbm90IGdldCBlZGl0b3IgaW5zdGFuY2UiKTtyZXR1cm4gZX0sZS5wcm90b3R5cGUuZ2V0SG92ZXJiYXJLZXlzQ29uZj1mdW5jdGlvbigpe3ZhciBlPXRoaXMuZ2V0RWRpdG9ySW5zdGFuY2UoKS5nZXRDb25maWcoKS5ob3ZlcmJhcktleXMsdD12b2lkIDA9PT1lP3t9OmUsbj10LnRleHQ7cmV0dXJuIG4mJm51bGw9PW4ubWF0Y2gmJihuLm1hdGNoPUxkKSx0fSxlLnByb3RvdHlwZS5pc1NhbWVQYXRoPWZ1bmN0aW9uKGUsbil7aWYobnVsbD09ZXx8bnVsbD09bilyZXR1cm4gITE7dmFyIHI9SHMuZmluZFBhdGgobnVsbCxlKSxvPUhzLmZpbmRQYXRoKG51bGwsbik7cmV0dXJuIHQuUGF0aC5lcXVhbHMocixvKX0sZS5wcm90b3R5cGUuZGVzdHJveT1mdW5jdGlvbigpe3RoaXMuY2hhbmdlSG92ZXJiYXJTdGF0ZS5jYW5jZWwoKSx0aGlzLiRlbGVtLnJlbW92ZSgpLHRoaXMubWVudXM9e30sdGhpcy5ob3ZlcmJhckl0ZW1zPVtdLHRoaXMucHJldlNlbGVjdGVkTm9kZT1udWxsO30sZX0oKTtmdW5jdGlvbiBSZChlLG4scixvKXtpZihzcy5zZXQoZSxuKSxscy5zZXQoZSxyKSx0LkVsZW1lbnQuaXNFbGVtZW50KGUpKXt2YXIgaT1lLmNoaWxkcmVuO2lmKCh2b2lkIDA9PT1pP1tdOmkpLmZvckVhY2goKGZ1bmN0aW9uKHQsbil7cmV0dXJuIFJkKHQsbixlLG8pfSkpLHQuRWRpdG9yLmlzVm9pZChvLGUpKXt2YXIgYT1HaSh0Lk5vZGUudGV4dHMoZSksMSkscz1HaShhWzBdLDEpWzBdO3NzLnNldChzLDApLGxzLnNldChzLGUpO319fXZhciBEZD1xbygic3BsaWNlIiksamQ9UC5UeXBlRXJyb3IsQWQ9TWF0aC5tYXgsX2Q9TWF0aC5taW4sRmQ9OTAwNzE5OTI1NDc0MDk5MSxJZD0iTWF4aW11bSBhbGxvd2VkIGxlbmd0aCBleGNlZWRlZCI7X24oe3RhcmdldDoiQXJyYXkiLHByb3RvOiEwLGZvcmNlZDohRGR9LHtzcGxpY2U6ZnVuY3Rpb24oZSx0KXt2YXIgbixyLG8saSxhLHMsbD1VKHRoaXMpLHU9SXQobCksYz1nbihlLHUpLGY9YXJndW1lbnRzLmxlbmd0aDtpZigwPT09Zj9uPXI9MDoxPT09Zj8obj0wLHI9dS1jKToobj1mLTIscj1fZChBZChBdCh0KSwwKSx1LWMpKSx1K24tcj5GZCl0aHJvdyBqZChJZCk7Zm9yKG89WXQobCxyKSxpPTA7aTxyO2krKykoYT1jK2kpaW4gbCYmSXIobyxpLGxbYV0pO2lmKG8ubGVuZ3RoPXIsbjxyKXtmb3IoaT1jO2k8dS1yO2krKylzPWkrbiwoYT1pK3IpaW4gbD9sW3NdPWxbYV06ZGVsZXRlIGxbc107Zm9yKGk9dTtpPnUtcituO2ktLSlkZWxldGUgbFtpLTFdO31lbHNlIGlmKG4+cilmb3IoaT11LXI7aT5jO2ktLSlzPWkrbi0xLChhPWkrci0xKWluIGw/bFtzXT1sW2FdOmRlbGV0ZSBsW3NdO2ZvcihpPTA7aTxuO2krKylsW2krY109YXJndW1lbnRzW2krMl07cmV0dXJuIGwubGVuZ3RoPXUtcituLG99fSk7dmFyIEJkPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZShlLHQpe3ZhciBuPXRoaXM7dGhpcy4kdG9vbGJhcj15LmRlZmF1bHQoJzxkaXYgY2xhc3M9InctZS1iYXIgdy1lLWJhci1zaG93IHctZS10b29sYmFyIj48L2Rpdj4nKSx0aGlzLm1lbnVzPXt9LHRoaXMudG9vbGJhckl0ZW1zPVtdLHRoaXMuY29uZmlnPXt9LHRoaXMuY2hhbmdlVG9vbGJhclN0YXRlPXguZGVmYXVsdCgoZnVuY3Rpb24oKXtuLnRvb2xiYXJJdGVtcy5mb3JFYWNoKChmdW5jdGlvbihlKXtlLmNoYW5nZU1lbnVTdGF0ZSgpO30pKTt9KSwyMDApLHRoaXMuY29uZmlnPXQ7dmFyIHI9eS5kZWZhdWx0KGUpO2lmKDA9PT1yLmxlbmd0aCl0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBmaW5kIHRvb2xiYXIgRE9NIGJ5IHNlbGVjdG9yICciK2UrIiciKTt0aGlzLiRib3g9cjt2YXIgbz10aGlzLiR0b29sYmFyO28ub24oIm1vdXNlZG93biIsKGZ1bmN0aW9uKGUpe3JldHVybiBlLnByZXZlbnREZWZhdWx0KCl9KSx7cGFzc2l2ZTohMX0pLHIuYXBwZW5kKG8pLFV1KChmdW5jdGlvbigpe24ucmVnaXN0ZXJJdGVtcygpLG4uY2hhbmdlVG9vbGJhclN0YXRlKCksbi5nZXRFZGl0b3JJbnN0YW5jZSgpLm9uKCJjaGFuZ2UiLG4uY2hhbmdlVG9vbGJhclN0YXRlKTt9KSk7fXJldHVybiBlLnByb3RvdHlwZS5nZXRNZW51cz1mdW5jdGlvbigpe3JldHVybiB0aGlzLm1lbnVzfSxlLnByb3RvdHlwZS5nZXRDb25maWc9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jb25maWd9LGUucHJvdG90eXBlLnJlZ2lzdGVySXRlbXM9ZnVuY3Rpb24oKXt2YXIgZT10aGlzLHQ9IiIsbj10aGlzLiR0b29sYmFyLHI9dGhpcy5jb25maWcsbz1yLnRvb2xiYXJLZXlzLGk9dm9pZCAwPT09bz9bXTpvLGE9ci5pbnNlcnRLZXlzLHM9dm9pZCAwPT09YT97aW5kZXg6MCxrZXlzOltdfTphLGw9ci5leGNsdWRlS2V5cyx1PXZvaWQgMD09PWw/W106bCxjPUUuZGVmYXVsdChpKTtzLmtleXMubGVuZ3RoPjAmJigic3RyaW5nIj09dHlwZW9mIHMua2V5cyYmKHMua2V5cz1bcy5rZXlzXSkscy5rZXlzLmZvckVhY2goKGZ1bmN0aW9uKGUsdCl7Yy5zcGxpY2Uocy5pbmRleCt0LDAsZSk7fSkpKTt2YXIgZj1jLmZpbHRlcigoZnVuY3Rpb24oZSl7aWYoInN0cmluZyI9PXR5cGVvZiBlKXtpZih1LmluY2x1ZGVzKGUpKXJldHVybiAhMX1lbHNlIGlmKHUuaW5jbHVkZXMoZS5rZXkpKXJldHVybiAhMTtyZXR1cm4gITB9KSksZD1mLmxlbmd0aDtmLmZvckVhY2goKGZ1bmN0aW9uKHIsbyl7aWYoInwiPT09cil7aWYoMD09PW8pcmV0dXJuO2lmKG8rMT09PWQpcmV0dXJuO2lmKCJ8Ij09PXQpcmV0dXJuO3ZhciBpPWdkKCk7cmV0dXJuIG4uYXBwZW5kKGkpLHZvaWQodD1yKX1pZigic3RyaW5nIj09dHlwZW9mIHIpcmV0dXJuIGUucmVnaXN0ZXJTaW5nbGVJdGVtKHIsZSksdm9pZCh0PXIpO2UucmVnaXN0ZXJHcm91cChyKSx0PSJncm91cCI7fSkpO30sZS5wcm90b3R5cGUucmVnaXN0ZXJHcm91cD1mdW5jdGlvbihlKXt2YXIgdD10aGlzLG49dGhpcy4kdG9vbGJhcixyPWZ1bmN0aW9uKGUpe3JldHVybiBuZXcgQ2QoZSl9KGUpLG89ZS5tZW51S2V5cyxpPXZvaWQgMD09PW8/W106byxhPXRoaXMuY29uZmlnLmV4Y2x1ZGVLZXlzLHM9dm9pZCAwPT09YT9bXTphO2kuZm9yRWFjaCgoZnVuY3Rpb24oZSl7cy5pbmNsdWRlcyhlKXx8dC5yZWdpc3RlclNpbmdsZUl0ZW0oZSxyKTt9KSksbi5hcHBlbmQoci4kZWxlbSk7fSxlLnByb3RvdHlwZS5yZWdpc3RlclNpbmdsZUl0ZW09ZnVuY3Rpb24oZSx0KXt2YXIgbj10aGlzLmdldEVkaXRvckluc3RhbmNlKCkscj10IGluc3RhbmNlb2YgQ2Qsbz10aGlzLm1lbnVzLGk9b1tlXTtpZihudWxsPT1pKXt2YXIgYT1Vc1tlXTtpZihudWxsPT1hKXRocm93IG5ldyBFcnJvcigiTm90IGZvdW5kIG1lbnUgaXRlbSBmYWN0b3J5IGJ5IGtleSAnIitlKyInIik7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIGEpdGhyb3cgbmV3IEVycm9yKCJNZW51IGl0ZW0gZmFjdG9yeSAoa2V5PSciK2UrIicpIGlzIG5vdCBhIGZ1bmN0aW9uIik7aT1hKCksb1tlXT1pO31lbHNlIGNvbnNvbGUud2FybigiRHVwbGljYXRlZCB0b29sYmFyIG1lbnUga2V5ICciK2UrIidcbumHjeWkjeazqOWGjOS6huiPnOWNleagjyBtZW51ICciK2UrIiciKTt2YXIgcz1NZChlLGkscik7KHRoaXMudG9vbGJhckl0ZW1zLnB1c2gocyksZXMuc2V0KHMsbikscik/dC5hcHBlbmRCYXJJdGVtKHMpOnQuJHRvb2xiYXIuYXBwZW5kKHMuJGVsZW0pO30sZS5wcm90b3R5cGUuZ2V0RWRpdG9ySW5zdGFuY2U9ZnVuY3Rpb24oKXt2YXIgZT1ZYS5nZXQodGhpcyk7aWYobnVsbD09ZSl0aHJvdyBuZXcgRXJyb3IoIkNhbiBub3QgZ2V0IGVkaXRvciBpbnN0YW5jZSIpO3JldHVybiBlfSxlLnByb3RvdHlwZS5kZXN0cm95PWZ1bmN0aW9uKCl7dGhpcy4kdG9vbGJhci5yZW1vdmUoKSx0aGlzLm1lbnVzPXt9LHRoaXMudG9vbGJhckl0ZW1zPVtdO30sZX0oKTt2YXIgJGQ9aHQuRVhJU1RTLFdkPVZlLmYsSGQ9RnVuY3Rpb24ucHJvdG90eXBlLFZkPVcoSGQudG9TdHJpbmcpLHpkPS9mdW5jdGlvblxiKD86XHN8XC9cKltcU1xzXSo/XCpcL3xcL1wvW15cblxyXSpbXG5ccl0rKSooW15ccygvXSopLyxVZD1XKHpkLmV4ZWMpO3llJiYhJGQmJldkKEhkLCJuYW1lIix7Y29uZmlndXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3RyeXtyZXR1cm4gVWQoemQsVmQodGhpcykpWzFdfWNhdGNoKGUpe3JldHVybiAiIn19fSk7dmFyIEtkPVQoKGZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHQobil7cmV0dXJuICJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2wmJiJzeW1ib2wiPT10eXBlb2YgU3ltYm9sLml0ZXJhdG9yPyhlLmV4cG9ydHM9dD1mdW5jdGlvbihlKXtyZXR1cm4gdHlwZW9mIGV9LGUuZXhwb3J0cy5kZWZhdWx0PWUuZXhwb3J0cyxlLmV4cG9ydHMuX19lc01vZHVsZT0hMCk6KGUuZXhwb3J0cz10PWZ1bmN0aW9uKGUpe3JldHVybiBlJiYiZnVuY3Rpb24iPT10eXBlb2YgU3ltYm9sJiZlLmNvbnN0cnVjdG9yPT09U3ltYm9sJiZlIT09U3ltYm9sLnByb3RvdHlwZT8ic3ltYm9sIjp0eXBlb2YgZX0sZS5leHBvcnRzLmRlZmF1bHQ9ZS5leHBvcnRzLGUuZXhwb3J0cy5fX2VzTW9kdWxlPSEwKSx0KG4pfWUuZXhwb3J0cz10LGUuZXhwb3J0cy5kZWZhdWx0PWUuZXhwb3J0cyxlLmV4cG9ydHMuX19lc01vZHVsZT0hMDt9KSkscWQ9VCgoZnVuY3Rpb24oZSl7ZS5leHBvcnRzPWZ1bmN0aW9uKGUsdCxuKXtyZXR1cm4gdCBpbiBlP09iamVjdC5kZWZpbmVQcm9wZXJ0eShlLHQse3ZhbHVlOm4sZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITB9KTplW3RdPW4sZX0sZS5leHBvcnRzLmRlZmF1bHQ9ZS5leHBvcnRzLGUuZXhwb3J0cy5fX2VzTW9kdWxlPSEwO30pKSxHZD1UKChmdW5jdGlvbihlKXtlLmV4cG9ydHM9ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PTE7dDxhcmd1bWVudHMubGVuZ3RoO3QrKyl7dmFyIG49bnVsbCE9YXJndW1lbnRzW3RdP09iamVjdChhcmd1bWVudHNbdF0pOnt9LHI9T2JqZWN0LmtleXMobik7ImZ1bmN0aW9uIj09dHlwZW9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMmJnIucHVzaC5hcHBseShyLE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMobikuZmlsdGVyKChmdW5jdGlvbihlKXtyZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihuLGUpLmVudW1lcmFibGV9KSkpLHIuZm9yRWFjaCgoZnVuY3Rpb24odCl7cWQoZSx0LG5bdF0pO30pKTt9cmV0dXJuIGV9LGUuZXhwb3J0cy5kZWZhdWx0PWUuZXhwb3J0cyxlLmV4cG9ydHMuX19lc01vZHVsZT0hMDt9KSksSmQ9VCgoZnVuY3Rpb24oZSl7ZS5leHBvcnRzPWZ1bmN0aW9uKGUsdCl7aWYoIShlIGluc3RhbmNlb2YgdCkpdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIil9LGUuZXhwb3J0cy5kZWZhdWx0PWUuZXhwb3J0cyxlLmV4cG9ydHMuX19lc01vZHVsZT0hMDt9KSksWWQ9VCgoZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdChlLHQpe2Zvcih2YXIgbj0wO248dC5sZW5ndGg7bisrKXt2YXIgcj10W25dO3IuZW51bWVyYWJsZT1yLmVudW1lcmFibGV8fCExLHIuY29uZmlndXJhYmxlPSEwLCJ2YWx1ZSJpbiByJiYoci53cml0YWJsZT0hMCksT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsci5rZXkscik7fX1lLmV4cG9ydHM9ZnVuY3Rpb24oZSxuLHIpe3JldHVybiBuJiZ0KGUucHJvdG90eXBlLG4pLHImJnQoZSxyKSxlfSxlLmV4cG9ydHMuZGVmYXVsdD1lLmV4cG9ydHMsZS5leHBvcnRzLl9fZXNNb2R1bGU9ITA7fSkpLFhkPVQoKGZ1bmN0aW9uKGUpe2UuZXhwb3J0cz1mdW5jdGlvbihlKXtpZih2b2lkIDA9PT1lKXRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7cmV0dXJuIGV9LGUuZXhwb3J0cy5kZWZhdWx0PWUuZXhwb3J0cyxlLmV4cG9ydHMuX19lc01vZHVsZT0hMDt9KSksUWQ9VCgoZnVuY3Rpb24oZSl7dmFyIHQ9S2QuZGVmYXVsdDtlLmV4cG9ydHM9ZnVuY3Rpb24oZSxuKXtpZihuJiYoIm9iamVjdCI9PT10KG4pfHwiZnVuY3Rpb24iPT10eXBlb2YgbikpcmV0dXJuIG47aWYodm9pZCAwIT09bil0aHJvdyBuZXcgVHlwZUVycm9yKCJEZXJpdmVkIGNvbnN0cnVjdG9ycyBtYXkgb25seSByZXR1cm4gb2JqZWN0IG9yIHVuZGVmaW5lZCIpO3JldHVybiBYZChlKX0sZS5leHBvcnRzLmRlZmF1bHQ9ZS5leHBvcnRzLGUuZXhwb3J0cy5fX2VzTW9kdWxlPSEwO30pKSxaZD1UKChmdW5jdGlvbihlKXtmdW5jdGlvbiB0KG4pe3JldHVybiBlLmV4cG9ydHM9dD1PYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LmdldFByb3RvdHlwZU9mOmZ1bmN0aW9uKGUpe3JldHVybiBlLl9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKGUpfSxlLmV4cG9ydHMuZGVmYXVsdD1lLmV4cG9ydHMsZS5leHBvcnRzLl9fZXNNb2R1bGU9ITAsdChuKX1lLmV4cG9ydHM9dCxlLmV4cG9ydHMuZGVmYXVsdD1lLmV4cG9ydHMsZS5leHBvcnRzLl9fZXNNb2R1bGU9ITA7fSkpLGVwPVQoKGZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHQobixyKXtyZXR1cm4gZS5leHBvcnRzPXQ9T2JqZWN0LnNldFByb3RvdHlwZU9mfHxmdW5jdGlvbihlLHQpe3JldHVybiBlLl9fcHJvdG9fXz10LGV9LGUuZXhwb3J0cy5kZWZhdWx0PWUuZXhwb3J0cyxlLmV4cG9ydHMuX19lc01vZHVsZT0hMCx0KG4scil9ZS5leHBvcnRzPXQsZS5leHBvcnRzLmRlZmF1bHQ9ZS5leHBvcnRzLGUuZXhwb3J0cy5fX2VzTW9kdWxlPSEwO30pKSx0cD1UKChmdW5jdGlvbihlKXtlLmV4cG9ydHM9ZnVuY3Rpb24oZSx0KXtpZigiZnVuY3Rpb24iIT10eXBlb2YgdCYmbnVsbCE9PXQpdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTtlLnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKHQmJnQucHJvdG90eXBlLHtjb25zdHJ1Y3Rvcjp7dmFsdWU6ZSx3cml0YWJsZTohMCxjb25maWd1cmFibGU6ITB9fSksdCYmZXAoZSx0KTt9LGUuZXhwb3J0cy5kZWZhdWx0PWUuZXhwb3J0cyxlLmV4cG9ydHMuX19lc01vZHVsZT0hMDt9KSk7ZnVuY3Rpb24gbnAoZSl7cmV0dXJuIGUmJiJvYmplY3QiPT10eXBlb2YgZSYmImRlZmF1bHQiaW4gZT9lOntkZWZhdWx0OmV9fXZhciBycD1ucChLZCksb3A9bnAoR2QpLGlwPW5wKEpkKSxhcD1ucChZZCksc3A9bnAoUWQpLGxwPW5wKFpkKSx1cD1ucChYZCksY3A9bnAodHApLGZwPXt0eXBlOiJsb2dnZXIiLGxvZzpmdW5jdGlvbihlKXt0aGlzLm91dHB1dCgibG9nIixlKTt9LHdhcm46ZnVuY3Rpb24oZSl7dGhpcy5vdXRwdXQoIndhcm4iLGUpO30sZXJyb3I6ZnVuY3Rpb24oZSl7dGhpcy5vdXRwdXQoImVycm9yIixlKTt9LG91dHB1dDpmdW5jdGlvbihlLHQpe2NvbnNvbGUmJmNvbnNvbGVbZV0mJmNvbnNvbGVbZV0uYXBwbHkoY29uc29sZSx0KTt9fSxkcD1mdW5jdGlvbigpe2Z1bmN0aW9uIGUodCl7dmFyIG49YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOnt9O2lwLmRlZmF1bHQodGhpcyxlKSx0aGlzLmluaXQodCxuKTt9cmV0dXJuIGFwLmRlZmF1bHQoZSxbe2tleToiaW5pdCIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOnt9O3RoaXMucHJlZml4PXQucHJlZml4fHwiaTE4bmV4dDoiLHRoaXMubG9nZ2VyPWV8fGZwLHRoaXMub3B0aW9ucz10LHRoaXMuZGVidWc9dC5kZWJ1Zzt9fSx7a2V5OiJzZXREZWJ1ZyIsdmFsdWU6ZnVuY3Rpb24oZSl7dGhpcy5kZWJ1Zz1lO319LHtrZXk6ImxvZyIsdmFsdWU6ZnVuY3Rpb24oKXtmb3IodmFyIGU9YXJndW1lbnRzLmxlbmd0aCx0PW5ldyBBcnJheShlKSxuPTA7bjxlO24rKyl0W25dPWFyZ3VtZW50c1tuXTtyZXR1cm4gdGhpcy5mb3J3YXJkKHQsImxvZyIsIiIsITApfX0se2tleToid2FybiIsdmFsdWU6ZnVuY3Rpb24oKXtmb3IodmFyIGU9YXJndW1lbnRzLmxlbmd0aCx0PW5ldyBBcnJheShlKSxuPTA7bjxlO24rKyl0W25dPWFyZ3VtZW50c1tuXTtyZXR1cm4gdGhpcy5mb3J3YXJkKHQsIndhcm4iLCIiLCEwKX19LHtrZXk6ImVycm9yIix2YWx1ZTpmdW5jdGlvbigpe2Zvcih2YXIgZT1hcmd1bWVudHMubGVuZ3RoLHQ9bmV3IEFycmF5KGUpLG49MDtuPGU7bisrKXRbbl09YXJndW1lbnRzW25dO3JldHVybiB0aGlzLmZvcndhcmQodCwiZXJyb3IiLCIiKX19LHtrZXk6ImRlcHJlY2F0ZSIsdmFsdWU6ZnVuY3Rpb24oKXtmb3IodmFyIGU9YXJndW1lbnRzLmxlbmd0aCx0PW5ldyBBcnJheShlKSxuPTA7bjxlO24rKyl0W25dPWFyZ3VtZW50c1tuXTtyZXR1cm4gdGhpcy5mb3J3YXJkKHQsIndhcm4iLCJXQVJOSU5HIERFUFJFQ0FURUQ6ICIsITApfX0se2tleToiZm9yd2FyZCIsdmFsdWU6ZnVuY3Rpb24oZSx0LG4scil7cmV0dXJuIHImJiF0aGlzLmRlYnVnP251bGw6KCJzdHJpbmciPT10eXBlb2YgZVswXSYmKGVbMF09IiIuY29uY2F0KG4pLmNvbmNhdCh0aGlzLnByZWZpeCwiICIpLmNvbmNhdChlWzBdKSksdGhpcy5sb2dnZXJbdF0oZSkpfX0se2tleToiY3JlYXRlIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodGhpcy5sb2dnZXIsb3AuZGVmYXVsdCh7fSx7cHJlZml4OiIiLmNvbmNhdCh0aGlzLnByZWZpeCwiOiIpLmNvbmNhdCh0LCI6Iil9LHRoaXMub3B0aW9ucykpfX1dKSxlfSgpLHBwPW5ldyBkcCxocD1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoKXtpcC5kZWZhdWx0KHRoaXMsZSksdGhpcy5vYnNlcnZlcnM9e307fXJldHVybiBhcC5kZWZhdWx0KGUsW3trZXk6Im9uIix2YWx1ZTpmdW5jdGlvbihlLHQpe3ZhciBuPXRoaXM7cmV0dXJuIGUuc3BsaXQoIiAiKS5mb3JFYWNoKChmdW5jdGlvbihlKXtuLm9ic2VydmVyc1tlXT1uLm9ic2VydmVyc1tlXXx8W10sbi5vYnNlcnZlcnNbZV0ucHVzaCh0KTt9KSksdGhpc319LHtrZXk6Im9mZiIsdmFsdWU6ZnVuY3Rpb24oZSx0KXt0aGlzLm9ic2VydmVyc1tlXSYmKHQ/dGhpcy5vYnNlcnZlcnNbZV09dGhpcy5vYnNlcnZlcnNbZV0uZmlsdGVyKChmdW5jdGlvbihlKXtyZXR1cm4gZSE9PXR9KSk6ZGVsZXRlIHRoaXMub2JzZXJ2ZXJzW2VdKTt9fSx7a2V5OiJlbWl0Iix2YWx1ZTpmdW5jdGlvbihlKXtmb3IodmFyIHQ9YXJndW1lbnRzLmxlbmd0aCxuPW5ldyBBcnJheSh0PjE/dC0xOjApLHI9MTtyPHQ7cisrKW5bci0xXT1hcmd1bWVudHNbcl07aWYodGhpcy5vYnNlcnZlcnNbZV0pe3ZhciBvPVtdLmNvbmNhdCh0aGlzLm9ic2VydmVyc1tlXSk7by5mb3JFYWNoKChmdW5jdGlvbihlKXtlLmFwcGx5KHZvaWQgMCxuKTt9KSk7fWlmKHRoaXMub2JzZXJ2ZXJzWyIqIl0pe3ZhciBpPVtdLmNvbmNhdCh0aGlzLm9ic2VydmVyc1siKiJdKTtpLmZvckVhY2goKGZ1bmN0aW9uKHQpe3QuYXBwbHkodCxbZV0uY29uY2F0KG4pKTt9KSk7fX19XSksZX0oKTtmdW5jdGlvbiBncCgpe3ZhciBlLHQsbj1uZXcgUHJvbWlzZSgoZnVuY3Rpb24obixyKXtlPW4sdD1yO30pKTtyZXR1cm4gbi5yZXNvbHZlPWUsbi5yZWplY3Q9dCxufWZ1bmN0aW9uIHZwKGUpe3JldHVybiBudWxsPT1lPyIiOiIiK2V9ZnVuY3Rpb24geXAoZSx0LG4pe2UuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dFtlXSYmKG5bZV09dFtlXSk7fSkpO31mdW5jdGlvbiBtcChlLHQsbil7ZnVuY3Rpb24gcihlKXtyZXR1cm4gZSYmZS5pbmRleE9mKCIjIyMiKT4tMT9lLnJlcGxhY2UoLyMjIy9nLCIuIik6ZX1mdW5jdGlvbiBvKCl7cmV0dXJuICFlfHwic3RyaW5nIj09dHlwZW9mIGV9Zm9yKHZhciBpPSJzdHJpbmciIT10eXBlb2YgdD9bXS5jb25jYXQodCk6dC5zcGxpdCgiLiIpO2kubGVuZ3RoPjE7KXtpZihvKCkpcmV0dXJuIHt9O3ZhciBhPXIoaS5zaGlmdCgpKTshZVthXSYmbiYmKGVbYV09bmV3IG4pLGU9T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsYSk/ZVthXTp7fTt9cmV0dXJuIG8oKT97fTp7b2JqOmUsazpyKGkuc2hpZnQoKSl9fWZ1bmN0aW9uIGJwKGUsdCxuKXt2YXIgcj1tcChlLHQsT2JqZWN0KTtyLm9ialtyLmtdPW47fWZ1bmN0aW9uIHdwKGUsdCl7dmFyIG49bXAoZSx0KSxyPW4ub2JqLG89bi5rO2lmKHIpcmV0dXJuIHJbb119ZnVuY3Rpb24geHAoZSx0LG4pe3ZhciByPXdwKGUsbik7cmV0dXJuIHZvaWQgMCE9PXI/cjp3cCh0LG4pfWZ1bmN0aW9uIEVwKGUsdCxuKXtmb3IodmFyIHIgaW4gdCkiX19wcm90b19fIiE9PXImJiJjb25zdHJ1Y3RvciIhPT1yJiYociBpbiBlPyJzdHJpbmciPT10eXBlb2YgZVtyXXx8ZVtyXWluc3RhbmNlb2YgU3RyaW5nfHwic3RyaW5nIj09dHlwZW9mIHRbcl18fHRbcl1pbnN0YW5jZW9mIFN0cmluZz9uJiYoZVtyXT10W3JdKTpFcChlW3JdLHRbcl0sbik6ZVtyXT10W3JdKTtyZXR1cm4gZX1mdW5jdGlvbiBTcChlKXtyZXR1cm4gZS5yZXBsYWNlKC9bXC1cW1xdXC9ce1x9XChcKVwqXCtcP1wuXFxcXlwkXHxdL2csIlxcJCYiKX12YXIga3A9eyImIjoiJmFtcDsiLCI8IjoiJmx0OyIsIj4iOiImZ3Q7IiwnIic6IiZxdW90OyIsIiciOiImIzM5OyIsIi8iOiImI3gyRjsifTtmdW5jdGlvbiBPcChlKXtyZXR1cm4gInN0cmluZyI9PXR5cGVvZiBlP2UucmVwbGFjZSgvWyY8PiInXC9dL2csKGZ1bmN0aW9uKGUpe3JldHVybiBrcFtlXX0pKTplfXZhciBDcD0idW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdyYmd2luZG93Lm5hdmlnYXRvciYmd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQmJndpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIk1TSUUiKT4tMTtmdW5jdGlvbiBUcChlLHQpe3ZhciBuPWFyZ3VtZW50cy5sZW5ndGg+MiYmdm9pZCAwIT09YXJndW1lbnRzWzJdP2FyZ3VtZW50c1syXToiLiI7aWYoZSl7aWYoZVt0XSlyZXR1cm4gZVt0XTtmb3IodmFyIHI9dC5zcGxpdChuKSxvPWUsaT0wO2k8ci5sZW5ndGg7KytpKXtpZighbylyZXR1cm47aWYoInN0cmluZyI9PXR5cGVvZiBvW3JbaV1dJiZpKzE8ci5sZW5ndGgpcmV0dXJuO2lmKHZvaWQgMD09PW9bcltpXV0pe2Zvcih2YXIgYT0yLHM9ci5zbGljZShpLGkrYSkuam9pbihuKSxsPW9bc107dm9pZCAwPT09bCYmci5sZW5ndGg+aSthOylhKyssbD1vW3M9ci5zbGljZShpLGkrYSkuam9pbihuKV07aWYodm9pZCAwPT09bClyZXR1cm47aWYoInN0cmluZyI9PXR5cGVvZiBsKXJldHVybiBsO2lmKHMmJiJzdHJpbmciPT10eXBlb2YgbFtzXSlyZXR1cm4gbFtzXTt2YXIgdT1yLnNsaWNlKGkrYSkuam9pbihuKTtyZXR1cm4gdT9UcChsLHUsbik6dm9pZCAwfW89b1tyW2ldXTt9cmV0dXJuIG99fXZhciBOcD1mdW5jdGlvbihlKXtmdW5jdGlvbiB0KGUpe3ZhciBuLHI9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOntuczpbInRyYW5zbGF0aW9uIl0sZGVmYXVsdE5TOiJ0cmFuc2xhdGlvbiJ9O3JldHVybiBpcC5kZWZhdWx0KHRoaXMsdCksbj1zcC5kZWZhdWx0KHRoaXMsbHAuZGVmYXVsdCh0KS5jYWxsKHRoaXMpKSxDcCYmaHAuY2FsbCh1cC5kZWZhdWx0KG4pKSxuLmRhdGE9ZXx8e30sbi5vcHRpb25zPXIsdm9pZCAwPT09bi5vcHRpb25zLmtleVNlcGFyYXRvciYmKG4ub3B0aW9ucy5rZXlTZXBhcmF0b3I9Ii4iKSx2b2lkIDA9PT1uLm9wdGlvbnMuaWdub3JlSlNPTlN0cnVjdHVyZSYmKG4ub3B0aW9ucy5pZ25vcmVKU09OU3RydWN0dXJlPSEwKSxufXJldHVybiBjcC5kZWZhdWx0KHQsZSksYXAuZGVmYXVsdCh0LFt7a2V5OiJhZGROYW1lc3BhY2VzIix2YWx1ZTpmdW5jdGlvbihlKXt0aGlzLm9wdGlvbnMubnMuaW5kZXhPZihlKTwwJiZ0aGlzLm9wdGlvbnMubnMucHVzaChlKTt9fSx7a2V5OiJyZW1vdmVOYW1lc3BhY2VzIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD10aGlzLm9wdGlvbnMubnMuaW5kZXhPZihlKTt0Pi0xJiZ0aGlzLm9wdGlvbnMubnMuc3BsaWNlKHQsMSk7fX0se2tleToiZ2V0UmVzb3VyY2UiLHZhbHVlOmZ1bmN0aW9uKGUsdCxuKXt2YXIgcj1hcmd1bWVudHMubGVuZ3RoPjMmJnZvaWQgMCE9PWFyZ3VtZW50c1szXT9hcmd1bWVudHNbM106e30sbz12b2lkIDAhPT1yLmtleVNlcGFyYXRvcj9yLmtleVNlcGFyYXRvcjp0aGlzLm9wdGlvbnMua2V5U2VwYXJhdG9yLGk9dm9pZCAwIT09ci5pZ25vcmVKU09OU3RydWN0dXJlP3IuaWdub3JlSlNPTlN0cnVjdHVyZTp0aGlzLm9wdGlvbnMuaWdub3JlSlNPTlN0cnVjdHVyZSxhPVtlLHRdO24mJiJzdHJpbmciIT10eXBlb2YgbiYmKGE9YS5jb25jYXQobikpLG4mJiJzdHJpbmciPT10eXBlb2YgbiYmKGE9YS5jb25jYXQobz9uLnNwbGl0KG8pOm4pKSxlLmluZGV4T2YoIi4iKT4tMSYmKGE9ZS5zcGxpdCgiLiIpKTt2YXIgcz13cCh0aGlzLmRhdGEsYSk7cmV0dXJuIHN8fCFpfHwic3RyaW5nIiE9dHlwZW9mIG4/czpUcCh0aGlzLmRhdGEmJnRoaXMuZGF0YVtlXSYmdGhpcy5kYXRhW2VdW3RdLG4sbyl9fSx7a2V5OiJhZGRSZXNvdXJjZSIsdmFsdWU6ZnVuY3Rpb24oZSx0LG4scil7dmFyIG89YXJndW1lbnRzLmxlbmd0aD40JiZ2b2lkIDAhPT1hcmd1bWVudHNbNF0/YXJndW1lbnRzWzRdOntzaWxlbnQ6ITF9LGk9dGhpcy5vcHRpb25zLmtleVNlcGFyYXRvcjt2b2lkIDA9PT1pJiYoaT0iLiIpO3ZhciBhPVtlLHRdO24mJihhPWEuY29uY2F0KGk/bi5zcGxpdChpKTpuKSksZS5pbmRleE9mKCIuIik+LTEmJihyPXQsdD0oYT1lLnNwbGl0KCIuIikpWzFdKSx0aGlzLmFkZE5hbWVzcGFjZXModCksYnAodGhpcy5kYXRhLGEsciksby5zaWxlbnR8fHRoaXMuZW1pdCgiYWRkZWQiLGUsdCxuLHIpO319LHtrZXk6ImFkZFJlc291cmNlcyIsdmFsdWU6ZnVuY3Rpb24oZSx0LG4pe3ZhciByPWFyZ3VtZW50cy5sZW5ndGg+MyYmdm9pZCAwIT09YXJndW1lbnRzWzNdP2FyZ3VtZW50c1szXTp7c2lsZW50OiExfTtmb3IodmFyIG8gaW4gbikic3RyaW5nIiE9dHlwZW9mIG5bb10mJiJbb2JqZWN0IEFycmF5XSIhPT1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmFwcGx5KG5bb10pfHx0aGlzLmFkZFJlc291cmNlKGUsdCxvLG5bb10se3NpbGVudDohMH0pO3Iuc2lsZW50fHx0aGlzLmVtaXQoImFkZGVkIixlLHQsbik7fX0se2tleToiYWRkUmVzb3VyY2VCdW5kbGUiLHZhbHVlOmZ1bmN0aW9uKGUsdCxuLHIsbyl7dmFyIGk9YXJndW1lbnRzLmxlbmd0aD41JiZ2b2lkIDAhPT1hcmd1bWVudHNbNV0/YXJndW1lbnRzWzVdOntzaWxlbnQ6ITF9LGE9W2UsdF07ZS5pbmRleE9mKCIuIik+LTEmJihyPW4sbj10LHQ9KGE9ZS5zcGxpdCgiLiIpKVsxXSksdGhpcy5hZGROYW1lc3BhY2VzKHQpO3ZhciBzPXdwKHRoaXMuZGF0YSxhKXx8e307cj9FcChzLG4sbyk6cz1vcC5kZWZhdWx0KHt9LHMsbiksYnAodGhpcy5kYXRhLGEscyksaS5zaWxlbnR8fHRoaXMuZW1pdCgiYWRkZWQiLGUsdCxuKTt9fSx7a2V5OiJyZW1vdmVSZXNvdXJjZUJ1bmRsZSIsdmFsdWU6ZnVuY3Rpb24oZSx0KXt0aGlzLmhhc1Jlc291cmNlQnVuZGxlKGUsdCkmJmRlbGV0ZSB0aGlzLmRhdGFbZV1bdF0sdGhpcy5yZW1vdmVOYW1lc3BhY2VzKHQpLHRoaXMuZW1pdCgicmVtb3ZlZCIsZSx0KTt9fSx7a2V5OiJoYXNSZXNvdXJjZUJ1bmRsZSIsdmFsdWU6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdm9pZCAwIT09dGhpcy5nZXRSZXNvdXJjZShlLHQpfX0se2tleToiZ2V0UmVzb3VyY2VCdW5kbGUiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHR8fCh0PXRoaXMub3B0aW9ucy5kZWZhdWx0TlMpLCJ2MSI9PT10aGlzLm9wdGlvbnMuY29tcGF0aWJpbGl0eUFQST9vcC5kZWZhdWx0KHt9LHt9LHRoaXMuZ2V0UmVzb3VyY2UoZSx0KSk6dGhpcy5nZXRSZXNvdXJjZShlLHQpfX0se2tleToiZ2V0RGF0YUJ5TGFuZ3VhZ2UiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmRhdGFbZV19fSx7a2V5OiJ0b0pTT04iLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZGF0YX19XSksdH0oaHApLE1wPXtwcm9jZXNzb3JzOnt9LGFkZFBvc3RQcm9jZXNzb3I6ZnVuY3Rpb24oZSl7dGhpcy5wcm9jZXNzb3JzW2UubmFtZV09ZTt9LGhhbmRsZTpmdW5jdGlvbihlLHQsbixyLG8pe3ZhciBpPXRoaXM7cmV0dXJuIGUuZm9yRWFjaCgoZnVuY3Rpb24oZSl7aS5wcm9jZXNzb3JzW2VdJiYodD1pLnByb2Nlc3NvcnNbZV0ucHJvY2Vzcyh0LG4scixvKSk7fSkpLHR9fSxMcD17fSxQcD1mdW5jdGlvbihlKXtmdW5jdGlvbiB0KGUpe3ZhciBuLHI9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOnt9O3JldHVybiBpcC5kZWZhdWx0KHRoaXMsdCksbj1zcC5kZWZhdWx0KHRoaXMsbHAuZGVmYXVsdCh0KS5jYWxsKHRoaXMpKSxDcCYmaHAuY2FsbCh1cC5kZWZhdWx0KG4pKSx5cChbInJlc291cmNlU3RvcmUiLCJsYW5ndWFnZVV0aWxzIiwicGx1cmFsUmVzb2x2ZXIiLCJpbnRlcnBvbGF0b3IiLCJiYWNrZW5kQ29ubmVjdG9yIiwiaTE4bkZvcm1hdCIsInV0aWxzIl0sZSx1cC5kZWZhdWx0KG4pKSxuLm9wdGlvbnM9cix2b2lkIDA9PT1uLm9wdGlvbnMua2V5U2VwYXJhdG9yJiYobi5vcHRpb25zLmtleVNlcGFyYXRvcj0iLiIpLG4ubG9nZ2VyPXBwLmNyZWF0ZSgidHJhbnNsYXRvciIpLG59cmV0dXJuIGNwLmRlZmF1bHQodCxlKSxhcC5kZWZhdWx0KHQsW3trZXk6ImNoYW5nZUxhbmd1YWdlIix2YWx1ZTpmdW5jdGlvbihlKXtlJiYodGhpcy5sYW5ndWFnZT1lKTt9fSx7a2V5OiJleGlzdHMiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0PWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTp7aW50ZXJwb2xhdGlvbjp7fX07aWYobnVsbD09ZSlyZXR1cm4gITE7dmFyIG49dGhpcy5yZXNvbHZlKGUsdCk7cmV0dXJuIG4mJnZvaWQgMCE9PW4ucmVzfX0se2tleToiZXh0cmFjdEZyb21LZXkiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dmFyIG49dm9pZCAwIT09dC5uc1NlcGFyYXRvcj90Lm5zU2VwYXJhdG9yOnRoaXMub3B0aW9ucy5uc1NlcGFyYXRvcjt2b2lkIDA9PT1uJiYobj0iOiIpO3ZhciByPXZvaWQgMCE9PXQua2V5U2VwYXJhdG9yP3Qua2V5U2VwYXJhdG9yOnRoaXMub3B0aW9ucy5rZXlTZXBhcmF0b3Isbz10Lm5zfHx0aGlzLm9wdGlvbnMuZGVmYXVsdE5TO2lmKG4mJmUuaW5kZXhPZihuKT4tMSl7dmFyIGk9ZS5tYXRjaCh0aGlzLmludGVycG9sYXRvci5uZXN0aW5nUmVnZXhwKTtpZihpJiZpLmxlbmd0aD4wKXJldHVybiB7a2V5OmUsbmFtZXNwYWNlczpvfTt2YXIgYT1lLnNwbGl0KG4pOyhuIT09cnx8bj09PXImJnRoaXMub3B0aW9ucy5ucy5pbmRleE9mKGFbMF0pPi0xKSYmKG89YS5zaGlmdCgpKSxlPWEuam9pbihyKTt9cmV0dXJuICJzdHJpbmciPT10eXBlb2YgbyYmKG89W29dKSx7a2V5OmUsbmFtZXNwYWNlczpvfX19LHtrZXk6InRyYW5zbGF0ZSIsdmFsdWU6ZnVuY3Rpb24oZSxuLHIpe3ZhciBvPXRoaXM7aWYoIm9iamVjdCIhPT1ycC5kZWZhdWx0KG4pJiZ0aGlzLm9wdGlvbnMub3ZlcmxvYWRUcmFuc2xhdGlvbk9wdGlvbkhhbmRsZXImJihuPXRoaXMub3B0aW9ucy5vdmVybG9hZFRyYW5zbGF0aW9uT3B0aW9uSGFuZGxlcihhcmd1bWVudHMpKSxufHwobj17fSksbnVsbD09ZSlyZXR1cm4gIiI7QXJyYXkuaXNBcnJheShlKXx8KGU9W1N0cmluZyhlKV0pO3ZhciBpPXZvaWQgMCE9PW4ua2V5U2VwYXJhdG9yP24ua2V5U2VwYXJhdG9yOnRoaXMub3B0aW9ucy5rZXlTZXBhcmF0b3IsYT10aGlzLmV4dHJhY3RGcm9tS2V5KGVbZS5sZW5ndGgtMV0sbikscz1hLmtleSxsPWEubmFtZXNwYWNlcyx1PWxbbC5sZW5ndGgtMV0sYz1uLmxuZ3x8dGhpcy5sYW5ndWFnZSxmPW4uYXBwZW5kTmFtZXNwYWNlVG9DSU1vZGV8fHRoaXMub3B0aW9ucy5hcHBlbmROYW1lc3BhY2VUb0NJTW9kZTtpZihjJiYiY2ltb2RlIj09PWMudG9Mb3dlckNhc2UoKSl7aWYoZil7dmFyIGQ9bi5uc1NlcGFyYXRvcnx8dGhpcy5vcHRpb25zLm5zU2VwYXJhdG9yO3JldHVybiB1K2Qrc31yZXR1cm4gc312YXIgcD10aGlzLnJlc29sdmUoZSxuKSxoPXAmJnAucmVzLGc9cCYmcC51c2VkS2V5fHxzLHY9cCYmcC5leGFjdFVzZWRLZXl8fHMseT1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmFwcGx5KGgpLG09WyJbb2JqZWN0IE51bWJlcl0iLCJbb2JqZWN0IEZ1bmN0aW9uXSIsIltvYmplY3QgUmVnRXhwXSJdLGI9dm9pZCAwIT09bi5qb2luQXJyYXlzP24uam9pbkFycmF5czp0aGlzLm9wdGlvbnMuam9pbkFycmF5cyx3PSF0aGlzLmkxOG5Gb3JtYXR8fHRoaXMuaTE4bkZvcm1hdC5oYW5kbGVBc09iamVjdCx4PSJzdHJpbmciIT10eXBlb2YgaCYmImJvb2xlYW4iIT10eXBlb2YgaCYmIm51bWJlciIhPXR5cGVvZiBoO2lmKHcmJmgmJngmJm0uaW5kZXhPZih5KTwwJiYoInN0cmluZyIhPXR5cGVvZiBifHwiW29iamVjdCBBcnJheV0iIT09eSkpe2lmKCFuLnJldHVybk9iamVjdHMmJiF0aGlzLm9wdGlvbnMucmV0dXJuT2JqZWN0cylyZXR1cm4gdGhpcy5vcHRpb25zLnJldHVybmVkT2JqZWN0SGFuZGxlcnx8dGhpcy5sb2dnZXIud2FybigiYWNjZXNzaW5nIGFuIG9iamVjdCAtIGJ1dCByZXR1cm5PYmplY3RzIG9wdGlvbnMgaXMgbm90IGVuYWJsZWQhIiksdGhpcy5vcHRpb25zLnJldHVybmVkT2JqZWN0SGFuZGxlcj90aGlzLm9wdGlvbnMucmV0dXJuZWRPYmplY3RIYW5kbGVyKGcsaCxvcC5kZWZhdWx0KHt9LG4se25zOmx9KSk6ImtleSAnIi5jb25jYXQocywiICgiKS5jb25jYXQodGhpcy5sYW5ndWFnZSwiKScgcmV0dXJuZWQgYW4gb2JqZWN0IGluc3RlYWQgb2Ygc3RyaW5nLiIpO2lmKGkpe3ZhciBFPSJbb2JqZWN0IEFycmF5XSI9PT15LFM9RT9bXTp7fSxrPUU/djpnO2Zvcih2YXIgTyBpbiBoKWlmKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChoLE8pKXt2YXIgQz0iIi5jb25jYXQoaykuY29uY2F0KGkpLmNvbmNhdChPKTtTW09dPXRoaXMudHJhbnNsYXRlKEMsb3AuZGVmYXVsdCh7fSxuLHtqb2luQXJyYXlzOiExLG5zOmx9KSksU1tPXT09PUMmJihTW09dPWhbT10pO31oPVM7fX1lbHNlIGlmKHcmJiJzdHJpbmciPT10eXBlb2YgYiYmIltvYmplY3QgQXJyYXldIj09PXkpKGg9aC5qb2luKGIpKSYmKGg9dGhpcy5leHRlbmRUcmFuc2xhdGlvbihoLGUsbixyKSk7ZWxzZSB7dmFyIFQ9ITEsTj0hMSxNPXZvaWQgMCE9PW4uY291bnQmJiJzdHJpbmciIT10eXBlb2Ygbi5jb3VudCxMPXQuaGFzRGVmYXVsdFZhbHVlKG4pLFA9TT90aGlzLnBsdXJhbFJlc29sdmVyLmdldFN1ZmZpeChjLG4uY291bnQpOiIiLFI9blsiZGVmYXVsdFZhbHVlIi5jb25jYXQoUCldfHxuLmRlZmF1bHRWYWx1ZTshdGhpcy5pc1ZhbGlkTG9va3VwKGgpJiZMJiYoVD0hMCxoPVIpLHRoaXMuaXNWYWxpZExvb2t1cChoKXx8KE49ITAsaD1zKTt2YXIgRD1uLm1pc3NpbmdLZXlOb1ZhbHVlRmFsbGJhY2tUb0tleXx8dGhpcy5vcHRpb25zLm1pc3NpbmdLZXlOb1ZhbHVlRmFsbGJhY2tUb0tleSxqPUQmJk4/dm9pZCAwOmgsQT1MJiZSIT09aCYmdGhpcy5vcHRpb25zLnVwZGF0ZU1pc3Npbmc7aWYoTnx8VHx8QSl7aWYodGhpcy5sb2dnZXIubG9nKEE/InVwZGF0ZUtleSI6Im1pc3NpbmdLZXkiLGMsdSxzLEE/UjpoKSxpKXt2YXIgXz10aGlzLnJlc29sdmUocyxvcC5kZWZhdWx0KHt9LG4se2tleVNlcGFyYXRvcjohMX0pKTtfJiZfLnJlcyYmdGhpcy5sb2dnZXIud2FybigiU2VlbXMgdGhlIGxvYWRlZCB0cmFuc2xhdGlvbnMgd2VyZSBpbiBmbGF0IEpTT04gZm9ybWF0IGluc3RlYWQgb2YgbmVzdGVkLiBFaXRoZXIgc2V0IGtleVNlcGFyYXRvcjogZmFsc2Ugb24gaW5pdCBvciBtYWtlIHN1cmUgeW91ciB0cmFuc2xhdGlvbnMgYXJlIHB1Ymxpc2hlZCBpbiBuZXN0ZWQgZm9ybWF0LiIpO312YXIgRj1bXSxJPXRoaXMubGFuZ3VhZ2VVdGlscy5nZXRGYWxsYmFja0NvZGVzKHRoaXMub3B0aW9ucy5mYWxsYmFja0xuZyxuLmxuZ3x8dGhpcy5sYW5ndWFnZSk7aWYoImZhbGxiYWNrIj09PXRoaXMub3B0aW9ucy5zYXZlTWlzc2luZ1RvJiZJJiZJWzBdKWZvcih2YXIgQj0wO0I8SS5sZW5ndGg7QisrKUYucHVzaChJW0JdKTtlbHNlICJhbGwiPT09dGhpcy5vcHRpb25zLnNhdmVNaXNzaW5nVG8/Rj10aGlzLmxhbmd1YWdlVXRpbHMudG9SZXNvbHZlSGllcmFyY2h5KG4ubG5nfHx0aGlzLmxhbmd1YWdlKTpGLnB1c2gobi5sbmd8fHRoaXMubGFuZ3VhZ2UpO3ZhciAkPWZ1bmN0aW9uKGUsdCxyKXtvLm9wdGlvbnMubWlzc2luZ0tleUhhbmRsZXI/by5vcHRpb25zLm1pc3NpbmdLZXlIYW5kbGVyKGUsdSx0LEE/cjpqLEEsbik6by5iYWNrZW5kQ29ubmVjdG9yJiZvLmJhY2tlbmRDb25uZWN0b3Iuc2F2ZU1pc3NpbmcmJm8uYmFja2VuZENvbm5lY3Rvci5zYXZlTWlzc2luZyhlLHUsdCxBP3I6aixBLG4pLG8uZW1pdCgibWlzc2luZ0tleSIsZSx1LHQsaCk7fTt0aGlzLm9wdGlvbnMuc2F2ZU1pc3NpbmcmJih0aGlzLm9wdGlvbnMuc2F2ZU1pc3NpbmdQbHVyYWxzJiZNP0YuZm9yRWFjaCgoZnVuY3Rpb24oZSl7by5wbHVyYWxSZXNvbHZlci5nZXRTdWZmaXhlcyhlKS5mb3JFYWNoKChmdW5jdGlvbih0KXskKFtlXSxzK3QsblsiZGVmYXVsdFZhbHVlIi5jb25jYXQodCldfHxSKTt9KSk7fSkpOiQoRixzLFIpKTt9aD10aGlzLmV4dGVuZFRyYW5zbGF0aW9uKGgsZSxuLHAsciksTiYmaD09PXMmJnRoaXMub3B0aW9ucy5hcHBlbmROYW1lc3BhY2VUb01pc3NpbmdLZXkmJihoPSIiLmNvbmNhdCh1LCI6IikuY29uY2F0KHMpKSwoTnx8VCkmJnRoaXMub3B0aW9ucy5wYXJzZU1pc3NpbmdLZXlIYW5kbGVyJiYoaD10aGlzLm9wdGlvbnMucGFyc2VNaXNzaW5nS2V5SGFuZGxlcihoKSk7fXJldHVybiBofX0se2tleToiZXh0ZW5kVHJhbnNsYXRpb24iLHZhbHVlOmZ1bmN0aW9uKGUsdCxuLHIsbyl7dmFyIGk9dGhpcztpZih0aGlzLmkxOG5Gb3JtYXQmJnRoaXMuaTE4bkZvcm1hdC5wYXJzZSllPXRoaXMuaTE4bkZvcm1hdC5wYXJzZShlLG4sci51c2VkTG5nLHIudXNlZE5TLHIudXNlZEtleSx7cmVzb2x2ZWQ6cn0pO2Vsc2UgaWYoIW4uc2tpcEludGVycG9sYXRpb24pe24uaW50ZXJwb2xhdGlvbiYmdGhpcy5pbnRlcnBvbGF0b3IuaW5pdChvcC5kZWZhdWx0KHt9LG4se2ludGVycG9sYXRpb246b3AuZGVmYXVsdCh7fSx0aGlzLm9wdGlvbnMuaW50ZXJwb2xhdGlvbixuLmludGVycG9sYXRpb24pfSkpO3ZhciBhLHM9bi5pbnRlcnBvbGF0aW9uJiZuLmludGVycG9sYXRpb24uc2tpcE9uVmFyaWFibGVzfHx0aGlzLm9wdGlvbnMuaW50ZXJwb2xhdGlvbi5za2lwT25WYXJpYWJsZXM7aWYocyl7dmFyIGw9ZS5tYXRjaCh0aGlzLmludGVycG9sYXRvci5uZXN0aW5nUmVnZXhwKTthPWwmJmwubGVuZ3RoO312YXIgdT1uLnJlcGxhY2UmJiJzdHJpbmciIT10eXBlb2Ygbi5yZXBsYWNlP24ucmVwbGFjZTpuO2lmKHRoaXMub3B0aW9ucy5pbnRlcnBvbGF0aW9uLmRlZmF1bHRWYXJpYWJsZXMmJih1PW9wLmRlZmF1bHQoe30sdGhpcy5vcHRpb25zLmludGVycG9sYXRpb24uZGVmYXVsdFZhcmlhYmxlcyx1KSksZT10aGlzLmludGVycG9sYXRvci5pbnRlcnBvbGF0ZShlLHUsbi5sbmd8fHRoaXMubGFuZ3VhZ2Usbikscyl7dmFyIGM9ZS5tYXRjaCh0aGlzLmludGVycG9sYXRvci5uZXN0aW5nUmVnZXhwKTthPChjJiZjLmxlbmd0aCkmJihuLm5lc3Q9ITEpO30hMSE9PW4ubmVzdCYmKGU9dGhpcy5pbnRlcnBvbGF0b3IubmVzdChlLChmdW5jdGlvbigpe2Zvcih2YXIgZT1hcmd1bWVudHMubGVuZ3RoLHI9bmV3IEFycmF5KGUpLGE9MDthPGU7YSsrKXJbYV09YXJndW1lbnRzW2FdO3JldHVybiBvJiZvWzBdPT09clswXSYmIW4uY29udGV4dD8oaS5sb2dnZXIud2FybigiSXQgc2VlbXMgeW91IGFyZSBuZXN0aW5nIHJlY3Vyc2l2ZWx5IGtleTogIi5jb25jYXQoclswXSwiIGluIGtleTogIikuY29uY2F0KHRbMF0pKSxudWxsKTppLnRyYW5zbGF0ZS5hcHBseShpLHIuY29uY2F0KFt0XSkpfSksbikpLG4uaW50ZXJwb2xhdGlvbiYmdGhpcy5pbnRlcnBvbGF0b3IucmVzZXQoKTt9dmFyIGY9bi5wb3N0UHJvY2Vzc3x8dGhpcy5vcHRpb25zLnBvc3RQcm9jZXNzLGQ9InN0cmluZyI9PXR5cGVvZiBmP1tmXTpmO3JldHVybiBudWxsIT1lJiZkJiZkLmxlbmd0aCYmITEhPT1uLmFwcGx5UG9zdFByb2Nlc3NvciYmKGU9TXAuaGFuZGxlKGQsZSx0LHRoaXMub3B0aW9ucyYmdGhpcy5vcHRpb25zLnBvc3RQcm9jZXNzUGFzc1Jlc29sdmVkP29wLmRlZmF1bHQoe2kxOG5SZXNvbHZlZDpyfSxuKTpuLHRoaXMpKSxlfX0se2tleToicmVzb2x2ZSIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQsbixyLG8saSxhPXRoaXMscz1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06e307cmV0dXJuICJzdHJpbmciPT10eXBlb2YgZSYmKGU9W2VdKSxlLmZvckVhY2goKGZ1bmN0aW9uKGUpe2lmKCFhLmlzVmFsaWRMb29rdXAodCkpe3ZhciBsPWEuZXh0cmFjdEZyb21LZXkoZSxzKSx1PWwua2V5O249dTt2YXIgYz1sLm5hbWVzcGFjZXM7YS5vcHRpb25zLmZhbGxiYWNrTlMmJihjPWMuY29uY2F0KGEub3B0aW9ucy5mYWxsYmFja05TKSk7dmFyIGY9dm9pZCAwIT09cy5jb3VudCYmInN0cmluZyIhPXR5cGVvZiBzLmNvdW50LGQ9dm9pZCAwIT09cy5jb250ZXh0JiYoInN0cmluZyI9PXR5cGVvZiBzLmNvbnRleHR8fCJudW1iZXIiPT10eXBlb2Ygcy5jb250ZXh0KSYmIiIhPT1zLmNvbnRleHQscD1zLmxuZ3M/cy5sbmdzOmEubGFuZ3VhZ2VVdGlscy50b1Jlc29sdmVIaWVyYXJjaHkocy5sbmd8fGEubGFuZ3VhZ2Uscy5mYWxsYmFja0xuZyk7Yy5mb3JFYWNoKChmdW5jdGlvbihlKXthLmlzVmFsaWRMb29rdXAodCl8fChpPWUsIUxwWyIiLmNvbmNhdChwWzBdLCItIikuY29uY2F0KGUpXSYmYS51dGlscyYmYS51dGlscy5oYXNMb2FkZWROYW1lc3BhY2UmJiFhLnV0aWxzLmhhc0xvYWRlZE5hbWVzcGFjZShpKSYmKExwWyIiLmNvbmNhdChwWzBdLCItIikuY29uY2F0KGUpXT0hMCxhLmxvZ2dlci53YXJuKCdrZXkgIicuY29uY2F0KG4sJyIgZm9yIGxhbmd1YWdlcyAiJykuY29uY2F0KHAuam9pbigiLCAiKSwnIiB3b25cJ3QgZ2V0IHJlc29sdmVkIGFzIG5hbWVzcGFjZSAiJykuY29uY2F0KGksJyIgd2FzIG5vdCB5ZXQgbG9hZGVkJyksIlRoaXMgbWVhbnMgc29tZXRoaW5nIElTIFdST05HIGluIHlvdXIgc2V0dXAuIFlvdSBhY2Nlc3MgdGhlIHQgZnVuY3Rpb24gYmVmb3JlIGkxOG5leHQuaW5pdCAvIGkxOG5leHQubG9hZE5hbWVzcGFjZSAvIGkxOG5leHQuY2hhbmdlTGFuZ3VhZ2Ugd2FzIGRvbmUuIFdhaXQgZm9yIHRoZSBjYWxsYmFjayBvciBQcm9taXNlIHRvIHJlc29sdmUgYmVmb3JlIGFjY2Vzc2luZyBpdCEhISIpKSxwLmZvckVhY2goKGZ1bmN0aW9uKG4pe2lmKCFhLmlzVmFsaWRMb29rdXAodCkpe289bjt2YXIgaSxsLGM9dSxwPVtjXTtpZihhLmkxOG5Gb3JtYXQmJmEuaTE4bkZvcm1hdC5hZGRMb29rdXBLZXlzKWEuaTE4bkZvcm1hdC5hZGRMb29rdXBLZXlzKHAsdSxuLGUscyk7ZWxzZSBmJiYoaT1hLnBsdXJhbFJlc29sdmVyLmdldFN1ZmZpeChuLHMuY291bnQpKSxmJiZkJiZwLnB1c2goYytpKSxkJiZwLnB1c2goYys9IiIuY29uY2F0KGEub3B0aW9ucy5jb250ZXh0U2VwYXJhdG9yKS5jb25jYXQocy5jb250ZXh0KSksZiYmcC5wdXNoKGMrPWkpO2Zvcig7bD1wLnBvcCgpOylhLmlzVmFsaWRMb29rdXAodCl8fChyPWwsdD1hLmdldFJlc291cmNlKG4sZSxsLHMpKTt9fSkpKTt9KSk7fX0pKSx7cmVzOnQsdXNlZEtleTpuLGV4YWN0VXNlZEtleTpyLHVzZWRMbmc6byx1c2VkTlM6aX19fSx7a2V5OiJpc1ZhbGlkTG9va3VwIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gISh2b2lkIDA9PT1lfHwhdGhpcy5vcHRpb25zLnJldHVybk51bGwmJm51bGw9PT1lfHwhdGhpcy5vcHRpb25zLnJldHVybkVtcHR5U3RyaW5nJiYiIj09PWUpfX0se2tleToiZ2V0UmVzb3VyY2UiLHZhbHVlOmZ1bmN0aW9uKGUsdCxuKXt2YXIgcj1hcmd1bWVudHMubGVuZ3RoPjMmJnZvaWQgMCE9PWFyZ3VtZW50c1szXT9hcmd1bWVudHNbM106e307cmV0dXJuIHRoaXMuaTE4bkZvcm1hdCYmdGhpcy5pMThuRm9ybWF0LmdldFJlc291cmNlP3RoaXMuaTE4bkZvcm1hdC5nZXRSZXNvdXJjZShlLHQsbixyKTp0aGlzLnJlc291cmNlU3RvcmUuZ2V0UmVzb3VyY2UoZSx0LG4scil9fV0sW3trZXk6Imhhc0RlZmF1bHRWYWx1ZSIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9ImRlZmF1bHRWYWx1ZSI7Zm9yKHZhciBuIGluIGUpaWYoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsbikmJnQ9PT1uLnN1YnN0cmluZygwLHQubGVuZ3RoKSYmdm9pZCAwIT09ZVtuXSlyZXR1cm4gITA7cmV0dXJuICExfX1dKSx0fShocCk7ZnVuY3Rpb24gUnAoZSl7cmV0dXJuIGUuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkrZS5zbGljZSgxKX12YXIgRHA9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKHQpe2lwLmRlZmF1bHQodGhpcyxlKSx0aGlzLm9wdGlvbnM9dCx0aGlzLndoaXRlbGlzdD10aGlzLm9wdGlvbnMuc3VwcG9ydGVkTG5nc3x8ITEsdGhpcy5zdXBwb3J0ZWRMbmdzPXRoaXMub3B0aW9ucy5zdXBwb3J0ZWRMbmdzfHwhMSx0aGlzLmxvZ2dlcj1wcC5jcmVhdGUoImxhbmd1YWdlVXRpbHMiKTt9cmV0dXJuIGFwLmRlZmF1bHQoZSxbe2tleToiZ2V0U2NyaXB0UGFydEZyb21Db2RlIix2YWx1ZTpmdW5jdGlvbihlKXtpZighZXx8ZS5pbmRleE9mKCItIik8MClyZXR1cm4gbnVsbDt2YXIgdD1lLnNwbGl0KCItIik7cmV0dXJuIDI9PT10Lmxlbmd0aD9udWxsOih0LnBvcCgpLCJ4Ij09PXRbdC5sZW5ndGgtMV0udG9Mb3dlckNhc2UoKT9udWxsOnRoaXMuZm9ybWF0TGFuZ3VhZ2VDb2RlKHQuam9pbigiLSIpKSl9fSx7a2V5OiJnZXRMYW5ndWFnZVBhcnRGcm9tQ29kZSIsdmFsdWU6ZnVuY3Rpb24oZSl7aWYoIWV8fGUuaW5kZXhPZigiLSIpPDApcmV0dXJuIGU7dmFyIHQ9ZS5zcGxpdCgiLSIpO3JldHVybiB0aGlzLmZvcm1hdExhbmd1YWdlQ29kZSh0WzBdKX19LHtrZXk6ImZvcm1hdExhbmd1YWdlQ29kZSIsdmFsdWU6ZnVuY3Rpb24oZSl7aWYoInN0cmluZyI9PXR5cGVvZiBlJiZlLmluZGV4T2YoIi0iKT4tMSl7dmFyIHQ9WyJoYW5zIiwiaGFudCIsImxhdG4iLCJjeXJsIiwiY2FucyIsIm1vbmciLCJhcmFiIl0sbj1lLnNwbGl0KCItIik7cmV0dXJuIHRoaXMub3B0aW9ucy5sb3dlckNhc2VMbmc/bj1uLm1hcCgoZnVuY3Rpb24oZSl7cmV0dXJuIGUudG9Mb3dlckNhc2UoKX0pKToyPT09bi5sZW5ndGg/KG5bMF09blswXS50b0xvd2VyQ2FzZSgpLG5bMV09blsxXS50b1VwcGVyQ2FzZSgpLHQuaW5kZXhPZihuWzFdLnRvTG93ZXJDYXNlKCkpPi0xJiYoblsxXT1ScChuWzFdLnRvTG93ZXJDYXNlKCkpKSk6Mz09PW4ubGVuZ3RoJiYoblswXT1uWzBdLnRvTG93ZXJDYXNlKCksMj09PW5bMV0ubGVuZ3RoJiYoblsxXT1uWzFdLnRvVXBwZXJDYXNlKCkpLCJzZ24iIT09blswXSYmMj09PW5bMl0ubGVuZ3RoJiYoblsyXT1uWzJdLnRvVXBwZXJDYXNlKCkpLHQuaW5kZXhPZihuWzFdLnRvTG93ZXJDYXNlKCkpPi0xJiYoblsxXT1ScChuWzFdLnRvTG93ZXJDYXNlKCkpKSx0LmluZGV4T2YoblsyXS50b0xvd2VyQ2FzZSgpKT4tMSYmKG5bMl09UnAoblsyXS50b0xvd2VyQ2FzZSgpKSkpLG4uam9pbigiLSIpfXJldHVybiB0aGlzLm9wdGlvbnMuY2xlYW5Db2RlfHx0aGlzLm9wdGlvbnMubG93ZXJDYXNlTG5nP2UudG9Mb3dlckNhc2UoKTplfX0se2tleToiaXNXaGl0ZWxpc3RlZCIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMubG9nZ2VyLmRlcHJlY2F0ZSgibGFuZ3VhZ2VVdGlscy5pc1doaXRlbGlzdGVkIiwnZnVuY3Rpb24gImlzV2hpdGVsaXN0ZWQiIHdpbGwgYmUgcmVuYW1lZCB0byAiaXNTdXBwb3J0ZWRDb2RlIiBpbiB0aGUgbmV4dCBtYWpvciAtIHBsZWFzZSBtYWtlIHN1cmUgdG8gcmVuYW1lIGl0XCdzIHVzYWdlIGFzYXAuJyksdGhpcy5pc1N1cHBvcnRlZENvZGUoZSl9fSx7a2V5OiJpc1N1cHBvcnRlZENvZGUiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiAoImxhbmd1YWdlT25seSI9PT10aGlzLm9wdGlvbnMubG9hZHx8dGhpcy5vcHRpb25zLm5vbkV4cGxpY2l0U3VwcG9ydGVkTG5ncykmJihlPXRoaXMuZ2V0TGFuZ3VhZ2VQYXJ0RnJvbUNvZGUoZSkpLCF0aGlzLnN1cHBvcnRlZExuZ3N8fCF0aGlzLnN1cHBvcnRlZExuZ3MubGVuZ3RofHx0aGlzLnN1cHBvcnRlZExuZ3MuaW5kZXhPZihlKT4tMX19LHtrZXk6ImdldEJlc3RNYXRjaEZyb21Db2RlcyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQsbj10aGlzO3JldHVybiBlPyhlLmZvckVhY2goKGZ1bmN0aW9uKGUpe2lmKCF0KXt2YXIgcj1uLmZvcm1hdExhbmd1YWdlQ29kZShlKTtuLm9wdGlvbnMuc3VwcG9ydGVkTG5ncyYmIW4uaXNTdXBwb3J0ZWRDb2RlKHIpfHwodD1yKTt9fSkpLCF0JiZ0aGlzLm9wdGlvbnMuc3VwcG9ydGVkTG5ncyYmZS5mb3JFYWNoKChmdW5jdGlvbihlKXtpZighdCl7dmFyIHI9bi5nZXRMYW5ndWFnZVBhcnRGcm9tQ29kZShlKTtpZihuLmlzU3VwcG9ydGVkQ29kZShyKSlyZXR1cm4gdD1yO3Q9bi5vcHRpb25zLnN1cHBvcnRlZExuZ3MuZmluZCgoZnVuY3Rpb24oZSl7aWYoMD09PWUuaW5kZXhPZihyKSlyZXR1cm4gZX0pKTt9fSkpLHR8fCh0PXRoaXMuZ2V0RmFsbGJhY2tDb2Rlcyh0aGlzLm9wdGlvbnMuZmFsbGJhY2tMbmcpWzBdKSx0KTpudWxsfX0se2tleToiZ2V0RmFsbGJhY2tDb2RlcyIsdmFsdWU6ZnVuY3Rpb24oZSx0KXtpZighZSlyZXR1cm4gW107aWYoImZ1bmN0aW9uIj09dHlwZW9mIGUmJihlPWUodCkpLCJzdHJpbmciPT10eXBlb2YgZSYmKGU9W2VdKSwiW29iamVjdCBBcnJheV0iPT09T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5hcHBseShlKSlyZXR1cm4gZTtpZighdClyZXR1cm4gZS5kZWZhdWx0fHxbXTt2YXIgbj1lW3RdO3JldHVybiBufHwobj1lW3RoaXMuZ2V0U2NyaXB0UGFydEZyb21Db2RlKHQpXSksbnx8KG49ZVt0aGlzLmZvcm1hdExhbmd1YWdlQ29kZSh0KV0pLG58fChuPWVbdGhpcy5nZXRMYW5ndWFnZVBhcnRGcm9tQ29kZSh0KV0pLG58fChuPWUuZGVmYXVsdCksbnx8W119fSx7a2V5OiJ0b1Jlc29sdmVIaWVyYXJjaHkiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dmFyIG49dGhpcyxyPXRoaXMuZ2V0RmFsbGJhY2tDb2Rlcyh0fHx0aGlzLm9wdGlvbnMuZmFsbGJhY2tMbmd8fFtdLGUpLG89W10saT1mdW5jdGlvbihlKXtlJiYobi5pc1N1cHBvcnRlZENvZGUoZSk/by5wdXNoKGUpOm4ubG9nZ2VyLndhcm4oInJlamVjdGluZyBsYW5ndWFnZSBjb2RlIG5vdCBmb3VuZCBpbiBzdXBwb3J0ZWRMbmdzOiAiLmNvbmNhdChlKSkpO307cmV0dXJuICJzdHJpbmciPT10eXBlb2YgZSYmZS5pbmRleE9mKCItIik+LTE/KCJsYW5ndWFnZU9ubHkiIT09dGhpcy5vcHRpb25zLmxvYWQmJmkodGhpcy5mb3JtYXRMYW5ndWFnZUNvZGUoZSkpLCJsYW5ndWFnZU9ubHkiIT09dGhpcy5vcHRpb25zLmxvYWQmJiJjdXJyZW50T25seSIhPT10aGlzLm9wdGlvbnMubG9hZCYmaSh0aGlzLmdldFNjcmlwdFBhcnRGcm9tQ29kZShlKSksImN1cnJlbnRPbmx5IiE9PXRoaXMub3B0aW9ucy5sb2FkJiZpKHRoaXMuZ2V0TGFuZ3VhZ2VQYXJ0RnJvbUNvZGUoZSkpKToic3RyaW5nIj09dHlwZW9mIGUmJmkodGhpcy5mb3JtYXRMYW5ndWFnZUNvZGUoZSkpLHIuZm9yRWFjaCgoZnVuY3Rpb24oZSl7by5pbmRleE9mKGUpPDAmJmkobi5mb3JtYXRMYW5ndWFnZUNvZGUoZSkpO30pKSxvfX1dKSxlfSgpLGpwPVt7bG5nczpbImFjaCIsImFrIiwiYW0iLCJhcm4iLCJiciIsImZpbCIsImd1biIsImxuIiwibWZlIiwibWciLCJtaSIsIm9jIiwicHQiLCJwdC1CUiIsInRnIiwidGwiLCJ0aSIsInRyIiwidXoiLCJ3YSJdLG5yOlsxLDJdLGZjOjF9LHtsbmdzOlsiYWYiLCJhbiIsImFzdCIsImF6IiwiYmciLCJibiIsImNhIiwiZGEiLCJkZSIsImRldiIsImVsIiwiZW4iLCJlbyIsImVzIiwiZXQiLCJldSIsImZpIiwiZm8iLCJmdXIiLCJmeSIsImdsIiwiZ3UiLCJoYSIsImhpIiwiaHUiLCJoeSIsImlhIiwiaXQiLCJrayIsImtuIiwia3UiLCJsYiIsIm1haSIsIm1sIiwibW4iLCJtciIsIm5haCIsIm5hcCIsIm5iIiwibmUiLCJubCIsIm5uIiwibm8iLCJuc28iLCJwYSIsInBhcCIsInBtcyIsInBzIiwicHQtUFQiLCJybSIsInNjbyIsInNlIiwic2kiLCJzbyIsInNvbiIsInNxIiwic3YiLCJzdyIsInRhIiwidGUiLCJ0ayIsInVyIiwieW8iXSxucjpbMSwyXSxmYzoyfSx7bG5nczpbImF5IiwiYm8iLCJjZ2ciLCJmYSIsImh0IiwiaWQiLCJqYSIsImpibyIsImthIiwia20iLCJrbyIsImt5IiwibG8iLCJtcyIsInNhaCIsInN1IiwidGgiLCJ0dCIsInVnIiwidmkiLCJ3byIsInpoIl0sbnI6WzFdLGZjOjN9LHtsbmdzOlsiYmUiLCJicyIsImNuciIsImR6IiwiaHIiLCJydSIsInNyIiwidWsiXSxucjpbMSwyLDVdLGZjOjR9LHtsbmdzOlsiYXIiXSxucjpbMCwxLDIsMywxMSwxMDBdLGZjOjV9LHtsbmdzOlsiY3MiLCJzayJdLG5yOlsxLDIsNV0sZmM6Nn0se2xuZ3M6WyJjc2IiLCJwbCJdLG5yOlsxLDIsNV0sZmM6N30se2xuZ3M6WyJjeSJdLG5yOlsxLDIsMyw4XSxmYzo4fSx7bG5nczpbImZyIl0sbnI6WzEsMl0sZmM6OX0se2xuZ3M6WyJnYSJdLG5yOlsxLDIsMyw3LDExXSxmYzoxMH0se2xuZ3M6WyJnZCJdLG5yOlsxLDIsMywyMF0sZmM6MTF9LHtsbmdzOlsiaXMiXSxucjpbMSwyXSxmYzoxMn0se2xuZ3M6WyJqdiJdLG5yOlswLDFdLGZjOjEzfSx7bG5nczpbImt3Il0sbnI6WzEsMiwzLDRdLGZjOjE0fSx7bG5nczpbImx0Il0sbnI6WzEsMiwxMF0sZmM6MTV9LHtsbmdzOlsibHYiXSxucjpbMSwyLDBdLGZjOjE2fSx7bG5nczpbIm1rIl0sbnI6WzEsMl0sZmM6MTd9LHtsbmdzOlsibW5rIl0sbnI6WzAsMSwyXSxmYzoxOH0se2xuZ3M6WyJtdCJdLG5yOlsxLDIsMTEsMjBdLGZjOjE5fSx7bG5nczpbIm9yIl0sbnI6WzIsMV0sZmM6Mn0se2xuZ3M6WyJybyJdLG5yOlsxLDIsMjBdLGZjOjIwfSx7bG5nczpbInNsIl0sbnI6WzUsMSwyLDNdLGZjOjIxfSx7bG5nczpbImhlIiwiaXciXSxucjpbMSwyLDIwLDIxXSxmYzoyMn1dLEFwPXsxOmZ1bmN0aW9uKGUpe3JldHVybiBOdW1iZXIoZT4xKX0sMjpmdW5jdGlvbihlKXtyZXR1cm4gTnVtYmVyKDEhPWUpfSwzOmZ1bmN0aW9uKGUpe3JldHVybiAwfSw0OmZ1bmN0aW9uKGUpe3JldHVybiBOdW1iZXIoZSUxMD09MSYmZSUxMDAhPTExPzA6ZSUxMD49MiYmZSUxMDw9NCYmKGUlMTAwPDEwfHxlJTEwMD49MjApPzE6Mil9LDU6ZnVuY3Rpb24oZSl7cmV0dXJuIE51bWJlcigwPT1lPzA6MT09ZT8xOjI9PWU/MjplJTEwMD49MyYmZSUxMDA8PTEwPzM6ZSUxMDA+PTExPzQ6NSl9LDY6ZnVuY3Rpb24oZSl7cmV0dXJuIE51bWJlcigxPT1lPzA6ZT49MiYmZTw9ND8xOjIpfSw3OmZ1bmN0aW9uKGUpe3JldHVybiBOdW1iZXIoMT09ZT8wOmUlMTA+PTImJmUlMTA8PTQmJihlJTEwMDwxMHx8ZSUxMDA+PTIwKT8xOjIpfSw4OmZ1bmN0aW9uKGUpe3JldHVybiBOdW1iZXIoMT09ZT8wOjI9PWU/MTo4IT1lJiYxMSE9ZT8yOjMpfSw5OmZ1bmN0aW9uKGUpe3JldHVybiBOdW1iZXIoZT49Mil9LDEwOmZ1bmN0aW9uKGUpe3JldHVybiBOdW1iZXIoMT09ZT8wOjI9PWU/MTplPDc/MjplPDExPzM6NCl9LDExOmZ1bmN0aW9uKGUpe3JldHVybiBOdW1iZXIoMT09ZXx8MTE9PWU/MDoyPT1lfHwxMj09ZT8xOmU+MiYmZTwyMD8yOjMpfSwxMjpmdW5jdGlvbihlKXtyZXR1cm4gTnVtYmVyKGUlMTAhPTF8fGUlMTAwPT0xMSl9LDEzOmZ1bmN0aW9uKGUpe3JldHVybiBOdW1iZXIoMCE9PWUpfSwxNDpmdW5jdGlvbihlKXtyZXR1cm4gTnVtYmVyKDE9PWU/MDoyPT1lPzE6Mz09ZT8yOjMpfSwxNTpmdW5jdGlvbihlKXtyZXR1cm4gTnVtYmVyKGUlMTA9PTEmJmUlMTAwIT0xMT8wOmUlMTA+PTImJihlJTEwMDwxMHx8ZSUxMDA+PTIwKT8xOjIpfSwxNjpmdW5jdGlvbihlKXtyZXR1cm4gTnVtYmVyKGUlMTA9PTEmJmUlMTAwIT0xMT8wOjAhPT1lPzE6Mil9LDE3OmZ1bmN0aW9uKGUpe3JldHVybiBOdW1iZXIoMT09ZXx8ZSUxMD09MSYmZSUxMDAhPTExPzA6MSl9LDE4OmZ1bmN0aW9uKGUpe3JldHVybiBOdW1iZXIoMD09ZT8wOjE9PWU/MToyKX0sMTk6ZnVuY3Rpb24oZSl7cmV0dXJuIE51bWJlcigxPT1lPzA6MD09ZXx8ZSUxMDA+MSYmZSUxMDA8MTE/MTplJTEwMD4xMCYmZSUxMDA8MjA/MjozKX0sMjA6ZnVuY3Rpb24oZSl7cmV0dXJuIE51bWJlcigxPT1lPzA6MD09ZXx8ZSUxMDA+MCYmZSUxMDA8MjA/MToyKX0sMjE6ZnVuY3Rpb24oZSl7cmV0dXJuIE51bWJlcihlJTEwMD09MT8xOmUlMTAwPT0yPzI6ZSUxMDA9PTN8fGUlMTAwPT00PzM6MCl9LDIyOmZ1bmN0aW9uKGUpe3JldHVybiBOdW1iZXIoMT09ZT8wOjI9PWU/MTooZTwwfHxlPjEwKSYmZSUxMD09MD8yOjMpfX07ZnVuY3Rpb24gX3AoKXt2YXIgZT17fTtyZXR1cm4ganAuZm9yRWFjaCgoZnVuY3Rpb24odCl7dC5sbmdzLmZvckVhY2goKGZ1bmN0aW9uKG4pe2Vbbl09e251bWJlcnM6dC5ucixwbHVyYWxzOkFwW3QuZmNdfTt9KSk7fSkpLGV9dmFyIEZwPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSh0KXt2YXIgbj1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06e307aXAuZGVmYXVsdCh0aGlzLGUpLHRoaXMubGFuZ3VhZ2VVdGlscz10LHRoaXMub3B0aW9ucz1uLHRoaXMubG9nZ2VyPXBwLmNyZWF0ZSgicGx1cmFsUmVzb2x2ZXIiKSx0aGlzLnJ1bGVzPV9wKCk7fXJldHVybiBhcC5kZWZhdWx0KGUsW3trZXk6ImFkZFJ1bGUiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dGhpcy5ydWxlc1tlXT10O319LHtrZXk6ImdldFJ1bGUiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnJ1bGVzW2VdfHx0aGlzLnJ1bGVzW3RoaXMubGFuZ3VhZ2VVdGlscy5nZXRMYW5ndWFnZVBhcnRGcm9tQ29kZShlKV19fSx7a2V5OiJuZWVkc1BsdXJhbCIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5nZXRSdWxlKGUpO3JldHVybiB0JiZ0Lm51bWJlcnMubGVuZ3RoPjF9fSx7a2V5OiJnZXRQbHVyYWxGb3Jtc09mS2V5Iix2YWx1ZTpmdW5jdGlvbihlLHQpe3JldHVybiB0aGlzLmdldFN1ZmZpeGVzKGUpLm1hcCgoZnVuY3Rpb24oZSl7cmV0dXJuIHQrZX0pKX19LHtrZXk6ImdldFN1ZmZpeGVzIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD10aGlzLG49dGhpcy5nZXRSdWxlKGUpO3JldHVybiBuP24ubnVtYmVycy5tYXAoKGZ1bmN0aW9uKG4pe3JldHVybiB0LmdldFN1ZmZpeChlLG4pfSkpOltdfX0se2tleToiZ2V0U3VmZml4Iix2YWx1ZTpmdW5jdGlvbihlLHQpe3ZhciBuPXRoaXMscj10aGlzLmdldFJ1bGUoZSk7aWYocil7dmFyIG89ci5ub0Ficz9yLnBsdXJhbHModCk6ci5wbHVyYWxzKE1hdGguYWJzKHQpKSxpPXIubnVtYmVyc1tvXTt0aGlzLm9wdGlvbnMuc2ltcGxpZnlQbHVyYWxTdWZmaXgmJjI9PT1yLm51bWJlcnMubGVuZ3RoJiYxPT09ci5udW1iZXJzWzBdJiYoMj09PWk/aT0icGx1cmFsIjoxPT09aSYmKGk9IiIpKTt2YXIgYT1mdW5jdGlvbigpe3JldHVybiBuLm9wdGlvbnMucHJlcGVuZCYmaS50b1N0cmluZygpP24ub3B0aW9ucy5wcmVwZW5kK2kudG9TdHJpbmcoKTppLnRvU3RyaW5nKCl9O3JldHVybiAidjEiPT09dGhpcy5vcHRpb25zLmNvbXBhdGliaWxpdHlKU09OPzE9PT1pPyIiOiJudW1iZXIiPT10eXBlb2YgaT8iX3BsdXJhbF8iLmNvbmNhdChpLnRvU3RyaW5nKCkpOmEoKToidjIiPT09dGhpcy5vcHRpb25zLmNvbXBhdGliaWxpdHlKU09OfHx0aGlzLm9wdGlvbnMuc2ltcGxpZnlQbHVyYWxTdWZmaXgmJjI9PT1yLm51bWJlcnMubGVuZ3RoJiYxPT09ci5udW1iZXJzWzBdP2EoKTp0aGlzLm9wdGlvbnMucHJlcGVuZCYmby50b1N0cmluZygpP3RoaXMub3B0aW9ucy5wcmVwZW5kK28udG9TdHJpbmcoKTpvLnRvU3RyaW5nKCl9cmV0dXJuIHRoaXMubG9nZ2VyLndhcm4oIm5vIHBsdXJhbCBydWxlIGZvdW5kIGZvcjogIi5jb25jYXQoZSkpLCIifX1dKSxlfSgpLElwPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSgpe3ZhciB0PWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTp7fTtpcC5kZWZhdWx0KHRoaXMsZSksdGhpcy5sb2dnZXI9cHAuY3JlYXRlKCJpbnRlcnBvbGF0b3IiKSx0aGlzLm9wdGlvbnM9dCx0aGlzLmZvcm1hdD10LmludGVycG9sYXRpb24mJnQuaW50ZXJwb2xhdGlvbi5mb3JtYXR8fGZ1bmN0aW9uKGUpe3JldHVybiBlfSx0aGlzLmluaXQodCk7fXJldHVybiBhcC5kZWZhdWx0KGUsW3trZXk6ImluaXQiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU9YXJndW1lbnRzLmxlbmd0aD4wJiZ2b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOnt9O2UuaW50ZXJwb2xhdGlvbnx8KGUuaW50ZXJwb2xhdGlvbj17ZXNjYXBlVmFsdWU6ITB9KTt2YXIgdD1lLmludGVycG9sYXRpb247dGhpcy5lc2NhcGU9dm9pZCAwIT09dC5lc2NhcGU/dC5lc2NhcGU6T3AsdGhpcy5lc2NhcGVWYWx1ZT12b2lkIDA9PT10LmVzY2FwZVZhbHVlfHx0LmVzY2FwZVZhbHVlLHRoaXMudXNlUmF3VmFsdWVUb0VzY2FwZT12b2lkIDAhPT10LnVzZVJhd1ZhbHVlVG9Fc2NhcGUmJnQudXNlUmF3VmFsdWVUb0VzY2FwZSx0aGlzLnByZWZpeD10LnByZWZpeD9TcCh0LnByZWZpeCk6dC5wcmVmaXhFc2NhcGVkfHwie3siLHRoaXMuc3VmZml4PXQuc3VmZml4P1NwKHQuc3VmZml4KTp0LnN1ZmZpeEVzY2FwZWR8fCJ9fSIsdGhpcy5mb3JtYXRTZXBhcmF0b3I9dC5mb3JtYXRTZXBhcmF0b3I/dC5mb3JtYXRTZXBhcmF0b3I6dC5mb3JtYXRTZXBhcmF0b3J8fCIsIix0aGlzLnVuZXNjYXBlUHJlZml4PXQudW5lc2NhcGVTdWZmaXg/IiI6dC51bmVzY2FwZVByZWZpeHx8Ii0iLHRoaXMudW5lc2NhcGVTdWZmaXg9dGhpcy51bmVzY2FwZVByZWZpeD8iIjp0LnVuZXNjYXBlU3VmZml4fHwiIix0aGlzLm5lc3RpbmdQcmVmaXg9dC5uZXN0aW5nUHJlZml4P1NwKHQubmVzdGluZ1ByZWZpeCk6dC5uZXN0aW5nUHJlZml4RXNjYXBlZHx8U3AoIiR0KCIpLHRoaXMubmVzdGluZ1N1ZmZpeD10Lm5lc3RpbmdTdWZmaXg/U3AodC5uZXN0aW5nU3VmZml4KTp0Lm5lc3RpbmdTdWZmaXhFc2NhcGVkfHxTcCgiKSIpLHRoaXMubmVzdGluZ09wdGlvbnNTZXBhcmF0b3I9dC5uZXN0aW5nT3B0aW9uc1NlcGFyYXRvcj90Lm5lc3RpbmdPcHRpb25zU2VwYXJhdG9yOnQubmVzdGluZ09wdGlvbnNTZXBhcmF0b3J8fCIsIix0aGlzLm1heFJlcGxhY2VzPXQubWF4UmVwbGFjZXM/dC5tYXhSZXBsYWNlczoxZTMsdGhpcy5hbHdheXNGb3JtYXQ9dm9pZCAwIT09dC5hbHdheXNGb3JtYXQmJnQuYWx3YXlzRm9ybWF0LHRoaXMucmVzZXRSZWdFeHAoKTt9fSx7a2V5OiJyZXNldCIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLm9wdGlvbnMmJnRoaXMuaW5pdCh0aGlzLm9wdGlvbnMpO319LHtrZXk6InJlc2V0UmVnRXhwIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPSIiLmNvbmNhdCh0aGlzLnByZWZpeCwiKC4rPykiKS5jb25jYXQodGhpcy5zdWZmaXgpO3RoaXMucmVnZXhwPW5ldyBSZWdFeHAoZSwiZyIpO3ZhciB0PSIiLmNvbmNhdCh0aGlzLnByZWZpeCkuY29uY2F0KHRoaXMudW5lc2NhcGVQcmVmaXgsIiguKz8pIikuY29uY2F0KHRoaXMudW5lc2NhcGVTdWZmaXgpLmNvbmNhdCh0aGlzLnN1ZmZpeCk7dGhpcy5yZWdleHBVbmVzY2FwZT1uZXcgUmVnRXhwKHQsImciKTt2YXIgbj0iIi5jb25jYXQodGhpcy5uZXN0aW5nUHJlZml4LCIoLis/KSIpLmNvbmNhdCh0aGlzLm5lc3RpbmdTdWZmaXgpO3RoaXMubmVzdGluZ1JlZ2V4cD1uZXcgUmVnRXhwKG4sImciKTt9fSx7a2V5OiJpbnRlcnBvbGF0ZSIsdmFsdWU6ZnVuY3Rpb24oZSx0LG4scil7dmFyIG8saSxhLHM9dGhpcyxsPXRoaXMub3B0aW9ucyYmdGhpcy5vcHRpb25zLmludGVycG9sYXRpb24mJnRoaXMub3B0aW9ucy5pbnRlcnBvbGF0aW9uLmRlZmF1bHRWYXJpYWJsZXN8fHt9O2Z1bmN0aW9uIHUoZSl7cmV0dXJuIGUucmVwbGFjZSgvXCQvZywiJCQkJCIpfXZhciBjPWZ1bmN0aW9uKGUpe2lmKGUuaW5kZXhPZihzLmZvcm1hdFNlcGFyYXRvcik8MCl7dmFyIG89eHAodCxsLGUpO3JldHVybiBzLmFsd2F5c0Zvcm1hdD9zLmZvcm1hdChvLHZvaWQgMCxuLG9wLmRlZmF1bHQoe30scix0LHtpbnRlcnBvbGF0aW9ua2V5OmV9KSk6b312YXIgaT1lLnNwbGl0KHMuZm9ybWF0U2VwYXJhdG9yKSxhPWkuc2hpZnQoKS50cmltKCksdT1pLmpvaW4ocy5mb3JtYXRTZXBhcmF0b3IpLnRyaW0oKTtyZXR1cm4gcy5mb3JtYXQoeHAodCxsLGEpLHUsbixvcC5kZWZhdWx0KHt9LHIsdCx7aW50ZXJwb2xhdGlvbmtleTphfSkpfTt0aGlzLnJlc2V0UmVnRXhwKCk7dmFyIGY9ciYmci5taXNzaW5nSW50ZXJwb2xhdGlvbkhhbmRsZXJ8fHRoaXMub3B0aW9ucy5taXNzaW5nSW50ZXJwb2xhdGlvbkhhbmRsZXIsZD1yJiZyLmludGVycG9sYXRpb24mJnIuaW50ZXJwb2xhdGlvbi5za2lwT25WYXJpYWJsZXN8fHRoaXMub3B0aW9ucy5pbnRlcnBvbGF0aW9uLnNraXBPblZhcmlhYmxlcztyZXR1cm4gW3tyZWdleDp0aGlzLnJlZ2V4cFVuZXNjYXBlLHNhZmVWYWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gdShlKX19LHtyZWdleDp0aGlzLnJlZ2V4cCxzYWZlVmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHMuZXNjYXBlVmFsdWU/dShzLmVzY2FwZShlKSk6dShlKX19XS5mb3JFYWNoKChmdW5jdGlvbih0KXtmb3IoYT0wO289dC5yZWdleC5leGVjKGUpOyl7aWYodm9pZCAwPT09KGk9YyhvWzFdLnRyaW0oKSkpKWlmKCJmdW5jdGlvbiI9PXR5cGVvZiBmKXt2YXIgbj1mKGUsbyxyKTtpPSJzdHJpbmciPT10eXBlb2Ygbj9uOiIiO31lbHNlIHtpZihkKXtpPW9bMF07Y29udGludWV9cy5sb2dnZXIud2FybigibWlzc2VkIHRvIHBhc3MgaW4gdmFyaWFibGUgIi5jb25jYXQob1sxXSwiIGZvciBpbnRlcnBvbGF0aW5nICIpLmNvbmNhdChlKSksaT0iIjt9ZWxzZSAic3RyaW5nIj09dHlwZW9mIGl8fHMudXNlUmF3VmFsdWVUb0VzY2FwZXx8KGk9dnAoaSkpO3ZhciBsPXQuc2FmZVZhbHVlKGkpO2lmKGU9ZS5yZXBsYWNlKG9bMF0sbCksZD8odC5yZWdleC5sYXN0SW5kZXgrPWwubGVuZ3RoLHQucmVnZXgubGFzdEluZGV4LT1vWzBdLmxlbmd0aCk6dC5yZWdleC5sYXN0SW5kZXg9MCwrK2E+PXMubWF4UmVwbGFjZXMpYnJlYWt9fSkpLGV9fSx7a2V5OiJuZXN0Iix2YWx1ZTpmdW5jdGlvbihlLHQpe3ZhciBuLHIsbz10aGlzLGk9YXJndW1lbnRzLmxlbmd0aD4yJiZ2b2lkIDAhPT1hcmd1bWVudHNbMl0/YXJndW1lbnRzWzJdOnt9LGE9b3AuZGVmYXVsdCh7fSxpKTtmdW5jdGlvbiBzKGUsdCl7dmFyIG49dGhpcy5uZXN0aW5nT3B0aW9uc1NlcGFyYXRvcjtpZihlLmluZGV4T2Yobik8MClyZXR1cm4gZTt2YXIgcj1lLnNwbGl0KG5ldyBSZWdFeHAoIiIuY29uY2F0KG4sIlsgXSp7IikpKSxvPSJ7Ii5jb25jYXQoclsxXSk7ZT1yWzBdLG89KG89dGhpcy5pbnRlcnBvbGF0ZShvLGEpKS5yZXBsYWNlKC8nL2csJyInKTt0cnl7YT1KU09OLnBhcnNlKG8pLHQmJihhPW9wLmRlZmF1bHQoe30sdCxhKSk7fWNhdGNoKHQpe3JldHVybiB0aGlzLmxvZ2dlci53YXJuKCJmYWlsZWQgcGFyc2luZyBvcHRpb25zIHN0cmluZyBpbiBuZXN0aW5nIGZvciBrZXkgIi5jb25jYXQoZSksdCksIiIuY29uY2F0KGUpLmNvbmNhdChuKS5jb25jYXQobyl9cmV0dXJuIGRlbGV0ZSBhLmRlZmF1bHRWYWx1ZSxlfWZvcihhLmFwcGx5UG9zdFByb2Nlc3Nvcj0hMSxkZWxldGUgYS5kZWZhdWx0VmFsdWU7bj10aGlzLm5lc3RpbmdSZWdleHAuZXhlYyhlKTspe3ZhciBsPVtdLHU9ITE7aWYoLTEhPT1uWzBdLmluZGV4T2YodGhpcy5mb3JtYXRTZXBhcmF0b3IpJiYhL3suKn0vLnRlc3QoblsxXSkpe3ZhciBjPW5bMV0uc3BsaXQodGhpcy5mb3JtYXRTZXBhcmF0b3IpLm1hcCgoZnVuY3Rpb24oZSl7cmV0dXJuIGUudHJpbSgpfSkpO25bMV09Yy5zaGlmdCgpLGw9Yyx1PSEwO31pZigocj10KHMuY2FsbCh0aGlzLG5bMV0udHJpbSgpLGEpLGEpKSYmblswXT09PWUmJiJzdHJpbmciIT10eXBlb2YgcilyZXR1cm4gcjsic3RyaW5nIiE9dHlwZW9mIHImJihyPXZwKHIpKSxyfHwodGhpcy5sb2dnZXIud2FybigibWlzc2VkIHRvIHJlc29sdmUgIi5jb25jYXQoblsxXSwiIGZvciBuZXN0aW5nICIpLmNvbmNhdChlKSkscj0iIiksdSYmKHI9bC5yZWR1Y2UoKGZ1bmN0aW9uKGUsdCl7cmV0dXJuIG8uZm9ybWF0KGUsdCxpLmxuZyxvcC5kZWZhdWx0KHt9LGkse2ludGVycG9sYXRpb25rZXk6blsxXS50cmltKCl9KSl9KSxyLnRyaW0oKSkpLGU9ZS5yZXBsYWNlKG5bMF0sciksdGhpcy5yZWdleHAubGFzdEluZGV4PTA7fXJldHVybiBlfX1dKSxlfSgpO3ZhciBCcD1mdW5jdGlvbihlKXtmdW5jdGlvbiB0KGUsbixyKXt2YXIgbyxpPWFyZ3VtZW50cy5sZW5ndGg+MyYmdm9pZCAwIT09YXJndW1lbnRzWzNdP2FyZ3VtZW50c1szXTp7fTtyZXR1cm4gaXAuZGVmYXVsdCh0aGlzLHQpLG89c3AuZGVmYXVsdCh0aGlzLGxwLmRlZmF1bHQodCkuY2FsbCh0aGlzKSksQ3AmJmhwLmNhbGwodXAuZGVmYXVsdChvKSksby5iYWNrZW5kPWUsby5zdG9yZT1uLG8uc2VydmljZXM9cixvLmxhbmd1YWdlVXRpbHM9ci5sYW5ndWFnZVV0aWxzLG8ub3B0aW9ucz1pLG8ubG9nZ2VyPXBwLmNyZWF0ZSgiYmFja2VuZENvbm5lY3RvciIpLG8uc3RhdGU9e30sby5xdWV1ZT1bXSxvLmJhY2tlbmQmJm8uYmFja2VuZC5pbml0JiZvLmJhY2tlbmQuaW5pdChyLGkuYmFja2VuZCxpKSxvfXJldHVybiBjcC5kZWZhdWx0KHQsZSksYXAuZGVmYXVsdCh0LFt7a2V5OiJxdWV1ZUxvYWQiLHZhbHVlOmZ1bmN0aW9uKGUsdCxuLHIpe3ZhciBvPXRoaXMsaT1bXSxhPVtdLHM9W10sbD1bXTtyZXR1cm4gZS5mb3JFYWNoKChmdW5jdGlvbihlKXt2YXIgcj0hMDt0LmZvckVhY2goKGZ1bmN0aW9uKHQpe3ZhciBzPSIiLmNvbmNhdChlLCJ8IikuY29uY2F0KHQpOyFuLnJlbG9hZCYmby5zdG9yZS5oYXNSZXNvdXJjZUJ1bmRsZShlLHQpP28uc3RhdGVbc109MjpvLnN0YXRlW3NdPDB8fCgxPT09by5zdGF0ZVtzXT9hLmluZGV4T2Yocyk8MCYmYS5wdXNoKHMpOihvLnN0YXRlW3NdPTEscj0hMSxhLmluZGV4T2Yocyk8MCYmYS5wdXNoKHMpLGkuaW5kZXhPZihzKTwwJiZpLnB1c2gocyksbC5pbmRleE9mKHQpPDAmJmwucHVzaCh0KSkpO30pKSxyfHxzLnB1c2goZSk7fSkpLChpLmxlbmd0aHx8YS5sZW5ndGgpJiZ0aGlzLnF1ZXVlLnB1c2goe3BlbmRpbmc6YSxsb2FkZWQ6e30sZXJyb3JzOltdLGNhbGxiYWNrOnJ9KSx7dG9Mb2FkOmkscGVuZGluZzphLHRvTG9hZExhbmd1YWdlczpzLHRvTG9hZE5hbWVzcGFjZXM6bH19fSx7a2V5OiJsb2FkZWQiLHZhbHVlOmZ1bmN0aW9uKGUsdCxuKXt2YXIgcj1lLnNwbGl0KCJ8Iiksbz1yWzBdLGk9clsxXTt0JiZ0aGlzLmVtaXQoImZhaWxlZExvYWRpbmciLG8saSx0KSxuJiZ0aGlzLnN0b3JlLmFkZFJlc291cmNlQnVuZGxlKG8saSxuKSx0aGlzLnN0YXRlW2VdPXQ/LTE6Mjt2YXIgYT17fTt0aGlzLnF1ZXVlLmZvckVhY2goKGZ1bmN0aW9uKG4peyFmdW5jdGlvbihlLHQsbixyKXt2YXIgbz1tcChlLHQsT2JqZWN0KSxpPW8ub2JqLGE9by5rO2lbYV09aVthXXx8W10sciYmKGlbYV09aVthXS5jb25jYXQobikpLHJ8fGlbYV0ucHVzaChuKTt9KG4ubG9hZGVkLFtvXSxpKSxmdW5jdGlvbihlLHQpe2Zvcih2YXIgbj1lLmluZGV4T2YodCk7LTEhPT1uOyllLnNwbGljZShuLDEpLG49ZS5pbmRleE9mKHQpO30obi5wZW5kaW5nLGUpLHQmJm4uZXJyb3JzLnB1c2godCksMCE9PW4ucGVuZGluZy5sZW5ndGh8fG4uZG9uZXx8KE9iamVjdC5rZXlzKG4ubG9hZGVkKS5mb3JFYWNoKChmdW5jdGlvbihlKXthW2VdfHwoYVtlXT1bXSksbi5sb2FkZWRbZV0ubGVuZ3RoJiZuLmxvYWRlZFtlXS5mb3JFYWNoKChmdW5jdGlvbih0KXthW2VdLmluZGV4T2YodCk8MCYmYVtlXS5wdXNoKHQpO30pKTt9KSksbi5kb25lPSEwLG4uZXJyb3JzLmxlbmd0aD9uLmNhbGxiYWNrKG4uZXJyb3JzKTpuLmNhbGxiYWNrKCkpO30pKSx0aGlzLmVtaXQoImxvYWRlZCIsYSksdGhpcy5xdWV1ZT10aGlzLnF1ZXVlLmZpbHRlcigoZnVuY3Rpb24oZSl7cmV0dXJuICFlLmRvbmV9KSk7fX0se2tleToicmVhZCIsdmFsdWU6ZnVuY3Rpb24oZSx0LG4pe3ZhciByPXRoaXMsbz1hcmd1bWVudHMubGVuZ3RoPjMmJnZvaWQgMCE9PWFyZ3VtZW50c1szXT9hcmd1bWVudHNbM106MCxpPWFyZ3VtZW50cy5sZW5ndGg+NCYmdm9pZCAwIT09YXJndW1lbnRzWzRdP2FyZ3VtZW50c1s0XTozNTAsYT1hcmd1bWVudHMubGVuZ3RoPjU/YXJndW1lbnRzWzVdOnZvaWQgMDtyZXR1cm4gZS5sZW5ndGg/dGhpcy5iYWNrZW5kW25dKGUsdCwoZnVuY3Rpb24ocyxsKXtzJiZsJiZvPDU/c2V0VGltZW91dCgoZnVuY3Rpb24oKXtyLnJlYWQuY2FsbChyLGUsdCxuLG8rMSwyKmksYSk7fSksaSk6YShzLGwpO30pKTphKG51bGwse30pfX0se2tleToicHJlcGFyZUxvYWRpbmciLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dmFyIG49dGhpcyxyPWFyZ3VtZW50cy5sZW5ndGg+MiYmdm9pZCAwIT09YXJndW1lbnRzWzJdP2FyZ3VtZW50c1syXTp7fSxvPWFyZ3VtZW50cy5sZW5ndGg+Mz9hcmd1bWVudHNbM106dm9pZCAwO2lmKCF0aGlzLmJhY2tlbmQpcmV0dXJuIHRoaXMubG9nZ2VyLndhcm4oIk5vIGJhY2tlbmQgd2FzIGFkZGVkIHZpYSBpMThuZXh0LnVzZS4gV2lsbCBub3QgbG9hZCByZXNvdXJjZXMuIiksbyYmbygpOyJzdHJpbmciPT10eXBlb2YgZSYmKGU9dGhpcy5sYW5ndWFnZVV0aWxzLnRvUmVzb2x2ZUhpZXJhcmNoeShlKSksInN0cmluZyI9PXR5cGVvZiB0JiYodD1bdF0pO3ZhciBpPXRoaXMucXVldWVMb2FkKGUsdCxyLG8pO2lmKCFpLnRvTG9hZC5sZW5ndGgpcmV0dXJuIGkucGVuZGluZy5sZW5ndGh8fG8oKSxudWxsO2kudG9Mb2FkLmZvckVhY2goKGZ1bmN0aW9uKGUpe24ubG9hZE9uZShlKTt9KSk7fX0se2tleToibG9hZCIsdmFsdWU6ZnVuY3Rpb24oZSx0LG4pe3RoaXMucHJlcGFyZUxvYWRpbmcoZSx0LHt9LG4pO319LHtrZXk6InJlbG9hZCIsdmFsdWU6ZnVuY3Rpb24oZSx0LG4pe3RoaXMucHJlcGFyZUxvYWRpbmcoZSx0LHtyZWxvYWQ6ITB9LG4pO319LHtrZXk6ImxvYWRPbmUiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMsbj1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06IiIscj1lLnNwbGl0KCJ8Iiksbz1yWzBdLGk9clsxXTt0aGlzLnJlYWQobyxpLCJyZWFkIix2b2lkIDAsdm9pZCAwLChmdW5jdGlvbihyLGEpe3ImJnQubG9nZ2VyLndhcm4oIiIuY29uY2F0KG4sImxvYWRpbmcgbmFtZXNwYWNlICIpLmNvbmNhdChpLCIgZm9yIGxhbmd1YWdlICIpLmNvbmNhdChvLCIgZmFpbGVkIiksciksIXImJmEmJnQubG9nZ2VyLmxvZygiIi5jb25jYXQobiwibG9hZGVkIG5hbWVzcGFjZSAiKS5jb25jYXQoaSwiIGZvciBsYW5ndWFnZSAiKS5jb25jYXQobyksYSksdC5sb2FkZWQoZSxyLGEpO30pKTt9fSx7a2V5OiJzYXZlTWlzc2luZyIsdmFsdWU6ZnVuY3Rpb24oZSx0LG4scixvKXt2YXIgaT1hcmd1bWVudHMubGVuZ3RoPjUmJnZvaWQgMCE9PWFyZ3VtZW50c1s1XT9hcmd1bWVudHNbNV06e307dGhpcy5zZXJ2aWNlcy51dGlscyYmdGhpcy5zZXJ2aWNlcy51dGlscy5oYXNMb2FkZWROYW1lc3BhY2UmJiF0aGlzLnNlcnZpY2VzLnV0aWxzLmhhc0xvYWRlZE5hbWVzcGFjZSh0KT90aGlzLmxvZ2dlci53YXJuKCdkaWQgbm90IHNhdmUga2V5ICInLmNvbmNhdChuLCciIGFzIHRoZSBuYW1lc3BhY2UgIicpLmNvbmNhdCh0LCciIHdhcyBub3QgeWV0IGxvYWRlZCcpLCJUaGlzIG1lYW5zIHNvbWV0aGluZyBJUyBXUk9ORyBpbiB5b3VyIHNldHVwLiBZb3UgYWNjZXNzIHRoZSB0IGZ1bmN0aW9uIGJlZm9yZSBpMThuZXh0LmluaXQgLyBpMThuZXh0LmxvYWROYW1lc3BhY2UgLyBpMThuZXh0LmNoYW5nZUxhbmd1YWdlIHdhcyBkb25lLiBXYWl0IGZvciB0aGUgY2FsbGJhY2sgb3IgUHJvbWlzZSB0byByZXNvbHZlIGJlZm9yZSBhY2Nlc3NpbmcgaXQhISEiKTpudWxsIT1uJiYiIiE9PW4mJih0aGlzLmJhY2tlbmQmJnRoaXMuYmFja2VuZC5jcmVhdGUmJnRoaXMuYmFja2VuZC5jcmVhdGUoZSx0LG4scixudWxsLG9wLmRlZmF1bHQoe30saSx7aXNVcGRhdGU6b30pKSxlJiZlWzBdJiZ0aGlzLnN0b3JlLmFkZFJlc291cmNlKGVbMF0sdCxuLHIpKTt9fV0pLHR9KGhwKTtmdW5jdGlvbiAkcCgpe3JldHVybiB7ZGVidWc6ITEsaW5pdEltbWVkaWF0ZTohMCxuczpbInRyYW5zbGF0aW9uIl0sZGVmYXVsdE5TOlsidHJhbnNsYXRpb24iXSxmYWxsYmFja0xuZzpbImRldiJdLGZhbGxiYWNrTlM6ITEsd2hpdGVsaXN0OiExLG5vbkV4cGxpY2l0V2hpdGVsaXN0OiExLHN1cHBvcnRlZExuZ3M6ITEsbm9uRXhwbGljaXRTdXBwb3J0ZWRMbmdzOiExLGxvYWQ6ImFsbCIscHJlbG9hZDohMSxzaW1wbGlmeVBsdXJhbFN1ZmZpeDohMCxrZXlTZXBhcmF0b3I6Ii4iLG5zU2VwYXJhdG9yOiI6IixwbHVyYWxTZXBhcmF0b3I6Il8iLGNvbnRleHRTZXBhcmF0b3I6Il8iLHBhcnRpYWxCdW5kbGVkTGFuZ3VhZ2VzOiExLHNhdmVNaXNzaW5nOiExLHVwZGF0ZU1pc3Npbmc6ITEsc2F2ZU1pc3NpbmdUbzoiZmFsbGJhY2siLHNhdmVNaXNzaW5nUGx1cmFsczohMCxtaXNzaW5nS2V5SGFuZGxlcjohMSxtaXNzaW5nSW50ZXJwb2xhdGlvbkhhbmRsZXI6ITEscG9zdFByb2Nlc3M6ITEscG9zdFByb2Nlc3NQYXNzUmVzb2x2ZWQ6ITEscmV0dXJuTnVsbDohMCxyZXR1cm5FbXB0eVN0cmluZzohMCxyZXR1cm5PYmplY3RzOiExLGpvaW5BcnJheXM6ITEscmV0dXJuZWRPYmplY3RIYW5kbGVyOiExLHBhcnNlTWlzc2luZ0tleUhhbmRsZXI6ITEsYXBwZW5kTmFtZXNwYWNlVG9NaXNzaW5nS2V5OiExLGFwcGVuZE5hbWVzcGFjZVRvQ0lNb2RlOiExLG92ZXJsb2FkVHJhbnNsYXRpb25PcHRpb25IYW5kbGVyOmZ1bmN0aW9uKGUpe3ZhciB0PXt9O2lmKCJvYmplY3QiPT09cnAuZGVmYXVsdChlWzFdKSYmKHQ9ZVsxXSksInN0cmluZyI9PXR5cGVvZiBlWzFdJiYodC5kZWZhdWx0VmFsdWU9ZVsxXSksInN0cmluZyI9PXR5cGVvZiBlWzJdJiYodC50RGVzY3JpcHRpb249ZVsyXSksIm9iamVjdCI9PT1ycC5kZWZhdWx0KGVbMl0pfHwib2JqZWN0Ij09PXJwLmRlZmF1bHQoZVszXSkpe3ZhciBuPWVbM118fGVbMl07T2JqZWN0LmtleXMobikuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dFtlXT1uW2VdO30pKTt9cmV0dXJuIHR9LGludGVycG9sYXRpb246e2VzY2FwZVZhbHVlOiEwLGZvcm1hdDpmdW5jdGlvbihlLHQsbixyKXtyZXR1cm4gZX0scHJlZml4OiJ7eyIsc3VmZml4OiJ9fSIsZm9ybWF0U2VwYXJhdG9yOiIsIix1bmVzY2FwZVByZWZpeDoiLSIsbmVzdGluZ1ByZWZpeDoiJHQoIixuZXN0aW5nU3VmZml4OiIpIixuZXN0aW5nT3B0aW9uc1NlcGFyYXRvcjoiLCIsbWF4UmVwbGFjZXM6MWUzLHNraXBPblZhcmlhYmxlczohMX19fWZ1bmN0aW9uIFdwKGUpe3JldHVybiAic3RyaW5nIj09dHlwZW9mIGUubnMmJihlLm5zPVtlLm5zXSksInN0cmluZyI9PXR5cGVvZiBlLmZhbGxiYWNrTG5nJiYoZS5mYWxsYmFja0xuZz1bZS5mYWxsYmFja0xuZ10pLCJzdHJpbmciPT10eXBlb2YgZS5mYWxsYmFja05TJiYoZS5mYWxsYmFja05TPVtlLmZhbGxiYWNrTlNdKSxlLndoaXRlbGlzdCYmKGUud2hpdGVsaXN0JiZlLndoaXRlbGlzdC5pbmRleE9mKCJjaW1vZGUiKTwwJiYoZS53aGl0ZWxpc3Q9ZS53aGl0ZWxpc3QuY29uY2F0KFsiY2ltb2RlIl0pKSxlLnN1cHBvcnRlZExuZ3M9ZS53aGl0ZWxpc3QpLGUubm9uRXhwbGljaXRXaGl0ZWxpc3QmJihlLm5vbkV4cGxpY2l0U3VwcG9ydGVkTG5ncz1lLm5vbkV4cGxpY2l0V2hpdGVsaXN0KSxlLnN1cHBvcnRlZExuZ3MmJmUuc3VwcG9ydGVkTG5ncy5pbmRleE9mKCJjaW1vZGUiKTwwJiYoZS5zdXBwb3J0ZWRMbmdzPWUuc3VwcG9ydGVkTG5ncy5jb25jYXQoWyJjaW1vZGUiXSkpLGV9ZnVuY3Rpb24gSHAoKXt9dmFyIFZwPWZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHQoKXt2YXIgZSxuPWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTp7fSxyPWFyZ3VtZW50cy5sZW5ndGg+MT9hcmd1bWVudHNbMV06dm9pZCAwO2lmKGlwLmRlZmF1bHQodGhpcyx0KSxlPXNwLmRlZmF1bHQodGhpcyxscC5kZWZhdWx0KHQpLmNhbGwodGhpcykpLENwJiZocC5jYWxsKHVwLmRlZmF1bHQoZSkpLGUub3B0aW9ucz1XcChuKSxlLnNlcnZpY2VzPXt9LGUubG9nZ2VyPXBwLGUubW9kdWxlcz17ZXh0ZXJuYWw6W119LHImJiFlLmlzSW5pdGlhbGl6ZWQmJiFuLmlzQ2xvbmUpe2lmKCFlLm9wdGlvbnMuaW5pdEltbWVkaWF0ZSlyZXR1cm4gZS5pbml0KG4sciksc3AuZGVmYXVsdChlLHVwLmRlZmF1bHQoZSkpO3NldFRpbWVvdXQoKGZ1bmN0aW9uKCl7ZS5pbml0KG4scik7fSksMCk7fXJldHVybiBlfXJldHVybiBjcC5kZWZhdWx0KHQsZSksYXAuZGVmYXVsdCh0LFt7a2V5OiJpbml0Iix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPXRoaXMsdD1hcmd1bWVudHMubGVuZ3RoPjAmJnZvaWQgMCE9PWFyZ3VtZW50c1swXT9hcmd1bWVudHNbMF06e30sbj1hcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMDtmdW5jdGlvbiByKGUpe3JldHVybiBlPyJmdW5jdGlvbiI9PXR5cGVvZiBlP25ldyBlOmU6bnVsbH1pZigiZnVuY3Rpb24iPT10eXBlb2YgdCYmKG49dCx0PXt9KSx0LndoaXRlbGlzdCYmIXQuc3VwcG9ydGVkTG5ncyYmdGhpcy5sb2dnZXIuZGVwcmVjYXRlKCJ3aGl0ZWxpc3QiLCdvcHRpb24gIndoaXRlbGlzdCIgd2lsbCBiZSByZW5hbWVkIHRvICJzdXBwb3J0ZWRMbmdzIiBpbiB0aGUgbmV4dCBtYWpvciAtIHBsZWFzZSBtYWtlIHN1cmUgdG8gcmVuYW1lIHRoaXMgb3B0aW9uIGFzYXAuJyksdC5ub25FeHBsaWNpdFdoaXRlbGlzdCYmIXQubm9uRXhwbGljaXRTdXBwb3J0ZWRMbmdzJiZ0aGlzLmxvZ2dlci5kZXByZWNhdGUoIndoaXRlbGlzdCIsJ29wdGlvbnMgIm5vbkV4cGxpY2l0V2hpdGVsaXN0IiB3aWxsIGJlIHJlbmFtZWQgdG8gIm5vbkV4cGxpY2l0U3VwcG9ydGVkTG5ncyIgaW4gdGhlIG5leHQgbWFqb3IgLSBwbGVhc2UgbWFrZSBzdXJlIHRvIHJlbmFtZSB0aGlzIG9wdGlvbiBhc2FwLicpLHRoaXMub3B0aW9ucz1vcC5kZWZhdWx0KHt9LCRwKCksdGhpcy5vcHRpb25zLFdwKHQpKSx0aGlzLmZvcm1hdD10aGlzLm9wdGlvbnMuaW50ZXJwb2xhdGlvbi5mb3JtYXQsbnx8KG49SHApLCF0aGlzLm9wdGlvbnMuaXNDbG9uZSl7dGhpcy5tb2R1bGVzLmxvZ2dlcj9wcC5pbml0KHIodGhpcy5tb2R1bGVzLmxvZ2dlciksdGhpcy5vcHRpb25zKTpwcC5pbml0KG51bGwsdGhpcy5vcHRpb25zKTt2YXIgbz1uZXcgRHAodGhpcy5vcHRpb25zKTt0aGlzLnN0b3JlPW5ldyBOcCh0aGlzLm9wdGlvbnMucmVzb3VyY2VzLHRoaXMub3B0aW9ucyk7dmFyIGk9dGhpcy5zZXJ2aWNlcztpLmxvZ2dlcj1wcCxpLnJlc291cmNlU3RvcmU9dGhpcy5zdG9yZSxpLmxhbmd1YWdlVXRpbHM9byxpLnBsdXJhbFJlc29sdmVyPW5ldyBGcChvLHtwcmVwZW5kOnRoaXMub3B0aW9ucy5wbHVyYWxTZXBhcmF0b3IsY29tcGF0aWJpbGl0eUpTT046dGhpcy5vcHRpb25zLmNvbXBhdGliaWxpdHlKU09OLHNpbXBsaWZ5UGx1cmFsU3VmZml4OnRoaXMub3B0aW9ucy5zaW1wbGlmeVBsdXJhbFN1ZmZpeH0pLGkuaW50ZXJwb2xhdG9yPW5ldyBJcCh0aGlzLm9wdGlvbnMpLGkudXRpbHM9e2hhc0xvYWRlZE5hbWVzcGFjZTp0aGlzLmhhc0xvYWRlZE5hbWVzcGFjZS5iaW5kKHRoaXMpfSxpLmJhY2tlbmRDb25uZWN0b3I9bmV3IEJwKHIodGhpcy5tb2R1bGVzLmJhY2tlbmQpLGkucmVzb3VyY2VTdG9yZSxpLHRoaXMub3B0aW9ucyksaS5iYWNrZW5kQ29ubmVjdG9yLm9uKCIqIiwoZnVuY3Rpb24odCl7Zm9yKHZhciBuPWFyZ3VtZW50cy5sZW5ndGgscj1uZXcgQXJyYXkobj4xP24tMTowKSxvPTE7bzxuO28rKylyW28tMV09YXJndW1lbnRzW29dO2UuZW1pdC5hcHBseShlLFt0XS5jb25jYXQocikpO30pKSx0aGlzLm1vZHVsZXMubGFuZ3VhZ2VEZXRlY3RvciYmKGkubGFuZ3VhZ2VEZXRlY3Rvcj1yKHRoaXMubW9kdWxlcy5sYW5ndWFnZURldGVjdG9yKSxpLmxhbmd1YWdlRGV0ZWN0b3IuaW5pdChpLHRoaXMub3B0aW9ucy5kZXRlY3Rpb24sdGhpcy5vcHRpb25zKSksdGhpcy5tb2R1bGVzLmkxOG5Gb3JtYXQmJihpLmkxOG5Gb3JtYXQ9cih0aGlzLm1vZHVsZXMuaTE4bkZvcm1hdCksaS5pMThuRm9ybWF0LmluaXQmJmkuaTE4bkZvcm1hdC5pbml0KHRoaXMpKSx0aGlzLnRyYW5zbGF0b3I9bmV3IFBwKHRoaXMuc2VydmljZXMsdGhpcy5vcHRpb25zKSx0aGlzLnRyYW5zbGF0b3Iub24oIioiLChmdW5jdGlvbih0KXtmb3IodmFyIG49YXJndW1lbnRzLmxlbmd0aCxyPW5ldyBBcnJheShuPjE/bi0xOjApLG89MTtvPG47bysrKXJbby0xXT1hcmd1bWVudHNbb107ZS5lbWl0LmFwcGx5KGUsW3RdLmNvbmNhdChyKSk7fSkpLHRoaXMubW9kdWxlcy5leHRlcm5hbC5mb3JFYWNoKChmdW5jdGlvbih0KXt0LmluaXQmJnQuaW5pdChlKTt9KSk7fWlmKHRoaXMub3B0aW9ucy5mYWxsYmFja0xuZyYmIXRoaXMuc2VydmljZXMubGFuZ3VhZ2VEZXRlY3RvciYmIXRoaXMub3B0aW9ucy5sbmcpe3ZhciBhPXRoaXMuc2VydmljZXMubGFuZ3VhZ2VVdGlscy5nZXRGYWxsYmFja0NvZGVzKHRoaXMub3B0aW9ucy5mYWxsYmFja0xuZyk7YS5sZW5ndGg+MCYmImRldiIhPT1hWzBdJiYodGhpcy5vcHRpb25zLmxuZz1hWzBdKTt9dGhpcy5zZXJ2aWNlcy5sYW5ndWFnZURldGVjdG9yfHx0aGlzLm9wdGlvbnMubG5nfHx0aGlzLmxvZ2dlci53YXJuKCJpbml0OiBubyBsYW5ndWFnZURldGVjdG9yIGlzIHVzZWQgYW5kIG5vIGxuZyBpcyBkZWZpbmVkIik7dmFyIHM9WyJnZXRSZXNvdXJjZSIsImhhc1Jlc291cmNlQnVuZGxlIiwiZ2V0UmVzb3VyY2VCdW5kbGUiLCJnZXREYXRhQnlMYW5ndWFnZSJdO3MuZm9yRWFjaCgoZnVuY3Rpb24odCl7ZVt0XT1mdW5jdGlvbigpe3ZhciBuO3JldHVybiAobj1lLnN0b3JlKVt0XS5hcHBseShuLGFyZ3VtZW50cyl9O30pKTt2YXIgbD1bImFkZFJlc291cmNlIiwiYWRkUmVzb3VyY2VzIiwiYWRkUmVzb3VyY2VCdW5kbGUiLCJyZW1vdmVSZXNvdXJjZUJ1bmRsZSJdO2wuZm9yRWFjaCgoZnVuY3Rpb24odCl7ZVt0XT1mdW5jdGlvbigpe3ZhciBuO3JldHVybiAobj1lLnN0b3JlKVt0XS5hcHBseShuLGFyZ3VtZW50cyksZX07fSkpO3ZhciB1PWdwKCksYz1mdW5jdGlvbigpe3ZhciB0PWZ1bmN0aW9uKHQscil7ZS5pc0luaXRpYWxpemVkJiYhZS5pbml0aWFsaXplZFN0b3JlT25jZSYmZS5sb2dnZXIud2FybigiaW5pdDogaTE4bmV4dCBpcyBhbHJlYWR5IGluaXRpYWxpemVkLiBZb3Ugc2hvdWxkIGNhbGwgaW5pdCBqdXN0IG9uY2UhIiksZS5pc0luaXRpYWxpemVkPSEwLGUub3B0aW9ucy5pc0Nsb25lfHxlLmxvZ2dlci5sb2coImluaXRpYWxpemVkIixlLm9wdGlvbnMpLGUuZW1pdCgiaW5pdGlhbGl6ZWQiLGUub3B0aW9ucyksdS5yZXNvbHZlKHIpLG4odCxyKTt9O2lmKGUubGFuZ3VhZ2VzJiYidjEiIT09ZS5vcHRpb25zLmNvbXBhdGliaWxpdHlBUEkmJiFlLmlzSW5pdGlhbGl6ZWQpcmV0dXJuIHQobnVsbCxlLnQuYmluZChlKSk7ZS5jaGFuZ2VMYW5ndWFnZShlLm9wdGlvbnMubG5nLHQpO307cmV0dXJuIHRoaXMub3B0aW9ucy5yZXNvdXJjZXN8fCF0aGlzLm9wdGlvbnMuaW5pdEltbWVkaWF0ZT9jKCk6c2V0VGltZW91dChjLDApLHV9fSx7a2V5OiJsb2FkUmVzb3VyY2VzIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD10aGlzLG49YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOkhwLHI9bixvPSJzdHJpbmciPT10eXBlb2YgZT9lOnRoaXMubGFuZ3VhZ2U7aWYoImZ1bmN0aW9uIj09dHlwZW9mIGUmJihyPWUpLCF0aGlzLm9wdGlvbnMucmVzb3VyY2VzfHx0aGlzLm9wdGlvbnMucGFydGlhbEJ1bmRsZWRMYW5ndWFnZXMpe2lmKG8mJiJjaW1vZGUiPT09by50b0xvd2VyQ2FzZSgpKXJldHVybiByKCk7dmFyIGk9W10sYT1mdW5jdGlvbihlKXtlJiZ0LnNlcnZpY2VzLmxhbmd1YWdlVXRpbHMudG9SZXNvbHZlSGllcmFyY2h5KGUpLmZvckVhY2goKGZ1bmN0aW9uKGUpe2kuaW5kZXhPZihlKTwwJiZpLnB1c2goZSk7fSkpO307aWYobylhKG8pO2Vsc2Uge3ZhciBzPXRoaXMuc2VydmljZXMubGFuZ3VhZ2VVdGlscy5nZXRGYWxsYmFja0NvZGVzKHRoaXMub3B0aW9ucy5mYWxsYmFja0xuZyk7cy5mb3JFYWNoKChmdW5jdGlvbihlKXtyZXR1cm4gYShlKX0pKTt9dGhpcy5vcHRpb25zLnByZWxvYWQmJnRoaXMub3B0aW9ucy5wcmVsb2FkLmZvckVhY2goKGZ1bmN0aW9uKGUpe3JldHVybiBhKGUpfSkpLHRoaXMuc2VydmljZXMuYmFja2VuZENvbm5lY3Rvci5sb2FkKGksdGhpcy5vcHRpb25zLm5zLHIpO31lbHNlIHIobnVsbCk7fX0se2tleToicmVsb2FkUmVzb3VyY2VzIix2YWx1ZTpmdW5jdGlvbihlLHQsbil7dmFyIHI9Z3AoKTtyZXR1cm4gZXx8KGU9dGhpcy5sYW5ndWFnZXMpLHR8fCh0PXRoaXMub3B0aW9ucy5ucyksbnx8KG49SHApLHRoaXMuc2VydmljZXMuYmFja2VuZENvbm5lY3Rvci5yZWxvYWQoZSx0LChmdW5jdGlvbihlKXtyLnJlc29sdmUoKSxuKGUpO30pKSxyfX0se2tleToidXNlIix2YWx1ZTpmdW5jdGlvbihlKXtpZighZSl0aHJvdyBuZXcgRXJyb3IoIllvdSBhcmUgcGFzc2luZyBhbiB1bmRlZmluZWQgbW9kdWxlISBQbGVhc2UgY2hlY2sgdGhlIG9iamVjdCB5b3UgYXJlIHBhc3NpbmcgdG8gaTE4bmV4dC51c2UoKSIpO2lmKCFlLnR5cGUpdGhyb3cgbmV3IEVycm9yKCJZb3UgYXJlIHBhc3NpbmcgYSB3cm9uZyBtb2R1bGUhIFBsZWFzZSBjaGVjayB0aGUgb2JqZWN0IHlvdSBhcmUgcGFzc2luZyB0byBpMThuZXh0LnVzZSgpIik7cmV0dXJuICJiYWNrZW5kIj09PWUudHlwZSYmKHRoaXMubW9kdWxlcy5iYWNrZW5kPWUpLCgibG9nZ2VyIj09PWUudHlwZXx8ZS5sb2cmJmUud2FybiYmZS5lcnJvcikmJih0aGlzLm1vZHVsZXMubG9nZ2VyPWUpLCJsYW5ndWFnZURldGVjdG9yIj09PWUudHlwZSYmKHRoaXMubW9kdWxlcy5sYW5ndWFnZURldGVjdG9yPWUpLCJpMThuRm9ybWF0Ij09PWUudHlwZSYmKHRoaXMubW9kdWxlcy5pMThuRm9ybWF0PWUpLCJwb3N0UHJvY2Vzc29yIj09PWUudHlwZSYmTXAuYWRkUG9zdFByb2Nlc3NvcihlKSwiM3JkUGFydHkiPT09ZS50eXBlJiZ0aGlzLm1vZHVsZXMuZXh0ZXJuYWwucHVzaChlKSx0aGlzfX0se2tleToiY2hhbmdlTGFuZ3VhZ2UiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dmFyIG49dGhpczt0aGlzLmlzTGFuZ3VhZ2VDaGFuZ2luZ1RvPWU7dmFyIHI9Z3AoKTt0aGlzLmVtaXQoImxhbmd1YWdlQ2hhbmdpbmciLGUpO3ZhciBvPWZ1bmN0aW9uKG8pe2V8fG98fCFuLnNlcnZpY2VzLmxhbmd1YWdlRGV0ZWN0b3J8fChvPVtdKTt2YXIgaT0ic3RyaW5nIj09dHlwZW9mIG8/bzpuLnNlcnZpY2VzLmxhbmd1YWdlVXRpbHMuZ2V0QmVzdE1hdGNoRnJvbUNvZGVzKG8pO2kmJihuLmxhbmd1YWdlfHwobi5sYW5ndWFnZT1pLG4ubGFuZ3VhZ2VzPW4uc2VydmljZXMubGFuZ3VhZ2VVdGlscy50b1Jlc29sdmVIaWVyYXJjaHkoaSkpLG4udHJhbnNsYXRvci5sYW5ndWFnZXx8bi50cmFuc2xhdG9yLmNoYW5nZUxhbmd1YWdlKGkpLG4uc2VydmljZXMubGFuZ3VhZ2VEZXRlY3RvciYmbi5zZXJ2aWNlcy5sYW5ndWFnZURldGVjdG9yLmNhY2hlVXNlckxhbmd1YWdlKGkpKSxuLmxvYWRSZXNvdXJjZXMoaSwoZnVuY3Rpb24oZSl7IWZ1bmN0aW9uKGUsbyl7bz8obi5sYW5ndWFnZT1vLG4ubGFuZ3VhZ2VzPW4uc2VydmljZXMubGFuZ3VhZ2VVdGlscy50b1Jlc29sdmVIaWVyYXJjaHkobyksbi50cmFuc2xhdG9yLmNoYW5nZUxhbmd1YWdlKG8pLG4uaXNMYW5ndWFnZUNoYW5naW5nVG89dm9pZCAwLG4uZW1pdCgibGFuZ3VhZ2VDaGFuZ2VkIixvKSxuLmxvZ2dlci5sb2coImxhbmd1YWdlQ2hhbmdlZCIsbykpOm4uaXNMYW5ndWFnZUNoYW5naW5nVG89dm9pZCAwLHIucmVzb2x2ZSgoZnVuY3Rpb24oKXtyZXR1cm4gbi50LmFwcGx5KG4sYXJndW1lbnRzKX0pKSx0JiZ0KGUsKGZ1bmN0aW9uKCl7cmV0dXJuIG4udC5hcHBseShuLGFyZ3VtZW50cyl9KSk7fShlLGkpO30pKTt9O3JldHVybiBlfHwhdGhpcy5zZXJ2aWNlcy5sYW5ndWFnZURldGVjdG9yfHx0aGlzLnNlcnZpY2VzLmxhbmd1YWdlRGV0ZWN0b3IuYXN5bmM/IWUmJnRoaXMuc2VydmljZXMubGFuZ3VhZ2VEZXRlY3RvciYmdGhpcy5zZXJ2aWNlcy5sYW5ndWFnZURldGVjdG9yLmFzeW5jP3RoaXMuc2VydmljZXMubGFuZ3VhZ2VEZXRlY3Rvci5kZXRlY3Qobyk6byhlKTpvKHRoaXMuc2VydmljZXMubGFuZ3VhZ2VEZXRlY3Rvci5kZXRlY3QoKSkscn19LHtrZXk6ImdldEZpeGVkVCIsdmFsdWU6ZnVuY3Rpb24oZSx0LG4pe3ZhciByPXRoaXMsbz1mdW5jdGlvbiBlKHQsbyl7dmFyIGk7aWYoIm9iamVjdCIhPT1ycC5kZWZhdWx0KG8pKXtmb3IodmFyIGE9YXJndW1lbnRzLmxlbmd0aCxzPW5ldyBBcnJheShhPjI/YS0yOjApLGw9MjtsPGE7bCsrKXNbbC0yXT1hcmd1bWVudHNbbF07aT1yLm9wdGlvbnMub3ZlcmxvYWRUcmFuc2xhdGlvbk9wdGlvbkhhbmRsZXIoW3Qsb10uY29uY2F0KHMpKTt9ZWxzZSBpPW9wLmRlZmF1bHQoe30sbyk7aS5sbmc9aS5sbmd8fGUubG5nLGkubG5ncz1pLmxuZ3N8fGUubG5ncyxpLm5zPWkubnN8fGUubnM7dmFyIHU9ci5vcHRpb25zLmtleVNlcGFyYXRvcnx8Ii4iLGM9bj8iIi5jb25jYXQobikuY29uY2F0KHUpLmNvbmNhdCh0KTp0O3JldHVybiByLnQoYyxpKX07cmV0dXJuICJzdHJpbmciPT10eXBlb2YgZT9vLmxuZz1lOm8ubG5ncz1lLG8ubnM9dCxvLmtleVByZWZpeD1uLG99fSx7a2V5OiJ0Iix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlO3JldHVybiB0aGlzLnRyYW5zbGF0b3ImJihlPXRoaXMudHJhbnNsYXRvcikudHJhbnNsYXRlLmFwcGx5KGUsYXJndW1lbnRzKX19LHtrZXk6ImV4aXN0cyIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZTtyZXR1cm4gdGhpcy50cmFuc2xhdG9yJiYoZT10aGlzLnRyYW5zbGF0b3IpLmV4aXN0cy5hcHBseShlLGFyZ3VtZW50cyl9fSx7a2V5OiJzZXREZWZhdWx0TmFtZXNwYWNlIix2YWx1ZTpmdW5jdGlvbihlKXt0aGlzLm9wdGlvbnMuZGVmYXVsdE5TPWU7fX0se2tleToiaGFzTG9hZGVkTmFtZXNwYWNlIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD10aGlzLG49YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOnt9O2lmKCF0aGlzLmlzSW5pdGlhbGl6ZWQpcmV0dXJuIHRoaXMubG9nZ2VyLndhcm4oImhhc0xvYWRlZE5hbWVzcGFjZTogaTE4bmV4dCB3YXMgbm90IGluaXRpYWxpemVkIix0aGlzLmxhbmd1YWdlcyksITE7aWYoIXRoaXMubGFuZ3VhZ2VzfHwhdGhpcy5sYW5ndWFnZXMubGVuZ3RoKXJldHVybiB0aGlzLmxvZ2dlci53YXJuKCJoYXNMb2FkZWROYW1lc3BhY2U6IGkxOG4ubGFuZ3VhZ2VzIHdlcmUgdW5kZWZpbmVkIG9yIGVtcHR5Iix0aGlzLmxhbmd1YWdlcyksITE7dmFyIHI9dGhpcy5sYW5ndWFnZXNbMF0sbz0hIXRoaXMub3B0aW9ucyYmdGhpcy5vcHRpb25zLmZhbGxiYWNrTG5nLGk9dGhpcy5sYW5ndWFnZXNbdGhpcy5sYW5ndWFnZXMubGVuZ3RoLTFdO2lmKCJjaW1vZGUiPT09ci50b0xvd2VyQ2FzZSgpKXJldHVybiAhMDt2YXIgYT1mdW5jdGlvbihlLG4pe3ZhciByPXQuc2VydmljZXMuYmFja2VuZENvbm5lY3Rvci5zdGF0ZVsiIi5jb25jYXQoZSwifCIpLmNvbmNhdChuKV07cmV0dXJuIC0xPT09cnx8Mj09PXJ9O2lmKG4ucHJlY2hlY2spe3ZhciBzPW4ucHJlY2hlY2sodGhpcyxhKTtpZih2b2lkIDAhPT1zKXJldHVybiBzfXJldHVybiAhIXRoaXMuaGFzUmVzb3VyY2VCdW5kbGUocixlKXx8KCF0aGlzLnNlcnZpY2VzLmJhY2tlbmRDb25uZWN0b3IuYmFja2VuZHx8ISghYShyLGUpfHxvJiYhYShpLGUpKSl9fSx7a2V5OiJsb2FkTmFtZXNwYWNlcyIsdmFsdWU6ZnVuY3Rpb24oZSx0KXt2YXIgbj10aGlzLHI9Z3AoKTtyZXR1cm4gdGhpcy5vcHRpb25zLm5zPygic3RyaW5nIj09dHlwZW9mIGUmJihlPVtlXSksZS5mb3JFYWNoKChmdW5jdGlvbihlKXtuLm9wdGlvbnMubnMuaW5kZXhPZihlKTwwJiZuLm9wdGlvbnMubnMucHVzaChlKTt9KSksdGhpcy5sb2FkUmVzb3VyY2VzKChmdW5jdGlvbihlKXtyLnJlc29sdmUoKSx0JiZ0KGUpO30pKSxyKToodCYmdCgpLFByb21pc2UucmVzb2x2ZSgpKX19LHtrZXk6ImxvYWRMYW5ndWFnZXMiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dmFyIG49Z3AoKTsic3RyaW5nIj09dHlwZW9mIGUmJihlPVtlXSk7dmFyIHI9dGhpcy5vcHRpb25zLnByZWxvYWR8fFtdLG89ZS5maWx0ZXIoKGZ1bmN0aW9uKGUpe3JldHVybiByLmluZGV4T2YoZSk8MH0pKTtyZXR1cm4gby5sZW5ndGg/KHRoaXMub3B0aW9ucy5wcmVsb2FkPXIuY29uY2F0KG8pLHRoaXMubG9hZFJlc291cmNlcygoZnVuY3Rpb24oZSl7bi5yZXNvbHZlKCksdCYmdChlKTt9KSksbik6KHQmJnQoKSxQcm9taXNlLnJlc29sdmUoKSl9fSx7a2V5OiJkaXIiLHZhbHVlOmZ1bmN0aW9uKGUpe2lmKGV8fChlPXRoaXMubGFuZ3VhZ2VzJiZ0aGlzLmxhbmd1YWdlcy5sZW5ndGg+MD90aGlzLmxhbmd1YWdlc1swXTp0aGlzLmxhbmd1YWdlKSwhZSlyZXR1cm4gInJ0bCI7cmV0dXJuIFsiYXIiLCJzaHUiLCJzcXIiLCJzc2giLCJ4YWEiLCJ5aGQiLCJ5dWQiLCJhYW8iLCJhYmgiLCJhYnYiLCJhY20iLCJhY3EiLCJhY3ciLCJhY3giLCJhY3kiLCJhZGYiLCJhZHMiLCJhZWIiLCJhZWMiLCJhZmIiLCJhanAiLCJhcGMiLCJhcGQiLCJhcmIiLCJhcnEiLCJhcnMiLCJhcnkiLCJhcnoiLCJhdXoiLCJhdmwiLCJheWgiLCJheWwiLCJheW4iLCJheXAiLCJiYnoiLCJwZ2EiLCJoZSIsIml3IiwicHMiLCJwYnQiLCJwYnUiLCJwc3QiLCJwcnAiLCJwcmQiLCJ1ZyIsInVyIiwieWRkIiwieWRzIiwieWloIiwiamkiLCJ5aSIsImhibyIsIm1lbiIsInhtbiIsImZhIiwianByIiwicGVvIiwicGVzIiwicHJzIiwiZHYiLCJzYW0iXS5pbmRleE9mKHRoaXMuc2VydmljZXMubGFuZ3VhZ2VVdGlscy5nZXRMYW5ndWFnZVBhcnRGcm9tQ29kZShlKSk+PTA/InJ0bCI6Imx0ciJ9fSx7a2V5OiJjcmVhdGVJbnN0YW5jZSIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT1hcmd1bWVudHMubGVuZ3RoPjAmJnZvaWQgMCE9PWFyZ3VtZW50c1swXT9hcmd1bWVudHNbMF06e30sbj1hcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMDtyZXR1cm4gbmV3IHQoZSxuKX19LHtrZXk6ImNsb25lSW5zdGFuY2UiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcyxuPWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTp7fSxyPWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTpIcCxvPW9wLmRlZmF1bHQoe30sdGhpcy5vcHRpb25zLG4se2lzQ2xvbmU6ITB9KSxpPW5ldyB0KG8pLGE9WyJzdG9yZSIsInNlcnZpY2VzIiwibGFuZ3VhZ2UiXTtyZXR1cm4gYS5mb3JFYWNoKChmdW5jdGlvbih0KXtpW3RdPWVbdF07fSkpLGkuc2VydmljZXM9b3AuZGVmYXVsdCh7fSx0aGlzLnNlcnZpY2VzKSxpLnNlcnZpY2VzLnV0aWxzPXtoYXNMb2FkZWROYW1lc3BhY2U6aS5oYXNMb2FkZWROYW1lc3BhY2UuYmluZChpKX0saS50cmFuc2xhdG9yPW5ldyBQcChpLnNlcnZpY2VzLGkub3B0aW9ucyksaS50cmFuc2xhdG9yLm9uKCIqIiwoZnVuY3Rpb24oZSl7Zm9yKHZhciB0PWFyZ3VtZW50cy5sZW5ndGgsbj1uZXcgQXJyYXkodD4xP3QtMTowKSxyPTE7cjx0O3IrKyluW3ItMV09YXJndW1lbnRzW3JdO2kuZW1pdC5hcHBseShpLFtlXS5jb25jYXQobikpO30pKSxpLmluaXQobyxyKSxpLnRyYW5zbGF0b3Iub3B0aW9ucz1pLm9wdGlvbnMsaS50cmFuc2xhdG9yLmJhY2tlbmRDb25uZWN0b3Iuc2VydmljZXMudXRpbHM9e2hhc0xvYWRlZE5hbWVzcGFjZTppLmhhc0xvYWRlZE5hbWVzcGFjZS5iaW5kKGkpfSxpfX0se2tleToidG9KU09OIix2YWx1ZTpmdW5jdGlvbigpe3JldHVybiB7b3B0aW9uczp0aGlzLm9wdGlvbnMsc3RvcmU6dGhpcy5zdG9yZSxsYW5ndWFnZTp0aGlzLmxhbmd1YWdlLGxhbmd1YWdlczp0aGlzLmxhbmd1YWdlc319fV0pLHR9KGhwKSx6cD1uZXcgVnAsVXA9InRyYW5zbGF0aW9uIjt6cC5pbml0KHtsbmc6InpoLUNOIixyZXNvdXJjZXM6e319KTt2YXIgS3A9enAudC5iaW5kKHpwKTtlLkRvbUVkaXRvcj1IcyxlLkVMRU1fVE9fSFRNTF9DT05GPW9sLGUuUEFSU0VfRUxFTV9IVE1MX0NPTkY9WnUsZS5QQVJTRV9TVFlMRV9IVE1MX0ZOX0xJU1Q9UXUsZS5QUkVfUEFSU0VfSFRNTF9DT05GX0xJU1Q9WHUsZS5SRU5ERVJfRUxFTV9DT05GPUZmLGUuUkVOREVSX1NUWUxFX0hBTkRMRVJfTElTVD1fZixlLlNUWUxFX1RPX0hUTUxfRk5fTElTVD1ybCxlLlRFWFRfVEFHUz1ZdSxlLlRvb2xiYXI9QmQsZS5jb3JlQ3JlYXRlRWRpdG9yPWZ1bmN0aW9uKGUpe3ZhciBuPWUuc2VsZWN0b3Iscj12b2lkIDA9PT1uPyIiOm4sbz1lLmNvbmZpZyxpPXZvaWQgMD09PW8/e306byxhPWUuY29udGVudCxzPWUuaHRtbCxsPWUucGx1Z2lucyx1PXZvaWQgMD09PWw/W106bCxjPVFuKGZ1bmN0aW9uKGUpe3ZhciBuPWUscj1uLmluc2VydFRleHQsbz1uLmluc2VydE5vZGUsaT1uLmluc2VydEZyYWdtZW50LGE9bi5kYW5nZXJvdXNseUluc2VydEh0bWw7cmV0dXJuIG4uaW5zZXJ0VGV4dD1mdW5jdGlvbihlKXtpZihuLmdldENvbmZpZygpLm1heExlbmd0aCl7dmFyIHQ9SHMuZ2V0TGVmdExlbmd0aE9mTWF4TGVuZ3RoKG4pO3Q8PTB8fCh0PGUubGVuZ3RoP3IoZS5zbGljZSgwLHQpKTpyKGUpKTt9ZWxzZSByKGUpO30sbi5pbnNlcnROb2RlPWZ1bmN0aW9uKGUpe2lmKG4uZ2V0Q29uZmlnKCkubWF4TGVuZ3RoKXt2YXIgcj1Icy5nZXRMZWZ0TGVuZ3RoT2ZNYXhMZW5ndGgobik7cjw9MHx8cjx0Lk5vZGUuc3RyaW5nKGUpLmxlbmd0aHx8byhlKTt9ZWxzZSBvKGUpO30sbi5pbnNlcnRGcmFnbWVudD1mdW5jdGlvbihlKXtpZihuLmdldENvbmZpZygpLm1heExlbmd0aClpZigxIT09ZS5sZW5ndGgpZS5mb3JFYWNoKChmdW5jdGlvbihlKXtuLmluc2VydE5vZGUoZSk7fSkpO2Vsc2Uge3ZhciByPWVbMF07aWYoSHMuZ2V0TGVmdExlbmd0aE9mTWF4TGVuZ3RoKG4pPHQuTm9kZS5zdHJpbmcocikubGVuZ3RoKXJldHVybjtpKGUpO31lbHNlIGkoZSk7fSxuLmRhbmdlcm91c2x5SW5zZXJ0SHRtbD1mdW5jdGlvbihlLHQpe2lmKHZvaWQgMD09PWUmJihlPSIiKSx2b2lkIDA9PT10JiYodD0hMSksZSlpZihuLmdldENvbmZpZygpLm1heExlbmd0aCl7dmFyIHI9SHMuZ2V0TGVmdExlbmd0aE9mTWF4TGVuZ3RoKG4pO2lmKCEocjw9MCkpe3ZhciBvPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO28uaW5uZXJIVE1MPWU7dmFyIGk9QXJyYXkuZnJvbShvLmNoaWxkTm9kZXMpLnJlZHVjZSgoZnVuY3Rpb24oZSx0KXt2YXIgbj10Lm5vZGVUeXBlLHI9dC5ub2RlTmFtZTtyZXR1cm4gdD9uPT09U3MuVEVYVF9OT0RFP2UrKHQudGV4dENvbnRlbnR8fCIiKTpuPT09U3MuRUxFTUVOVF9OT0RFP0ljLmhhcyhyLnRvTG93ZXJDYXNlKCkpP2U6ZSsodC50ZXh0Q29udGVudHx8IiIpOmU6ZX0pLCIiKTtyPGkubGVuZ3RofHxhKGUsdCk7fX1lbHNlIGEoZSx0KTt9LG59KGZ1bmN0aW9uKGUpe3ZhciB0PWU7cmV0dXJuIHQub249ZnVuY3Rpb24oZSxuKXt2YXIgcj1mZih0KTtpZihyLm9uKGUsbiksImRlc3Ryb3llZCI9PT1lJiZwZih0LG4pLCJkZXN0cm95ZWQiIT09ZSl7dmFyIG89ZnVuY3Rpb24oKXtyZXR1cm4gci5vZmYoZSxuKX07ci5vbigiZGVzdHJveWVkIixvKSxwZih0LG8pO319LHQub25jZT1mdW5jdGlvbihlLG4pe2ZmKHQpLm9uY2UoZSxuKTt9LHQub2ZmPWZ1bmN0aW9uKGUsbil7ZmYodCkub2ZmKGUsbik7fSx0LmVtaXQ9ZnVuY3Rpb24oZSl7Zm9yKHZhciBuPVtdLHI9MTtyPGFyZ3VtZW50cy5sZW5ndGg7cisrKW5bci0xXT1hcmd1bWVudHNbcl07dmFyIG89ZmYodCk7KG8uZW1pdC5hcHBseShvLEppKFtlXSxHaShuKSkpLCJkZXN0cm95ZWQiPT09ZSkmJihoZih0KS5mb3JFYWNoKChmdW5jdGlvbihlKXtyZXR1cm4gby5vZmYoImRlc3Ryb3llZCIsZSl9KSksZ2YodCkpO30sdH0oZnVuY3Rpb24oZSl7dmFyIG49ZTtyZXR1cm4gbi5zZWxlY3Q9ZnVuY3Rpb24oZSl7dC5UcmFuc2Zvcm1zLnNlbGVjdChuLGUpO30sbi5kZXNlbGVjdD1mdW5jdGlvbigpe3ZhciByPW4uc2VsZWN0aW9uLG89SHMuZmluZERvY3VtZW50T3JTaGFkb3dSb290KG4pLmdldFNlbGVjdGlvbigpO28mJm8ucmFuZ2VDb3VudD4wJiZvLnJlbW92ZUFsbFJhbmdlcygpLHImJnQuVHJhbnNmb3Jtcy5kZXNlbGVjdChlKTt9LG4ubW92ZT1mdW5jdGlvbihuLHIpe3ZvaWQgMD09PXImJihyPSExKSxuJiYobjwwfHx0LlRyYW5zZm9ybXMubW92ZShlLHtkaXN0YW5jZTpuLHVuaXQ6ImNoYXJhY3RlciIscmV2ZXJzZTpyfSkpO30sbi5tb3ZlUmV2ZXJzZT1mdW5jdGlvbihlKXtuLm1vdmUoZSwhMCk7fSxuLnJlc3RvcmVTZWxlY3Rpb249ZnVuY3Rpb24oKXt2YXIgZT12cy5nZXQobik7bnVsbCE9ZSYmKG4uZm9jdXMoKSx0LlRyYW5zZm9ybXMuc2VsZWN0KG4sZSkpO30sbi5nZXRTZWxlY3Rpb25Qb3NpdGlvbj1mdW5jdGlvbigpe3JldHVybiB5ZihuKX0sbi5nZXROb2RlUG9zaXRpb249ZnVuY3Rpb24oZSl7cmV0dXJuIG1mKG4sZSl9LG4uaXNTZWxlY3RlZEFsbD1mdW5jdGlvbigpe3ZhciBlPW4uc2VsZWN0aW9uO2lmKG51bGw9PWUpcmV0dXJuICExO3ZhciByPUdpKHQuUmFuZ2UuZWRnZXMoZSksMiksbz1yWzBdLGk9clsxXSxhPUdpKHQuRWRpdG9yLmVkZ2VzKG4sW10pLDIpLHM9YVswXSxsPWFbMV07cmV0dXJuICEoIXQuUG9pbnQuZXF1YWxzKG8scyl8fCF0LlBvaW50LmVxdWFscyhpLGwpKX0sbi5zZWxlY3RBbGw9ZnVuY3Rpb24oKXt2YXIgZT10LkVkaXRvci5zdGFydChuLFtdKSxyPXQuRWRpdG9yLmVuZChuLFtdKTt0LlRyYW5zZm9ybXMuc2VsZWN0KG4se2FuY2hvcjplLGZvY3VzOnJ9KTt9LG59KCRjKGZ1bmN0aW9uKGUpe3ZhciB0PWU7cmV0dXJuIHQuZ2V0QWxsTWVudUtleXM9ZnVuY3Rpb24oKXt2YXIgZT1bXTtmb3IodmFyIHQgaW4gVXMpZS5wdXNoKHQpO3JldHVybiBlfSx0LmdldENvbmZpZz1mdW5jdGlvbigpe3ZhciBlPXJzLmdldCh0KTtpZihudWxsPT1lKXRocm93IG5ldyBFcnJvcigiQ2FuIG5vdCBnZXQgZWRpdG9yIGNvbmZpZyIpO3JldHVybiBlfSx0LmdldE1lbnVDb25maWc9ZnVuY3Rpb24oZSl7dmFyIG49dC5nZXRDb25maWcoKS5NRU5VX0NPTkY7cmV0dXJuICh2b2lkIDA9PT1uP3t9Om4pW2VdfHx7fX0sdC5hbGVydD1mdW5jdGlvbihlLG4pe3ZvaWQgMD09PW4mJihuPSJpbmZvIik7dmFyIHI9dC5nZXRDb25maWcoKS5jdXN0b21BbGVydDtyJiZyKGUsbik7fSx0fShmdW5jdGlvbihlKXt2YXIgbj1lO3JldHVybiBuLmlkPSJ3YW5nRWRpdG9yLSIrVnMrKyxuLmlzRGVzdHJveWVkPSExLG4uaXNGdWxsU2NyZWVuPSExLG4uZm9jdXM9ZnVuY3Rpb24oZSl7aWYoSHMudG9ET01Ob2RlKG4sbikuZm9jdXMoe3ByZXZlbnRTY3JvbGw6ITB9KSxncy5zZXQobiwhMCksZSl7dmFyIHI9dC5FZGl0b3IuZW5kKG4sW10pO3QuVHJhbnNmb3Jtcy5zZWxlY3QobixyKTt9ZWxzZSB7dmFyIG89dnMuZ2V0KG4pO28/dC5UcmFuc2Zvcm1zLnNlbGVjdChuLG8pOnQuVHJhbnNmb3Jtcy5zZWxlY3Qobix0LkVkaXRvci5zdGFydChuLFtdKSk7fX0sbi5pc0ZvY3VzZWQ9ZnVuY3Rpb24oKXtyZXR1cm4gISFncy5nZXQobil9LG4uYmx1cj1mdW5jdGlvbigpe0hzLnRvRE9NTm9kZShuLG4pLmJsdXIoKSx0LlRyYW5zZm9ybXMuZGVzZWxlY3QobiksZ3Muc2V0KG4sITEpO30sbi51cGRhdGVWaWV3PWZ1bmN0aW9uKCl7SHMuZ2V0VGV4dGFyZWEobikuY2hhbmdlVmlld1N0YXRlKCk7dmFyIGU9SHMuZ2V0VG9vbGJhcihuKTtlJiZlLmNoYW5nZVRvb2xiYXJTdGF0ZSgpO3ZhciB0PUhzLmdldEhvdmVyYmFyKG4pO3QmJnQuY2hhbmdlSG92ZXJiYXJTdGF0ZSgpO30sbi5kZXN0cm95PWZ1bmN0aW9uKCl7aWYoIW4uaXNEZXN0cm95ZWQpe3ZhciBlPUhzLmdldFRleHRhcmVhKG4pO2UuZGVzdHJveSgpLEdhLmRlbGV0ZShuKSxKYS5kZWxldGUoZSk7dmFyIHQ9SHMuZ2V0VG9vbGJhcihuKTt0JiYodC5kZXN0cm95KCksWGEuZGVsZXRlKG4pLFlhLmRlbGV0ZSh0KSk7dmFyIHI9SHMuZ2V0SG92ZXJiYXIobik7ciYmKHIuZGVzdHJveSgpLFphLmRlbGV0ZShuKSxRYS5kZWxldGUocikpLG4uaXNEZXN0cm95ZWQ9ITAsbi5lbWl0KCJkZXN0cm95ZWQiKTt9fSxuLnNjcm9sbFRvRWxlbT1mdW5jdGlvbihlKXtpZighbi5nZXRDb25maWcoKS5zY3JvbGwpe3ZhciB0PSLnvJbovpHlmajnpoHnlKjkuoYgc2Nyb2xsIO+8jOe8lui+keWZqOWGheWuueaXoOazlea7muWKqO+8jOivt+iHquihjOWunueOsOivpeWKn+iDvSI7cmV0dXJuIHQrPSJcbllvdSBoYXMgZGlzYWJsZWQgZWRpdG9yIHNjcm9sbCwgcGxlYXNlIGRvIHRoaXMgeW91cnNlbGYiLHZvaWQgY29uc29sZS53YXJuKHQpfXZhciByPXkuZGVmYXVsdCgiIyIrZSk7aWYoMCE9PXIubGVuZ3RoKXt2YXIgbz1yWzBdO2lmKCFIcy5oYXNET01Ob2RlKG4sbykpcmV0dXJuIHQ9IkVsZW1lbnQgKGZvdW5kIGJ5IGlkIGlzICciK2UrIicpIGlzIG5vdCBpbiBlZGl0b3IgRE9NIix0Kz0iXG4g6YCa6L+HIGlkICciK2UrIicg5om+5Yiw55qEIGVsZW1lbnQg5LiN5ZyoIGVkaXRvciBET00g5LmL5YaFIix2b2lkIGNvbnNvbGUuZXJyb3IodCxvKTt2YXIgaT1Icy5nZXRUZXh0YXJlYShuKSxhPWkuJHRleHRBcmVhQ29udGFpbmVyLHM9aS4kc2Nyb2xsLGw9ci5vZmZzZXQoKS50b3AsdT1hLm9mZnNldCgpLnRvcDtzWzBdLnNjcm9sbEJ5KHt0b3A6bC11LGJlaGF2aW9yOiJzbW9vdGgifSk7fX0sbi5zaG93UHJvZ3Jlc3NCYXI9ZnVuY3Rpb24oZSl7ZTwxfHxIcy5nZXRUZXh0YXJlYShuKS5jaGFuZ2VQcm9ncmVzcyhlKTt9LG4uaGlkZVBhbmVsT3JNb2RhbD1mdW5jdGlvbigpe3ZhciBlPXRzLmdldChuKTtudWxsIT1lJiZlLmZvckVhY2goKGZ1bmN0aW9uKGUpe3JldHVybiBlLmhpZGUoKX0pKTt9LG4uZW5hYmxlPWZ1bmN0aW9uKCl7bi5nZXRDb25maWcoKS5yZWFkT25seT0hMSxuLnVwZGF0ZVZpZXcoKTt9LG4uZGlzYWJsZT1mdW5jdGlvbigpe24uZ2V0Q29uZmlnKCkucmVhZE9ubHk9ITAsbi51cGRhdGVWaWV3KCk7fSxuLmlzRGlzYWJsZWQ9ZnVuY3Rpb24oKXtyZXR1cm4gbi5nZXRDb25maWcoKS5yZWFkT25seX0sbi50b0RPTU5vZGU9ZnVuY3Rpb24oZSl7cmV0dXJuIEhzLnRvRE9NTm9kZShuLGUpfSxuLmZ1bGxTY3JlZW49ZnVuY3Rpb24oKXtpZighbi5pc0Z1bGxTY3JlZW4pe3ZhciBlPW51bGwsdD1Icy5nZXRUb29sYmFyKG4pO3QmJihlPXQuJGJveCk7dmFyIHI9SHMuZ2V0VGV4dGFyZWEobikuJGJveC5wYXJlbnQoKTtpZihlJiZlLnBhcmVudCgpWzBdIT09clswXSl0aHJvdyBuZXcgRXJyb3IoIkNhbiBub3Qgc2V0IGZ1bGwgc2NyZWVuLCBjYXVzZSB0b29sYmFyIERPTSBwYXJlbnQgaXMgbm90IGVxdWFsIHRvIHRleHRhcmVhIERPTSBwYXJlbnRcbuS4jeiDveiuvue9ruWFqOWxj++8jOWboOS4uiB0b29sYmFyIERPTSDniLboioLngrnlkowgdGV4dGFyZWEgRE9NIOeItuiKgueCueS4jeS4gOiHtCIpO3IuYWRkQ2xhc3MoInctZS1mdWxsLXNjcmVlbi1jb250YWluZXIiKTt2YXIgbz1yLmNzcygiei1pbmRleCIpO3IuYXR0cigiZGF0YS16LWluZGV4IixvLnRvU3RyaW5nKCkpLG4uaXNGdWxsU2NyZWVuPSEwLG4uZW1pdCgiZnVsbFNjcmVlbiIpO319LG4udW5GdWxsU2NyZWVuPWZ1bmN0aW9uKCl7aWYobi5pc0Z1bGxTY3JlZW4pe3ZhciBlPUhzLmdldFRleHRhcmVhKG4pLiRib3gucGFyZW50KCk7c2V0VGltZW91dCgoZnVuY3Rpb24oKXtlLnJlbW92ZUNsYXNzKCJ3LWUtZnVsbC1zY3JlZW4tY29udGFpbmVyIiksbi5pc0Z1bGxTY3JlZW49ITEsbi5lbWl0KCJ1bkZ1bGxTY3JlZW4iKTt9KSwyMDApO319LG4uZ2V0RWRpdGFibGVDb250YWluZXI9ZnVuY3Rpb24oKXtyZXR1cm4gSHMuZ2V0VGV4dGFyZWEobikuJHRleHRBcmVhQ29udGFpbmVyWzBdfSxufShXYyh0LmNyZWF0ZUVkaXRvcigpKSkpKSkpKSk7aWYociYmZnVuY3Rpb24oZSx0KXtyZXR1cm4gUGMoZSwiZGF0YS13LWUtdGV4dGFyZWEiLHQpfShjLHIpKXRocm93IG5ldyBFcnJvcigiUmVwZWF0ZWQgY3JlYXRlIGVkaXRvciBieSBzZWxlY3RvciAnIityKyInIik7dmFyIGY9ZnVuY3Rpb24oZSl7dm9pZCAwPT09ZSYmKGU9e30pO3ZhciB0PUUuZGVmYXVsdCh6cyksbj17fSxyPWUuTUVOVV9DT05GLG89dm9pZCAwPT09cj97fTpyO3JldHVybiBtLmRlZmF1bHQodCwoZnVuY3Rpb24oZSx0KXtuW3RdPUtpKEtpKHt9LGUpLG9bdF18fHt9KTt9KSksZGVsZXRlIGUuTUVOVV9DT05GLEtpKHtzY3JvbGw6ITAscmVhZE9ubHk6ITEsYXV0b0ZvY3VzOiEwLGRlY29yYXRlOmZ1bmN0aW9uKCl7cmV0dXJuIFtdfSxtYXhMZW5ndGg6MCxNRU5VX0NPTkY6bixob3ZlcmJhcktleXM6e30sY3VzdG9tQWxlcnQ6ZnVuY3Rpb24oZSx0KXt3aW5kb3cuYWxlcnQodCsiOlxuIitlKTt9fSxlKX0oaSk7cnMuc2V0KGMsZik7dmFyIGQ9Zi5ob3ZlcmJhcktleXMscD12b2lkIDA9PT1kP3t9OmQ7aWYodS5mb3JFYWNoKChmdW5jdGlvbihlKXtjPWUoYyk7fSkpLG51bGwhPXMmJihjLmNoaWxkcmVuPVJjKGMscykpLGEmJmEubGVuZ3RoJiYoYy5jaGlsZHJlbj1hKSwwPT09Yy5jaGlsZHJlbi5sZW5ndGgmJihjLmNoaWxkcmVuPVt7dHlwZToicGFyYWdyYXBoIixjaGlsZHJlbjpbe3RleHQ6IiJ9XX1dKSxIcy5ub3JtYWxpemVDb250ZW50KGMpLHIpe3ZhciBoPW5ldyBkZChyKTtHYS5zZXQoYyxoKSxKYS5zZXQoaCxjKSxoLmNoYW5nZVZpZXdTdGF0ZSgpLFV1KChmdW5jdGlvbigpe3ZhciBlPWguJHNjcm9sbDtpZihudWxsIT1lJiZlLmhlaWdodCgpPDMwMCl7Y29uc29sZS53YXJuKCLnvJbovpHljLrln5/pq5jluqYgPCAzMDBweCDov5nlj6/og73kvJrlr7zoh7QgbW9kYWwgaG92ZXJiYXIg5a6a5L2N5byC5bi4XG5UZXh0YXJlYSBoZWlnaHQgPCAzMDBweCAuIFRoaXMgbWF5IGJlIGNhdXNlIG1vZGFsIGFuZCBob3ZlcmJhciBwb3NpdGlvbiBlcnJvciIsZSk7fX0pKTt2YXIgZz12b2lkIDA7T2JqZWN0LmtleXMocCkubGVuZ3RoPjAmJihnPW5ldyBQZCxRYS5zZXQoZyxjKSxaYS5zZXQoYyxnKSksYy5vbigiY2hhbmdlIiwoZnVuY3Rpb24oKXtjLmhpZGVQYW5lbE9yTW9kYWwoKTt9KSksYy5vbigic2Nyb2xsIiwoZnVuY3Rpb24oKXtjLmhpZGVQYW5lbE9yTW9kYWwoKTt9KSk7fWVsc2UgYy5jaGlsZHJlbi5mb3JFYWNoKChmdW5jdGlvbihlLHQpe3JldHVybiBSZChlLHQsYyxjKX0pKTt2YXIgdj1mLm9uQ3JlYXRlZCxiPWYub25EZXN0cm95ZWQ7cmV0dXJuIHYmJmMub24oImNyZWF0ZWQiLChmdW5jdGlvbigpe3JldHVybiB2KGMpfSkpLGImJmMub24oImRlc3Ryb3llZCIsKGZ1bmN0aW9uKCl7cmV0dXJuIGIoYyl9KSksVXUoKGZ1bmN0aW9uKCl7cmV0dXJuIGMuZW1pdCgiY3JlYXRlZCIpfSkpLGN9LGUuY29yZUNyZWF0ZVRvb2xiYXI9ZnVuY3Rpb24oZSx0KXtpZihudWxsPT1lKXRocm93IG5ldyBFcnJvcigiQ2Fubm90IGNyZWF0ZSB0b29sYmFyLCBiZWNhdXNlIGVkaXRvciBpcyBudWxsIik7dmFyIG49dC5zZWxlY3RvcixyPXQuY29uZmlnLG89dm9pZCAwPT09cj97fTpyO2lmKGZ1bmN0aW9uKGUsdCl7cmV0dXJuIFBjKGUsImRhdGEtdy1lLXRvb2xiYXIiLHQpfShlLG4pKXRocm93IG5ldyBFcnJvcigiUmVwZWF0ZWQgY3JlYXRlIHRvb2xiYXIgYnkgc2VsZWN0b3IgJyIrbisiJyIpO3ZhciBpPUtpKHt0b29sYmFyS2V5czpbXSxleGNsdWRlS2V5czpbXSxpbnNlcnRLZXlzOntpbmRleDowLGtleXM6W119LG1vZGFsQXBwZW5kVG9Cb2R5OiExfSxvfHx7fSksYT1uZXcgQmQobixpKTtyZXR1cm4gWWEuc2V0KGEsZSksWGEuc2V0KGUsYSksYX0sZS5jcmVhdGVVcGxvYWRlcj1mdW5jdGlvbihlKXt2YXIgdD1lLnNlcnZlcixuPXZvaWQgMD09PXQ/IiI6dCxyPWUuZmllbGROYW1lLG89dm9pZCAwPT09cj8iIjpyLGk9ZS5tYXhGaWxlU2l6ZSxhPXZvaWQgMD09PWk/MTA0ODU3NjA6aSxzPWUubWF4TnVtYmVyT2ZGaWxlcyxsPXZvaWQgMD09PXM/MTAwOnMsdT1lLm1ldGEsYz12b2lkIDA9PT11P3t9OnUsZj1lLm1ldGFXaXRoVXJsLGQ9dm9pZCAwIT09ZiYmZixwPWUuaGVhZGVycyxoPXZvaWQgMD09PXA/e306cCxnPWUud2l0aENyZWRlbnRpYWxzLHY9dm9pZCAwIT09ZyYmZyx5PWUudGltZW91dCxiPXZvaWQgMD09PXk/MWU0Onksdz1lLm9uQmVmb3JlVXBsb2FkLHg9dm9pZCAwPT09dz9mdW5jdGlvbihlKXtyZXR1cm4gZX06dyxFPWUub25TdWNjZXNzLE89dm9pZCAwPT09RT9mdW5jdGlvbihlLHQpe306RSxDPWUub25FcnJvcixUPXZvaWQgMD09PUM/ZnVuY3Rpb24oZSx0LG4pe2NvbnNvbGUuZXJyb3IoZS5uYW1lKyIgdXBsb2FkIGVycm9yIix0LG4pO306QyxOPWUub25Qcm9ncmVzcyxNPXZvaWQgMD09PU4/ZnVuY3Rpb24oZSl7fTpOO2lmKCFuKXRocm93IG5ldyBFcnJvcigiQ2Fubm90IGdldCB1cGxvYWQgc2VydmVyIGFkZHJlc3NcbuayoeaciemFjee9ruS4iuS8oOWcsOWdgCIpO2lmKCFvKXRocm93IG5ldyBFcnJvcigiQ2Fubm90IGdldCBmaWVsZE5hbWVcbuayoeaciemFjee9riBmaWVsZE5hbWUiKTt2YXIgTD1uO2QmJihMPWZ1bmN0aW9uKGUsdCl7dmFyIG49R2koZS5zcGxpdCgiIyIpLDIpLHI9blswXSxvPW5bMV0saT1bXTttLmRlZmF1bHQodCwoZnVuY3Rpb24oZSx0KXtpLnB1c2godCsiPSIrZSk7fSkpO3ZhciBhPWkuam9pbigiJiIpO3JldHVybiByPXIuaW5kZXhPZigiPyIpPjA/cisiJiIrYTpyKyI/IithLG8/cisiIyIrbzpyfShMLGMpKTt2YXIgUD1uZXcgUy5kZWZhdWx0KHtvbkJlZm9yZVVwbG9hZDp4LHJlc3RyaWN0aW9uczp7bWF4RmlsZVNpemU6YSxtYXhOdW1iZXJPZkZpbGVzOmx9LG1ldGE6Y30pLnVzZShrLmRlZmF1bHQse2VuZHBvaW50OkwsaGVhZGVyczpoLGZvcm1EYXRhOiEwLGZpZWxkTmFtZTpvLGJ1bmRsZTohMCx3aXRoQ3JlZGVudGlhbHM6dix0aW1lb3V0OmJ9KTtyZXR1cm4gUC5vbigidXBsb2FkLXN1Y2Nlc3MiLChmdW5jdGlvbihlLHQpe3ZhciBuPXQuYm9keSxyPXZvaWQgMD09PW4/e306bjt0cnl7TyhlLHIpO31jYXRjaChlKXtjb25zb2xlLmVycm9yKCJ3YW5nRWRpdG9yIHVwbG9hZCBmaWxlIC0gb25TdWNjZXNzIGVycm9yIixlKTt9UC5yZW1vdmVGaWxlKGUuaWQpO30pKSxQLm9uKCJwcm9ncmVzcyIsKGZ1bmN0aW9uKGUpe2U8MXx8TShlKTt9KSksUC5vbigidXBsb2FkLWVycm9yIiwoZnVuY3Rpb24oZSx0LG4pe3RyeXtUKGUsdCxuKTt9Y2F0Y2goZSl7Y29uc29sZS5lcnJvcigid2FuZ0VkaXRvciB1cGxvYWQgZmlsZSAtIG9uRXJyb3IgZXJyb3IiLGUpO31QLnJlbW92ZUZpbGUoZS5pZCk7fSkpLFAub24oInJlc3RyaWN0aW9uLWZhaWxlZCIsKGZ1bmN0aW9uKGUsdCl7dHJ5e1QoZSx0KTt9Y2F0Y2goZSl7Y29uc29sZS5lcnJvcigid2FuZ0VkaXRvciB1cGxvYWQgZmlsZSAtIG9uRXJyb3IgZXJyb3IiLGUpO31QLnJlbW92ZUZpbGUoZS5pZCk7fSkpLFB9LGUuZ2VuTW9kYWxCdXR0b25FbGVtcz1mdW5jdGlvbihlLHQpe3ZhciBuPXkuZGVmYXVsdCgnPGRpdiBjbGFzcz0iYnV0dG9uLWNvbnRhaW5lciI+PC9kaXY+Jykscj15LmRlZmF1bHQoJzxidXR0b24gdHlwZT0iYnV0dG9uIiBpZD0iJytlKyciPicrdCsiPC9idXR0b24+Iik7cmV0dXJuIG4uYXBwZW5kKHIpLFtuWzBdLHJbMF1dfSxlLmdlbk1vZGFsSW5wdXRFbGVtcz1mdW5jdGlvbihlLHQsbil7dmFyIHI9eS5kZWZhdWx0KCc8bGFiZWwgY2xhc3M9ImJhYmVsLWNvbnRhaW5lciI+PC9sYWJlbD4nKTtyLmFwcGVuZCgiPHNwYW4+IitlKyI8L3NwYW4+Iik7dmFyIG89eS5kZWZhdWx0KCc8aW5wdXQgdHlwZT0idGV4dCIgaWQ9IicrdCsnIiBwbGFjZWhvbGRlcj0iJysobnx8IiIpKyciPicpO3JldHVybiByLmFwcGVuZChvKSxbclswXSxvWzBdXX0sZS5nZW5Nb2RhbFRleHRhcmVhRWxlbXM9ZnVuY3Rpb24oZSx0LG4pe3ZhciByPXkuZGVmYXVsdCgnPGxhYmVsIGNsYXNzPSJiYWJlbC1jb250YWluZXIiPjwvbGFiZWw+Jyk7ci5hcHBlbmQoIjxzcGFuPiIrZSsiPC9zcGFuPiIpO3ZhciBvPXkuZGVmYXVsdCgnPHRleHRhcmVhIHR5cGU9InRleHQiIGlkPSInK3QrJyIgcGxhY2Vob2xkZXI9IicrKG58fCIiKSsnIj48L3RleHRhcmVhPicpO3JldHVybiByLmFwcGVuZChvKSxbclswXSxvWzBdXX0sZS5pMThuQWRkUmVzb3VyY2VzPWZ1bmN0aW9uKGUsdCl7enAuYWRkUmVzb3VyY2VCdW5kbGUoZSxVcCx0LCEwLCEwKTt9LGUuaTE4bkNoYW5nZUxhbmd1YWdlPWZ1bmN0aW9uKGUpe3pwLmNoYW5nZUxhbmd1YWdlKGUpO30sZS5pMThuR2V0UmVzb3VyY2VzPWZ1bmN0aW9uKGUpe3JldHVybiB6cC5nZXRSZXNvdXJjZUJ1bmRsZShlLFVwKX0sZS5yZWdpc3RlckVsZW1Ub0h0bWxDb25mPWZ1bmN0aW9uKGUpe3ZhciB0PWUudHlwZSxuPWUuZWxlbVRvSHRtbDtvbFt0fHwiIl09bjt9LGUucmVnaXN0ZXJNZW51PWZ1bmN0aW9uKGUsdCl7dmFyIG49ZS5rZXkscj1lLmZhY3Rvcnksbz1lLmNvbmZpZyxpPUtpKEtpKHt9LG8pLHR8fHt9KTtpZihudWxsIT1Vc1tuXSl0aHJvdyBuZXcgRXJyb3IoIkR1cGxpY2F0ZWQga2V5ICciK24rIicgaW4gbWVudSBpdGVtcyIpO1VzW25dPXIsZnVuY3Rpb24oZSx0KXtudWxsIT10JiYoenNbZV09dCk7fShuLGkpO30sZS5yZWdpc3RlclBhcnNlRWxlbUh0bWxDb25mPWZ1bmN0aW9uKGUpe3ZhciB0PWUuc2VsZWN0b3Isbj1lLnBhcnNlRWxlbUh0bWw7WnVbdF09bjt9LGUucmVnaXN0ZXJQYXJzZVN0eWxlSHRtbEhhbmRsZXI9ZnVuY3Rpb24oZSl7UXUucHVzaChlKTt9LGUucmVnaXN0ZXJQcmVQYXJzZUh0bWxDb25mPWZ1bmN0aW9uKGUpe1h1LnB1c2goZSk7fSxlLnJlZ2lzdGVyUmVuZGVyRWxlbUNvbmY9ZnVuY3Rpb24oZSl7dmFyIHQ9ZS50eXBlLG49ZS5yZW5kZXJFbGVtO0ZmW3R8fCIiXT1uO30sZS5yZWdpc3RlclN0eWxlSGFuZGxlcj1mdW5jdGlvbihlKXtfZi5wdXNoKGUpO30sZS5yZWdpc3RlclN0eWxlVG9IdG1sSGFuZGxlcj1mdW5jdGlvbihlKXtybC5wdXNoKGUpO30sZS50PUtwLE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KTt9KSk7CgogIH0pOwoKICAvKioKICAgKiBAZGVzY3JpcHRpb24gaTE4biBlbgogICAqIEBhdXRob3Igd2FuZ2Z1cGVuZwogICAqLwogIHZhciBlblJlc291cmNlcyA9IHsKICAgICAgZWRpdG9yOiB7CiAgICAgICAgICBtb3JlOiAnTW9yZScsCiAgICAgICAgICBqdXN0aWZ5OiAnSnVzdGlmeScsCiAgICAgICAgICBpbmRlbnQ6ICdJbmRlbnQnLAogICAgICAgICAgaW1hZ2U6ICdJbWFnZScsCiAgICAgICAgICB2aWRlbzogJ1ZpZGVvJywKICAgICAgfSwKICB9OwoKICAvKioKICAgKiBAZGVzY3JpcHRpb24gaTE4biB6aC1DTgogICAqIEBhdXRob3Igd2FuZ2Z1cGVuZwogICAqLwogIHZhciB6aFJlc291cmNlcyA9IHsKICAgICAgZWRpdG9yOiB7CiAgICAgICAgICBtb3JlOiAn5pu05aSaJywKICAgICAgICAgIGp1c3RpZnk6ICflr7npvZAnLAogICAgICAgICAgaW5kZW50OiAn57yp6L+bJywKICAgICAgICAgIGltYWdlOiAn5Zu+54mHJywKICAgICAgICAgIHZpZGVvOiAn6KeG6aKRJywKICAgICAgfSwKICB9OwoKICAvKioKICAgKiBAZGVzY3JpcHRpb24gaTE4biBlbnRyeQogICAqIEBhdXRob3Igd2FuZ2Z1cGVuZwogICAqLwogIGRpc3QkNi5pMThuQWRkUmVzb3VyY2VzKCdlbicsIGVuUmVzb3VyY2VzKTsKICBkaXN0JDYuaTE4bkFkZFJlc291cmNlcygnemgtQ04nLCB6aFJlc291cmNlcyk7CgogIHZhciBkaXN0JDUgPSBjcmVhdGVDb21tb25qc01vZHVsZSQxKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAhZnVuY3Rpb24odCxlKXtlKGV4cG9ydHMsZGlzdCQ2LHJlcXVpcmUkJDIscmVxdWlyZSQkMiQxLHJlcXVpcmUkJDEscmVxdWlyZSQkNCxsb2Rhc2hfdGhyb3R0bGUpO30oY29tbW9uanNHbG9iYWwsKGZ1bmN0aW9uKHQsZSxuLHIsbyxpLHUpe2Z1bmN0aW9uIGEodCl7cmV0dXJuIHQmJiJvYmplY3QiPT10eXBlb2YgdCYmImRlZmF1bHQiaW4gdD90OntkZWZhdWx0OnR9fXZhciBjPWEobyksbD1hKHUpO2UuaTE4bkFkZFJlc291cmNlcygiZW4iLHtjb21tb246e29rOiJPSyIsZGVsZXRlOiJEZWxldGUiLGVudGVyOiJFbnRlciJ9LGJsb2NrUXVvdGU6e3RpdGxlOiJRdW90ZSJ9LGNvZGVCbG9jazp7dGl0bGU6IkNvZGUgYmxvY2sifSxjb2xvcjp7Y29sb3I6IkZvbnQgY29sb3IiLGJnQ29sb3I6IkJhY2sgY29sb3IiLGRlZmF1bHQ6IkRlZmF1bHQgY29sb3IiLGNsZWFyOiJDbGVhciBiYWNrIGNvbG9yIn0sZGl2aWRlcjp7dGl0bGU6IkRpdmlkZXIifSxlbW90aW9uOnt0aXRsZToiRW1vdGlvbiJ9LGZvbnRTaXplOnt0aXRsZToiRm9udCBzaXplIixkZWZhdWx0OiJEZWZhdWx0In0sZm9udEZhbWlseTp7dGl0bGU6IkZvbnQgZmFtaWx5IixkZWZhdWx0OiJEZWZhdWx0In0sZnVsbFNjcmVlbjp7dGl0bGU6IkZ1bGwgc2NyZWVuIn0saGVhZGVyOnt0aXRsZToiSGVhZGVyIix0ZXh0OiJUZXh0In0saW1hZ2U6e25ldEltYWdlOiJOZXQgaW1hZ2UiLGRlbGV0ZToiRGVsZXRlIGltYWdlIixlZGl0OiJFZGl0IGltYWdlIix2aWV3TGluazoiVmlldyBsaW5rIixzcmM6IkltYWdlIHNyYyIsZGVzYzoiRGVzY3JpcHRpb24iLGxpbms6IkltYWdlIGxpbmsifSxpbmRlbnQ6e2RlY3JlYXNlOiJEZWNyZWFzZSIsaW5jcmVhc2U6IkluY3JlYXNlIn0sanVzdGlmeTp7bGVmdDoiTGVmdCIscmlnaHQ6IlJpZ2h0IixjZW50ZXI6IkNlbnRlciIsanVzdGlmeToiSnVzdGlmeSJ9LGxpbmVIZWlnaHQ6e3RpdGxlOiJMaW5lIGhlaWdodCIsZGVmYXVsdDoiRGVmYXVsdCJ9LGxpbms6e2luc2VydDoiSW5zZXJ0IGxpbmsiLHRleHQ6IkxpbmsgdGV4dCIsdXJsOiJMaW5rIHNvdXJjZSIsdW5MaW5rOiJVbmxpbmsiLGVkaXQ6IkVkaXQgbGluayIsdmlldzoiVmlldyBsaW5rIn0sdGV4dFN0eWxlOntib2xkOiJCb2xkIixjbGVhcjoiQ2xlYXIgc3R5bGVzIixjb2RlOiJJbmxpbmUgY29kZSIsaXRhbGljOiJJdGFsaWMiLHN1YjoiU3ViIixzdXA6IlN1cCIsdGhyb3VnaDoiVGhyb3VnaCIsdW5kZXJsaW5lOiJVbmRlcmxpbmUifSx1bmRvOnt1bmRvOiJ1bmRvIixyZWRvOiJSZWRvIn0sdG9kbzp7dG9kbzoiVG9kbyJ9fSksZS5pMThuQWRkUmVzb3VyY2VzKCJ6aC1DTiIse2NvbW1vbjp7b2s6IuehruWumiIsZGVsZXRlOiLliKDpmaQiLGVudGVyOiLlm57ovaYifSxibG9ja1F1b3RlOnt0aXRsZToi5byV55SoIn0sY29kZUJsb2NrOnt0aXRsZToi5Luj56CB5Z2XIn0sY29sb3I6e2NvbG9yOiLmloflrZfpopzoibIiLGJnQ29sb3I6IuiDjOaZr+iJsiIsZGVmYXVsdDoi6buY6K6k6aKc6ImyIixjbGVhcjoi5riF6Zmk6IOM5pmv6ImyIn0sZGl2aWRlcjp7dGl0bGU6IuWIhuWJsue6vyJ9LGVtb3Rpb246e3RpdGxlOiLooajmg4UifSxmb250U2l6ZTp7dGl0bGU6IuWtl+WPtyIsZGVmYXVsdDoi6buY6K6k5a2X5Y+3In0sZm9udEZhbWlseTp7dGl0bGU6IuWtl+S9kyIsZGVmYXVsdDoi6buY6K6k5a2X5L2TIn0sZnVsbFNjcmVlbjp7dGl0bGU6IuWFqOWxjyJ9LGhlYWRlcjp7dGl0bGU6Iuagh+mimCIsdGV4dDoi5q2j5paHIn0saW1hZ2U6e25ldEltYWdlOiLnvZHnu5zlm77niYciLGRlbGV0ZToi5Yig6Zmk5Zu+54mHIixlZGl0OiLnvJbovpHlm77niYciLHZpZXdMaW5rOiLmn6XnnIvpk77mjqUiLHNyYzoi5Zu+54mH5Zyw5Z2AIixkZXNjOiLlm77niYfmj4/ov7AiLGxpbms6IuWbvueJh+mTvuaOpSJ9LGluZGVudDp7ZGVjcmVhc2U6IuWHj+Wwkee8qei/myIsaW5jcmVhc2U6IuWinuWKoOe8qei/myJ9LGp1c3RpZnk6e2xlZnQ6IuW3puWvuem9kCIscmlnaHQ6IuWPs+Wvuem9kCIsY2VudGVyOiLlsYXkuK3lr7npvZAiLGp1c3RpZnk6IuS4pOerr+Wvuem9kCJ9LGxpbmVIZWlnaHQ6e3RpdGxlOiLooYzpq5giLGRlZmF1bHQ6Ium7mOiupOihjOmrmCJ9LGxpbms6e2luc2VydDoi5o+S5YWl6ZO+5o6lIix0ZXh0OiLpk77mjqXmlofmnKwiLHVybDoi6ZO+5o6l5Zyw5Z2AIix1bkxpbms6IuWPlua2iOmTvuaOpSIsZWRpdDoi5L+u5pS56ZO+5o6lIix2aWV3OiLmn6XnnIvpk77mjqUifSx0ZXh0U3R5bGU6e2JvbGQ6Iueyl+S9kyIsY2xlYXI6Iua4hemZpOagvOW8jyIsY29kZToi6KGM5YaF5Luj56CBIixpdGFsaWM6IuaWnOS9kyIsc3ViOiLkuIvmoIciLHN1cDoi5LiK5qCHIix0aHJvdWdoOiLliKDpmaTnur8iLHVuZGVybGluZToi5LiL5YiS57q/In0sdW5kbzp7dW5kbzoi5pKk6ZSAIixyZWRvOiLph43lgZoifSx0b2RvOnt0b2RvOiLlvoXlip4ifX0pO3ZhciBzPXt0eXBlOiJwYXJhZ3JhcGgiLHJlbmRlckVsZW06ZnVuY3Rpb24odCxlLHIpe3JldHVybiBuLmpzeCgicCIsbnVsbCxlKX19O3ZhciBmPXt0eXBlOiJwYXJhZ3JhcGgiLGVsZW1Ub0h0bWw6ZnVuY3Rpb24odCxlKXtyZXR1cm4gIiI9PT1lPyI8cD48YnI+PC9wPiI6IjxwPiIrZSsiPC9wPiJ9fSxkPSJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsVGhpcz9nbG9iYWxUaGlzOiJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93P3dpbmRvdzoidW5kZWZpbmVkIiE9dHlwZW9mIGNvbW1vbmpzR2xvYmFsP2NvbW1vbmpzR2xvYmFsOiJ1bmRlZmluZWQiIT10eXBlb2Ygc2VsZj9zZWxmOnt9O2Z1bmN0aW9uIHAodCl7cmV0dXJuIHQmJnQuX19lc01vZHVsZSYmT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHQsImRlZmF1bHQiKT90LmRlZmF1bHQ6dH1mdW5jdGlvbiBoKHQpe3ZhciBlPXtleHBvcnRzOnt9fTtyZXR1cm4gdChlLGUuZXhwb3J0cyksZS5leHBvcnRzfXZhciB2LGcsbT1mdW5jdGlvbih0KXtyZXR1cm4gdCYmdC5NYXRoPT1NYXRoJiZ0fSx5PW0oIm9iamVjdCI9PXR5cGVvZiBnbG9iYWxUaGlzJiZnbG9iYWxUaGlzKXx8bSgib2JqZWN0Ij09dHlwZW9mIHdpbmRvdyYmd2luZG93KXx8bSgib2JqZWN0Ij09dHlwZW9mIHNlbGYmJnNlbGYpfHxtKCJvYmplY3QiPT10eXBlb2YgZCYmZCl8fGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9KCl8fEZ1bmN0aW9uKCJyZXR1cm4gdGhpcyIpKCksYj1mdW5jdGlvbih0KXt0cnl7cmV0dXJuICEhdCgpfWNhdGNoKHQpe3JldHVybiAhMH19LHg9IWIoKGZ1bmN0aW9uKCl7cmV0dXJuIDchPU9iamVjdC5kZWZpbmVQcm9wZXJ0eSh7fSwxLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gN319KVsxXX0pKSx3PUZ1bmN0aW9uLnByb3RvdHlwZS5jYWxsLEU9dy5iaW5kP3cuYmluZCh3KTpmdW5jdGlvbigpe3JldHVybiB3LmFwcGx5KHcsYXJndW1lbnRzKX0sUz17fS5wcm9wZXJ0eUlzRW51bWVyYWJsZSxrPU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IsVD1rJiYhUy5jYWxsKHsxOjJ9LDEpP2Z1bmN0aW9uKHQpe3ZhciBlPWsodGhpcyx0KTtyZXR1cm4gISFlJiZlLmVudW1lcmFibGV9OlMsTT17ZjpUfSxJPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIHtlbnVtZXJhYmxlOiEoMSZ0KSxjb25maWd1cmFibGU6ISgyJnQpLHdyaXRhYmxlOiEoNCZ0KSx2YWx1ZTplfX0sTj1GdW5jdGlvbi5wcm90b3R5cGUsSD1OLmJpbmQsTz1OLmNhbGwsaj1IJiZILmJpbmQoTyksRD1IP2Z1bmN0aW9uKHQpe3JldHVybiB0JiZqKE8sdCl9OmZ1bmN0aW9uKHQpe3JldHVybiB0JiZmdW5jdGlvbigpe3JldHVybiBPLmFwcGx5KHQsYXJndW1lbnRzKX19LEw9RCh7fS50b1N0cmluZyksej1EKCIiLnNsaWNlKSxBPWZ1bmN0aW9uKHQpe3JldHVybiB6KEwodCksOCwtMSl9LFA9eS5PYmplY3QsQz1EKCIiLnNwbGl0KSxWPWIoKGZ1bmN0aW9uKCl7cmV0dXJuICFQKCJ6IikucHJvcGVydHlJc0VudW1lcmFibGUoMCl9KSk/ZnVuY3Rpb24odCl7cmV0dXJuICJTdHJpbmciPT1BKHQpP0ModCwiIik6UCh0KX06UCxCPXkuVHlwZUVycm9yLFI9ZnVuY3Rpb24odCl7aWYobnVsbD09dCl0aHJvdyBCKCJDYW4ndCBjYWxsIG1ldGhvZCBvbiAiK3QpO3JldHVybiB0fSxGPWZ1bmN0aW9uKHQpe3JldHVybiBWKFIodCkpfSxfPWZ1bmN0aW9uKHQpe3JldHVybiAiZnVuY3Rpb24iPT10eXBlb2YgdH0scT1mdW5jdGlvbih0KXtyZXR1cm4gIm9iamVjdCI9PXR5cGVvZiB0P251bGwhPT10Ol8odCl9LCQ9ZnVuY3Rpb24odCl7cmV0dXJuIF8odCk/dDp2b2lkIDB9LFc9ZnVuY3Rpb24odCxlKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aDwyPyQoeVt0XSk6eVt0XSYmeVt0XVtlXX0sRz1EKHt9LmlzUHJvdG90eXBlT2YpLFU9VygibmF2aWdhdG9yIiwidXNlckFnZW50Iil8fCIiLFg9eS5wcm9jZXNzLFk9eS5EZW5vLEo9WCYmWC52ZXJzaW9uc3x8WSYmWS52ZXJzaW9uLEs9SiYmSi52ODtLJiYoZz0odj1LLnNwbGl0KCIuIikpWzBdPjAmJnZbMF08ND8xOisodlswXSt2WzFdKSksIWcmJlUmJighKHY9VS5tYXRjaCgvRWRnZVwvKFxkKykvKSl8fHZbMV0+PTc0KSYmKHY9VS5tYXRjaCgvQ2hyb21lXC8oXGQrKS8pKSYmKGc9K3ZbMV0pO3ZhciBRPWcsWj0hIU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMmJiFiKChmdW5jdGlvbigpe3ZhciB0PVN5bWJvbCgpO3JldHVybiAhU3RyaW5nKHQpfHwhKE9iamVjdCh0KWluc3RhbmNlb2YgU3ltYm9sKXx8IVN5bWJvbC5zaGFtJiZRJiZRPDQxfSkpLHR0PVomJiFTeW1ib2wuc2hhbSYmInN5bWJvbCI9PXR5cGVvZiBTeW1ib2wuaXRlcmF0b3IsZXQ9eS5PYmplY3QsbnQ9dHQ/ZnVuY3Rpb24odCl7cmV0dXJuICJzeW1ib2wiPT10eXBlb2YgdH06ZnVuY3Rpb24odCl7dmFyIGU9VygiU3ltYm9sIik7cmV0dXJuIF8oZSkmJkcoZS5wcm90b3R5cGUsZXQodCkpfSxydD15LlN0cmluZyxvdD1mdW5jdGlvbih0KXt0cnl7cmV0dXJuIHJ0KHQpfWNhdGNoKHQpe3JldHVybiAiT2JqZWN0In19LGl0PXkuVHlwZUVycm9yLHV0PWZ1bmN0aW9uKHQpe2lmKF8odCkpcmV0dXJuIHQ7dGhyb3cgaXQob3QodCkrIiBpcyBub3QgYSBmdW5jdGlvbiIpfSxhdD1mdW5jdGlvbih0LGUpe3ZhciBuPXRbZV07cmV0dXJuIG51bGw9PW4/dm9pZCAwOnV0KG4pfSxjdD15LlR5cGVFcnJvcixsdD1PYmplY3QuZGVmaW5lUHJvcGVydHksc3Q9ZnVuY3Rpb24odCxlKXt0cnl7bHQoeSx0LHt2YWx1ZTplLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMH0pO31jYXRjaChuKXt5W3RdPWU7fXJldHVybiBlfSxmdD0iX19jb3JlLWpzX3NoYXJlZF9fIixkdD15W2Z0XXx8c3QoZnQse30pLHB0PWgoKGZ1bmN0aW9uKHQpeyh0LmV4cG9ydHM9ZnVuY3Rpb24odCxlKXtyZXR1cm4gZHRbdF18fChkdFt0XT12b2lkIDAhPT1lP2U6e30pfSkoInZlcnNpb25zIixbXSkucHVzaCh7dmVyc2lvbjoiMy4xOS4zIixtb2RlOiJnbG9iYWwiLGNvcHlyaWdodDoiwqkgMjAyMSBEZW5pcyBQdXNoa2FyZXYgKHpsb2lyb2NrLnJ1KSJ9KTt9KSksaHQ9eS5PYmplY3QsdnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGh0KFIodCkpfSxndD1EKHt9Lmhhc093blByb3BlcnR5KSxtdD1PYmplY3QuaGFzT3dufHxmdW5jdGlvbih0LGUpe3JldHVybiBndCh2dCh0KSxlKX0seXQ9MCxidD1NYXRoLnJhbmRvbSgpLHh0PUQoMS4udG9TdHJpbmcpLHd0PWZ1bmN0aW9uKHQpe3JldHVybiAiU3ltYm9sKCIrKHZvaWQgMD09PXQ/IiI6dCkrIilfIit4dCgrK3l0K2J0LDM2KX0sRXQ9cHQoIndrcyIpLFN0PXkuU3ltYm9sLGt0PVN0JiZTdC5mb3IsVHQ9dHQ/U3Q6U3QmJlN0LndpdGhvdXRTZXR0ZXJ8fHd0LE10PWZ1bmN0aW9uKHQpe2lmKCFtdChFdCx0KXx8IVomJiJzdHJpbmciIT10eXBlb2YgRXRbdF0pe3ZhciBlPSJTeW1ib2wuIit0O1omJm10KFN0LHQpP0V0W3RdPVN0W3RdOkV0W3RdPXR0JiZrdD9rdChlKTpUdChlKTt9cmV0dXJuIEV0W3RdfSxJdD15LlR5cGVFcnJvcixOdD1NdCgidG9QcmltaXRpdmUiKSxIdD1mdW5jdGlvbih0LGUpe2lmKCFxKHQpfHxudCh0KSlyZXR1cm4gdDt2YXIgbixyPWF0KHQsTnQpO2lmKHIpe2lmKHZvaWQgMD09PWUmJihlPSJkZWZhdWx0Iiksbj1FKHIsdCxlKSwhcShuKXx8bnQobikpcmV0dXJuIG47dGhyb3cgSXQoIkNhbid0IGNvbnZlcnQgb2JqZWN0IHRvIHByaW1pdGl2ZSB2YWx1ZSIpfXJldHVybiB2b2lkIDA9PT1lJiYoZT0ibnVtYmVyIiksZnVuY3Rpb24odCxlKXt2YXIgbixyO2lmKCJzdHJpbmciPT09ZSYmXyhuPXQudG9TdHJpbmcpJiYhcShyPUUobix0KSkpcmV0dXJuIHI7aWYoXyhuPXQudmFsdWVPZikmJiFxKHI9RShuLHQpKSlyZXR1cm4gcjtpZigic3RyaW5nIiE9PWUmJl8obj10LnRvU3RyaW5nKSYmIXEocj1FKG4sdCkpKXJldHVybiByO3Rocm93IGN0KCJDYW4ndCBjb252ZXJ0IG9iamVjdCB0byBwcmltaXRpdmUgdmFsdWUiKX0odCxlKX0sT3Q9ZnVuY3Rpb24odCl7dmFyIGU9SHQodCwic3RyaW5nIik7cmV0dXJuIG50KGUpP2U6ZSsiIn0sanQ9eS5kb2N1bWVudCxEdD1xKGp0KSYmcShqdC5jcmVhdGVFbGVtZW50KSxMdD1mdW5jdGlvbih0KXtyZXR1cm4gRHQ/anQuY3JlYXRlRWxlbWVudCh0KTp7fX0senQ9IXgmJiFiKChmdW5jdGlvbigpe3JldHVybiA3IT1PYmplY3QuZGVmaW5lUHJvcGVydHkoTHQoImRpdiIpLCJhIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIDd9fSkuYX0pKSxBdD1PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLFB0PXtmOng/QXQ6ZnVuY3Rpb24odCxlKXtpZih0PUYodCksZT1PdChlKSx6dCl0cnl7cmV0dXJuIEF0KHQsZSl9Y2F0Y2godCl7fWlmKG10KHQsZSkpcmV0dXJuIEkoIUUoTS5mLHQsZSksdFtlXSl9fSxDdD15LlN0cmluZyxWdD15LlR5cGVFcnJvcixCdD1mdW5jdGlvbih0KXtpZihxKHQpKXJldHVybiB0O3Rocm93IFZ0KEN0KHQpKyIgaXMgbm90IGFuIG9iamVjdCIpfSxSdD15LlR5cGVFcnJvcixGdD1PYmplY3QuZGVmaW5lUHJvcGVydHksX3Q9e2Y6eD9GdDpmdW5jdGlvbih0LGUsbil7aWYoQnQodCksZT1PdChlKSxCdChuKSx6dCl0cnl7cmV0dXJuIEZ0KHQsZSxuKX1jYXRjaCh0KXt9aWYoImdldCJpbiBufHwic2V0ImluIG4pdGhyb3cgUnQoIkFjY2Vzc29ycyBub3Qgc3VwcG9ydGVkIik7cmV0dXJuICJ2YWx1ZSJpbiBuJiYodFtlXT1uLnZhbHVlKSx0fX0scXQ9eD9mdW5jdGlvbih0LGUsbil7cmV0dXJuIF90LmYodCxlLEkoMSxuKSl9OmZ1bmN0aW9uKHQsZSxuKXtyZXR1cm4gdFtlXT1uLHR9LCR0PUQoRnVuY3Rpb24udG9TdHJpbmcpO18oZHQuaW5zcGVjdFNvdXJjZSl8fChkdC5pbnNwZWN0U291cmNlPWZ1bmN0aW9uKHQpe3JldHVybiAkdCh0KX0pO3ZhciBXdCxHdCxVdCxYdD1kdC5pbnNwZWN0U291cmNlLFl0PXkuV2Vha01hcCxKdD1fKFl0KSYmL25hdGl2ZSBjb2RlLy50ZXN0KFh0KFl0KSksS3Q9cHQoImtleXMiKSxRdD1mdW5jdGlvbih0KXtyZXR1cm4gS3RbdF18fChLdFt0XT13dCh0KSl9LFp0PXt9LHRlPSJPYmplY3QgYWxyZWFkeSBpbml0aWFsaXplZCIsZWU9eS5UeXBlRXJyb3IsbmU9eS5XZWFrTWFwO2lmKEp0fHxkdC5zdGF0ZSl7dmFyIHJlPWR0LnN0YXRlfHwoZHQuc3RhdGU9bmV3IG5lKSxvZT1EKHJlLmdldCksaWU9RChyZS5oYXMpLHVlPUQocmUuc2V0KTtXdD1mdW5jdGlvbih0LGUpe2lmKGllKHJlLHQpKXRocm93IG5ldyBlZSh0ZSk7cmV0dXJuIGUuZmFjYWRlPXQsdWUocmUsdCxlKSxlfSxHdD1mdW5jdGlvbih0KXtyZXR1cm4gb2UocmUsdCl8fHt9fSxVdD1mdW5jdGlvbih0KXtyZXR1cm4gaWUocmUsdCl9O31lbHNlIHt2YXIgYWU9UXQoInN0YXRlIik7WnRbYWVdPSEwLFd0PWZ1bmN0aW9uKHQsZSl7aWYobXQodCxhZSkpdGhyb3cgbmV3IGVlKHRlKTtyZXR1cm4gZS5mYWNhZGU9dCxxdCh0LGFlLGUpLGV9LEd0PWZ1bmN0aW9uKHQpe3JldHVybiBtdCh0LGFlKT90W2FlXTp7fX0sVXQ9ZnVuY3Rpb24odCl7cmV0dXJuIG10KHQsYWUpfTt9dmFyIGNlPXtzZXQ6V3QsZ2V0Okd0LGhhczpVdCxlbmZvcmNlOmZ1bmN0aW9uKHQpe3JldHVybiBVdCh0KT9HdCh0KTpXdCh0LHt9KX0sZ2V0dGVyRm9yOmZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihlKXt2YXIgbjtpZighcShlKXx8KG49R3QoZSkpLnR5cGUhPT10KXRocm93IGVlKCJJbmNvbXBhdGlibGUgcmVjZWl2ZXIsICIrdCsiIHJlcXVpcmVkIik7cmV0dXJuIG59fX0sbGU9RnVuY3Rpb24ucHJvdG90eXBlLHNlPXgmJk9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IsZmU9bXQobGUsIm5hbWUiKSxkZT17RVhJU1RTOmZlLFBST1BFUjpmZSYmInNvbWV0aGluZyI9PT1mdW5jdGlvbigpe30ubmFtZSxDT05GSUdVUkFCTEU6ZmUmJigheHx8eCYmc2UobGUsIm5hbWUiKS5jb25maWd1cmFibGUpfSxwZT1oKChmdW5jdGlvbih0KXt2YXIgZT1kZS5DT05GSUdVUkFCTEUsbj1jZS5nZXQscj1jZS5lbmZvcmNlLG89U3RyaW5nKFN0cmluZykuc3BsaXQoIlN0cmluZyIpOyh0LmV4cG9ydHM9ZnVuY3Rpb24odCxuLGksdSl7dmFyIGEsYz0hIXUmJiEhdS51bnNhZmUsbD0hIXUmJiEhdS5lbnVtZXJhYmxlLHM9ISF1JiYhIXUubm9UYXJnZXRHZXQsZj11JiZ2b2lkIDAhPT11Lm5hbWU/dS5uYW1lOm47XyhpKSYmKCJTeW1ib2woIj09PVN0cmluZyhmKS5zbGljZSgwLDcpJiYoZj0iWyIrU3RyaW5nKGYpLnJlcGxhY2UoL15TeW1ib2xcKChbXildKilcKS8sIiQxIikrIl0iKSwoIW10KGksIm5hbWUiKXx8ZSYmaS5uYW1lIT09ZikmJnF0KGksIm5hbWUiLGYpLChhPXIoaSkpLnNvdXJjZXx8KGEuc291cmNlPW8uam9pbigic3RyaW5nIj09dHlwZW9mIGY/ZjoiIikpKSx0IT09eT8oYz8hcyYmdFtuXSYmKGw9ITApOmRlbGV0ZSB0W25dLGw/dFtuXT1pOnF0KHQsbixpKSk6bD90W25dPWk6c3QobixpKTt9KShGdW5jdGlvbi5wcm90b3R5cGUsInRvU3RyaW5nIiwoZnVuY3Rpb24oKXtyZXR1cm4gXyh0aGlzKSYmbih0aGlzKS5zb3VyY2V8fFh0KHRoaXMpfSkpO30pKSxoZT1NYXRoLmNlaWwsdmU9TWF0aC5mbG9vcixnZT1mdW5jdGlvbih0KXt2YXIgZT0rdDtyZXR1cm4gZSE9ZXx8MD09PWU/MDooZT4wP3ZlOmhlKShlKX0sbWU9TWF0aC5tYXgseWU9TWF0aC5taW4sYmU9ZnVuY3Rpb24odCxlKXt2YXIgbj1nZSh0KTtyZXR1cm4gbjwwP21lKG4rZSwwKTp5ZShuLGUpfSx4ZT1NYXRoLm1pbix3ZT1mdW5jdGlvbih0KXtyZXR1cm4gdD4wP3hlKGdlKHQpLDkwMDcxOTkyNTQ3NDA5OTEpOjB9LEVlPWZ1bmN0aW9uKHQpe3JldHVybiB3ZSh0Lmxlbmd0aCl9LFNlPWZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihlLG4scil7dmFyIG8saT1GKGUpLHU9RWUoaSksYT1iZShyLHUpO2lmKHQmJm4hPW4pe2Zvcig7dT5hOylpZigobz1pW2ErK10pIT1vKXJldHVybiAhMH1lbHNlIGZvcig7dT5hO2ErKylpZigodHx8YSBpbiBpKSYmaVthXT09PW4pcmV0dXJuIHR8fGF8fDA7cmV0dXJuICF0JiYtMX19LGtlPXtpbmNsdWRlczpTZSghMCksaW5kZXhPZjpTZSghMSl9LFRlPWtlLmluZGV4T2YsTWU9RChbXS5wdXNoKSxJZT1mdW5jdGlvbih0LGUpe3ZhciBuLHI9Rih0KSxvPTAsaT1bXTtmb3IobiBpbiByKSFtdChadCxuKSYmbXQocixuKSYmTWUoaSxuKTtmb3IoO2UubGVuZ3RoPm87KW10KHIsbj1lW28rK10pJiYoflRlKGksbil8fE1lKGksbikpO3JldHVybiBpfSxOZT1bImNvbnN0cnVjdG9yIiwiaGFzT3duUHJvcGVydHkiLCJpc1Byb3RvdHlwZU9mIiwicHJvcGVydHlJc0VudW1lcmFibGUiLCJ0b0xvY2FsZVN0cmluZyIsInRvU3RyaW5nIiwidmFsdWVPZiJdLEhlPU5lLmNvbmNhdCgibGVuZ3RoIiwicHJvdG90eXBlIiksT2U9e2Y6T2JqZWN0LmdldE93blByb3BlcnR5TmFtZXN8fGZ1bmN0aW9uKHQpe3JldHVybiBJZSh0LEhlKX19LGplPXtmOk9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHN9LERlPUQoW10uY29uY2F0KSxMZT1XKCJSZWZsZWN0Iiwib3duS2V5cyIpfHxmdW5jdGlvbih0KXt2YXIgZT1PZS5mKEJ0KHQpKSxuPWplLmY7cmV0dXJuIG4/RGUoZSxuKHQpKTplfSx6ZT1mdW5jdGlvbih0LGUpe2Zvcih2YXIgbj1MZShlKSxyPV90LmYsbz1QdC5mLGk9MDtpPG4ubGVuZ3RoO2krKyl7dmFyIHU9bltpXTttdCh0LHUpfHxyKHQsdSxvKGUsdSkpO319LEFlPS8jfFwucHJvdG90eXBlXC4vLFBlPWZ1bmN0aW9uKHQsZSl7dmFyIG49VmVbQ2UodCldO3JldHVybiBuPT1SZXx8biE9QmUmJihfKGUpP2IoZSk6ISFlKX0sQ2U9UGUubm9ybWFsaXplPWZ1bmN0aW9uKHQpe3JldHVybiBTdHJpbmcodCkucmVwbGFjZShBZSwiLiIpLnRvTG93ZXJDYXNlKCl9LFZlPVBlLmRhdGE9e30sQmU9UGUuTkFUSVZFPSJOIixSZT1QZS5QT0xZRklMTD0iUCIsRmU9UGUsX2U9UHQuZixxZT1mdW5jdGlvbih0LGUpe3ZhciBuLHIsbyxpLHUsYT10LnRhcmdldCxjPXQuZ2xvYmFsLGw9dC5zdGF0O2lmKG49Yz95Omw/eVthXXx8c3QoYSx7fSk6KHlbYV18fHt9KS5wcm90b3R5cGUpZm9yKHIgaW4gZSl7aWYoaT1lW3JdLG89dC5ub1RhcmdldEdldD8odT1fZShuLHIpKSYmdS52YWx1ZTpuW3JdLCFGZShjP3I6YSsobD8iLiI6IiMiKStyLHQuZm9yY2VkKSYmdm9pZCAwIT09byl7aWYodHlwZW9mIGk9PXR5cGVvZiBvKWNvbnRpbnVlO3plKGksbyk7fSh0LnNoYW18fG8mJm8uc2hhbSkmJnF0KGksInNoYW0iLCEwKSxwZShuLHIsaSx0KTt9fSwkZT1EKEQuYmluZCksV2U9QXJyYXkuaXNBcnJheXx8ZnVuY3Rpb24odCl7cmV0dXJuICJBcnJheSI9PUEodCl9LEdlPXt9O0dlW010KCJ0b1N0cmluZ1RhZyIpXT0ieiI7dmFyIFVlPSJbb2JqZWN0IHpdIj09PVN0cmluZyhHZSksWGU9TXQoInRvU3RyaW5nVGFnIiksWWU9eS5PYmplY3QsSmU9IkFyZ3VtZW50cyI9PUEoZnVuY3Rpb24oKXtyZXR1cm4gYXJndW1lbnRzfSgpKSxLZT1VZT9BOmZ1bmN0aW9uKHQpe3ZhciBlLG4scjtyZXR1cm4gdm9pZCAwPT09dD8iVW5kZWZpbmVkIjpudWxsPT09dD8iTnVsbCI6InN0cmluZyI9PXR5cGVvZihuPWZ1bmN0aW9uKHQsZSl7dHJ5e3JldHVybiB0W2VdfWNhdGNoKHQpe319KGU9WWUodCksWGUpKT9uOkplP0EoZSk6Ik9iamVjdCI9PShyPUEoZSkpJiZfKGUuY2FsbGVlKT8iQXJndW1lbnRzIjpyfSxRZT1mdW5jdGlvbigpe30sWmU9W10sdG49VygiUmVmbGVjdCIsImNvbnN0cnVjdCIpLGVuPS9eXHMqKD86Y2xhc3N8ZnVuY3Rpb24pXGIvLG5uPUQoZW4uZXhlYykscm49IWVuLmV4ZWMoUWUpLG9uPWZ1bmN0aW9uKHQpe2lmKCFfKHQpKXJldHVybiAhMTt0cnl7cmV0dXJuIHRuKFFlLFplLHQpLCEwfWNhdGNoKHQpe3JldHVybiAhMX19LHVuPSF0bnx8YigoZnVuY3Rpb24oKXt2YXIgdDtyZXR1cm4gb24ob24uY2FsbCl8fCFvbihPYmplY3QpfHwhb24oKGZ1bmN0aW9uKCl7dD0hMDt9KSl8fHR9KSk/ZnVuY3Rpb24odCl7aWYoIV8odCkpcmV0dXJuICExO3N3aXRjaChLZSh0KSl7Y2FzZSJBc3luY0Z1bmN0aW9uIjpjYXNlIkdlbmVyYXRvckZ1bmN0aW9uIjpjYXNlIkFzeW5jR2VuZXJhdG9yRnVuY3Rpb24iOnJldHVybiAhMX1yZXR1cm4gcm58fCEhbm4oZW4sWHQodCkpfTpvbixhbj1NdCgic3BlY2llcyIpLGNuPXkuQXJyYXksbG49ZnVuY3Rpb24odCxlKXtyZXR1cm4gbmV3KGZ1bmN0aW9uKHQpe3ZhciBlO3JldHVybiBXZSh0KSYmKGU9dC5jb25zdHJ1Y3RvciwodW4oZSkmJihlPT09Y258fFdlKGUucHJvdG90eXBlKSl8fHEoZSkmJm51bGw9PT0oZT1lW2FuXSkpJiYoZT12b2lkIDApKSx2b2lkIDA9PT1lP2NuOmV9KHQpKSgwPT09ZT8wOmUpfSxzbj1EKFtdLnB1c2gpLGZuPWZ1bmN0aW9uKHQpe3ZhciBlPTE9PXQsbj0yPT10LHI9Mz09dCxvPTQ9PXQsaT02PT10LHU9Nz09dCxhPTU9PXR8fGk7cmV0dXJuIGZ1bmN0aW9uKGMsbCxzLGYpe2Zvcih2YXIgZCxwLGg9dnQoYyksdj1WKGgpLGc9ZnVuY3Rpb24odCxlKXtyZXR1cm4gdXQodCksdm9pZCAwPT09ZT90OiRlPyRlKHQsZSk6ZnVuY3Rpb24oKXtyZXR1cm4gdC5hcHBseShlLGFyZ3VtZW50cyl9fShsLHMpLG09RWUodikseT0wLGI9Znx8bG4seD1lP2IoYyxtKTpufHx1P2IoYywwKTp2b2lkIDA7bT55O3krKylpZigoYXx8eSBpbiB2KSYmKHA9ZyhkPXZbeV0seSxoKSx0KSlpZihlKXhbeV09cDtlbHNlIGlmKHApc3dpdGNoKHQpe2Nhc2UgMzpyZXR1cm4gITA7Y2FzZSA1OnJldHVybiBkO2Nhc2UgNjpyZXR1cm4geTtjYXNlIDI6c24oeCxkKTt9ZWxzZSBzd2l0Y2godCl7Y2FzZSA0OnJldHVybiAhMTtjYXNlIDc6c24oeCxkKTt9cmV0dXJuIGk/LTE6cnx8bz9vOnh9fSxkbj17Zm9yRWFjaDpmbigwKSxtYXA6Zm4oMSksZmlsdGVyOmZuKDIpLHNvbWU6Zm4oMyksZXZlcnk6Zm4oNCksZmluZDpmbig1KSxmaW5kSW5kZXg6Zm4oNiksZmlsdGVyUmVqZWN0OmZuKDcpfSxwbj1NdCgic3BlY2llcyIpLGhuPWZ1bmN0aW9uKHQpe3JldHVybiBRPj01MXx8IWIoKGZ1bmN0aW9uKCl7dmFyIGU9W107cmV0dXJuIChlLmNvbnN0cnVjdG9yPXt9KVtwbl09ZnVuY3Rpb24oKXtyZXR1cm4ge2ZvbzoxfX0sMSE9PWVbdF0oQm9vbGVhbikuZm9vfSkpfSx2bj1kbi5maWx0ZXI7cWUoe3RhcmdldDoiQXJyYXkiLHByb3RvOiEwLGZvcmNlZDohaG4oImZpbHRlciIpfSx7ZmlsdGVyOmZ1bmN0aW9uKHQpe3JldHVybiB2bih0aGlzLHQsYXJndW1lbnRzLmxlbmd0aD4xP2FyZ3VtZW50c1sxXTp2b2lkIDApfX0pO3ZhciBnbj1VZT97fS50b1N0cmluZzpmdW5jdGlvbigpe3JldHVybiAiW29iamVjdCAiK0tlKHRoaXMpKyJdIn07VWV8fHBlKE9iamVjdC5wcm90b3R5cGUsInRvU3RyaW5nIixnbix7dW5zYWZlOiEwfSk7dmFyIG1uLHluPXkuU3RyaW5nLGJuPWZ1bmN0aW9uKHQpe2lmKCJTeW1ib2wiPT09S2UodCkpdGhyb3cgVHlwZUVycm9yKCJDYW5ub3QgY29udmVydCBhIFN5bWJvbCB2YWx1ZSB0byBhIHN0cmluZyIpO3JldHVybiB5bih0KX0seG49ZnVuY3Rpb24oKXt2YXIgdD1CdCh0aGlzKSxlPSIiO3JldHVybiB0Lmdsb2JhbCYmKGUrPSJnIiksdC5pZ25vcmVDYXNlJiYoZSs9ImkiKSx0Lm11bHRpbGluZSYmKGUrPSJtIiksdC5kb3RBbGwmJihlKz0icyIpLHQudW5pY29kZSYmKGUrPSJ1IiksdC5zdGlja3kmJihlKz0ieSIpLGV9LHduPXkuUmVnRXhwLEVuPWIoKGZ1bmN0aW9uKCl7dmFyIHQ9d24oImEiLCJ5Iik7cmV0dXJuIHQubGFzdEluZGV4PTIsbnVsbCE9dC5leGVjKCJhYmNkIil9KSksU249RW58fGIoKGZ1bmN0aW9uKCl7cmV0dXJuICF3bigiYSIsInkiKS5zdGlja3l9KSksa249e0JST0tFTl9DQVJFVDpFbnx8YigoZnVuY3Rpb24oKXt2YXIgdD13bigiXnIiLCJneSIpO3JldHVybiB0Lmxhc3RJbmRleD0yLG51bGwhPXQuZXhlYygic3RyIil9KSksTUlTU0VEX1NUSUNLWTpTbixVTlNVUFBPUlRFRF9ZOkVufSxUbj1PYmplY3Qua2V5c3x8ZnVuY3Rpb24odCl7cmV0dXJuIEllKHQsTmUpfSxNbj14P09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzOmZ1bmN0aW9uKHQsZSl7QnQodCk7Zm9yKHZhciBuLHI9RihlKSxvPVRuKGUpLGk9by5sZW5ndGgsdT0wO2k+dTspX3QuZih0LG49b1t1KytdLHJbbl0pO3JldHVybiB0fSxJbj1XKCJkb2N1bWVudCIsImRvY3VtZW50RWxlbWVudCIpLE5uPVF0KCJJRV9QUk9UTyIpLEhuPWZ1bmN0aW9uKCl7fSxPbj1mdW5jdGlvbih0KXtyZXR1cm4gIjxzY3JpcHQ+Iit0KyI8LyIrInNjcmlwdD4ifSxqbj1mdW5jdGlvbih0KXt0LndyaXRlKE9uKCIiKSksdC5jbG9zZSgpO3ZhciBlPXQucGFyZW50V2luZG93Lk9iamVjdDtyZXR1cm4gdD1udWxsLGV9LERuPWZ1bmN0aW9uKCl7dHJ5e21uPW5ldyBBY3RpdmVYT2JqZWN0KCJodG1sZmlsZSIpO31jYXRjaCh0KXt9dmFyIHQsZTtEbj0idW5kZWZpbmVkIiE9dHlwZW9mIGRvY3VtZW50P2RvY3VtZW50LmRvbWFpbiYmbW4/am4obW4pOigoZT1MdCgiaWZyYW1lIikpLnN0eWxlLmRpc3BsYXk9Im5vbmUiLEluLmFwcGVuZENoaWxkKGUpLGUuc3JjPVN0cmluZygiamF2YXNjcmlwdDoiKSwodD1lLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQpLm9wZW4oKSx0LndyaXRlKE9uKCJkb2N1bWVudC5GPU9iamVjdCIpKSx0LmNsb3NlKCksdC5GKTpqbihtbik7Zm9yKHZhciBuPU5lLmxlbmd0aDtuLS07KWRlbGV0ZSBEbi5wcm90b3R5cGVbTmVbbl1dO3JldHVybiBEbigpfTtadFtObl09ITA7dmFyIExuLHpuLEFuPU9iamVjdC5jcmVhdGV8fGZ1bmN0aW9uKHQsZSl7dmFyIG47cmV0dXJuIG51bGwhPT10PyhIbi5wcm90b3R5cGU9QnQodCksbj1uZXcgSG4sSG4ucHJvdG90eXBlPW51bGwsbltObl09dCk6bj1EbigpLHZvaWQgMD09PWU/bjpNbihuLGUpfSxQbj15LlJlZ0V4cCxDbj1iKChmdW5jdGlvbigpe3ZhciB0PVBuKCIuIiwicyIpO3JldHVybiAhKHQuZG90QWxsJiZ0LmV4ZWMoIlxuIikmJiJzIj09PXQuZmxhZ3MpfSkpLFZuPXkuUmVnRXhwLEJuPWIoKGZ1bmN0aW9uKCl7dmFyIHQ9Vm4oIig/PGE+YikiLCJnIik7cmV0dXJuICJiIiE9PXQuZXhlYygiYiIpLmdyb3Vwcy5hfHwiYmMiIT09ImIiLnJlcGxhY2UodCwiJDxhPmMiKX0pKSxSbj1jZS5nZXQsRm49cHQoIm5hdGl2ZS1zdHJpbmctcmVwbGFjZSIsU3RyaW5nLnByb3RvdHlwZS5yZXBsYWNlKSxfbj1SZWdFeHAucHJvdG90eXBlLmV4ZWMscW49X24sJG49RCgiIi5jaGFyQXQpLFduPUQoIiIuaW5kZXhPZiksR249RCgiIi5yZXBsYWNlKSxVbj1EKCIiLnNsaWNlKSxYbj0oem49L2IqL2csRShfbixMbj0vYS8sImEiKSxFKF9uLHpuLCJhIiksMCE9PUxuLmxhc3RJbmRleHx8MCE9PXpuLmxhc3RJbmRleCksWW49a24uQlJPS0VOX0NBUkVULEpuPXZvaWQgMCE9PS8oKT8/Ly5leGVjKCIiKVsxXTsoWG58fEpufHxZbnx8Q258fEJuKSYmKHFuPWZ1bmN0aW9uKHQpe3ZhciBlLG4scixvLGksdSxhLGM9dGhpcyxsPVJuKGMpLHM9Ym4odCksZj1sLnJhdztpZihmKXJldHVybiBmLmxhc3RJbmRleD1jLmxhc3RJbmRleCxlPUUocW4sZixzKSxjLmxhc3RJbmRleD1mLmxhc3RJbmRleCxlO3ZhciBkPWwuZ3JvdXBzLHA9WW4mJmMuc3RpY2t5LGg9RSh4bixjKSx2PWMuc291cmNlLGc9MCxtPXM7aWYocCYmKGg9R24oaCwieSIsIiIpLC0xPT09V24oaCwiZyIpJiYoaCs9ImciKSxtPVVuKHMsYy5sYXN0SW5kZXgpLGMubGFzdEluZGV4PjAmJighYy5tdWx0aWxpbmV8fGMubXVsdGlsaW5lJiYiXG4iIT09JG4ocyxjLmxhc3RJbmRleC0xKSkmJih2PSIoPzogIit2KyIpIixtPSIgIittLGcrKyksbj1uZXcgUmVnRXhwKCJeKD86Iit2KyIpIixoKSksSm4mJihuPW5ldyBSZWdFeHAoIl4iK3YrIiQoPyFcXHMpIixoKSksWG4mJihyPWMubGFzdEluZGV4KSxvPUUoX24scD9uOmMsbSkscD9vPyhvLmlucHV0PVVuKG8uaW5wdXQsZyksb1swXT1VbihvWzBdLGcpLG8uaW5kZXg9Yy5sYXN0SW5kZXgsYy5sYXN0SW5kZXgrPW9bMF0ubGVuZ3RoKTpjLmxhc3RJbmRleD0wOlhuJiZvJiYoYy5sYXN0SW5kZXg9Yy5nbG9iYWw/by5pbmRleCtvWzBdLmxlbmd0aDpyKSxKbiYmbyYmby5sZW5ndGg+MSYmRShGbixvWzBdLG4sKGZ1bmN0aW9uKCl7Zm9yKGk9MTtpPGFyZ3VtZW50cy5sZW5ndGgtMjtpKyspdm9pZCAwPT09YXJndW1lbnRzW2ldJiYob1tpXT12b2lkIDApO30pKSxvJiZkKWZvcihvLmdyb3Vwcz11PUFuKG51bGwpLGk9MDtpPGQubGVuZ3RoO2krKyl1WyhhPWRbaV0pWzBdXT1vW2FbMV1dO3JldHVybiBvfSk7dmFyIEtuPXFuO3FlKHt0YXJnZXQ6IlJlZ0V4cCIscHJvdG86ITAsZm9yY2VkOi8uLy5leGVjIT09S259LHtleGVjOktufSk7dmFyIFFuPUZ1bmN0aW9uLnByb3RvdHlwZSxabj1Rbi5hcHBseSx0cj1Rbi5iaW5kLGVyPVFuLmNhbGwsbnI9Im9iamVjdCI9PXR5cGVvZiBSZWZsZWN0JiZSZWZsZWN0LmFwcGx5fHwodHI/ZXIuYmluZChabik6ZnVuY3Rpb24oKXtyZXR1cm4gZXIuYXBwbHkoWm4sYXJndW1lbnRzKX0pLHJyPU10KCJzcGVjaWVzIiksb3I9UmVnRXhwLnByb3RvdHlwZSxpcj1mdW5jdGlvbih0LGUsbixyKXt2YXIgbz1NdCh0KSxpPSFiKChmdW5jdGlvbigpe3ZhciBlPXt9O3JldHVybiBlW29dPWZ1bmN0aW9uKCl7cmV0dXJuIDd9LDchPSIiW3RdKGUpfSkpLHU9aSYmIWIoKGZ1bmN0aW9uKCl7dmFyIGU9ITEsbj0vYS87cmV0dXJuICJzcGxpdCI9PT10JiYoKG49e30pLmNvbnN0cnVjdG9yPXt9LG4uY29uc3RydWN0b3JbcnJdPWZ1bmN0aW9uKCl7cmV0dXJuIG59LG4uZmxhZ3M9IiIsbltvXT0vLi9bb10pLG4uZXhlYz1mdW5jdGlvbigpe3JldHVybiBlPSEwLG51bGx9LG5bb10oIiIpLCFlfSkpO2lmKCFpfHwhdXx8bil7dmFyIGE9RCgvLi9bb10pLGM9ZShvLCIiW3RdLChmdW5jdGlvbih0LGUsbixyLG8pe3ZhciB1PUQodCksYz1lLmV4ZWM7cmV0dXJuIGM9PT1Lbnx8Yz09PW9yLmV4ZWM/aSYmIW8/e2RvbmU6ITAsdmFsdWU6YShlLG4scil9Ontkb25lOiEwLHZhbHVlOnUobixlLHIpfTp7ZG9uZTohMX19KSk7cGUoU3RyaW5nLnByb3RvdHlwZSx0LGNbMF0pLHBlKG9yLG8sY1sxXSk7fXImJnF0KG9yW29dLCJzaGFtIiwhMCk7fSx1cj1EKCIiLmNoYXJBdCksYXI9RCgiIi5jaGFyQ29kZUF0KSxjcj1EKCIiLnNsaWNlKSxscj1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSxuKXt2YXIgcixvLGk9Ym4oUihlKSksdT1nZShuKSxhPWkubGVuZ3RoO3JldHVybiB1PDB8fHU+PWE/dD8iIjp2b2lkIDA6KHI9YXIoaSx1KSk8NTUyOTZ8fHI+NTYzMTl8fHUrMT09PWF8fChvPWFyKGksdSsxKSk8NTYzMjB8fG8+NTczNDM/dD91cihpLHUpOnI6dD9jcihpLHUsdSsyKTpvLTU2MzIwKyhyLTU1Mjk2PDwxMCkrNjU1MzZ9fSxzcj17Y29kZUF0OmxyKCExKSxjaGFyQXQ6bHIoITApfS5jaGFyQXQsZnI9ZnVuY3Rpb24odCxlLG4pe3JldHVybiBlKyhuP3NyKHQsZSkubGVuZ3RoOjEpfSxkcj1NYXRoLmZsb29yLHByPUQoIiIuY2hhckF0KSxocj1EKCIiLnJlcGxhY2UpLHZyPUQoIiIuc2xpY2UpLGdyPS9cJChbJCYnYF18XGR7MSwyfXw8W14+XSo+KS9nLG1yPS9cJChbJCYnYF18XGR7MSwyfSkvZyx5cj1mdW5jdGlvbih0LGUsbixyLG8saSl7dmFyIHU9bit0Lmxlbmd0aCxhPXIubGVuZ3RoLGM9bXI7cmV0dXJuIHZvaWQgMCE9PW8mJihvPXZ0KG8pLGM9Z3IpLGhyKGksYywoZnVuY3Rpb24oaSxjKXt2YXIgbDtzd2l0Y2gocHIoYywwKSl7Y2FzZSIkIjpyZXR1cm4gIiQiO2Nhc2UiJiI6cmV0dXJuIHQ7Y2FzZSJgIjpyZXR1cm4gdnIoZSwwLG4pO2Nhc2UiJyI6cmV0dXJuIHZyKGUsdSk7Y2FzZSI8IjpsPW9bdnIoYywxLC0xKV07YnJlYWs7ZGVmYXVsdDp2YXIgcz0rYztpZigwPT09cylyZXR1cm4gaTtpZihzPmEpe3ZhciBmPWRyKHMvMTApO3JldHVybiAwPT09Zj9pOmY8PWE/dm9pZCAwPT09cltmLTFdP3ByKGMsMSk6cltmLTFdK3ByKGMsMSk6aX1sPXJbcy0xXTt9cmV0dXJuIHZvaWQgMD09PWw/IiI6bH0pKX0sYnI9eS5UeXBlRXJyb3IseHI9ZnVuY3Rpb24odCxlKXt2YXIgbj10LmV4ZWM7aWYoXyhuKSl7dmFyIHI9RShuLHQsZSk7cmV0dXJuIG51bGwhPT1yJiZCdChyKSxyfWlmKCJSZWdFeHAiPT09QSh0KSlyZXR1cm4gRShLbix0LGUpO3Rocm93IGJyKCJSZWdFeHAjZXhlYyBjYWxsZWQgb24gaW5jb21wYXRpYmxlIHJlY2VpdmVyIil9LHdyPU10KCJyZXBsYWNlIiksRXI9TWF0aC5tYXgsU3I9TWF0aC5taW4sa3I9RChbXS5jb25jYXQpLFRyPUQoW10ucHVzaCksTXI9RCgiIi5pbmRleE9mKSxJcj1EKCIiLnNsaWNlKSxOcj0iJDAiPT09ImEiLnJlcGxhY2UoLy4vLCIkMCIpLEhyPSEhLy4vW3dyXSYmIiI9PT0vLi9bd3JdKCJhIiwiJDAiKTtpcigicmVwbGFjZSIsKGZ1bmN0aW9uKHQsZSxuKXt2YXIgcj1Icj8iJCI6IiQwIjtyZXR1cm4gW2Z1bmN0aW9uKHQsbil7dmFyIHI9Uih0aGlzKSxvPW51bGw9PXQ/dm9pZCAwOmF0KHQsd3IpO3JldHVybiBvP0Uobyx0LHIsbik6RShlLGJuKHIpLHQsbil9LGZ1bmN0aW9uKHQsbyl7dmFyIGk9QnQodGhpcyksdT1ibih0KTtpZigic3RyaW5nIj09dHlwZW9mIG8mJi0xPT09TXIobyxyKSYmLTE9PT1NcihvLCIkPCIpKXt2YXIgYT1uKGUsaSx1LG8pO2lmKGEuZG9uZSlyZXR1cm4gYS52YWx1ZX12YXIgYz1fKG8pO2N8fChvPWJuKG8pKTt2YXIgbD1pLmdsb2JhbDtpZihsKXt2YXIgcz1pLnVuaWNvZGU7aS5sYXN0SW5kZXg9MDt9Zm9yKHZhciBmPVtdOzspe3ZhciBkPXhyKGksdSk7aWYobnVsbD09PWQpYnJlYWs7aWYoVHIoZixkKSwhbClicmVhazsiIj09PWJuKGRbMF0pJiYoaS5sYXN0SW5kZXg9ZnIodSx3ZShpLmxhc3RJbmRleCkscykpO31mb3IodmFyIHAsaD0iIix2PTAsZz0wO2c8Zi5sZW5ndGg7ZysrKXtmb3IodmFyIG09Ym4oKGQ9ZltnXSlbMF0pLHk9RXIoU3IoZ2UoZC5pbmRleCksdS5sZW5ndGgpLDApLGI9W10seD0xO3g8ZC5sZW5ndGg7eCsrKVRyKGIsdm9pZCAwPT09KHA9ZFt4XSk/cDpTdHJpbmcocCkpO3ZhciB3PWQuZ3JvdXBzO2lmKGMpe3ZhciBFPWtyKFttXSxiLHksdSk7dm9pZCAwIT09dyYmVHIoRSx3KTt2YXIgUz1ibihucihvLHZvaWQgMCxFKSk7fWVsc2UgUz15cihtLHUseSxiLHcsbyk7eT49diYmKGgrPUlyKHUsdix5KStTLHY9eSttLmxlbmd0aCk7fXJldHVybiBoK0lyKHUsdil9XX0pLCEhYigoZnVuY3Rpb24oKXt2YXIgdD0vLi87cmV0dXJuIHQuZXhlYz1mdW5jdGlvbigpe3ZhciB0PVtdO3JldHVybiB0Lmdyb3Vwcz17YToiNyJ9LHR9LCI3IiE9PSIiLnJlcGxhY2UodCwiJDxhPiIpfSkpfHwhTnJ8fEhyKTt2YXIgT3I9TXQoInVuc2NvcGFibGVzIiksanI9QXJyYXkucHJvdG90eXBlO251bGw9PWpyW09yXSYmX3QuZihqcixPcix7Y29uZmlndXJhYmxlOiEwLHZhbHVlOkFuKG51bGwpfSk7dmFyIERyPWZ1bmN0aW9uKHQpe2pyW09yXVt0XT0hMDt9LExyPWRuLmZpbmQsenI9ImZpbmQiLEFyPSEwO3pyIGluW10mJkFycmF5KDEpLmZpbmQoKGZ1bmN0aW9uKCl7QXI9ITE7fSkpLHFlKHt0YXJnZXQ6IkFycmF5Iixwcm90bzohMCxmb3JjZWQ6QXJ9LHtmaW5kOmZ1bmN0aW9uKHQpe3JldHVybiBMcih0aGlzLHQsYXJndW1lbnRzLmxlbmd0aD4xP2FyZ3VtZW50c1sxXTp2b2lkIDApfX0pLERyKHpyKTt2YXIgUHI9TXQoIm1hdGNoIiksQ3I9ZnVuY3Rpb24odCl7dmFyIGU7cmV0dXJuIHEodCkmJih2b2lkIDAhPT0oZT10W1ByXSk/ISFlOiJSZWdFeHAiPT1BKHQpKX0sVnI9eS5UeXBlRXJyb3IsQnI9TXQoInNwZWNpZXMiKSxScj1mdW5jdGlvbih0LGUpe3ZhciBuLHI9QnQodCkuY29uc3RydWN0b3I7cmV0dXJuIHZvaWQgMD09PXJ8fG51bGw9PShuPUJ0KHIpW0JyXSk/ZTpmdW5jdGlvbih0KXtpZih1bih0KSlyZXR1cm4gdDt0aHJvdyBWcihvdCh0KSsiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIil9KG4pfSxGcj1mdW5jdGlvbih0LGUsbil7dmFyIHI9T3QoZSk7ciBpbiB0P190LmYodCxyLEkoMCxuKSk6dFtyXT1uO30sX3I9eS5BcnJheSxxcj1NYXRoLm1heCwkcj1mdW5jdGlvbih0LGUsbil7Zm9yKHZhciByPUVlKHQpLG89YmUoZSxyKSxpPWJlKHZvaWQgMD09PW4/cjpuLHIpLHU9X3IocXIoaS1vLDApKSxhPTA7bzxpO28rKyxhKyspRnIodSxhLHRbb10pO3JldHVybiB1Lmxlbmd0aD1hLHV9LFdyPWtuLlVOU1VQUE9SVEVEX1ksR3I9NDI5NDk2NzI5NSxVcj1NYXRoLm1pbixYcj1bXS5wdXNoLFlyPUQoLy4vLmV4ZWMpLEpyPUQoWHIpLEtyPUQoIiIuc2xpY2UpLFFyPSFiKChmdW5jdGlvbigpe3ZhciB0PS8oPzopLyxlPXQuZXhlYzt0LmV4ZWM9ZnVuY3Rpb24oKXtyZXR1cm4gZS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9O3ZhciBuPSJhYiIuc3BsaXQodCk7cmV0dXJuIDIhPT1uLmxlbmd0aHx8ImEiIT09blswXXx8ImIiIT09blsxXX0pKTtpcigic3BsaXQiLChmdW5jdGlvbih0LGUsbil7dmFyIHI7cmV0dXJuIHI9ImMiPT0iYWJiYyIuc3BsaXQoLyhiKSovKVsxXXx8NCE9InRlc3QiLnNwbGl0KC8oPzopLywtMSkubGVuZ3RofHwyIT0iYWIiLnNwbGl0KC8oPzphYikqLykubGVuZ3RofHw0IT0iLiIuc3BsaXQoLyguPykoLj8pLykubGVuZ3RofHwiLiIuc3BsaXQoLygpKCkvKS5sZW5ndGg+MXx8IiIuc3BsaXQoLy4/LykubGVuZ3RoP2Z1bmN0aW9uKHQsbil7dmFyIHI9Ym4oUih0aGlzKSksbz12b2lkIDA9PT1uP0dyOm4+Pj4wO2lmKDA9PT1vKXJldHVybiBbXTtpZih2b2lkIDA9PT10KXJldHVybiBbcl07aWYoIUNyKHQpKXJldHVybiBFKGUscix0LG8pO2Zvcih2YXIgaSx1LGEsYz1bXSxsPSh0Lmlnbm9yZUNhc2U/ImkiOiIiKSsodC5tdWx0aWxpbmU/Im0iOiIiKSsodC51bmljb2RlPyJ1IjoiIikrKHQuc3RpY2t5PyJ5IjoiIikscz0wLGY9bmV3IFJlZ0V4cCh0LnNvdXJjZSxsKyJnIik7KGk9RShLbixmLHIpKSYmISgodT1mLmxhc3RJbmRleCk+cyYmKEpyKGMsS3IocixzLGkuaW5kZXgpKSxpLmxlbmd0aD4xJiZpLmluZGV4PHIubGVuZ3RoJiZucihYcixjLCRyKGksMSkpLGE9aVswXS5sZW5ndGgscz11LGMubGVuZ3RoPj1vKSk7KWYubGFzdEluZGV4PT09aS5pbmRleCYmZi5sYXN0SW5kZXgrKztyZXR1cm4gcz09PXIubGVuZ3RoPyFhJiZZcihmLCIiKXx8SnIoYywiIik6SnIoYyxLcihyLHMpKSxjLmxlbmd0aD5vPyRyKGMsMCxvKTpjfToiMCIuc3BsaXQodm9pZCAwLDApLmxlbmd0aD9mdW5jdGlvbih0LG4pe3JldHVybiB2b2lkIDA9PT10JiYwPT09bj9bXTpFKGUsdGhpcyx0LG4pfTplLFtmdW5jdGlvbihlLG4pe3ZhciBvPVIodGhpcyksaT1udWxsPT1lP3ZvaWQgMDphdChlLHQpO3JldHVybiBpP0UoaSxlLG8sbik6RShyLGJuKG8pLGUsbil9LGZ1bmN0aW9uKHQsbyl7dmFyIGk9QnQodGhpcyksdT1ibih0KSxhPW4ocixpLHUsbyxyIT09ZSk7aWYoYS5kb25lKXJldHVybiBhLnZhbHVlO3ZhciBjPVJyKGksUmVnRXhwKSxsPWkudW5pY29kZSxzPShpLmlnbm9yZUNhc2U/ImkiOiIiKSsoaS5tdWx0aWxpbmU/Im0iOiIiKSsoaS51bmljb2RlPyJ1IjoiIikrKFdyPyJnIjoieSIpLGY9bmV3IGMoV3I/Il4oPzoiK2kuc291cmNlKyIpIjppLHMpLGQ9dm9pZCAwPT09bz9HcjpvPj4+MDtpZigwPT09ZClyZXR1cm4gW107aWYoMD09PXUubGVuZ3RoKXJldHVybiBudWxsPT09eHIoZix1KT9bdV06W107Zm9yKHZhciBwPTAsaD0wLHY9W107aDx1Lmxlbmd0aDspe2YubGFzdEluZGV4PVdyPzA6aDt2YXIgZyxtPXhyKGYsV3I/S3IodSxoKTp1KTtpZihudWxsPT09bXx8KGc9VXIod2UoZi5sYXN0SW5kZXgrKFdyP2g6MCkpLHUubGVuZ3RoKSk9PT1wKWg9ZnIodSxoLGwpO2Vsc2Uge2lmKEpyKHYsS3IodSxwLGgpKSx2Lmxlbmd0aD09PWQpcmV0dXJuIHY7Zm9yKHZhciB5PTE7eTw9bS5sZW5ndGgtMTt5KyspaWYoSnIodixtW3ldKSx2Lmxlbmd0aD09PWQpcmV0dXJuIHY7aD1wPWc7fX1yZXR1cm4gSnIodixLcih1LHApKSx2fV19KSwhUXIsV3IpO3ZhciBacix0bz0iXHRcblx2XGZcciDCoOGagOKAgOKAgeKAguKAg+KAhOKAheKAhuKAh+KAiOKAieKAiuKAr+KBn+OAgFx1MjAyOFx1MjAyOVx1ZmVmZiIsZW89RCgiIi5yZXBsYWNlKSxubz0iWyIrdG8rIl0iLHJvPVJlZ0V4cCgiXiIrbm8rbm8rIioiKSxvbz1SZWdFeHAobm8rbm8rIiokIiksaW89ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGUpe3ZhciBuPWJuKFIoZSkpO3JldHVybiAxJnQmJihuPWVvKG4scm8sIiIpKSwyJnQmJihuPWVvKG4sb28sIiIpKSxufX0sdW89e3N0YXJ0OmlvKDEpLGVuZDppbygyKSx0cmltOmlvKDMpfSxhbz1kZS5QUk9QRVIsY289dW8udHJpbTtmdW5jdGlvbiBsbyh0KXtyZXR1cm4gMD09PWMuZGVmYXVsdCgiPGRpdj4iK3QrIjwvZGl2PiIpLmNoaWxkcmVuKCkuZmlsdGVyKChmdW5jdGlvbih0KXtyZXR1cm4gIkJSIiE9PXQudGFnTmFtZX0pKS5sZW5ndGh9ZnVuY3Rpb24gc28odCl7cmV0dXJuIDA9PT10Lmxlbmd0aD8iIjp0WzBdLm91dGVySFRNTH1mdW5jdGlvbiBmbyh0KXtyZXR1cm4gdC5sZW5ndGg/dFswXS50YWdOYW1lLnRvTG93ZXJDYXNlKCk6IiJ9ZnVuY3Rpb24gcG8odCxlKXtmb3IodmFyIG49IiIscj0odC5hdHRyKCJzdHlsZSIpfHwiIikuc3BsaXQoIjsiKSxvPXIubGVuZ3RoLGk9MDtpPG87aSsrKXt2YXIgdT1yW2ldO2lmKHUpe3ZhciBhPXUuc3BsaXQoIjoiKTthWzBdLnRyaW0oKT09PWUmJihuPWFbMV0udHJpbSgpKTt9fXJldHVybiBufXFlKHt0YXJnZXQ6IlN0cmluZyIscHJvdG86ITAsZm9yY2VkOihacj0idHJpbSIsYigoZnVuY3Rpb24oKXtyZXR1cm4gISF0b1tacl0oKXx8IuKAi8KF4aCOIiE9PSLigIvCheGgjiJbWnJdKCl8fGFvJiZ0b1tacl0ubmFtZSE9PVpyfSkpKX0se3RyaW06ZnVuY3Rpb24oKXtyZXR1cm4gY28odGhpcyl9fSkscWUoe2dsb2JhbDohMH0se2dsb2JhbFRoaXM6eX0pLG8uY3NzJiYoYy5kZWZhdWx0LmZuLmNzcz1vLmNzcyksby5hcHBlbmQmJihjLmRlZmF1bHQuZm4uYXBwZW5kPW8uYXBwZW5kKSxvLnByZXBlbmQmJihjLmRlZmF1bHQuZm4ucHJlcGVuZD1vLnByZXBlbmQpLG8uYWRkQ2xhc3MmJihjLmRlZmF1bHQuZm4uYWRkQ2xhc3M9by5hZGRDbGFzcyksby5yZW1vdmVDbGFzcyYmKGMuZGVmYXVsdC5mbi5yZW1vdmVDbGFzcz1vLnJlbW92ZUNsYXNzKSxvLmhhc0NsYXNzJiYoYy5kZWZhdWx0LmZuLmhhc0NsYXNzPW8uaGFzQ2xhc3MpLG8ub24mJihjLmRlZmF1bHQuZm4ub249by5vbiksby5vZmYmJihjLmRlZmF1bHQuZm4ub2ZmPW8ub2ZmKSxvLmZvY3VzJiYoYy5kZWZhdWx0LmZuLmZvY3VzPW8uZm9jdXMpLG8uYXR0ciYmKGMuZGVmYXVsdC5mbi5hdHRyPW8uYXR0ciksby5yZW1vdmVBdHRyJiYoYy5kZWZhdWx0LmZuLnJlbW92ZUF0dHI9by5yZW1vdmVBdHRyKSxvLmhpZGUmJihjLmRlZmF1bHQuZm4uaGlkZT1vLmhpZGUpLG8uc2hvdyYmKGMuZGVmYXVsdC5mbi5zaG93PW8uc2hvdyksby5wYXJlbnRzJiYoYy5kZWZhdWx0LmZuLnBhcmVudHM9by5wYXJlbnRzKSxvLmRhdGFzZXQmJihjLmRlZmF1bHQuZm4uZGF0YXNldD1vLmRhdGFzZXQpLG8udmFsJiYoYy5kZWZhdWx0LmZuLnZhbD1vLnZhbCksby50ZXh0JiYoYy5kZWZhdWx0LmZuLnRleHQ9by50ZXh0KSxvLmh0bWwmJihjLmRlZmF1bHQuZm4uaHRtbD1vLmh0bWwpLG8uY2hpbGRyZW4mJihjLmRlZmF1bHQuZm4uY2hpbGRyZW49by5jaGlsZHJlbiksby5yZW1vdmUmJihjLmRlZmF1bHQuZm4ucmVtb3ZlPW8ucmVtb3ZlKSxvLmZpbmQmJihjLmRlZmF1bHQuZm4uZmluZD1vLmZpbmQpLG8ud2lkdGgmJihjLmRlZmF1bHQuZm4ud2lkdGg9by53aWR0aCksby5oZWlnaHQmJihjLmRlZmF1bHQuZm4uaGVpZ2h0PW8uaGVpZ2h0KSxvLmZpbHRlciYmKGMuZGVmYXVsdC5mbi5maWx0ZXI9by5maWx0ZXIpLG8uZW1wdHkmJihjLmRlZmF1bHQuZm4uZW1wdHk9by5lbXB0eSk7dmFyIGhvPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIGhvPU9iamVjdC5zZXRQcm90b3R5cGVPZnx8e19fcHJvdG9fXzpbXX1pbnN0YW5jZW9mIEFycmF5JiZmdW5jdGlvbih0LGUpe3QuX19wcm90b19fPWU7fXx8ZnVuY3Rpb24odCxlKXtmb3IodmFyIG4gaW4gZSlPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSxuKSYmKHRbbl09ZVtuXSk7fSxobyh0LGUpfTsKICAvKiEgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLgoKICAgIFBlcm1pc3Npb24gdG8gdXNlLCBjb3B5LCBtb2RpZnksIGFuZC9vciBkaXN0cmlidXRlIHRoaXMgc29mdHdhcmUgZm9yIGFueQogICAgcHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLgoKICAgIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiIEFORCBUSEUgQVVUSE9SIERJU0NMQUlNUyBBTEwgV0FSUkFOVElFUyBXSVRICiAgICBSRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkKICAgIEFORCBGSVRORVNTLiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SIEJFIExJQUJMRSBGT1IgQU5ZIFNQRUNJQUwsIERJUkVDVCwKICAgIElORElSRUNULCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgT1IgQU5ZIERBTUFHRVMgV0hBVFNPRVZFUiBSRVNVTFRJTkcgRlJPTQogICAgTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1IKICAgIE9USEVSIFRPUlRJT1VTIEFDVElPTiwgQVJJU0lORyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBVU0UgT1IKICAgIFBFUkZPUk1BTkNFIE9GIFRISVMgU09GVFdBUkUuCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqL2Z1bmN0aW9uIHZvKHQsZSl7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIGUmJm51bGwhPT1lKXRocm93IG5ldyBUeXBlRXJyb3IoIkNsYXNzIGV4dGVuZHMgdmFsdWUgIitTdHJpbmcoZSkrIiBpcyBub3QgYSBjb25zdHJ1Y3RvciBvciBudWxsIik7ZnVuY3Rpb24gbigpe3RoaXMuY29uc3RydWN0b3I9dDt9aG8odCxlKSx0LnByb3RvdHlwZT1udWxsPT09ZT9PYmplY3QuY3JlYXRlKGUpOihuLnByb3RvdHlwZT1lLnByb3RvdHlwZSxuZXcgbik7fXZhciBnbz1mdW5jdGlvbigpe3JldHVybiBnbz1PYmplY3QuYXNzaWdufHxmdW5jdGlvbih0KXtmb3IodmFyIGUsbj0xLHI9YXJndW1lbnRzLmxlbmd0aDtuPHI7bisrKWZvcih2YXIgbyBpbiBlPWFyZ3VtZW50c1tuXSlPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSxvKSYmKHRbb109ZVtvXSk7cmV0dXJuIHR9LGdvLmFwcGx5KHRoaXMsYXJndW1lbnRzKX07ZnVuY3Rpb24gbW8odCxlLG4scil7cmV0dXJuIG5ldyhufHwobj1Qcm9taXNlKSkoKGZ1bmN0aW9uKG8saSl7ZnVuY3Rpb24gdSh0KXt0cnl7YyhyLm5leHQodCkpO31jYXRjaCh0KXtpKHQpO319ZnVuY3Rpb24gYSh0KXt0cnl7YyhyLnRocm93KHQpKTt9Y2F0Y2godCl7aSh0KTt9fWZ1bmN0aW9uIGModCl7dmFyIGU7dC5kb25lP28odC52YWx1ZSk6KGU9dC52YWx1ZSxlIGluc3RhbmNlb2Ygbj9lOm5ldyBuKChmdW5jdGlvbih0KXt0KGUpO30pKSkudGhlbih1LGEpO31jKChyPXIuYXBwbHkodCxlfHxbXSkpLm5leHQoKSk7fSkpfWZ1bmN0aW9uIHlvKHQsZSl7dmFyIG4scixvLGksdT17bGFiZWw6MCxzZW50OmZ1bmN0aW9uKCl7aWYoMSZvWzBdKXRocm93IG9bMV07cmV0dXJuIG9bMV19LHRyeXM6W10sb3BzOltdfTtyZXR1cm4gaT17bmV4dDphKDApLHRocm93OmEoMSkscmV0dXJuOmEoMil9LCJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2wmJihpW1N5bWJvbC5pdGVyYXRvcl09ZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30pLGk7ZnVuY3Rpb24gYShpKXtyZXR1cm4gZnVuY3Rpb24oYSl7cmV0dXJuIGZ1bmN0aW9uKGkpe2lmKG4pdGhyb3cgbmV3IFR5cGVFcnJvcigiR2VuZXJhdG9yIGlzIGFscmVhZHkgZXhlY3V0aW5nLiIpO2Zvcig7dTspdHJ5e2lmKG49MSxyJiYobz0yJmlbMF0/ci5yZXR1cm46aVswXT9yLnRocm93fHwoKG89ci5yZXR1cm4pJiZvLmNhbGwociksMCk6ci5uZXh0KSYmIShvPW8uY2FsbChyLGlbMV0pKS5kb25lKXJldHVybiBvO3N3aXRjaChyPTAsbyYmKGk9WzImaVswXSxvLnZhbHVlXSksaVswXSl7Y2FzZSAwOmNhc2UgMTpvPWk7YnJlYWs7Y2FzZSA0OnJldHVybiB1LmxhYmVsKysse3ZhbHVlOmlbMV0sZG9uZTohMX07Y2FzZSA1OnUubGFiZWwrKyxyPWlbMV0saT1bMF07Y29udGludWU7Y2FzZSA3Omk9dS5vcHMucG9wKCksdS50cnlzLnBvcCgpO2NvbnRpbnVlO2RlZmF1bHQ6aWYoIShvPXUudHJ5cywobz1vLmxlbmd0aD4wJiZvW28ubGVuZ3RoLTFdKXx8NiE9PWlbMF0mJjIhPT1pWzBdKSl7dT0wO2NvbnRpbnVlfWlmKDM9PT1pWzBdJiYoIW98fGlbMV0+b1swXSYmaVsxXTxvWzNdKSl7dS5sYWJlbD1pWzFdO2JyZWFrfWlmKDY9PT1pWzBdJiZ1LmxhYmVsPG9bMV0pe3UubGFiZWw9b1sxXSxvPWk7YnJlYWt9aWYobyYmdS5sYWJlbDxvWzJdKXt1LmxhYmVsPW9bMl0sdS5vcHMucHVzaChpKTticmVha31vWzJdJiZ1Lm9wcy5wb3AoKSx1LnRyeXMucG9wKCk7Y29udGludWV9aT1lLmNhbGwodCx1KTt9Y2F0Y2godCl7aT1bNix0XSxyPTA7fWZpbmFsbHl7bj1vPTA7fWlmKDUmaVswXSl0aHJvdyBpWzFdO3JldHVybiB7dmFsdWU6aVswXT9pWzFdOnZvaWQgMCxkb25lOiEwfX0oW2ksYV0pfX19ZnVuY3Rpb24gYm8odCl7dmFyIGU9ImZ1bmN0aW9uIj09dHlwZW9mIFN5bWJvbCYmU3ltYm9sLml0ZXJhdG9yLG49ZSYmdFtlXSxyPTA7aWYobilyZXR1cm4gbi5jYWxsKHQpO2lmKHQmJiJudW1iZXIiPT10eXBlb2YgdC5sZW5ndGgpcmV0dXJuIHtuZXh0OmZ1bmN0aW9uKCl7cmV0dXJuIHQmJnI+PXQubGVuZ3RoJiYodD12b2lkIDApLHt2YWx1ZTp0JiZ0W3IrK10sZG9uZTohdH19fTt0aHJvdyBuZXcgVHlwZUVycm9yKGU/Ik9iamVjdCBpcyBub3QgaXRlcmFibGUuIjoiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLiIpfWZ1bmN0aW9uIHhvKHQsZSl7dmFyIG49ImZ1bmN0aW9uIj09dHlwZW9mIFN5bWJvbCYmdFtTeW1ib2wuaXRlcmF0b3JdO2lmKCFuKXJldHVybiB0O3ZhciByLG8saT1uLmNhbGwodCksdT1bXTt0cnl7Zm9yKDsodm9pZCAwPT09ZXx8ZS0tID4wKSYmIShyPWkubmV4dCgpKS5kb25lOyl1LnB1c2goci52YWx1ZSk7fWNhdGNoKHQpe289e2Vycm9yOnR9O31maW5hbGx5e3RyeXtyJiYhci5kb25lJiYobj1pLnJldHVybikmJm4uY2FsbChpKTt9ZmluYWxseXtpZihvKXRocm93IG8uZXJyb3J9fXJldHVybiB1fWZ1bmN0aW9uIHdvKHQpe3ZhciBlPXhvKHIuRWRpdG9yLm5vZGVzKHQse21hdGNoOmZ1bmN0aW9uKGUpe3JldHVybiB0LmNoaWxkcmVuWzBdPT09ZX0sbW9kZToiaGlnaGVzdCJ9KSwxKSxuPWVbMF07aWYobnVsbD09bilyZXR1cm4gITE7dmFyIG89blswXTtpZighci5FbGVtZW50LmlzRWxlbWVudChvKSlyZXR1cm4gITE7aWYoInBhcmFncmFwaCI9PT1vLnR5cGUpcmV0dXJuICExO2lmKCIiIT09ci5Ob2RlLnN0cmluZyhvKSlyZXR1cm4gITE7dmFyIGk9by5jaGlsZHJlbix1PXZvaWQgMD09PWk/W106aTtyZXR1cm4gISFyLlRleHQuaXNUZXh0KHVbMF0pJiYoci5UcmFuc2Zvcm1zLnNldE5vZGVzKHQse3R5cGU6InBhcmFncmFwaCJ9KSwhMCl9dmFyIEVvPXtyZW5kZXJFbGVtczpbc10sZWxlbXNUb0h0bWw6W2ZdLHBhcnNlRWxlbXNIdG1sOlt7c2VsZWN0b3I6InA6bm90KFtkYXRhLXctZS10eXBlXSkiLHBhcnNlRWxlbUh0bWw6ZnVuY3Rpb24odCxlLG4pe3ZhciBvPWMuZGVmYXVsdCh0KTtyZXR1cm4gMD09PShlPWUuZmlsdGVyKChmdW5jdGlvbih0KXtyZXR1cm4gISFyLlRleHQuaXNUZXh0KHQpfHwhIW4uaXNJbmxpbmUodCl9KSkpLmxlbmd0aCYmKGU9W3t0ZXh0Om8udGV4dCgpLnJlcGxhY2UoL1xzKy9nbSwiICIpfV0pLHt0eXBlOiJwYXJhZ3JhcGgiLGNoaWxkcmVuOmV9fX1dLGVkaXRvclBsdWdpbjpmdW5jdGlvbih0KXt2YXIgZT10LmRlbGV0ZUJhY2t3YXJkLG49dC5kZWxldGVGb3J3YXJkO3QuaW5zZXJ0VGV4dCx0Lmluc2VydEJyZWFrO3ZhciByPXQ7cmV0dXJuIHIuZGVsZXRlQmFja3dhcmQ9ZnVuY3Rpb24odCl7d28ocil8fGUodCk7fSxyLmRlbGV0ZUZvcndhcmQ9ZnVuY3Rpb24odCl7d28ocil8fG4odCk7fSxyfX0sU289LyIvZyxrbz1EKCIiLnJlcGxhY2UpLFRvPWZ1bmN0aW9uKHQsZSxuLHIpe3ZhciBvPWJuKFIodCkpLGk9IjwiK2U7cmV0dXJuICIiIT09biYmKGkrPSIgIituKyc9Iicra28oYm4ociksU28sIiZxdW90OyIpKyciJyksaSsiPiIrbysiPC8iK2UrIj4ifSxNbz1mdW5jdGlvbih0KXtyZXR1cm4gYigoZnVuY3Rpb24oKXt2YXIgZT0iIlt0XSgnIicpO3JldHVybiBlIT09ZS50b0xvd2VyQ2FzZSgpfHxlLnNwbGl0KCciJykubGVuZ3RoPjN9KSl9O2Z1bmN0aW9uIElvKHQsZSl7dmFyIG49ZSxyPXQsbz1yLmJvbGQsaT1yLml0YWxpYyx1PXIudW5kZXJsaW5lO3JldHVybiBvJiYobj0iPHN0cm9uZz4iK24rIjwvc3Ryb25nPiIpLHIuY29kZSYmKG49Ijxjb2RlPiIrbisiPC9jb2RlPiIpLGkmJihuPSI8ZW0+IituKyI8L2VtPiIpLHUmJihuPSI8dT4iK24rIjwvdT4iKSxyLnRocm91Z2gmJihuPSI8cz4iK24rIjwvcz4iKSxyLnN1YiYmKG49IjxzdWI+IituKyI8L3N1Yj4iKSxyLnN1cCYmKG49IjxzdXA+IituKyI8L3N1cD4iKSxufWZ1bmN0aW9uIE5vKHQsZSl7cmV0dXJuIDAhPT10Lmxlbmd0aCYmKCEhdFswXS5tYXRjaGVzKGUpfHx0LmZpbmQoZSkubGVuZ3RoPjApfXFlKHt0YXJnZXQ6IlN0cmluZyIscHJvdG86ITAsZm9yY2VkOk1vKCJib2xkIil9LHtib2xkOmZ1bmN0aW9uKCl7cmV0dXJuIFRvKHRoaXMsImIiLCIiLCIiKX19KSxxZSh7dGFyZ2V0OiJTdHJpbmciLHByb3RvOiEwLGZvcmNlZDpNbygiaXRhbGljcyIpfSx7aXRhbGljczpmdW5jdGlvbigpe3JldHVybiBUbyh0aGlzLCJpIiwiIiwiIil9fSkscWUoe3RhcmdldDoiU3RyaW5nIixwcm90bzohMCxmb3JjZWQ6TW8oInN1YiIpfSx7c3ViOmZ1bmN0aW9uKCl7cmV0dXJuIFRvKHRoaXMsInN1YiIsIiIsIiIpfX0pLHFlKHt0YXJnZXQ6IlN0cmluZyIscHJvdG86ITAsZm9yY2VkOk1vKCJzdXAiKX0se3N1cDpmdW5jdGlvbigpe3JldHVybiBUbyh0aGlzLCJzdXAiLCIiLCIiKX19KTt2YXIgSG89e0NTU1J1bGVMaXN0OjAsQ1NTU3R5bGVEZWNsYXJhdGlvbjowLENTU1ZhbHVlTGlzdDowLENsaWVudFJlY3RMaXN0OjAsRE9NUmVjdExpc3Q6MCxET01TdHJpbmdMaXN0OjAsRE9NVG9rZW5MaXN0OjEsRGF0YVRyYW5zZmVySXRlbUxpc3Q6MCxGaWxlTGlzdDowLEhUTUxBbGxDb2xsZWN0aW9uOjAsSFRNTENvbGxlY3Rpb246MCxIVE1MRm9ybUVsZW1lbnQ6MCxIVE1MU2VsZWN0RWxlbWVudDowLE1lZGlhTGlzdDowLE1pbWVUeXBlQXJyYXk6MCxOYW1lZE5vZGVNYXA6MCxOb2RlTGlzdDoxLFBhaW50UmVxdWVzdExpc3Q6MCxQbHVnaW46MCxQbHVnaW5BcnJheTowLFNWR0xlbmd0aExpc3Q6MCxTVkdOdW1iZXJMaXN0OjAsU1ZHUGF0aFNlZ0xpc3Q6MCxTVkdQb2ludExpc3Q6MCxTVkdTdHJpbmdMaXN0OjAsU1ZHVHJhbnNmb3JtTGlzdDowLFNvdXJjZUJ1ZmZlckxpc3Q6MCxTdHlsZVNoZWV0TGlzdDowLFRleHRUcmFja0N1ZUxpc3Q6MCxUZXh0VHJhY2tMaXN0OjAsVG91Y2hMaXN0OjB9LE9vPUx0KCJzcGFuIikuY2xhc3NMaXN0LGpvPU9vJiZPby5jb25zdHJ1Y3RvciYmT28uY29uc3RydWN0b3IucHJvdG90eXBlLERvPWpvPT09T2JqZWN0LnByb3RvdHlwZT92b2lkIDA6am8sTG89ZnVuY3Rpb24odCxlKXt2YXIgbj1bXVt0XTtyZXR1cm4gISFuJiZiKChmdW5jdGlvbigpe24uY2FsbChudWxsLGV8fGZ1bmN0aW9uKCl7dGhyb3cgMX0sMSk7fSkpfSx6bz1kbi5mb3JFYWNoLEFvPUxvKCJmb3JFYWNoIik/W10uZm9yRWFjaDpmdW5jdGlvbih0KXtyZXR1cm4gem8odGhpcyx0LGFyZ3VtZW50cy5sZW5ndGg+MT9hcmd1bWVudHNbMV06dm9pZCAwKX0sUG89ZnVuY3Rpb24odCl7aWYodCYmdC5mb3JFYWNoIT09QW8pdHJ5e3F0KHQsImZvckVhY2giLEFvKTt9Y2F0Y2goZSl7dC5mb3JFYWNoPUFvO319O2Zvcih2YXIgQ28gaW4gSG8pSG9bQ29dJiZQbyh5W0NvXSYmeVtDb10ucHJvdG90eXBlKTtmdW5jdGlvbiBWbyh0LG4pe3JldHVybiBudWxsPT10LnNlbGVjdGlvbnx8ISF4byhyLkVkaXRvci5ub2Rlcyh0LHttYXRjaDpmdW5jdGlvbihuKXtyZXR1cm4gInByZSI9PT1lLkRvbUVkaXRvci5nZXROb2RlVHlwZShuKXx8ISFyLkVkaXRvci5pc1ZvaWQodCxuKX0sdW5pdmVyc2FsOiEwfSksMSlbMF19ZnVuY3Rpb24gQm8odCxlKXtPYmplY3Qua2V5cyhlKS5mb3JFYWNoKChmdW5jdGlvbihlKXsidGV4dCIhPT1lJiZyLkVkaXRvci5yZW1vdmVNYXJrKHQsZSk7fSkpO31QbyhEbykscWUoe3RhcmdldDoiT2JqZWN0IixzdGF0OiEwLGZvcmNlZDpiKChmdW5jdGlvbigpe1RuKDEpO30pKX0se2tleXM6ZnVuY3Rpb24odCl7cmV0dXJuIFRuKHZ0KHQpKX19KTt2YXIgUm89ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KCl7dGhpcy5tYXJrc05lZWRUb1JlbW92ZT1bXSx0aGlzLnRhZz0iYnV0dG9uIjt9cmV0dXJuIHQucHJvdG90eXBlLmdldFZhbHVlPWZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMubWFyayxuPXIuRWRpdG9yLm1hcmtzKHQpO3JldHVybiBuP25bZV06ISF4byhyLkVkaXRvci5ub2Rlcyh0LHttYXRjaDpmdW5jdGlvbih0KXtyZXR1cm4gITA9PT10W2VdfX0pLDEpWzBdfSx0LnByb3RvdHlwZS5pc0FjdGl2ZT1mdW5jdGlvbih0KXtyZXR1cm4gISF0aGlzLmdldFZhbHVlKHQpfSx0LnByb3RvdHlwZS5pc0Rpc2FibGVkPWZ1bmN0aW9uKHQpe3JldHVybiBWbyh0LHRoaXMubWFyayl9LHQucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24odCxlKXt2YXIgbj10aGlzLm1hcmsscj10aGlzLm1hcmtzTmVlZFRvUmVtb3ZlO2U/dC5yZW1vdmVNYXJrKG4pOih0LmFkZE1hcmsobiwhMCksciYmci5mb3JFYWNoKChmdW5jdGlvbihlKXtyZXR1cm4gdC5yZW1vdmVNYXJrKGUpfSkpKTt9LHR9KCksRm89Jzxzdmcgdmlld0JveD0iMCAwIDEwMjQgMTAyNCI+PHBhdGggZD0iTTcwNy44NzIgNDg0LjY0QTI1NC44OCAyNTQuODggMCAwIDAgNzY4IDMyMGMwLTE0MS4xNTItMTE0Ljg0OC0yNTYtMjU2LTI1NkgxOTJ2ODk2aDM4NGMxNDEuMTUyIDAgMjU2LTExNC44NDggMjU2LTI1NmEyNTYuMDk2IDI1Ni4wOTYgMCAwIDAtMTI0LjEyOC0yMTkuMzZ6TTM4NCAxOTJoMTAxLjUwNGM1NS45NjggMCAxMDEuNTA0IDU3LjQwOCAxMDEuNTA0IDEyOHMtNDUuNTM2IDEyOC0xMDEuNTA0IDEyOEgzODRWMTkyeiBtMTU5LjAwOCA2NDBIMzg0di0yNTZoMTU5LjAwOGM1OC40NjQgMCAxMDYuMDE2IDU3LjQwOCAxMDYuMDE2IDEyOHMtNDcuNTUyIDEyOC0xMDYuMDE2IDEyOHoiPjwvcGF0aD48L3N2Zz4nLF9vPSc8c3ZnIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik03MDQgNjRsMTI4IDAgMCA0MTZjMCAxNTkuMDcyLTE0My4yNjQgMjg4LTMyMCAyODhzLTMyMC0xMjguOTI4LTMyMC0yODhsMC00MTYgMTI4IDAgMCA0MTZjMCA0MC4xNiAxOC4yNCA3OC42ODggNTEuMzYgMTA4LjUxMiAzNi44OTYgMzMuMjE2IDg2Ljg0OCA1MS40ODggMTQwLjY0IDUxLjQ4OHMxMDMuNzQ0LTE4LjMwNCAxNDAuNjQtNTEuNDg4YzMzLjEyLTI5Ljc5MiA1MS4zNi02OC4zNTIgNTEuMzYtMTA4LjUxMmwwLTQxNnpNMTkyIDgzMmw2NDAgMCAwIDEyOC02NDAgMHoiPjwvcGF0aD48L3N2Zz4nLHFvPSc8c3ZnIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik04OTYgNjR2NjRoLTEyOEw0NDggODk2aDEyOHY2NEgxMjh2LTY0aDEyOEw1NzYgMTI4aC0xMjhWNjR6Ij48L3BhdGg+PC9zdmc+Jywkbz0nPHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0Ij48cGF0aCBkPSJNMTAyNCA1MTJ2NjRoLTIzNC40OTZjMjcuNTIgMzguNDk2IDQyLjQ5NiA4Mi42ODggNDIuNDk2IDEyOCAwIDcwLjg4LTM2LjY3MiAxMzkuMDQtMTAwLjU3NiAxODYuOTc2QzY3Mi4wNjQgOTM1LjQ4OCA1OTQuMTQ0IDk2MCA1MTIgOTYwcy0xNjAuMDY0LTI0LjUxMi0yMTkuNDI0LTY5LjAyNEMyMjguNjQgODQzLjA0IDE5MiA3NzQuODggMTkyIDcwNGgxMjhjMCA2OS4zNzYgODcuOTM2IDEyOCAxOTIgMTI4czE5Mi01OC42MjQgMTkyLTEyOC04Ny45MzYtMTI4LTE5Mi0xMjhIMHYtNjRoMjk5LjUyYTM4NS45ODQgMzg1Ljk4NCAwIDAgMS02Ljk0NC01LjAyNEMyMjguNjQgNDU5LjA0IDE5MiAzOTAuODggMTkyIDMyMHMzNi42NzItMTM5LjA0IDEwMC41NzYtMTg2Ljk3NkMzNTEuOTM2IDg4LjUxMiA0MjkuODU2IDY0IDUxMiA2NHMxNjAuMDY0IDI0LjUxMiAyMTkuNDI0IDY5LjAyNEM3OTUuMzI4IDE4MC45NiA4MzIgMjQ5LjEyIDgzMiAzMjBoLTEyOGMwLTY5LjM3Ni04Ny45MzYtMTI4LTE5Mi0xMjhzLTE5MiA1OC42MjQtMTkyIDEyOCA4Ny45MzYgMTI4IDE5MiAxMjhjNzguOTc2IDAgMTU0LjA0OCAyMi42ODggMjEyLjQ4IDY0SDEwMjR6Ij48L3BhdGg+PC9zdmc+JyxXbz0nPHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0Ij48cGF0aCBkPSJNNTc2IDczNmw5NiA5NiAzMjAtMzIwTDY3MiAxOTJsLTk2IDk2IDIyNCAyMjR6TTQ0OCAyODhsLTk2LTk2TDMyIDUxMmwzMjAgMzIwIDk2LTk2LTIyNC0yMjR6Ij48L3BhdGg+PC9zdmc+JyxHbz0nPHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0Ij48cGF0aCBkPSJNODY0IDBhMTYwIDE2MCAwIDAgMSAxMjggMjU2bC02NCA2NC0yMjQtMjI0IDY0LTY0YzI2Ljc1Mi0yMC4wOTYgNTkuOTY4LTMyIDk2LTMyek02NCA3MzZsLTY0IDI4OCAyODgtNjQgNTkyLTU5Mi0yMjQtMjI0TDY0IDczNnogbTY1MS41ODQtMzcyLjQxNmwtNDQ4IDQ0OC01NS4xNjgtNTUuMTY4IDQ0OC00NDggNTUuMTY4IDU1LjE2OHoiPjwvcGF0aD48L3N2Zz4nLFVvPSc8c3ZnIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik05MjQuNDAyNDY0IDEwMjMuMDY4MjExSDAuNjc5NjY1Vjk5LjM0NTQxMmg0NjEuODYxMzk5djk4LjkwOTIwOEg5OS41OTY4Njd2NzI1Ljg5NjM4OWg3MjUuODk2Mzg5VjU2MS4yMDY4MTFoOTguOTA5MjA4eiIgcC1pZD0iMTA5MDkiPjwvcGF0aD48cGF0aCBkPSJNOTMwLjgwNTEwNCAyMi45NzczMzZsNjkuOTY1NDM2IDY5Ljk2NTQzNi00NTMuNDkyNDA1IDQ1My40OTI0MDQtNjkuOTY1NDM1LTY5LjkwMTQ4OXoiIHAtaWQ9IjEwOTEwIj48L3BhdGg+PHBhdGggZD0iTTEwMjIuNDY0MzgxIDMwNC4wMzAwODFoLTk4LjkxNzIwMVY5OS4zNDU0MTJINzA5LjIzMDU3M1YwLjQyODIxMWgzMTMuMjMzODA4eiI+PC9wYXRoPjwvc3ZnPicsWG89Jzxzdmcgdmlld0JveD0iMCAwIDEwMjQgMTAyNCI+PHBhdGggZD0iTTY0IDg2NGg4OTZ2OTZINjR6TTM2MC41OCA1NzZoMzAyLjg1bDgxLjUzIDIyNGgxMDIuMTZMNTc5LjI0IDY0SDQ0NC43N0wxNzYuODkgODAwaDEwMi4xNmw4MS41My0yMjR6TTUxMiAxNTkuOTZMNjI4LjQ5IDQ4MEgzOTUuNTJMNTEyIDE1OS45NnoiPjwvcGF0aD48L3N2Zz4nLFlvPSc8c3ZnIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik01MTAuMDMwNzY5IDMxNS4wNzY5MjNsODQuNjc2OTIzIDE5Ni45MjMwNzdoLTE3Ny4yMzA3NjlsNzYuOC0xOTYuOTIzMDc3aDE1Ljc1Mzg0NnpNOTQ1LjIzMDc2OSAxNTcuNTM4NDYydjcwOC45MjMwNzZjMCA0My4zMjMwNzctMzUuNDQ2MTU0IDc4Ljc2OTIzMS03OC43NjkyMzEgNzguNzY5MjMxSDE1Ny41Mzg0NjJjLTQzLjMyMzA3NyAwLTc4Ljc2OTIzMS0zNS40NDYxNTQtNzguNzY5MjMxLTc4Ljc2OTIzMVYxNTcuNTM4NDYyYzAtNDMuMzIzMDc3IDM1LjQ0NjE1NC03OC43NjkyMzEgNzguNzY5MjMxLTc4Ljc2OTIzMWg3MDguOTIzMDc2YzQzLjMyMzA3NyAwIDc4Ljc2OTIzMSAzNS40NDYxNTQgNzguNzY5MjMxIDc4Ljc2OTIzMXogbS0xMDguMzA3NjkyIDY0My45Mzg0NjFMNjAwLjYxNTM4NSAyMTYuNjE1Mzg1Yy01LjkwNzY5Mi0xMS44MTUzODUtMTUuNzUzODQ2LTE5LjY5MjMwOC0yOS41Mzg0NjItMTkuNjkyMzA4aC0xMzkuODE1Mzg1Yy0xMS44MTUzODUgMC0yMy42MzA3NjkgNy44NzY5MjMtMjcuNTY5MjMgMTkuNjkyMzA4bC0yMTYuNjE1Mzg1IDU4NC44NjE1MzhjLTMuOTM4NDYyIDExLjgxNTM4NSAzLjkzODQ2MiAyNS42IDE3LjcyMzA3NyAyNS42aDgwLjczODQ2MmMxMS44MTUzODUgMCAyMy42MzA3NjktOS44NDYxNTQgMjcuNTY5MjMtMjEuNjYxNTM4bDYzLjAxNTM4NS0xNzUuMjYxNTM5aDI2My44NzY5MjNsNjguOTIzMDc3IDE3NS4yNjE1MzljMy45Mzg0NjIgMTEuODE1Mzg1IDE1Ljc1Mzg0NiAyMS42NjE1MzggMjcuNTY5MjMxIDIxLjY2MTUzOGg4MC43Mzg0NjFjMTMuNzg0NjE1IDAgMjMuNjMwNzY5LTEzLjc4NDYxNSAxOS42OTIzMDgtMjUuNnoiPjwvcGF0aD48L3N2Zz4nLEpvPSc8c3ZnIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik02NCA1MTJoMzg0djEyOGgtMTI4VjEwMjRoLTEyOFY2NDBoLTEyOHogbTg5Ni0yNTZINzA4LjI0OTZ2NzY4aC0xMzYuNDk5MlYyNTZIMzIwVjEyOGg2NDB6Ij48L3BhdGg+PC9zdmc+JyxLbz0nPHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0Ij48cGF0aCBkPSJNOTU2Ljc4ODM2NCAxNTIuMTEwNTQ1aC0yNC4xMTA1NDZsMjMuOTI0MzY0IDkuMDI5ODE5IDAuMTg2MTgyIDEyMS4wMTgxODFoLTY1LjA3MDU0NmwtODYuNTc0NTQ1LTEzMC4wNDhINTY2LjU1MTI3M3Y2NTAuMTQ2OTFsMTMwLjA0OCA2NC45Nzc0NTR2NjUuMTYzNjM2aC0zOTAuMDUwOTA5di02NS4xNjM2MzZsMTI5Ljk1NDkwOS02NC45Nzc0NTRWMTUyLjExMDU0NUgxOTguMjgzNjM2TDExMS40Mjk4MTggMjgyLjA2NTQ1NUg0Ni41NDU0NTVWNjkuMjU5NjM2QzQ2LjU0NTQ1NSAzMy43OTIgODIuNjY0NzI3IDIyLjA2MjU0NSA5OC45NTU2MzYgMjIuMDYyNTQ1aDgxMi42ODM2MzdjMjMuNzM4MTgyIDAgNDUuMDU2IDE1LjE3MzgxOCA0NS4wNTYgNDEuMDUzMDkxVjE2OS40MjU0NTV2LTE3LjIyMTgxOXoiPjwvcGF0aD48L3N2Zz4nLFFvPSc8c3ZnIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik0wIDY0aDEwMjR2MTI4SDB6IG0zODQgMTkyaDY0MHYxMjhIMzg0eiBtMCAxOTJoNjQwdjEyOEgzODR6IG0wIDE5Mmg2NDB2MTI4SDM4NHpNMCA4MzJoMTAyNHYxMjhIMHogbTI1Ni01MTJ2Mzg0bC0yNTYtMTkyeiI+PC9wYXRoPjwvc3ZnPicsWm89Jzxzdmcgdmlld0JveD0iMCAwIDEwMjQgMTAyNCI+PHBhdGggZD0iTTAgNjRoMTAyNHYxMjhIMHogbTM4NCAxOTJoNjQwdjEyOEgzODR6IG0wIDE5Mmg2NDB2MTI4SDM4NHogbTAgMTkyaDY0MHYxMjhIMzg0ek0wIDgzMmgxMDI0djEyOEgweiBtMC0xMjhWMzIwbDI1NiAxOTJ6Ij48L3BhdGg+PC9zdmc+Jyx0aT0nPHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0Ij48cGF0aCBkPSJNNzY4IDc5My42djEwMi40SDUxLjJ2LTEwMi40aDcxNi44eiBtMjA0LjgtMjMwLjR2MTAyLjRINTEuMnYtMTAyLjRoOTIxLjZ6IG0tMjA0LjgtMjMwLjR2MTAyLjRINTEuMnYtMTAyLjRoNzE2Ljh6TTk3Mi44IDEwMi40djEwMi40SDUxLjJWMTAyLjRoOTIxLjZ6Ij48L3BhdGg+PC9zdmc+JyxlaT0nPHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0Ij48cGF0aCBkPSJNOTcyLjggNzkzLjZ2MTAyLjRIMjU2di0xMDIuNGg3MTYuOHogbTAtMjMwLjR2MTAyLjRINTEuMnYtMTAyLjRoOTIxLjZ6IG0wLTIzMC40djEwMi40SDI1NnYtMTAyLjRoNzE2Ljh6TTk3Mi44IDEwMi40djEwMi40SDUxLjJWMTAyLjRoOTIxLjZ6Ij48L3BhdGg+PC9zdmc+JyxuaT0nPHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0Ij48cGF0aCBkPSJNODcwLjQgNzkzLjZ2MTAyLjRIMTUzLjZ2LTEwMi40aDcxNi44eiBtMTAyLjQtMjMwLjR2MTAyLjRINTEuMnYtMTAyLjRoOTIxLjZ6IG0tMTAyLjQtMjMwLjR2MTAyLjRIMTUzLjZ2LTEwMi40aDcxNi44ek05NzIuOCAxMDIuNHYxMDIuNEg1MS4yVjEwMi40aDkyMS42eiI+PC9wYXRoPjwvc3ZnPicscmk9Jzxzdmcgdmlld0JveD0iMCAwIDEwMjQgMTAyNCI+PHBhdGggZD0iTTAgNjRoMTAyNHYxMjhIMHogbTAgMTkyaDEwMjR2MTI4SDB6IG0wIDE5MmgxMDI0djEyOEgweiBtMCAxOTJoMTAyNHYxMjhIMHogbTAgMTkyaDEwMjR2MTI4SDB6Ij48L3BhdGg+PC9zdmc+JyxvaT0nPHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0Ij48cGF0aCBkPSJNNzY4IDIwNi4wMTZ2NTAuMDE2aDEyOHY2NGgtMTkyVjE3NC4wMTZsMTI4LTYwVjY0aC0xMjhWMGgxOTJ2MTQ2LjAxNnpNNjc2IDI1NmgtMTM2TDM1MiA0NDQgMTY0IDI1NkgyOGwyNTYgMjU2LTI1NiAyNTZoMTM2TDM1MiA1ODAgNTQwIDc2OGgxMzZsLTI1Ni0yNTZ6Ij48L3BhdGg+PC9zdmc+JyxpaT0nPHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0Ij48cGF0aCBkPSJNNzY4IDkxMC4wMTZ2NTAuMDE2aDEyOHY2NGgtMTkydi0xNDYuMDE2bDEyOC02MFY3NjhoLTEyOHYtNjRoMTkydjE0Ni4wMTZ6TTY3NiAyNTZoLTEzNkwzNTIgNDQ0IDE2NCAyNTZIMjhsMjU2IDI1Ni0yNTYgMjU2aDEzNkwzNTIgNTgwIDU0MCA3NjhoMTM2bC0yNTYtMjU2eiI+PC9wYXRoPjwvc3ZnPicsdWk9ZnVuY3Rpb24odCl7ZnVuY3Rpb24gbigpe3ZhciBuPW51bGwhPT10JiZ0LmFwcGx5KHRoaXMsYXJndW1lbnRzKXx8dGhpcztyZXR1cm4gbi5tYXJrPSJib2xkIixuLnRpdGxlPWUudCgidGV4dFN0eWxlLmJvbGQiKSxuLmljb25Tdmc9Rm8sbi5ob3RrZXk9Im1vZCtiIixufXJldHVybiB2byhuLHQpLG59KFJvKSxhaT1mdW5jdGlvbih0KXtmdW5jdGlvbiBuKCl7dmFyIG49bnVsbCE9PXQmJnQuYXBwbHkodGhpcyxhcmd1bWVudHMpfHx0aGlzO3JldHVybiBuLm1hcms9ImNvZGUiLG4udGl0bGU9ZS50KCJ0ZXh0U3R5bGUuY29kZSIpLG4uaWNvblN2Zz1XbyxuLmhvdGtleT0ibW9kK2UiLG59cmV0dXJuIHZvKG4sdCksbn0oUm8pLGNpPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIG4oKXt2YXIgbj1udWxsIT09dCYmdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl8fHRoaXM7cmV0dXJuIG4ubWFyaz0iaXRhbGljIixuLnRpdGxlPWUudCgidGV4dFN0eWxlLml0YWxpYyIpLG4uaWNvblN2Zz1xbyxuLmhvdGtleT0ibW9kK2kiLG59cmV0dXJuIHZvKG4sdCksbn0oUm8pLGxpPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIG4oKXt2YXIgbj1udWxsIT09dCYmdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl8fHRoaXM7cmV0dXJuIG4ubWFyaz0idGhyb3VnaCIsbi50aXRsZT1lLnQoInRleHRTdHlsZS50aHJvdWdoIiksbi5pY29uU3ZnPSRvLG4uaG90a2V5PSJtb2Qrc2hpZnQreCIsbn1yZXR1cm4gdm8obix0KSxufShSbyksc2k9ZnVuY3Rpb24odCl7ZnVuY3Rpb24gbigpe3ZhciBuPW51bGwhPT10JiZ0LmFwcGx5KHRoaXMsYXJndW1lbnRzKXx8dGhpcztyZXR1cm4gbi5tYXJrPSJ1bmRlcmxpbmUiLG4udGl0bGU9ZS50KCJ0ZXh0U3R5bGUudW5kZXJsaW5lIiksbi5pY29uU3ZnPV9vLG4uaG90a2V5PSJtb2QrdSIsbn1yZXR1cm4gdm8obix0KSxufShSbyksZmk9ZnVuY3Rpb24odCl7ZnVuY3Rpb24gbigpe3ZhciBuPW51bGwhPT10JiZ0LmFwcGx5KHRoaXMsYXJndW1lbnRzKXx8dGhpcztyZXR1cm4gbi5tYXJrPSJzdWIiLG4ubWFya3NOZWVkVG9SZW1vdmU9WyJzdXAiXSxuLnRpdGxlPWUudCgidGV4dFN0eWxlLnN1YiIpLG4uaWNvblN2Zz1paSxuLmhvdGtleT0iIixufXJldHVybiB2byhuLHQpLG59KFJvKSxkaT1mdW5jdGlvbih0KXtmdW5jdGlvbiBuKCl7dmFyIG49bnVsbCE9PXQmJnQuYXBwbHkodGhpcyxhcmd1bWVudHMpfHx0aGlzO3JldHVybiBuLm1hcms9InN1cCIsbi5tYXJrc05lZWRUb1JlbW92ZT1bInN1YiJdLG4udGl0bGU9ZS50KCJ0ZXh0U3R5bGUuc3VwIiksbi5pY29uU3ZnPW9pLG4uaG90a2V5PSIiLG59cmV0dXJuIHZvKG4sdCksbn0oUm8pLHBpPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe3RoaXMudGl0bGU9ZS50KCJ0ZXh0U3R5bGUuY2xlYXIiKSx0aGlzLmljb25Tdmc9Jzxzdmcgdmlld0JveD0iMCAwIDEwMjQgMTAyNCI+PHBhdGggZD0iTTk2OS4zODI0MDggMjg4LjczODYxNWwtMzE5LjQwMTEyMy0yNzAuODUyMTUyYTY3LjA3NDIzNiA2Ny4wNzQyMzYgMCAwIDAtOTYuNDU5MTM5IDUuNzQ5MjJsLTUwNS45MzEzNzkgNTc0LjkyMjAyMWE2OC4zNTE4NCA2OC4zNTE4NCAwIDAgMC0xNy44ODY0NjMgNDcuOTEwMTY5IDc0LjEwMTA2MSA3NC4xMDEwNjEgMCAwIDAgMjQuMjc0NDg2IDQ3LjkxMDE2OGwxNTYuNTA2NTUgMTMyLjIzMjA2NWgzNzMuMDYwNTEyTDk3NS4xMzE2MjggMzgzLjI4MTM0N2E2Ny4wNzQyMzYgNjcuMDc0MjM2IDAgMCAwLTUuNzQ5MjItOTYuNDU5MTM5eiBtLTQ0MC4xMzQ3NDcgNDMzLjc0NjcyNUgyNjQuMTQ0NzI5bC05MC4wNzExMTctNzguNTcyNjc2Yy01Ljc0OTIyLTUuNzQ5MjItMTIuMTM3MjQzLTEyLjEzNzI0My0xMi4xMzcyNDMtMTcuODg2NDYzYTM2LjQxMTcyOCAzNi40MTE3MjggMCAwIDEgNS43NDkyMjEtMjQuMjc0NDg1bDIxMC44MDQ3NDEtMjQwLjgyODQ0NyAyNjUuMTAyOTMyIDIyOC42OTEyMDR6IG0tNDM5LjQ5NTk0NSAxODAuNzgxMDM2aDg0My4yMTg5NjRhNjAuMDQ3NDExIDYwLjA0NzQxMSAwIDEgMSAwIDEyMC43MzM2MjRIODkuNzUxNzE2YTYwLjA0NzQxMSA2MC4wNDc0MTEgMCAxIDEgMC0xMjAuNzMzNjI0eiBtMCAwIj48L3BhdGg+PC9zdmc+Jyx0aGlzLnRhZz0iYnV0dG9uIjt9cmV0dXJuIHQucHJvdG90eXBlLmdldFZhbHVlPWZ1bmN0aW9uKHQpe3JldHVybiAiIn0sdC5wcm90b3R5cGUuaXNBY3RpdmU9ZnVuY3Rpb24odCl7cmV0dXJuICExfSx0LnByb3RvdHlwZS5pc0Rpc2FibGVkPWZ1bmN0aW9uKHQpe3JldHVybiBWbyh0KX0sdC5wcm90b3R5cGUuZXhlYz1mdW5jdGlvbih0LGUpe3ZhciBuLG8saT1yLkVkaXRvci5ub2Rlcyh0LHttYXRjaDpmdW5jdGlvbih0KXtyZXR1cm4gci5UZXh0LmlzVGV4dCh0KX0sdW5pdmVyc2FsOiEwfSk7dHJ5e2Zvcih2YXIgdT1ibyhpKSxhPXUubmV4dCgpOyFhLmRvbmU7YT11Lm5leHQoKSl7Qm8odCxhLnZhbHVlWzBdKTt9fWNhdGNoKHQpe249e2Vycm9yOnR9O31maW5hbGx5e3RyeXthJiYhYS5kb25lJiYobz11LnJldHVybikmJm8uY2FsbCh1KTt9ZmluYWxseXtpZihuKXRocm93IG4uZXJyb3J9fX0sdH0oKSxoaT17cmVuZGVyU3R5bGU6ZnVuY3Rpb24odCxlKXt2YXIgcj10LG89ci5ib2xkLGk9ci5pdGFsaWMsdT1yLnVuZGVybGluZSxhPXIuY29kZSxjPXIudGhyb3VnaCxsPXIuc3ViLHM9ci5zdXAsZj1lO3JldHVybiBvJiYoZj1uLmpzeCgic3Ryb25nIixudWxsLGYpKSxhJiYoZj1uLmpzeCgiY29kZSIsbnVsbCxmKSksaSYmKGY9bi5qc3goImVtIixudWxsLGYpKSx1JiYoZj1uLmpzeCgidSIsbnVsbCxmKSksYyYmKGY9bi5qc3goInMiLG51bGwsZikpLGwmJihmPW4uanN4KCJzdWIiLG51bGwsZikpLHMmJihmPW4uanN4KCJzdXAiLG51bGwsZikpLGZ9LG1lbnVzOlt7a2V5OiJib2xkIixmYWN0b3J5OmZ1bmN0aW9uKCl7cmV0dXJuIG5ldyB1aX19LHtrZXk6InVuZGVybGluZSIsZmFjdG9yeTpmdW5jdGlvbigpe3JldHVybiBuZXcgc2l9fSx7a2V5OiJpdGFsaWMiLGZhY3Rvcnk6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IGNpfX0se2tleToidGhyb3VnaCIsZmFjdG9yeTpmdW5jdGlvbigpe3JldHVybiBuZXcgbGl9fSx7a2V5OiJjb2RlIixmYWN0b3J5OmZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBhaX19LHtrZXk6InN1YiIsZmFjdG9yeTpmdW5jdGlvbigpe3JldHVybiBuZXcgZml9fSx7a2V5OiJzdXAiLGZhY3Rvcnk6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IGRpfX0se2tleToiY2xlYXJTdHlsZSIsZmFjdG9yeTpmdW5jdGlvbigpe3JldHVybiBuZXcgcGl9fV0sc3R5bGVUb0h0bWw6ZnVuY3Rpb24odCxlKXtpZighci5UZXh0LmlzVGV4dCh0KSlyZXR1cm4gZTtpZihsbyhlKSlyZXR1cm4gSW8odCxlKTt2YXIgbj1jLmRlZmF1bHQoZSk7aWYoImJyIj09PWZvKG4pKXJldHVybiBJbyh0LCI8YnI+Iik7dmFyIG89bi5odG1sKCk7cmV0dXJuIG89SW8odCxvKSxuLmh0bWwobyksc28obil9LHBhcnNlU3R5bGVIdG1sOmZ1bmN0aW9uKHQsZSxuKXt2YXIgbz1jLmRlZmF1bHQodCk7aWYoIXIuVGV4dC5pc1RleHQoZSkpcmV0dXJuIGU7dmFyIGk9ZTtyZXR1cm4gTm8obywiYixzdHJvbmciKSYmKGkuYm9sZD0hMCksTm8obywiaSxlbSIpJiYoaS5pdGFsaWM9ITApLE5vKG8sInUiKSYmKGkudW5kZXJsaW5lPSEwKSxObyhvLCJzLHN0cmlrZSIpJiYoaS50aHJvdWdoPSEwKSxObyhvLCJzdWIiKSYmKGkuc3ViPSEwKSxObyhvLCJzdXAiKSYmKGkuc3VwPSEwKSxObyhvLCJjb2RlIikmJihpLmNvZGU9ITApLGl9fTtmdW5jdGlvbiB2aSh0KXtyZXR1cm4gZnVuY3Rpb24oZSxyLG8pe3ZhciBpPSJoIit0O3JldHVybiBuLmpzeChpLG51bGwscil9fXZhciBnaT17dHlwZToiaGVhZGVyMSIscmVuZGVyRWxlbTp2aSgxKX0sbWk9e3R5cGU6ImhlYWRlcjIiLHJlbmRlckVsZW06dmkoMil9LHlpPXt0eXBlOiJoZWFkZXIzIixyZW5kZXJFbGVtOnZpKDMpfSxiaT17dHlwZToiaGVhZGVyNCIscmVuZGVyRWxlbTp2aSg0KX0seGk9e3R5cGU6ImhlYWRlcjUiLHJlbmRlckVsZW06dmkoNSl9LHdpPWRlLlBST1BFUixFaT0idG9TdHJpbmciLFNpPVJlZ0V4cC5wcm90b3R5cGUsa2k9U2kudG9TdHJpbmcsVGk9RCh4biksTWk9YigoZnVuY3Rpb24oKXtyZXR1cm4gIi9hL2IiIT1raS5jYWxsKHtzb3VyY2U6ImEiLGZsYWdzOiJiIn0pfSkpLElpPXdpJiZraS5uYW1lIT1FaTsoTWl8fElpKSYmcGUoUmVnRXhwLnByb3RvdHlwZSxFaSwoZnVuY3Rpb24oKXt2YXIgdD1CdCh0aGlzKSxlPWJuKHQuc291cmNlKSxuPXQuZmxhZ3M7cmV0dXJuICIvIitlKyIvIitibih2b2lkIDA9PT1uJiZHKFNpLHQpJiYhKCJmbGFncyJpbiBTaSk/VGkodCk6bil9KSx7dW5zYWZlOiEwfSk7dmFyIE5pLEhpPXkuVHlwZUVycm9yLE9pPWZ1bmN0aW9uKHQpe2lmKENyKHQpKXRocm93IEhpKCJUaGUgbWV0aG9kIGRvZXNuJ3QgYWNjZXB0IHJlZ3VsYXIgZXhwcmVzc2lvbnMiKTtyZXR1cm4gdH0samk9TXQoIm1hdGNoIiksRGk9ZnVuY3Rpb24odCl7dmFyIGU9Ly4vO3RyeXsiLy4vIlt0XShlKTt9Y2F0Y2gobil7dHJ5e3JldHVybiBlW2ppXT0hMSwiLy4vIlt0XShlKX1jYXRjaCh0KXt9fXJldHVybiAhMX0sTGk9UHQuZix6aT1EKCIiLnN0YXJ0c1dpdGgpLEFpPUQoIiIuc2xpY2UpLFBpPU1hdGgubWluLENpPURpKCJzdGFydHNXaXRoIik7ZnVuY3Rpb24gVmkodCl7dmFyIG49eG8oci5FZGl0b3Iubm9kZXModCx7bWF0Y2g6ZnVuY3Rpb24odCl7cmV0dXJuIGUuRG9tRWRpdG9yLmdldE5vZGVUeXBlKHQpLnN0YXJ0c1dpdGgoImhlYWRlciIpfSx1bml2ZXJzYWw6ITB9KSwxKSxvPW5bMF07aWYobnVsbD09bylyZXR1cm4gInBhcmFncmFwaCI7dmFyIGk9eG8obywxKVswXTtyZXR1cm4gZS5Eb21FZGl0b3IuZ2V0Tm9kZVR5cGUoaSl9ZnVuY3Rpb24gQmkodCl7cmV0dXJuIG51bGw9PXQuc2VsZWN0aW9ufHwheG8oci5FZGl0b3Iubm9kZXModCx7bWF0Y2g6ZnVuY3Rpb24odCl7dmFyIG49ZS5Eb21FZGl0b3IuZ2V0Tm9kZVR5cGUodCk7cmV0dXJuICJwYXJhZ3JhcGgiPT09bnx8ISFuLnN0YXJ0c1dpdGgoImhlYWRlciIpfSx1bml2ZXJzYWw6ITAsbW9kZToiaGlnaGVzdCJ9KSwxKVswXX1mdW5jdGlvbiBSaSh0LGUpe2UmJnIuVHJhbnNmb3Jtcy5zZXROb2Rlcyh0LHt0eXBlOmV9KTt9cWUoe3RhcmdldDoiU3RyaW5nIixwcm90bzohMCxmb3JjZWQ6ISEoQ2l8fChOaT1MaShTdHJpbmcucHJvdG90eXBlLCJzdGFydHNXaXRoIiksIU5pfHxOaS53cml0YWJsZSkpJiYhQ2l9LHtzdGFydHNXaXRoOmZ1bmN0aW9uKHQpe3ZhciBlPWJuKFIodGhpcykpO09pKHQpO3ZhciBuPXdlKFBpKGFyZ3VtZW50cy5sZW5ndGg+MT9hcmd1bWVudHNbMV06dm9pZCAwLGUubGVuZ3RoKSkscj1ibih0KTtyZXR1cm4gemk/emkoZSxyLG4pOkFpKGUsbixuK3IubGVuZ3RoKT09PXJ9fSk7dmFyIEZpPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe3RoaXMudGl0bGU9ZS50KCJoZWFkZXIudGl0bGUiKSx0aGlzLmljb25Tdmc9Jzxzdmcgdmlld0JveD0iMCAwIDEwMjQgMTAyNCI+PHBhdGggZD0iTTk2MCA5NjBjLTUxLjIgMC0xMDIuNC0zLjItMTUzLjYtMy4yLTUxLjIgMC05OS4yIDMuMi0xNTAuNCAzLjItMTkuMiAwLTI4LjgtMjIuNC0yOC44LTM4LjQgMC01MS4yIDU3LjYtMjguOCA4Ni40LTQ4IDE5LjItMTIuOCAxOS4yLTYwLjggMTkuMi04MHYtMjI0LTE5LjJjLTkuNi0zLjItMTkuMi0zLjItMjguOC0zLjJIMzIwYy05LjYgMC0xOS4yIDAtMjguOCAzLjJWNzgwLjhjMCAyMi40IDAgODAgMjIuNCA5Mi44IDI4LjggMTkuMiA5Ni02LjQgOTYgNDQuOCAwIDE2LTkuNiA0MS42LTI4LjggNDEuNi01NC40IDAtMTA1LjYtMy4yLTE2MC0zLjItNDggMC05NiAzLjItMTQ3LjIgMy4yLTE5LjIgMC0yOC44LTIyLjQtMjguOC0zOC40IDAtNTEuMiA1MS4yLTI4LjggODAtNDggMTkuMi0xMi44IDE5LjItNjAuOCAxOS4yLTgzLjJWMjk0LjRjMC0yOC44IDMuMi0xMTUuMi0yMi40LTEzMS4yLTI1LjYtMTYtODYuNCA5LjYtODYuNC00MS42IDAtMTYgNi40LTQxLjYgMjguOC00MS42IDUxLjIgMCAxMDUuNiAzLjIgMTU2LjggMy4yIDQ4IDAgOTYtMy4yIDE0NC0zLjIgMTkuMiAwIDI4LjggMjIuNCAyOC44IDQxLjYgMCA0OC01Ny42IDI1LjYtODMuMiA0MS42LTE5LjIgMTIuOC0xOS4yIDczLjYtMTkuMiA5Mi44djIwMS42YzYuNCAzLjIgMTYgMy4yIDIyLjQgMy4yaDQwMGM2LjQgMCAxMi44IDAgMjIuNC0zLjJWMjU2YzAtMjIuNCAwLTgwLTE5LjItOTIuOC0yOC44LTE2LTg2LjQgNi40LTg2LjQtNDEuNiAwLTE2IDkuNi00MS42IDI4LjgtNDEuNiA1MS4yIDAgOTkuMiAzLjIgMTUwLjQgMy4yIDQ4IDAgOTkuMi0zLjIgMTQ3LjItMy4yIDE5LjIgMCAyOC44IDIyLjQgMjguOCA0MS42IDAgNTEuMi01Ny42IDI1LjYtODYuNCA0MS42LTE5LjIgMTIuOC0xOS4yIDcwLjQtMTkuMiA5Mi44djUzNy42YzAgMTkuMiAwIDY3LjIgMTkuMiA4MCAyOC44IDE5LjIgODkuNi02LjQgODkuNiA0NC44IDAgMTkuMi02LjQgNDEuNi0yOC44IDQxLjZ6Ij48L3BhdGg+PC9zdmc+Jyx0aGlzLnRhZz0ic2VsZWN0Iix0aGlzLndpZHRoPTYwO31yZXR1cm4gdC5wcm90b3R5cGUuZ2V0T3B0aW9ucz1mdW5jdGlvbih0KXt2YXIgbj1be3ZhbHVlOiJoZWFkZXIxIix0ZXh0OiJIMSIsc3R5bGVGb3JSZW5kZXJNZW51TGlzdDp7ImZvbnQtc2l6ZSI6IjMycHgiLCJmb250LXdlaWdodCI6ImJvbGQifX0se3ZhbHVlOiJoZWFkZXIyIix0ZXh0OiJIMiIsc3R5bGVGb3JSZW5kZXJNZW51TGlzdDp7ImZvbnQtc2l6ZSI6IjI0cHgiLCJmb250LXdlaWdodCI6ImJvbGQifX0se3ZhbHVlOiJoZWFkZXIzIix0ZXh0OiJIMyIsc3R5bGVGb3JSZW5kZXJNZW51TGlzdDp7ImZvbnQtc2l6ZSI6IjE4cHgiLCJmb250LXdlaWdodCI6ImJvbGQifX0se3ZhbHVlOiJoZWFkZXI0Iix0ZXh0OiJINCIsc3R5bGVGb3JSZW5kZXJNZW51TGlzdDp7ImZvbnQtc2l6ZSI6IjE2cHgiLCJmb250LXdlaWdodCI6ImJvbGQifX0se3ZhbHVlOiJoZWFkZXI1Iix0ZXh0OiJINSIsc3R5bGVGb3JSZW5kZXJNZW51TGlzdDp7ImZvbnQtc2l6ZSI6IjEzcHgiLCJmb250LXdlaWdodCI6ImJvbGQifX0se3ZhbHVlOiJwYXJhZ3JhcGgiLHRleHQ6ZS50KCJoZWFkZXIudGV4dCIpfV0scj10aGlzLmdldFZhbHVlKHQpLnRvU3RyaW5nKCk7cmV0dXJuIG4uZm9yRWFjaCgoZnVuY3Rpb24odCl7dC52YWx1ZT09PXI/dC5zZWxlY3RlZD0hMDpkZWxldGUgdC5zZWxlY3RlZDt9KSksbn0sdC5wcm90b3R5cGUuaXNBY3RpdmU9ZnVuY3Rpb24odCl7cmV0dXJuICExfSx0LnByb3RvdHlwZS5nZXRWYWx1ZT1mdW5jdGlvbih0KXtyZXR1cm4gVmkodCl9LHQucHJvdG90eXBlLmlzRGlzYWJsZWQ9ZnVuY3Rpb24odCl7cmV0dXJuIEJpKHQpfSx0LnByb3RvdHlwZS5leGVjPWZ1bmN0aW9uKHQsZSl7UmkodCxlLnRvU3RyaW5nKCkpO30sdH0oKSxfaT1mdW5jdGlvbigpe2Z1bmN0aW9uIHQoKXt0aGlzLnRhZz0iYnV0dG9uIjt9cmV0dXJuIHQucHJvdG90eXBlLmdldFZhbHVlPWZ1bmN0aW9uKHQpe3JldHVybiBWaSh0KX0sdC5wcm90b3R5cGUuaXNBY3RpdmU9ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuZ2V0VmFsdWUodCk9PT10aGlzLnR5cGV9LHQucHJvdG90eXBlLmlzRGlzYWJsZWQ9ZnVuY3Rpb24odCl7cmV0dXJuIEJpKHQpfSx0LnByb3RvdHlwZS5leGVjPWZ1bmN0aW9uKHQsZSl7dmFyIG49dGhpcy50eXBlO1JpKHQsZT09PW4/InBhcmFncmFwaCI6bik7fSx0fSgpLHFpPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUoKXt2YXIgZT1udWxsIT09dCYmdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl8fHRoaXM7cmV0dXJuIGUudGl0bGU9IkgxIixlLnR5cGU9ImhlYWRlcjEiLGV9cmV0dXJuIHZvKGUsdCksZX0oX2kpLCRpPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUoKXt2YXIgZT1udWxsIT09dCYmdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl8fHRoaXM7cmV0dXJuIGUudGl0bGU9IkgyIixlLnR5cGU9ImhlYWRlcjIiLGV9cmV0dXJuIHZvKGUsdCksZX0oX2kpLFdpPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUoKXt2YXIgZT1udWxsIT09dCYmdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl8fHRoaXM7cmV0dXJuIGUudGl0bGU9IkgzIixlLnR5cGU9ImhlYWRlcjMiLGV9cmV0dXJuIHZvKGUsdCksZX0oX2kpLEdpPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUoKXt2YXIgZT1udWxsIT09dCYmdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl8fHRoaXM7cmV0dXJuIGUudGl0bGU9Ikg0IixlLnR5cGU9ImhlYWRlcjQiLGV9cmV0dXJuIHZvKGUsdCksZX0oX2kpLFVpPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUoKXt2YXIgZT1udWxsIT09dCYmdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl8fHRoaXM7cmV0dXJuIGUudGl0bGU9Ikg1IixlLnR5cGU9ImhlYWRlcjUiLGV9cmV0dXJuIHZvKGUsdCksZX0oX2kpLFhpPXtrZXk6ImhlYWRlclNlbGVjdCIsZmFjdG9yeTpmdW5jdGlvbigpe3JldHVybiBuZXcgRml9fSxZaT17a2V5OiJoZWFkZXIxIixmYWN0b3J5OmZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBxaX19LEppPXtrZXk6ImhlYWRlcjIiLGZhY3Rvcnk6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3ICRpfX0sS2k9e2tleToiaGVhZGVyMyIsZmFjdG9yeTpmdW5jdGlvbigpe3JldHVybiBuZXcgV2l9fSxRaT17a2V5OiJoZWFkZXI0IixmYWN0b3J5OmZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBHaX19LFppPXtrZXk6ImhlYWRlcjUiLGZhY3Rvcnk6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IFVpfX07ZnVuY3Rpb24gdHUodCl7cmV0dXJuIGZ1bmN0aW9uKGUsbil7cmV0dXJuICI8aCIrdCsiPiIrbisiPC9oIit0KyI+In19ZnVuY3Rpb24gZXUodCl7cmV0dXJuIGZ1bmN0aW9uKGUsbixvKXt2YXIgaT1jLmRlZmF1bHQoZSk7cmV0dXJuIDA9PT0obj1uLmZpbHRlcigoZnVuY3Rpb24odCl7cmV0dXJuICEhci5UZXh0LmlzVGV4dCh0KXx8ISFvLmlzSW5saW5lKHQpfSkpKS5sZW5ndGgmJihuPVt7dGV4dDppLnRleHQoKS5yZXBsYWNlKC9ccysvZ20sIiAiKX1dKSx7dHlwZToiaGVhZGVyIit0LGNoaWxkcmVuOm59fX12YXIgbnU9e3JlbmRlckVsZW1zOltnaSxtaSx5aSxiaSx4aV0sZWxlbXNUb0h0bWw6W3t0eXBlOiJoZWFkZXIxIixlbGVtVG9IdG1sOnR1KDEpfSx7dHlwZToiaGVhZGVyMiIsZWxlbVRvSHRtbDp0dSgyKX0se3R5cGU6ImhlYWRlcjMiLGVsZW1Ub0h0bWw6dHUoMyl9LHt0eXBlOiJoZWFkZXI0IixlbGVtVG9IdG1sOnR1KDQpfSx7dHlwZToiaGVhZGVyNSIsZWxlbVRvSHRtbDp0dSg1KX1dLHBhcnNlRWxlbXNIdG1sOlt7c2VsZWN0b3I6ImgxOm5vdChbZGF0YS13LWUtdHlwZV0pIixwYXJzZUVsZW1IdG1sOmV1KDEpfSx7c2VsZWN0b3I6ImgyOm5vdChbZGF0YS13LWUtdHlwZV0pIixwYXJzZUVsZW1IdG1sOmV1KDIpfSx7c2VsZWN0b3I6ImgzOm5vdChbZGF0YS13LWUtdHlwZV0pIixwYXJzZUVsZW1IdG1sOmV1KDMpfSx7c2VsZWN0b3I6Img0Om5vdChbZGF0YS13LWUtdHlwZV0pIixwYXJzZUVsZW1IdG1sOmV1KDQpfSx7c2VsZWN0b3I6Img1Om5vdChbZGF0YS13LWUtdHlwZV0pIixwYXJzZUVsZW1IdG1sOmV1KDUpfV0sbWVudXM6W1hpLFlpLEppLEtpLFFpLFppXSxlZGl0b3JQbHVnaW46ZnVuY3Rpb24odCl7dmFyIG49dC5pbnNlcnRCcmVhazt0Lmluc2VydE5vZGU7dmFyIG89dDtyZXR1cm4gby5pbnNlcnRCcmVhaz1mdW5jdGlvbigpe3ZhciBpPXhvKHIuRWRpdG9yLm5vZGVzKG8se21hdGNoOmZ1bmN0aW9uKHQpe3JldHVybiBlLkRvbUVkaXRvci5nZXROb2RlVHlwZSh0KS5zdGFydHNXaXRoKCJoZWFkZXIiKX0sdW5pdmVyc2FsOiEwfSksMSlbMF07aWYoaSlpZihlLkRvbUVkaXRvci5pc1NlbGVjdGlvbkF0TGluZUVuZCh0LGlbMV0pKXtyLlRyYW5zZm9ybXMuaW5zZXJ0Tm9kZXMobyx7dHlwZToicGFyYWdyYXBoIixjaGlsZHJlbjpbe3RleHQ6IiJ9XX0se21vZGU6ImhpZ2hlc3QifSk7fWVsc2UgbigpO2Vsc2UgbigpO30sb319LHJ1PU9iamVjdC5hc3NpZ24sb3U9T2JqZWN0LmRlZmluZVByb3BlcnR5LGl1PUQoW10uY29uY2F0KSx1dT0hcnV8fGIoKGZ1bmN0aW9uKCl7aWYoeCYmMSE9PXJ1KHtiOjF9LHJ1KG91KHt9LCJhIix7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtvdSh0aGlzLCJiIix7dmFsdWU6MyxlbnVtZXJhYmxlOiExfSk7fX0pLHtiOjJ9KSkuYilyZXR1cm4gITA7dmFyIHQ9e30sZT17fSxuPVN5bWJvbCgpLHI9ImFiY2RlZmdoaWprbG1ub3BxcnN0IjtyZXR1cm4gdFtuXT03LHIuc3BsaXQoIiIpLmZvckVhY2goKGZ1bmN0aW9uKHQpe2VbdF09dDt9KSksNyE9cnUoe30sdClbbl18fFRuKHJ1KHt9LGUpKS5qb2luKCIiKSE9cn0pKT9mdW5jdGlvbih0LGUpe2Zvcih2YXIgbj12dCh0KSxyPWFyZ3VtZW50cy5sZW5ndGgsbz0xLGk9amUuZix1PU0uZjtyPm87KWZvcih2YXIgYSxjPVYoYXJndW1lbnRzW28rK10pLGw9aT9pdShUbihjKSxpKGMpKTpUbihjKSxzPWwubGVuZ3RoLGY9MDtzPmY7KWE9bFtmKytdLHgmJiFFKHUsYyxhKXx8KG5bYV09Y1thXSk7cmV0dXJuIG59OnJ1O2Z1bmN0aW9uIGF1KHQsZSl7bnVsbD09dC5kYXRhJiYodC5kYXRhPXt9KTt2YXIgbj10LmRhdGE7bnVsbD09bi5zdHlsZSYmKG4uc3R5bGU9e30pLE9iamVjdC5hc3NpZ24obi5zdHlsZSxlKTt9cWUoe3RhcmdldDoiT2JqZWN0IixzdGF0OiEwLGZvcmNlZDpPYmplY3QuYXNzaWduIT09dXV9LHthc3NpZ246dXV9KTt2YXIgY3U9e3NlbGVjdG9yOiJmb250IixwcmVQYXJzZUh0bWw6ZnVuY3Rpb24odCl7dmFyIGU9Yy5kZWZhdWx0KHQpO2lmKCJmb250IiE9PWZvKGUpKXJldHVybiB0O3ZhciBuPWUuYXR0cigiY29sb3IiKXx8IiI7cmV0dXJuIG4mJihlLnJlbW92ZUF0dHIoImNvbG9yIiksZS5jc3MoImNvbG9yIixuKSksZVswXX19O3ZhciBsdT1mdW5jdGlvbigpe2Z1bmN0aW9uIHQoKXt0aGlzLnRhZz0iYnV0dG9uIix0aGlzLnNob3dEcm9wUGFuZWw9ITAsdGhpcy4kY29udGVudD1udWxsO31yZXR1cm4gdC5wcm90b3R5cGUuZXhlYz1mdW5jdGlvbih0LGUpe30sdC5wcm90b3R5cGUuZ2V0VmFsdWU9ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5tYXJrLG49ci5FZGl0b3IubWFya3ModCk7cmV0dXJuIG4mJm5bZV0/bltlXToiIn0sdC5wcm90b3R5cGUuaXNBY3RpdmU9ZnVuY3Rpb24odCl7cmV0dXJuICEhdGhpcy5nZXRWYWx1ZSh0KX0sdC5wcm90b3R5cGUuaXNEaXNhYmxlZD1mdW5jdGlvbih0KXtyZXR1cm4gbnVsbD09dC5zZWxlY3Rpb258fCEheG8oci5FZGl0b3Iubm9kZXModCx7bWF0Y2g6ZnVuY3Rpb24obil7cmV0dXJuICJwcmUiPT09ZS5Eb21FZGl0b3IuZ2V0Tm9kZVR5cGUobil8fCEhci5FZGl0b3IuaXNWb2lkKHQsbil9LHVuaXZlcnNhbDohMH0pLDEpWzBdfSx0LnByb3RvdHlwZS5nZXRQYW5lbENvbnRlbnRFbGVtPWZ1bmN0aW9uKHQpe3ZhciBuPXRoaXMubWFyaztpZihudWxsPT10aGlzLiRjb250ZW50KXt2YXIgbz1jLmRlZmF1bHQoJzx1bCBjbGFzcz0idy1lLXBhbmVsLWNvbnRlbnQtY29sb3IiPjwvdWw+Jyk7by5vbigiY2xpY2siLCJsaSIsKGZ1bmN0aW9uKGUpe3ZhciBvPWUudGFyZ2V0O2lmKG51bGwhPW8mJihlLnByZXZlbnREZWZhdWx0KCksbnVsbCE9dC5zZWxlY3Rpb24pKXt2YXIgaT1jLmRlZmF1bHQobykuYXR0cigiZGF0YS12YWx1ZSIpOyIwIj09PWk/ci5FZGl0b3IucmVtb3ZlTWFyayh0LG4pOnIuRWRpdG9yLmFkZE1hcmsodCxuLGkpO319KSksdGhpcy4kY29udGVudD1vO312YXIgaT10aGlzLiRjb250ZW50O2lmKG51bGw9PWkpcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInVsIik7aS5lbXB0eSgpO3ZhciB1PXRoaXMuZ2V0VmFsdWUodCksYT10LmdldE1lbnVDb25maWcobikuY29sb3JzOyh2b2lkIDA9PT1hP1tdOmEpLmZvckVhY2goKGZ1bmN0aW9uKHQpe3ZhciBlPWMuZGVmYXVsdCgnPGRpdiBjbGFzcz0iY29sb3ItYmxvY2siIGRhdGEtdmFsdWU9IicrdCsnIj48L2Rpdj4nKTtlLmNzcygiYmFja2dyb3VuZC1jb2xvciIsdCk7dmFyIG49Yy5kZWZhdWx0KCc8bGkgZGF0YS12YWx1ZT0iJyt0KyciPjwvbGk+Jyk7dT09PXQmJm4uYWRkQ2xhc3MoImFjdGl2ZSIpLG4uYXBwZW5kKGUpLGkuYXBwZW5kKG4pO30pKTt2YXIgbD0iIjsiY29sb3IiPT09biYmKGw9ZS50KCJjb2xvci5kZWZhdWx0IikpLCJiZ0NvbG9yIj09PW4mJihsPWUudCgiY29sb3IuY2xlYXIiKSk7dmFyIHM9Yy5kZWZhdWx0KCdcbiAgICAgIDxsaSBkYXRhLXZhbHVlPSIwIiBjbGFzcz0iY2xlYXIiPlxuICAgICAgICA8c3ZnIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik0yMzYuOCAxMjhMODk2IDc4Ny4yVjEyOEgyMzYuOHogbTYxNC40IDcwNEwxOTIgMTcyLjhWODMyaDY1OS4yek0xOTIgNjRoNzA0YzM4LjQgMCA2NCAyNS42IDY0IDY0djcwNGMwIDM4LjQtMjUuNiA2NC02NCA2NEgxOTJjLTM4LjQgMC02NC0yNS42LTY0LTY0VjEyOGMwLTM4LjQgMjUuNi02NCA2NC02NHoiPjwvcGF0aD48L3N2Zz5cbiAgICAgICAgJytsKyJcbiAgICAgIDwvbGk+XG4gICAgIik7cmV0dXJuIGkucHJlcGVuZChzKSxpWzBdfSx0fSgpLHN1PWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIG4oKXt2YXIgbj1udWxsIT09dCYmdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl8fHRoaXM7cmV0dXJuIG4udGl0bGU9ZS50KCJjb2xvci5jb2xvciIpLG4uaWNvblN2Zz1YbyxuLm1hcms9ImNvbG9yIixufXJldHVybiB2byhuLHQpLG59KGx1KSxmdT1mdW5jdGlvbih0KXtmdW5jdGlvbiBuKCl7dmFyIG49bnVsbCE9PXQmJnQuYXBwbHkodGhpcyxhcmd1bWVudHMpfHx0aGlzO3JldHVybiBuLnRpdGxlPWUudCgiY29sb3IuYmdDb2xvciIpLG4uaWNvblN2Zz1ZbyxuLm1hcms9ImJnQ29sb3IiLG59cmV0dXJuIHZvKG4sdCksbn0obHUpLGR1PVsicmdiKDAsIDAsIDApIiwicmdiKDM4LCAzOCwgMzgpIiwicmdiKDg5LCA4OSwgODkpIiwicmdiKDE0MCwgMTQwLCAxNDApIiwicmdiKDE5MSwgMTkxLCAxOTEpIiwicmdiKDIxNywgMjE3LCAyMTcpIiwicmdiKDIzMywgMjMzLCAyMzMpIiwicmdiKDI0NSwgMjQ1LCAyNDUpIiwicmdiKDI1MCwgMjUwLCAyNTApIiwicmdiKDI1NSwgMjU1LCAyNTUpIiwicmdiKDIyNSwgNjAsIDU3KSIsInJnYigyMzEsIDk1LCA1MSkiLCJyZ2IoMjM1LCAxNDQsIDU4KSIsInJnYigyNDUsIDIxOSwgNzcpIiwicmdiKDExNCwgMTkyLCA2NCkiLCJyZ2IoODksIDE5MSwgMTkyKSIsInJnYig2NiwgMTQ0LCAyNDcpIiwicmdiKDU0LCA4OCwgMjI2KSIsInJnYigxMDYsIDU3LCAyMDEpIiwicmdiKDIxNiwgNjgsIDE0NykiLCJyZ2IoMjUxLCAyMzMsIDIzMCkiLCJyZ2IoMjUyLCAyMzcsIDIyNSkiLCJyZ2IoMjUyLCAyMzksIDIxMikiLCJyZ2IoMjUyLCAyNTEsIDIwNykiLCJyZ2IoMjMxLCAyNDYsIDIxMykiLCJyZ2IoMjE4LCAyNDQsIDI0MCkiLCJyZ2IoMjE3LCAyMzcsIDI1MCkiLCJyZ2IoMjI0LCAyMzIsIDI1MCkiLCJyZ2IoMjM3LCAyMjUsIDI0OCkiLCJyZ2IoMjQ2LCAyMjYsIDIzNCkiLCJyZ2IoMjU1LCAxNjMsIDE1OCkiLCJyZ2IoMjU1LCAxODcsIDE1MCkiLCJyZ2IoMjU1LCAyMTMsIDE0NSkiLCJyZ2IoMjU1LCAyNTEsIDE0MykiLCJyZ2IoMTgzLCAyMzUsIDE0MykiLCJyZ2IoMTM1LCAyMzIsIDIyMikiLCJyZ2IoMTQ1LCAyMTMsIDI1NSkiLCJyZ2IoMTczLCAxOTgsIDI1NSkiLCJyZ2IoMjExLCAxNzMsIDI0NykiLCJyZ2IoMjU1LCAxNzMsIDIxMCkiLCJyZ2IoMjU1LCA3NywgNzkpIiwicmdiKDI1NSwgMTIyLCA2OSkiLCJyZ2IoMjU1LCAxNjksIDY0KSIsInJnYigyNTUsIDIzNiwgNjEpIiwicmdiKDExNSwgMjA5LCA2MSkiLCJyZ2IoNTQsIDIwNywgMjAxKSIsInJnYig2NCwgMTY5LCAyNTUpIiwicmdiKDg5LCAxMjYsIDI0NykiLCJyZ2IoMTQ2LCA4NCwgMjIyKSIsInJnYigyNDcsIDg5LCAxNzEpIiwicmdiKDIwNywgMTksIDM0KSIsInJnYigyMTIsIDU2LCAxMykiLCJyZ2IoMjEyLCAxMDcsIDgpIiwicmdiKDIxMiwgMTc3LCA2KSIsInJnYig1NiwgMTU4LCAxMykiLCJyZ2IoOCwgMTUxLCAxNTYpIiwicmdiKDksIDEwOSwgMjE3KSIsInJnYigyOSwgNTcsIDE5NikiLCJyZ2IoODMsIDI5LCAxNzEpIiwicmdiKDE5NiwgMjksIDEyNykiLCJyZ2IoMTMwLCAwLCAyMCkiLCJyZ2IoMTM1LCAyMCwgMCkiLCJyZ2IoMTM1LCA1NiwgMCkiLCJyZ2IoOTcsIDcxLCAwKSIsInJnYigxOSwgODIsIDApIiwicmdiKDAsIDcxLCA3OSkiLCJyZ2IoMCwgNTgsIDE0MCkiLCJyZ2IoNiwgMTcsIDEyMCkiLCJyZ2IoMzQsIDcsIDk0KSIsInJnYigxMjAsIDYsIDgwKSJdO3ZhciBwdT17cmVuZGVyU3R5bGU6ZnVuY3Rpb24odCxlKXt2YXIgbj10LHI9bi5jb2xvcixvPW4uYmdDb2xvcixpPWU7cmV0dXJuIHImJmF1KGkse2NvbG9yOnJ9KSxvJiZhdShpLHtiYWNrZ3JvdW5kQ29sb3I6b30pLGl9LHN0eWxlVG9IdG1sOmZ1bmN0aW9uKHQsZSl7aWYoIXIuVGV4dC5pc1RleHQodCkpcmV0dXJuIGU7dmFyIG4sbz10LGk9by5jb2xvcix1PW8uYmdDb2xvcjtyZXR1cm4gaXx8dT8oKGxvKGUpfHwic3BhbiIhPT1mbyhuPWMuZGVmYXVsdChlKSkpJiYobj1jLmRlZmF1bHQoIjxzcGFuPiIrZSsiPC9zcGFuPiIpKSxpJiZuLmNzcygiY29sb3IiLGkpLHUmJm4uY3NzKCJiYWNrZ3JvdW5kLWNvbG9yIix1KSxzbyhuKSk6ZX0scHJlUGFyc2VIdG1sOltjdV0scGFyc2VTdHlsZUh0bWw6ZnVuY3Rpb24odCxlLG4pe3ZhciBvPWMuZGVmYXVsdCh0KTtpZighci5UZXh0LmlzVGV4dChlKSlyZXR1cm4gZTt2YXIgaT1lLHU9cG8obywiY29sb3IiKTt1JiYoaS5jb2xvcj11KTt2YXIgYT1wbyhvLCJiYWNrZ3JvdW5kLWNvbG9yIik7cmV0dXJuIGF8fChhPXBvKG8sImJhY2tncm91bmQiKSksYSYmKGkuYmdDb2xvcj1hKSxpfSxtZW51czpbe2tleToiY29sb3IiLGZhY3Rvcnk6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IHN1fSxjb25maWc6e2NvbG9yczpkdX19LHtrZXk6ImJnQ29sb3IiLGZhY3Rvcnk6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IGZ1fSxjb25maWc6e2NvbG9yczpkdX19XX0saHU9ZnVuY3Rpb24odCl7aWYoInN0cmluZyIhPXR5cGVvZiB0KXJldHVybiAhMTt2YXIgZT10Lm1hdGNoKHZ1KTtpZighZSlyZXR1cm4gITE7dmFyIG49ZVsxXTtpZighbilyZXR1cm4gITE7aWYoZ3UudGVzdChuKXx8bXUudGVzdChuKSlyZXR1cm4gITA7cmV0dXJuICExfSx2dT0vXig/Olx3KzopP1wvXC8oXFMrKSQvLGd1PS9ebG9jYWxob3N0W1w6P1xkXSooPzpbXlw6P1xkXVxTKik/JC8sbXU9L15bXlxzXC5dK1wuXFN7Mix9JC87dmFyIHl1PWtlLmluY2x1ZGVzO2Z1bmN0aW9uIGJ1KHQpe3JldHVybiB2b2lkIDA9PT10JiYodD0iciIpLHQrIi0iK2kubmFub2lkKCl9ZnVuY3Rpb24geHUodCl7cmV0dXJuIHQucmVwbGFjZSgvPC9nLCImbHQ7IikucmVwbGFjZSgvPi9nLCImZ3Q7Iil9ZnVuY3Rpb24gd3UodCxlLG4scil7cmV0dXJuIG1vKHRoaXMsdm9pZCAwLHZvaWQgMCwoZnVuY3Rpb24oKXt2YXIgbyxpO3JldHVybiB5byh0aGlzLChmdW5jdGlvbih1KXtzd2l0Y2godS5sYWJlbCl7Y2FzZSAwOnJldHVybiAobz1lLmdldE1lbnVDb25maWcodCkuY2hlY2tMaW5rKT9bNCxvKG4scildOlszLDJdO2Nhc2UgMTppZigic3RyaW5nIj09dHlwZW9mKGk9dS5zZW50KCkpKXJldHVybiBlLmFsZXJ0KGksImVycm9yIiksWzIsITFdO2lmKG51bGw9PWkpcmV0dXJuIFsyLCExXTt1LmxhYmVsPTI7Y2FzZSAyOnJldHVybiBbMiwhMF19fSkpfSkpfWZ1bmN0aW9uIEV1KHQsZSxuKXtyZXR1cm4gbW8odGhpcyx2b2lkIDAsdm9pZCAwLChmdW5jdGlvbigpe3ZhciByO3JldHVybiB5byh0aGlzLChmdW5jdGlvbihvKXtzd2l0Y2goby5sYWJlbCl7Y2FzZSAwOnJldHVybiAocj1lLmdldE1lbnVDb25maWcodCkucGFyc2VMaW5rVXJsKT9bNCxyKG4pXTpbMywyXTtjYXNlIDE6cmV0dXJuIFsyLG8uc2VudCgpXTtjYXNlIDI6cmV0dXJuIFsyLG5dfX0pKX0pKX1mdW5jdGlvbiBTdSh0KXtyZXR1cm4gbnVsbD09dC5zZWxlY3Rpb258fCEhZS5Eb21FZGl0b3IuZ2V0U2VsZWN0ZWRFbGVtcyh0KS5zb21lKChmdW5jdGlvbihlKXt2YXIgbj1lLnR5cGU7cmV0dXJuICEhdC5pc1ZvaWQoZSl8fCghIVsicHJlIiwiY29kZSIsImxpbmsiXS5pbmNsdWRlcyhuKXx8dm9pZCAwKX0pKX1mdW5jdGlvbiBrdSh0LGUpe3JldHVybiB7dHlwZToibGluayIsdXJsOnh1KHQpLGNoaWxkcmVuOmU/W3t0ZXh0OmV9XTpbXX19ZnVuY3Rpb24gVHUodCxlLG4pe3JldHVybiBtbyh0aGlzLHZvaWQgMCx2b2lkIDAsKGZ1bmN0aW9uKCl7dmFyIG8saSx1O3JldHVybiB5byh0aGlzLChmdW5jdGlvbihhKXtzd2l0Y2goYS5sYWJlbCl7Y2FzZSAwOnJldHVybiBuPyhlfHwoZT1uKSx0LnJlc3RvcmVTZWxlY3Rpb24oKSxTdSh0KT9bMl06WzQsd3UoImluc2VydExpbmsiLHQsZSxuKV0pOlsyXTtjYXNlIDE6cmV0dXJuIGEuc2VudCgpP1s0LEV1KCJpbnNlcnRMaW5rIix0LG4pXTpbMl07Y2FzZSAyOnJldHVybiBvPWEuc2VudCgpLG51bGw9PShpPXQuc2VsZWN0aW9uKT9bMl06KHIuUmFuZ2UuaXNDb2xsYXBzZWQoaSk/KHQuaW5zZXJ0VGV4dCgiICIpLHU9a3UobyxlKSxyLlRyYW5zZm9ybXMuaW5zZXJ0Tm9kZXModCx1KSx0Lmluc2VydEZyYWdtZW50KFt7dGV4dDoiICJ9XSkpOnIuRWRpdG9yLnN0cmluZyh0LGkpIT09ZT8odC5kZWxldGVGcmFnbWVudCgpLHU9a3UobyxlKSxyLlRyYW5zZm9ybXMuaW5zZXJ0Tm9kZXModCx1KSk6KHU9a3Uobyksci5UcmFuc2Zvcm1zLndyYXBOb2Rlcyh0LHUse3NwbGl0OiEwfSksci5UcmFuc2Zvcm1zLmNvbGxhcHNlKHQse2VkZ2U6ImVuZCJ9KSksWzJdKX19KSl9KSl9cWUoe3RhcmdldDoiQXJyYXkiLHByb3RvOiEwfSx7aW5jbHVkZXM6ZnVuY3Rpb24odCl7cmV0dXJuIHl1KHRoaXMsdCxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCl9fSksRHIoImluY2x1ZGVzIik7dmFyIE11PXt0eXBlOiJsaW5rIixyZW5kZXJFbGVtOmZ1bmN0aW9uKHQsZSxyKXt2YXIgbz10LGk9by51cmwsdT1vLnRhcmdldCxhPXZvaWQgMD09PXU/Il9ibGFuayI6dTtyZXR1cm4gbi5qc3goImEiLHtocmVmOmksdGFyZ2V0OmF9LGUpfX07dmFyIEl1PXt0eXBlOiJsaW5rIixlbGVtVG9IdG1sOmZ1bmN0aW9uKHQsZSl7dmFyIG49dCxyPW4udXJsLG89bi50YXJnZXQ7cmV0dXJuICc8YSBocmVmPSInK3IrJyIgdGFyZ2V0PSInKyh2b2lkIDA9PT1vPyJfYmxhbmsiOm8pKyciPicrZSsiPC9hPiJ9fTt2YXIgTnU9e3NlbGVjdG9yOiJhOm5vdChbZGF0YS13LWUtdHlwZV0pIixwYXJzZUVsZW1IdG1sOmZ1bmN0aW9uKHQsZSxuKXt2YXIgbz1jLmRlZmF1bHQodCk7cmV0dXJuIDA9PT0oZT1lLmZpbHRlcigoZnVuY3Rpb24odCl7cmV0dXJuICEhci5UZXh0LmlzVGV4dCh0KXx8ISFuLmlzSW5saW5lKHQpfSkpKS5sZW5ndGgmJihlPVt7dGV4dDpvLnRleHQoKS5yZXBsYWNlKC9ccysvZ20sIiAiKX1dKSx7dHlwZToibGluayIsdXJsOm8uYXR0cigiaHJlZiIpfHwiIix0YXJnZXQ6by5hdHRyKCJ0YXJnZXQiKXx8IiIsY2hpbGRyZW46ZX19fTtmdW5jdGlvbiBIdSgpe3JldHVybiBidSgidy1lLWluc2VydC1saW5rIil9dmFyIE91PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe3RoaXMudGl0bGU9ZS50KCJsaW5rLmluc2VydCIpLHRoaXMuaWNvblN2Zz0nPHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0Ij48cGF0aCBkPSJNNDQwLjIyNCA2MzUuNzc2YTUxLjg0IDUxLjg0IDAgMCAxLTM2Ljc2OC0xNS4yMzJjLTk1LjEzNi05NS4xMzYtOTUuMTM2LTI0OS45MiAwLTM0NS4wNTZsMTkyLTE5MkM2NDEuNTM2IDM3LjQwOCA3MDIuODE2IDEyLjAzMiA3NjggMTIuMDMyczEyNi40MzIgMjUuMzc2IDE3Mi41NDQgNzEuNDU2Yzk1LjEzNiA5NS4xMzYgOTUuMTM2IDI0OS45MiAwIDM0NS4wNTZsLTg3Ljc3NiA4Ny43NzZhNTEuOTY4IDUxLjk2OCAwIDEgMS03My41MzYtNzMuNTM2bDg3Ljc3Ni04Ny43NzZhMTQwLjE2IDE0MC4xNiAwIDAgMCAwLTE5Ny45ODRjLTI2LjQzMi0yNi40MzItNjEuNi00MC45OTItOTkuMDA4LTQwLjk5MnMtNzIuNTQ0IDE0LjU2LTk5LjAwOCA0MC45OTJsLTE5MiAxOTJhMTQwLjE2IDE0MC4xNiAwIDAgMCAwIDE5Ny45ODQgNTEuOTY4IDUxLjk2OCAwIDAgMS0zNi43NjggODguNzY4eiI+PC9wYXRoPjxwYXRoIGQ9Ik0yNTYgMTAxMmEyNDIuNCAyNDIuNCAwIDAgMS0xNzIuNTQ0LTcxLjQ1NmMtOTUuMTM2LTk1LjEzNi05NS4xMzYtMjQ5LjkyIDAtMzQ1LjA1Nmw4Ny43NzYtODcuNzc2YTUxLjk2OCA1MS45NjggMCAxIDEgNzMuNTM2IDczLjUzNmwtODcuNzc2IDg3Ljc3NmExNDAuMTYgMTQwLjE2IDAgMCAwIDAgMTk3Ljk4NGMyNi40MzIgMjYuNDMyIDYxLjYgNDAuOTkyIDk5LjAwOCA0MC45OTJzNzIuNTQ0LTE0LjU2IDk5LjAwOC00MC45OTJsMTkyLTE5MmExNDAuMTYgMTQwLjE2IDAgMCAwIDAtMTk3Ljk4NCA1MS45NjggNTEuOTY4IDAgMSAxIDczLjUzNi03My41MzZjOTUuMTM2IDk1LjEzNiA5NS4xMzYgMjQ5LjkyIDAgMzQ1LjA1NmwtMTkyIDE5MkEyNDIuNCAyNDIuNCAwIDAgMSAyNTYgMTAxMnoiPjwvcGF0aD48L3N2Zz4nLHRoaXMudGFnPSJidXR0b24iLHRoaXMuc2hvd01vZGFsPSEwLHRoaXMubW9kYWxXaWR0aD0zMDAsdGhpcy4kY29udGVudD1udWxsLHRoaXMudGV4dElucHV0SWQ9SHUoKSx0aGlzLnVybElucHV0SWQ9SHUoKSx0aGlzLmJ1dHRvbklkPUh1KCk7fXJldHVybiB0LnByb3RvdHlwZS5nZXRWYWx1ZT1mdW5jdGlvbih0KXtyZXR1cm4gIiJ9LHQucHJvdG90eXBlLmlzQWN0aXZlPWZ1bmN0aW9uKHQpe3JldHVybiAhMX0sdC5wcm90b3R5cGUuZXhlYz1mdW5jdGlvbih0LGUpe30sdC5wcm90b3R5cGUuaXNEaXNhYmxlZD1mdW5jdGlvbih0KXtyZXR1cm4gU3UodCl9LHQucHJvdG90eXBlLmdldE1vZGFsUG9zaXRpb25Ob2RlPWZ1bmN0aW9uKHQpe3JldHVybiBudWxsfSx0LnByb3RvdHlwZS5nZXRNb2RhbENvbnRlbnRFbGVtPWZ1bmN0aW9uKHQpe3ZhciBuPXQuc2VsZWN0aW9uLG89dGhpcyxpPW8udGV4dElucHV0SWQsdT1vLnVybElucHV0SWQsYT1vLmJ1dHRvbklkLGw9eG8oZS5nZW5Nb2RhbElucHV0RWxlbXMoZS50KCJsaW5rLnRleHQiKSxpKSwyKSxzPWxbMF0sZj1sWzFdLGQ9Yy5kZWZhdWx0KGYpLHA9eG8oZS5nZW5Nb2RhbElucHV0RWxlbXMoZS50KCJsaW5rLnVybCIpLHUpLDIpLGg9cFswXSx2PXBbMV0sZz1jLmRlZmF1bHQodiksbT14byhlLmdlbk1vZGFsQnV0dG9uRWxlbXMoYSxlLnQoImNvbW1vbi5vayIpKSwxKVswXTtpZihudWxsPT10aGlzLiRjb250ZW50KXt2YXIgeT1jLmRlZmF1bHQoIjxkaXY+PC9kaXY+Iik7eS5vbigiY2xpY2siLCIjIithLChmdW5jdGlvbihlKXtlLnByZXZlbnREZWZhdWx0KCk7dmFyIG49eS5maW5kKCIjIitpKS52YWwoKSxyPXkuZmluZCgiIyIrdSkudmFsKCk7VHUodCxuLHIpLHQuaGlkZVBhbmVsT3JNb2RhbCgpO30pKSx0aGlzLiRjb250ZW50PXk7fXZhciBiPXRoaXMuJGNvbnRlbnQ7aWYoYi5lbXB0eSgpLGIuYXBwZW5kKHMpLGIuYXBwZW5kKGgpLGIuYXBwZW5kKG0pLG51bGw9PW58fHIuUmFuZ2UuaXNDb2xsYXBzZWQobikpZC52YWwoIiIpO2Vsc2Uge3ZhciB4PXIuRWRpdG9yLnN0cmluZyh0LG4pO2QudmFsKHgpO31yZXR1cm4gZy52YWwoIiIpLHNldFRpbWVvdXQoKGZ1bmN0aW9uKCl7ZC5mb2N1cygpO30pKSxiWzBdfSx0fSgpO2Z1bmN0aW9uIGp1KCl7cmV0dXJuIGJ1KCJ3LWUtdXBkYXRlLWxpbmsiKX12YXIgRHU9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KCl7dGhpcy50aXRsZT1lLnQoImxpbmsuZWRpdCIpLHRoaXMuaWNvblN2Zz1Hbyx0aGlzLnRhZz0iYnV0dG9uIix0aGlzLnNob3dNb2RhbD0hMCx0aGlzLm1vZGFsV2lkdGg9MzAwLHRoaXMuJGNvbnRlbnQ9bnVsbCx0aGlzLnVybElucHV0SWQ9anUoKSx0aGlzLmJ1dHRvbklkPWp1KCk7fXJldHVybiB0LnByb3RvdHlwZS5nZXRTZWxlY3RlZExpbmtFbGVtPWZ1bmN0aW9uKHQpe3ZhciBuPWUuRG9tRWRpdG9yLmdldFNlbGVjdGVkTm9kZUJ5VHlwZSh0LCJsaW5rIik7cmV0dXJuIG51bGw9PW4/bnVsbDpufSx0LnByb3RvdHlwZS5nZXRWYWx1ZT1mdW5jdGlvbih0KXt2YXIgZT10aGlzLmdldFNlbGVjdGVkTGlua0VsZW0odCk7cmV0dXJuIGUmJmUudXJsfHwiIn0sdC5wcm90b3R5cGUuaXNBY3RpdmU9ZnVuY3Rpb24odCl7cmV0dXJuICExfSx0LnByb3RvdHlwZS5leGVjPWZ1bmN0aW9uKHQsZSl7fSx0LnByb3RvdHlwZS5pc0Rpc2FibGVkPWZ1bmN0aW9uKHQpe3JldHVybiBudWxsPT10LnNlbGVjdGlvbnx8bnVsbD09dGhpcy5nZXRTZWxlY3RlZExpbmtFbGVtKHQpfSx0LnByb3RvdHlwZS5nZXRNb2RhbFBvc2l0aW9uTm9kZT1mdW5jdGlvbih0KXtyZXR1cm4gZS5Eb21FZGl0b3IuZ2V0U2VsZWN0ZWROb2RlQnlUeXBlKHQsImxpbmsiKX0sdC5wcm90b3R5cGUuZ2V0TW9kYWxDb250ZW50RWxlbT1mdW5jdGlvbih0KXt2YXIgbj10aGlzLnVybElucHV0SWQsbz10aGlzLmJ1dHRvbklkLGk9eG8oZS5nZW5Nb2RhbElucHV0RWxlbXMoZS50KCJsaW5rLnVybCIpLG4pLDIpLHU9aVswXSxhPWlbMV0sbD1jLmRlZmF1bHQoYSkscz14byhlLmdlbk1vZGFsQnV0dG9uRWxlbXMobyxlLnQoImNvbW1vbi5vayIpKSwxKVswXTtpZihudWxsPT10aGlzLiRjb250ZW50KXt2YXIgZj1jLmRlZmF1bHQoIjxkaXY+PC9kaXY+Iik7Zi5vbigiY2xpY2siLCJidXR0b24iLChmdW5jdGlvbihvKXtvLnByZXZlbnREZWZhdWx0KCksdC5yZXN0b3JlU2VsZWN0aW9uKCk7dmFyIGk9ZS5Eb21FZGl0b3IuZ2V0U2VsZWN0ZWROb2RlQnlUeXBlKHQsImxpbmsiKSx1PWk/ci5Ob2RlLnN0cmluZyhpKToiIixhPWYuZmluZCgiIyIrbikudmFsKCk7IWZ1bmN0aW9uKHQsbixvKXttbyh0aGlzLHZvaWQgMCx2b2lkIDAsKGZ1bmN0aW9uKCl7dmFyIGksdTtyZXR1cm4geW8odGhpcywoZnVuY3Rpb24oYSl7c3dpdGNoKGEubGFiZWwpe2Nhc2UgMDpyZXR1cm4gbz9bNCx3dSgiZWRpdExpbmsiLHQsbixvKV06WzJdO2Nhc2UgMTpyZXR1cm4gYS5zZW50KCk/WzQsRXUoImVkaXRMaW5rIix0LG8pXTpbMl07Y2FzZSAyOnJldHVybiBpPWEuc2VudCgpLHU9e3VybDp4dShpKX0sci5UcmFuc2Zvcm1zLnNldE5vZGVzKHQsdSx7bWF0Y2g6ZnVuY3Rpb24odCl7cmV0dXJuIGUuRG9tRWRpdG9yLmNoZWNrTm9kZVR5cGUodCwibGluayIpfX0pLFsyXX19KSl9KSk7fSh0LHUsYSksdC5oaWRlUGFuZWxPck1vZGFsKCk7fSkpLHRoaXMuJGNvbnRlbnQ9Zjt9dmFyIGQ9dGhpcy4kY29udGVudDtkLmVtcHR5KCksZC5hcHBlbmQodSksZC5hcHBlbmQocyk7dmFyIHA9dGhpcy5nZXRWYWx1ZSh0KTtyZXR1cm4gbC52YWwocCksc2V0VGltZW91dCgoZnVuY3Rpb24oKXtsLmZvY3VzKCk7fSkpLGRbMF19LHR9KCksTHU9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KCl7dGhpcy50aXRsZT1lLnQoImxpbmsudW5MaW5rIiksdGhpcy5pY29uU3ZnPSc8c3ZnIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik02MDguMTYzMjggODExLjgxNTAzNmM5LjM3MTk1NCA5LjM3MTk1NCA5LjM3MTk1NCAyNC41Njc4OCAwIDMzLjk0MTgzNGwtODkuMzQ3NTYzIDg5LjM0NzU2NGMtMTE4LjUyNTQyMSAxMTguNTIzNDIxLTMxMS4zODQ0OCAxMTguNTMxNDIxLTQyOS45MTk5MDEgMC0xMTguNTI3NDIxLTExOC41Mjk0MjEtMTE4LjUyNzQyMS0zMTEuMzkwNDggMC00MjkuOTE3OTAxbDg5LjM0OTU2NC04OS4zNDk1NjNjOS4zNzE5NTQtOS4zNzE5NTQgMjQuNTY3ODgtOS4zNzE5NTQgMzMuOTQxODM0IDBsNzkuMTk1NjEzIDc5LjE5NTYxM2M5LjM3MTk1NCA5LjM3MTk1NCA5LjM3MTk1NCAyNC41Njc4OCAwIDMzLjk0MTgzNGwtODkuMzQ5NTYzIDg5LjM0NzU2NGMtNTYuMTQzNzI2IDU2LjE0NTcyNi01Ni4xNDM3MjYgMTQ3LjQ5OTI4IDAgMjAzLjY0NTAwNSA1Ni4xNDM3MjYgNTYuMTQzNzI2IDE0Ny40OTkyOCA1Ni4xNDU3MjYgMjAzLjY0NzAwNSAwbDg5LjM0NzU2NC04OS4zNDc1NjNjOS4zNzE5NTQtOS4zNzE5NTQgMjQuNTY3ODgtOS4zNzE5NTQgMzMuOTQxODM0IDBsNzkuMTkzNjEzIDc5LjE5NTYxM3ogbS0xMTMuMTM1NDQ3LTUyMC40Mjk0NTljOS4zNzE5NTQgOS4zNzE5NTQgMjQuNTY3ODggOS4zNzE5NTQgMzMuOTQxODM0IDBsODkuMzQ3NTY0LTg5LjM0NzU2NGM1Ni4xNDM3MjYtNTYuMTQ5NzI2IDE0Ny40OTkyOC01Ni4xNDU3MjYgMjAzLjY0NzAwNiAwIDU2LjE0MzcyNiA1Ni4xNDU3MjYgNTYuMTQzNzI2IDE0Ny40OTkyOCAwIDIwMy42NDUwMDZsLTg5LjM0OTU2NCA4OS4zNDc1NjRjLTkuMzcxOTU0IDkuMzcxOTU0LTkuMzcxOTU0IDI0LjU2Nzg4IDAgMzMuOTQxODM0bDc5LjE5NTYxMyA3OS4xOTU2MTNjOS4zNzE5NTQgOS4zNzE5NTQgMjQuNTY3ODggOS4zNzE5NTQgMzMuOTQxODM0IDBsODkuMzQ5NTY0LTg5LjM0OTU2M2MxMTguNTI5NDIxLTExOC41Mjk0MjEgMTE4LjUyOTQyMS0zMTEuMzg4NDggMC00MjkuOTE3OTAxLTExOC41MzE0MjEtMTE4LjUyNzQyMS0zMTEuMzg4NDgtMTE4LjUyNzQyMS00MjkuOTE5OTAxIDBsLTg5LjM0NzU2MyA4OS4zNDc1NjRjLTkuMzcxOTU0IDkuMzcxOTU0LTkuMzcxOTU0IDI0LjU2Nzg4IDAgMzMuOTQxODM0bDc5LjE5MzYxMyA3OS4xOTU2MTN6IG00NjkuNjUzNzA3IDcxOC41NTY0OTJsNDUuMjUzNzc5LTQ1LjI1Mzc3OWMxOC43NDU5MDgtMTguNzQ1OTA4IDE4Ljc0NTkwOC00OS4xMzc3NiAwLTY3Ljg4MTY2OUwxMjcuMTk1NjI5IDE0LjA2MjkzMWMtMTguNzQ1OTA4LTE4Ljc0NTkwOC00OS4xMzc3Ni0xOC43NDU5MDgtNjcuODgxNjY5IDBMMTQuMDU4MTgxIDU5LjMxODcxYy0xOC43NDU5MDggMTguNzQ1OTA4LTE4Ljc0NTkwOCA0OS4xMzc3NiAwIDY3Ljg4MTY2OWw4ODIuNzQxNjkgODgyLjc0MTY5YzE4Ljc0NTkwOCAxOC43NDM5MDggNDkuMTM3NzYgMTguNzQzOTA4IDY3Ljg4MTY2OSAweiI+PC9wYXRoPjwvc3ZnPicsdGhpcy50YWc9ImJ1dHRvbiI7fXJldHVybiB0LnByb3RvdHlwZS5nZXRWYWx1ZT1mdW5jdGlvbih0KXtyZXR1cm4gIiJ9LHQucHJvdG90eXBlLmlzQWN0aXZlPWZ1bmN0aW9uKHQpe3JldHVybiAhMX0sdC5wcm90b3R5cGUuaXNEaXNhYmxlZD1mdW5jdGlvbih0KXtyZXR1cm4gbnVsbD09dC5zZWxlY3Rpb258fG51bGw9PWUuRG9tRWRpdG9yLmdldFNlbGVjdGVkTm9kZUJ5VHlwZSh0LCJsaW5rIil9LHQucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24odCxuKXt0aGlzLmlzRGlzYWJsZWQodCl8fHIuVHJhbnNmb3Jtcy51bndyYXBOb2Rlcyh0LHttYXRjaDpmdW5jdGlvbih0KXtyZXR1cm4gZS5Eb21FZGl0b3IuY2hlY2tOb2RlVHlwZSh0LCJsaW5rIil9fSk7fSx0fSgpLHp1PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe3RoaXMudGl0bGU9ZS50KCJsaW5rLnZpZXciKSx0aGlzLmljb25Tdmc9VW8sdGhpcy50YWc9ImJ1dHRvbiI7fXJldHVybiB0LnByb3RvdHlwZS5nZXRTZWxlY3RlZExpbmtFbGVtPWZ1bmN0aW9uKHQpe3ZhciBuPWUuRG9tRWRpdG9yLmdldFNlbGVjdGVkTm9kZUJ5VHlwZSh0LCJsaW5rIik7cmV0dXJuIG51bGw9PW4/bnVsbDpufSx0LnByb3RvdHlwZS5nZXRWYWx1ZT1mdW5jdGlvbih0KXt2YXIgZT10aGlzLmdldFNlbGVjdGVkTGlua0VsZW0odCk7cmV0dXJuIGUmJmUudXJsfHwiIn0sdC5wcm90b3R5cGUuaXNBY3RpdmU9ZnVuY3Rpb24odCl7cmV0dXJuICExfSx0LnByb3RvdHlwZS5pc0Rpc2FibGVkPWZ1bmN0aW9uKHQpe3JldHVybiBudWxsPT10LnNlbGVjdGlvbnx8bnVsbD09dGhpcy5nZXRTZWxlY3RlZExpbmtFbGVtKHQpfSx0LnByb3RvdHlwZS5leGVjPWZ1bmN0aW9uKHQsZSl7aWYoIXRoaXMuaXNEaXNhYmxlZCh0KSl7aWYoIWV8fCJzdHJpbmciIT10eXBlb2YgZSl0aHJvdyBuZXcgRXJyb3IoIlZpZXcgbGluayBmYWlsZWQsIGxpbmsgdXJsIGlzICciK2UrIiciKTt3aW5kb3cub3BlbihlLCJfYmxhbmsiKTt9fSx0fSgpO3ZhciBBdT17Y2hlY2tMaW5rOmZ1bmN0aW9uKHQsZSl7cmV0dXJuICEwfSxwYXJzZUxpbmtVcmw6ZnVuY3Rpb24odCl7cmV0dXJuIHR9fSxQdT17cmVuZGVyRWxlbXM6W011XSxlbGVtc1RvSHRtbDpbSXVdLHBhcnNlRWxlbXNIdG1sOltOdV0sbWVudXM6W3trZXk6Imluc2VydExpbmsiLGZhY3Rvcnk6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IE91fSxjb25maWc6QXV9LHtrZXk6ImVkaXRMaW5rIixmYWN0b3J5OmZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBEdX0sY29uZmlnOkF1fSx7a2V5OiJ1bkxpbmsiLGZhY3Rvcnk6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IEx1fX0se2tleToidmlld0xpbmsiLGZhY3Rvcnk6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IHp1fX1dLGVkaXRvclBsdWdpbjpmdW5jdGlvbih0KXt2YXIgbj10LmlzSW5saW5lLG89dC5pbnNlcnREYXRhLGk9dC5ub3JtYWxpemVOb2RlO3QuaW5zZXJ0Tm9kZSx0Lmluc2VydFRleHQ7dmFyIHU9dDtyZXR1cm4gdS5pc0lubGluZT1mdW5jdGlvbih0KXtyZXR1cm4gImxpbmsiPT09dC50eXBlfHxuKHQpfSx1Lmluc2VydERhdGE9ZnVuY3Rpb24odCl7dmFyIGU9dC5nZXREYXRhKCJ0ZXh0L3BsYWluIik7aWYoaHUoZSkpe2lmKCFTdSh1KSl7dmFyIG49dS5zZWxlY3Rpb247aWYobnVsbCE9bil7dmFyIGk9ci5FZGl0b3Iuc3RyaW5nKHUsbik7VHUodSxpLGUpO319fWVsc2Ugbyh0KTt9LHUubm9ybWFsaXplTm9kZT1mdW5jdGlvbih0KXt2YXIgbj14byh0LDIpLG89blswXSxhPW5bMV07cmV0dXJuICJsaW5rIiE9PWUuRG9tRWRpdG9yLmdldE5vZGVUeXBlKG8pP2koW28sYV0pOiIiPT09ci5Ob2RlLnN0cmluZyhvKT9yLlRyYW5zZm9ybXMucmVtb3ZlTm9kZXModSx7YXQ6YX0pOmkoW28sYV0pfSx1fX07dmFyIEN1PUQoMS4udmFsdWVPZiksVnU9eS5SYW5nZUVycm9yLEJ1PXkuUmFuZ2VFcnJvcixSdT15LlN0cmluZyxGdT1NYXRoLmZsb29yLF91PUQoKGZ1bmN0aW9uKHQpe3ZhciBlPWJuKFIodGhpcykpLG49IiIscj1nZSh0KTtpZihyPDB8fHI9PTEvMCl0aHJvdyBWdSgiV3JvbmcgbnVtYmVyIG9mIHJlcGV0aXRpb25zIik7Zm9yKDtyPjA7KHI+Pj49MSkmJihlKz1lKSkxJnImJihuKz1lKTtyZXR1cm4gbn0pKSxxdT1EKCIiLnNsaWNlKSwkdT1EKDEuLnRvRml4ZWQpLFd1PWZ1bmN0aW9uKHQsZSxuKXtyZXR1cm4gMD09PWU/bjplJTI9PTE/V3UodCxlLTEsbip0KTpXdSh0KnQsZS8yLG4pfSxHdT1mdW5jdGlvbih0LGUsbil7Zm9yKHZhciByPS0xLG89bjsrK3I8Njspbys9ZSp0W3JdLHRbcl09byUxZTcsbz1GdShvLzFlNyk7fSxVdT1mdW5jdGlvbih0LGUpe2Zvcih2YXIgbj02LHI9MDstLW4+PTA7KXIrPXRbbl0sdFtuXT1GdShyL2UpLHI9ciVlKjFlNzt9LFh1PWZ1bmN0aW9uKHQpe2Zvcih2YXIgZT02LG49IiI7LS1lPj0wOylpZigiIiE9PW58fDA9PT1lfHwwIT09dFtlXSl7dmFyIHI9UnUodFtlXSk7bj0iIj09PW4/cjpuK191KCIwIiw3LXIubGVuZ3RoKStyO31yZXR1cm4gbn07ZnVuY3Rpb24gWXUodCxuKXtyZXR1cm4gInctZS1pbWFnZS1jb250YWluZXItIitlLkRvbUVkaXRvci5maW5kS2V5KHQsbikuaWR9ZnVuY3Rpb24gSnUodCxvLGksdSl7dmFyIGE9Yy5kZWZhdWx0KCJib2R5Iikscz1ZdSh0LG8pLGY9dS53aWR0aCxkPXUuaGVpZ2h0LHA9MCxoPTAsdj0wLGc9ITEsbT1udWxsO2Z1bmN0aW9uIHkobil7bT1mdW5jdGlvbigpe3ZhciB0PWMuZGVmYXVsdCgiIyIrcyk7aWYoMD09PXQubGVuZ3RoKXRocm93IG5ldyBFcnJvcigiQ2Fubm90IGZpbmQgaW1hZ2UgY29udGFpbmVyIGVsZW0iKTtyZXR1cm4gdH0oKSxwPW47dmFyIHI9bS5maW5kKCJpbWciKTtpZigwPT09ci5sZW5ndGgpdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgZmluZCBpbWFnZSBlbGVtIik7aD1yLndpZHRoKCksdj1yLmhlaWdodCgpLGEub24oIm1vdXNlbW92ZSIsYiksYS5vbigibW91c2V1cCIseCk7dmFyIG89ZS5Eb21FZGl0b3IuZ2V0SG92ZXJiYXIodCk7byYmby5oaWRlQW5kQ2xlYW4oKTt9dmFyIGI9bC5kZWZhdWx0KChmdW5jdGlvbih0KXt0LnByZXZlbnREZWZhdWx0KCk7dmFyIGU9dC5jbGllbnRYLG49aCsoZz9wLWU6ZS1wKSxyPXYqKG4vaCk7bnVsbCE9bSYmKG48PTE1fHxyPD0xNXx8KG0uY3NzKCJ3aWR0aCIsbisicHgiKSxtLmNzcygiaGVpZ2h0IixyKyJweCIpKSk7fSksMTAwKTtmdW5jdGlvbiB4KG4pe2lmKGEub2ZmKCJtb3VzZW1vdmUiLGIpLG51bGwhPW0pe3ZhciBpPW0ud2lkdGgoKS50b0ZpeGVkKDIpLHU9bS5oZWlnaHQoKS50b0ZpeGVkKDIpLGM9e3N0eWxlOmdvKGdvKHt9LG8uc3R5bGUpLHt3aWR0aDppKyJweCIsaGVpZ2h0OnUrInB4In0pfTtyLlRyYW5zZm9ybXMuc2V0Tm9kZXModCxjLHthdDplLkRvbUVkaXRvci5maW5kUGF0aCh0LG8pfSksYS5vZmYoIm1vdXNldXAiLHgpO319dmFyIHc9e307cmV0dXJuIGYmJih3LndpZHRoPWYpLGQmJih3LmhlaWdodD1kKSxuLmpzeCgiZGl2Iix7aWQ6cyxzdHlsZTp3LGNsYXNzTmFtZToidy1lLWltYWdlLWNvbnRhaW5lciB3LWUtc2VsZWN0ZWQtaW1hZ2UtY29udGFpbmVyIixvbjp7bW91c2Vkb3duOmZ1bmN0aW9uKHQpe3ZhciBlPWMuZGVmYXVsdCh0LnRhcmdldCk7ZS5oYXNDbGFzcygidy1lLWltYWdlLWRyYWdnZXIiKSYmKHQucHJldmVudERlZmF1bHQoKSwoZS5oYXNDbGFzcygibGVmdC10b3AiKXx8ZS5oYXNDbGFzcygibGVmdC1ib3R0b20iKSkmJihnPSEwKSx5KHQuY2xpZW50WCkpO319fSxpLG4uanN4KCJkaXYiLHtjbGFzc05hbWU6InctZS1pbWFnZS1kcmFnZ2VyIGxlZnQtdG9wIn0pLG4uanN4KCJkaXYiLHtjbGFzc05hbWU6InctZS1pbWFnZS1kcmFnZ2VyIHJpZ2h0LXRvcCJ9KSxuLmpzeCgiZGl2Iix7Y2xhc3NOYW1lOiJ3LWUtaW1hZ2UtZHJhZ2dlciBsZWZ0LWJvdHRvbSJ9KSxuLmpzeCgiZGl2Iix7Y2xhc3NOYW1lOiJ3LWUtaW1hZ2UtZHJhZ2dlciByaWdodC1ib3R0b20ifSkpfXFlKHt0YXJnZXQ6Ik51bWJlciIscHJvdG86ITAsZm9yY2VkOmIoKGZ1bmN0aW9uKCl7cmV0dXJuICIwLjAwMCIhPT0kdSg4ZS01LDMpfHwiMSIhPT0kdSguOSwwKXx8IjEuMjUiIT09JHUoMS4yNTUsMil8fCIxMDAwMDAwMDAwMDAwMDAwMTI4IiE9PSR1KDB4ZGUwYjZiM2E3NjQwMDgwLDApfSkpfHwhYigoZnVuY3Rpb24oKXskdSh7fSk7fSkpfSx7dG9GaXhlZDpmdW5jdGlvbih0KXt2YXIgZSxuLHIsbyxpPUN1KHRoaXMpLHU9Z2UodCksYT1bMCwwLDAsMCwwLDBdLGM9IiIsbD0iMCI7aWYodTwwfHx1PjIwKXRocm93IEJ1KCJJbmNvcnJlY3QgZnJhY3Rpb24gZGlnaXRzIik7aWYoaSE9aSlyZXR1cm4gIk5hTiI7aWYoaTw9LTFlMjF8fGk+PTFlMjEpcmV0dXJuIFJ1KGkpO2lmKGk8MCYmKGM9Ii0iLGk9LWkpLGk+MWUtMjEpaWYobj0oZT1mdW5jdGlvbih0KXtmb3IodmFyIGU9MCxuPXQ7bj49NDA5NjspZSs9MTIsbi89NDA5Njtmb3IoO24+PTI7KWUrPTEsbi89MjtyZXR1cm4gZX0oaSpXdSgyLDY5LDEpKS02OSk8MD9pKld1KDIsLWUsMSk6aS9XdSgyLGUsMSksbio9NDUwMzU5OTYyNzM3MDQ5NiwoZT01Mi1lKT4wKXtmb3IoR3UoYSwwLG4pLHI9dTtyPj03OylHdShhLDFlNywwKSxyLT03O2ZvcihHdShhLFd1KDEwLHIsMSksMCkscj1lLTE7cj49MjM7KVV1KGEsMTw8MjMpLHItPTIzO1V1KGEsMTw8ciksR3UoYSwxLDEpLFV1KGEsMiksbD1YdShhKTt9ZWxzZSBHdShhLDAsbiksR3UoYSwxPDwtZSwwKSxsPVh1KGEpK191KCIwIix1KTtyZXR1cm4gbD11PjA/YysoKG89bC5sZW5ndGgpPD11PyIwLiIrX3UoIjAiLHUtbykrbDpxdShsLDAsby11KSsiLiIrcXUobCxvLXUpKTpjK2x9fSk7dmFyIEt1PXt0eXBlOiJpbWFnZSIscmVuZGVyRWxlbTpmdW5jdGlvbih0LHIsbyl7dmFyIGk9dCx1PWkuc3JjLGE9aS5hbHQsYz12b2lkIDA9PT1hPyIiOmEsbD1pLmhyZWYscz12b2lkIDA9PT1sPyIiOmwsZj1pLnN0eWxlLGQ9dm9pZCAwPT09Zj97fTpmLHA9ZC53aWR0aCxoPXZvaWQgMD09PXA/IiI6cCx2PWQuaGVpZ2h0LGc9dm9pZCAwPT09dj8iIjp2LG09ZS5Eb21FZGl0b3IuaXNOb2RlU2VsZWN0ZWQobyx0KSx5PXt9O2gmJih5LndpZHRoPSIxMDAlIiksZyYmKHkuaGVpZ2h0PSIxMDAlIik7dmFyIGI9bi5qc3goImltZyIse3N0eWxlOnksc3JjOnUsYWx0OmMsImRhdGEtaHJlZiI6c30pLHg9by5pc0Rpc2FibGVkKCk7cmV0dXJuIG0mJiF4P0p1KG8sdCxiLHt3aWR0aDpoLGhlaWdodDpnfSk6ZnVuY3Rpb24odCxlLHIsbyl7dmFyIGk9by53aWR0aCx1PW8uaGVpZ2h0LGE9e307aSYmKGEud2lkdGg9aSksdSYmKGEuaGVpZ2h0PXUpO3ZhciBjPVl1KHQsZSk7cmV0dXJuIG4uanN4KCJkaXYiLHtpZDpjLHN0eWxlOmEsY2xhc3NOYW1lOiJ3LWUtaW1hZ2UtY29udGFpbmVyIn0scil9KG8sdCxiLHt3aWR0aDpoLGhlaWdodDpnfSl9fTt2YXIgUXU9e3R5cGU6ImltYWdlIixlbGVtVG9IdG1sOmZ1bmN0aW9uKHQsZSl7dmFyIG49dCxyPW4uc3JjLG89bi5hbHQsaT12b2lkIDA9PT1vPyIiOm8sdT1uLmhyZWYsYT12b2lkIDA9PT11PyIiOnUsYz1uLnN0eWxlLGw9dm9pZCAwPT09Yz97fTpjLHM9bC53aWR0aCxmPXZvaWQgMD09PXM/IiI6cyxkPWwuaGVpZ2h0LHA9dm9pZCAwPT09ZD8iIjpkLGg9IiI7cmV0dXJuIGYmJihoKz0id2lkdGg6ICIrZisiOyIpLHAmJihoKz0iaGVpZ2h0OiAiK3ArIjsiKSwnPGltZyBzcmM9IicrcisnIiBhbHQ9IicraSsnIiBkYXRhLWhyZWY9IicrYSsnIiBzdHlsZT0iJytoKyciLz4nfX07dmFyIFp1PXtzZWxlY3RvcjoiaW1nOm5vdChbZGF0YS13LWUtdHlwZV0pIixwYXJzZUVsZW1IdG1sOmZ1bmN0aW9uKHQsZSxuKXt2YXIgcj1jLmRlZmF1bHQodCksbz1yLmF0dHIoImRhdGEtaHJlZiIpfHwiIjtyZXR1cm4gbz1kZWNvZGVVUklDb21wb25lbnQobykse3R5cGU6ImltYWdlIixzcmM6ci5hdHRyKCJzcmMiKXx8IiIsYWx0OnIuYXR0cigiYWx0Iil8fCIiLGhyZWY6byxzdHlsZTp7d2lkdGg6cG8ociwid2lkdGgiKSxoZWlnaHQ6cG8ociwiaGVpZ2h0Iil9LGNoaWxkcmVuOlt7dGV4dDoiIn1dfX19O2Z1bmN0aW9uIHRhKHQsZSxuLHIsbyl7cmV0dXJuIHZvaWQgMD09PXImJihyPSIiKSx2b2lkIDA9PT1vJiYobz0iIiksbW8odGhpcyx2b2lkIDAsdm9pZCAwLChmdW5jdGlvbigpe3ZhciBpLHU7cmV0dXJuIHlvKHRoaXMsKGZ1bmN0aW9uKGEpe3N3aXRjaChhLmxhYmVsKXtjYXNlIDA6cmV0dXJuIChpPWUuZ2V0TWVudUNvbmZpZyh0KS5jaGVja0ltYWdlKT9bNCxpKG4scixvKV06WzMsMl07Y2FzZSAxOmlmKCJzdHJpbmciPT10eXBlb2YodT1hLnNlbnQoKSkpcmV0dXJuIGUuYWxlcnQodSwiZXJyb3IiKSxbMiwhMV07aWYobnVsbD09dSlyZXR1cm4gWzIsITFdO2EubGFiZWw9MjtjYXNlIDI6cmV0dXJuIFsyLCEwXX19KSl9KSl9ZnVuY3Rpb24gZWEodCxlLG4pe3JldHVybiBtbyh0aGlzLHZvaWQgMCx2b2lkIDAsKGZ1bmN0aW9uKCl7dmFyIHI7cmV0dXJuIHlvKHRoaXMsKGZ1bmN0aW9uKG8pe3N3aXRjaChvLmxhYmVsKXtjYXNlIDA6cmV0dXJuIChyPWUuZ2V0TWVudUNvbmZpZyh0KS5wYXJzZUltYWdlU3JjKT9bNCxyKG4pXTpbMywyXTtjYXNlIDE6cmV0dXJuIFsyLG8uc2VudCgpXTtjYXNlIDI6cmV0dXJuIFsyLG5dfX0pKX0pKX1mdW5jdGlvbiBuYSh0LG4sbyxpKXtyZXR1cm4gdm9pZCAwPT09byYmKG89IiIpLHZvaWQgMD09PWkmJihpPSIiKSxtbyh0aGlzLHZvaWQgMCx2b2lkIDAsKGZ1bmN0aW9uKCl7dmFyIHUsYSxjO3JldHVybiB5byh0aGlzLChmdW5jdGlvbihsKXtzd2l0Y2gobC5sYWJlbCl7Y2FzZSAwOnJldHVybiBbNCx0YSgiaW5zZXJ0SW1hZ2UiLHQsbixvLGkpXTtjYXNlIDE6cmV0dXJuIGwuc2VudCgpP1s0LGVhKCJpbnNlcnRJbWFnZSIsdCxuKV06WzJdO2Nhc2UgMjpyZXR1cm4gdT1sLnNlbnQoKSxhPXt0eXBlOiJpbWFnZSIsc3JjOnh1KHUpLGhyZWY6aSxhbHQ6byxzdHlsZTp7fSxjaGlsZHJlbjpbe3RleHQ6IiJ9XX0sbnVsbD09PXQuc2VsZWN0aW9uJiZ0LnJlc3RvcmVTZWxlY3Rpb24oKSxlLkRvbUVkaXRvci5nZXRTZWxlY3RlZE5vZGVCeVR5cGUodCwiaW1hZ2UiKSYmdC5tb3ZlKDEpLG9hKHQpP1syXTooci5UcmFuc2Zvcm1zLmluc2VydE5vZGVzKHQsYSksKGM9dC5nZXRNZW51Q29uZmlnKCJpbnNlcnRJbWFnZSIpLm9uSW5zZXJ0ZWRJbWFnZSkmJmMoYSksWzJdKX19KSl9KSl9ZnVuY3Rpb24gcmEodCxuLG8saSx1KXtyZXR1cm4gdm9pZCAwPT09byYmKG89IiIpLHZvaWQgMD09PWkmJihpPSIiKSx2b2lkIDA9PT11JiYodT17fSksbW8odGhpcyx2b2lkIDAsdm9pZCAwLChmdW5jdGlvbigpe3ZhciBhLGMsbCxzLGYsZDtyZXR1cm4geW8odGhpcywoZnVuY3Rpb24ocCl7c3dpdGNoKHAubGFiZWwpe2Nhc2UgMDpyZXR1cm4gWzQsdGEoImVkaXRJbWFnZSIsdCxuLG8saSldO2Nhc2UgMTpyZXR1cm4gcC5zZW50KCk/WzQsZWEoImVkaXRJbWFnZSIsdCxuKV06WzJdO2Nhc2UgMjpyZXR1cm4gYT1wLnNlbnQoKSxudWxsPT0oYz1lLkRvbUVkaXRvci5nZXRTZWxlY3RlZE5vZGVCeVR5cGUodCwiaW1hZ2UiKSk/WzJdOihsPWMuc3R5bGUscz17c3JjOmEsYWx0Om8saHJlZjppLHN0eWxlOmdvKGdvKHt9LHZvaWQgMD09PWw/e306bCksdSl9LHIuVHJhbnNmb3Jtcy5zZXROb2Rlcyh0LHMse21hdGNoOmZ1bmN0aW9uKHQpe3JldHVybiBlLkRvbUVkaXRvci5jaGVja05vZGVUeXBlKHQsImltYWdlIil9fSksZj1lLkRvbUVkaXRvci5nZXRTZWxlY3RlZE5vZGVCeVR5cGUodCwiaW1hZ2UiKSwoZD10LmdldE1lbnVDb25maWcoImVkaXRJbWFnZSIpLm9uVXBkYXRlZEltYWdlKSYmZChmKSxbMl0pfX0pKX0pKX1mdW5jdGlvbiBvYSh0KXt2YXIgbj10LnNlbGVjdGlvbjtyZXR1cm4gbnVsbD09bnx8KCFyLlJhbmdlLmlzQ29sbGFwc2VkKG4pfHwhIXhvKHIuRWRpdG9yLm5vZGVzKHQse21hdGNoOmZ1bmN0aW9uKG4pe3ZhciBvPWUuRG9tRWRpdG9yLmdldE5vZGVUeXBlKG4pO3JldHVybiAiY29kZSI9PT1vfHwoInByZSI9PT1vfHwoImxpbmsiPT09b3x8KCJsaXN0LWl0ZW0iPT09b3x8KCEhby5zdGFydHNXaXRoKCJoZWFkZXIiKXx8KCJibG9ja3F1b3RlIj09PW98fCEhci5FZGl0b3IuaXNWb2lkKHQsbikpKSkpKX0sdW5pdmVyc2FsOiEwfSksMSlbMF0pfWZ1bmN0aW9uIGlhKCl7cmV0dXJuIGJ1KCJ3LWUtaW5zZXJ0LWltYWdlIil9dmFyIHVhPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe3RoaXMudGl0bGU9ZS50KCJpbWFnZS5uZXRJbWFnZSIpLHRoaXMuaWNvblN2Zz0nPHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0Ij48cGF0aCBkPSJNOTU5Ljg3NyAxMjhsMC4xMjMgMC4xMjN2NzY3Ljc3NWwtMC4xMjMgMC4xMjJINjQuMTAybC0wLjEyMi0wLjEyMlYxMjguMTIzbDAuMTIyLTAuMTIzaDg5NS43NzV6TTk2MCA2NEg2NEMyOC43OTUgNjQgMCA5Mi43OTUgMCAxMjh2NzY4YzAgMzUuMjA1IDI4Ljc5NSA2NCA2NCA2NGg4OTZjMzUuMjA1IDAgNjQtMjguNzk1IDY0LTY0VjEyOGMwLTM1LjIwNS0yOC43OTUtNjQtNjQtNjR6TTgzMiAyODguMDFjMCA1My4wMjMtNDIuOTg4IDk2LjAxLTk2LjAxIDk2LjAxcy05Ni4wMS00Mi45ODctOTYuMDEtOTYuMDFTNjgyLjk2NyAxOTIgNzM1Ljk5IDE5MiA4MzIgMjM0Ljk4OCA4MzIgMjg4LjAxek04OTYgODMySDEyOFY3MDRsMjI0LjAxLTM4NCAyNTYgMzIwaDY0bDIyNC4wMS0xOTJ6Ij48L3BhdGg+PC9zdmc+Jyx0aGlzLnRhZz0iYnV0dG9uIix0aGlzLnNob3dNb2RhbD0hMCx0aGlzLm1vZGFsV2lkdGg9MzAwLHRoaXMuJGNvbnRlbnQ9bnVsbCx0aGlzLnNyY0lucHV0SWQ9aWEoKSx0aGlzLmFsdElucHV0SWQ9aWEoKSx0aGlzLmhyZWZJbnB1dElkPWlhKCksdGhpcy5idXR0b25JZD1pYSgpO31yZXR1cm4gdC5wcm90b3R5cGUuZ2V0VmFsdWU9ZnVuY3Rpb24odCl7cmV0dXJuICIifSx0LnByb3RvdHlwZS5pc0FjdGl2ZT1mdW5jdGlvbih0KXtyZXR1cm4gITF9LHQucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24odCxlKXt9LHQucHJvdG90eXBlLmlzRGlzYWJsZWQ9ZnVuY3Rpb24odCl7cmV0dXJuIG9hKHQpfSx0LnByb3RvdHlwZS5nZXRNb2RhbFBvc2l0aW9uTm9kZT1mdW5jdGlvbih0KXtyZXR1cm4gbnVsbH0sdC5wcm90b3R5cGUuZ2V0TW9kYWxDb250ZW50RWxlbT1mdW5jdGlvbih0KXt2YXIgbj10aGlzLHI9dGhpcyxvPXIuc3JjSW5wdXRJZCxpPXIuYWx0SW5wdXRJZCx1PXIuaHJlZklucHV0SWQsYT1yLmJ1dHRvbklkLGw9eG8oZS5nZW5Nb2RhbElucHV0RWxlbXMoZS50KCJpbWFnZS5zcmMiKSxvKSwyKSxzPWxbMF0sZj1sWzFdLGQ9Yy5kZWZhdWx0KGYpLHA9eG8oZS5nZW5Nb2RhbElucHV0RWxlbXMoZS50KCJpbWFnZS5kZXNjIiksaSksMiksaD1wWzBdLHY9cFsxXSxnPWMuZGVmYXVsdCh2KSxtPXhvKGUuZ2VuTW9kYWxJbnB1dEVsZW1zKGUudCgiaW1hZ2UubGluayIpLHUpLDIpLHk9bVswXSxiPW1bMV0seD1jLmRlZmF1bHQoYiksdz14byhlLmdlbk1vZGFsQnV0dG9uRWxlbXMoYSxlLnQoImNvbW1vbi5vayIpKSwxKVswXTtpZihudWxsPT10aGlzLiRjb250ZW50KXt2YXIgRT1jLmRlZmF1bHQoIjxkaXY+PC9kaXY+Iik7RS5vbigiY2xpY2siLCIjIithLChmdW5jdGlvbihlKXtlLnByZXZlbnREZWZhdWx0KCk7dmFyIHI9RS5maW5kKCIjIitvKS52YWwoKS50cmltKCksYT1FLmZpbmQoIiMiK2kpLnZhbCgpLnRyaW0oKSxjPUUuZmluZCgiIyIrdSkudmFsKCkudHJpbSgpO24uaW5zZXJ0SW1hZ2UodCxyLGEsYyksdC5oaWRlUGFuZWxPck1vZGFsKCk7fSkpLHRoaXMuJGNvbnRlbnQ9RTt9dmFyIFM9dGhpcy4kY29udGVudDtyZXR1cm4gUy5lbXB0eSgpLFMuYXBwZW5kKHMpLFMuYXBwZW5kKGgpLFMuYXBwZW5kKHkpLFMuYXBwZW5kKHcpLGQudmFsKCIiKSxnLnZhbCgiIikseC52YWwoIiIpLHNldFRpbWVvdXQoKGZ1bmN0aW9uKCl7ZC5mb2N1cygpO30pKSxTWzBdfSx0LnByb3RvdHlwZS5pbnNlcnRJbWFnZT1mdW5jdGlvbih0LGUsbixyKXt2b2lkIDA9PT1uJiYobj0iIiksdm9pZCAwPT09ciYmKHI9IiIpLGUmJih0LnJlc3RvcmVTZWxlY3Rpb24oKSx0aGlzLmlzRGlzYWJsZWQodCl8fG5hKHQsZSxuLHIpKTt9LHR9KCksYWE9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KCl7dGhpcy50aXRsZT1lLnQoImltYWdlLmRlbGV0ZSIpLHRoaXMuaWNvblN2Zz0nPHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0Ij48cGF0aCBkPSJNODI2LjgwMzIgMzU2LjUzMTJjLTE5LjMyOCAwLTM2LjM3NzYgMTUuNjkyOC0zNi4zNzc2IDM1LjA0NjR2NTI0LjI2MjRjMCAxOS4zMjgtMTYgMzQuNTYtMzUuMzI4IDM0LjU2SDI2NC45MzQ0Yy0xOS4zMjggMC0zNS41MDcyLTE1LjMwODgtMzUuNTA3Mi0zNC41NlYzOTAuMDQxNmMwLTE5LjMyOC0xNC4xNTY4LTM1LjA0NjQtMzMuNTEwNC0zNS4wNDY0cy0zMy41MTA0IDE1LjY5MjgtMzMuNTEwNCAzNS4wNDY0VjkxNS43MTJjMCA1Ny45MzI4IDQ0LjYyMDggMTA4LjI4OCAxMDIuNTI4IDEwOC4yODhINzU1LjJjNTcuOTMyOCAwIDEwOC4wODMyLTUwLjQ1NzYgMTA4LjA4MzItMTA4LjI4OFYzOTEuNDc1MmMtMC4xMDI0LTE5LjI1MTItMTcuMTI2NC0zNC45NDQtMzYuNDgtMzQuOTQ0eiIgcC1pZD0iOTU3NyI+PC9wYXRoPjxwYXRoIGQ9Ik00MzcuMTcxMiA3NzUuNzU2OFYzOTAuNjA0OGMwLTE5LjMyOC0xNC4xNTY4LTM1LjA0NjQtMzMuNTEwNC0zNS4wNDY0cy0zMy41MTA0IDE1LjYxNi0zMy41MTA0IDM1LjA0NjR2Mzg1LjE1MmMwIDE5LjMyOCAxNC4xNTY4IDM1LjA0NjQgMzMuNTEwNCAzNS4wNDY0czMzLjUxMDQtMTUuNzE4NCAzMy41MTA0LTM1LjA0NjR6TTY0OS43MDI0IDc3NS43NTY4VjM5MC42MDQ4YzAtMTkuMzI4LTE3LjA0OTYtMzUuMDQ2NC0zNi4zNzc2LTM1LjA0NjRzLTM2LjM3NzYgMTUuNjE2LTM2LjM3NzYgMzUuMDQ2NHYzODUuMTUyYzAgMTkuMzI4IDE3LjA0OTYgMzUuMDQ2NCAzNi4zNzc2IDM1LjA0NjRzMzYuMzc3Ni0xNS43MTg0IDM2LjM3NzYtMzUuMDQ2NHpNOTY1LjA0MzIgMjE3LjAzNjhoLTE3NC42MTc2VjE0NS41MTA0YzAtNTcuOTMyOC00Ny4yMDY0LTEwMS43Ni0xMDQuNjUyOC0xMDEuNzZoLTM1MC45NzZjLTU3LjgzMDQgMC0xMDUuMzk1MiA0My44NTI4LTEwNS4zOTUyIDEwMS43NnY3MS41MjY0SDU0Ljc4NGMtMTkuNDMwNCAwLTM1LjA0NjQgMTQuMTU2OC0zNS4wNDY0IDMzLjUxMDQgMCAxOS4zMjggMTUuNjE2IDMzLjUxMDQgMzUuMDQ2NCAzMy41MTA0aDkxMC4zNjE2YzE5LjMyOCAwIDM1LjA0NjQtMTQuMTU2OCAzNS4wNDY0LTMzLjUxMDQgMC0xOS4zNTM2LTE1LjY5MjgtMzMuNTEwNC0zNS4xNDg4LTMzLjUxMDR6IG0tMjQ3LjM3MjggMEgyOTcuMzk1MlYxNDUuNTEwNGMwLTE5LjMyOCAxOC4yMDE2LTM0Ljc2NDggMzcuNDI3Mi0zNC43NjQ4aDM1MC45NzZjMTkuMTQ4OCAwIDMxLjg3MiAxNS4xMjk2IDMxLjg3MiAzNC43NjQ4djcxLjUyNjR6Ij48L3BhdGg+PC9zdmc+Jyx0aGlzLnRhZz0iYnV0dG9uIjt9cmV0dXJuIHQucHJvdG90eXBlLmdldFZhbHVlPWZ1bmN0aW9uKHQpe3JldHVybiAiIn0sdC5wcm90b3R5cGUuaXNBY3RpdmU9ZnVuY3Rpb24odCl7cmV0dXJuICExfSx0LnByb3RvdHlwZS5pc0Rpc2FibGVkPWZ1bmN0aW9uKHQpe3JldHVybiBudWxsPT10LnNlbGVjdGlvbnx8bnVsbD09ZS5Eb21FZGl0b3IuZ2V0U2VsZWN0ZWROb2RlQnlUeXBlKHQsImltYWdlIil9LHQucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24odCxuKXt0aGlzLmlzRGlzYWJsZWQodCl8fHIuVHJhbnNmb3Jtcy5yZW1vdmVOb2Rlcyh0LHttYXRjaDpmdW5jdGlvbih0KXtyZXR1cm4gZS5Eb21FZGl0b3IuY2hlY2tOb2RlVHlwZSh0LCJpbWFnZSIpfX0pO30sdH0oKTtmdW5jdGlvbiBjYSgpe3JldHVybiBidSgidy1lLWVkaXQtaW1hZ2UiKX12YXIgbGE9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KCl7dGhpcy50aXRsZT1lLnQoImltYWdlLmVkaXQiKSx0aGlzLmljb25Tdmc9R28sdGhpcy50YWc9ImJ1dHRvbiIsdGhpcy5zaG93TW9kYWw9ITAsdGhpcy5tb2RhbFdpZHRoPTMwMCx0aGlzLiRjb250ZW50PW51bGwsdGhpcy5zcmNJbnB1dElkPWNhKCksdGhpcy5hbHRJbnB1dElkPWNhKCksdGhpcy5ocmVmSW5wdXRJZD1jYSgpLHRoaXMuYnV0dG9uSWQ9Y2EoKTt9cmV0dXJuIHQucHJvdG90eXBlLmdldFZhbHVlPWZ1bmN0aW9uKHQpe3JldHVybiAiIn0sdC5wcm90b3R5cGUuZ2V0SW1hZ2VOb2RlPWZ1bmN0aW9uKHQpe3JldHVybiBlLkRvbUVkaXRvci5nZXRTZWxlY3RlZE5vZGVCeVR5cGUodCwiaW1hZ2UiKX0sdC5wcm90b3R5cGUuaXNBY3RpdmU9ZnVuY3Rpb24odCl7cmV0dXJuICExfSx0LnByb3RvdHlwZS5leGVjPWZ1bmN0aW9uKHQsZSl7fSx0LnByb3RvdHlwZS5pc0Rpc2FibGVkPWZ1bmN0aW9uKHQpe3ZhciBuPXQuc2VsZWN0aW9uO3JldHVybiBudWxsPT1ufHwoIXIuUmFuZ2UuaXNDb2xsYXBzZWQobil8fG51bGw9PWUuRG9tRWRpdG9yLmdldFNlbGVjdGVkTm9kZUJ5VHlwZSh0LCJpbWFnZSIpKX0sdC5wcm90b3R5cGUuZ2V0TW9kYWxQb3NpdGlvbk5vZGU9ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuZ2V0SW1hZ2VOb2RlKHQpfSx0LnByb3RvdHlwZS5nZXRNb2RhbENvbnRlbnRFbGVtPWZ1bmN0aW9uKHQpe3ZhciBuPXRoaXMscj10aGlzLG89ci5zcmNJbnB1dElkLGk9ci5hbHRJbnB1dElkLHU9ci5ocmVmSW5wdXRJZCxhPXIuYnV0dG9uSWQsbD10aGlzLmdldEltYWdlTm9kZSh0KTtpZihudWxsPT1sKXRocm93IG5ldyBFcnJvcigiTm90IGZvdW5kIHNlbGVjdGVkIGltYWdlIG5vZGUiKTt2YXIgcz14byhlLmdlbk1vZGFsSW5wdXRFbGVtcyhlLnQoImltYWdlLnNyYyIpLG8pLDIpLGY9c1swXSxkPXNbMV0scD1jLmRlZmF1bHQoZCksaD14byhlLmdlbk1vZGFsSW5wdXRFbGVtcyhlLnQoImltYWdlLmRlc2MiKSxpKSwyKSx2PWhbMF0sZz1oWzFdLG09Yy5kZWZhdWx0KGcpLHk9eG8oZS5nZW5Nb2RhbElucHV0RWxlbXMoZS50KCJpbWFnZS5saW5rIiksdSksMiksYj15WzBdLHg9eVsxXSx3PWMuZGVmYXVsdCh4KSxFPXhvKGUuZ2VuTW9kYWxCdXR0b25FbGVtcyhhLGUudCgiY29tbW9uLm9rIikpLDEpWzBdO2lmKG51bGw9PXRoaXMuJGNvbnRlbnQpe3ZhciBTPWMuZGVmYXVsdCgiPGRpdj48L2Rpdj4iKTtTLm9uKCJjbGljayIsIiMiK2EsKGZ1bmN0aW9uKGUpe2UucHJldmVudERlZmF1bHQoKTt2YXIgcj1TLmZpbmQoIiMiK28pLnZhbCgpLGE9Uy5maW5kKCIjIitpKS52YWwoKSxjPVMuZmluZCgiIyIrdSkudmFsKCk7bi51cGRhdGVJbWFnZSh0LHIsYSxjKSx0LmhpZGVQYW5lbE9yTW9kYWwoKTt9KSksdGhpcy4kY29udGVudD1TO312YXIgaz10aGlzLiRjb250ZW50O2suZW1wdHkoKSxrLmFwcGVuZChmKSxrLmFwcGVuZCh2KSxrLmFwcGVuZChiKSxrLmFwcGVuZChFKTt2YXIgVD1sLE09VC5zcmMsST1ULmFsdCxOPXZvaWQgMD09PUk/IiI6SSxIPVQuaHJlZixPPXZvaWQgMD09PUg/IiI6SDtyZXR1cm4gcC52YWwoTSksbS52YWwoTiksdy52YWwoTyksc2V0VGltZW91dCgoZnVuY3Rpb24oKXtwLmZvY3VzKCk7fSkpLGtbMF19LHQucHJvdG90eXBlLnVwZGF0ZUltYWdlPWZ1bmN0aW9uKHQsZSxuLHIsbyl7dm9pZCAwPT09biYmKG49IiIpLHZvaWQgMD09PXImJihyPSIiKSx2b2lkIDA9PT1vJiYobz17fSksZSYmKHQucmVzdG9yZVNlbGVjdGlvbigpLHRoaXMuaXNEaXNhYmxlZCh0KXx8cmEodCxlLG4scixvKSk7fSx0fSgpLHNhPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe3RoaXMudGl0bGU9ZS50KCJpbWFnZS52aWV3TGluayIpLHRoaXMuaWNvblN2Zz1Vbyx0aGlzLnRhZz0iYnV0dG9uIjt9cmV0dXJuIHQucHJvdG90eXBlLmdldFZhbHVlPWZ1bmN0aW9uKHQpe3ZhciBuPWUuRG9tRWRpdG9yLmdldFNlbGVjdGVkTm9kZUJ5VHlwZSh0LCJpbWFnZSIpO3JldHVybiBuJiZuLmhyZWZ8fCIifSx0LnByb3RvdHlwZS5pc0FjdGl2ZT1mdW5jdGlvbih0KXtyZXR1cm4gITF9LHQucHJvdG90eXBlLmlzRGlzYWJsZWQ9ZnVuY3Rpb24odCl7cmV0dXJuIG51bGw9PXQuc2VsZWN0aW9ufHwhdGhpcy5nZXRWYWx1ZSh0KX0sdC5wcm90b3R5cGUuZXhlYz1mdW5jdGlvbih0LGUpe2lmKCF0aGlzLmlzRGlzYWJsZWQodCkpe2lmKCFlfHwic3RyaW5nIiE9dHlwZW9mIGUpdGhyb3cgbmV3IEVycm9yKCJWaWV3IGltYWdlIGxpbmsgZmFpbGVkLCBpbWFnZS5ocmVmIGlzICciK2UrIiciKTt3aW5kb3cub3BlbihlLCJfYmxhbmsiKTt9fSx0fSgpLGZhPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe3RoaXMudGFnPSJidXR0b24iO31yZXR1cm4gdC5wcm90b3R5cGUuZ2V0VmFsdWU9ZnVuY3Rpb24odCl7cmV0dXJuICIifSx0LnByb3RvdHlwZS5pc0FjdGl2ZT1mdW5jdGlvbih0KXtyZXR1cm4gITF9LHQucHJvdG90eXBlLmdldFNlbGVjdGVkTm9kZT1mdW5jdGlvbih0KXtyZXR1cm4gZS5Eb21FZGl0b3IuZ2V0U2VsZWN0ZWROb2RlQnlUeXBlKHQsImltYWdlIil9LHQucHJvdG90eXBlLmlzRGlzYWJsZWQ9ZnVuY3Rpb24odCl7cmV0dXJuIG51bGw9PXQuc2VsZWN0aW9ufHxudWxsPT10aGlzLmdldFNlbGVjdGVkTm9kZSh0KX0sdC5wcm90b3R5cGUuZXhlYz1mdW5jdGlvbih0LG4pe2lmKCF0aGlzLmlzRGlzYWJsZWQodCkpe3ZhciBvPXRoaXMuZ2V0U2VsZWN0ZWROb2RlKHQpO2lmKG51bGwhPW8pe3ZhciBpPWUuRG9tRWRpdG9yLmdldEhvdmVyYmFyKHQpO2kmJmkuaGlkZUFuZENsZWFuKCk7dmFyIHU9by5zdHlsZSxhPXtzdHlsZTpnbyhnbyh7fSx2b2lkIDA9PT11P3t9OnUpLHt3aWR0aDp0aGlzLnZhbHVlLGhlaWdodDoiIn0pfTtyLlRyYW5zZm9ybXMuc2V0Tm9kZXModCxhLHttYXRjaDpmdW5jdGlvbih0KXtyZXR1cm4gZS5Eb21FZGl0b3IuY2hlY2tOb2RlVHlwZSh0LCJpbWFnZSIpfX0pO319fSx0fSgpLGRhPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUoKXt2YXIgZT1udWxsIT09dCYmdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl8fHRoaXM7cmV0dXJuIGUudGl0bGU9IjMwJSIsZS52YWx1ZT0iMzAlIixlfXJldHVybiB2byhlLHQpLGV9KGZhKSxwYT1mdW5jdGlvbih0KXtmdW5jdGlvbiBlKCl7dmFyIGU9bnVsbCE9PXQmJnQuYXBwbHkodGhpcyxhcmd1bWVudHMpfHx0aGlzO3JldHVybiBlLnRpdGxlPSI1MCUiLGUudmFsdWU9IjUwJSIsZX1yZXR1cm4gdm8oZSx0KSxlfShmYSksaGE9ZnVuY3Rpb24odCl7ZnVuY3Rpb24gZSgpe3ZhciBlPW51bGwhPT10JiZ0LmFwcGx5KHRoaXMsYXJndW1lbnRzKXx8dGhpcztyZXR1cm4gZS50aXRsZT0iMTAwJSIsZS52YWx1ZT0iMTAwJSIsZX1yZXR1cm4gdm8oZSx0KSxlfShmYSk7dmFyIHZhPXtvbkluc2VydGVkSW1hZ2U6ZnVuY3Rpb24odCl7fSxvblVwZGF0ZWRJbWFnZTpmdW5jdGlvbih0KXt9LGNoZWNrSW1hZ2U6ZnVuY3Rpb24odCxlLG4pe3JldHVybiAhMH0scGFyc2VJbWFnZVNyYzpmdW5jdGlvbih0KXtyZXR1cm4gdH19LGdhPXtyZW5kZXJFbGVtczpbS3VdLGVsZW1zVG9IdG1sOltRdV0scGFyc2VFbGVtc0h0bWw6W1p1XSxtZW51czpbe2tleToiaW5zZXJ0SW1hZ2UiLGZhY3Rvcnk6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IHVhfSxjb25maWc6dmF9LHtrZXk6ImRlbGV0ZUltYWdlIixmYWN0b3J5OmZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBhYX19LHtrZXk6ImVkaXRJbWFnZSIsZmFjdG9yeTpmdW5jdGlvbigpe3JldHVybiBuZXcgbGF9LGNvbmZpZzp2YX0se2tleToidmlld0ltYWdlTGluayIsZmFjdG9yeTpmdW5jdGlvbigpe3JldHVybiBuZXcgc2F9fSx7a2V5OiJpbWFnZVdpZHRoMzAiLGZhY3Rvcnk6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IGRhfX0se2tleToiaW1hZ2VXaWR0aDUwIixmYWN0b3J5OmZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBwYX19LHtrZXk6ImltYWdlV2lkdGgxMDAiLGZhY3Rvcnk6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IGhhfX1dLGVkaXRvclBsdWdpbjpmdW5jdGlvbih0KXt2YXIgZT10LmlzSW5saW5lLG49dC5pc1ZvaWQ7dC5pbnNlcnROb2RlO3ZhciByPXQ7cmV0dXJuIHIuaXNJbmxpbmU9ZnVuY3Rpb24odCl7cmV0dXJuICJpbWFnZSI9PT10LnR5cGV8fGUodCl9LHIuaXNWb2lkPWZ1bmN0aW9uKHQpe3JldHVybiAiaW1hZ2UiPT09dC50eXBlfHxuKHQpfSxyfX07dmFyIG1hPXt0eXBlOiJ0b2RvIixyZW5kZXJFbGVtOmZ1bmN0aW9uKHQsbyxpKXt2YXIgdT0hMTtpLmlzRGlzYWJsZWQoKSYmKHU9ITApO3ZhciBhPXQuY2hlY2tlZCxjPW4uanN4KCJkaXYiLHtzdHlsZTp7bWFyZ2luOiI1cHggMCJ9fSxuLmpzeCgic3BhbiIse2NvbnRlbnRFZGl0YWJsZTohMSxzdHlsZTp7bWFyZ2luUmlnaHQ6IjAuNWVtIn19LG4uanN4KCJpbnB1dCIse3R5cGU6ImNoZWNrYm94IixjaGVja2VkOmEsZGlzYWJsZWQ6dSxvbjp7Y2hhbmdlOmZ1bmN0aW9uKG4pe3ZhciBvPWUuRG9tRWRpdG9yLmZpbmRQYXRoKGksdCksdT17Y2hlY2tlZDpuLnRhcmdldC5jaGVja2VkfTtyLlRyYW5zZm9ybXMuc2V0Tm9kZXMoaSx1LHthdDpvfSk7fX19KSksbi5qc3goInNwYW4iLG51bGwsbykpO3JldHVybiBjfX07dmFyIHlhPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe3RoaXMudGl0bGU9ZS50KCJ0b2RvLnRvZG8iKSx0aGlzLmljb25Tdmc9Jzxzdmcgdmlld0JveD0iMCAwIDEwMjQgMTAyNCI+PHBhdGggZD0iTTI3OC43NTU1NTYgNDAzLjkxMTExMWwtNzkuNjQ0NDQ1IDc5LjY0NDQ0NUw0NTUuMTExMTExIDczOS41NTU1NTZsNTY4Ljg4ODg4OS01NjguODg4ODg5LTc5LjY0NDQ0NC03OS42NDQ0NDVMNDU1LjExMTExMSA1ODAuMjY2NjY3bC0xNzYuMzU1NTU1LTE3Ni4zNTU1NTZ6TTkxMC4yMjIyMjIgOTEwLjIyMjIyMkgxMTMuNzc3Nzc4VjExMy43Nzc3NzhoNTY4Ljg4ODg4OVYwSDExMy43Nzc3NzhDNTEuMiAwIDAgNTEuMiAwIDExMy43Nzc3Nzh2Nzk2LjQ0NDQ0NGMwIDYyLjU3Nzc3OCA1MS4yIDExMy43Nzc3NzggMTEzLjc3Nzc3OCAxMTMuNzc3Nzc4aDc5Ni40NDQ0NDRjNjIuNTc3Nzc4IDAgMTEzLjc3Nzc3OC01MS4yIDExMy43Nzc3NzgtMTEzLjc3Nzc3OFY0NTUuMTExMTExaC0xMTMuNzc3Nzc4djQ1NS4xMTExMTF6Ij48L3BhdGg+PC9zdmc+Jyx0aGlzLnRhZz0iYnV0dG9uIjt9cmV0dXJuIHQucHJvdG90eXBlLmdldFZhbHVlPWZ1bmN0aW9uKHQpe3JldHVybiAiIn0sdC5wcm90b3R5cGUuaXNBY3RpdmU9ZnVuY3Rpb24odCl7cmV0dXJuICEhZS5Eb21FZGl0b3IuZ2V0U2VsZWN0ZWROb2RlQnlUeXBlKHQsInRvZG8iKX0sdC5wcm90b3R5cGUuaXNEaXNhYmxlZD1mdW5jdGlvbih0KXtyZXR1cm4gbnVsbD09dC5zZWxlY3Rpb258fCEhZS5Eb21FZGl0b3IuZ2V0U2VsZWN0ZWRFbGVtcyh0KS5zb21lKChmdW5jdGlvbihlKXtpZihyLkVkaXRvci5pc1ZvaWQodCxlKSYmci5FZGl0b3IuaXNCbG9jayh0LGUpKXJldHVybiAhMDt2YXIgbj1lLnR5cGU7cmV0dXJuICEhWyJwcmUiLCJ0YWJsZSIsImxpc3QtaXRlbSJdLmluY2x1ZGVzKG4pfHx2b2lkIDB9KSl9LHQucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24odCxlKXt2YXIgbj10aGlzLmlzQWN0aXZlKHQpO3IuVHJhbnNmb3Jtcy5zZXROb2Rlcyh0LHt0eXBlOm4/InBhcmFncmFwaCI6InRvZG8ifSk7fSx0fSgpO3ZhciBiYT17cmVuZGVyRWxlbXM6W21hXSxlbGVtc1RvSHRtbDpbe3R5cGU6InRvZG8iLGVsZW1Ub0h0bWw6ZnVuY3Rpb24odCxlKXtyZXR1cm4gJzxkaXYgZGF0YS13LWUtdHlwZT0idG9kbyI+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBkaXNhYmxlZCAnKyh0LmNoZWNrZWQ/ImNoZWNrZWQiOiIiKSsiPiIrZSsiPC9kaXY+In19XSxwcmVQYXJzZUh0bWw6W3tzZWxlY3RvcjoidWwudy1lLXRvZG8iLHByZVBhcnNlSHRtbDpmdW5jdGlvbih0KXt2YXIgZT1jLmRlZmF1bHQodCkuZmluZCgibGkiKSxuPWMuZGVmYXVsdCgnPGRpdiBkYXRhLXctZS10eXBlPSJ0b2RvIj48L2Rpdj4nKSxyPWUuZmluZCgiaW5wdXRbdHlwZV0iKTtyZXR1cm4gbi5hcHBlbmQociksZS5jaGlsZHJlbigpWzBdLnJlbW92ZSgpLG5bMF0uaW5uZXJIVE1MPW5bMF0uaW5uZXJIVE1MK2VbMF0uaW5uZXJIVE1MLG5bMF19fV0scGFyc2VFbGVtc0h0bWw6W3tzZWxlY3RvcjonZGl2W2RhdGEtdy1lLXR5cGU9InRvZG8iXScscGFyc2VFbGVtSHRtbDpmdW5jdGlvbih0LGUsbil7dmFyIG89Yy5kZWZhdWx0KHQpOzA9PT0oZT1lLmZpbHRlcigoZnVuY3Rpb24odCl7cmV0dXJuICEhci5UZXh0LmlzVGV4dCh0KXx8ISFuLmlzSW5saW5lKHQpfSkpKS5sZW5ndGgmJihlPVt7dGV4dDpvLnRleHQoKS5yZXBsYWNlKC9ccysvZ20sIiAiKX1dKTt2YXIgaT0hMTtyZXR1cm4gbnVsbCE9by5maW5kKCdpbnB1dFt0eXBlPSJjaGVja2JveCJdJykuYXR0cigiY2hlY2tlZCIpJiYoaT0hMCkse3R5cGU6InRvZG8iLGNoZWNrZWQ6aSxjaGlsZHJlbjplfX19XSxtZW51czpbe2tleToidG9kbyIsZmFjdG9yeTpmdW5jdGlvbigpe3JldHVybiBuZXcgeWF9fV0sZWRpdG9yUGx1Z2luOmZ1bmN0aW9uKHQpe3ZhciBuPXQuZGVsZXRlQmFja3dhcmQsbz10O3JldHVybiBvLmRlbGV0ZUJhY2t3YXJkPWZ1bmN0aW9uKG8pe3ZhciBpPXQuc2VsZWN0aW9uO2lmKGkmJnIuUmFuZ2UuaXNDb2xsYXBzZWQoaSkpe3ZhciB1PWUuRG9tRWRpdG9yLmdldFNlbGVjdGVkTm9kZUJ5VHlwZSh0LCJ0b2RvIik7aWYodSYmMD09PXIuTm9kZS5zdHJpbmcodSkubGVuZ3RoKXJldHVybiB2b2lkIHIuVHJhbnNmb3Jtcy5zZXROb2Rlcyh0LHt0eXBlOiJwYXJhZ3JhcGgifSx7bW9kZToiaGlnaGVzdCJ9KX1uKG8pO30sb319O3ZhciB4YT17dHlwZToiYmxvY2txdW90ZSIscmVuZGVyRWxlbTpmdW5jdGlvbih0LGUscil7cmV0dXJuIG4uanN4KCJibG9ja3F1b3RlIixudWxsLGUpfX07dmFyIHdhPXt0eXBlOiJibG9ja3F1b3RlIixlbGVtVG9IdG1sOmZ1bmN0aW9uKHQsZSl7cmV0dXJuICI8YmxvY2txdW90ZT4iK2UrIjwvYmxvY2txdW90ZT4ifX07dmFyIEVhPXtzZWxlY3RvcjoiYmxvY2txdW90ZTpub3QoW2RhdGEtdy1lLXR5cGVdKSIscGFyc2VFbGVtSHRtbDpmdW5jdGlvbih0LGUsbil7dmFyIG89Yy5kZWZhdWx0KHQpO3JldHVybiAwPT09KGU9ZS5maWx0ZXIoKGZ1bmN0aW9uKHQpe3JldHVybiAhIXIuVGV4dC5pc1RleHQodCl8fCEhbi5pc0lubGluZSh0KX0pKSkubGVuZ3RoJiYoZT1be3RleHQ6by50ZXh0KCkucmVwbGFjZSgvXHMrL2dtLCIgIil9XSkse3R5cGU6ImJsb2NrcXVvdGUiLGNoaWxkcmVuOmV9fX0sU2E9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KCl7dGhpcy50aXRsZT1lLnQoImJsb2NrUXVvdGUudGl0bGUiKSx0aGlzLmljb25Tdmc9Jzxzdmcgdmlld0JveD0iMCAwIDEwMjQgMTAyNCI+PHBhdGggZD0iTTg5NC42IDkwNy4xSDYwNS40Yy0zMi42IDAtNTktMjYuNC01OS01OVY2MDguMmwtNC0xNC45YzAtMzE1LjkgMTI1LjUtNDg1LjEgMzc2LjUtNTA3LjV2NTkuOEM3NTIuNyAxODAuNCA3MTEuMyAzMTUuOCA3MTEuMyA0NDIuNHY0MS4ybDMxLjUgMTIuM2gxNTEuOGMzMi42IDAgNTkgMjYuNCA1OSA1OXYyOTMuMmMwIDMyLjUtMjYuNCA1OS01OSA1OXogbS00NzIgMEgxMzMuNGMtMzIuNiAwLTU5LTI2LjQtNTktNTlWNjA4LjJsLTQtMTQuOWMwLTMxNS45IDEyNS41LTQ4NS4xIDM3Ni41LTUwNy41djU5LjhDMjgwLjcgMTgwLjQgMjM5LjMgMzE1LjggMjM5LjMgNDQyLjR2NDEuMmwzMS41IDEyLjNoMTUxLjhjMzIuNiAwIDU5IDI2LjQgNTkgNTl2MjkzLjJjMCAzMi41LTI2LjQgNTktNTkgNTl6Ij48L3BhdGg+PC9zdmc+Jyx0aGlzLnRhZz0iYnV0dG9uIjt9cmV0dXJuIHQucHJvdG90eXBlLmdldFZhbHVlPWZ1bmN0aW9uKHQpe3JldHVybiAiIn0sdC5wcm90b3R5cGUuaXNBY3RpdmU9ZnVuY3Rpb24odCl7cmV0dXJuICEhZS5Eb21FZGl0b3IuZ2V0U2VsZWN0ZWROb2RlQnlUeXBlKHQsImJsb2NrcXVvdGUiKX0sdC5wcm90b3R5cGUuaXNEaXNhYmxlZD1mdW5jdGlvbih0KXtyZXR1cm4gbnVsbD09dC5zZWxlY3Rpb258fCF4byhyLkVkaXRvci5ub2Rlcyh0LHttYXRjaDpmdW5jdGlvbih0KXt2YXIgbj1lLkRvbUVkaXRvci5nZXROb2RlVHlwZSh0KTtyZXR1cm4gInBhcmFncmFwaCI9PT1ufHwiYmxvY2txdW90ZSI9PT1ufSx1bml2ZXJzYWw6ITAsbW9kZToiaGlnaGVzdCJ9KSwxKVswXX0sdC5wcm90b3R5cGUuZXhlYz1mdW5jdGlvbih0LGUpe2lmKCF0aGlzLmlzRGlzYWJsZWQodCkpe3ZhciBuPXRoaXMuaXNBY3RpdmUodCk/InBhcmFncmFwaCI6ImJsb2NrcXVvdGUiO3IuVHJhbnNmb3Jtcy5zZXROb2Rlcyh0LHt0eXBlOm59LHttb2RlOiJoaWdoZXN0In0pO319LHR9KCksa2E9e2tleToiYmxvY2txdW90ZSIsZmFjdG9yeTpmdW5jdGlvbigpe3JldHVybiBuZXcgU2F9fSxUYT1EKFtdLnNsaWNlKSxNYT1obigic2xpY2UiKSxJYT1NdCgic3BlY2llcyIpLE5hPXkuQXJyYXksSGE9TWF0aC5tYXg7cWUoe3RhcmdldDoiQXJyYXkiLHByb3RvOiEwLGZvcmNlZDohTWF9LHtzbGljZTpmdW5jdGlvbih0LGUpe3ZhciBuLHIsbyxpPUYodGhpcyksdT1FZShpKSxhPWJlKHQsdSksYz1iZSh2b2lkIDA9PT1lP3U6ZSx1KTtpZihXZShpKSYmKG49aS5jb25zdHJ1Y3RvciwodW4obikmJihuPT09TmF8fFdlKG4ucHJvdG90eXBlKSl8fHEobikmJm51bGw9PT0obj1uW0lhXSkpJiYobj12b2lkIDApLG49PT1OYXx8dm9pZCAwPT09bikpcmV0dXJuIFRhKGksYSxjKTtmb3Iocj1uZXcodm9pZCAwPT09bj9OYTpuKShIYShjLWEsMCkpLG89MDthPGM7YSsrLG8rKylhIGluIGkmJkZyKHIsbyxpW2FdKTtyZXR1cm4gci5sZW5ndGg9byxyfX0pO3ZhciBPYT17cmVuZGVyRWxlbXM6W3hhXSxlbGVtc1RvSHRtbDpbd2FdLHBhcnNlRWxlbXNIdG1sOltFYV0sbWVudXM6W2thXSxlZGl0b3JQbHVnaW46ZnVuY3Rpb24odCl7dmFyIG49dC5pbnNlcnRCcmVhayxvPXQuaW5zZXJ0VGV4dCxpPXQ7cmV0dXJuIGkuaW5zZXJ0QnJlYWs9ZnVuY3Rpb24oKXt2YXIgdT1pLnNlbGVjdGlvbjtpZihudWxsPT11KXJldHVybiBuKCk7dmFyIGE9eG8oci5FZGl0b3Iubm9kZXModCx7bWF0Y2g6ZnVuY3Rpb24odCl7cmV0dXJuIGUuRG9tRWRpdG9yLmNoZWNrTm9kZVR5cGUodCwiYmxvY2txdW90ZSIpfSx1bml2ZXJzYWw6ITB9KSwxKVswXTtpZighYSlyZXR1cm4gbigpO3ZhciBjPWFbMF0sbD1lLkRvbUVkaXRvci5maW5kUGF0aCh0LGMpLHM9ci5FZGl0b3IuZW5kKHQsbCk7aWYoci5Qb2ludC5lcXVhbHMocyx1LmZvY3VzKSl7dmFyIGY9ci5Ob2RlLnN0cmluZyhjKTtpZihmJiYiXG4iPT09Zi5zbGljZSgtMSkpe3QuZGVsZXRlQmFja3dhcmQoImNoYXJhY3RlciIpO3JldHVybiB2b2lkIHIuVHJhbnNmb3Jtcy5pbnNlcnROb2RlcyhpLHt0eXBlOiJwYXJhZ3JhcGgiLGNoaWxkcmVuOlt7dGV4dDoiIn1dfSx7bW9kZToiaGlnaGVzdCJ9KX19bygiXG4iKTt9LGl9fSxqYT1mdW5jdGlvbigpe2Z1bmN0aW9uIHQoKXt0aGlzLnRpdGxlPWUudCgiZW1vdGlvbi50aXRsZSIpLHRoaXMuaWNvblN2Zz0nPHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0Ij48cGF0aCBkPSJNNTEyIDEwMjRDMjMwLjQgMTAyNCAwIDc5My42IDAgNTEyUzIzMC40IDAgNTEyIDBzNTEyIDIzMC40IDUxMiA1MTItMjMwLjQgNTEyLTUxMiA1MTJ6IG0wLTEwMi40YzIyNi43NDI4NTcgMCA0MDkuNi0xODIuODU3MTQzIDQwOS42LTQwOS42UzczOC43NDI4NTcgMTAyLjQgNTEyIDEwMi40IDEwMi40IDI4NS4yNTcxNDMgMTAyLjQgNTEyczE4Mi44NTcxNDMgNDA5LjYgNDA5LjYgNDA5LjZ6IG0tMjA0LjgtMzU4LjRoNDA5LjZjMCAxMTMuMzcxNDI5LTkxLjQyODU3MSAyMDQuOC0yMDQuOCAyMDQuOHMtMjA0LjgtOTEuNDI4NTcxLTIwNC44LTIwNC44eiBtMC0xMDIuNGMtNDMuODg1NzE0IDAtNzYuOC0zMi45MTQyODYtNzYuOC03Ni44czMyLjkxNDI4Ni03Ni44IDc2LjgtNzYuOCA3Ni44IDMyLjkxNDI4NiA3Ni44IDc2LjgtMzIuOTE0Mjg2IDc2LjgtNzYuOCA3Ni44eiBtNDA5LjYgMGMtNDMuODg1NzE0IDAtNzYuOC0zMi45MTQyODYtNzYuOC03Ni44czMyLjkxNDI4Ni03Ni44IDc2LjgtNzYuOGM0My44ODU3MTQgMCA3Ni44IDMyLjkxNDI4NiA3Ni44IDc2LjhzLTMyLjkxNDI4NiA3Ni44LTc2LjggNzYuOHoiPjwvcGF0aD48L3N2Zz4nLHRoaXMudGFnPSJidXR0b24iLHRoaXMuc2hvd0Ryb3BQYW5lbD0hMCx0aGlzLiRjb250ZW50PW51bGw7fXJldHVybiB0LnByb3RvdHlwZS5leGVjPWZ1bmN0aW9uKHQsZSl7fSx0LnByb3RvdHlwZS5nZXRWYWx1ZT1mdW5jdGlvbih0KXtyZXR1cm4gIiJ9LHQucHJvdG90eXBlLmlzQWN0aXZlPWZ1bmN0aW9uKHQpe3JldHVybiAhMX0sdC5wcm90b3R5cGUuaXNEaXNhYmxlZD1mdW5jdGlvbih0KXtyZXR1cm4gbnVsbD09dC5zZWxlY3Rpb258fCEheG8oci5FZGl0b3Iubm9kZXModCx7bWF0Y2g6ZnVuY3Rpb24obil7cmV0dXJuICJwcmUiPT09ZS5Eb21FZGl0b3IuZ2V0Tm9kZVR5cGUobil8fCEhci5FZGl0b3IuaXNWb2lkKHQsbil9LHVuaXZlcnNhbDohMH0pLDEpWzBdfSx0LnByb3RvdHlwZS5nZXRQYW5lbENvbnRlbnRFbGVtPWZ1bmN0aW9uKHQpe2lmKG51bGw9PXRoaXMuJGNvbnRlbnQpe3ZhciBlPWMuZGVmYXVsdCgnPHVsIGNsYXNzPSJ3LWUtcGFuZWwtY29udGVudC1lbW90aW9uIj48L3VsPicpO2Uub24oImNsaWNrIiwibGkiLChmdW5jdGlvbihlKXt2YXIgbj1lLnRhcmdldDtpZihudWxsIT1uKXtlLnByZXZlbnREZWZhdWx0KCk7dmFyIHI9Yy5kZWZhdWx0KG4pLnRleHQoKTt0Lmluc2VydFRleHQocik7fX0pKSx0aGlzLiRjb250ZW50PWU7fXZhciBuPXRoaXMuJGNvbnRlbnQ7aWYobnVsbD09bilyZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidWwiKTtuLmVtcHR5KCk7dmFyIHI9dC5nZXRNZW51Q29uZmlnKCJlbW90aW9uIikuZW1vdGlvbnM7cmV0dXJuICh2b2lkIDA9PT1yP1tdOnIpLmZvckVhY2goKGZ1bmN0aW9uKHQpe3ZhciBlPWMuZGVmYXVsdCgiPGxpPiIrdCsiPC9saT4iKTtuLmFwcGVuZChlKTt9KSksblswXX0sdH0oKTt2YXIgRGE9e21lbnVzOlt7a2V5OiJlbW90aW9uIixmYWN0b3J5OmZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBqYX0sY29uZmlnOntlbW90aW9uczoi8J+YgCDwn5iDIPCfmIQg8J+YgSDwn5iGIPCfmIUg8J+YgiDwn6SjIPCfmIog8J+YhyDwn5mCIPCfmYMg8J+YiSDwn5iMIPCfmI0g8J+YmCDwn5iXIPCfmJkg8J+YmiDwn5iLIPCfmJsg8J+YnSDwn5icIPCfpJMg8J+YjiDwn5iPIPCfmJIg8J+YniDwn5iUIPCfmJ8g8J+YlSDwn5mBIPCfmKMg8J+YliDwn5irIPCfmKkg8J+YoiDwn5itIPCfmKQg8J+YoCDwn5ihIPCfmLMg8J+YsSDwn5ioIPCfpJcg8J+klCDwn5i2IPCfmJEg8J+YrCDwn5mEIPCfmK8g8J+YtCDwn5i3IPCfpJEg8J+YiCDwn6ShIPCfkqkg8J+RuyDwn5KAIPCfkYAg8J+RoyDwn5GQIPCfmYwg8J+RjyDwn6SdIPCfkY0g8J+RjiDwn5GKIOKciiDwn6SbIPCfpJwg8J+kniDinIzvuI8g8J+kmCDwn5GMIPCfkYgg8J+RiSDwn5GGIPCfkYcg4pid77iPIOKciyDwn6SaIPCflpAg8J+WliDwn5GLIPCfpJkg8J+SqiDwn5aVIOKcje+4jyDwn5mPIi5zcGxpdCgiICIpfX1dfTt2YXIgTGE9ezE6IjEycHgiLDI6IjE0cHgiLDM6IjE2cHgiLDQ6IjE5cHgiLDU6IjI0cHgiLDY6IjMycHgiLDc6IjQ4cHgifTt2YXIgemE9e3NlbGVjdG9yOiJmb250IixwcmVQYXJzZUh0bWw6ZnVuY3Rpb24odCl7dmFyIGU9Yy5kZWZhdWx0KHQpO2lmKCJmb250IiE9PWZvKGUpKXJldHVybiB0O3ZhciBuPWUuYXR0cigic2l6ZSIpfHwiIjtuJiYoZS5yZW1vdmVBdHRyKCJzaXplIiksZS5jc3MoImZvbnQtc2l6ZSIsTGFbbl0pKTt2YXIgcj1lLmF0dHIoImZhY2UiKXx8IiI7cmV0dXJuIHImJihlLnJlbW92ZUF0dHIoImZhY2UiKSxlLmNzcygiZm9udC1mYW1pbHkiLHIpKSxlWzBdfX0sQWE9RCgiIi5pbmRleE9mKTtxZSh7dGFyZ2V0OiJTdHJpbmciLHByb3RvOiEwLGZvcmNlZDohRGkoImluY2x1ZGVzIil9LHtpbmNsdWRlczpmdW5jdGlvbih0KXtyZXR1cm4gISF+QWEoYm4oUih0aGlzKSksYm4oT2kodCkpLGFyZ3VtZW50cy5sZW5ndGg+MT9hcmd1bWVudHNbMV06dm9pZCAwKX19KTt2YXIgUGEsQ2EsVmE9ZnVuY3Rpb24odCl7cmV0dXJuIHQmJnQuTWF0aD09TWF0aCYmdH0sQmE9VmEoIm9iamVjdCI9PXR5cGVvZiBnbG9iYWxUaGlzJiZnbG9iYWxUaGlzKXx8VmEoIm9iamVjdCI9PXR5cGVvZiB3aW5kb3cmJndpbmRvdyl8fFZhKCJvYmplY3QiPT10eXBlb2Ygc2VsZiYmc2VsZil8fFZhKCJvYmplY3QiPT10eXBlb2YgZCYmZCl8fGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9KCl8fEZ1bmN0aW9uKCJyZXR1cm4gdGhpcyIpKCksUmE9RnVuY3Rpb24ucHJvdG90eXBlLEZhPVJhLmFwcGx5LF9hPVJhLmJpbmQscWE9UmEuY2FsbCwkYT0ib2JqZWN0Ij09dHlwZW9mIFJlZmxlY3QmJlJlZmxlY3QuYXBwbHl8fChfYT9xYS5iaW5kKEZhKTpmdW5jdGlvbigpe3JldHVybiBxYS5hcHBseShGYSxhcmd1bWVudHMpfSksV2E9RnVuY3Rpb24ucHJvdG90eXBlLEdhPVdhLmJpbmQsVWE9V2EuY2FsbCxYYT1HYSYmR2EuYmluZChVYSksWWE9R2E/ZnVuY3Rpb24odCl7cmV0dXJuIHQmJlhhKFVhLHQpfTpmdW5jdGlvbih0KXtyZXR1cm4gdCYmZnVuY3Rpb24oKXtyZXR1cm4gVWEuYXBwbHkodCxhcmd1bWVudHMpfX0sSmE9ZnVuY3Rpb24odCl7cmV0dXJuICJmdW5jdGlvbiI9PXR5cGVvZiB0fSxLYT1mdW5jdGlvbih0KXt0cnl7cmV0dXJuICEhdCgpfWNhdGNoKHQpe3JldHVybiAhMH19LFFhPSFLYSgoZnVuY3Rpb24oKXtyZXR1cm4gNyE9T2JqZWN0LmRlZmluZVByb3BlcnR5KHt9LDEse2dldDpmdW5jdGlvbigpe3JldHVybiA3fX0pWzFdfSkpLFphPUZ1bmN0aW9uLnByb3RvdHlwZS5jYWxsLHRjPVphLmJpbmQ/WmEuYmluZChaYSk6ZnVuY3Rpb24oKXtyZXR1cm4gWmEuYXBwbHkoWmEsYXJndW1lbnRzKX0sZWM9e30ucHJvcGVydHlJc0VudW1lcmFibGUsbmM9T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcixyYz1uYyYmIWVjLmNhbGwoezE6Mn0sMSk/ZnVuY3Rpb24odCl7dmFyIGU9bmModGhpcyx0KTtyZXR1cm4gISFlJiZlLmVudW1lcmFibGV9OmVjLG9jPXtmOnJjfSxpYz1mdW5jdGlvbih0LGUpe3JldHVybiB7ZW51bWVyYWJsZTohKDEmdCksY29uZmlndXJhYmxlOiEoMiZ0KSx3cml0YWJsZTohKDQmdCksdmFsdWU6ZX19LHVjPVlhKHt9LnRvU3RyaW5nKSxhYz1ZYSgiIi5zbGljZSksY2M9ZnVuY3Rpb24odCl7cmV0dXJuIGFjKHVjKHQpLDgsLTEpfSxsYz1CYS5PYmplY3Qsc2M9WWEoIiIuc3BsaXQpLGZjPUthKChmdW5jdGlvbigpe3JldHVybiAhbGMoInoiKS5wcm9wZXJ0eUlzRW51bWVyYWJsZSgwKX0pKT9mdW5jdGlvbih0KXtyZXR1cm4gIlN0cmluZyI9PWNjKHQpP3NjKHQsIiIpOmxjKHQpfTpsYyxkYz1CYS5UeXBlRXJyb3IscGM9ZnVuY3Rpb24odCl7aWYobnVsbD09dCl0aHJvdyBkYygiQ2FuJ3QgY2FsbCBtZXRob2Qgb24gIit0KTtyZXR1cm4gdH0saGM9ZnVuY3Rpb24odCl7cmV0dXJuIGZjKHBjKHQpKX0sdmM9ZnVuY3Rpb24odCl7cmV0dXJuICJvYmplY3QiPT10eXBlb2YgdD9udWxsIT09dDpKYSh0KX0sZ2M9e30sbWM9ZnVuY3Rpb24odCl7cmV0dXJuIEphKHQpP3Q6dm9pZCAwfSx5Yz1mdW5jdGlvbih0LGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPDI/bWMoZ2NbdF0pfHxtYyhCYVt0XSk6Z2NbdF0mJmdjW3RdW2VdfHxCYVt0XSYmQmFbdF1bZV19LGJjPVlhKHt9LmlzUHJvdG90eXBlT2YpLHhjPXljKCJuYXZpZ2F0b3IiLCJ1c2VyQWdlbnQiKXx8IiIsd2M9QmEucHJvY2VzcyxFYz1CYS5EZW5vLFNjPXdjJiZ3Yy52ZXJzaW9uc3x8RWMmJkVjLnZlcnNpb24sa2M9U2MmJlNjLnY4O2tjJiYoQ2E9KFBhPWtjLnNwbGl0KCIuIikpWzBdPjAmJlBhWzBdPDQ/MTorKFBhWzBdK1BhWzFdKSksIUNhJiZ4YyYmKCEoUGE9eGMubWF0Y2goL0VkZ2VcLyhcZCspLykpfHxQYVsxXT49NzQpJiYoUGE9eGMubWF0Y2goL0Nocm9tZVwvKFxkKykvKSkmJihDYT0rUGFbMV0pO3ZhciBUYz1DYSxNYz0hIU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMmJiFLYSgoZnVuY3Rpb24oKXt2YXIgdD1TeW1ib2woKTtyZXR1cm4gIVN0cmluZyh0KXx8IShPYmplY3QodClpbnN0YW5jZW9mIFN5bWJvbCl8fCFTeW1ib2wuc2hhbSYmVGMmJlRjPDQxfSkpLEljPU1jJiYhU3ltYm9sLnNoYW0mJiJzeW1ib2wiPT10eXBlb2YgU3ltYm9sLml0ZXJhdG9yLE5jPUJhLk9iamVjdCxIYz1JYz9mdW5jdGlvbih0KXtyZXR1cm4gInN5bWJvbCI9PXR5cGVvZiB0fTpmdW5jdGlvbih0KXt2YXIgZT15YygiU3ltYm9sIik7cmV0dXJuIEphKGUpJiZiYyhlLnByb3RvdHlwZSxOYyh0KSl9LE9jPUJhLlN0cmluZyxqYz1CYS5UeXBlRXJyb3IsRGM9ZnVuY3Rpb24odCl7aWYoSmEodCkpcmV0dXJuIHQ7dGhyb3cgamMoZnVuY3Rpb24odCl7dHJ5e3JldHVybiBPYyh0KX1jYXRjaCh0KXtyZXR1cm4gIk9iamVjdCJ9fSh0KSsiIGlzIG5vdCBhIGZ1bmN0aW9uIil9LExjPUJhLlR5cGVFcnJvcix6Yz1PYmplY3QuZGVmaW5lUHJvcGVydHksQWM9Il9fY29yZS1qc19zaGFyZWRfXyIsUGM9QmFbQWNdfHxmdW5jdGlvbih0LGUpe3RyeXt6YyhCYSx0LHt2YWx1ZTplLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMH0pO31jYXRjaChuKXtCYVt0XT1lO31yZXR1cm4gZX0oQWMse30pLENjPWgoKGZ1bmN0aW9uKHQpeyh0LmV4cG9ydHM9ZnVuY3Rpb24odCxlKXtyZXR1cm4gUGNbdF18fChQY1t0XT12b2lkIDAhPT1lP2U6e30pfSkoInZlcnNpb25zIixbXSkucHVzaCh7dmVyc2lvbjoiMy4xOS4zIixtb2RlOiJwdXJlIixjb3B5cmlnaHQ6IsKpIDIwMjEgRGVuaXMgUHVzaGthcmV2ICh6bG9pcm9jay5ydSkifSk7fSkpLFZjPUJhLk9iamVjdCxCYz1mdW5jdGlvbih0KXtyZXR1cm4gVmMocGModCkpfSxSYz1ZYSh7fS5oYXNPd25Qcm9wZXJ0eSksRmM9T2JqZWN0Lmhhc093bnx8ZnVuY3Rpb24odCxlKXtyZXR1cm4gUmMoQmModCksZSl9LF9jPTAscWM9TWF0aC5yYW5kb20oKSwkYz1ZYSgxLi50b1N0cmluZyksV2M9ZnVuY3Rpb24odCl7cmV0dXJuICJTeW1ib2woIisodm9pZCAwPT09dD8iIjp0KSsiKV8iKyRjKCsrX2MrcWMsMzYpfSxHYz1DYygid2tzIiksVWM9QmEuU3ltYm9sLFhjPVVjJiZVYy5mb3IsWWM9SWM/VWM6VWMmJlVjLndpdGhvdXRTZXR0ZXJ8fFdjLEpjPWZ1bmN0aW9uKHQpe2lmKCFGYyhHYyx0KXx8IU1jJiYic3RyaW5nIiE9dHlwZW9mIEdjW3RdKXt2YXIgZT0iU3ltYm9sLiIrdDtNYyYmRmMoVWMsdCk/R2NbdF09VWNbdF06R2NbdF09SWMmJlhjP1hjKGUpOlljKGUpO31yZXR1cm4gR2NbdF19LEtjPUJhLlR5cGVFcnJvcixRYz1KYygidG9QcmltaXRpdmUiKSxaYz1mdW5jdGlvbih0LGUpe2lmKCF2Yyh0KXx8SGModCkpcmV0dXJuIHQ7dmFyIG4scixvPW51bGw9PShuPXRbUWNdKT92b2lkIDA6RGMobik7aWYobyl7aWYodm9pZCAwPT09ZSYmKGU9ImRlZmF1bHQiKSxyPXRjKG8sdCxlKSwhdmMocil8fEhjKHIpKXJldHVybiByO3Rocm93IEtjKCJDYW4ndCBjb252ZXJ0IG9iamVjdCB0byBwcmltaXRpdmUgdmFsdWUiKX1yZXR1cm4gdm9pZCAwPT09ZSYmKGU9Im51bWJlciIpLGZ1bmN0aW9uKHQsZSl7dmFyIG4scjtpZigic3RyaW5nIj09PWUmJkphKG49dC50b1N0cmluZykmJiF2YyhyPXRjKG4sdCkpKXJldHVybiByO2lmKEphKG49dC52YWx1ZU9mKSYmIXZjKHI9dGMobix0KSkpcmV0dXJuIHI7aWYoInN0cmluZyIhPT1lJiZKYShuPXQudG9TdHJpbmcpJiYhdmMocj10YyhuLHQpKSlyZXR1cm4gcjt0aHJvdyBMYygiQ2FuJ3QgY29udmVydCBvYmplY3QgdG8gcHJpbWl0aXZlIHZhbHVlIil9KHQsZSl9LHRsPWZ1bmN0aW9uKHQpe3ZhciBlPVpjKHQsInN0cmluZyIpO3JldHVybiBIYyhlKT9lOmUrIiJ9LGVsPUJhLmRvY3VtZW50LG5sPXZjKGVsKSYmdmMoZWwuY3JlYXRlRWxlbWVudCkscmw9ZnVuY3Rpb24odCl7cmV0dXJuIG5sP2VsLmNyZWF0ZUVsZW1lbnQodCk6e319LG9sPSFRYSYmIUthKChmdW5jdGlvbigpe3JldHVybiA3IT1PYmplY3QuZGVmaW5lUHJvcGVydHkocmwoImRpdiIpLCJhIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIDd9fSkuYX0pKSxpbD1PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLHVsPXtmOlFhP2lsOmZ1bmN0aW9uKHQsZSl7aWYodD1oYyh0KSxlPXRsKGUpLG9sKXRyeXtyZXR1cm4gaWwodCxlKX1jYXRjaCh0KXt9aWYoRmModCxlKSlyZXR1cm4gaWMoIXRjKG9jLmYsdCxlKSx0W2VdKX19LGFsPS8jfFwucHJvdG90eXBlXC4vLGNsPWZ1bmN0aW9uKHQsZSl7dmFyIG49c2xbbGwodCldO3JldHVybiBuPT1kbHx8biE9ZmwmJihKYShlKT9LYShlKTohIWUpfSxsbD1jbC5ub3JtYWxpemU9ZnVuY3Rpb24odCl7cmV0dXJuIFN0cmluZyh0KS5yZXBsYWNlKGFsLCIuIikudG9Mb3dlckNhc2UoKX0sc2w9Y2wuZGF0YT17fSxmbD1jbC5OQVRJVkU9Ik4iLGRsPWNsLlBPTFlGSUxMPSJQIixwbD1jbCxobD1ZYShZYS5iaW5kKSx2bD1mdW5jdGlvbih0LGUpe3JldHVybiBEYyh0KSx2b2lkIDA9PT1lP3Q6aGw/aGwodCxlKTpmdW5jdGlvbigpe3JldHVybiB0LmFwcGx5KGUsYXJndW1lbnRzKX19LGdsPUJhLlN0cmluZyxtbD1CYS5UeXBlRXJyb3IseWw9ZnVuY3Rpb24odCl7aWYodmModCkpcmV0dXJuIHQ7dGhyb3cgbWwoZ2wodCkrIiBpcyBub3QgYW4gb2JqZWN0Iil9LGJsPUJhLlR5cGVFcnJvcix4bD1PYmplY3QuZGVmaW5lUHJvcGVydHksd2w9e2Y6UWE/eGw6ZnVuY3Rpb24odCxlLG4pe2lmKHlsKHQpLGU9dGwoZSkseWwobiksb2wpdHJ5e3JldHVybiB4bCh0LGUsbil9Y2F0Y2godCl7fWlmKCJnZXQiaW4gbnx8InNldCJpbiBuKXRocm93IGJsKCJBY2Nlc3NvcnMgbm90IHN1cHBvcnRlZCIpO3JldHVybiAidmFsdWUiaW4gbiYmKHRbZV09bi52YWx1ZSksdH19LEVsPVFhP2Z1bmN0aW9uKHQsZSxuKXtyZXR1cm4gd2wuZih0LGUsaWMoMSxuKSl9OmZ1bmN0aW9uKHQsZSxuKXtyZXR1cm4gdFtlXT1uLHR9LFNsPXVsLmYsa2w9ZnVuY3Rpb24odCl7dmFyIGU9ZnVuY3Rpb24obixyLG8pe2lmKHRoaXMgaW5zdGFuY2VvZiBlKXtzd2l0Y2goYXJndW1lbnRzLmxlbmd0aCl7Y2FzZSAwOnJldHVybiBuZXcgdDtjYXNlIDE6cmV0dXJuIG5ldyB0KG4pO2Nhc2UgMjpyZXR1cm4gbmV3IHQobixyKX1yZXR1cm4gbmV3IHQobixyLG8pfXJldHVybiAkYSh0LHRoaXMsYXJndW1lbnRzKX07cmV0dXJuIGUucHJvdG90eXBlPXQucHJvdG90eXBlLGV9LFRsPWZ1bmN0aW9uKHQsZSl7dmFyIG4scixvLGksdSxhLGMsbCxzPXQudGFyZ2V0LGY9dC5nbG9iYWwsZD10LnN0YXQscD10LnByb3RvLGg9Zj9CYTpkP0JhW3NdOihCYVtzXXx8e30pLnByb3RvdHlwZSx2PWY/Z2M6Z2Nbc118fEVsKGdjLHMse30pW3NdLGc9di5wcm90b3R5cGU7Zm9yKG8gaW4gZSluPSFwbChmP286cysoZD8iLiI6IiMiKStvLHQuZm9yY2VkKSYmaCYmRmMoaCxvKSx1PXZbb10sbiYmKGE9dC5ub1RhcmdldEdldD8obD1TbChoLG8pKSYmbC52YWx1ZTpoW29dKSxpPW4mJmE/YTplW29dLG4mJnR5cGVvZiB1PT10eXBlb2YgaXx8KGM9dC5iaW5kJiZuP3ZsKGksQmEpOnQud3JhcCYmbj9rbChpKTpwJiZKYShpKT9ZYShpKTppLCh0LnNoYW18fGkmJmkuc2hhbXx8dSYmdS5zaGFtKSYmRWwoYywic2hhbSIsITApLEVsKHYsbyxjKSxwJiYoRmMoZ2Mscj1zKyJQcm90b3R5cGUiKXx8RWwoZ2Mscix7fSksRWwoZ2Nbcl0sbyxpKSx0LnJlYWwmJmcmJiFnW29dJiZFbChnLG8saSkpKTt9LE1sPUFycmF5LmlzQXJyYXl8fGZ1bmN0aW9uKHQpe3JldHVybiAiQXJyYXkiPT1jYyh0KX0sSWw9TWF0aC5jZWlsLE5sPU1hdGguZmxvb3IsSGw9ZnVuY3Rpb24odCl7dmFyIGU9K3Q7cmV0dXJuIGUhPWV8fDA9PT1lPzA6KGU+MD9ObDpJbCkoZSl9LE9sPU1hdGgubWluLGpsPWZ1bmN0aW9uKHQpe3JldHVybiAoZT10Lmxlbmd0aCk+MD9PbChIbChlKSw5MDA3MTk5MjU0NzQwOTkxKTowO3ZhciBlO30sRGw9ZnVuY3Rpb24odCxlLG4pe3ZhciByPXRsKGUpO3IgaW4gdD93bC5mKHQscixpYygwLG4pKTp0W3JdPW47fSxMbD17fTtMbFtKYygidG9TdHJpbmdUYWciKV09InoiO3ZhciB6bD0iW29iamVjdCB6XSI9PT1TdHJpbmcoTGwpLEFsPUpjKCJ0b1N0cmluZ1RhZyIpLFBsPUJhLk9iamVjdCxDbD0iQXJndW1lbnRzIj09Y2MoZnVuY3Rpb24oKXtyZXR1cm4gYXJndW1lbnRzfSgpKSxWbD16bD9jYzpmdW5jdGlvbih0KXt2YXIgZSxuLHI7cmV0dXJuIHZvaWQgMD09PXQ/IlVuZGVmaW5lZCI6bnVsbD09PXQ/Ik51bGwiOiJzdHJpbmciPT10eXBlb2Yobj1mdW5jdGlvbih0LGUpe3RyeXtyZXR1cm4gdFtlXX1jYXRjaCh0KXt9fShlPVBsKHQpLEFsKSk/bjpDbD9jYyhlKToiT2JqZWN0Ij09KHI9Y2MoZSkpJiZKYShlLmNhbGxlZSk/IkFyZ3VtZW50cyI6cn0sQmw9WWEoRnVuY3Rpb24udG9TdHJpbmcpO0phKFBjLmluc3BlY3RTb3VyY2UpfHwoUGMuaW5zcGVjdFNvdXJjZT1mdW5jdGlvbih0KXtyZXR1cm4gQmwodCl9KTt2YXIgUmw9UGMuaW5zcGVjdFNvdXJjZSxGbD1mdW5jdGlvbigpe30sX2w9W10scWw9eWMoIlJlZmxlY3QiLCJjb25zdHJ1Y3QiKSwkbD0vXlxzKig/OmNsYXNzfGZ1bmN0aW9uKVxiLyxXbD1ZYSgkbC5leGVjKSxHbD0hJGwuZXhlYyhGbCksVWw9ZnVuY3Rpb24odCl7aWYoIUphKHQpKXJldHVybiAhMTt0cnl7cmV0dXJuIHFsKEZsLF9sLHQpLCEwfWNhdGNoKHQpe3JldHVybiAhMX19LFhsPSFxbHx8S2EoKGZ1bmN0aW9uKCl7dmFyIHQ7cmV0dXJuIFVsKFVsLmNhbGwpfHwhVWwoT2JqZWN0KXx8IVVsKChmdW5jdGlvbigpe3Q9ITA7fSkpfHx0fSkpP2Z1bmN0aW9uKHQpe2lmKCFKYSh0KSlyZXR1cm4gITE7c3dpdGNoKFZsKHQpKXtjYXNlIkFzeW5jRnVuY3Rpb24iOmNhc2UiR2VuZXJhdG9yRnVuY3Rpb24iOmNhc2UiQXN5bmNHZW5lcmF0b3JGdW5jdGlvbiI6cmV0dXJuICExfXJldHVybiBHbHx8ISFXbCgkbCxSbCh0KSl9OlVsLFlsPUpjKCJzcGVjaWVzIiksSmw9QmEuQXJyYXksS2w9ZnVuY3Rpb24odCxlKXtyZXR1cm4gbmV3KGZ1bmN0aW9uKHQpe3ZhciBlO3JldHVybiBNbCh0KSYmKGU9dC5jb25zdHJ1Y3RvciwoWGwoZSkmJihlPT09Smx8fE1sKGUucHJvdG90eXBlKSl8fHZjKGUpJiZudWxsPT09KGU9ZVtZbF0pKSYmKGU9dm9pZCAwKSksdm9pZCAwPT09ZT9KbDplfSh0KSkoMD09PWU/MDplKX0sUWw9SmMoInNwZWNpZXMiKSxabD1KYygiaXNDb25jYXRTcHJlYWRhYmxlIiksdHM9OTAwNzE5OTI1NDc0MDk5MSxlcz0iTWF4aW11bSBhbGxvd2VkIGluZGV4IGV4Y2VlZGVkIixucz1CYS5UeXBlRXJyb3IscnM9VGM+PTUxfHwhS2EoKGZ1bmN0aW9uKCl7dmFyIHQ9W107cmV0dXJuIHRbWmxdPSExLHQuY29uY2F0KClbMF0hPT10fSkpLG9zPWZ1bmN0aW9uKHQpe3JldHVybiBUYz49NTF8fCFLYSgoZnVuY3Rpb24oKXt2YXIgZT1bXTtyZXR1cm4gKGUuY29uc3RydWN0b3I9e30pW1FsXT1mdW5jdGlvbigpe3JldHVybiB7Zm9vOjF9fSwxIT09ZVt0XShCb29sZWFuKS5mb299KSl9KCJjb25jYXQiKSxpcz1mdW5jdGlvbih0KXtpZighdmModCkpcmV0dXJuICExO3ZhciBlPXRbWmxdO3JldHVybiB2b2lkIDAhPT1lPyEhZTpNbCh0KX07VGwoe3RhcmdldDoiQXJyYXkiLHByb3RvOiEwLGZvcmNlZDohcnN8fCFvc30se2NvbmNhdDpmdW5jdGlvbih0KXt2YXIgZSxuLHIsbyxpLHU9QmModGhpcyksYT1LbCh1LDApLGM9MDtmb3IoZT0tMSxyPWFyZ3VtZW50cy5sZW5ndGg7ZTxyO2UrKylpZihpcyhpPS0xPT09ZT91OmFyZ3VtZW50c1tlXSkpe2lmKGMrKG89amwoaSkpPnRzKXRocm93IG5zKGVzKTtmb3Iobj0wO248bztuKyssYysrKW4gaW4gaSYmRGwoYSxjLGlbbl0pO31lbHNlIHtpZihjPj10cyl0aHJvdyBucyhlcyk7RGwoYSxjKyssaSk7fXJldHVybiBhLmxlbmd0aD1jLGF9fSk7dmFyIHVzLGFzPUJhLlN0cmluZyxjcz1mdW5jdGlvbih0KXtpZigiU3ltYm9sIj09PVZsKHQpKXRocm93IFR5cGVFcnJvcigiQ2Fubm90IGNvbnZlcnQgYSBTeW1ib2wgdmFsdWUgdG8gYSBzdHJpbmciKTtyZXR1cm4gYXModCl9LGxzPU1hdGgubWF4LHNzPU1hdGgubWluLGZzPWZ1bmN0aW9uKHQsZSl7dmFyIG49SGwodCk7cmV0dXJuIG48MD9scyhuK2UsMCk6c3MobixlKX0sZHM9ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGUsbixyKXt2YXIgbyxpPWhjKGUpLHU9amwoaSksYT1mcyhyLHUpO2lmKHQmJm4hPW4pe2Zvcig7dT5hOylpZigobz1pW2ErK10pIT1vKXJldHVybiAhMH1lbHNlIGZvcig7dT5hO2ErKylpZigodHx8YSBpbiBpKSYmaVthXT09PW4pcmV0dXJuIHR8fGF8fDA7cmV0dXJuICF0JiYtMX19LHBzPXtpbmNsdWRlczpkcyghMCksaW5kZXhPZjpkcyghMSl9LGhzPXt9LHZzPXBzLmluZGV4T2YsZ3M9WWEoW10ucHVzaCksbXM9ZnVuY3Rpb24odCxlKXt2YXIgbixyPWhjKHQpLG89MCxpPVtdO2ZvcihuIGluIHIpIUZjKGhzLG4pJiZGYyhyLG4pJiZncyhpLG4pO2Zvcig7ZS5sZW5ndGg+bzspRmMocixuPWVbbysrXSkmJih+dnMoaSxuKXx8Z3MoaSxuKSk7cmV0dXJuIGl9LHlzPVsiY29uc3RydWN0b3IiLCJoYXNPd25Qcm9wZXJ0eSIsImlzUHJvdG90eXBlT2YiLCJwcm9wZXJ0eUlzRW51bWVyYWJsZSIsInRvTG9jYWxlU3RyaW5nIiwidG9TdHJpbmciLCJ2YWx1ZU9mIl0sYnM9T2JqZWN0LmtleXN8fGZ1bmN0aW9uKHQpe3JldHVybiBtcyh0LHlzKX0seHM9UWE/T2JqZWN0LmRlZmluZVByb3BlcnRpZXM6ZnVuY3Rpb24odCxlKXt5bCh0KTtmb3IodmFyIG4scj1oYyhlKSxvPWJzKGUpLGk9by5sZW5ndGgsdT0wO2k+dTspd2wuZih0LG49b1t1KytdLHJbbl0pO3JldHVybiB0fSx3cz15YygiZG9jdW1lbnQiLCJkb2N1bWVudEVsZW1lbnQiKSxFcz1DYygia2V5cyIpLFNzPWZ1bmN0aW9uKHQpe3JldHVybiBFc1t0XXx8KEVzW3RdPVdjKHQpKX0sa3M9U3MoIklFX1BST1RPIiksVHM9ZnVuY3Rpb24oKXt9LE1zPWZ1bmN0aW9uKHQpe3JldHVybiAiPHNjcmlwdD4iK3QrIjwvIisic2NyaXB0PiJ9LElzPWZ1bmN0aW9uKHQpe3Qud3JpdGUoTXMoIiIpKSx0LmNsb3NlKCk7dmFyIGU9dC5wYXJlbnRXaW5kb3cuT2JqZWN0O3JldHVybiB0PW51bGwsZX0sTnM9ZnVuY3Rpb24oKXt0cnl7dXM9bmV3IEFjdGl2ZVhPYmplY3QoImh0bWxmaWxlIik7fWNhdGNoKHQpe312YXIgdCxlO05zPSJ1bmRlZmluZWQiIT10eXBlb2YgZG9jdW1lbnQ/ZG9jdW1lbnQuZG9tYWluJiZ1cz9Jcyh1cyk6KChlPXJsKCJpZnJhbWUiKSkuc3R5bGUuZGlzcGxheT0ibm9uZSIsd3MuYXBwZW5kQ2hpbGQoZSksZS5zcmM9U3RyaW5nKCJqYXZhc2NyaXB0OiIpLCh0PWUuY29udGVudFdpbmRvdy5kb2N1bWVudCkub3BlbigpLHQud3JpdGUoTXMoImRvY3VtZW50LkY9T2JqZWN0IikpLHQuY2xvc2UoKSx0LkYpOklzKHVzKTtmb3IodmFyIG49eXMubGVuZ3RoO24tLTspZGVsZXRlIE5zLnByb3RvdHlwZVt5c1tuXV07cmV0dXJuIE5zKCl9O2hzW2tzXT0hMDt2YXIgSHMsT3MsanMsRHM9T2JqZWN0LmNyZWF0ZXx8ZnVuY3Rpb24odCxlKXt2YXIgbjtyZXR1cm4gbnVsbCE9PXQ/KFRzLnByb3RvdHlwZT15bCh0KSxuPW5ldyBUcyxUcy5wcm90b3R5cGU9bnVsbCxuW2tzXT10KTpuPU5zKCksdm9pZCAwPT09ZT9uOnhzKG4sZSl9LExzPXlzLmNvbmNhdCgibGVuZ3RoIiwicHJvdG90eXBlIiksenM9e2Y6T2JqZWN0LmdldE93blByb3BlcnR5TmFtZXN8fGZ1bmN0aW9uKHQpe3JldHVybiBtcyh0LExzKX19LEFzPUJhLkFycmF5LFBzPU1hdGgubWF4LENzPXpzLmYsVnM9Im9iamVjdCI9PXR5cGVvZiB3aW5kb3cmJndpbmRvdyYmT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXM/T2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMod2luZG93KTpbXSxCcz1mdW5jdGlvbih0KXt0cnl7cmV0dXJuIENzKHQpfWNhdGNoKHQpe3JldHVybiBmdW5jdGlvbih0LGUsbil7Zm9yKHZhciByPWpsKHQpLG89ZnMoZSxyKSxpPWZzKHZvaWQgMD09PW4/cjpuLHIpLHU9QXMoUHMoaS1vLDApKSxhPTA7bzxpO28rKyxhKyspRGwodSxhLHRbb10pO3JldHVybiB1Lmxlbmd0aD1hLHV9KFZzKX19LFJzPXtmOmZ1bmN0aW9uKHQpe3JldHVybiBWcyYmIldpbmRvdyI9PWNjKHQpP0JzKHQpOkNzKGhjKHQpKX19LEZzPXtmOk9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHN9LF9zPVlhKFtdLnNsaWNlKSxxcz1mdW5jdGlvbih0LGUsbixyKXtyJiZyLmVudW1lcmFibGU/dFtlXT1uOkVsKHQsZSxuKTt9LCRzPXtmOkpjfSxXcz13bC5mLEdzPWZ1bmN0aW9uKHQpe3ZhciBlPWdjLlN5bWJvbHx8KGdjLlN5bWJvbD17fSk7RmMoZSx0KXx8V3MoZSx0LHt2YWx1ZTokcy5mKHQpfSk7fSxVcz16bD97fS50b1N0cmluZzpmdW5jdGlvbigpe3JldHVybiAiW29iamVjdCAiK1ZsKHRoaXMpKyJdIn0sWHM9d2wuZixZcz1KYygidG9TdHJpbmdUYWciKSxKcz1mdW5jdGlvbih0LGUsbixyKXtpZih0KXt2YXIgbz1uP3Q6dC5wcm90b3R5cGU7RmMobyxZcyl8fFhzKG8sWXMse2NvbmZpZ3VyYWJsZTohMCx2YWx1ZTplfSksciYmIXpsJiZFbChvLCJ0b1N0cmluZyIsVXMpO319LEtzPUJhLldlYWtNYXAsUXM9SmEoS3MpJiYvbmF0aXZlIGNvZGUvLnRlc3QoUmwoS3MpKSxacz0iT2JqZWN0IGFscmVhZHkgaW5pdGlhbGl6ZWQiLHRmPUJhLlR5cGVFcnJvcixlZj1CYS5XZWFrTWFwO2lmKFFzfHxQYy5zdGF0ZSl7dmFyIG5mPVBjLnN0YXRlfHwoUGMuc3RhdGU9bmV3IGVmKSxyZj1ZYShuZi5nZXQpLG9mPVlhKG5mLmhhcyksdWY9WWEobmYuc2V0KTtIcz1mdW5jdGlvbih0LGUpe2lmKG9mKG5mLHQpKXRocm93IG5ldyB0Zihacyk7cmV0dXJuIGUuZmFjYWRlPXQsdWYobmYsdCxlKSxlfSxPcz1mdW5jdGlvbih0KXtyZXR1cm4gcmYobmYsdCl8fHt9fSxqcz1mdW5jdGlvbih0KXtyZXR1cm4gb2YobmYsdCl9O31lbHNlIHt2YXIgYWY9U3MoInN0YXRlIik7aHNbYWZdPSEwLEhzPWZ1bmN0aW9uKHQsZSl7aWYoRmModCxhZikpdGhyb3cgbmV3IHRmKFpzKTtyZXR1cm4gZS5mYWNhZGU9dCxFbCh0LGFmLGUpLGV9LE9zPWZ1bmN0aW9uKHQpe3JldHVybiBGYyh0LGFmKT90W2FmXTp7fX0sanM9ZnVuY3Rpb24odCl7cmV0dXJuIEZjKHQsYWYpfTt9dmFyIGNmPXtzZXQ6SHMsZ2V0Ok9zLGhhczpqcyxlbmZvcmNlOmZ1bmN0aW9uKHQpe3JldHVybiBqcyh0KT9Pcyh0KTpIcyh0LHt9KX0sZ2V0dGVyRm9yOmZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihlKXt2YXIgbjtpZighdmMoZSl8fChuPU9zKGUpKS50eXBlIT09dCl0aHJvdyB0ZigiSW5jb21wYXRpYmxlIHJlY2VpdmVyLCAiK3QrIiByZXF1aXJlZCIpO3JldHVybiBufX19LGxmPVlhKFtdLnB1c2gpLHNmPWZ1bmN0aW9uKHQpe3ZhciBlPTE9PXQsbj0yPT10LHI9Mz09dCxvPTQ9PXQsaT02PT10LHU9Nz09dCxhPTU9PXR8fGk7cmV0dXJuIGZ1bmN0aW9uKGMsbCxzLGYpe2Zvcih2YXIgZCxwLGg9QmMoYyksdj1mYyhoKSxnPXZsKGwscyksbT1qbCh2KSx5PTAsYj1mfHxLbCx4PWU/YihjLG0pOm58fHU/YihjLDApOnZvaWQgMDttPnk7eSsrKWlmKChhfHx5IGluIHYpJiYocD1nKGQ9dlt5XSx5LGgpLHQpKWlmKGUpeFt5XT1wO2Vsc2UgaWYocClzd2l0Y2godCl7Y2FzZSAzOnJldHVybiAhMDtjYXNlIDU6cmV0dXJuIGQ7Y2FzZSA2OnJldHVybiB5O2Nhc2UgMjpsZih4LGQpO31lbHNlIHN3aXRjaCh0KXtjYXNlIDQ6cmV0dXJuICExO2Nhc2UgNzpsZih4LGQpO31yZXR1cm4gaT8tMTpyfHxvP286eH19LGZmPXtmb3JFYWNoOnNmKDApLG1hcDpzZigxKSxmaWx0ZXI6c2YoMiksc29tZTpzZigzKSxldmVyeTpzZig0KSxmaW5kOnNmKDUpLGZpbmRJbmRleDpzZig2KSxmaWx0ZXJSZWplY3Q6c2YoNyl9LmZvckVhY2gsZGY9U3MoImhpZGRlbiIpLHBmPSJTeW1ib2wiLGhmPUpjKCJ0b1ByaW1pdGl2ZSIpLHZmPWNmLnNldCxnZj1jZi5nZXR0ZXJGb3IocGYpLG1mPU9iamVjdC5wcm90b3R5cGUseWY9QmEuU3ltYm9sLGJmPXlmJiZ5Zi5wcm90b3R5cGUseGY9QmEuVHlwZUVycm9yLHdmPUJhLlFPYmplY3QsRWY9eWMoIkpTT04iLCJzdHJpbmdpZnkiKSxTZj11bC5mLGtmPXdsLmYsVGY9UnMuZixNZj1vYy5mLElmPVlhKFtdLnB1c2gpLE5mPUNjKCJzeW1ib2xzIiksSGY9Q2MoIm9wLXN5bWJvbHMiKSxPZj1DYygic3RyaW5nLXRvLXN5bWJvbC1yZWdpc3RyeSIpLGpmPUNjKCJzeW1ib2wtdG8tc3RyaW5nLXJlZ2lzdHJ5IiksRGY9Q2MoIndrcyIpLExmPSF3Znx8IXdmLnByb3RvdHlwZXx8IXdmLnByb3RvdHlwZS5maW5kQ2hpbGQsemY9UWEmJkthKChmdW5jdGlvbigpe3JldHVybiA3IT1EcyhrZih7fSwiYSIse2dldDpmdW5jdGlvbigpe3JldHVybiBrZih0aGlzLCJhIix7dmFsdWU6N30pLmF9fSkpLmF9KSk/ZnVuY3Rpb24odCxlLG4pe3ZhciByPVNmKG1mLGUpO3ImJmRlbGV0ZSBtZltlXSxrZih0LGUsbiksciYmdCE9PW1mJiZrZihtZixlLHIpO306a2YsQWY9ZnVuY3Rpb24odCxlKXt2YXIgbj1OZlt0XT1EcyhiZik7cmV0dXJuIHZmKG4se3R5cGU6cGYsdGFnOnQsZGVzY3JpcHRpb246ZX0pLFFhfHwobi5kZXNjcmlwdGlvbj1lKSxufSxQZj1mdW5jdGlvbih0LGUsbil7dD09PW1mJiZQZihIZixlLG4pLHlsKHQpO3ZhciByPXRsKGUpO3JldHVybiB5bChuKSxGYyhOZixyKT8obi5lbnVtZXJhYmxlPyhGYyh0LGRmKSYmdFtkZl1bcl0mJih0W2RmXVtyXT0hMSksbj1EcyhuLHtlbnVtZXJhYmxlOmljKDAsITEpfSkpOihGYyh0LGRmKXx8a2YodCxkZixpYygxLHt9KSksdFtkZl1bcl09ITApLHpmKHQscixuKSk6a2YodCxyLG4pfSxDZj1mdW5jdGlvbih0LGUpe3lsKHQpO3ZhciBuPWhjKGUpLHI9YnMobikuY29uY2F0KEZmKG4pKTtyZXR1cm4gZmYociwoZnVuY3Rpb24oZSl7UWEmJiF0YyhWZixuLGUpfHxQZih0LGUsbltlXSk7fSkpLHR9LFZmPWZ1bmN0aW9uKHQpe3ZhciBlPXRsKHQpLG49dGMoTWYsdGhpcyxlKTtyZXR1cm4gISh0aGlzPT09bWYmJkZjKE5mLGUpJiYhRmMoSGYsZSkpJiYoIShufHwhRmModGhpcyxlKXx8IUZjKE5mLGUpfHxGYyh0aGlzLGRmKSYmdGhpc1tkZl1bZV0pfHxuKX0sQmY9ZnVuY3Rpb24odCxlKXt2YXIgbj1oYyh0KSxyPXRsKGUpO2lmKG4hPT1tZnx8IUZjKE5mLHIpfHxGYyhIZixyKSl7dmFyIG89U2YobixyKTtyZXR1cm4gIW98fCFGYyhOZixyKXx8RmMobixkZikmJm5bZGZdW3JdfHwoby5lbnVtZXJhYmxlPSEwKSxvfX0sUmY9ZnVuY3Rpb24odCl7dmFyIGU9VGYoaGModCkpLG49W107cmV0dXJuIGZmKGUsKGZ1bmN0aW9uKHQpe0ZjKE5mLHQpfHxGYyhocyx0KXx8SWYobix0KTt9KSksbn0sRmY9ZnVuY3Rpb24odCl7dmFyIGU9dD09PW1mLG49VGYoZT9IZjpoYyh0KSkscj1bXTtyZXR1cm4gZmYobiwoZnVuY3Rpb24odCl7IUZjKE5mLHQpfHxlJiYhRmMobWYsdCl8fElmKHIsTmZbdF0pO30pKSxyfTtpZihNY3x8KHlmPWZ1bmN0aW9uKCl7aWYoYmMoYmYsdGhpcykpdGhyb3cgeGYoIlN5bWJvbCBpcyBub3QgYSBjb25zdHJ1Y3RvciIpO3ZhciB0PWFyZ3VtZW50cy5sZW5ndGgmJnZvaWQgMCE9PWFyZ3VtZW50c1swXT9jcyhhcmd1bWVudHNbMF0pOnZvaWQgMCxlPVdjKHQpLG49ZnVuY3Rpb24odCl7dGhpcz09PW1mJiZ0YyhuLEhmLHQpLEZjKHRoaXMsZGYpJiZGYyh0aGlzW2RmXSxlKSYmKHRoaXNbZGZdW2VdPSExKSx6Zih0aGlzLGUsaWMoMSx0KSk7fTtyZXR1cm4gUWEmJkxmJiZ6ZihtZixlLHtjb25maWd1cmFibGU6ITAsc2V0Om59KSxBZihlLHQpfSxiZj15Zi5wcm90b3R5cGUscXMoYmYsInRvU3RyaW5nIiwoZnVuY3Rpb24oKXtyZXR1cm4gZ2YodGhpcykudGFnfSkpLHFzKHlmLCJ3aXRob3V0U2V0dGVyIiwoZnVuY3Rpb24odCl7cmV0dXJuIEFmKFdjKHQpLHQpfSkpLG9jLmY9VmYsd2wuZj1QZix1bC5mPUJmLHpzLmY9UnMuZj1SZixGcy5mPUZmLCRzLmY9ZnVuY3Rpb24odCl7cmV0dXJuIEFmKEpjKHQpLHQpfSxRYSYma2YoYmYsImRlc2NyaXB0aW9uIix7Y29uZmlndXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiBnZih0aGlzKS5kZXNjcmlwdGlvbn19KSksVGwoe2dsb2JhbDohMCx3cmFwOiEwLGZvcmNlZDohTWMsc2hhbTohTWN9LHtTeW1ib2w6eWZ9KSxmZihicyhEZiksKGZ1bmN0aW9uKHQpe0dzKHQpO30pKSxUbCh7dGFyZ2V0OnBmLHN0YXQ6ITAsZm9yY2VkOiFNY30se2ZvcjpmdW5jdGlvbih0KXt2YXIgZT1jcyh0KTtpZihGYyhPZixlKSlyZXR1cm4gT2ZbZV07dmFyIG49eWYoZSk7cmV0dXJuIE9mW2VdPW4samZbbl09ZSxufSxrZXlGb3I6ZnVuY3Rpb24odCl7aWYoIUhjKHQpKXRocm93IHhmKHQrIiBpcyBub3QgYSBzeW1ib2wiKTtpZihGYyhqZix0KSlyZXR1cm4gamZbdF19LHVzZVNldHRlcjpmdW5jdGlvbigpe0xmPSEwO30sdXNlU2ltcGxlOmZ1bmN0aW9uKCl7TGY9ITE7fX0pLFRsKHt0YXJnZXQ6Ik9iamVjdCIsc3RhdDohMCxmb3JjZWQ6IU1jLHNoYW06IVFhfSx7Y3JlYXRlOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHZvaWQgMD09PWU/RHModCk6Q2YoRHModCksZSl9LGRlZmluZVByb3BlcnR5OlBmLGRlZmluZVByb3BlcnRpZXM6Q2YsZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOkJmfSksVGwoe3RhcmdldDoiT2JqZWN0IixzdGF0OiEwLGZvcmNlZDohTWN9LHtnZXRPd25Qcm9wZXJ0eU5hbWVzOlJmLGdldE93blByb3BlcnR5U3ltYm9sczpGZn0pLFRsKHt0YXJnZXQ6Ik9iamVjdCIsc3RhdDohMCxmb3JjZWQ6S2EoKGZ1bmN0aW9uKCl7RnMuZigxKTt9KSl9LHtnZXRPd25Qcm9wZXJ0eVN5bWJvbHM6ZnVuY3Rpb24odCl7cmV0dXJuIEZzLmYoQmModCkpfX0pLEVmKXt2YXIgX2Y9IU1jfHxLYSgoZnVuY3Rpb24oKXt2YXIgdD15ZigpO3JldHVybiAiW251bGxdIiE9RWYoW3RdKXx8Int9IiE9RWYoe2E6dH0pfHwie30iIT1FZihPYmplY3QodCkpfSkpO1RsKHt0YXJnZXQ6IkpTT04iLHN0YXQ6ITAsZm9yY2VkOl9mfSx7c3RyaW5naWZ5OmZ1bmN0aW9uKHQsZSxuKXt2YXIgcj1fcyhhcmd1bWVudHMpLG89ZTtpZigodmMoZSl8fHZvaWQgMCE9PXQpJiYhSGModCkpcmV0dXJuIE1sKGUpfHwoZT1mdW5jdGlvbih0LGUpe2lmKEphKG8pJiYoZT10YyhvLHRoaXMsdCxlKSksIUhjKGUpKXJldHVybiBlfSksclsxXT1lLCRhKEVmLG51bGwscil9fSk7fWlmKCFiZltoZl0pe3ZhciBxZj1iZi52YWx1ZU9mO3FzKGJmLGhmLChmdW5jdGlvbih0KXtyZXR1cm4gdGMocWYsdGhpcyl9KSk7fUpzKHlmLHBmKSxoc1tkZl09ITAsR3MoImFzeW5jSXRlcmF0b3IiKSxHcygiaGFzSW5zdGFuY2UiKSxHcygiaXNDb25jYXRTcHJlYWRhYmxlIiksR3MoIml0ZXJhdG9yIiksR3MoIm1hdGNoIiksR3MoIm1hdGNoQWxsIiksR3MoInJlcGxhY2UiKSxHcygic2VhcmNoIiksR3MoInNwZWNpZXMiKSxHcygic3BsaXQiKSxHcygidG9QcmltaXRpdmUiKSxHcygidG9TdHJpbmdUYWciKSxHcygidW5zY29wYWJsZXMiKSxKcyhCYS5KU09OLCJKU09OIiwhMCk7dmFyICRmLFdmLEdmLFVmPWdjLlN5bWJvbCxYZj17fSxZZj1GdW5jdGlvbi5wcm90b3R5cGUsSmY9UWEmJk9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IsS2Y9RmMoWWYsIm5hbWUiKSxRZj17RVhJU1RTOktmLFBST1BFUjpLZiYmInNvbWV0aGluZyI9PT1mdW5jdGlvbigpe30ubmFtZSxDT05GSUdVUkFCTEU6S2YmJighUWF8fFFhJiZKZihZZiwibmFtZSIpLmNvbmZpZ3VyYWJsZSl9LFpmPSFLYSgoZnVuY3Rpb24oKXtmdW5jdGlvbiB0KCl7fXJldHVybiB0LnByb3RvdHlwZS5jb25zdHJ1Y3Rvcj1udWxsLE9iamVjdC5nZXRQcm90b3R5cGVPZihuZXcgdCkhPT10LnByb3RvdHlwZX0pKSx0ZD1TcygiSUVfUFJPVE8iKSxlZD1CYS5PYmplY3QsbmQ9ZWQucHJvdG90eXBlLHJkPVpmP2VkLmdldFByb3RvdHlwZU9mOmZ1bmN0aW9uKHQpe3ZhciBlPUJjKHQpO2lmKEZjKGUsdGQpKXJldHVybiBlW3RkXTt2YXIgbj1lLmNvbnN0cnVjdG9yO3JldHVybiBKYShuKSYmZSBpbnN0YW5jZW9mIG4/bi5wcm90b3R5cGU6ZSBpbnN0YW5jZW9mIGVkP25kOm51bGx9LG9kPUpjKCJpdGVyYXRvciIpLGlkPSExO1tdLmtleXMmJigibmV4dCJpbihHZj1bXS5rZXlzKCkpPyhXZj1yZChyZChHZikpKSE9PU9iamVjdC5wcm90b3R5cGUmJigkZj1XZik6aWQ9ITApO3ZhciB1ZD1udWxsPT0kZnx8S2EoKGZ1bmN0aW9uKCl7dmFyIHQ9e307cmV0dXJuICRmW29kXS5jYWxsKHQpIT09dH0pKTskZj11ZD97fTpEcygkZiksSmEoJGZbb2RdKXx8cXMoJGYsb2QsKGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9KSk7dmFyIGFkPXtJdGVyYXRvclByb3RvdHlwZTokZixCVUdHWV9TQUZBUklfSVRFUkFUT1JTOmlkfSxjZD1hZC5JdGVyYXRvclByb3RvdHlwZSxsZD1mdW5jdGlvbigpe3JldHVybiB0aGlzfTtCYS5TdHJpbmcsQmEuVHlwZUVycm9yO09iamVjdC5zZXRQcm90b3R5cGVPZnx8Il9fcHJvdG9fXyJpbnt9JiZmdW5jdGlvbigpe3ZhciB0LGU9ITEsbj17fTt0cnl7KHQ9WWEoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihPYmplY3QucHJvdG90eXBlLCJfX3Byb3RvX18iKS5zZXQpKShuLFtdKSxlPW4gaW5zdGFuY2VvZiBBcnJheTt9Y2F0Y2godCl7fX0oKTt2YXIgc2Q9UWYuUFJPUEVSLGZkPWFkLkJVR0dZX1NBRkFSSV9JVEVSQVRPUlMsZGQ9SmMoIml0ZXJhdG9yIikscGQ9ImtleXMiLGhkPSJ2YWx1ZXMiLHZkPSJlbnRyaWVzIixnZD1mdW5jdGlvbigpe3JldHVybiB0aGlzfSxtZD1mdW5jdGlvbih0LGUsbixyLG8saSx1KXshZnVuY3Rpb24odCxlLG4scil7dmFyIG89ZSsiIEl0ZXJhdG9yIjt0LnByb3RvdHlwZT1EcyhjZCx7bmV4dDppYygrIXIsbil9KSxKcyh0LG8sITEsITApLFhmW29dPWxkO30obixlLHIpO3ZhciBhLGMsbCxzPWZ1bmN0aW9uKHQpe2lmKHQ9PT1vJiZ2KXJldHVybiB2O2lmKCFmZCYmdCBpbiBwKXJldHVybiBwW3RdO3N3aXRjaCh0KXtjYXNlIHBkOmNhc2UgaGQ6Y2FzZSB2ZDpyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gbmV3IG4odGhpcyx0KX19cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBuKHRoaXMpfX0sZj1lKyIgSXRlcmF0b3IiLGQ9ITEscD10LnByb3RvdHlwZSxoPXBbZGRdfHxwWyJAQGl0ZXJhdG9yIl18fG8mJnBbb10sdj0hZmQmJmh8fHMobyksZz0iQXJyYXkiPT1lJiZwLmVudHJpZXN8fGg7aWYoZyYmKGE9cmQoZy5jYWxsKG5ldyB0KSkpIT09T2JqZWN0LnByb3RvdHlwZSYmYS5uZXh0JiYoSnMoYSxmLCEwLCEwKSxYZltmXT1nZCksc2QmJm89PWhkJiZoJiZoLm5hbWUhPT1oZCYmKGQ9ITAsdj1mdW5jdGlvbigpe3JldHVybiB0YyhoLHRoaXMpfSksbylpZihjPXt2YWx1ZXM6cyhoZCksa2V5czppP3Y6cyhwZCksZW50cmllczpzKHZkKX0sdSlmb3IobCBpbiBjKShmZHx8ZHx8IShsIGluIHApKSYmcXMocCxsLGNbbF0pO2Vsc2UgVGwoe3RhcmdldDplLHByb3RvOiEwLGZvcmNlZDpmZHx8ZH0sYyk7cmV0dXJuIHUmJnBbZGRdIT09diYmcXMocCxkZCx2LHtuYW1lOm99KSxYZltlXT12LGN9LHlkPSJBcnJheSBJdGVyYXRvciIsYmQ9Y2Yuc2V0LHhkPWNmLmdldHRlckZvcih5ZCk7bWQoQXJyYXksIkFycmF5IiwoZnVuY3Rpb24odCxlKXtiZCh0aGlzLHt0eXBlOnlkLHRhcmdldDpoYyh0KSxpbmRleDowLGtpbmQ6ZX0pO30pLChmdW5jdGlvbigpe3ZhciB0PXhkKHRoaXMpLGU9dC50YXJnZXQsbj10LmtpbmQscj10LmluZGV4Kys7cmV0dXJuICFlfHxyPj1lLmxlbmd0aD8odC50YXJnZXQ9dm9pZCAwLHt2YWx1ZTp2b2lkIDAsZG9uZTohMH0pOiJrZXlzIj09bj97dmFsdWU6cixkb25lOiExfToidmFsdWVzIj09bj97dmFsdWU6ZVtyXSxkb25lOiExfTp7dmFsdWU6W3IsZVtyXV0sZG9uZTohMX19KSwidmFsdWVzIiksWGYuQXJndW1lbnRzPVhmLkFycmF5O3ZhciB3ZD1KYygidG9TdHJpbmdUYWciKTtmb3IodmFyIEVkIGluIHtDU1NSdWxlTGlzdDowLENTU1N0eWxlRGVjbGFyYXRpb246MCxDU1NWYWx1ZUxpc3Q6MCxDbGllbnRSZWN0TGlzdDowLERPTVJlY3RMaXN0OjAsRE9NU3RyaW5nTGlzdDowLERPTVRva2VuTGlzdDoxLERhdGFUcmFuc2Zlckl0ZW1MaXN0OjAsRmlsZUxpc3Q6MCxIVE1MQWxsQ29sbGVjdGlvbjowLEhUTUxDb2xsZWN0aW9uOjAsSFRNTEZvcm1FbGVtZW50OjAsSFRNTFNlbGVjdEVsZW1lbnQ6MCxNZWRpYUxpc3Q6MCxNaW1lVHlwZUFycmF5OjAsTmFtZWROb2RlTWFwOjAsTm9kZUxpc3Q6MSxQYWludFJlcXVlc3RMaXN0OjAsUGx1Z2luOjAsUGx1Z2luQXJyYXk6MCxTVkdMZW5ndGhMaXN0OjAsU1ZHTnVtYmVyTGlzdDowLFNWR1BhdGhTZWdMaXN0OjAsU1ZHUG9pbnRMaXN0OjAsU1ZHU3RyaW5nTGlzdDowLFNWR1RyYW5zZm9ybUxpc3Q6MCxTb3VyY2VCdWZmZXJMaXN0OjAsU3R5bGVTaGVldExpc3Q6MCxUZXh0VHJhY2tDdWVMaXN0OjAsVGV4dFRyYWNrTGlzdDowLFRvdWNoTGlzdDowfSl7dmFyIFNkPUJhW0VkXSxrZD1TZCYmU2QucHJvdG90eXBlO2tkJiZWbChrZCkhPT13ZCYmRWwoa2Qsd2QsRWQpLFhmW0VkXT1YZi5BcnJheTt9dmFyIFRkPVVmO0dzKCJhc3luY0Rpc3Bvc2UiKSxHcygiZGlzcG9zZSIpLEdzKCJtYXRjaGVyIiksR3MoIm1ldGFkYXRhIiksR3MoIm9ic2VydmFibGUiKSxHcygicGF0dGVybk1hdGNoIiksR3MoInJlcGxhY2VBbGwiKTt2YXIgTWQ9VGQsSWQ9WWEoIiIuY2hhckF0KSxOZD1ZYSgiIi5jaGFyQ29kZUF0KSxIZD1ZYSgiIi5zbGljZSksT2Q9ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGUsbil7dmFyIHIsbyxpPWNzKHBjKGUpKSx1PUhsKG4pLGE9aS5sZW5ndGg7cmV0dXJuIHU8MHx8dT49YT90PyIiOnZvaWQgMDoocj1OZChpLHUpKTw1NTI5Nnx8cj41NjMxOXx8dSsxPT09YXx8KG89TmQoaSx1KzEpKTw1NjMyMHx8bz41NzM0Mz90P0lkKGksdSk6cjp0P0hkKGksdSx1KzIpOm8tNTYzMjArKHItNTUyOTY8PDEwKSs2NTUzNn19LGpkPXtjb2RlQXQ6T2QoITEpLGNoYXJBdDpPZCghMCl9LmNoYXJBdCxEZD0iU3RyaW5nIEl0ZXJhdG9yIixMZD1jZi5zZXQsemQ9Y2YuZ2V0dGVyRm9yKERkKTttZChTdHJpbmcsIlN0cmluZyIsKGZ1bmN0aW9uKHQpe0xkKHRoaXMse3R5cGU6RGQsc3RyaW5nOmNzKHQpLGluZGV4OjB9KTt9KSwoZnVuY3Rpb24oKXt2YXIgdCxlPXpkKHRoaXMpLG49ZS5zdHJpbmcscj1lLmluZGV4O3JldHVybiByPj1uLmxlbmd0aD97dmFsdWU6dm9pZCAwLGRvbmU6ITB9Oih0PWpkKG4sciksZS5pbmRleCs9dC5sZW5ndGgse3ZhbHVlOnQsZG9uZTohMX0pfSkpO3ZhciBBZD0kcy5mKCJpdGVyYXRvciIpLFBkPWgoKGZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUobil7cmV0dXJuICJmdW5jdGlvbiI9PXR5cGVvZiBNZCYmInN5bWJvbCI9PXR5cGVvZiBBZD8odC5leHBvcnRzPWU9ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0fSx0LmV4cG9ydHMuZGVmYXVsdD10LmV4cG9ydHMsdC5leHBvcnRzLl9fZXNNb2R1bGU9ITApOih0LmV4cG9ydHM9ZT1mdW5jdGlvbih0KXtyZXR1cm4gdCYmImZ1bmN0aW9uIj09dHlwZW9mIE1kJiZ0LmNvbnN0cnVjdG9yPT09TWQmJnQhPT1NZC5wcm90b3R5cGU/InN5bWJvbCI6dHlwZW9mIHR9LHQuZXhwb3J0cy5kZWZhdWx0PXQuZXhwb3J0cyx0LmV4cG9ydHMuX19lc01vZHVsZT0hMCksZShuKX10LmV4cG9ydHM9ZSx0LmV4cG9ydHMuZGVmYXVsdD10LmV4cG9ydHMsdC5leHBvcnRzLl9fZXNNb2R1bGU9ITA7fSkpLENkPXAoUGQpLFZkPWRlLkVYSVNUUyxCZD1fdC5mLFJkPUZ1bmN0aW9uLnByb3RvdHlwZSxGZD1EKFJkLnRvU3RyaW5nKSxfZD0vZnVuY3Rpb25cYig/OlxzfFwvXCpbXFNcc10qP1wqXC98XC9cL1teXG5ccl0qW1xuXHJdKykqKFteXHMoL10qKS8scWQ9RChfZC5leGVjKTt4JiYhVmQmJkJkKFJkLCJuYW1lIix7Y29uZmlndXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3RyeXtyZXR1cm4gcWQoX2QsRmQodGhpcykpWzFdfWNhdGNoKHQpe3JldHVybiAiIn19fSk7dmFyICRkPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe3RoaXMudGFnPSJzZWxlY3QiLHRoaXMud2lkdGg9ODA7fXJldHVybiB0LnByb3RvdHlwZS5pc0FjdGl2ZT1mdW5jdGlvbih0KXtyZXR1cm4gITF9LHQucHJvdG90eXBlLmdldFZhbHVlPWZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMubWFyayxuPXIuRWRpdG9yLm1hcmtzKHQpO3JldHVybiBuJiZuW2VdP25bZV06IiJ9LHQucHJvdG90eXBlLmlzRGlzYWJsZWQ9ZnVuY3Rpb24odCl7cmV0dXJuIG51bGw9PXQuc2VsZWN0aW9ufHwodGhpcy5tYXJrLCEheG8oci5FZGl0b3Iubm9kZXModCx7bWF0Y2g6ZnVuY3Rpb24obil7cmV0dXJuICJwcmUiPT09ZS5Eb21FZGl0b3IuZ2V0Tm9kZVR5cGUobil8fCEhci5FZGl0b3IuaXNWb2lkKHQsbil9LHVuaXZlcnNhbDohMH0pLDEpWzBdKX0sdC5wcm90b3R5cGUuZXhlYz1mdW5jdGlvbih0LGUpe3ZhciBuPXRoaXMubWFyaztlP3QuYWRkTWFyayhuLGUpOnQucmVtb3ZlTWFyayhuKTt9LHR9KCksV2Q9ZnVuY3Rpb24odCl7ZnVuY3Rpb24gbigpe3ZhciBuPW51bGwhPT10JiZ0LmFwcGx5KHRoaXMsYXJndW1lbnRzKXx8dGhpcztyZXR1cm4gbi50aXRsZT1lLnQoImZvbnRTaXplLnRpdGxlIiksbi5pY29uU3ZnPUpvLG4ubWFyaz0iZm9udFNpemUiLG59cmV0dXJuIHZvKG4sdCksbi5wcm90b3R5cGUuZ2V0T3B0aW9ucz1mdW5jdGlvbih0KXt2YXIgbj1bXSxyPXQuZ2V0TWVudUNvbmZpZyh0aGlzLm1hcmspLmZvbnRTaXplTGlzdCxvPXZvaWQgMD09PXI/W106cjtuLnB1c2goe3RleHQ6ZS50KCJmb250U2l6ZS5kZWZhdWx0IiksdmFsdWU6IiJ9KSxvLmZvckVhY2goKGZ1bmN0aW9uKHQpe2lmKCJzdHJpbmciPT10eXBlb2YgdCluLnB1c2goe3RleHQ6dCx2YWx1ZTp0fSk7ZWxzZSBpZigib2JqZWN0Ij09PUNkKHQpKXt2YXIgZT10Lm5hbWUscj10LnZhbHVlO24ucHVzaCh7dGV4dDplLHZhbHVlOnJ9KTt9fSkpO3ZhciBpPXRoaXMuZ2V0VmFsdWUodCk7cmV0dXJuIG4uZm9yRWFjaCgoZnVuY3Rpb24odCl7dC52YWx1ZT09PWk/dC5zZWxlY3RlZD0hMDpkZWxldGUgdC5zZWxlY3RlZDt9KSksbn0sbn0oJGQpLEdkPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIG4oKXt2YXIgbj1udWxsIT09dCYmdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl8fHRoaXM7cmV0dXJuIG4udGl0bGU9ZS50KCJmb250RmFtaWx5LnRpdGxlIiksbi5pY29uU3ZnPUtvLG4ubWFyaz0iZm9udEZhbWlseSIsbi5zZWxlY3RQYW5lbFdpZHRoPTE1MCxufXJldHVybiB2byhuLHQpLG4ucHJvdG90eXBlLmdldE9wdGlvbnM9ZnVuY3Rpb24odCl7dmFyIG49W10scj10LmdldE1lbnVDb25maWcodGhpcy5tYXJrKS5mb250RmFtaWx5TGlzdCxvPXZvaWQgMD09PXI/W106cjtuLnB1c2goe3RleHQ6ZS50KCJmb250RmFtaWx5LmRlZmF1bHQiKSx2YWx1ZToiIn0pLG8uZm9yRWFjaCgoZnVuY3Rpb24odCl7aWYoInN0cmluZyI9PXR5cGVvZiB0KW4ucHVzaCh7dGV4dDp0LHZhbHVlOnQsc3R5bGVGb3JSZW5kZXJNZW51TGlzdDp7ImZvbnQtZmFtaWx5Ijp0fX0pO2Vsc2UgaWYoIm9iamVjdCI9PT1DZCh0KSl7dmFyIGU9dC5uYW1lLHI9dC52YWx1ZTtuLnB1c2goe3RleHQ6ZSx2YWx1ZTpyLHN0eWxlRm9yUmVuZGVyTWVudUxpc3Q6eyJmb250LWZhbWlseSI6cn19KTt9fSkpO3ZhciBpPXRoaXMuZ2V0VmFsdWUodCk7cmV0dXJuIG4uZm9yRWFjaCgoZnVuY3Rpb24odCl7dC52YWx1ZT09PWk/dC5zZWxlY3RlZD0hMDpkZWxldGUgdC5zZWxlY3RlZDt9KSksbn0sbn0oJGQpO3ZhciBVZD17cmVuZGVyU3R5bGU6ZnVuY3Rpb24odCxlKXt2YXIgbj10LHI9bi5mb250U2l6ZSxvPW4uZm9udEZhbWlseSxpPWU7cmV0dXJuIHImJmF1KGkse2ZvbnRTaXplOnJ9KSxvJiZhdShpLHtmb250RmFtaWx5Om99KSxpfSxzdHlsZVRvSHRtbDpmdW5jdGlvbih0LGUpe2lmKCFyLlRleHQuaXNUZXh0KHQpKXJldHVybiBlO3ZhciBuLG89dCxpPW8uZm9udFNpemUsdT1vLmZvbnRGYW1pbHk7cmV0dXJuIGl8fHU/KChsbyhlKXx8InNwYW4iIT09Zm8obj1jLmRlZmF1bHQoZSkpKSYmKG49Yy5kZWZhdWx0KCI8c3Bhbj4iK2UrIjwvc3Bhbj4iKSksaSYmbi5jc3MoImZvbnQtc2l6ZSIsaSksdSYmbi5jc3MoImZvbnQtZmFtaWx5Iix1KSxzbyhuKSk6ZX0scHJlUGFyc2VIdG1sOlt6YV0scGFyc2VTdHlsZUh0bWw6ZnVuY3Rpb24odCxlLG4pe3ZhciBvPWMuZGVmYXVsdCh0KTtpZighci5UZXh0LmlzVGV4dChlKSlyZXR1cm4gZTt2YXIgaT1lLHU9bi5nZXRNZW51Q29uZmlnKCJmb250U2l6ZSIpLmZvbnRTaXplTGlzdCxhPXZvaWQgMD09PXU/W106dSxsPXBvKG8sImZvbnQtc2l6ZSIpLHM9YS5maW5kKChmdW5jdGlvbih0KXtyZXR1cm4gdC52YWx1ZSYmdC52YWx1ZT09PWx9KSl8fGEuaW5jbHVkZXMobCk7bCYmcyYmKGkuZm9udFNpemU9bCk7dmFyIGY9bi5nZXRNZW51Q29uZmlnKCJmb250RmFtaWx5IikuZm9udEZhbWlseUxpc3QsZD12b2lkIDA9PT1mP1tdOmYscD1wbyhvLCJmb250LWZhbWlseSIpLnJlcGxhY2UoLyIvZywiIiksaD1kLmZpbmQoKGZ1bmN0aW9uKHQpe3JldHVybiB0LnZhbHVlJiZ0LnZhbHVlPT09cH0pKXx8ZC5pbmNsdWRlcyhwKTtyZXR1cm4gcCYmaCYmKGkuZm9udEZhbWlseT1wKSxpfSxtZW51czpbe2tleToiZm9udFNpemUiLGZhY3Rvcnk6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IFdkfSxjb25maWc6e2ZvbnRTaXplTGlzdDpbIjEycHgiLHtuYW1lOiIxM3B4Iix2YWx1ZToiMTNweCJ9LCIxNHB4IiwiMTVweCIsIjE2cHgiLCIxOXB4Iix7bmFtZToiMjJweCIsdmFsdWU6IjIycHgifSwiMjRweCIsIjI5cHgiLCIzMnB4IiwiNDBweCIsIjQ4cHgiXX19LHtrZXk6ImZvbnRGYW1pbHkiLGZhY3Rvcnk6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IEdkfSxjb25maWc6e2ZvbnRGYW1pbHlMaXN0Olsi6buR5L2TIix7bmFtZToi5Lu/5a6LIix2YWx1ZToi5Lu/5a6LIn0sIualt+S9kyIsIuagh+alt+S9kyIsIuWNjuaWh+S7v+WuiyIsIuWNjuaWh+alt+S9kyIse25hbWU6IuWui+S9kyIsdmFsdWU6IuWui+S9kyJ9LCLlvq7ova/pm4Xpu5EiLCJBcmlhbCIsIlRhaG9tYSIsIlZlcmRhbmEiLCJUaW1lcyBOZXcgUm9tYW4iLCJDb3VyaWVyIE5ldyJdfX1dfTt2YXIgWGQ9e3NlbGVjdG9yOiJwLGgxLGgyLGgzLGg0LGg1IixwcmVQYXJzZUh0bWw6ZnVuY3Rpb24odCl7dmFyIGU9Yy5kZWZhdWx0KHQpLG49cG8oZSwicGFkZGluZy1sZWZ0Iik7cmV0dXJuIC9cZGVtLy50ZXN0KG4pJiZlLmNzcygidGV4dC1pbmRlbnQiLCIyZW0iKSwvXGRweC8udGVzdChuKSYmcGFyc2VJbnQobiwxMCklMzI9PTAmJmUuY3NzKCJ0ZXh0LWluZGVudCIsIjJlbSIpLGVbMF19fTt2YXIgWWQ9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KCl7dGhpcy50YWc9ImJ1dHRvbiI7fXJldHVybiB0LnByb3RvdHlwZS5nZXRWYWx1ZT1mdW5jdGlvbih0KXt2YXIgZT14byhyLkVkaXRvci5ub2Rlcyh0LHttYXRjaDpmdW5jdGlvbih0KXtyZXR1cm4gISF0LmluZGVudH0sdW5pdmVyc2FsOiEwfSksMSksbj1lWzBdO3JldHVybiBudWxsPT1uPyIiOnhvKG4sMSlbMF0uaW5kZW50fHwiIn0sdC5wcm90b3R5cGUuaXNBY3RpdmU9ZnVuY3Rpb24odCl7cmV0dXJuICExfSx0LnByb3RvdHlwZS5nZXRNYXRjaE5vZGU9ZnVuY3Rpb24odCl7dmFyIG49eG8oci5FZGl0b3Iubm9kZXModCx7bWF0Y2g6ZnVuY3Rpb24odCl7dmFyIG49ZS5Eb21FZGl0b3IuZ2V0Tm9kZVR5cGUodCk7cmV0dXJuICJwYXJhZ3JhcGgiPT09bnx8ISFuLnN0YXJ0c1dpdGgoImhlYWRlciIpfSx1bml2ZXJzYWw6ITAsbW9kZToiaGlnaGVzdCJ9KSwxKVswXTtyZXR1cm4gbnVsbD09bj9udWxsOm5bMF19LHR9KCksSmQ9ZnVuY3Rpb24odCl7ZnVuY3Rpb24gbigpe3ZhciBuPW51bGwhPT10JiZ0LmFwcGx5KHRoaXMsYXJndW1lbnRzKXx8dGhpcztyZXR1cm4gbi50aXRsZT1lLnQoImluZGVudC5kZWNyZWFzZSIpLG4uaWNvblN2Zz1RbyxufXJldHVybiB2byhuLHQpLG4ucHJvdG90eXBlLmlzRGlzYWJsZWQ9ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5nZXRNYXRjaE5vZGUodCk7cmV0dXJuIG51bGw9PWV8fCFlLmluZGVudH0sbi5wcm90b3R5cGUuZXhlYz1mdW5jdGlvbih0LGUpe3IuVHJhbnNmb3Jtcy5zZXROb2Rlcyh0LHtpbmRlbnQ6bnVsbH0se21hdGNoOmZ1bmN0aW9uKHQpe3JldHVybiByLkVsZW1lbnQuaXNFbGVtZW50KHQpfX0pO30sbn0oWWQpLEtkPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIG4oKXt2YXIgbj1udWxsIT09dCYmdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl8fHRoaXM7cmV0dXJuIG4udGl0bGU9ZS50KCJpbmRlbnQuaW5jcmVhc2UiKSxuLmljb25Tdmc9Wm8sbn1yZXR1cm4gdm8obix0KSxuLnByb3RvdHlwZS5pc0Rpc2FibGVkPWZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuZ2V0TWF0Y2hOb2RlKHQpO3JldHVybiBudWxsPT1lfHwhIWUuaW5kZW50fSxuLnByb3RvdHlwZS5leGVjPWZ1bmN0aW9uKHQsZSl7ci5UcmFuc2Zvcm1zLnNldE5vZGVzKHQse2luZGVudDoiMmVtIn0se21hdGNoOmZ1bmN0aW9uKHQpe3JldHVybiByLkVsZW1lbnQuaXNFbGVtZW50KHQpfSxtb2RlOiJoaWdoZXN0In0pO30sbn0oWWQpLFFkPXtyZW5kZXJTdHlsZTpmdW5jdGlvbih0LGUpe2lmKCFyLkVsZW1lbnQuaXNFbGVtZW50KHQpKXJldHVybiBlO3ZhciBuPXQuaW5kZW50LG89ZTtyZXR1cm4gbiYmYXUobyx7dGV4dEluZGVudDpufSksb30sc3R5bGVUb0h0bWw6ZnVuY3Rpb24odCxlKXtpZighci5FbGVtZW50LmlzRWxlbWVudCh0KSlyZXR1cm4gZTt2YXIgbj10LmluZGVudDtpZighbilyZXR1cm4gZTt2YXIgbz1jLmRlZmF1bHQoZSk7cmV0dXJuIG8uY3NzKCJ0ZXh0LWluZGVudCIsbiksc28obyl9LHByZVBhcnNlSHRtbDpbWGRdLHBhcnNlU3R5bGVIdG1sOmZ1bmN0aW9uKHQsZSxuKXt2YXIgbz1jLmRlZmF1bHQodCk7aWYoIXIuRWxlbWVudC5pc0VsZW1lbnQoZSkpcmV0dXJuIGU7dmFyIGk9ZSx1PXBvKG8sInRleHQtaW5kZW50IiksYT1wYXJzZUludCh1LDEwKTtyZXR1cm4gdSYmYT4wJiYoaS5pbmRlbnQ9dSksaX0sbWVudXM6W3trZXk6ImluZGVudCIsZmFjdG9yeTpmdW5jdGlvbigpe3JldHVybiBuZXcgS2R9fSx7a2V5OiJkZWxJbmRlbnQiLGZhY3Rvcnk6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IEpkfX1dfTt2YXIgWmQ9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KCl7dGhpcy50YWc9ImJ1dHRvbiI7fXJldHVybiB0LnByb3RvdHlwZS5nZXRWYWx1ZT1mdW5jdGlvbih0KXtyZXR1cm4gIiJ9LHQucHJvdG90eXBlLmlzQWN0aXZlPWZ1bmN0aW9uKHQpe3JldHVybiAhMX0sdC5wcm90b3R5cGUuZ2V0TWF0Y2hOb2RlPWZ1bmN0aW9uKHQpe3ZhciBuPXhvKHIuRWRpdG9yLm5vZGVzKHQse21hdGNoOmZ1bmN0aW9uKHQpe3ZhciBuPWUuRG9tRWRpdG9yLmdldE5vZGVUeXBlKHQpO3JldHVybiAicGFyYWdyYXBoIj09PW58fCgiYmxvY2txdW90ZSI9PT1ufHwhIW4uc3RhcnRzV2l0aCgiaGVhZGVyIikpfSx1bml2ZXJzYWw6ITAsbW9kZToiaGlnaGVzdCJ9KSwxKVswXTtyZXR1cm4gbnVsbD09bj9udWxsOm5bMF19LHQucHJvdG90eXBlLmlzRGlzYWJsZWQ9ZnVuY3Rpb24odCl7cmV0dXJuIG51bGw9PXQuc2VsZWN0aW9ufHwhIWUuRG9tRWRpdG9yLmdldFNlbGVjdGVkRWxlbXModCkuc29tZSgoZnVuY3Rpb24oZSl7aWYoci5FZGl0b3IuaXNWb2lkKHQsZSkmJnIuRWRpdG9yLmlzQmxvY2sodCxlKSlyZXR1cm4gITA7dmFyIG49ZS50eXBlO3JldHVybiAhIVsicHJlIiwiY29kZSJdLmluY2x1ZGVzKG4pfHx2b2lkIDB9KSl9LHR9KCksdHA9ZnVuY3Rpb24odCl7ZnVuY3Rpb24gbigpe3ZhciBuPW51bGwhPT10JiZ0LmFwcGx5KHRoaXMsYXJndW1lbnRzKXx8dGhpcztyZXR1cm4gbi50aXRsZT1lLnQoImp1c3RpZnkubGVmdCIpLG4uaWNvblN2Zz10aSxufXJldHVybiB2byhuLHQpLG4ucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24odCxlKXtyLlRyYW5zZm9ybXMuc2V0Tm9kZXModCx7dGV4dEFsaWduOiJsZWZ0In0se21hdGNoOmZ1bmN0aW9uKGUpe3JldHVybiByLkVsZW1lbnQuaXNFbGVtZW50KGUpJiYhdC5pc0lubGluZShlKX19KTt9LG59KFpkKSxlcD1mdW5jdGlvbih0KXtmdW5jdGlvbiBuKCl7dmFyIG49bnVsbCE9PXQmJnQuYXBwbHkodGhpcyxhcmd1bWVudHMpfHx0aGlzO3JldHVybiBuLnRpdGxlPWUudCgianVzdGlmeS5yaWdodCIpLG4uaWNvblN2Zz1laSxufXJldHVybiB2byhuLHQpLG4ucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24odCxlKXtyLlRyYW5zZm9ybXMuc2V0Tm9kZXModCx7dGV4dEFsaWduOiJyaWdodCJ9LHttYXRjaDpmdW5jdGlvbihlKXtyZXR1cm4gci5FbGVtZW50LmlzRWxlbWVudChlKSYmIXQuaXNJbmxpbmUoZSl9fSk7fSxufShaZCksbnA9ZnVuY3Rpb24odCl7ZnVuY3Rpb24gbigpe3ZhciBuPW51bGwhPT10JiZ0LmFwcGx5KHRoaXMsYXJndW1lbnRzKXx8dGhpcztyZXR1cm4gbi50aXRsZT1lLnQoImp1c3RpZnkuY2VudGVyIiksbi5pY29uU3ZnPW5pLG59cmV0dXJuIHZvKG4sdCksbi5wcm90b3R5cGUuZXhlYz1mdW5jdGlvbih0LGUpe3IuVHJhbnNmb3Jtcy5zZXROb2Rlcyh0LHt0ZXh0QWxpZ246ImNlbnRlciJ9LHttYXRjaDpmdW5jdGlvbihlKXtyZXR1cm4gci5FbGVtZW50LmlzRWxlbWVudChlKSYmIXQuaXNJbmxpbmUoZSl9fSk7fSxufShaZCkscnA9ZnVuY3Rpb24odCl7ZnVuY3Rpb24gbigpe3ZhciBuPW51bGwhPT10JiZ0LmFwcGx5KHRoaXMsYXJndW1lbnRzKXx8dGhpcztyZXR1cm4gbi50aXRsZT1lLnQoImp1c3RpZnkuanVzdGlmeSIpLG4uaWNvblN2Zz1yaSxufXJldHVybiB2byhuLHQpLG4ucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24odCxlKXtyLlRyYW5zZm9ybXMuc2V0Tm9kZXModCx7dGV4dEFsaWduOiJqdXN0aWZ5In0se21hdGNoOmZ1bmN0aW9uKGUpe3JldHVybiByLkVsZW1lbnQuaXNFbGVtZW50KGUpJiYhdC5pc0lubGluZShlKX19KTt9LG59KFpkKSxvcD17cmVuZGVyU3R5bGU6ZnVuY3Rpb24odCxlKXtpZighci5FbGVtZW50LmlzRWxlbWVudCh0KSlyZXR1cm4gZTt2YXIgbj10LnRleHRBbGlnbixvPWU7cmV0dXJuIG4mJmF1KG8se3RleHRBbGlnbjpufSksb30sc3R5bGVUb0h0bWw6ZnVuY3Rpb24odCxlKXtpZighci5FbGVtZW50LmlzRWxlbWVudCh0KSlyZXR1cm4gZTt2YXIgbj10LnRleHRBbGlnbjtpZighbilyZXR1cm4gZTt2YXIgbz1jLmRlZmF1bHQoZSk7cmV0dXJuIG8uY3NzKCJ0ZXh0LWFsaWduIixuKSxzbyhvKX0scGFyc2VTdHlsZUh0bWw6ZnVuY3Rpb24odCxlLG4pe3ZhciBvPWMuZGVmYXVsdCh0KTtpZighci5FbGVtZW50LmlzRWxlbWVudChlKSlyZXR1cm4gZTt2YXIgaT1lLHU9cG8obywidGV4dC1hbGlnbiIpO3JldHVybiB1JiYoaS50ZXh0QWxpZ249dSksaX0sbWVudXM6W3trZXk6Imp1c3RpZnlMZWZ0IixmYWN0b3J5OmZ1bmN0aW9uKCl7cmV0dXJuIG5ldyB0cH19LHtrZXk6Imp1c3RpZnlSaWdodCIsZmFjdG9yeTpmdW5jdGlvbigpe3JldHVybiBuZXcgZXB9fSx7a2V5OiJqdXN0aWZ5Q2VudGVyIixmYWN0b3J5OmZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBucH19LHtrZXk6Imp1c3RpZnlKdXN0aWZ5IixmYWN0b3J5OmZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBycH19XX07dmFyIGlwPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe3RoaXMudGl0bGU9ZS50KCJsaW5lSGVpZ2h0LnRpdGxlIiksdGhpcy5pY29uU3ZnPSc8c3ZnIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik05NjQgNzg4YTggOCAwIDAgMSA4IDh2OThhOCA4IDAgMCAxLTggOEg0MzhhOCA4IDAgMCAxLTgtOHYtOThhOCA4IDAgMCAxIDgtOGg1MjZ6TTE5OC45MyAxNDQuMzA2YzYuNjY4LTUuNzk4IDE2Ljc3NC01LjA5NCAyMi41NzMgMS41NzRsMTIyLjI2IDE0MC41ODJhMTYgMTYgMCAwIDEgMy45MjcgMTAuNWMwIDguODM2LTcuMTY0IDE2LTE2IDE2aC02MS44YTggOCAwIDAgMC04IDh2MzkwLjA3N2g2OS44MTlhMTYgMTYgMCAwIDEgMTAuNTAyIDMuOTI4YzYuNjY2IDUuOCA3LjM3IDE1LjkwNiAxLjU3IDIyLjU3M0wyMjEuNDc2IDg3OC4xMjNhMTYgMTYgMCAwIDEtMS41NyAxLjU3Yy02LjY2OCA1LjgtMTYuNzc0IDUuMDk3LTIyLjU3NC0xLjU3TDc1LjA1MSA3MzcuNTM4YTE2IDE2IDAgMCAxLTMuOTI4LTEwLjVjMC04LjgzNyA3LjE2My0xNiAxNi0xNmg2OS44MjJWMzEyLjk2SDg3LjEyN2ExNiAxNiAwIDAgMS0xMC41MDItMy45MjhjLTYuNjY2LTUuOC03LjM3LTE1LjkwNi0xLjU3LTIyLjU3M2wxMjIuMzAzLTE0MC41ODJhMTYgMTYgMCAwIDEgMS41NzItMS41NzJ6TTk2NCA0NjVhOCA4IDAgMCAxIDggOHY5OGE4IDggMCAwIDEtOCA4SDQzOGE4IDggMCAwIDEtOC04di05OGE4IDggMCAwIDEgOC04aDUyNnogbTAtMzIzYTggOCAwIDAgMSA4IDh2OThhOCA4IDAgMCAxLTggOEg0MzhhOCA4IDAgMCAxLTgtOHYtOThhOCA4IDAgMCAxIDgtOGg1MjZ6Ij48L3BhdGg+PC9zdmc+Jyx0aGlzLnRhZz0ic2VsZWN0Iix0aGlzLndpZHRoPTgwO31yZXR1cm4gdC5wcm90b3R5cGUuZ2V0T3B0aW9ucz1mdW5jdGlvbih0KXt2YXIgbj1bXSxyPXQuZ2V0TWVudUNvbmZpZygibGluZUhlaWdodCIpLmxpbmVIZWlnaHRMaXN0LG89dm9pZCAwPT09cj9bXTpyO24ucHVzaCh7dGV4dDplLnQoImxpbmVIZWlnaHQuZGVmYXVsdCIpLHZhbHVlOiIifSksby5mb3JFYWNoKChmdW5jdGlvbih0KXtuLnB1c2goe3RleHQ6dCx2YWx1ZTp0fSk7fSkpO3ZhciBpPXRoaXMuZ2V0VmFsdWUodCk7cmV0dXJuIG4uZm9yRWFjaCgoZnVuY3Rpb24odCl7dC52YWx1ZT09PWk/dC5zZWxlY3RlZD0hMDpkZWxldGUgdC5zZWxlY3RlZDt9KSksbn0sdC5wcm90b3R5cGUuZ2V0TWF0Y2hOb2RlPWZ1bmN0aW9uKHQpe3ZhciBuPXhvKHIuRWRpdG9yLm5vZGVzKHQse21hdGNoOmZ1bmN0aW9uKHQpe3ZhciBuPWUuRG9tRWRpdG9yLmdldE5vZGVUeXBlKHQpO3JldHVybiAhIW4uc3RhcnRzV2l0aCgiaGVhZGVyIil8fCEhWyJwYXJhZ3JhcGgiLCJibG9ja3F1b3RlIiwibGlzdC1pdGVtIl0uaW5jbHVkZXMobil9LHVuaXZlcnNhbDohMCxtb2RlOiJoaWdoZXN0In0pLDEpWzBdO3JldHVybiBudWxsPT1uP251bGw6blswXX0sdC5wcm90b3R5cGUuaXNBY3RpdmU9ZnVuY3Rpb24odCl7cmV0dXJuICExfSx0LnByb3RvdHlwZS5nZXRWYWx1ZT1mdW5jdGlvbih0KXt2YXIgZT10aGlzLmdldE1hdGNoTm9kZSh0KTtyZXR1cm4gbnVsbD09ZT8iIjpyLkVsZW1lbnQuaXNFbGVtZW50KGUpJiZlLmxpbmVIZWlnaHR8fCIifSx0LnByb3RvdHlwZS5pc0Rpc2FibGVkPWZ1bmN0aW9uKHQpe3JldHVybiBudWxsPT10LnNlbGVjdGlvbnx8bnVsbD09dGhpcy5nZXRNYXRjaE5vZGUodCl9LHQucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24odCxlKXtyLlRyYW5zZm9ybXMuc2V0Tm9kZXModCx7bGluZUhlaWdodDplLnRvU3RyaW5nKCl9LHttb2RlOiJoaWdoZXN0In0pO30sdH0oKTt2YXIgdXA9e3JlbmRlclN0eWxlOmZ1bmN0aW9uKHQsZSl7aWYoIXIuRWxlbWVudC5pc0VsZW1lbnQodCkpcmV0dXJuIGU7dmFyIG49dC5saW5lSGVpZ2h0LG89ZTtyZXR1cm4gbiYmYXUobyx7bGluZUhlaWdodDpufSksb30sc3R5bGVUb0h0bWw6ZnVuY3Rpb24odCxlKXtpZighci5FbGVtZW50LmlzRWxlbWVudCh0KSlyZXR1cm4gZTt2YXIgbj10LmxpbmVIZWlnaHQ7aWYoIW4pcmV0dXJuIGU7dmFyIG89Yy5kZWZhdWx0KGUpO3JldHVybiBvLmNzcygibGluZS1oZWlnaHQiLG4pLHNvKG8pfSxwYXJzZVN0eWxlSHRtbDpmdW5jdGlvbih0LGUsbil7dmFyIG89Yy5kZWZhdWx0KHQpO2lmKCFyLkVsZW1lbnQuaXNFbGVtZW50KGUpKXJldHVybiBlO3ZhciBpPWUsdT1uLmdldE1lbnVDb25maWcoImxpbmVIZWlnaHQiKS5saW5lSGVpZ2h0TGlzdCxhPXZvaWQgMD09PXU/W106dSxsPXBvKG8sImxpbmUtaGVpZ2h0Iik7cmV0dXJuIGwmJmEuaW5jbHVkZXMobCkmJihpLmxpbmVIZWlnaHQ9bCksaX0sbWVudXM6W3trZXk6ImxpbmVIZWlnaHQiLGZhY3Rvcnk6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IGlwfSxjb25maWc6e2xpbmVIZWlnaHRMaXN0OlsiMSIsIjEuMTUiLCIxLjUiLCIyIiwiMi41IiwiMyJdfX1dfSxhcD1mdW5jdGlvbigpe2Z1bmN0aW9uIHQoKXt0aGlzLnRpdGxlPWUudCgidW5kby5yZWRvIiksdGhpcy5pY29uU3ZnPSc8c3ZnIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik0wLjAwMDMyIDU3NmE1MTAuNzIgNTEwLjcyIDAgMCAwIDE3My4zNDQgMzg0bDg0LjY3Mi05NkEzODMuMTM2IDM4My4xMzYgMCAwIDEgMTI4LjAwMDMyIDU3NkMxMjguMDAwMzIgMzYzLjkzNiAyOTkuOTM2MzIgMTkyIDUxMi4wMDAzMiAxOTJjMTA2LjA0OCAwIDIwMi4wNDggNDIuOTc2IDI3MS41MiAxMTIuNDhMNjQwLjAwMDMyIDQ0OGgzODRWNjRsLTE0OS45ODQgMTQ5Ljk4NEE1MTAuMjcyIDUxMC4yNzIgMCAwIDAgNTEyLjAwMDMyIDY0QzIyOS4yMTYzMiA2NCAwLjAwMDMyIDI5My4yMTYgMC4wMDAzMiA1NzZ6Ij48L3BhdGg+PC9zdmc+Jyx0aGlzLnRhZz0iYnV0dG9uIjt9cmV0dXJuIHQucHJvdG90eXBlLmdldFZhbHVlPWZ1bmN0aW9uKHQpe3JldHVybiAiIn0sdC5wcm90b3R5cGUuaXNBY3RpdmU9ZnVuY3Rpb24odCl7cmV0dXJuICExfSx0LnByb3RvdHlwZS5pc0Rpc2FibGVkPWZ1bmN0aW9uKHQpe3JldHVybiBudWxsPT10LnNlbGVjdGlvbn0sdC5wcm90b3R5cGUuZXhlYz1mdW5jdGlvbih0LGUpeyJmdW5jdGlvbiI9PXR5cGVvZiB0LnJlZG8mJnQucmVkbygpO30sdH0oKSxjcD1mdW5jdGlvbigpe2Z1bmN0aW9uIHQoKXt0aGlzLnRpdGxlPWUudCgidW5kby51bmRvIiksdGhpcy5pY29uU3ZnPSc8c3ZnIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik01MTIgNjRBNTEwLjI3MiA1MTAuMjcyIDAgMCAwIDE0OS45ODQgMjEzLjk4NEwwLjAzMiA2NHYzODRoMzg0TDI0MC41MTIgMzA0LjQ4QTM4Mi43ODQgMzgyLjc4NCAwIDAgMSA1MTIuMDMyIDE5MmMyMTIuMDY0IDAgMzg0IDE3MS45MzYgMzg0IDM4NCAwIDExNC42ODgtNTAuMzA0IDIxNy42MzItMTMwLjAxNiAyODhsODQuNjcyIDk2YTUxMC43MiA1MTAuNzIgMCAwIDAgMTczLjM0NC0zODRjMC0yODIuNzg0LTIyOS4yMTYtNTEyLTUxMi01MTJ6Ij48L3BhdGg+PC9zdmc+Jyx0aGlzLnRhZz0iYnV0dG9uIjt9cmV0dXJuIHQucHJvdG90eXBlLmdldFZhbHVlPWZ1bmN0aW9uKHQpe3JldHVybiAiIn0sdC5wcm90b3R5cGUuaXNBY3RpdmU9ZnVuY3Rpb24odCl7cmV0dXJuICExfSx0LnByb3RvdHlwZS5pc0Rpc2FibGVkPWZ1bmN0aW9uKHQpe3JldHVybiBudWxsPT10LnNlbGVjdGlvbn0sdC5wcm90b3R5cGUuZXhlYz1mdW5jdGlvbih0LGUpeyJmdW5jdGlvbiI9PXR5cGVvZiB0LnVuZG8mJnQudW5kbygpO30sdH0oKSxscD17bWVudXM6W3trZXk6InJlZG8iLGZhY3Rvcnk6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IGFwfX0se2tleToidW5kbyIsZmFjdG9yeTpmdW5jdGlvbigpe3JldHVybiBuZXcgY3B9fV19O3ZhciBzcD17dHlwZToiZGl2aWRlciIscmVuZGVyRWxlbTpmdW5jdGlvbih0LHIsbyl7dmFyIGk9ZS5Eb21FZGl0b3IuaXNOb2RlU2VsZWN0ZWQobyx0KTtyZXR1cm4gbi5oKCJkaXYiLHtwcm9wczp7Y29udGVudEVkaXRhYmxlOiExLGNsYXNzTmFtZToidy1lLXRleHRhcmVhLWRpdmlkZXIifSxkYXRhc2V0OntzZWxlY3RlZDppPyJ0cnVlIjoiIn0sc3R5bGU6e30sb246e21vdXNlZG93bjpmdW5jdGlvbih0KXtyZXR1cm4gdC5wcmV2ZW50RGVmYXVsdCgpfX19LFtuLmgoImhyIildKX19O3ZhciBmcD17dHlwZToiZGl2aWRlciIsZWxlbVRvSHRtbDpmdW5jdGlvbih0LGUpe3JldHVybiAiPGhyLz4ifX07dmFyIGRwPXtzZWxlY3RvcjoiaHI6bm90KFtkYXRhLXctZS10eXBlXSkiLHBhcnNlRWxlbUh0bWw6ZnVuY3Rpb24odCxlLG4pe3JldHVybiB7dHlwZToiZGl2aWRlciIsY2hpbGRyZW46W3t0ZXh0OiIifV19fX0scHA9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KCl7dGhpcy50aXRsZT1lLnQoImRpdmlkZXIudGl0bGUiKSx0aGlzLmljb25Tdmc9Jzxzdmcgdmlld0JveD0iMCAwIDEwOTIgMTAyNCI+PHBhdGggZD0iTTAgNTEuMm01MS4yIDBsOTg5Ljg2NjY2NyAwcTUxLjIgMCA1MS4yIDUxLjJsMCAwcTAgNTEuMi01MS4yIDUxLjJsLTk4OS44NjY2NjcgMHEtNTEuMiAwLTUxLjItNTEuMmwwIDBxMC01MS4yIDUxLjItNTEuMloiPjwvcGF0aD48cGF0aCBkPSJNMCA0NjAuOG01MS4yIDBsMTcwLjY2NjY2NyAwcTUxLjIgMCA1MS4yIDUxLjJsMCAwcTAgNTEuMi01MS4yIDUxLjJsLTE3MC42NjY2NjcgMHEtNTEuMiAwLTUxLjItNTEuMmwwIDBxMC01MS4yIDUxLjItNTEuMloiPjwvcGF0aD48cGF0aCBkPSJNODE5LjIgNDYwLjhtNTEuMiAwbDE3MC42NjY2NjcgMHE1MS4yIDAgNTEuMiA1MS4ybDAgMHEwIDUxLjItNTEuMiA1MS4ybC0xNzAuNjY2NjY3IDBxLTUxLjIgMC01MS4yLTUxLjJsMCAwcTAtNTEuMiA1MS4yLTUxLjJaIj48L3BhdGg+PHBhdGggZD0iTTQwOS42IDQ2MC44bTUxLjIgMGwxNzAuNjY2NjY3IDBxNTEuMiAwIDUxLjIgNTEuMmwwIDBxMCA1MS4yLTUxLjIgNTEuMmwtMTcwLjY2NjY2NyAwcS01MS4yIDAtNTEuMi01MS4ybDAgMHEwLTUxLjIgNTEuMi01MS4yWiI+PC9wYXRoPjxwYXRoIGQ9Ik0wIDg3MC40bTUxLjIgMGw5ODkuODY2NjY3IDBxNTEuMiAwIDUxLjIgNTEuMmwwIDBxMCA1MS4yLTUxLjIgNTEuMmwtOTg5Ljg2NjY2NyAwcS01MS4yIDAtNTEuMi01MS4ybDAgMHEwLTUxLjIgNTEuMi01MS4yWiI+PC9wYXRoPjwvc3ZnPicsdGhpcy50YWc9ImJ1dHRvbiI7fXJldHVybiB0LnByb3RvdHlwZS5nZXRWYWx1ZT1mdW5jdGlvbih0KXtyZXR1cm4gIiJ9LHQucHJvdG90eXBlLmlzQWN0aXZlPWZ1bmN0aW9uKHQpe3JldHVybiAhMX0sdC5wcm90b3R5cGUuaXNEaXNhYmxlZD1mdW5jdGlvbih0KXtyZXR1cm4gbnVsbD09dC5zZWxlY3Rpb258fCEhZS5Eb21FZGl0b3IuZ2V0U2VsZWN0ZWRFbGVtcyh0KS5zb21lKChmdW5jdGlvbihuKXtpZih0LmlzVm9pZChuKSlyZXR1cm4gITA7dmFyIHI9ZS5Eb21FZGl0b3IuZ2V0Tm9kZVR5cGUobik7cmV0dXJuICJ0YWJsZSI9PT1yfHwoInByZSI9PT1yfHx2b2lkIDApfSkpfSx0LnByb3RvdHlwZS5leGVjPWZ1bmN0aW9uKHQsZSl7ci5UcmFuc2Zvcm1zLmluc2VydE5vZGVzKHQse3R5cGU6ImRpdmlkZXIiLGNoaWxkcmVuOlt7dGV4dDoiIn1dfSx7bW9kZToiaGlnaGVzdCJ9KTt9LHR9KCksaHA9e3JlbmRlckVsZW1zOltzcF0sZWxlbXNUb0h0bWw6W2ZwXSxwYXJzZUVsZW1zSHRtbDpbZHBdLG1lbnVzOlt7a2V5OiJkaXZpZGVyIixmYWN0b3J5OmZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBwcH19XSxlZGl0b3JQbHVnaW46ZnVuY3Rpb24odCl7dmFyIG49dC5pc1ZvaWQsbz10Lm5vcm1hbGl6ZU5vZGUsaT10O3JldHVybiBpLmlzVm9pZD1mdW5jdGlvbih0KXtyZXR1cm4gImRpdmlkZXIiPT09dC50eXBlfHxuKHQpfSxpLm5vcm1hbGl6ZU5vZGU9ZnVuY3Rpb24odCl7dmFyIG49eG8odCwyKSx1PW5bMF0sYT1uWzFdO2lmKCJkaXZpZGVyIiE9PWUuRG9tRWRpdG9yLmdldE5vZGVUeXBlKHUpKXJldHVybiBvKFt1LGFdKTtlLkRvbUVkaXRvci5pc0xhc3ROb2RlKGksdSkmJnIuVHJhbnNmb3Jtcy5pbnNlcnROb2RlcyhpLGUuRG9tRWRpdG9yLmdlbkVtcHR5UGFyYWdyYXBoKCkse2F0OlthWzBdKzFdfSk7fSxpfX0sdnA9ZG4ubWFwO3FlKHt0YXJnZXQ6IkFycmF5Iixwcm90bzohMCxmb3JjZWQ6IWhuKCJtYXAiKX0se21hcDpmdW5jdGlvbih0KXtyZXR1cm4gdnAodGhpcyx0LGFyZ3VtZW50cy5sZW5ndGg+MT9hcmd1bWVudHNbMV06dm9pZCAwKX19KTt2YXIgZ3A9RChbXS5qb2luKSxtcD1WIT1PYmplY3QseXA9TG8oImpvaW4iLCIsIik7cWUoe3RhcmdldDoiQXJyYXkiLHByb3RvOiEwLGZvcmNlZDptcHx8IXlwfSx7am9pbjpmdW5jdGlvbih0KXtyZXR1cm4gZ3AoRih0aGlzKSx2b2lkIDA9PT10PyIsIjp0KX19KTt2YXIgYnA9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KCl7dGhpcy50aXRsZT1lLnQoImNvZGVCbG9jay50aXRsZSIpLHRoaXMuaWNvblN2Zz0nPHN2ZyB2aWV3Qm94PSIwIDAgMTI4MCAxMDI0Ij48cGF0aCBkPSJNODMyIDczNmw5NiA5NiAzMjAtMzIwTDkyOCAxOTJsLTk2IDk2IDIyNCAyMjR6TTQ0OCAyODhsLTk2LTk2TDMyIDUxMmwzMjAgMzIwIDk2LTk2LTIyNC0yMjR6TTcwMS4zMTIgMTUwLjUyOGw2OS40NzIgMTguOTQ0LTE5MiA3MDQuMDMyLTY5LjQ3Mi0xOC45NDQgMTkyLTcwNC4wMzJ6Ij48L3BhdGg+PC9zdmc+Jyx0aGlzLnRhZz0iYnV0dG9uIjt9cmV0dXJuIHQucHJvdG90eXBlLmdldFNlbGVjdENvZGVFbGVtPWZ1bmN0aW9uKHQpe3ZhciBuPWUuRG9tRWRpdG9yLmdldFNlbGVjdGVkTm9kZUJ5VHlwZSh0LCJjb2RlIik7aWYobnVsbD09bilyZXR1cm4gbnVsbDt2YXIgcj1lLkRvbUVkaXRvci5nZXRQYXJlbnROb2RlKHQsbik7cmV0dXJuIG51bGw9PXJ8fCJwcmUiIT09ZS5Eb21FZGl0b3IuZ2V0Tm9kZVR5cGUocik/bnVsbDpufSx0LnByb3RvdHlwZS5nZXRWYWx1ZT1mdW5jdGlvbih0KXt2YXIgZT10aGlzLmdldFNlbGVjdENvZGVFbGVtKHQpO3JldHVybiBudWxsPT1lPyIiOmUubGFuZ3VhZ2V8fCIifSx0LnByb3RvdHlwZS5pc0FjdGl2ZT1mdW5jdGlvbih0KXtyZXR1cm4gISF0aGlzLmdldFNlbGVjdENvZGVFbGVtKHQpfSx0LnByb3RvdHlwZS5pc0Rpc2FibGVkPWZ1bmN0aW9uKHQpe2lmKG51bGw9PXQuc2VsZWN0aW9uKXJldHVybiAhMDt2YXIgbj1lLkRvbUVkaXRvci5nZXRTZWxlY3RlZEVsZW1zKHQpO3JldHVybiAhIW4uc29tZSgoZnVuY3Rpb24oZSl7cmV0dXJuIHQuaXNWb2lkKGUpfSkpfHwhbi5zb21lKChmdW5jdGlvbih0KXt2YXIgbj1lLkRvbUVkaXRvci5nZXROb2RlVHlwZSh0KTtpZigicHJlIj09PW58fCJwYXJhZ3JhcGgiPT09bilyZXR1cm4gITB9KSl9LHQucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24odCxlKXt0aGlzLmlzQWN0aXZlKHQpP3RoaXMuY2hhbmdlVG9QbGFpblRleHQodCk6dGhpcy5jaGFuZ2VUb0NvZGVCbG9jayh0LGUudG9TdHJpbmcoKSk7fSx0LnByb3RvdHlwZS5jaGFuZ2VUb1BsYWluVGV4dD1mdW5jdGlvbih0KXt2YXIgZT10aGlzLmdldFNlbGVjdENvZGVFbGVtKHQpO2lmKG51bGwhPWUpe3ZhciBuPXIuTm9kZS5zdHJpbmcoZSk7ci5UcmFuc2Zvcm1zLnJlbW92ZU5vZGVzKHQse21vZGU6ImhpZ2hlc3QifSk7dmFyIG89bi5zcGxpdCgiXG4iKS5tYXAoKGZ1bmN0aW9uKHQpe3JldHVybiB7dHlwZToicGFyYWdyYXBoIixjaGlsZHJlbjpbe3RleHQ6dH1dfX0pKTtyLlRyYW5zZm9ybXMuaW5zZXJ0Tm9kZXModCxvLHttb2RlOiJoaWdoZXN0In0pO319LHQucHJvdG90eXBlLmNoYW5nZVRvQ29kZUJsb2NrPWZ1bmN0aW9uKHQsZSl7dmFyIG4sbyxpPVtdLHU9ci5FZGl0b3Iubm9kZXModCx7bWF0Y2g6ZnVuY3Rpb24oZSl7cmV0dXJuIHQuY2hpbGRyZW4uaW5jbHVkZXMoZSl9LHVuaXZlcnNhbDohMH0pO3RyeXtmb3IodmFyIGE9Ym8odSksYz1hLm5leHQoKTshYy5kb25lO2M9YS5uZXh0KCkpe3ZhciBsPXhvKGMudmFsdWUsMSlbMF07bCYmaS5wdXNoKHIuTm9kZS5zdHJpbmcobCkpO319Y2F0Y2godCl7bj17ZXJyb3I6dH07fWZpbmFsbHl7dHJ5e2MmJiFjLmRvbmUmJihvPWEucmV0dXJuKSYmby5jYWxsKGEpO31maW5hbGx5e2lmKG4pdGhyb3cgbi5lcnJvcn19ci5UcmFuc2Zvcm1zLnJlbW92ZU5vZGVzKHQse21vZGU6ImhpZ2hlc3QifSk7dmFyIHM9e3R5cGU6InByZSIsY2hpbGRyZW46W3t0eXBlOiJjb2RlIixsYW5ndWFnZTplLGNoaWxkcmVuOlt7dGV4dDppLmpvaW4oIlxuIil9XX1dfTtyLlRyYW5zZm9ybXMuaW5zZXJ0Tm9kZXModCxzLHttb2RlOiJoaWdoZXN0In0pO30sdH0oKSx4cD17a2V5OiJjb2RlQmxvY2siLGZhY3Rvcnk6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IGJwfX07cWUoe3RhcmdldDoiU3RyaW5nIixwcm90bzohMCxmb3JjZWQ6TW8oImFuY2hvciIpfSx7YW5jaG9yOmZ1bmN0aW9uKHQpe3JldHVybiBUbyh0aGlzLCJhIiwibmFtZSIsdCl9fSksaXIoIm1hdGNoIiwoZnVuY3Rpb24odCxlLG4pe3JldHVybiBbZnVuY3Rpb24oZSl7dmFyIG49Uih0aGlzKSxyPW51bGw9PWU/dm9pZCAwOmF0KGUsdCk7cmV0dXJuIHI/RShyLGUsbik6bmV3IFJlZ0V4cChlKVt0XShibihuKSl9LGZ1bmN0aW9uKHQpe3ZhciByPUJ0KHRoaXMpLG89Ym4odCksaT1uKGUscixvKTtpZihpLmRvbmUpcmV0dXJuIGkudmFsdWU7aWYoIXIuZ2xvYmFsKXJldHVybiB4cihyLG8pO3ZhciB1PXIudW5pY29kZTtyLmxhc3RJbmRleD0wO2Zvcih2YXIgYSxjPVtdLGw9MDtudWxsIT09KGE9eHIocixvKSk7KXt2YXIgcz1ibihhWzBdKTtjW2xdPXMsIiI9PT1zJiYoci5sYXN0SW5kZXg9ZnIobyx3ZShyLmxhc3RJbmRleCksdSkpLGwrKzt9cmV0dXJuIDA9PT1sP251bGw6Y31dfSkpO3ZhciB3cD17bWVudXM6W3hwXSxlZGl0b3JQbHVnaW46ZnVuY3Rpb24odCl7dmFyIG49dC5pbnNlcnRCcmVhayxvPXQubm9ybWFsaXplTm9kZSxpPXQuaW5zZXJ0RGF0YTt0Lmluc2VydE5vZGU7dmFyIHU9dDtyZXR1cm4gdS5pbnNlcnRCcmVhaz1mdW5jdGlvbigpe3ZhciB0PWUuRG9tRWRpdG9yLmdldFNlbGVjdGVkTm9kZUJ5VHlwZSh1LCJjb2RlIik7aWYobnVsbCE9dCl7dmFyIG89ZnVuY3Rpb24odCxlKXt2YXIgbj1lLnNlbGVjdGlvbjtpZihudWxsPT1uKXJldHVybiAiIjt2YXIgbz1yLk5vZGUuc3RyaW5nKHQpLGk9bi5hbmNob3Iub2Zmc2V0LHU9by5zbGljZSgwLGkpLnNwbGl0KCJcbiIpLGE9dS5sZW5ndGg7cmV0dXJuIDA9PT1hPyIiOnVbYS0xXX0odCx1KTtpZihvKXt2YXIgaT1vLm1hdGNoKC9eXHMrLyk7aWYobnVsbCE9aSYmbnVsbCE9aVswXSl7dmFyIGE9aVswXTtyZXR1cm4gdm9pZCB1Lmluc2VydFRleHQoIlxuIithKX19dS5pbnNlcnRUZXh0KCJcbiIpO31lbHNlIG4oKTt9LHUubm9ybWFsaXplTm9kZT1mdW5jdGlvbih0KXt2YXIgbj14byh0LDIpLGk9blswXSxhPW5bMV0sYz1lLkRvbUVkaXRvci5nZXROb2RlVHlwZShpKTsoImNvZGUiPT09YyYmYS5sZW5ndGg8PTEmJnIuVHJhbnNmb3Jtcy5zZXROb2Rlcyh1LHt0eXBlOiJwYXJhZ3JhcGgifSx7YXQ6YX0pLCJwcmUiPT09YykmJihlLkRvbUVkaXRvci5pc0xhc3ROb2RlKHUsaSkmJnIuVHJhbnNmb3Jtcy5pbnNlcnROb2Rlcyh1LGUuRG9tRWRpdG9yLmdlbkVtcHR5UGFyYWdyYXBoKCkse2F0OlthWzBdKzFdfSksImNvZGUiIT09ZS5Eb21FZGl0b3IuZ2V0Tm9kZVR5cGUoaS5jaGlsZHJlblswXSkmJihyLlRyYW5zZm9ybXMudW53cmFwTm9kZXModSksci5UcmFuc2Zvcm1zLnNldE5vZGVzKHUse3R5cGU6InBhcmFncmFwaCJ9LHttb2RlOiJoaWdoZXN0In0pKSk7cmV0dXJuIG8oW2ksYV0pfSx1Lmluc2VydERhdGE9ZnVuY3Rpb24odCl7aWYobnVsbCE9ZS5Eb21FZGl0b3IuZ2V0U2VsZWN0ZWROb2RlQnlUeXBlKHUsImNvZGUiKSl7dmFyIG49dC5nZXREYXRhKCJ0ZXh0L3BsYWluIik7ci5FZGl0b3IuaW5zZXJ0VGV4dCh1LG4pO31lbHNlIGkodCk7fSx1fSxyZW5kZXJFbGVtczpbe3R5cGU6InByZSIscmVuZGVyRWxlbTpmdW5jdGlvbih0LGUscil7cmV0dXJuIG4uanN4KCJwcmUiLG51bGwsZSl9fSx7dHlwZToiY29kZSIscmVuZGVyRWxlbTpmdW5jdGlvbih0LGUscil7cmV0dXJuIG4uanN4KCJjb2RlIixudWxsLGUpfX1dLGVsZW1zVG9IdG1sOlt7dHlwZToiY29kZSIsZWxlbVRvSHRtbDpmdW5jdGlvbih0LGUpe3JldHVybiAiPGNvZGU+IitlKyI8L2NvZGU+In19LHt0eXBlOiJwcmUiLGVsZW1Ub0h0bWw6ZnVuY3Rpb24odCxlKXtyZXR1cm4gIjxwcmU+IitlKyI8L3ByZT4ifX1dLHByZVBhcnNlSHRtbDpbe3NlbGVjdG9yOiJwcmU+Y29kZSIscHJlUGFyc2VIdG1sOmZ1bmN0aW9uKHQpe3ZhciBlPWMuZGVmYXVsdCh0KTtpZigiY29kZSIhPT1mbyhlKSlyZXR1cm4gdDt2YXIgbj1lLmZpbmQoInhtcCIpO2lmKDA9PT1uLmxlbmd0aClyZXR1cm4gdDt2YXIgcj1uLnRleHQoKTtyZXR1cm4gbi5yZW1vdmUoKSxlLnRleHQociksZVswXX19XSxwYXJzZUVsZW1zSHRtbDpbe3NlbGVjdG9yOiJwcmU6bm90KFtkYXRhLXctZS10eXBlXSk+Y29kZSIscGFyc2VFbGVtSHRtbDpmdW5jdGlvbih0LGUsbil7cmV0dXJuIHt0eXBlOiJjb2RlIixsYW5ndWFnZToiIixjaGlsZHJlbjpbe3RleHQ6Yy5kZWZhdWx0KHQpWzBdLnRleHRDb250ZW50fHwiIn1dfX19LHtzZWxlY3RvcjoicHJlOm5vdChbZGF0YS13LWUtdHlwZV0pIixwYXJzZUVsZW1IdG1sOmZ1bmN0aW9uKHQsbixyKXt2YXIgbz1jLmRlZmF1bHQodCk7cmV0dXJuIDA9PT0obj1uLmZpbHRlcigoZnVuY3Rpb24odCl7cmV0dXJuICJjb2RlIj09PWUuRG9tRWRpdG9yLmdldE5vZGVUeXBlKHQpfSkpKS5sZW5ndGgmJihuPVt7dHlwZToiY29kZSIsbGFuZ3VhZ2U6IiIsY2hpbGRyZW46W3t0ZXh0Om9bMF0udGV4dENvbnRlbnR8fCIifV19XSkse3R5cGU6InByZSIsY2hpbGRyZW46bi5maWx0ZXIoKGZ1bmN0aW9uKHQpe3JldHVybiAiY29kZSI9PT1lLkRvbUVkaXRvci5nZXROb2RlVHlwZSh0KX0pKX19fV19LEVwPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe3RoaXMudGl0bGU9ZS50KCJmdWxsU2NyZWVuLnRpdGxlIiksdGhpcy5pY29uU3ZnPSc8c3ZnIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik0xMzMuNzA1MTQzIDMzNS40MzMxNDNWMTMzLjg1MTQyOWgyMDEuNTgxNzE0YTI5LjYyMjg1NyAyOS42MjI4NTcgMCAwIDAgMjkuNjIyODU3LTI5LjU0OTcxNVY2OC43NTQyODZhMjkuNjIyODU3IDI5LjYyMjg1NyAwIDAgMC0yOS42MjI4NTctMjkuNjIyODU3SDYxLjczMjU3MUEyMi44OTM3MTQgMjIuODkzNzE0IDAgMCAwIDM4Ljc2NTcxNCA2Mi4wMjUxNDNWMzM1LjcyNTcxNGMwIDE2LjMxMDg1NyAxMy4yMzg4NTcgMjkuNjIyODU3IDI5LjYyMjg1NyAyOS42MjI4NTdoMzUuNTQ3NDI5YTI5Ljg0MjI4NiAyOS44NDIyODYgMCAwIDAgMjkuNjk2LTI5Ljg0MjI4NXpNNjkwLjk4MDU3MSAxMzMuODUxNDI5aDIwMS41ODE3MTV2MjAxLjY1NDg1N2MwIDE2LjMxMDg1NyAxMy4yMzg4NTcgMjkuNTQ5NzE0IDI5LjYyMjg1NyAyOS41NDk3MTRoMzUuNTQ3NDI4YTI5LjYyMjg1NyAyOS42MjI4NTcgMCAwIDAgMjkuNTQ5NzE1LTI5LjU0OTcxNFY2MS45NTJhMjIuODkzNzE0IDIyLjg5MzcxNCAwIDAgMC0yMi44MjA1NzItMjIuODkzNzE0aC0yNzMuNTU0Mjg1YTI5LjYyMjg1NyAyOS42MjI4NTcgMCAwIDAtMjkuNTQ5NzE1IDI5LjYyMjg1N3YzNS41NDc0MjhjMCAxNi4zMTA4NTcgMTMuMjM4ODU3IDI5LjY5NiAyOS42MjI4NTcgMjkuNjk2ek0zMzUuMjg2ODU3IDg5Mi43ODE3MTRIMTMzLjcwNTE0M1Y2OTEuMmEyOS42MjI4NTcgMjkuNjIyODU3IDAgMCAwLTI5LjYyMjg1Ny0yOS42MjI4NTdINjguNTM0ODU3YTI5LjYyMjg1NyAyOS42MjI4NTcgMCAwIDAtMjkuNTQ5NzE0IDI5LjYyMjg1N3YyNzMuNTU0Mjg2YzAgMTIuNjUzNzE0IDEwLjI0IDIyLjg5MzcxNCAyMi44MjA1NzEgMjIuODkzNzE0aDI3My41NTQyODZhMjkuNjIyODU3IDI5LjYyMjg1NyAwIDAgMCAyOS42OTYtMjkuNjIyODU3di0zNS41NDc0MjlhMjkuNzY5MTQzIDI5Ljc2OTE0MyAwIDAgMC0yOS43NjkxNDMtMjkuNjk2eiBtNTU3LjM0ODU3Mi0yMDEuNTgxNzE0djIwMS41ODE3MTRINjkwLjkwNzQyOWEyOS42MjI4NTcgMjkuNjIyODU3IDAgMCAwLTI5LjYyMjg1OCAyOS42MjI4NTd2MzUuNTQ3NDI5YzAgMTYuMzEwODU3IDEzLjIzODg1NyAyOS42MjI4NTcgMjkuNjIyODU4IDI5LjYyMjg1N2gyNzMuNTU0Mjg1YzEyLjU4MDU3MSAwIDIyLjg5MzcxNC0xMC4zMTMxNDMgMjIuODkzNzE1LTIyLjg5MzcxNFY2OTEuMmEyOS42MjI4NTcgMjkuNjIyODU3IDAgMCAwLTI5LjYyMjg1OC0yOS42MjI4NTdoLTM1LjU0NzQyOGEyOS42MjI4NTcgMjkuNjIyODU3IDAgMCAwLTI5LjY5NiAyOS42MjI4NTd6Ij48L3BhdGg+PC9zdmc+Jyx0aGlzLnRhZz0iYnV0dG9uIix0aGlzLmFsd2F5c0VuYWJsZT0hMDt9cmV0dXJuIHQucHJvdG90eXBlLmdldFZhbHVlPWZ1bmN0aW9uKHQpe3JldHVybiAiIn0sdC5wcm90b3R5cGUuaXNBY3RpdmU9ZnVuY3Rpb24odCl7cmV0dXJuIHQuaXNGdWxsU2NyZWVufSx0LnByb3RvdHlwZS5pc0Rpc2FibGVkPWZ1bmN0aW9uKHQpe3JldHVybiAhMX0sdC5wcm90b3R5cGUuZXhlYz1mdW5jdGlvbih0LGUpe3QuaXNGdWxsU2NyZWVuP3QudW5GdWxsU2NyZWVuKCk6dC5mdWxsU2NyZWVuKCk7fSx0fSgpLFNwPXttZW51czpbe2tleToiZnVsbFNjcmVlbiIsZmFjdG9yeTpmdW5jdGlvbigpe3JldHVybiBuZXcgRXB9fV19LGtwPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe3RoaXMudGl0bGU9ZS50KCJjb21tb24uZW50ZXIiKSx0aGlzLmljb25Tdmc9Jzxzdmcgdmlld0JveD0iMCAwIDEyNTUgMTAyNCI+PHBhdGggZD0iTTEwOTUuMTExMTExIDczMS40NzczMzNoLTYyNS43Nzc3NzhWMTAyNEwwIDY1OC4zMTgyMjIgNDY5LjMzMzMzMyAyOTIuNDA4ODg5djI5Mi42MzY0NDRoNjI1Ljc3Nzc3OFYwaDE1Ni40NDQ0NDV2NzMxLjQ3NzMzM3oiPjwvcGF0aD48L3N2Zz4nLHRoaXMudGFnPSJidXR0b24iO31yZXR1cm4gdC5wcm90b3R5cGUuZ2V0VmFsdWU9ZnVuY3Rpb24odCl7cmV0dXJuICIifSx0LnByb3RvdHlwZS5pc0FjdGl2ZT1mdW5jdGlvbih0KXtyZXR1cm4gITF9LHQucHJvdG90eXBlLmlzRGlzYWJsZWQ9ZnVuY3Rpb24odCl7dmFyIGU9dC5zZWxlY3Rpb247cmV0dXJuIG51bGw9PWV8fCEhci5SYW5nZS5pc0V4cGFuZGVkKGUpfSx0LnByb3RvdHlwZS5leGVjPWZ1bmN0aW9uKHQsZSl7dmFyIG49dC5zZWxlY3Rpb247aWYobnVsbCE9bil7dmFyIG89W24uYW5jaG9yLnBhdGhbMF1dO3IuVHJhbnNmb3Jtcy5pbnNlcnROb2Rlcyh0LHt0eXBlOiJwYXJhZ3JhcGgiLGNoaWxkcmVuOlt7dGV4dDoiIn1dfSx7YXQ6b30pLHQuc2VsZWN0KHIuRWRpdG9yLnN0YXJ0KHQsbykpO319LHR9KCksVHA9W2hpLHB1LFVkLFFkLG9wLHVwLGdhLGhwLERhLFB1LHdwLE9hLG51LEVvLGJhLGxwLFNwLHttZW51czpbe2tleToiZW50ZXIiLGZhY3Rvcnk6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IGtwfX1dfV07dC5kZWZhdWx0PVRwLHQuaW5zZXJ0SW1hZ2VOb2RlPW5hLHQuaXNJbnNlcnRJbWFnZU1lbnVEaXNhYmxlZD1vYSx0LnVwZGF0ZUltYWdlTm9kZT1yYSxPYmplY3QuZGVmaW5lUHJvcGVydHkodCwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7fSkpOwoKICB9KTsKCiAgdmFyIGJhc2ljTW9kdWxlcyA9IC8qQF9fUFVSRV9fKi9nZXREZWZhdWx0RXhwb3J0RnJvbUNqcyhkaXN0JDUpOwoKICB2YXIgZGlzdCQ0ID0gY3JlYXRlQ29tbW9uanNNb2R1bGUkMShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgIWZ1bmN0aW9uKHQsZSl7bW9kdWxlLmV4cG9ydHM9ZShkaXN0JDYscmVxdWlyZSQkMiQxLHJlcXVpcmUkJDIscmVxdWlyZSQkMSk7fShjb21tb25qc0dsb2JhbCwoZnVuY3Rpb24odCxlLHIsbil7ZnVuY3Rpb24gbyh0KXtyZXR1cm4gdCYmIm9iamVjdCI9PXR5cGVvZiB0JiYiZGVmYXVsdCJpbiB0P3Q6e2RlZmF1bHQ6dH19dmFyIGk9byhuKTt0LmkxOG5BZGRSZXNvdXJjZXMoImVuIix7bGlzdE1vZHVsZTp7dW5PcmRlcmVkTGlzdDoiVW5vcmRlcmVkIGxpc3QiLG9yZGVyZWRMaXN0OiJPcmRlcmVkIGxpc3QifX0pLHQuaTE4bkFkZFJlc291cmNlcygiemgtQ04iLHtsaXN0TW9kdWxlOnt1bk9yZGVyZWRMaXN0OiLml6Dluo/liJfooagiLG9yZGVyZWRMaXN0OiLmnInluo/liJfooagifX0pO3ZhciB1PSJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsVGhpcz9nbG9iYWxUaGlzOiJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93P3dpbmRvdzoidW5kZWZpbmVkIiE9dHlwZW9mIGNvbW1vbmpzR2xvYmFsP2NvbW1vbmpzR2xvYmFsOiJ1bmRlZmluZWQiIT10eXBlb2Ygc2VsZj9zZWxmOnt9O2Z1bmN0aW9uIGEodCl7dmFyIGU9e2V4cG9ydHM6e319O3JldHVybiB0KGUsZS5leHBvcnRzKSxlLmV4cG9ydHN9dmFyIGMsZixsPWZ1bmN0aW9uKHQpe3JldHVybiB0JiZ0Lk1hdGg9PU1hdGgmJnR9LHM9bCgib2JqZWN0Ij09dHlwZW9mIGdsb2JhbFRoaXMmJmdsb2JhbFRoaXMpfHxsKCJvYmplY3QiPT10eXBlb2Ygd2luZG93JiZ3aW5kb3cpfHxsKCJvYmplY3QiPT10eXBlb2Ygc2VsZiYmc2VsZil8fGwoIm9iamVjdCI9PXR5cGVvZiB1JiZ1KXx8ZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30oKXx8RnVuY3Rpb24oInJldHVybiB0aGlzIikoKSxkPUZ1bmN0aW9uLnByb3RvdHlwZSx2PWQuYmluZCxwPWQuY2FsbCx5PXYmJnYuYmluZChwKSxoPXY/ZnVuY3Rpb24odCl7cmV0dXJuIHQmJnkocCx0KX06ZnVuY3Rpb24odCl7cmV0dXJuIHQmJmZ1bmN0aW9uKCl7cmV0dXJuIHAuYXBwbHkodCxhcmd1bWVudHMpfX0sZz1mdW5jdGlvbih0KXt0cnl7cmV0dXJuICEhdCgpfWNhdGNoKHQpe3JldHVybiAhMH19LGI9aCh7fS50b1N0cmluZyksbT1oKCIiLnNsaWNlKSx3PWZ1bmN0aW9uKHQpe3JldHVybiBtKGIodCksOCwtMSl9LHg9cy5PYmplY3QsUz1oKCIiLnNwbGl0KSxPPWcoKGZ1bmN0aW9uKCl7cmV0dXJuICF4KCJ6IikucHJvcGVydHlJc0VudW1lcmFibGUoMCl9KSk/ZnVuY3Rpb24odCl7cmV0dXJuICJTdHJpbmciPT13KHQpP1ModCwiIik6eCh0KX06eCxFPXMuVHlwZUVycm9yLFQ9ZnVuY3Rpb24odCl7aWYobnVsbD09dCl0aHJvdyBFKCJDYW4ndCBjYWxsIG1ldGhvZCBvbiAiK3QpO3JldHVybiB0fSxqPWZ1bmN0aW9uKHQpe3JldHVybiBPKFQodCkpfSxBPU9iamVjdC5kZWZpbmVQcm9wZXJ0eSxJPWZ1bmN0aW9uKHQsZSl7dHJ5e0Eocyx0LHt2YWx1ZTplLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMH0pO31jYXRjaChyKXtzW3RdPWU7fXJldHVybiBlfSxQPSJfX2NvcmUtanNfc2hhcmVkX18iLFI9c1tQXXx8SShQLHt9KSxMPWEoKGZ1bmN0aW9uKHQpeyh0LmV4cG9ydHM9ZnVuY3Rpb24odCxlKXtyZXR1cm4gUlt0XXx8KFJbdF09dm9pZCAwIT09ZT9lOnt9KX0pKCJ2ZXJzaW9ucyIsW10pLnB1c2goe3ZlcnNpb246IjMuMTkuMyIsbW9kZToiZ2xvYmFsIixjb3B5cmlnaHQ6IsKpIDIwMjEgRGVuaXMgUHVzaGthcmV2ICh6bG9pcm9jay5ydSkifSk7fSkpLGs9cy5PYmplY3QsTT1mdW5jdGlvbih0KXtyZXR1cm4gayhUKHQpKX0sTj1oKHt9Lmhhc093blByb3BlcnR5KSxfPU9iamVjdC5oYXNPd258fGZ1bmN0aW9uKHQsZSl7cmV0dXJuIE4oTSh0KSxlKX0sej0wLEQ9TWF0aC5yYW5kb20oKSxDPWgoMS4udG9TdHJpbmcpLEY9ZnVuY3Rpb24odCl7cmV0dXJuICJTeW1ib2woIisodm9pZCAwPT09dD8iIjp0KSsiKV8iK0MoKyt6K0QsMzYpfSxIPWZ1bmN0aW9uKHQpe3JldHVybiAiZnVuY3Rpb24iPT10eXBlb2YgdH0sQj1mdW5jdGlvbih0KXtyZXR1cm4gSCh0KT90OnZvaWQgMH0sRz1mdW5jdGlvbih0LGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPDI/QihzW3RdKTpzW3RdJiZzW3RdW2VdfSwkPUcoIm5hdmlnYXRvciIsInVzZXJBZ2VudCIpfHwiIixWPXMucHJvY2VzcyxXPXMuRGVubyxVPVYmJlYudmVyc2lvbnN8fFcmJlcudmVyc2lvbixxPVUmJlUudjg7cSYmKGY9KGM9cS5zcGxpdCgiLiIpKVswXT4wJiZjWzBdPDQ/MTorKGNbMF0rY1sxXSkpLCFmJiYkJiYoIShjPSQubWF0Y2goL0VkZ2VcLyhcZCspLykpfHxjWzFdPj03NCkmJihjPSQubWF0Y2goL0Nocm9tZVwvKFxkKykvKSkmJihmPStjWzFdKTt2YXIgSyxZPWYsWD0hIU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMmJiFnKChmdW5jdGlvbigpe3ZhciB0PVN5bWJvbCgpO3JldHVybiAhU3RyaW5nKHQpfHwhKE9iamVjdCh0KWluc3RhbmNlb2YgU3ltYm9sKXx8IVN5bWJvbC5zaGFtJiZZJiZZPDQxfSkpLEo9WCYmIVN5bWJvbC5zaGFtJiYic3ltYm9sIj09dHlwZW9mIFN5bWJvbC5pdGVyYXRvcixRPUwoIndrcyIpLFo9cy5TeW1ib2wsdHQ9WiYmWi5mb3IsZXQ9Sj9aOlomJloud2l0aG91dFNldHRlcnx8RixydD1mdW5jdGlvbih0KXtpZighXyhRLHQpfHwhWCYmInN0cmluZyIhPXR5cGVvZiBRW3RdKXt2YXIgZT0iU3ltYm9sLiIrdDtYJiZfKFosdCk/UVt0XT1aW3RdOlFbdF09SiYmdHQ/dHQoZSk6ZXQoZSk7fXJldHVybiBRW3RdfSxudD1mdW5jdGlvbih0KXtyZXR1cm4gIm9iamVjdCI9PXR5cGVvZiB0P251bGwhPT10OkgodCl9LG90PXMuU3RyaW5nLGl0PXMuVHlwZUVycm9yLHV0PWZ1bmN0aW9uKHQpe2lmKG50KHQpKXJldHVybiB0O3Rocm93IGl0KG90KHQpKyIgaXMgbm90IGFuIG9iamVjdCIpfSxhdD0hZygoZnVuY3Rpb24oKXtyZXR1cm4gNyE9T2JqZWN0LmRlZmluZVByb3BlcnR5KHt9LDEse2dldDpmdW5jdGlvbigpe3JldHVybiA3fX0pWzFdfSkpLGN0PXMuZG9jdW1lbnQsZnQ9bnQoY3QpJiZudChjdC5jcmVhdGVFbGVtZW50KSxsdD1mdW5jdGlvbih0KXtyZXR1cm4gZnQ/Y3QuY3JlYXRlRWxlbWVudCh0KTp7fX0sc3Q9IWF0JiYhZygoZnVuY3Rpb24oKXtyZXR1cm4gNyE9T2JqZWN0LmRlZmluZVByb3BlcnR5KGx0KCJkaXYiKSwiYSIse2dldDpmdW5jdGlvbigpe3JldHVybiA3fX0pLmF9KSksZHQ9RnVuY3Rpb24ucHJvdG90eXBlLmNhbGwsdnQ9ZHQuYmluZD9kdC5iaW5kKGR0KTpmdW5jdGlvbigpe3JldHVybiBkdC5hcHBseShkdCxhcmd1bWVudHMpfSxwdD1oKHt9LmlzUHJvdG90eXBlT2YpLHl0PXMuT2JqZWN0LGh0PUo/ZnVuY3Rpb24odCl7cmV0dXJuICJzeW1ib2wiPT10eXBlb2YgdH06ZnVuY3Rpb24odCl7dmFyIGU9RygiU3ltYm9sIik7cmV0dXJuIEgoZSkmJnB0KGUucHJvdG90eXBlLHl0KHQpKX0sZ3Q9cy5TdHJpbmcsYnQ9ZnVuY3Rpb24odCl7dHJ5e3JldHVybiBndCh0KX1jYXRjaCh0KXtyZXR1cm4gIk9iamVjdCJ9fSxtdD1zLlR5cGVFcnJvcix3dD1mdW5jdGlvbih0KXtpZihIKHQpKXJldHVybiB0O3Rocm93IG10KGJ0KHQpKyIgaXMgbm90IGEgZnVuY3Rpb24iKX0seHQ9ZnVuY3Rpb24odCxlKXt2YXIgcj10W2VdO3JldHVybiBudWxsPT1yP3ZvaWQgMDp3dChyKX0sU3Q9cy5UeXBlRXJyb3IsT3Q9cy5UeXBlRXJyb3IsRXQ9cnQoInRvUHJpbWl0aXZlIiksVHQ9ZnVuY3Rpb24odCxlKXtpZighbnQodCl8fGh0KHQpKXJldHVybiB0O3ZhciByLG49eHQodCxFdCk7aWYobil7aWYodm9pZCAwPT09ZSYmKGU9ImRlZmF1bHQiKSxyPXZ0KG4sdCxlKSwhbnQocil8fGh0KHIpKXJldHVybiByO3Rocm93IE90KCJDYW4ndCBjb252ZXJ0IG9iamVjdCB0byBwcmltaXRpdmUgdmFsdWUiKX1yZXR1cm4gdm9pZCAwPT09ZSYmKGU9Im51bWJlciIpLGZ1bmN0aW9uKHQsZSl7dmFyIHIsbjtpZigic3RyaW5nIj09PWUmJkgocj10LnRvU3RyaW5nKSYmIW50KG49dnQocix0KSkpcmV0dXJuIG47aWYoSChyPXQudmFsdWVPZikmJiFudChuPXZ0KHIsdCkpKXJldHVybiBuO2lmKCJzdHJpbmciIT09ZSYmSChyPXQudG9TdHJpbmcpJiYhbnQobj12dChyLHQpKSlyZXR1cm4gbjt0aHJvdyBTdCgiQ2FuJ3QgY29udmVydCBvYmplY3QgdG8gcHJpbWl0aXZlIHZhbHVlIil9KHQsZSl9LGp0PWZ1bmN0aW9uKHQpe3ZhciBlPVR0KHQsInN0cmluZyIpO3JldHVybiBodChlKT9lOmUrIiJ9LEF0PXMuVHlwZUVycm9yLEl0PU9iamVjdC5kZWZpbmVQcm9wZXJ0eSxQdD17ZjphdD9JdDpmdW5jdGlvbih0LGUscil7aWYodXQodCksZT1qdChlKSx1dChyKSxzdCl0cnl7cmV0dXJuIEl0KHQsZSxyKX1jYXRjaCh0KXt9aWYoImdldCJpbiByfHwic2V0ImluIHIpdGhyb3cgQXQoIkFjY2Vzc29ycyBub3Qgc3VwcG9ydGVkIik7cmV0dXJuICJ2YWx1ZSJpbiByJiYodFtlXT1yLnZhbHVlKSx0fX0sUnQ9TWF0aC5jZWlsLEx0PU1hdGguZmxvb3Isa3Q9ZnVuY3Rpb24odCl7dmFyIGU9K3Q7cmV0dXJuIGUhPWV8fDA9PT1lPzA6KGU+MD9MdDpSdCkoZSl9LE10PU1hdGgubWF4LE50PU1hdGgubWluLF90PWZ1bmN0aW9uKHQsZSl7dmFyIHI9a3QodCk7cmV0dXJuIHI8MD9NdChyK2UsMCk6TnQocixlKX0senQ9TWF0aC5taW4sRHQ9ZnVuY3Rpb24odCl7cmV0dXJuIHQ+MD96dChrdCh0KSw5MDA3MTk5MjU0NzQwOTkxKTowfSxDdD1mdW5jdGlvbih0KXtyZXR1cm4gRHQodC5sZW5ndGgpfSxGdD1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSxyLG4pe3ZhciBvLGk9aihlKSx1PUN0KGkpLGE9X3Qobix1KTtpZih0JiZyIT1yKXtmb3IoO3U+YTspaWYoKG89aVthKytdKSE9bylyZXR1cm4gITB9ZWxzZSBmb3IoO3U+YTthKyspaWYoKHR8fGEgaW4gaSkmJmlbYV09PT1yKXJldHVybiB0fHxhfHwwO3JldHVybiAhdCYmLTF9fSxIdD17aW5jbHVkZXM6RnQoITApLGluZGV4T2Y6RnQoITEpfSxCdD17fSxHdD1IdC5pbmRleE9mLCR0PWgoW10ucHVzaCksVnQ9ZnVuY3Rpb24odCxlKXt2YXIgcixuPWoodCksbz0wLGk9W107Zm9yKHIgaW4gbikhXyhCdCxyKSYmXyhuLHIpJiYkdChpLHIpO2Zvcig7ZS5sZW5ndGg+bzspXyhuLHI9ZVtvKytdKSYmKH5HdChpLHIpfHwkdChpLHIpKTtyZXR1cm4gaX0sV3Q9WyJjb25zdHJ1Y3RvciIsImhhc093blByb3BlcnR5IiwiaXNQcm90b3R5cGVPZiIsInByb3BlcnR5SXNFbnVtZXJhYmxlIiwidG9Mb2NhbGVTdHJpbmciLCJ0b1N0cmluZyIsInZhbHVlT2YiXSxVdD1PYmplY3Qua2V5c3x8ZnVuY3Rpb24odCl7cmV0dXJuIFZ0KHQsV3QpfSxxdD1hdD9PYmplY3QuZGVmaW5lUHJvcGVydGllczpmdW5jdGlvbih0LGUpe3V0KHQpO2Zvcih2YXIgcixuPWooZSksbz1VdChlKSxpPW8ubGVuZ3RoLHU9MDtpPnU7KVB0LmYodCxyPW9bdSsrXSxuW3JdKTtyZXR1cm4gdH0sS3Q9RygiZG9jdW1lbnQiLCJkb2N1bWVudEVsZW1lbnQiKSxZdD1MKCJrZXlzIiksWHQ9ZnVuY3Rpb24odCl7cmV0dXJuIFl0W3RdfHwoWXRbdF09Rih0KSl9LEp0PVh0KCJJRV9QUk9UTyIpLFF0PWZ1bmN0aW9uKCl7fSxadD1mdW5jdGlvbih0KXtyZXR1cm4gIjxzY3JpcHQ+Iit0KyI8LyIrInNjcmlwdD4ifSx0ZT1mdW5jdGlvbih0KXt0LndyaXRlKFp0KCIiKSksdC5jbG9zZSgpO3ZhciBlPXQucGFyZW50V2luZG93Lk9iamVjdDtyZXR1cm4gdD1udWxsLGV9LGVlPWZ1bmN0aW9uKCl7dHJ5e0s9bmV3IEFjdGl2ZVhPYmplY3QoImh0bWxmaWxlIik7fWNhdGNoKHQpe312YXIgdCxlO2VlPSJ1bmRlZmluZWQiIT10eXBlb2YgZG9jdW1lbnQ/ZG9jdW1lbnQuZG9tYWluJiZLP3RlKEspOigoZT1sdCgiaWZyYW1lIikpLnN0eWxlLmRpc3BsYXk9Im5vbmUiLEt0LmFwcGVuZENoaWxkKGUpLGUuc3JjPVN0cmluZygiamF2YXNjcmlwdDoiKSwodD1lLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQpLm9wZW4oKSx0LndyaXRlKFp0KCJkb2N1bWVudC5GPU9iamVjdCIpKSx0LmNsb3NlKCksdC5GKTp0ZShLKTtmb3IodmFyIHI9V3QubGVuZ3RoO3ItLTspZGVsZXRlIGVlLnByb3RvdHlwZVtXdFtyXV07cmV0dXJuIGVlKCl9O0J0W0p0XT0hMDt2YXIgcmU9T2JqZWN0LmNyZWF0ZXx8ZnVuY3Rpb24odCxlKXt2YXIgcjtyZXR1cm4gbnVsbCE9PXQ/KFF0LnByb3RvdHlwZT11dCh0KSxyPW5ldyBRdCxRdC5wcm90b3R5cGU9bnVsbCxyW0p0XT10KTpyPWVlKCksdm9pZCAwPT09ZT9yOnF0KHIsZSl9LG5lPXJ0KCJ1bnNjb3BhYmxlcyIpLG9lPUFycmF5LnByb3RvdHlwZTtudWxsPT1vZVtuZV0mJlB0LmYob2UsbmUse2NvbmZpZ3VyYWJsZTohMCx2YWx1ZTpyZShudWxsKX0pO3ZhciBpZT1mdW5jdGlvbih0KXtvZVtuZV1bdF09ITA7fSx1ZT17fSxhZT1oKEZ1bmN0aW9uLnRvU3RyaW5nKTtIKFIuaW5zcGVjdFNvdXJjZSl8fChSLmluc3BlY3RTb3VyY2U9ZnVuY3Rpb24odCl7cmV0dXJuIGFlKHQpfSk7dmFyIGNlLGZlLGxlLHNlPVIuaW5zcGVjdFNvdXJjZSxkZT1zLldlYWtNYXAsdmU9SChkZSkmJi9uYXRpdmUgY29kZS8udGVzdChzZShkZSkpLHBlPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIHtlbnVtZXJhYmxlOiEoMSZ0KSxjb25maWd1cmFibGU6ISgyJnQpLHdyaXRhYmxlOiEoNCZ0KSx2YWx1ZTplfX0seWU9YXQ/ZnVuY3Rpb24odCxlLHIpe3JldHVybiBQdC5mKHQsZSxwZSgxLHIpKX06ZnVuY3Rpb24odCxlLHIpe3JldHVybiB0W2VdPXIsdH0saGU9Ik9iamVjdCBhbHJlYWR5IGluaXRpYWxpemVkIixnZT1zLlR5cGVFcnJvcixiZT1zLldlYWtNYXA7aWYodmV8fFIuc3RhdGUpe3ZhciBtZT1SLnN0YXRlfHwoUi5zdGF0ZT1uZXcgYmUpLHdlPWgobWUuZ2V0KSx4ZT1oKG1lLmhhcyksU2U9aChtZS5zZXQpO2NlPWZ1bmN0aW9uKHQsZSl7aWYoeGUobWUsdCkpdGhyb3cgbmV3IGdlKGhlKTtyZXR1cm4gZS5mYWNhZGU9dCxTZShtZSx0LGUpLGV9LGZlPWZ1bmN0aW9uKHQpe3JldHVybiB3ZShtZSx0KXx8e319LGxlPWZ1bmN0aW9uKHQpe3JldHVybiB4ZShtZSx0KX07fWVsc2Uge3ZhciBPZT1YdCgic3RhdGUiKTtCdFtPZV09ITAsY2U9ZnVuY3Rpb24odCxlKXtpZihfKHQsT2UpKXRocm93IG5ldyBnZShoZSk7cmV0dXJuIGUuZmFjYWRlPXQseWUodCxPZSxlKSxlfSxmZT1mdW5jdGlvbih0KXtyZXR1cm4gXyh0LE9lKT90W09lXTp7fX0sbGU9ZnVuY3Rpb24odCl7cmV0dXJuIF8odCxPZSl9O312YXIgRWUsVGUsamUsQWU9e3NldDpjZSxnZXQ6ZmUsaGFzOmxlLGVuZm9yY2U6ZnVuY3Rpb24odCl7cmV0dXJuIGxlKHQpP2ZlKHQpOmNlKHQse30pfSxnZXR0ZXJGb3I6ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGUpe3ZhciByO2lmKCFudChlKXx8KHI9ZmUoZSkpLnR5cGUhPT10KXRocm93IGdlKCJJbmNvbXBhdGlibGUgcmVjZWl2ZXIsICIrdCsiIHJlcXVpcmVkIik7cmV0dXJuIHJ9fX0sSWU9e30ucHJvcGVydHlJc0VudW1lcmFibGUsUGU9T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcixSZT17ZjpQZSYmIUllLmNhbGwoezE6Mn0sMSk/ZnVuY3Rpb24odCl7dmFyIGU9UGUodGhpcyx0KTtyZXR1cm4gISFlJiZlLmVudW1lcmFibGV9OkllfSxMZT1PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLGtlPXtmOmF0P0xlOmZ1bmN0aW9uKHQsZSl7aWYodD1qKHQpLGU9anQoZSksc3QpdHJ5e3JldHVybiBMZSh0LGUpfWNhdGNoKHQpe31pZihfKHQsZSkpcmV0dXJuIHBlKCF2dChSZS5mLHQsZSksdFtlXSl9fSxNZT1GdW5jdGlvbi5wcm90b3R5cGUsTmU9YXQmJk9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IsX2U9XyhNZSwibmFtZSIpLHplPXtFWElTVFM6X2UsUFJPUEVSOl9lJiYic29tZXRoaW5nIj09PWZ1bmN0aW9uKCl7fS5uYW1lLENPTkZJR1VSQUJMRTpfZSYmKCFhdHx8YXQmJk5lKE1lLCJuYW1lIikuY29uZmlndXJhYmxlKX0sRGU9YSgoZnVuY3Rpb24odCl7dmFyIGU9emUuQ09ORklHVVJBQkxFLHI9QWUuZ2V0LG49QWUuZW5mb3JjZSxvPVN0cmluZyhTdHJpbmcpLnNwbGl0KCJTdHJpbmciKTsodC5leHBvcnRzPWZ1bmN0aW9uKHQscixpLHUpe3ZhciBhLGM9ISF1JiYhIXUudW5zYWZlLGY9ISF1JiYhIXUuZW51bWVyYWJsZSxsPSEhdSYmISF1Lm5vVGFyZ2V0R2V0LGQ9dSYmdm9pZCAwIT09dS5uYW1lP3UubmFtZTpyO0goaSkmJigiU3ltYm9sKCI9PT1TdHJpbmcoZCkuc2xpY2UoMCw3KSYmKGQ9IlsiK1N0cmluZyhkKS5yZXBsYWNlKC9eU3ltYm9sXCgoW14pXSopXCkvLCIkMSIpKyJdIiksKCFfKGksIm5hbWUiKXx8ZSYmaS5uYW1lIT09ZCkmJnllKGksIm5hbWUiLGQpLChhPW4oaSkpLnNvdXJjZXx8KGEuc291cmNlPW8uam9pbigic3RyaW5nIj09dHlwZW9mIGQ/ZDoiIikpKSx0IT09cz8oYz8hbCYmdFtyXSYmKGY9ITApOmRlbGV0ZSB0W3JdLGY/dFtyXT1pOnllKHQscixpKSk6Zj90W3JdPWk6SShyLGkpO30pKEZ1bmN0aW9uLnByb3RvdHlwZSwidG9TdHJpbmciLChmdW5jdGlvbigpe3JldHVybiBIKHRoaXMpJiZyKHRoaXMpLnNvdXJjZXx8c2UodGhpcyl9KSk7fSkpLENlPVd0LmNvbmNhdCgibGVuZ3RoIiwicHJvdG90eXBlIiksRmU9e2Y6T2JqZWN0LmdldE93blByb3BlcnR5TmFtZXN8fGZ1bmN0aW9uKHQpe3JldHVybiBWdCh0LENlKX19LEhlPXtmOk9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHN9LEJlPWgoW10uY29uY2F0KSxHZT1HKCJSZWZsZWN0Iiwib3duS2V5cyIpfHxmdW5jdGlvbih0KXt2YXIgZT1GZS5mKHV0KHQpKSxyPUhlLmY7cmV0dXJuIHI/QmUoZSxyKHQpKTplfSwkZT1mdW5jdGlvbih0LGUpe2Zvcih2YXIgcj1HZShlKSxuPVB0LmYsbz1rZS5mLGk9MDtpPHIubGVuZ3RoO2krKyl7dmFyIHU9cltpXTtfKHQsdSl8fG4odCx1LG8oZSx1KSk7fX0sVmU9LyN8XC5wcm90b3R5cGVcLi8sV2U9ZnVuY3Rpb24odCxlKXt2YXIgcj1xZVtVZSh0KV07cmV0dXJuIHI9PVllfHxyIT1LZSYmKEgoZSk/ZyhlKTohIWUpfSxVZT1XZS5ub3JtYWxpemU9ZnVuY3Rpb24odCl7cmV0dXJuIFN0cmluZyh0KS5yZXBsYWNlKFZlLCIuIikudG9Mb3dlckNhc2UoKX0scWU9V2UuZGF0YT17fSxLZT1XZS5OQVRJVkU9Ik4iLFllPVdlLlBPTFlGSUxMPSJQIixYZT1XZSxKZT1rZS5mLFFlPWZ1bmN0aW9uKHQsZSl7dmFyIHIsbixvLGksdSxhPXQudGFyZ2V0LGM9dC5nbG9iYWwsZj10LnN0YXQ7aWYocj1jP3M6Zj9zW2FdfHxJKGEse30pOihzW2FdfHx7fSkucHJvdG90eXBlKWZvcihuIGluIGUpe2lmKGk9ZVtuXSxvPXQubm9UYXJnZXRHZXQ/KHU9SmUocixuKSkmJnUudmFsdWU6cltuXSwhWGUoYz9uOmErKGY/Ii4iOiIjIikrbix0LmZvcmNlZCkmJnZvaWQgMCE9PW8pe2lmKHR5cGVvZiBpPT10eXBlb2Ygbyljb250aW51ZTskZShpLG8pO30odC5zaGFtfHxvJiZvLnNoYW0pJiZ5ZShpLCJzaGFtIiwhMCksRGUocixuLGksdCk7fX0sWmU9IWcoKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe31yZXR1cm4gdC5wcm90b3R5cGUuY29uc3RydWN0b3I9bnVsbCxPYmplY3QuZ2V0UHJvdG90eXBlT2YobmV3IHQpIT09dC5wcm90b3R5cGV9KSksdHI9WHQoIklFX1BST1RPIiksZXI9cy5PYmplY3QscnI9ZXIucHJvdG90eXBlLG5yPVplP2VyLmdldFByb3RvdHlwZU9mOmZ1bmN0aW9uKHQpe3ZhciBlPU0odCk7aWYoXyhlLHRyKSlyZXR1cm4gZVt0cl07dmFyIHI9ZS5jb25zdHJ1Y3RvcjtyZXR1cm4gSChyKSYmZSBpbnN0YW5jZW9mIHI/ci5wcm90b3R5cGU6ZSBpbnN0YW5jZW9mIGVyP3JyOm51bGx9LG9yPXJ0KCJpdGVyYXRvciIpLGlyPSExO1tdLmtleXMmJigibmV4dCJpbihqZT1bXS5rZXlzKCkpPyhUZT1ucihucihqZSkpKSE9PU9iamVjdC5wcm90b3R5cGUmJihFZT1UZSk6aXI9ITApO3ZhciB1cj1udWxsPT1FZXx8ZygoZnVuY3Rpb24oKXt2YXIgdD17fTtyZXR1cm4gRWVbb3JdLmNhbGwodCkhPT10fSkpO3VyJiYoRWU9e30pLEgoRWVbb3JdKXx8RGUoRWUsb3IsKGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9KSk7dmFyIGFyPXtJdGVyYXRvclByb3RvdHlwZTpFZSxCVUdHWV9TQUZBUklfSVRFUkFUT1JTOmlyfSxjcj1QdC5mLGZyPXJ0KCJ0b1N0cmluZ1RhZyIpLGxyPWZ1bmN0aW9uKHQsZSxyKXt0JiYhXyh0PXI/dDp0LnByb3RvdHlwZSxmcikmJmNyKHQsZnIse2NvbmZpZ3VyYWJsZTohMCx2YWx1ZTplfSk7fSxzcj1hci5JdGVyYXRvclByb3RvdHlwZSxkcj1mdW5jdGlvbigpe3JldHVybiB0aGlzfSx2cj1zLlN0cmluZyxwcj1zLlR5cGVFcnJvcix5cj1PYmplY3Quc2V0UHJvdG90eXBlT2Z8fCgiX19wcm90b19fImlue30/ZnVuY3Rpb24oKXt2YXIgdCxlPSExLHI9e307dHJ5eyh0PWgoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihPYmplY3QucHJvdG90eXBlLCJfX3Byb3RvX18iKS5zZXQpKShyLFtdKSxlPXIgaW5zdGFuY2VvZiBBcnJheTt9Y2F0Y2godCl7fXJldHVybiBmdW5jdGlvbihyLG4pe3JldHVybiB1dChyKSxmdW5jdGlvbih0KXtpZigib2JqZWN0Ij09dHlwZW9mIHR8fEgodCkpcmV0dXJuIHQ7dGhyb3cgcHIoIkNhbid0IHNldCAiK3ZyKHQpKyIgYXMgYSBwcm90b3R5cGUiKX0obiksZT90KHIsbik6ci5fX3Byb3RvX189bixyfX0oKTp2b2lkIDApLGhyPXplLlBST1BFUixncj16ZS5DT05GSUdVUkFCTEUsYnI9YXIuSXRlcmF0b3JQcm90b3R5cGUsbXI9YXIuQlVHR1lfU0FGQVJJX0lURVJBVE9SUyx3cj1ydCgiaXRlcmF0b3IiKSx4cj0ia2V5cyIsU3I9InZhbHVlcyIsT3I9ImVudHJpZXMiLEVyPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9LFRyPWZ1bmN0aW9uKHQsZSxyLG4sbyxpLHUpeyFmdW5jdGlvbih0LGUscixuKXt2YXIgbz1lKyIgSXRlcmF0b3IiO3QucHJvdG90eXBlPXJlKHNyLHtuZXh0OnBlKCshbixyKX0pLGxyKHQsbywhMSksdWVbb109ZHI7fShyLGUsbik7dmFyIGEsYyxmLGw9ZnVuY3Rpb24odCl7aWYodD09PW8mJnkpcmV0dXJuIHk7aWYoIW1yJiZ0IGluIHYpcmV0dXJuIHZbdF07c3dpdGNoKHQpe2Nhc2UgeHI6Y2FzZSBTcjpjYXNlIE9yOnJldHVybiBmdW5jdGlvbigpe3JldHVybiBuZXcgcih0aGlzLHQpfX1yZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gbmV3IHIodGhpcyl9fSxzPWUrIiBJdGVyYXRvciIsZD0hMSx2PXQucHJvdG90eXBlLHA9dlt3cl18fHZbIkBAaXRlcmF0b3IiXXx8byYmdltvXSx5PSFtciYmcHx8bChvKSxoPSJBcnJheSI9PWUmJnYuZW50cmllc3x8cDtpZihoJiYoYT1ucihoLmNhbGwobmV3IHQpKSkhPT1PYmplY3QucHJvdG90eXBlJiZhLm5leHQmJihucihhKSE9PWJyJiYoeXI/eXIoYSxicik6SChhW3dyXSl8fERlKGEsd3IsRXIpKSxscihhLHMsITApKSxociYmbz09U3ImJnAmJnAubmFtZSE9PVNyJiYoZ3I/eWUodiwibmFtZSIsU3IpOihkPSEwLHk9ZnVuY3Rpb24oKXtyZXR1cm4gdnQocCx0aGlzKX0pKSxvKWlmKGM9e3ZhbHVlczpsKFNyKSxrZXlzOmk/eTpsKHhyKSxlbnRyaWVzOmwoT3IpfSx1KWZvcihmIGluIGMpKG1yfHxkfHwhKGYgaW4gdikpJiZEZSh2LGYsY1tmXSk7ZWxzZSBRZSh7dGFyZ2V0OmUscHJvdG86ITAsZm9yY2VkOm1yfHxkfSxjKTtyZXR1cm4gdlt3cl0hPT15JiZEZSh2LHdyLHkse25hbWU6b30pLHVlW2VdPXksY30sanI9IkFycmF5IEl0ZXJhdG9yIixBcj1BZS5zZXQsSXI9QWUuZ2V0dGVyRm9yKGpyKSxQcj1UcihBcnJheSwiQXJyYXkiLChmdW5jdGlvbih0LGUpe0FyKHRoaXMse3R5cGU6anIsdGFyZ2V0OmoodCksaW5kZXg6MCxraW5kOmV9KTt9KSwoZnVuY3Rpb24oKXt2YXIgdD1Jcih0aGlzKSxlPXQudGFyZ2V0LHI9dC5raW5kLG49dC5pbmRleCsrO3JldHVybiAhZXx8bj49ZS5sZW5ndGg/KHQudGFyZ2V0PXZvaWQgMCx7dmFsdWU6dm9pZCAwLGRvbmU6ITB9KToia2V5cyI9PXI/e3ZhbHVlOm4sZG9uZTohMX06InZhbHVlcyI9PXI/e3ZhbHVlOmVbbl0sZG9uZTohMX06e3ZhbHVlOltuLGVbbl1dLGRvbmU6ITF9fSksInZhbHVlcyIpO3VlLkFyZ3VtZW50cz11ZS5BcnJheSxpZSgia2V5cyIpLGllKCJ2YWx1ZXMiKSxpZSgiZW50cmllcyIpO3ZhciBScj17fTtScltydCgidG9TdHJpbmdUYWciKV09InoiO3ZhciBMcj0iW29iamVjdCB6XSI9PT1TdHJpbmcoUnIpLGtyPXJ0KCJ0b1N0cmluZ1RhZyIpLE1yPXMuT2JqZWN0LE5yPSJBcmd1bWVudHMiPT13KGZ1bmN0aW9uKCl7cmV0dXJuIGFyZ3VtZW50c30oKSksX3I9THI/dzpmdW5jdGlvbih0KXt2YXIgZSxyLG47cmV0dXJuIHZvaWQgMD09PXQ/IlVuZGVmaW5lZCI6bnVsbD09PXQ/Ik51bGwiOiJzdHJpbmciPT10eXBlb2Yocj1mdW5jdGlvbih0LGUpe3RyeXtyZXR1cm4gdFtlXX1jYXRjaCh0KXt9fShlPU1yKHQpLGtyKSk/cjpOcj93KGUpOiJPYmplY3QiPT0obj13KGUpKSYmSChlLmNhbGxlZSk/IkFyZ3VtZW50cyI6bn0senI9THI/e30udG9TdHJpbmc6ZnVuY3Rpb24oKXtyZXR1cm4gIltvYmplY3QgIitfcih0aGlzKSsiXSJ9O0xyfHxEZShPYmplY3QucHJvdG90eXBlLCJ0b1N0cmluZyIsenIse3Vuc2FmZTohMH0pO3ZhciBEcj1zLlN0cmluZyxDcj1mdW5jdGlvbih0KXtpZigiU3ltYm9sIj09PV9yKHQpKXRocm93IFR5cGVFcnJvcigiQ2Fubm90IGNvbnZlcnQgYSBTeW1ib2wgdmFsdWUgdG8gYSBzdHJpbmciKTtyZXR1cm4gRHIodCl9LEZyPWgoIiIuY2hhckF0KSxIcj1oKCIiLmNoYXJDb2RlQXQpLEJyPWgoIiIuc2xpY2UpLEdyPWZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihlLHIpe3ZhciBuLG8saT1DcihUKGUpKSx1PWt0KHIpLGE9aS5sZW5ndGg7cmV0dXJuIHU8MHx8dT49YT90PyIiOnZvaWQgMDoobj1IcihpLHUpKTw1NTI5Nnx8bj41NjMxOXx8dSsxPT09YXx8KG89SHIoaSx1KzEpKTw1NjMyMHx8bz41NzM0Mz90P0ZyKGksdSk6bjp0P0JyKGksdSx1KzIpOm8tNTYzMjArKG4tNTUyOTY8PDEwKSs2NTUzNn19LCRyPXtjb2RlQXQ6R3IoITEpLGNoYXJBdDpHcighMCl9LFZyPSRyLmNoYXJBdCxXcj0iU3RyaW5nIEl0ZXJhdG9yIixVcj1BZS5zZXQscXI9QWUuZ2V0dGVyRm9yKFdyKTtUcihTdHJpbmcsIlN0cmluZyIsKGZ1bmN0aW9uKHQpe1VyKHRoaXMse3R5cGU6V3Isc3RyaW5nOkNyKHQpLGluZGV4OjB9KTt9KSwoZnVuY3Rpb24oKXt2YXIgdCxlPXFyKHRoaXMpLHI9ZS5zdHJpbmcsbj1lLmluZGV4O3JldHVybiBuPj1yLmxlbmd0aD97dmFsdWU6dm9pZCAwLGRvbmU6ITB9Oih0PVZyKHIsbiksZS5pbmRleCs9dC5sZW5ndGgse3ZhbHVlOnQsZG9uZTohMX0pfSkpO3ZhciBLcj1mdW5jdGlvbih0LGUscil7Zm9yKHZhciBuIGluIGUpRGUodCxuLGVbbl0scik7cmV0dXJuIHR9LFlyPXMuQXJyYXksWHI9TWF0aC5tYXgsSnI9RmUuZixRcj0ib2JqZWN0Ij09dHlwZW9mIHdpbmRvdyYmd2luZG93JiZPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcz9PYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh3aW5kb3cpOltdLFpyPWZ1bmN0aW9uKHQpe3RyeXtyZXR1cm4gSnIodCl9Y2F0Y2godCl7cmV0dXJuIGZ1bmN0aW9uKHQsZSxyKXtmb3IodmFyIG4sbyxpLHUsYT1DdCh0KSxjPV90KGUsYSksZj1fdCh2b2lkIDA9PT1yP2E6cixhKSxsPVlyKFhyKGYtYywwKSkscz0wO2M8ZjtjKysscysrKW49bCxvPXMsaT10W2NdLHU9dm9pZCAwLCh1PWp0KG8pKWluIG4/UHQuZihuLHUscGUoMCxpKSk6blt1XT1pO3JldHVybiBsLmxlbmd0aD1zLGx9KFFyKX19LHRuPXtmOmZ1bmN0aW9uKHQpe3JldHVybiBRciYmIldpbmRvdyI9PXcodCk/WnIodCk6SnIoaih0KSl9fSxlbj1nKChmdW5jdGlvbigpe2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBBcnJheUJ1ZmZlcil7dmFyIHQ9bmV3IEFycmF5QnVmZmVyKDgpO09iamVjdC5pc0V4dGVuc2libGUodCkmJk9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCJhIix7dmFsdWU6OH0pO319KSkscm49T2JqZWN0LmlzRXh0ZW5zaWJsZSxubj1nKChmdW5jdGlvbigpe3JuKDEpO30pKXx8ZW4/ZnVuY3Rpb24odCl7cmV0dXJuICEhbnQodCkmJigoIWVufHwiQXJyYXlCdWZmZXIiIT13KHQpKSYmKCFybnx8cm4odCkpKX06cm4sb249IWcoKGZ1bmN0aW9uKCl7cmV0dXJuIE9iamVjdC5pc0V4dGVuc2libGUoT2JqZWN0LnByZXZlbnRFeHRlbnNpb25zKHt9KSl9KSksdW49YSgoZnVuY3Rpb24odCl7dmFyIGU9UHQuZixyPSExLG49RigibWV0YSIpLG89MCxpPWZ1bmN0aW9uKHQpe2UodCxuLHt2YWx1ZTp7b2JqZWN0SUQ6Ik8iK28rKyx3ZWFrRGF0YTp7fX19KTt9LHU9dC5leHBvcnRzPXtlbmFibGU6ZnVuY3Rpb24oKXt1LmVuYWJsZT1mdW5jdGlvbigpe30scj0hMDt2YXIgdD1GZS5mLGU9aChbXS5zcGxpY2UpLG89e307b1tuXT0xLHQobykubGVuZ3RoJiYoRmUuZj1mdW5jdGlvbihyKXtmb3IodmFyIG89dChyKSxpPTAsdT1vLmxlbmd0aDtpPHU7aSsrKWlmKG9baV09PT1uKXtlKG8saSwxKTticmVha31yZXR1cm4gb30sUWUoe3RhcmdldDoiT2JqZWN0IixzdGF0OiEwLGZvcmNlZDohMH0se2dldE93blByb3BlcnR5TmFtZXM6dG4uZn0pKTt9LGZhc3RLZXk6ZnVuY3Rpb24odCxlKXtpZighbnQodCkpcmV0dXJuICJzeW1ib2wiPT10eXBlb2YgdD90Oigic3RyaW5nIj09dHlwZW9mIHQ/IlMiOiJQIikrdDtpZighXyh0LG4pKXtpZighbm4odCkpcmV0dXJuICJGIjtpZighZSlyZXR1cm4gIkUiO2kodCk7fXJldHVybiB0W25dLm9iamVjdElEfSxnZXRXZWFrRGF0YTpmdW5jdGlvbih0LGUpe2lmKCFfKHQsbikpe2lmKCFubih0KSlyZXR1cm4gITA7aWYoIWUpcmV0dXJuICExO2kodCk7fXJldHVybiB0W25dLndlYWtEYXRhfSxvbkZyZWV6ZTpmdW5jdGlvbih0KXtyZXR1cm4gb24mJnImJm5uKHQpJiYhXyh0LG4pJiZpKHQpLHR9fTtCdFtuXT0hMDt9KSksYW49aChoLmJpbmQpLGNuPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIHd0KHQpLHZvaWQgMD09PWU/dDphbj9hbih0LGUpOmZ1bmN0aW9uKCl7cmV0dXJuIHQuYXBwbHkoZSxhcmd1bWVudHMpfX0sZm49cnQoIml0ZXJhdG9yIiksbG49QXJyYXkucHJvdG90eXBlLHNuPXJ0KCJpdGVyYXRvciIpLGRuPWZ1bmN0aW9uKHQpe2lmKG51bGwhPXQpcmV0dXJuIHh0KHQsc24pfHx4dCh0LCJAQGl0ZXJhdG9yIil8fHVlW19yKHQpXX0sdm49cy5UeXBlRXJyb3IscG49ZnVuY3Rpb24odCxlLHIpe3ZhciBuLG87dXQodCk7dHJ5e2lmKCEobj14dCh0LCJyZXR1cm4iKSkpe2lmKCJ0aHJvdyI9PT1lKXRocm93IHI7cmV0dXJuIHJ9bj12dChuLHQpO31jYXRjaCh0KXtvPSEwLG49dDt9aWYoInRocm93Ij09PWUpdGhyb3cgcjtpZihvKXRocm93IG47cmV0dXJuIHV0KG4pLHJ9LHluPXMuVHlwZUVycm9yLGhuPWZ1bmN0aW9uKHQsZSl7dGhpcy5zdG9wcGVkPXQsdGhpcy5yZXN1bHQ9ZTt9LGduPWhuLnByb3RvdHlwZSxibj1mdW5jdGlvbih0LGUscil7dmFyIG4sbyxpLHUsYSxjLGYsbCxzPXImJnIudGhhdCxkPSEoIXJ8fCFyLkFTX0VOVFJJRVMpLHY9ISghcnx8IXIuSVNfSVRFUkFUT1IpLHA9ISghcnx8IXIuSU5URVJSVVBURUQpLHk9Y24oZSxzKSxoPWZ1bmN0aW9uKHQpe3JldHVybiBuJiZwbihuLCJub3JtYWwiLHQpLG5ldyBobighMCx0KX0sZz1mdW5jdGlvbih0KXtyZXR1cm4gZD8odXQodCkscD95KHRbMF0sdFsxXSxoKTp5KHRbMF0sdFsxXSkpOnA/eSh0LGgpOnkodCl9O2lmKHYpbj10O2Vsc2Uge2lmKCEobz1kbih0KSkpdGhyb3cgeW4oYnQodCkrIiBpcyBub3QgaXRlcmFibGUiKTtpZih2b2lkIDAhPT0obD1vKSYmKHVlLkFycmF5PT09bHx8bG5bZm5dPT09bCkpe2ZvcihpPTAsdT1DdCh0KTt1Pmk7aSsrKWlmKChhPWcodFtpXSkpJiZwdChnbixhKSlyZXR1cm4gYTtyZXR1cm4gbmV3IGhuKCExKX1uPWZ1bmN0aW9uKHQsZSl7dmFyIHI9YXJndW1lbnRzLmxlbmd0aDwyP2RuKHQpOmU7aWYod3QocikpcmV0dXJuIHV0KHZ0KHIsdCkpO3Rocm93IHZuKGJ0KHQpKyIgaXMgbm90IGl0ZXJhYmxlIil9KHQsbyk7fWZvcihjPW4ubmV4dDshKGY9dnQoYyxuKSkuZG9uZTspe3RyeXthPWcoZi52YWx1ZSk7fWNhdGNoKHQpe3BuKG4sInRocm93Iix0KTt9aWYoIm9iamVjdCI9PXR5cGVvZiBhJiZhJiZwdChnbixhKSlyZXR1cm4gYX1yZXR1cm4gbmV3IGhuKCExKX0sbW49cy5UeXBlRXJyb3Isd249ZnVuY3Rpb24odCxlKXtpZihwdChlLHQpKXJldHVybiB0O3Rocm93IG1uKCJJbmNvcnJlY3QgaW52b2NhdGlvbiIpfSx4bj1ydCgiaXRlcmF0b3IiKSxTbj0hMTt0cnl7dmFyIE9uPTAsRW49e25leHQ6ZnVuY3Rpb24oKXtyZXR1cm4ge2RvbmU6ISFPbisrfX0scmV0dXJuOmZ1bmN0aW9uKCl7U249ITA7fX07RW5beG5dPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9LEFycmF5LmZyb20oRW4sKGZ1bmN0aW9uKCl7dGhyb3cgMn0pKTt9Y2F0Y2godCl7fXZhciBUbj1BcnJheS5pc0FycmF5fHxmdW5jdGlvbih0KXtyZXR1cm4gIkFycmF5Ij09dyh0KX0sam49ZnVuY3Rpb24oKXt9LEFuPVtdLEluPUcoIlJlZmxlY3QiLCJjb25zdHJ1Y3QiKSxQbj0vXlxzKig/OmNsYXNzfGZ1bmN0aW9uKVxiLyxSbj1oKFBuLmV4ZWMpLExuPSFQbi5leGVjKGpuKSxrbj1mdW5jdGlvbih0KXtpZighSCh0KSlyZXR1cm4gITE7dHJ5e3JldHVybiBJbihqbixBbix0KSwhMH1jYXRjaCh0KXtyZXR1cm4gITF9fSxNbj0hSW58fGcoKGZ1bmN0aW9uKCl7dmFyIHQ7cmV0dXJuIGtuKGtuLmNhbGwpfHwha24oT2JqZWN0KXx8IWtuKChmdW5jdGlvbigpe3Q9ITA7fSkpfHx0fSkpP2Z1bmN0aW9uKHQpe2lmKCFIKHQpKXJldHVybiAhMTtzd2l0Y2goX3IodCkpe2Nhc2UiQXN5bmNGdW5jdGlvbiI6Y2FzZSJHZW5lcmF0b3JGdW5jdGlvbiI6Y2FzZSJBc3luY0dlbmVyYXRvckZ1bmN0aW9uIjpyZXR1cm4gITF9cmV0dXJuIExufHwhIVJuKFBuLHNlKHQpKX06a24sTm49cnQoInNwZWNpZXMiKSxfbj1zLkFycmF5LHpuPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIG5ldyhmdW5jdGlvbih0KXt2YXIgZTtyZXR1cm4gVG4odCkmJihlPXQuY29uc3RydWN0b3IsKE1uKGUpJiYoZT09PV9ufHxUbihlLnByb3RvdHlwZSkpfHxudChlKSYmbnVsbD09PShlPWVbTm5dKSkmJihlPXZvaWQgMCkpLHZvaWQgMD09PWU/X246ZX0odCkpKDA9PT1lPzA6ZSl9LERuPWgoW10ucHVzaCksQ249ZnVuY3Rpb24odCl7dmFyIGU9MT09dCxyPTI9PXQsbj0zPT10LG89ND09dCxpPTY9PXQsdT03PT10LGE9NT09dHx8aTtyZXR1cm4gZnVuY3Rpb24oYyxmLGwscyl7Zm9yKHZhciBkLHYscD1NKGMpLHk9TyhwKSxoPWNuKGYsbCksZz1DdCh5KSxiPTAsbT1zfHx6bix3PWU/bShjLGcpOnJ8fHU/bShjLDApOnZvaWQgMDtnPmI7YisrKWlmKChhfHxiIGluIHkpJiYodj1oKGQ9eVtiXSxiLHApLHQpKWlmKGUpd1tiXT12O2Vsc2UgaWYodilzd2l0Y2godCl7Y2FzZSAzOnJldHVybiAhMDtjYXNlIDU6cmV0dXJuIGQ7Y2FzZSA2OnJldHVybiBiO2Nhc2UgMjpEbih3LGQpO31lbHNlIHN3aXRjaCh0KXtjYXNlIDQ6cmV0dXJuICExO2Nhc2UgNzpEbih3LGQpO31yZXR1cm4gaT8tMTpufHxvP286d319LEZuPXtmb3JFYWNoOkNuKDApLG1hcDpDbigxKSxmaWx0ZXI6Q24oMiksc29tZTpDbigzKSxldmVyeTpDbig0KSxmaW5kOkNuKDUpLGZpbmRJbmRleDpDbig2KSxmaWx0ZXJSZWplY3Q6Q24oNyl9LEhuPXVuLmdldFdlYWtEYXRhLEJuPUFlLnNldCxHbj1BZS5nZXR0ZXJGb3IsJG49Rm4uZmluZCxWbj1Gbi5maW5kSW5kZXgsV249aChbXS5zcGxpY2UpLFVuPTAscW49ZnVuY3Rpb24odCl7cmV0dXJuIHQuZnJvemVufHwodC5mcm96ZW49bmV3IEtuKX0sS249ZnVuY3Rpb24oKXt0aGlzLmVudHJpZXM9W107fSxZbj1mdW5jdGlvbih0LGUpe3JldHVybiAkbih0LmVudHJpZXMsKGZ1bmN0aW9uKHQpe3JldHVybiB0WzBdPT09ZX0pKX07S24ucHJvdG90eXBlPXtnZXQ6ZnVuY3Rpb24odCl7dmFyIGU9WW4odGhpcyx0KTtpZihlKXJldHVybiBlWzFdfSxoYXM6ZnVuY3Rpb24odCl7cmV0dXJuICEhWW4odGhpcyx0KX0sc2V0OmZ1bmN0aW9uKHQsZSl7dmFyIHI9WW4odGhpcyx0KTtyP3JbMV09ZTp0aGlzLmVudHJpZXMucHVzaChbdCxlXSk7fSxkZWxldGU6ZnVuY3Rpb24odCl7dmFyIGU9Vm4odGhpcy5lbnRyaWVzLChmdW5jdGlvbihlKXtyZXR1cm4gZVswXT09PXR9KSk7cmV0dXJuIH5lJiZXbih0aGlzLmVudHJpZXMsZSwxKSwhIX5lfX07dmFyIFhuLEpuPXtnZXRDb25zdHJ1Y3RvcjpmdW5jdGlvbih0LGUscixuKXt2YXIgbz10KChmdW5jdGlvbih0LG8pe3duKHQsaSksQm4odCx7dHlwZTplLGlkOlVuKyssZnJvemVuOnZvaWQgMH0pLG51bGwhPW8mJmJuKG8sdFtuXSx7dGhhdDp0LEFTX0VOVFJJRVM6cn0pO30pKSxpPW8ucHJvdG90eXBlLHU9R24oZSksYT1mdW5jdGlvbih0LGUscil7dmFyIG49dSh0KSxvPUhuKHV0KGUpLCEwKTtyZXR1cm4gITA9PT1vP3FuKG4pLnNldChlLHIpOm9bbi5pZF09cix0fTtyZXR1cm4gS3IoaSx7ZGVsZXRlOmZ1bmN0aW9uKHQpe3ZhciBlPXUodGhpcyk7aWYoIW50KHQpKXJldHVybiAhMTt2YXIgcj1Ibih0KTtyZXR1cm4gITA9PT1yP3FuKGUpLmRlbGV0ZSh0KTpyJiZfKHIsZS5pZCkmJmRlbGV0ZSByW2UuaWRdfSxoYXM6ZnVuY3Rpb24odCl7dmFyIGU9dSh0aGlzKTtpZighbnQodCkpcmV0dXJuICExO3ZhciByPUhuKHQpO3JldHVybiAhMD09PXI/cW4oZSkuaGFzKHQpOnImJl8ocixlLmlkKX19KSxLcihpLHI/e2dldDpmdW5jdGlvbih0KXt2YXIgZT11KHRoaXMpO2lmKG50KHQpKXt2YXIgcj1Ibih0KTtyZXR1cm4gITA9PT1yP3FuKGUpLmdldCh0KTpyP3JbZS5pZF06dm9pZCAwfX0sc2V0OmZ1bmN0aW9uKHQsZSl7cmV0dXJuIGEodGhpcyx0LGUpfX06e2FkZDpmdW5jdGlvbih0KXtyZXR1cm4gYSh0aGlzLHQsITApfX0pLG99fSxRbj1BZS5lbmZvcmNlLFpuPSFzLkFjdGl2ZVhPYmplY3QmJiJBY3RpdmVYT2JqZWN0ImluIHMsdG89ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIHQodGhpcyxhcmd1bWVudHMubGVuZ3RoP2FyZ3VtZW50c1swXTp2b2lkIDApfX0sZW89ZnVuY3Rpb24odCxlLHIpe3ZhciBuPS0xIT09dC5pbmRleE9mKCJNYXAiKSxvPS0xIT09dC5pbmRleE9mKCJXZWFrIiksaT1uPyJzZXQiOiJhZGQiLHU9c1t0XSxhPXUmJnUucHJvdG90eXBlLGM9dSxmPXt9LGw9ZnVuY3Rpb24odCl7dmFyIGU9aChhW3RdKTtEZShhLHQsImFkZCI9PXQ/ZnVuY3Rpb24odCl7cmV0dXJuIGUodGhpcywwPT09dD8wOnQpLHRoaXN9OiJkZWxldGUiPT10P2Z1bmN0aW9uKHQpe3JldHVybiAhKG8mJiFudCh0KSkmJmUodGhpcywwPT09dD8wOnQpfToiZ2V0Ij09dD9mdW5jdGlvbih0KXtyZXR1cm4gbyYmIW50KHQpP3ZvaWQgMDplKHRoaXMsMD09PXQ/MDp0KX06ImhhcyI9PXQ/ZnVuY3Rpb24odCl7cmV0dXJuICEobyYmIW50KHQpKSYmZSh0aGlzLDA9PT10PzA6dCl9OmZ1bmN0aW9uKHQscil7cmV0dXJuIGUodGhpcywwPT09dD8wOnQsciksdGhpc30pO307aWYoWGUodCwhSCh1KXx8IShvfHxhLmZvckVhY2gmJiFnKChmdW5jdGlvbigpeyhuZXcgdSkuZW50cmllcygpLm5leHQoKTt9KSkpKSljPXIuZ2V0Q29uc3RydWN0b3IoZSx0LG4saSksdW4uZW5hYmxlKCk7ZWxzZSBpZihYZSh0LCEwKSl7dmFyIGQ9bmV3IGMsdj1kW2ldKG8/e306LTAsMSkhPWQscD1nKChmdW5jdGlvbigpe2QuaGFzKDEpO30pKSx5PWZ1bmN0aW9uKHQsZSl7aWYoIWUmJiFTbilyZXR1cm4gITE7dmFyIHI9ITE7dHJ5e3ZhciBuPXt9O25beG5dPWZ1bmN0aW9uKCl7cmV0dXJuIHtuZXh0OmZ1bmN0aW9uKCl7cmV0dXJuIHtkb25lOnI9ITB9fX19LHQobik7fWNhdGNoKHQpe31yZXR1cm4gcn0oKGZ1bmN0aW9uKHQpe25ldyB1KHQpO30pKSxiPSFvJiZnKChmdW5jdGlvbigpe2Zvcih2YXIgdD1uZXcgdSxlPTU7ZS0tOyl0W2ldKGUsZSk7cmV0dXJuICF0LmhhcygtMCl9KSk7eXx8KChjPWUoKGZ1bmN0aW9uKHQsZSl7d24odCxhKTt2YXIgcj1mdW5jdGlvbih0LGUscil7dmFyIG4sbztyZXR1cm4geXImJkgobj1lLmNvbnN0cnVjdG9yKSYmbiE9PXImJm50KG89bi5wcm90b3R5cGUpJiZvIT09ci5wcm90b3R5cGUmJnlyKHQsbyksdH0obmV3IHUsdCxjKTtyZXR1cm4gbnVsbCE9ZSYmYm4oZSxyW2ldLHt0aGF0OnIsQVNfRU5UUklFUzpufSkscn0pKSkucHJvdG90eXBlPWEsYS5jb25zdHJ1Y3Rvcj1jKSwocHx8YikmJihsKCJkZWxldGUiKSxsKCJoYXMiKSxuJiZsKCJnZXQiKSksKGJ8fHYpJiZsKGkpLG8mJmEuY2xlYXImJmRlbGV0ZSBhLmNsZWFyO31yZXR1cm4gZlt0XT1jLFFlKHtnbG9iYWw6ITAsZm9yY2VkOmMhPXV9LGYpLGxyKGMsdCksb3x8ci5zZXRTdHJvbmcoYyx0LG4pLGN9KCJXZWFrTWFwIix0byxKbik7aWYodmUmJlpuKXtYbj1Kbi5nZXRDb25zdHJ1Y3Rvcih0bywiV2Vha01hcCIsITApLHVuLmVuYWJsZSgpO3ZhciBybz1lby5wcm90b3R5cGUsbm89aChyby5kZWxldGUpLG9vPWgocm8uaGFzKSxpbz1oKHJvLmdldCksdW89aChyby5zZXQpO0tyKHJvLHtkZWxldGU6ZnVuY3Rpb24odCl7aWYobnQodCkmJiFubih0KSl7dmFyIGU9UW4odGhpcyk7cmV0dXJuIGUuZnJvemVufHwoZS5mcm96ZW49bmV3IFhuKSxubyh0aGlzLHQpfHxlLmZyb3plbi5kZWxldGUodCl9cmV0dXJuIG5vKHRoaXMsdCl9LGhhczpmdW5jdGlvbih0KXtpZihudCh0KSYmIW5uKHQpKXt2YXIgZT1Rbih0aGlzKTtyZXR1cm4gZS5mcm96ZW58fChlLmZyb3plbj1uZXcgWG4pLG9vKHRoaXMsdCl8fGUuZnJvemVuLmhhcyh0KX1yZXR1cm4gb28odGhpcyx0KX0sZ2V0OmZ1bmN0aW9uKHQpe2lmKG50KHQpJiYhbm4odCkpe3ZhciBlPVFuKHRoaXMpO3JldHVybiBlLmZyb3plbnx8KGUuZnJvemVuPW5ldyBYbiksb28odGhpcyx0KT9pbyh0aGlzLHQpOmUuZnJvemVuLmdldCh0KX1yZXR1cm4gaW8odGhpcyx0KX0sc2V0OmZ1bmN0aW9uKHQsZSl7aWYobnQodCkmJiFubih0KSl7dmFyIHI9UW4odGhpcyk7ci5mcm96ZW58fChyLmZyb3plbj1uZXcgWG4pLG9vKHRoaXMsdCk/dW8odGhpcyx0LGUpOnIuZnJvemVuLnNldCh0LGUpO31lbHNlIHVvKHRoaXMsdCxlKTtyZXR1cm4gdGhpc319KTt9dmFyIGFvPXtDU1NSdWxlTGlzdDowLENTU1N0eWxlRGVjbGFyYXRpb246MCxDU1NWYWx1ZUxpc3Q6MCxDbGllbnRSZWN0TGlzdDowLERPTVJlY3RMaXN0OjAsRE9NU3RyaW5nTGlzdDowLERPTVRva2VuTGlzdDoxLERhdGFUcmFuc2Zlckl0ZW1MaXN0OjAsRmlsZUxpc3Q6MCxIVE1MQWxsQ29sbGVjdGlvbjowLEhUTUxDb2xsZWN0aW9uOjAsSFRNTEZvcm1FbGVtZW50OjAsSFRNTFNlbGVjdEVsZW1lbnQ6MCxNZWRpYUxpc3Q6MCxNaW1lVHlwZUFycmF5OjAsTmFtZWROb2RlTWFwOjAsTm9kZUxpc3Q6MSxQYWludFJlcXVlc3RMaXN0OjAsUGx1Z2luOjAsUGx1Z2luQXJyYXk6MCxTVkdMZW5ndGhMaXN0OjAsU1ZHTnVtYmVyTGlzdDowLFNWR1BhdGhTZWdMaXN0OjAsU1ZHUG9pbnRMaXN0OjAsU1ZHU3RyaW5nTGlzdDowLFNWR1RyYW5zZm9ybUxpc3Q6MCxTb3VyY2VCdWZmZXJMaXN0OjAsU3R5bGVTaGVldExpc3Q6MCxUZXh0VHJhY2tDdWVMaXN0OjAsVGV4dFRyYWNrTGlzdDowLFRvdWNoTGlzdDowfSxjbz1sdCgic3BhbiIpLmNsYXNzTGlzdCxmbz1jbyYmY28uY29uc3RydWN0b3ImJmNvLmNvbnN0cnVjdG9yLnByb3RvdHlwZSxsbz1mbz09PU9iamVjdC5wcm90b3R5cGU/dm9pZCAwOmZvLHNvPXJ0KCJpdGVyYXRvciIpLHZvPXJ0KCJ0b1N0cmluZ1RhZyIpLHBvPVByLnZhbHVlcyx5bz1mdW5jdGlvbih0LGUpe2lmKHQpe2lmKHRbc29dIT09cG8pdHJ5e3llKHQsc28scG8pO31jYXRjaChlKXt0W3NvXT1wbzt9aWYodFt2b118fHllKHQsdm8sZSksYW9bZV0pZm9yKHZhciByIGluIFByKWlmKHRbcl0hPT1QcltyXSl0cnl7eWUodCxyLFByW3JdKTt9Y2F0Y2goZSl7dFtyXT1QcltyXTt9fX07Zm9yKHZhciBobyBpbiBhbyl5byhzW2hvXSYmc1tob10ucHJvdG90eXBlLGhvKTt5byhsbywiRE9NVG9rZW5MaXN0Iik7dmFyIGdvPW5ldyBXZWFrTWFwO3ZhciBibz17dHlwZToibGlzdC1pdGVtIixyZW5kZXJFbGVtOmZ1bmN0aW9uKG4sbyxpKXtnby5zZXQobixpKTt2YXIgdT1uLGE9dS5sZXZlbCxjPXZvaWQgMD09PWE/MDphLGY9dS5vcmRlcmVkLGw9e21hcmdpbjoiNXB4IDAgNXB4ICIrMjAqYysicHgifSxzPSIiO2lmKHZvaWQgMCE9PWYmJmYpe3ZhciBkPWZ1bmN0aW9uKHIsbil7dmFyIG89bixpPW8udHlwZSx1PW8ubGV2ZWwsYT12b2lkIDA9PT11PzA6dSxjPW8ub3JkZXJlZCxmPXZvaWQgMCE9PWMmJmM7aWYoIWYpcmV0dXJuIC0xO3ZhciBsPTEscz1uLGQ9dC5Eb21FZGl0b3IuZmluZFBhdGgocixzKTtpZigwPT09ZFswXSlyZXR1cm4gMTtmb3IoO2RbMF0+MDspe3ZhciB2PWUuUGF0aC5wcmV2aW91cyhkKSxwPWUuRWRpdG9yLm5vZGUocix2KTtpZihudWxsPT1wKWJyZWFrO3ZhciB5PXBbMF0saD15LmxldmVsLGc9dm9pZCAwPT09aD8wOmgsYj15LnR5cGUsbT15Lm9yZGVyZWQ7aWYoYiE9PWkpYnJlYWs7aWYoZzxhKWJyZWFrO2lmKGc9PT1hKXtpZihtIT09ZilicmVhaztsKys7fXM9eSxkPXY7fXJldHVybiBsfShpLG4pO3M9ZCsiLiI7fWVsc2Ugcz1mdW5jdGlvbih0KXt2b2lkIDA9PT10JiYodD0wKTt2YXIgZT0iIjtzd2l0Y2godCl7Y2FzZSAwOmU9IuKAoiI7YnJlYWs7Y2FzZSAxOmU9IuKXpiI7YnJlYWs7ZGVmYXVsdDplPSLilqoiO31yZXR1cm4gZX0oYyk7dmFyIHY9ZnVuY3Rpb24odCl7dmFyIHIsbj10LmNoaWxkcmVufHxbXSxvPW4ubGVuZ3RoO2lmKDA9PT1vKXJldHVybiAiIjtmb3IodmFyIGk9MDtpPG8mJiFyO2krKyl7dmFyIHU9bltpXTtlLlRleHQuaXNUZXh0KHUpJiYocj11KTt9cmV0dXJuIG51bGw9PXI/IiI6ci5jb2xvcnx8IiJ9KG4pO3JldHVybiByLmpzeCgiZGl2Iix7c3R5bGU6bH0sci5qc3goInNwYW4iLHtjb250ZW50RWRpdGFibGU6ITEsc3R5bGU6e21hcmdpblJpZ2h0OiIwLjVlbSIsY29sb3I6dn0sImRhdGEtdy1lLXJlc2VydmUiOiEwfSxzKSxyLmpzeCgic3BhbiIsbnVsbCxvKSl9fSxtbz1mdW5jdGlvbih0LGUpe3JldHVybiBtbz1PYmplY3Quc2V0UHJvdG90eXBlT2Z8fHtfX3Byb3RvX186W119aW5zdGFuY2VvZiBBcnJheSYmZnVuY3Rpb24odCxlKXt0Ll9fcHJvdG9fXz1lO318fGZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByIGluIGUpT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUscikmJih0W3JdPWVbcl0pO30sbW8odCxlKX07CiAgLyohICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4KCiAgICBQZXJtaXNzaW9uIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBhbmQvb3IgZGlzdHJpYnV0ZSB0aGlzIHNvZnR3YXJlIGZvciBhbnkKICAgIHB1cnBvc2Ugd2l0aCBvciB3aXRob3V0IGZlZSBpcyBoZXJlYnkgZ3JhbnRlZC4KCiAgICBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiBBTkQgVEhFIEFVVEhPUiBESVNDTEFJTVMgQUxMIFdBUlJBTlRJRVMgV0lUSAogICAgUkVHQVJEIFRPIFRISVMgU09GVFdBUkUgSU5DTFVESU5HIEFMTCBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZCiAgICBBTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsCiAgICBJTkRJUkVDVCwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIE9SIEFOWSBEQU1BR0VTIFdIQVRTT0VWRVIgUkVTVUxUSU5HIEZST00KICAgIExPU1MgT0YgVVNFLCBEQVRBIE9SIFBST0ZJVFMsIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBORUdMSUdFTkNFIE9SCiAgICBPVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SCiAgICBQRVJGT1JNQU5DRSBPRiBUSElTIFNPRlRXQVJFLgogICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKi9mdW5jdGlvbiB3byh0LGUpe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiBlJiZudWxsIT09ZSl0aHJvdyBuZXcgVHlwZUVycm9yKCJDbGFzcyBleHRlbmRzIHZhbHVlICIrU3RyaW5nKGUpKyIgaXMgbm90IGEgY29uc3RydWN0b3Igb3IgbnVsbCIpO2Z1bmN0aW9uIHIoKXt0aGlzLmNvbnN0cnVjdG9yPXQ7fW1vKHQsZSksdC5wcm90b3R5cGU9bnVsbD09PWU/T2JqZWN0LmNyZWF0ZShlKTooci5wcm90b3R5cGU9ZS5wcm90b3R5cGUsbmV3IHIpO31mdW5jdGlvbiB4byh0KXt2YXIgZT0iZnVuY3Rpb24iPT10eXBlb2YgU3ltYm9sJiZTeW1ib2wuaXRlcmF0b3Iscj1lJiZ0W2VdLG49MDtpZihyKXJldHVybiByLmNhbGwodCk7aWYodCYmIm51bWJlciI9PXR5cGVvZiB0Lmxlbmd0aClyZXR1cm4ge25leHQ6ZnVuY3Rpb24oKXtyZXR1cm4gdCYmbj49dC5sZW5ndGgmJih0PXZvaWQgMCkse3ZhbHVlOnQmJnRbbisrXSxkb25lOiF0fX19O3Rocm93IG5ldyBUeXBlRXJyb3IoZT8iT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iOiJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIil9ZnVuY3Rpb24gU28odCxlKXt2YXIgcj0iZnVuY3Rpb24iPT10eXBlb2YgU3ltYm9sJiZ0W1N5bWJvbC5pdGVyYXRvcl07aWYoIXIpcmV0dXJuIHQ7dmFyIG4sbyxpPXIuY2FsbCh0KSx1PVtdO3RyeXtmb3IoOyh2b2lkIDA9PT1lfHxlLS0gPjApJiYhKG49aS5uZXh0KCkpLmRvbmU7KXUucHVzaChuLnZhbHVlKTt9Y2F0Y2godCl7bz17ZXJyb3I6dH07fWZpbmFsbHl7dHJ5e24mJiFuLmRvbmUmJihyPWkucmV0dXJuKSYmci5jYWxsKGkpO31maW5hbGx5e2lmKG8pdGhyb3cgby5lcnJvcn19cmV0dXJuIHV9ZnVuY3Rpb24gT28ocil7cmV0dXJuIGUuRWRpdG9yLm5vZGVzKHIse2F0OnIuc2VsZWN0aW9ufHx2b2lkIDAsbWF0Y2g6ZnVuY3Rpb24oZSl7cmV0dXJuIDE9PT10LkRvbUVkaXRvci5maW5kUGF0aChyLGUpLmxlbmd0aH19KX12YXIgRW89SHQuaW5jbHVkZXM7UWUoe3RhcmdldDoiQXJyYXkiLHByb3RvOiEwfSx7aW5jbHVkZXM6ZnVuY3Rpb24odCl7cmV0dXJuIEVvKHRoaXMsdCxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCl9fSksaWUoImluY2x1ZGVzIik7dmFyIFRvLGpvLEFvPWZ1bmN0aW9uKCl7dmFyIHQ9dXQodGhpcyksZT0iIjtyZXR1cm4gdC5nbG9iYWwmJihlKz0iZyIpLHQuaWdub3JlQ2FzZSYmKGUrPSJpIiksdC5tdWx0aWxpbmUmJihlKz0ibSIpLHQuZG90QWxsJiYoZSs9InMiKSx0LnVuaWNvZGUmJihlKz0idSIpLHQuc3RpY2t5JiYoZSs9InkiKSxlfSxJbz1zLlJlZ0V4cCxQbz1nKChmdW5jdGlvbigpe3ZhciB0PUlvKCJhIiwieSIpO3JldHVybiB0Lmxhc3RJbmRleD0yLG51bGwhPXQuZXhlYygiYWJjZCIpfSkpLFJvPVBvfHxnKChmdW5jdGlvbigpe3JldHVybiAhSW8oImEiLCJ5Iikuc3RpY2t5fSkpLExvPXtCUk9LRU5fQ0FSRVQ6UG98fGcoKGZ1bmN0aW9uKCl7dmFyIHQ9SW8oIl5yIiwiZ3kiKTtyZXR1cm4gdC5sYXN0SW5kZXg9MixudWxsIT10LmV4ZWMoInN0ciIpfSkpLE1JU1NFRF9TVElDS1k6Um8sVU5TVVBQT1JURURfWTpQb30sa289cy5SZWdFeHAsTW89ZygoZnVuY3Rpb24oKXt2YXIgdD1rbygiLiIsInMiKTtyZXR1cm4gISh0LmRvdEFsbCYmdC5leGVjKCJcbiIpJiYicyI9PT10LmZsYWdzKX0pKSxObz1zLlJlZ0V4cCxfbz1nKChmdW5jdGlvbigpe3ZhciB0PU5vKCIoPzxhPmIpIiwiZyIpO3JldHVybiAiYiIhPT10LmV4ZWMoImIiKS5ncm91cHMuYXx8ImJjIiE9PSJiIi5yZXBsYWNlKHQsIiQ8YT5jIil9KSksem89QWUuZ2V0LERvPUwoIm5hdGl2ZS1zdHJpbmctcmVwbGFjZSIsU3RyaW5nLnByb3RvdHlwZS5yZXBsYWNlKSxDbz1SZWdFeHAucHJvdG90eXBlLmV4ZWMsRm89Q28sSG89aCgiIi5jaGFyQXQpLEJvPWgoIiIuaW5kZXhPZiksR289aCgiIi5yZXBsYWNlKSwkbz1oKCIiLnNsaWNlKSxWbz0oam89L2IqL2csdnQoQ28sVG89L2EvLCJhIiksdnQoQ28sam8sImEiKSwwIT09VG8ubGFzdEluZGV4fHwwIT09am8ubGFzdEluZGV4KSxXbz1Mby5CUk9LRU5fQ0FSRVQsVW89dm9pZCAwIT09LygpPz8vLmV4ZWMoIiIpWzFdOyhWb3x8VW98fFdvfHxNb3x8X28pJiYoRm89ZnVuY3Rpb24odCl7dmFyIGUscixuLG8saSx1LGEsYz10aGlzLGY9em8oYyksbD1Dcih0KSxzPWYucmF3O2lmKHMpcmV0dXJuIHMubGFzdEluZGV4PWMubGFzdEluZGV4LGU9dnQoRm8scyxsKSxjLmxhc3RJbmRleD1zLmxhc3RJbmRleCxlO3ZhciBkPWYuZ3JvdXBzLHY9V28mJmMuc3RpY2t5LHA9dnQoQW8sYykseT1jLnNvdXJjZSxoPTAsZz1sO2lmKHYmJihwPUdvKHAsInkiLCIiKSwtMT09PUJvKHAsImciKSYmKHArPSJnIiksZz0kbyhsLGMubGFzdEluZGV4KSxjLmxhc3RJbmRleD4wJiYoIWMubXVsdGlsaW5lfHxjLm11bHRpbGluZSYmIlxuIiE9PUhvKGwsYy5sYXN0SW5kZXgtMSkpJiYoeT0iKD86ICIreSsiKSIsZz0iICIrZyxoKyspLHI9bmV3IFJlZ0V4cCgiXig/OiIreSsiKSIscCkpLFVvJiYocj1uZXcgUmVnRXhwKCJeIit5KyIkKD8hXFxzKSIscCkpLFZvJiYobj1jLmxhc3RJbmRleCksbz12dChDbyx2P3I6YyxnKSx2P28/KG8uaW5wdXQ9JG8oby5pbnB1dCxoKSxvWzBdPSRvKG9bMF0saCksby5pbmRleD1jLmxhc3RJbmRleCxjLmxhc3RJbmRleCs9b1swXS5sZW5ndGgpOmMubGFzdEluZGV4PTA6Vm8mJm8mJihjLmxhc3RJbmRleD1jLmdsb2JhbD9vLmluZGV4K29bMF0ubGVuZ3RoOm4pLFVvJiZvJiZvLmxlbmd0aD4xJiZ2dChEbyxvWzBdLHIsKGZ1bmN0aW9uKCl7Zm9yKGk9MTtpPGFyZ3VtZW50cy5sZW5ndGgtMjtpKyspdm9pZCAwPT09YXJndW1lbnRzW2ldJiYob1tpXT12b2lkIDApO30pKSxvJiZkKWZvcihvLmdyb3Vwcz11PXJlKG51bGwpLGk9MDtpPGQubGVuZ3RoO2krKyl1WyhhPWRbaV0pWzBdXT1vW2FbMV1dO3JldHVybiBvfSk7dmFyIHFvPUZvO1FlKHt0YXJnZXQ6IlJlZ0V4cCIscHJvdG86ITAsZm9yY2VkOi8uLy5leGVjIT09cW99LHtleGVjOnFvfSk7dmFyIEtvPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gcigpe3RoaXMudHlwZT0ibGlzdC1pdGVtIix0aGlzLnRhZz0iYnV0dG9uIjt9cmV0dXJuIHIucHJvdG90eXBlLmdldExpc3ROb2RlPWZ1bmN0aW9uKGUpe3ZhciByPXRoaXMudHlwZTtyZXR1cm4gdC5Eb21FZGl0b3IuZ2V0U2VsZWN0ZWROb2RlQnlUeXBlKGUscil9LHIucHJvdG90eXBlLmdldFZhbHVlPWZ1bmN0aW9uKHQpe3JldHVybiAiIn0sci5wcm90b3R5cGUuaXNBY3RpdmU9ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5nZXRMaXN0Tm9kZSh0KTtpZihudWxsPT1lKXJldHVybiAhMTt2YXIgcj1lLm9yZGVyZWQ7cmV0dXJuICh2b2lkIDAhPT1yJiZyKT09PXRoaXMub3JkZXJlZH0sci5wcm90b3R5cGUuaXNEaXNhYmxlZD1mdW5jdGlvbihyKXtyZXR1cm4gbnVsbD09ci5zZWxlY3Rpb258fCEhdC5Eb21FZGl0b3IuZ2V0U2VsZWN0ZWRFbGVtcyhyKS5zb21lKChmdW5jdGlvbih0KXtpZihlLkVkaXRvci5pc1ZvaWQocix0KSYmZS5FZGl0b3IuaXNCbG9jayhyLHQpKXJldHVybiAhMDt2YXIgbj10LnR5cGU7cmV0dXJuICEhWyJwcmUiLCJjb2RlIiwidGFibGUiXS5pbmNsdWRlcyhuKXx8dm9pZCAwfSkpfSxyLnByb3RvdHlwZS5leGVjPWZ1bmN0aW9uKHQscil7dGhpcy5pc0FjdGl2ZSh0KT9lLlRyYW5zZm9ybXMuc2V0Tm9kZXModCx7dHlwZToicGFyYWdyYXBoIixvcmRlcmVkOnZvaWQgMCxsZXZlbDp2b2lkIDB9KTplLlRyYW5zZm9ybXMuc2V0Tm9kZXModCx7dHlwZToibGlzdC1pdGVtIixvcmRlcmVkOnRoaXMub3JkZXJlZCxpbmRlbnQ6dm9pZCAwfSk7fSxyfSgpLFlvPSc8c3ZnIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik0zODQgNjRoNjQwdjEyOEgzODRWNjR6IG0wIDM4NGg2NDB2MTI4SDM4NHYtMTI4eiBtMCAzODRoNjQwdjEyOEgzODR2LTEyOHpNMCAxMjhhMTI4IDEyOCAwIDEgMSAyNTYgMCAxMjggMTI4IDAgMCAxLTI1NiAweiBtMCAzODRhMTI4IDEyOCAwIDEgMSAyNTYgMCAxMjggMTI4IDAgMCAxLTI1NiAweiBtMCAzODRhMTI4IDEyOCAwIDEgMSAyNTYgMCAxMjggMTI4IDAgMCAxLTI1NiAweiI+PC9wYXRoPjwvc3ZnPicsWG89Jzxzdmcgdmlld0JveD0iMCAwIDEwMjQgMTAyNCI+PHBhdGggZD0iTTM4NCA4MzJoNjQwdjEyOEgzODR6IG0wLTM4NGg2NDB2MTI4SDM4NHogbTAtMzg0aDY0MHYxMjhIMzg0ek0xOTIgMHYyNTZIMTI4VjY0SDY0VjB6TTEyOCA1MjYuMDE2djUwLjAxNmgxMjh2NjRINjR2LTE0Ni4wMTZsMTI4LTYwVjM4NEg2NHYtNjRoMTkydjE0Ni4wMTZ6TTI1NiA3MDR2MzIwSDY0di02NGgxMjh2LTY0SDY0di02NGgxMjh2LTY0SDY0di02NHoiPjwvcGF0aD48L3N2Zz4nLEpvPWZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHIoKXt2YXIgcj1udWxsIT09ZSYmZS5hcHBseSh0aGlzLGFyZ3VtZW50cyl8fHRoaXM7cmV0dXJuIHIub3JkZXJlZD0hMSxyLnRpdGxlPXQudCgibGlzdE1vZHVsZS51bk9yZGVyZWRMaXN0Iiksci5pY29uU3ZnPVlvLHJ9cmV0dXJuIHdvKHIsZSkscn0oS28pLFFvPWZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHIoKXt2YXIgcj1udWxsIT09ZSYmZS5hcHBseSh0aGlzLGFyZ3VtZW50cyl8fHRoaXM7cmV0dXJuIHIub3JkZXJlZD0hMCxyLnRpdGxlPXQudCgibGlzdE1vZHVsZS5vcmRlcmVkTGlzdCIpLHIuaWNvblN2Zz1YbyxyfXJldHVybiB3byhyLGUpLHJ9KEtvKSxabz17a2V5OiJidWxsZXRlZExpc3QiLGZhY3Rvcnk6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IEpvfX0sdGk9e2tleToibnVtYmVyZWRMaXN0IixmYWN0b3J5OmZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBRb319O3ZhciBlaT1bXTt2YXIgcmksbmk9e3R5cGU6Imxpc3QtaXRlbSIsZWxlbVRvSHRtbDpmdW5jdGlvbihyLG4pe3ZhciBvPSIiLGk9IiIsdT1yLm9yZGVyZWQsYT12b2lkIDAhPT11JiZ1PyJvbCI6InVsIixjPWZ1bmN0aW9uKHIpe3ZhciBuPWdvLmdldChyKTtpZihudWxsPT1uKXJldHVybiAwO3ZhciBvPXIsaT1vLnR5cGUsdT1vLm9yZGVyZWQsYT12b2lkIDAhPT11JiZ1LGM9by5sZXZlbCxmPXZvaWQgMD09PWM/MDpjLGw9dC5Eb21FZGl0b3IuZmluZFBhdGgobixyKTtpZigwPT09bFswXSlyZXR1cm4gZisxO3ZhciBzPWUuUGF0aC5wcmV2aW91cyhsKSxkPWUuRWRpdG9yLm5vZGUobixzKTtpZighZClyZXR1cm4gMDt2YXIgdj1TbyhkLDEpWzBdO2lmKHQuRG9tRWRpdG9yLmdldE5vZGVUeXBlKHYpIT09aSlyZXR1cm4gZisxO3ZhciBwPXYseT1wLm9yZGVyZWQsaD12b2lkIDAhPT15JiZ5LGc9cC5sZXZlbCxiPXZvaWQgMD09PWc/MDpnO3JldHVybiBiPGY/Zi1iOmI+Zj8wOmI9PT1mP2g9PT1hPzA6MTowfShyKTtpZihjPjApZm9yKHZhciBmPTA7ZjxjO2YrKylvKz0iPCIrYSsiPiIsZWkucHVzaChhKTt2YXIgbD1mdW5jdGlvbihyKXt2YXIgbj1nby5nZXQocik7aWYobnVsbD09bilyZXR1cm4gMDt2YXIgbz1yLGk9by50eXBlLHU9by5vcmRlcmVkLGE9dm9pZCAwIT09dSYmdSxjPW8ubGV2ZWwsZj12b2lkIDA9PT1jPzA6YyxsPXQuRG9tRWRpdG9yLmZpbmRQYXRoKG4scik7aWYobFswXT09PW4uY2hpbGRyZW4ubGVuZ3RoLTEpcmV0dXJuIGYrMTt2YXIgcz1lLlBhdGgubmV4dChsKSxkPWUuRWRpdG9yLm5vZGUobixzKTtpZighZClyZXR1cm4gMDt2YXIgdj1TbyhkLDEpWzBdO2lmKHQuRG9tRWRpdG9yLmdldE5vZGVUeXBlKHYpIT09aSlyZXR1cm4gZisxO3ZhciBwPXYseT1wLm9yZGVyZWQsaD12b2lkIDAhPT15JiZ5LGc9cC5sZXZlbCxiPXZvaWQgMD09PWc/MDpnO3JldHVybiBiPGY/Zi1iOmI+Zj8wOmI9PT1mP2g9PT1hPzA6MTowfShyKTtpZihsPjApZm9yKGY9MDtmPGw7ZisrKXtpKz0iPC8iK2VpLnBvcCgpKyI+Ijt9cmV0dXJuIHtodG1sOiI8bGk+IituKyI8L2xpPiIscHJlZml4Om8sc3VmZml4Oml9fX0sb2k9cnQoInNwZWNpZXMiKSxpaT1Gbi5maWx0ZXIsdWk9KHJpPSJmaWx0ZXIiLFk+PTUxfHwhZygoZnVuY3Rpb24oKXt2YXIgdD1bXTtyZXR1cm4gKHQuY29uc3RydWN0b3I9e30pW29pXT1mdW5jdGlvbigpe3JldHVybiB7Zm9vOjF9fSwxIT09dFtyaV0oQm9vbGVhbikuZm9vfSkpKTtRZSh7dGFyZ2V0OiJBcnJheSIscHJvdG86ITAsZm9yY2VkOiF1aX0se2ZpbHRlcjpmdW5jdGlvbih0KXtyZXR1cm4gaWkodGhpcyx0LGFyZ3VtZW50cy5sZW5ndGg+MT9hcmd1bWVudHNbMV06dm9pZCAwKX19KTt2YXIgYWk9RnVuY3Rpb24ucHJvdG90eXBlLGNpPWFpLmFwcGx5LGZpPWFpLmJpbmQsbGk9YWkuY2FsbCxzaT0ib2JqZWN0Ij09dHlwZW9mIFJlZmxlY3QmJlJlZmxlY3QuYXBwbHl8fChmaT9saS5iaW5kKGNpKTpmdW5jdGlvbigpe3JldHVybiBsaS5hcHBseShjaSxhcmd1bWVudHMpfSksZGk9cnQoInNwZWNpZXMiKSx2aT1SZWdFeHAucHJvdG90eXBlLHBpPSRyLmNoYXJBdCx5aT1mdW5jdGlvbih0LGUscil7cmV0dXJuIGUrKHI/cGkodCxlKS5sZW5ndGg6MSl9LGhpPU1hdGguZmxvb3IsZ2k9aCgiIi5jaGFyQXQpLGJpPWgoIiIucmVwbGFjZSksbWk9aCgiIi5zbGljZSksd2k9L1wkKFskJidgXXxcZHsxLDJ9fDxbXj5dKj4pL2cseGk9L1wkKFskJidgXXxcZHsxLDJ9KS9nLFNpPWZ1bmN0aW9uKHQsZSxyLG4sbyxpKXt2YXIgdT1yK3QubGVuZ3RoLGE9bi5sZW5ndGgsYz14aTtyZXR1cm4gdm9pZCAwIT09byYmKG89TShvKSxjPXdpKSxiaShpLGMsKGZ1bmN0aW9uKGksYyl7dmFyIGY7c3dpdGNoKGdpKGMsMCkpe2Nhc2UiJCI6cmV0dXJuICIkIjtjYXNlIiYiOnJldHVybiB0O2Nhc2UiYCI6cmV0dXJuIG1pKGUsMCxyKTtjYXNlIiciOnJldHVybiBtaShlLHUpO2Nhc2UiPCI6Zj1vW21pKGMsMSwtMSldO2JyZWFrO2RlZmF1bHQ6dmFyIGw9K2M7aWYoMD09PWwpcmV0dXJuIGk7aWYobD5hKXt2YXIgcz1oaShsLzEwKTtyZXR1cm4gMD09PXM/aTpzPD1hP3ZvaWQgMD09PW5bcy0xXT9naShjLDEpOm5bcy0xXStnaShjLDEpOml9Zj1uW2wtMV07fXJldHVybiB2b2lkIDA9PT1mPyIiOmZ9KSl9LE9pPXMuVHlwZUVycm9yLEVpPWZ1bmN0aW9uKHQsZSl7dmFyIHI9dC5leGVjO2lmKEgocikpe3ZhciBuPXZ0KHIsdCxlKTtyZXR1cm4gbnVsbCE9PW4mJnV0KG4pLG59aWYoIlJlZ0V4cCI9PT13KHQpKXJldHVybiB2dChxbyx0LGUpO3Rocm93IE9pKCJSZWdFeHAjZXhlYyBjYWxsZWQgb24gaW5jb21wYXRpYmxlIHJlY2VpdmVyIil9LFRpPXJ0KCJyZXBsYWNlIiksamk9TWF0aC5tYXgsQWk9TWF0aC5taW4sSWk9aChbXS5jb25jYXQpLFBpPWgoW10ucHVzaCksUmk9aCgiIi5pbmRleE9mKSxMaT1oKCIiLnNsaWNlKSxraT0iJDAiPT09ImEiLnJlcGxhY2UoLy4vLCIkMCIpLE1pPSEhLy4vW1RpXSYmIiI9PT0vLi9bVGldKCJhIiwiJDAiKTshZnVuY3Rpb24odCxlLHIsbil7dmFyIG89cnQodCksaT0hZygoZnVuY3Rpb24oKXt2YXIgZT17fTtyZXR1cm4gZVtvXT1mdW5jdGlvbigpe3JldHVybiA3fSw3IT0iIlt0XShlKX0pKSx1PWkmJiFnKChmdW5jdGlvbigpe3ZhciBlPSExLHI9L2EvO3JldHVybiAic3BsaXQiPT09dCYmKChyPXt9KS5jb25zdHJ1Y3Rvcj17fSxyLmNvbnN0cnVjdG9yW2RpXT1mdW5jdGlvbigpe3JldHVybiByfSxyLmZsYWdzPSIiLHJbb109Ly4vW29dKSxyLmV4ZWM9ZnVuY3Rpb24oKXtyZXR1cm4gZT0hMCxudWxsfSxyW29dKCIiKSwhZX0pKTtpZighaXx8IXV8fHIpe3ZhciBhPWgoLy4vW29dKSxjPWUobywiIlt0XSwoZnVuY3Rpb24odCxlLHIsbixvKXt2YXIgdT1oKHQpLGM9ZS5leGVjO3JldHVybiBjPT09cW98fGM9PT12aS5leGVjP2kmJiFvP3tkb25lOiEwLHZhbHVlOmEoZSxyLG4pfTp7ZG9uZTohMCx2YWx1ZTp1KHIsZSxuKX06e2RvbmU6ITF9fSkpO0RlKFN0cmluZy5wcm90b3R5cGUsdCxjWzBdKSxEZSh2aSxvLGNbMV0pO31uJiZ5ZSh2aVtvXSwic2hhbSIsITApO30oInJlcGxhY2UiLChmdW5jdGlvbih0LGUscil7dmFyIG49TWk/IiQiOiIkMCI7cmV0dXJuIFtmdW5jdGlvbih0LHIpe3ZhciBuPVQodGhpcyksbz1udWxsPT10P3ZvaWQgMDp4dCh0LFRpKTtyZXR1cm4gbz92dChvLHQsbixyKTp2dChlLENyKG4pLHQscil9LGZ1bmN0aW9uKHQsbyl7dmFyIGk9dXQodGhpcyksdT1Dcih0KTtpZigic3RyaW5nIj09dHlwZW9mIG8mJi0xPT09UmkobyxuKSYmLTE9PT1SaShvLCIkPCIpKXt2YXIgYT1yKGUsaSx1LG8pO2lmKGEuZG9uZSlyZXR1cm4gYS52YWx1ZX12YXIgYz1IKG8pO2N8fChvPUNyKG8pKTt2YXIgZj1pLmdsb2JhbDtpZihmKXt2YXIgbD1pLnVuaWNvZGU7aS5sYXN0SW5kZXg9MDt9Zm9yKHZhciBzPVtdOzspe3ZhciBkPUVpKGksdSk7aWYobnVsbD09PWQpYnJlYWs7aWYoUGkocyxkKSwhZilicmVhazsiIj09PUNyKGRbMF0pJiYoaS5sYXN0SW5kZXg9eWkodSxEdChpLmxhc3RJbmRleCksbCkpO31mb3IodmFyIHYscD0iIix5PTAsaD0wO2g8cy5sZW5ndGg7aCsrKXtmb3IodmFyIGc9Q3IoKGQ9c1toXSlbMF0pLGI9amkoQWkoa3QoZC5pbmRleCksdS5sZW5ndGgpLDApLG09W10sdz0xO3c8ZC5sZW5ndGg7dysrKVBpKG0sdm9pZCAwPT09KHY9ZFt3XSk/djpTdHJpbmcodikpO3ZhciB4PWQuZ3JvdXBzO2lmKGMpe3ZhciBTPUlpKFtnXSxtLGIsdSk7dm9pZCAwIT09eCYmUGkoUyx4KTt2YXIgTz1DcihzaShvLHZvaWQgMCxTKSk7fWVsc2UgTz1TaShnLHUsYixtLHgsbyk7Yj49eSYmKHArPUxpKHUseSxiKStPLHk9YitnLmxlbmd0aCk7fXJldHVybiBwK0xpKHUseSl9XX0pLCEhZygoZnVuY3Rpb24oKXt2YXIgdD0vLi87cmV0dXJuIHQuZXhlYz1mdW5jdGlvbigpe3ZhciB0PVtdO3JldHVybiB0Lmdyb3Vwcz17YToiNyJ9LHR9LCI3IiE9PSIiLnJlcGxhY2UodCwiJDxhPiIpfSkpfHwha2l8fE1pKTt2YXIgTmk9cy5UeXBlRXJyb3IsX2k9ZnVuY3Rpb24odCxlLHIsbixvLGksdSxhKXtmb3IodmFyIGMsZixsPW8scz0wLGQ9ISF1JiZjbih1LGEpO3M8bjspe2lmKHMgaW4gcil7aWYoYz1kP2QocltzXSxzLGUpOnJbc10saT4wJiZUbihjKSlmPUN0KGMpLGw9X2kodCxlLGMsZixsLGktMSktMTtlbHNlIHtpZihsPj05MDA3MTk5MjU0NzQwOTkxKXRocm93IE5pKCJFeGNlZWQgdGhlIGFjY2VwdGFibGUgYXJyYXkgbGVuZ3RoIik7dFtsXT1jO31sKys7fXMrKzt9cmV0dXJuIGx9LHppPV9pO2Z1bmN0aW9uIERpKHQpe3JldHVybiB0Lmxlbmd0aD90WzBdLnRhZ05hbWUudG9Mb3dlckNhc2UoKToiIn1yZXR1cm4gUWUoe3RhcmdldDoiQXJyYXkiLHByb3RvOiEwfSx7ZmxhdDpmdW5jdGlvbigpe3ZhciB0PWFyZ3VtZW50cy5sZW5ndGg/YXJndW1lbnRzWzBdOnZvaWQgMCxlPU0odGhpcykscj1DdChlKSxuPXpuKGUsMCk7cmV0dXJuIG4ubGVuZ3RoPXppKG4sZSxlLHIsMCx2b2lkIDA9PT10PzE6a3QodCkpLG59fSksaWUoImZsYXQiKSxRZSh7Z2xvYmFsOiEwfSx7Z2xvYmFsVGhpczpzfSksbi5hcHBlbmQmJihpLmRlZmF1bHQuZm4uYXBwZW5kPW4uYXBwZW5kKSxuLmF0dHImJihpLmRlZmF1bHQuZm4uYXR0cj1uLmF0dHIpLG4ucGFyZW50JiYoaS5kZWZhdWx0LmZuLnBhcmVudD1uLnBhcmVudCkse3JlbmRlckVsZW1zOltib10sZWRpdG9yUGx1Z2luOmZ1bmN0aW9uKHIpe3ZhciBuPXIuZGVsZXRlQmFja3dhcmQsbz1yLmhhbmRsZVRhYixpPXIubm9ybWFsaXplTm9kZSx1PXI7cmV0dXJuIHUuZGVsZXRlQmFja3dhcmQ9ZnVuY3Rpb24ocil7dmFyIG89dS5zZWxlY3Rpb247aWYobnVsbCE9bylpZihlLlJhbmdlLmlzRXhwYW5kZWQobykpbihyKTtlbHNlIHt2YXIgaT10LkRvbUVkaXRvci5nZXRTZWxlY3RlZE5vZGVCeVR5cGUodSwibGlzdC1pdGVtIik7aWYobnVsbCE9aSlpZigwIT09by5mb2N1cy5vZmZzZXQpbihyKTtlbHNlIHt2YXIgYT1pLmxldmVsLGM9dm9pZCAwPT09YT8wOmE7Yz4wP2UuVHJhbnNmb3Jtcy5zZXROb2Rlcyh1LHtsZXZlbDpjLTF9KTplLlRyYW5zZm9ybXMuc2V0Tm9kZXModSx7dHlwZToicGFyYWdyYXBoIixvcmRlcmVkOnZvaWQgMCxsZXZlbDp2b2lkIDB9KTt9ZWxzZSBuKHIpO31lbHNlIG4ocik7fSx1LmhhbmRsZVRhYj1mdW5jdGlvbigpe3ZhciByLG4saSxhLGM9dS5zZWxlY3Rpb247aWYobnVsbCE9Yyl7aWYoZS5SYW5nZS5pc0NvbGxhcHNlZChjKSl7dmFyIGY9dC5Eb21FZGl0b3IuZ2V0U2VsZWN0ZWROb2RlQnlUeXBlKHUsImxpc3QtaXRlbSIpO2lmKG51bGw9PWYpcmV0dXJuIHZvaWQgbygpO2lmKDA9PT1jLmZvY3VzLm9mZnNldCl7dmFyIGw9Zi5sZXZlbCxzPXZvaWQgMD09PWw/MDpsO3JldHVybiB2b2lkIGUuVHJhbnNmb3Jtcy5zZXROb2Rlcyh1LHtsZXZlbDpzKzF9KX19aWYoZS5SYW5nZS5pc0V4cGFuZGVkKGMpKXt2YXIgZD0wLHY9ITE7dHJ5e2Zvcih2YXIgcD14byhPbyh1KSkseT1wLm5leHQoKTsheS5kb25lO3k9cC5uZXh0KCkpe3ZhciBoPVNvKHkudmFsdWUsMSlbMF07Imxpc3QtaXRlbSI9PT10LkRvbUVkaXRvci5nZXROb2RlVHlwZShoKT9kKys6dj0hMDt9fWNhdGNoKHQpe3I9e2Vycm9yOnR9O31maW5hbGx5e3RyeXt5JiYheS5kb25lJiYobj1wLnJldHVybikmJm4uY2FsbChwKTt9ZmluYWxseXtpZihyKXRocm93IHIuZXJyb3J9fWlmKHZ8fGQ8PTEpcmV0dXJuIHZvaWQgbygpO3RyeXtmb3IodmFyIGc9eG8oT28odSkpLGI9Zy5uZXh0KCk7IWIuZG9uZTtiPWcubmV4dCgpKXt2YXIgbT1TbyhiLnZhbHVlLDIpLHc9KGg9bVswXSxtWzFdKSx4PWgubGV2ZWw7cz12b2lkIDA9PT14PzA6eDtlLlRyYW5zZm9ybXMuc2V0Tm9kZXModSx7bGV2ZWw6cysxfSx7YXQ6d30pO319Y2F0Y2godCl7aT17ZXJyb3I6dH07fWZpbmFsbHl7dHJ5e2ImJiFiLmRvbmUmJihhPWcucmV0dXJuKSYmYS5jYWxsKGcpO31maW5hbGx5e2lmKGkpdGhyb3cgaS5lcnJvcn19fWVsc2UgbygpO31lbHNlIG8oKTt9LHUubm9ybWFsaXplTm9kZT1mdW5jdGlvbihyKXt2YXIgbj1TbyhyLDIpLG89blswXSxhPW5bMV0sYz10LkRvbUVkaXRvci5nZXROb2RlVHlwZShvKTtyZXR1cm4gImJ1bGxldGVkLWxpc3QiIT09YyYmIm51bWJlcmVkLWxpc3QiIT09Y3x8ZS5UcmFuc2Zvcm1zLnVud3JhcE5vZGVzKHUse2F0OmF9KSxpKFtvLGFdKX0sdX0sbWVudXM6W1pvLHRpXSxlbGVtc1RvSHRtbDpbbmldLHBhcnNlRWxlbXNIdG1sOlt7c2VsZWN0b3I6InVsOm5vdChbZGF0YS13LWUtdHlwZV0pLG9sOm5vdChbZGF0YS13LWUtdHlwZV0pIixwYXJzZUVsZW1IdG1sOmZ1bmN0aW9uKHQsZSxyKXtyZXR1cm4gZS5mbGF0KDEvMCl9fSx7c2VsZWN0b3I6ImxpOm5vdChbZGF0YS13LWUtdHlwZV0pIixwYXJzZUVsZW1IdG1sOmZ1bmN0aW9uKHQscixuKXt2YXIgbz1pLmRlZmF1bHQodCk7MD09PShyPXIuZmlsdGVyKChmdW5jdGlvbih0KXtyZXR1cm4gISFlLlRleHQuaXNUZXh0KHQpfHwhIW4uaXNJbmxpbmUodCl9KSkpLmxlbmd0aCYmKHI9W3t0ZXh0Om8udGV4dCgpLnJlcGxhY2UoL1xzKy9nbSwiICIpfV0pO3ZhciB1PWZ1bmN0aW9uKHQpe3JldHVybiAib2wiPT09RGkodC5wYXJlbnQoKSl9KG8pLGE9ZnVuY3Rpb24odCl7Zm9yKHZhciBlPTAscj10LnBhcmVudCgpLG49RGkocik7InVsIj09PW58fCJvbCI9PT1uOyluPURpKHI9ci5wYXJlbnQoKSksZSsrO3JldHVybiBlLTF9KG8pO3JldHVybiB7dHlwZToibGlzdC1pdGVtIixvcmRlcmVkOnUsbGV2ZWw6YSxjaGlsZHJlbjpyfX19XX19KSk7CgogIH0pOwoKICAvKioKICAgKiBMb2Rhc2ggKEN1c3RvbSBCdWlsZCkgPGh0dHBzOi8vbG9kYXNoLmNvbS8+CiAgICogQnVpbGQ6IGBsb2Rhc2ggbW9kdWxhcml6ZSBleHBvcnRzPSJucG0iIC1vIC4vYAogICAqIENvcHlyaWdodCBKUyBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMgPGh0dHBzOi8vanMuZm91bmRhdGlvbi8+CiAgICogUmVsZWFzZWQgdW5kZXIgTUlUIGxpY2Vuc2UgPGh0dHBzOi8vbG9kYXNoLmNvbS9saWNlbnNlPgogICAqIEJhc2VkIG9uIFVuZGVyc2NvcmUuanMgMS44LjMgPGh0dHA6Ly91bmRlcnNjb3JlanMub3JnL0xJQ0VOU0U+CiAgICogQ29weXJpZ2h0IEplcmVteSBBc2hrZW5hcywgRG9jdW1lbnRDbG91ZCBhbmQgSW52ZXN0aWdhdGl2ZSBSZXBvcnRlcnMgJiBFZGl0b3JzCiAgICovCgogIHZhciBsb2Rhc2hfaXNlcXVhbCA9IGNyZWF0ZUNvbW1vbmpzTW9kdWxlJDEoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogIC8qKiBVc2VkIGFzIHRoZSBzaXplIHRvIGVuYWJsZSBsYXJnZSBhcnJheSBvcHRpbWl6YXRpb25zLiAqLwogIHZhciBMQVJHRV9BUlJBWV9TSVpFID0gMjAwOwoKICAvKiogVXNlZCB0byBzdGFuZC1pbiBmb3IgYHVuZGVmaW5lZGAgaGFzaCB2YWx1ZXMuICovCiAgdmFyIEhBU0hfVU5ERUZJTkVEID0gJ19fbG9kYXNoX2hhc2hfdW5kZWZpbmVkX18nOwoKICAvKiogVXNlZCB0byBjb21wb3NlIGJpdG1hc2tzIGZvciB2YWx1ZSBjb21wYXJpc29ucy4gKi8KICB2YXIgQ09NUEFSRV9QQVJUSUFMX0ZMQUcgPSAxLAogICAgICBDT01QQVJFX1VOT1JERVJFRF9GTEFHID0gMjsKCiAgLyoqIFVzZWQgYXMgcmVmZXJlbmNlcyBmb3IgdmFyaW91cyBgTnVtYmVyYCBjb25zdGFudHMuICovCiAgdmFyIE1BWF9TQUZFX0lOVEVHRVIgPSA5MDA3MTk5MjU0NzQwOTkxOwoKICAvKiogYE9iamVjdCN0b1N0cmluZ2AgcmVzdWx0IHJlZmVyZW5jZXMuICovCiAgdmFyIGFyZ3NUYWcgPSAnW29iamVjdCBBcmd1bWVudHNdJywKICAgICAgYXJyYXlUYWcgPSAnW29iamVjdCBBcnJheV0nLAogICAgICBhc3luY1RhZyA9ICdbb2JqZWN0IEFzeW5jRnVuY3Rpb25dJywKICAgICAgYm9vbFRhZyA9ICdbb2JqZWN0IEJvb2xlYW5dJywKICAgICAgZGF0ZVRhZyA9ICdbb2JqZWN0IERhdGVdJywKICAgICAgZXJyb3JUYWcgPSAnW29iamVjdCBFcnJvcl0nLAogICAgICBmdW5jVGFnID0gJ1tvYmplY3QgRnVuY3Rpb25dJywKICAgICAgZ2VuVGFnID0gJ1tvYmplY3QgR2VuZXJhdG9yRnVuY3Rpb25dJywKICAgICAgbWFwVGFnID0gJ1tvYmplY3QgTWFwXScsCiAgICAgIG51bWJlclRhZyA9ICdbb2JqZWN0IE51bWJlcl0nLAogICAgICBudWxsVGFnID0gJ1tvYmplY3QgTnVsbF0nLAogICAgICBvYmplY3RUYWcgPSAnW29iamVjdCBPYmplY3RdJywKICAgICAgcHJvbWlzZVRhZyA9ICdbb2JqZWN0IFByb21pc2VdJywKICAgICAgcHJveHlUYWcgPSAnW29iamVjdCBQcm94eV0nLAogICAgICByZWdleHBUYWcgPSAnW29iamVjdCBSZWdFeHBdJywKICAgICAgc2V0VGFnID0gJ1tvYmplY3QgU2V0XScsCiAgICAgIHN0cmluZ1RhZyA9ICdbb2JqZWN0IFN0cmluZ10nLAogICAgICBzeW1ib2xUYWcgPSAnW29iamVjdCBTeW1ib2xdJywKICAgICAgdW5kZWZpbmVkVGFnID0gJ1tvYmplY3QgVW5kZWZpbmVkXScsCiAgICAgIHdlYWtNYXBUYWcgPSAnW29iamVjdCBXZWFrTWFwXSc7CgogIHZhciBhcnJheUJ1ZmZlclRhZyA9ICdbb2JqZWN0IEFycmF5QnVmZmVyXScsCiAgICAgIGRhdGFWaWV3VGFnID0gJ1tvYmplY3QgRGF0YVZpZXddJywKICAgICAgZmxvYXQzMlRhZyA9ICdbb2JqZWN0IEZsb2F0MzJBcnJheV0nLAogICAgICBmbG9hdDY0VGFnID0gJ1tvYmplY3QgRmxvYXQ2NEFycmF5XScsCiAgICAgIGludDhUYWcgPSAnW29iamVjdCBJbnQ4QXJyYXldJywKICAgICAgaW50MTZUYWcgPSAnW29iamVjdCBJbnQxNkFycmF5XScsCiAgICAgIGludDMyVGFnID0gJ1tvYmplY3QgSW50MzJBcnJheV0nLAogICAgICB1aW50OFRhZyA9ICdbb2JqZWN0IFVpbnQ4QXJyYXldJywKICAgICAgdWludDhDbGFtcGVkVGFnID0gJ1tvYmplY3QgVWludDhDbGFtcGVkQXJyYXldJywKICAgICAgdWludDE2VGFnID0gJ1tvYmplY3QgVWludDE2QXJyYXldJywKICAgICAgdWludDMyVGFnID0gJ1tvYmplY3QgVWludDMyQXJyYXldJzsKCiAgLyoqCiAgICogVXNlZCB0byBtYXRjaCBgUmVnRXhwYAogICAqIFtzeW50YXggY2hhcmFjdGVyc10oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtcGF0dGVybnMpLgogICAqLwogIHZhciByZVJlZ0V4cENoYXIgPSAvW1xcXiQuKis/KClbXF17fXxdL2c7CgogIC8qKiBVc2VkIHRvIGRldGVjdCBob3N0IGNvbnN0cnVjdG9ycyAoU2FmYXJpKS4gKi8KICB2YXIgcmVJc0hvc3RDdG9yID0gL15cW29iamVjdCAuKz9Db25zdHJ1Y3RvclxdJC87CgogIC8qKiBVc2VkIHRvIGRldGVjdCB1bnNpZ25lZCBpbnRlZ2VyIHZhbHVlcy4gKi8KICB2YXIgcmVJc1VpbnQgPSAvXig/OjB8WzEtOV1cZCopJC87CgogIC8qKiBVc2VkIHRvIGlkZW50aWZ5IGB0b1N0cmluZ1RhZ2AgdmFsdWVzIG9mIHR5cGVkIGFycmF5cy4gKi8KICB2YXIgdHlwZWRBcnJheVRhZ3MgPSB7fTsKICB0eXBlZEFycmF5VGFnc1tmbG9hdDMyVGFnXSA9IHR5cGVkQXJyYXlUYWdzW2Zsb2F0NjRUYWddID0KICB0eXBlZEFycmF5VGFnc1tpbnQ4VGFnXSA9IHR5cGVkQXJyYXlUYWdzW2ludDE2VGFnXSA9CiAgdHlwZWRBcnJheVRhZ3NbaW50MzJUYWddID0gdHlwZWRBcnJheVRhZ3NbdWludDhUYWddID0KICB0eXBlZEFycmF5VGFnc1t1aW50OENsYW1wZWRUYWddID0gdHlwZWRBcnJheVRhZ3NbdWludDE2VGFnXSA9CiAgdHlwZWRBcnJheVRhZ3NbdWludDMyVGFnXSA9IHRydWU7CiAgdHlwZWRBcnJheVRhZ3NbYXJnc1RhZ10gPSB0eXBlZEFycmF5VGFnc1thcnJheVRhZ10gPQogIHR5cGVkQXJyYXlUYWdzW2FycmF5QnVmZmVyVGFnXSA9IHR5cGVkQXJyYXlUYWdzW2Jvb2xUYWddID0KICB0eXBlZEFycmF5VGFnc1tkYXRhVmlld1RhZ10gPSB0eXBlZEFycmF5VGFnc1tkYXRlVGFnXSA9CiAgdHlwZWRBcnJheVRhZ3NbZXJyb3JUYWddID0gdHlwZWRBcnJheVRhZ3NbZnVuY1RhZ10gPQogIHR5cGVkQXJyYXlUYWdzW21hcFRhZ10gPSB0eXBlZEFycmF5VGFnc1tudW1iZXJUYWddID0KICB0eXBlZEFycmF5VGFnc1tvYmplY3RUYWddID0gdHlwZWRBcnJheVRhZ3NbcmVnZXhwVGFnXSA9CiAgdHlwZWRBcnJheVRhZ3Nbc2V0VGFnXSA9IHR5cGVkQXJyYXlUYWdzW3N0cmluZ1RhZ10gPQogIHR5cGVkQXJyYXlUYWdzW3dlYWtNYXBUYWddID0gZmFsc2U7CgogIC8qKiBEZXRlY3QgZnJlZSB2YXJpYWJsZSBgZ2xvYmFsYCBmcm9tIE5vZGUuanMuICovCiAgdmFyIGZyZWVHbG9iYWwgPSB0eXBlb2YgY29tbW9uanNHbG9iYWwgPT0gJ29iamVjdCcgJiYgY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuT2JqZWN0ID09PSBPYmplY3QgJiYgY29tbW9uanNHbG9iYWw7CgogIC8qKiBEZXRlY3QgZnJlZSB2YXJpYWJsZSBgc2VsZmAuICovCiAgdmFyIGZyZWVTZWxmID0gdHlwZW9mIHNlbGYgPT0gJ29iamVjdCcgJiYgc2VsZiAmJiBzZWxmLk9iamVjdCA9PT0gT2JqZWN0ICYmIHNlbGY7CgogIC8qKiBVc2VkIGFzIGEgcmVmZXJlbmNlIHRvIHRoZSBnbG9iYWwgb2JqZWN0LiAqLwogIHZhciByb290ID0gZnJlZUdsb2JhbCB8fCBmcmVlU2VsZiB8fCBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpOwoKICAvKiogRGV0ZWN0IGZyZWUgdmFyaWFibGUgYGV4cG9ydHNgLiAqLwogIHZhciBmcmVlRXhwb3J0cyA9IGV4cG9ydHMgJiYgIWV4cG9ydHMubm9kZVR5cGUgJiYgZXhwb3J0czsKCiAgLyoqIERldGVjdCBmcmVlIHZhcmlhYmxlIGBtb2R1bGVgLiAqLwogIHZhciBmcmVlTW9kdWxlID0gZnJlZUV4cG9ydHMgJiYgJ29iamVjdCcgPT0gJ29iamVjdCcgJiYgbW9kdWxlICYmICFtb2R1bGUubm9kZVR5cGUgJiYgbW9kdWxlOwoKICAvKiogRGV0ZWN0IHRoZSBwb3B1bGFyIENvbW1vbkpTIGV4dGVuc2lvbiBgbW9kdWxlLmV4cG9ydHNgLiAqLwogIHZhciBtb2R1bGVFeHBvcnRzID0gZnJlZU1vZHVsZSAmJiBmcmVlTW9kdWxlLmV4cG9ydHMgPT09IGZyZWVFeHBvcnRzOwoKICAvKiogRGV0ZWN0IGZyZWUgdmFyaWFibGUgYHByb2Nlc3NgIGZyb20gTm9kZS5qcy4gKi8KICB2YXIgZnJlZVByb2Nlc3MgPSBtb2R1bGVFeHBvcnRzICYmIGZyZWVHbG9iYWwucHJvY2VzczsKCiAgLyoqIFVzZWQgdG8gYWNjZXNzIGZhc3RlciBOb2RlLmpzIGhlbHBlcnMuICovCiAgdmFyIG5vZGVVdGlsID0gKGZ1bmN0aW9uKCkgewogICAgdHJ5IHsKICAgICAgcmV0dXJuIGZyZWVQcm9jZXNzICYmIGZyZWVQcm9jZXNzLmJpbmRpbmcgJiYgZnJlZVByb2Nlc3MuYmluZGluZygndXRpbCcpOwogICAgfSBjYXRjaCAoZSkge30KICB9KCkpOwoKICAvKiBOb2RlLmpzIGhlbHBlciByZWZlcmVuY2VzLiAqLwogIHZhciBub2RlSXNUeXBlZEFycmF5ID0gbm9kZVV0aWwgJiYgbm9kZVV0aWwuaXNUeXBlZEFycmF5OwoKICAvKioKICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYF8uZmlsdGVyYCBmb3IgYXJyYXlzIHdpdGhvdXQgc3VwcG9ydCBmb3IKICAgKiBpdGVyYXRlZSBzaG9ydGhhbmRzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0FycmF5fSBbYXJyYXldIFRoZSBhcnJheSB0byBpdGVyYXRlIG92ZXIuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZGljYXRlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgZmlsdGVyZWQgYXJyYXkuCiAgICovCiAgZnVuY3Rpb24gYXJyYXlGaWx0ZXIoYXJyYXksIHByZWRpY2F0ZSkgewogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGgsCiAgICAgICAgcmVzSW5kZXggPSAwLAogICAgICAgIHJlc3VsdCA9IFtdOwoKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIHZhciB2YWx1ZSA9IGFycmF5W2luZGV4XTsKICAgICAgaWYgKHByZWRpY2F0ZSh2YWx1ZSwgaW5kZXgsIGFycmF5KSkgewogICAgICAgIHJlc3VsdFtyZXNJbmRleCsrXSA9IHZhbHVlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogQXBwZW5kcyB0aGUgZWxlbWVudHMgb2YgYHZhbHVlc2AgdG8gYGFycmF5YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIG1vZGlmeS4KICAgKiBAcGFyYW0ge0FycmF5fSB2YWx1ZXMgVGhlIHZhbHVlcyB0byBhcHBlbmQuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIGBhcnJheWAuCiAgICovCiAgZnVuY3Rpb24gYXJyYXlQdXNoKGFycmF5LCB2YWx1ZXMpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IHZhbHVlcy5sZW5ndGgsCiAgICAgICAgb2Zmc2V0ID0gYXJyYXkubGVuZ3RoOwoKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIGFycmF5W29mZnNldCArIGluZGV4XSA9IHZhbHVlc1tpbmRleF07CiAgICB9CiAgICByZXR1cm4gYXJyYXk7CiAgfQoKICAvKioKICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYF8uc29tZWAgZm9yIGFycmF5cyB3aXRob3V0IHN1cHBvcnQgZm9yIGl0ZXJhdGVlCiAgICogc2hvcnRoYW5kcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gW2FycmF5XSBUaGUgYXJyYXkgdG8gaXRlcmF0ZSBvdmVyLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IHByZWRpY2F0ZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBhbnkgZWxlbWVudCBwYXNzZXMgdGhlIHByZWRpY2F0ZSBjaGVjaywKICAgKiAgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGFycmF5U29tZShhcnJheSwgcHJlZGljYXRlKSB7CiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aDsKCiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICBpZiAocHJlZGljYXRlKGFycmF5W2luZGV4XSwgaW5kZXgsIGFycmF5KSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy50aW1lc2Agd2l0aG91dCBzdXBwb3J0IGZvciBpdGVyYXRlZSBzaG9ydGhhbmRzCiAgICogb3IgbWF4IGFycmF5IGxlbmd0aCBjaGVja3MuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7bnVtYmVyfSBuIFRoZSBudW1iZXIgb2YgdGltZXMgdG8gaW52b2tlIGBpdGVyYXRlZWAuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gaXRlcmF0ZWUgVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHJlc3VsdHMuCiAgICovCiAgZnVuY3Rpb24gYmFzZVRpbWVzKG4sIGl0ZXJhdGVlKSB7CiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICByZXN1bHQgPSBBcnJheShuKTsKCiAgICB3aGlsZSAoKytpbmRleCA8IG4pIHsKICAgICAgcmVzdWx0W2luZGV4XSA9IGl0ZXJhdGVlKGluZGV4KTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy51bmFyeWAgd2l0aG91dCBzdXBwb3J0IGZvciBzdG9yaW5nIG1ldGFkYXRhLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBjYXAgYXJndW1lbnRzIGZvci4KICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBjYXBwZWQgZnVuY3Rpb24uCiAgICovCiAgZnVuY3Rpb24gYmFzZVVuYXJ5KGZ1bmMpIHsKICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gZnVuYyh2YWx1ZSk7CiAgICB9OwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGEgYGNhY2hlYCB2YWx1ZSBmb3IgYGtleWAgZXhpc3RzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gY2FjaGUgVGhlIGNhY2hlIHRvIHF1ZXJ5LgogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgZW50cnkgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGFuIGVudHJ5IGZvciBga2V5YCBleGlzdHMsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBjYWNoZUhhcyhjYWNoZSwga2V5KSB7CiAgICByZXR1cm4gY2FjaGUuaGFzKGtleSk7CiAgfQoKICAvKioKICAgKiBHZXRzIHRoZSB2YWx1ZSBhdCBga2V5YCBvZiBgb2JqZWN0YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IFtvYmplY3RdIFRoZSBvYmplY3QgdG8gcXVlcnkuCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSBwcm9wZXJ0eSB0byBnZXQuCiAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIHByb3BlcnR5IHZhbHVlLgogICAqLwogIGZ1bmN0aW9uIGdldFZhbHVlKG9iamVjdCwga2V5KSB7CiAgICByZXR1cm4gb2JqZWN0ID09IG51bGwgPyB1bmRlZmluZWQgOiBvYmplY3Rba2V5XTsKICB9CgogIC8qKgogICAqIENvbnZlcnRzIGBtYXBgIHRvIGl0cyBrZXktdmFsdWUgcGFpcnMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBtYXAgVGhlIG1hcCB0byBjb252ZXJ0LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUga2V5LXZhbHVlIHBhaXJzLgogICAqLwogIGZ1bmN0aW9uIG1hcFRvQXJyYXkobWFwKSB7CiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICByZXN1bHQgPSBBcnJheShtYXAuc2l6ZSk7CgogICAgbWFwLmZvckVhY2goZnVuY3Rpb24odmFsdWUsIGtleSkgewogICAgICByZXN1bHRbKytpbmRleF0gPSBba2V5LCB2YWx1ZV07CiAgICB9KTsKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGEgdW5hcnkgZnVuY3Rpb24gdGhhdCBpbnZva2VzIGBmdW5jYCB3aXRoIGl0cyBhcmd1bWVudCB0cmFuc2Zvcm1lZC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gd3JhcC4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSB0cmFuc2Zvcm0gVGhlIGFyZ3VtZW50IHRyYW5zZm9ybS4KICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBmdW5jdGlvbi4KICAgKi8KICBmdW5jdGlvbiBvdmVyQXJnKGZ1bmMsIHRyYW5zZm9ybSkgewogICAgcmV0dXJuIGZ1bmN0aW9uKGFyZykgewogICAgICByZXR1cm4gZnVuYyh0cmFuc2Zvcm0oYXJnKSk7CiAgICB9OwogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYHNldGAgdG8gYW4gYXJyYXkgb2YgaXRzIHZhbHVlcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IHNldCBUaGUgc2V0IHRvIGNvbnZlcnQuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSB2YWx1ZXMuCiAgICovCiAgZnVuY3Rpb24gc2V0VG9BcnJheShzZXQpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIHJlc3VsdCA9IEFycmF5KHNldC5zaXplKTsKCiAgICBzZXQuZm9yRWFjaChmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXN1bHRbKytpbmRleF0gPSB2YWx1ZTsKICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKiBVc2VkIGZvciBidWlsdC1pbiBtZXRob2QgcmVmZXJlbmNlcy4gKi8KICB2YXIgYXJyYXlQcm90byA9IEFycmF5LnByb3RvdHlwZSwKICAgICAgZnVuY1Byb3RvID0gRnVuY3Rpb24ucHJvdG90eXBlLAogICAgICBvYmplY3RQcm90byA9IE9iamVjdC5wcm90b3R5cGU7CgogIC8qKiBVc2VkIHRvIGRldGVjdCBvdmVycmVhY2hpbmcgY29yZS1qcyBzaGltcy4gKi8KICB2YXIgY29yZUpzRGF0YSA9IHJvb3RbJ19fY29yZS1qc19zaGFyZWRfXyddOwoKICAvKiogVXNlZCB0byByZXNvbHZlIHRoZSBkZWNvbXBpbGVkIHNvdXJjZSBvZiBmdW5jdGlvbnMuICovCiAgdmFyIGZ1bmNUb1N0cmluZyA9IGZ1bmNQcm90by50b1N0cmluZzsKCiAgLyoqIFVzZWQgdG8gY2hlY2sgb2JqZWN0cyBmb3Igb3duIHByb3BlcnRpZXMuICovCiAgdmFyIGhhc093blByb3BlcnR5ID0gb2JqZWN0UHJvdG8uaGFzT3duUHJvcGVydHk7CgogIC8qKiBVc2VkIHRvIGRldGVjdCBtZXRob2RzIG1hc3F1ZXJhZGluZyBhcyBuYXRpdmUuICovCiAgdmFyIG1hc2tTcmNLZXkgPSAoZnVuY3Rpb24oKSB7CiAgICB2YXIgdWlkID0gL1teLl0rJC8uZXhlYyhjb3JlSnNEYXRhICYmIGNvcmVKc0RhdGEua2V5cyAmJiBjb3JlSnNEYXRhLmtleXMuSUVfUFJPVE8gfHwgJycpOwogICAgcmV0dXJuIHVpZCA/ICgnU3ltYm9sKHNyYylfMS4nICsgdWlkKSA6ICcnOwogIH0oKSk7CgogIC8qKgogICAqIFVzZWQgdG8gcmVzb2x2ZSB0aGUKICAgKiBbYHRvU3RyaW5nVGFnYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtb2JqZWN0LnByb3RvdHlwZS50b3N0cmluZykKICAgKiBvZiB2YWx1ZXMuCiAgICovCiAgdmFyIG5hdGl2ZU9iamVjdFRvU3RyaW5nID0gb2JqZWN0UHJvdG8udG9TdHJpbmc7CgogIC8qKiBVc2VkIHRvIGRldGVjdCBpZiBhIG1ldGhvZCBpcyBuYXRpdmUuICovCiAgdmFyIHJlSXNOYXRpdmUgPSBSZWdFeHAoJ14nICsKICAgIGZ1bmNUb1N0cmluZy5jYWxsKGhhc093blByb3BlcnR5KS5yZXBsYWNlKHJlUmVnRXhwQ2hhciwgJ1xcJCYnKQogICAgLnJlcGxhY2UoL2hhc093blByb3BlcnR5fChmdW5jdGlvbikuKj8oPz1cXFwoKXwgZm9yIC4rPyg/PVxcXF0pL2csICckMS4qPycpICsgJyQnCiAgKTsKCiAgLyoqIEJ1aWx0LWluIHZhbHVlIHJlZmVyZW5jZXMuICovCiAgdmFyIEJ1ZmZlciA9IG1vZHVsZUV4cG9ydHMgPyByb290LkJ1ZmZlciA6IHVuZGVmaW5lZCwKICAgICAgU3ltYm9sID0gcm9vdC5TeW1ib2wsCiAgICAgIFVpbnQ4QXJyYXkgPSByb290LlVpbnQ4QXJyYXksCiAgICAgIHByb3BlcnR5SXNFbnVtZXJhYmxlID0gb2JqZWN0UHJvdG8ucHJvcGVydHlJc0VudW1lcmFibGUsCiAgICAgIHNwbGljZSA9IGFycmF5UHJvdG8uc3BsaWNlLAogICAgICBzeW1Ub1N0cmluZ1RhZyA9IFN5bWJvbCA/IFN5bWJvbC50b1N0cmluZ1RhZyA6IHVuZGVmaW5lZDsKCiAgLyogQnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMgZm9yIHRob3NlIHdpdGggdGhlIHNhbWUgbmFtZSBhcyBvdGhlciBgbG9kYXNoYCBtZXRob2RzLiAqLwogIHZhciBuYXRpdmVHZXRTeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scywKICAgICAgbmF0aXZlSXNCdWZmZXIgPSBCdWZmZXIgPyBCdWZmZXIuaXNCdWZmZXIgOiB1bmRlZmluZWQsCiAgICAgIG5hdGl2ZUtleXMgPSBvdmVyQXJnKE9iamVjdC5rZXlzLCBPYmplY3QpOwoKICAvKiBCdWlsdC1pbiBtZXRob2QgcmVmZXJlbmNlcyB0aGF0IGFyZSB2ZXJpZmllZCB0byBiZSBuYXRpdmUuICovCiAgdmFyIERhdGFWaWV3ID0gZ2V0TmF0aXZlKHJvb3QsICdEYXRhVmlldycpLAogICAgICBNYXAgPSBnZXROYXRpdmUocm9vdCwgJ01hcCcpLAogICAgICBQcm9taXNlID0gZ2V0TmF0aXZlKHJvb3QsICdQcm9taXNlJyksCiAgICAgIFNldCA9IGdldE5hdGl2ZShyb290LCAnU2V0JyksCiAgICAgIFdlYWtNYXAgPSBnZXROYXRpdmUocm9vdCwgJ1dlYWtNYXAnKSwKICAgICAgbmF0aXZlQ3JlYXRlID0gZ2V0TmF0aXZlKE9iamVjdCwgJ2NyZWF0ZScpOwoKICAvKiogVXNlZCB0byBkZXRlY3QgbWFwcywgc2V0cywgYW5kIHdlYWttYXBzLiAqLwogIHZhciBkYXRhVmlld0N0b3JTdHJpbmcgPSB0b1NvdXJjZShEYXRhVmlldyksCiAgICAgIG1hcEN0b3JTdHJpbmcgPSB0b1NvdXJjZShNYXApLAogICAgICBwcm9taXNlQ3RvclN0cmluZyA9IHRvU291cmNlKFByb21pc2UpLAogICAgICBzZXRDdG9yU3RyaW5nID0gdG9Tb3VyY2UoU2V0KSwKICAgICAgd2Vha01hcEN0b3JTdHJpbmcgPSB0b1NvdXJjZShXZWFrTWFwKTsKCiAgLyoqIFVzZWQgdG8gY29udmVydCBzeW1ib2xzIHRvIHByaW1pdGl2ZXMgYW5kIHN0cmluZ3MuICovCiAgdmFyIHN5bWJvbFByb3RvID0gU3ltYm9sID8gU3ltYm9sLnByb3RvdHlwZSA6IHVuZGVmaW5lZCwKICAgICAgc3ltYm9sVmFsdWVPZiA9IHN5bWJvbFByb3RvID8gc3ltYm9sUHJvdG8udmFsdWVPZiA6IHVuZGVmaW5lZDsKCiAgLyoqCiAgICogQ3JlYXRlcyBhIGhhc2ggb2JqZWN0LgogICAqCiAgICogQHByaXZhdGUKICAgKiBAY29uc3RydWN0b3IKICAgKiBAcGFyYW0ge0FycmF5fSBbZW50cmllc10gVGhlIGtleS12YWx1ZSBwYWlycyB0byBjYWNoZS4KICAgKi8KICBmdW5jdGlvbiBIYXNoKGVudHJpZXMpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IGVudHJpZXMgPT0gbnVsbCA/IDAgOiBlbnRyaWVzLmxlbmd0aDsKCiAgICB0aGlzLmNsZWFyKCk7CiAgICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgICB2YXIgZW50cnkgPSBlbnRyaWVzW2luZGV4XTsKICAgICAgdGhpcy5zZXQoZW50cnlbMF0sIGVudHJ5WzFdKTsKICAgIH0KICB9CgogIC8qKgogICAqIFJlbW92ZXMgYWxsIGtleS12YWx1ZSBlbnRyaWVzIGZyb20gdGhlIGhhc2guCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIGNsZWFyCiAgICogQG1lbWJlck9mIEhhc2gKICAgKi8KICBmdW5jdGlvbiBoYXNoQ2xlYXIoKSB7CiAgICB0aGlzLl9fZGF0YV9fID0gbmF0aXZlQ3JlYXRlID8gbmF0aXZlQ3JlYXRlKG51bGwpIDoge307CiAgICB0aGlzLnNpemUgPSAwOwogIH0KCiAgLyoqCiAgICogUmVtb3ZlcyBga2V5YCBhbmQgaXRzIHZhbHVlIGZyb20gdGhlIGhhc2guCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIGRlbGV0ZQogICAqIEBtZW1iZXJPZiBIYXNoCiAgICogQHBhcmFtIHtPYmplY3R9IGhhc2ggVGhlIGhhc2ggdG8gbW9kaWZ5LgogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gcmVtb3ZlLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZW50cnkgd2FzIHJlbW92ZWQsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBoYXNoRGVsZXRlKGtleSkgewogICAgdmFyIHJlc3VsdCA9IHRoaXMuaGFzKGtleSkgJiYgZGVsZXRlIHRoaXMuX19kYXRhX19ba2V5XTsKICAgIHRoaXMuc2l6ZSAtPSByZXN1bHQgPyAxIDogMDsKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBHZXRzIHRoZSBoYXNoIHZhbHVlIGZvciBga2V5YC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgZ2V0CiAgICogQG1lbWJlck9mIEhhc2gKICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIGdldC4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgZW50cnkgdmFsdWUuCiAgICovCiAgZnVuY3Rpb24gaGFzaEdldChrZXkpIHsKICAgIHZhciBkYXRhID0gdGhpcy5fX2RhdGFfXzsKICAgIGlmIChuYXRpdmVDcmVhdGUpIHsKICAgICAgdmFyIHJlc3VsdCA9IGRhdGFba2V5XTsKICAgICAgcmV0dXJuIHJlc3VsdCA9PT0gSEFTSF9VTkRFRklORUQgPyB1bmRlZmluZWQgOiByZXN1bHQ7CiAgICB9CiAgICByZXR1cm4gaGFzT3duUHJvcGVydHkuY2FsbChkYXRhLCBrZXkpID8gZGF0YVtrZXldIDogdW5kZWZpbmVkOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGEgaGFzaCB2YWx1ZSBmb3IgYGtleWAgZXhpc3RzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBoYXMKICAgKiBAbWVtYmVyT2YgSGFzaAogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgZW50cnkgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGFuIGVudHJ5IGZvciBga2V5YCBleGlzdHMsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBoYXNoSGFzKGtleSkgewogICAgdmFyIGRhdGEgPSB0aGlzLl9fZGF0YV9fOwogICAgcmV0dXJuIG5hdGl2ZUNyZWF0ZSA/IChkYXRhW2tleV0gIT09IHVuZGVmaW5lZCkgOiBoYXNPd25Qcm9wZXJ0eS5jYWxsKGRhdGEsIGtleSk7CiAgfQoKICAvKioKICAgKiBTZXRzIHRoZSBoYXNoIGBrZXlgIHRvIGB2YWx1ZWAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIHNldAogICAqIEBtZW1iZXJPZiBIYXNoCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byBzZXQuCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gc2V0LgogICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIGhhc2ggaW5zdGFuY2UuCiAgICovCiAgZnVuY3Rpb24gaGFzaFNldChrZXksIHZhbHVlKSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuX19kYXRhX187CiAgICB0aGlzLnNpemUgKz0gdGhpcy5oYXMoa2V5KSA/IDAgOiAxOwogICAgZGF0YVtrZXldID0gKG5hdGl2ZUNyZWF0ZSAmJiB2YWx1ZSA9PT0gdW5kZWZpbmVkKSA/IEhBU0hfVU5ERUZJTkVEIDogdmFsdWU7CiAgICByZXR1cm4gdGhpczsKICB9CgogIC8vIEFkZCBtZXRob2RzIHRvIGBIYXNoYC4KICBIYXNoLnByb3RvdHlwZS5jbGVhciA9IGhhc2hDbGVhcjsKICBIYXNoLnByb3RvdHlwZVsnZGVsZXRlJ10gPSBoYXNoRGVsZXRlOwogIEhhc2gucHJvdG90eXBlLmdldCA9IGhhc2hHZXQ7CiAgSGFzaC5wcm90b3R5cGUuaGFzID0gaGFzaEhhczsKICBIYXNoLnByb3RvdHlwZS5zZXQgPSBoYXNoU2V0OwoKICAvKioKICAgKiBDcmVhdGVzIGFuIGxpc3QgY2FjaGUgb2JqZWN0LgogICAqCiAgICogQHByaXZhdGUKICAgKiBAY29uc3RydWN0b3IKICAgKiBAcGFyYW0ge0FycmF5fSBbZW50cmllc10gVGhlIGtleS12YWx1ZSBwYWlycyB0byBjYWNoZS4KICAgKi8KICBmdW5jdGlvbiBMaXN0Q2FjaGUoZW50cmllcykgewogICAgdmFyIGluZGV4ID0gLTEsCiAgICAgICAgbGVuZ3RoID0gZW50cmllcyA9PSBudWxsID8gMCA6IGVudHJpZXMubGVuZ3RoOwoKICAgIHRoaXMuY2xlYXIoKTsKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIHZhciBlbnRyeSA9IGVudHJpZXNbaW5kZXhdOwogICAgICB0aGlzLnNldChlbnRyeVswXSwgZW50cnlbMV0pOwogICAgfQogIH0KCiAgLyoqCiAgICogUmVtb3ZlcyBhbGwga2V5LXZhbHVlIGVudHJpZXMgZnJvbSB0aGUgbGlzdCBjYWNoZS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgY2xlYXIKICAgKiBAbWVtYmVyT2YgTGlzdENhY2hlCiAgICovCiAgZnVuY3Rpb24gbGlzdENhY2hlQ2xlYXIoKSB7CiAgICB0aGlzLl9fZGF0YV9fID0gW107CiAgICB0aGlzLnNpemUgPSAwOwogIH0KCiAgLyoqCiAgICogUmVtb3ZlcyBga2V5YCBhbmQgaXRzIHZhbHVlIGZyb20gdGhlIGxpc3QgY2FjaGUuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIGRlbGV0ZQogICAqIEBtZW1iZXJPZiBMaXN0Q2FjaGUKICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIHJlbW92ZS4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGVudHJ5IHdhcyByZW1vdmVkLCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gbGlzdENhY2hlRGVsZXRlKGtleSkgewogICAgdmFyIGRhdGEgPSB0aGlzLl9fZGF0YV9fLAogICAgICAgIGluZGV4ID0gYXNzb2NJbmRleE9mKGRhdGEsIGtleSk7CgogICAgaWYgKGluZGV4IDwgMCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB2YXIgbGFzdEluZGV4ID0gZGF0YS5sZW5ndGggLSAxOwogICAgaWYgKGluZGV4ID09IGxhc3RJbmRleCkgewogICAgICBkYXRhLnBvcCgpOwogICAgfSBlbHNlIHsKICAgICAgc3BsaWNlLmNhbGwoZGF0YSwgaW5kZXgsIDEpOwogICAgfQogICAgLS10aGlzLnNpemU7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIC8qKgogICAqIEdldHMgdGhlIGxpc3QgY2FjaGUgdmFsdWUgZm9yIGBrZXlgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBnZXQKICAgKiBAbWVtYmVyT2YgTGlzdENhY2hlCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byBnZXQuCiAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGVudHJ5IHZhbHVlLgogICAqLwogIGZ1bmN0aW9uIGxpc3RDYWNoZUdldChrZXkpIHsKICAgIHZhciBkYXRhID0gdGhpcy5fX2RhdGFfXywKICAgICAgICBpbmRleCA9IGFzc29jSW5kZXhPZihkYXRhLCBrZXkpOwoKICAgIHJldHVybiBpbmRleCA8IDAgPyB1bmRlZmluZWQgOiBkYXRhW2luZGV4XVsxXTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBhIGxpc3QgY2FjaGUgdmFsdWUgZm9yIGBrZXlgIGV4aXN0cy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgaGFzCiAgICogQG1lbWJlck9mIExpc3RDYWNoZQogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgZW50cnkgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGFuIGVudHJ5IGZvciBga2V5YCBleGlzdHMsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBsaXN0Q2FjaGVIYXMoa2V5KSB7CiAgICByZXR1cm4gYXNzb2NJbmRleE9mKHRoaXMuX19kYXRhX18sIGtleSkgPiAtMTsKICB9CgogIC8qKgogICAqIFNldHMgdGhlIGxpc3QgY2FjaGUgYGtleWAgdG8gYHZhbHVlYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgc2V0CiAgICogQG1lbWJlck9mIExpc3RDYWNoZQogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gc2V0LgogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHNldC4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBsaXN0IGNhY2hlIGluc3RhbmNlLgogICAqLwogIGZ1bmN0aW9uIGxpc3RDYWNoZVNldChrZXksIHZhbHVlKSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuX19kYXRhX18sCiAgICAgICAgaW5kZXggPSBhc3NvY0luZGV4T2YoZGF0YSwga2V5KTsKCiAgICBpZiAoaW5kZXggPCAwKSB7CiAgICAgICsrdGhpcy5zaXplOwogICAgICBkYXRhLnB1c2goW2tleSwgdmFsdWVdKTsKICAgIH0gZWxzZSB7CiAgICAgIGRhdGFbaW5kZXhdWzFdID0gdmFsdWU7CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9CgogIC8vIEFkZCBtZXRob2RzIHRvIGBMaXN0Q2FjaGVgLgogIExpc3RDYWNoZS5wcm90b3R5cGUuY2xlYXIgPSBsaXN0Q2FjaGVDbGVhcjsKICBMaXN0Q2FjaGUucHJvdG90eXBlWydkZWxldGUnXSA9IGxpc3RDYWNoZURlbGV0ZTsKICBMaXN0Q2FjaGUucHJvdG90eXBlLmdldCA9IGxpc3RDYWNoZUdldDsKICBMaXN0Q2FjaGUucHJvdG90eXBlLmhhcyA9IGxpc3RDYWNoZUhhczsKICBMaXN0Q2FjaGUucHJvdG90eXBlLnNldCA9IGxpc3RDYWNoZVNldDsKCiAgLyoqCiAgICogQ3JlYXRlcyBhIG1hcCBjYWNoZSBvYmplY3QgdG8gc3RvcmUga2V5LXZhbHVlIHBhaXJzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAY29uc3RydWN0b3IKICAgKiBAcGFyYW0ge0FycmF5fSBbZW50cmllc10gVGhlIGtleS12YWx1ZSBwYWlycyB0byBjYWNoZS4KICAgKi8KICBmdW5jdGlvbiBNYXBDYWNoZShlbnRyaWVzKSB7CiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICBsZW5ndGggPSBlbnRyaWVzID09IG51bGwgPyAwIDogZW50cmllcy5sZW5ndGg7CgogICAgdGhpcy5jbGVhcigpOwogICAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgICAgdmFyIGVudHJ5ID0gZW50cmllc1tpbmRleF07CiAgICAgIHRoaXMuc2V0KGVudHJ5WzBdLCBlbnRyeVsxXSk7CiAgICB9CiAgfQoKICAvKioKICAgKiBSZW1vdmVzIGFsbCBrZXktdmFsdWUgZW50cmllcyBmcm9tIHRoZSBtYXAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIGNsZWFyCiAgICogQG1lbWJlck9mIE1hcENhY2hlCiAgICovCiAgZnVuY3Rpb24gbWFwQ2FjaGVDbGVhcigpIHsKICAgIHRoaXMuc2l6ZSA9IDA7CiAgICB0aGlzLl9fZGF0YV9fID0gewogICAgICAnaGFzaCc6IG5ldyBIYXNoLAogICAgICAnbWFwJzogbmV3IChNYXAgfHwgTGlzdENhY2hlKSwKICAgICAgJ3N0cmluZyc6IG5ldyBIYXNoCiAgICB9OwogIH0KCiAgLyoqCiAgICogUmVtb3ZlcyBga2V5YCBhbmQgaXRzIHZhbHVlIGZyb20gdGhlIG1hcC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgZGVsZXRlCiAgICogQG1lbWJlck9mIE1hcENhY2hlCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byByZW1vdmUuCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBlbnRyeSB3YXMgcmVtb3ZlZCwgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIG1hcENhY2hlRGVsZXRlKGtleSkgewogICAgdmFyIHJlc3VsdCA9IGdldE1hcERhdGEodGhpcywga2V5KVsnZGVsZXRlJ10oa2V5KTsKICAgIHRoaXMuc2l6ZSAtPSByZXN1bHQgPyAxIDogMDsKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBHZXRzIHRoZSBtYXAgdmFsdWUgZm9yIGBrZXlgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBnZXQKICAgKiBAbWVtYmVyT2YgTWFwQ2FjaGUKICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIGdldC4KICAgKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgZW50cnkgdmFsdWUuCiAgICovCiAgZnVuY3Rpb24gbWFwQ2FjaGVHZXQoa2V5KSB7CiAgICByZXR1cm4gZ2V0TWFwRGF0YSh0aGlzLCBrZXkpLmdldChrZXkpOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGEgbWFwIHZhbHVlIGZvciBga2V5YCBleGlzdHMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIGhhcwogICAqIEBtZW1iZXJPZiBNYXBDYWNoZQogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgZW50cnkgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGFuIGVudHJ5IGZvciBga2V5YCBleGlzdHMsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBtYXBDYWNoZUhhcyhrZXkpIHsKICAgIHJldHVybiBnZXRNYXBEYXRhKHRoaXMsIGtleSkuaGFzKGtleSk7CiAgfQoKICAvKioKICAgKiBTZXRzIHRoZSBtYXAgYGtleWAgdG8gYHZhbHVlYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgc2V0CiAgICogQG1lbWJlck9mIE1hcENhY2hlCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byBzZXQuCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gc2V0LgogICAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIG1hcCBjYWNoZSBpbnN0YW5jZS4KICAgKi8KICBmdW5jdGlvbiBtYXBDYWNoZVNldChrZXksIHZhbHVlKSB7CiAgICB2YXIgZGF0YSA9IGdldE1hcERhdGEodGhpcywga2V5KSwKICAgICAgICBzaXplID0gZGF0YS5zaXplOwoKICAgIGRhdGEuc2V0KGtleSwgdmFsdWUpOwogICAgdGhpcy5zaXplICs9IGRhdGEuc2l6ZSA9PSBzaXplID8gMCA6IDE7CiAgICByZXR1cm4gdGhpczsKICB9CgogIC8vIEFkZCBtZXRob2RzIHRvIGBNYXBDYWNoZWAuCiAgTWFwQ2FjaGUucHJvdG90eXBlLmNsZWFyID0gbWFwQ2FjaGVDbGVhcjsKICBNYXBDYWNoZS5wcm90b3R5cGVbJ2RlbGV0ZSddID0gbWFwQ2FjaGVEZWxldGU7CiAgTWFwQ2FjaGUucHJvdG90eXBlLmdldCA9IG1hcENhY2hlR2V0OwogIE1hcENhY2hlLnByb3RvdHlwZS5oYXMgPSBtYXBDYWNoZUhhczsKICBNYXBDYWNoZS5wcm90b3R5cGUuc2V0ID0gbWFwQ2FjaGVTZXQ7CgogIC8qKgogICAqCiAgICogQ3JlYXRlcyBhbiBhcnJheSBjYWNoZSBvYmplY3QgdG8gc3RvcmUgdW5pcXVlIHZhbHVlcy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQGNvbnN0cnVjdG9yCiAgICogQHBhcmFtIHtBcnJheX0gW3ZhbHVlc10gVGhlIHZhbHVlcyB0byBjYWNoZS4KICAgKi8KICBmdW5jdGlvbiBTZXRDYWNoZSh2YWx1ZXMpIHsKICAgIHZhciBpbmRleCA9IC0xLAogICAgICAgIGxlbmd0aCA9IHZhbHVlcyA9PSBudWxsID8gMCA6IHZhbHVlcy5sZW5ndGg7CgogICAgdGhpcy5fX2RhdGFfXyA9IG5ldyBNYXBDYWNoZTsKICAgIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICAgIHRoaXMuYWRkKHZhbHVlc1tpbmRleF0pOwogICAgfQogIH0KCiAgLyoqCiAgICogQWRkcyBgdmFsdWVgIHRvIHRoZSBhcnJheSBjYWNoZS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgYWRkCiAgICogQG1lbWJlck9mIFNldENhY2hlCiAgICogQGFsaWFzIHB1c2gKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjYWNoZS4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjYWNoZSBpbnN0YW5jZS4KICAgKi8KICBmdW5jdGlvbiBzZXRDYWNoZUFkZCh2YWx1ZSkgewogICAgdGhpcy5fX2RhdGFfXy5zZXQodmFsdWUsIEhBU0hfVU5ERUZJTkVEKTsKICAgIHJldHVybiB0aGlzOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgaW4gdGhlIGFycmF5IGNhY2hlLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBoYXMKICAgKiBAbWVtYmVyT2YgU2V0Q2FjaGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZWFyY2ggZm9yLgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgZm91bmQsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBzZXRDYWNoZUhhcyh2YWx1ZSkgewogICAgcmV0dXJuIHRoaXMuX19kYXRhX18uaGFzKHZhbHVlKTsKICB9CgogIC8vIEFkZCBtZXRob2RzIHRvIGBTZXRDYWNoZWAuCiAgU2V0Q2FjaGUucHJvdG90eXBlLmFkZCA9IFNldENhY2hlLnByb3RvdHlwZS5wdXNoID0gc2V0Q2FjaGVBZGQ7CiAgU2V0Q2FjaGUucHJvdG90eXBlLmhhcyA9IHNldENhY2hlSGFzOwoKICAvKioKICAgKiBDcmVhdGVzIGEgc3RhY2sgY2FjaGUgb2JqZWN0IHRvIHN0b3JlIGtleS12YWx1ZSBwYWlycy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQGNvbnN0cnVjdG9yCiAgICogQHBhcmFtIHtBcnJheX0gW2VudHJpZXNdIFRoZSBrZXktdmFsdWUgcGFpcnMgdG8gY2FjaGUuCiAgICovCiAgZnVuY3Rpb24gU3RhY2soZW50cmllcykgewogICAgdmFyIGRhdGEgPSB0aGlzLl9fZGF0YV9fID0gbmV3IExpc3RDYWNoZShlbnRyaWVzKTsKICAgIHRoaXMuc2l6ZSA9IGRhdGEuc2l6ZTsKICB9CgogIC8qKgogICAqIFJlbW92ZXMgYWxsIGtleS12YWx1ZSBlbnRyaWVzIGZyb20gdGhlIHN0YWNrLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBjbGVhcgogICAqIEBtZW1iZXJPZiBTdGFjawogICAqLwogIGZ1bmN0aW9uIHN0YWNrQ2xlYXIoKSB7CiAgICB0aGlzLl9fZGF0YV9fID0gbmV3IExpc3RDYWNoZTsKICAgIHRoaXMuc2l6ZSA9IDA7CiAgfQoKICAvKioKICAgKiBSZW1vdmVzIGBrZXlgIGFuZCBpdHMgdmFsdWUgZnJvbSB0aGUgc3RhY2suCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIGRlbGV0ZQogICAqIEBtZW1iZXJPZiBTdGFjawogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gcmVtb3ZlLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZW50cnkgd2FzIHJlbW92ZWQsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBzdGFja0RlbGV0ZShrZXkpIHsKICAgIHZhciBkYXRhID0gdGhpcy5fX2RhdGFfXywKICAgICAgICByZXN1bHQgPSBkYXRhWydkZWxldGUnXShrZXkpOwoKICAgIHRoaXMuc2l6ZSA9IGRhdGEuc2l6ZTsKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBHZXRzIHRoZSBzdGFjayB2YWx1ZSBmb3IgYGtleWAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBuYW1lIGdldAogICAqIEBtZW1iZXJPZiBTdGFjawogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gZ2V0LgogICAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBlbnRyeSB2YWx1ZS4KICAgKi8KICBmdW5jdGlvbiBzdGFja0dldChrZXkpIHsKICAgIHJldHVybiB0aGlzLl9fZGF0YV9fLmdldChrZXkpOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGEgc3RhY2sgdmFsdWUgZm9yIGBrZXlgIGV4aXN0cy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQG5hbWUgaGFzCiAgICogQG1lbWJlck9mIFN0YWNrCiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSBlbnRyeSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYW4gZW50cnkgZm9yIGBrZXlgIGV4aXN0cywgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIHN0YWNrSGFzKGtleSkgewogICAgcmV0dXJuIHRoaXMuX19kYXRhX18uaGFzKGtleSk7CiAgfQoKICAvKioKICAgKiBTZXRzIHRoZSBzdGFjayBga2V5YCB0byBgdmFsdWVgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAbmFtZSBzZXQKICAgKiBAbWVtYmVyT2YgU3RhY2sKICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIHNldC4KICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZXQuCiAgICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgc3RhY2sgY2FjaGUgaW5zdGFuY2UuCiAgICovCiAgZnVuY3Rpb24gc3RhY2tTZXQoa2V5LCB2YWx1ZSkgewogICAgdmFyIGRhdGEgPSB0aGlzLl9fZGF0YV9fOwogICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBMaXN0Q2FjaGUpIHsKICAgICAgdmFyIHBhaXJzID0gZGF0YS5fX2RhdGFfXzsKICAgICAgaWYgKCFNYXAgfHwgKHBhaXJzLmxlbmd0aCA8IExBUkdFX0FSUkFZX1NJWkUgLSAxKSkgewogICAgICAgIHBhaXJzLnB1c2goW2tleSwgdmFsdWVdKTsKICAgICAgICB0aGlzLnNpemUgPSArK2RhdGEuc2l6ZTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBkYXRhID0gdGhpcy5fX2RhdGFfXyA9IG5ldyBNYXBDYWNoZShwYWlycyk7CiAgICB9CiAgICBkYXRhLnNldChrZXksIHZhbHVlKTsKICAgIHRoaXMuc2l6ZSA9IGRhdGEuc2l6ZTsKICAgIHJldHVybiB0aGlzOwogIH0KCiAgLy8gQWRkIG1ldGhvZHMgdG8gYFN0YWNrYC4KICBTdGFjay5wcm90b3R5cGUuY2xlYXIgPSBzdGFja0NsZWFyOwogIFN0YWNrLnByb3RvdHlwZVsnZGVsZXRlJ10gPSBzdGFja0RlbGV0ZTsKICBTdGFjay5wcm90b3R5cGUuZ2V0ID0gc3RhY2tHZXQ7CiAgU3RhY2sucHJvdG90eXBlLmhhcyA9IHN0YWNrSGFzOwogIFN0YWNrLnByb3RvdHlwZS5zZXQgPSBzdGFja1NldDsKCiAgLyoqCiAgICogQ3JlYXRlcyBhbiBhcnJheSBvZiB0aGUgZW51bWVyYWJsZSBwcm9wZXJ0eSBuYW1lcyBvZiB0aGUgYXJyYXktbGlrZSBgdmFsdWVgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBxdWVyeS4KICAgKiBAcGFyYW0ge2Jvb2xlYW59IGluaGVyaXRlZCBTcGVjaWZ5IHJldHVybmluZyBpbmhlcml0ZWQgcHJvcGVydHkgbmFtZXMuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBvZiBwcm9wZXJ0eSBuYW1lcy4KICAgKi8KICBmdW5jdGlvbiBhcnJheUxpa2VLZXlzKHZhbHVlLCBpbmhlcml0ZWQpIHsKICAgIHZhciBpc0FyciA9IGlzQXJyYXkodmFsdWUpLAogICAgICAgIGlzQXJnID0gIWlzQXJyICYmIGlzQXJndW1lbnRzKHZhbHVlKSwKICAgICAgICBpc0J1ZmYgPSAhaXNBcnIgJiYgIWlzQXJnICYmIGlzQnVmZmVyKHZhbHVlKSwKICAgICAgICBpc1R5cGUgPSAhaXNBcnIgJiYgIWlzQXJnICYmICFpc0J1ZmYgJiYgaXNUeXBlZEFycmF5KHZhbHVlKSwKICAgICAgICBza2lwSW5kZXhlcyA9IGlzQXJyIHx8IGlzQXJnIHx8IGlzQnVmZiB8fCBpc1R5cGUsCiAgICAgICAgcmVzdWx0ID0gc2tpcEluZGV4ZXMgPyBiYXNlVGltZXModmFsdWUubGVuZ3RoLCBTdHJpbmcpIDogW10sCiAgICAgICAgbGVuZ3RoID0gcmVzdWx0Lmxlbmd0aDsKCiAgICBmb3IgKHZhciBrZXkgaW4gdmFsdWUpIHsKICAgICAgaWYgKChpbmhlcml0ZWQgfHwgaGFzT3duUHJvcGVydHkuY2FsbCh2YWx1ZSwga2V5KSkgJiYKICAgICAgICAgICEoc2tpcEluZGV4ZXMgJiYgKAogICAgICAgICAgICAgLy8gU2FmYXJpIDkgaGFzIGVudW1lcmFibGUgYGFyZ3VtZW50cy5sZW5ndGhgIGluIHN0cmljdCBtb2RlLgogICAgICAgICAgICAga2V5ID09ICdsZW5ndGgnIHx8CiAgICAgICAgICAgICAvLyBOb2RlLmpzIDAuMTAgaGFzIGVudW1lcmFibGUgbm9uLWluZGV4IHByb3BlcnRpZXMgb24gYnVmZmVycy4KICAgICAgICAgICAgIChpc0J1ZmYgJiYgKGtleSA9PSAnb2Zmc2V0JyB8fCBrZXkgPT0gJ3BhcmVudCcpKSB8fAogICAgICAgICAgICAgLy8gUGhhbnRvbUpTIDIgaGFzIGVudW1lcmFibGUgbm9uLWluZGV4IHByb3BlcnRpZXMgb24gdHlwZWQgYXJyYXlzLgogICAgICAgICAgICAgKGlzVHlwZSAmJiAoa2V5ID09ICdidWZmZXInIHx8IGtleSA9PSAnYnl0ZUxlbmd0aCcgfHwga2V5ID09ICdieXRlT2Zmc2V0JykpIHx8CiAgICAgICAgICAgICAvLyBTa2lwIGluZGV4IHByb3BlcnRpZXMuCiAgICAgICAgICAgICBpc0luZGV4KGtleSwgbGVuZ3RoKQogICAgICAgICAgKSkpIHsKICAgICAgICByZXN1bHQucHVzaChrZXkpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogR2V0cyB0aGUgaW5kZXggYXQgd2hpY2ggdGhlIGBrZXlgIGlzIGZvdW5kIGluIGBhcnJheWAgb2Yga2V5LXZhbHVlIHBhaXJzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBUaGUgYXJyYXkgdG8gaW5zcGVjdC4KICAgKiBAcGFyYW0geyp9IGtleSBUaGUga2V5IHRvIHNlYXJjaCBmb3IuCiAgICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIG1hdGNoZWQgdmFsdWUsIGVsc2UgYC0xYC4KICAgKi8KICBmdW5jdGlvbiBhc3NvY0luZGV4T2YoYXJyYXksIGtleSkgewogICAgdmFyIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDsKICAgIHdoaWxlIChsZW5ndGgtLSkgewogICAgICBpZiAoZXEoYXJyYXlbbGVuZ3RoXVswXSwga2V5KSkgewogICAgICAgIHJldHVybiBsZW5ndGg7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiAtMTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBnZXRBbGxLZXlzYCBhbmQgYGdldEFsbEtleXNJbmAgd2hpY2ggdXNlcwogICAqIGBrZXlzRnVuY2AgYW5kIGBzeW1ib2xzRnVuY2AgdG8gZ2V0IHRoZSBlbnVtZXJhYmxlIHByb3BlcnR5IG5hbWVzIGFuZAogICAqIHN5bWJvbHMgb2YgYG9iamVjdGAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBrZXlzRnVuYyBUaGUgZnVuY3Rpb24gdG8gZ2V0IHRoZSBrZXlzIG9mIGBvYmplY3RgLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IHN5bWJvbHNGdW5jIFRoZSBmdW5jdGlvbiB0byBnZXQgdGhlIHN5bWJvbHMgb2YgYG9iamVjdGAuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBvZiBwcm9wZXJ0eSBuYW1lcyBhbmQgc3ltYm9scy4KICAgKi8KICBmdW5jdGlvbiBiYXNlR2V0QWxsS2V5cyhvYmplY3QsIGtleXNGdW5jLCBzeW1ib2xzRnVuYykgewogICAgdmFyIHJlc3VsdCA9IGtleXNGdW5jKG9iamVjdCk7CiAgICByZXR1cm4gaXNBcnJheShvYmplY3QpID8gcmVzdWx0IDogYXJyYXlQdXNoKHJlc3VsdCwgc3ltYm9sc0Z1bmMob2JqZWN0KSk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgZ2V0VGFnYCB3aXRob3V0IGZhbGxiYWNrcyBmb3IgYnVnZ3kgZW52aXJvbm1lbnRzLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBxdWVyeS4KICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBgdG9TdHJpbmdUYWdgLgogICAqLwogIGZ1bmN0aW9uIGJhc2VHZXRUYWcodmFsdWUpIHsKICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgIHJldHVybiB2YWx1ZSA9PT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkVGFnIDogbnVsbFRhZzsKICAgIH0KICAgIHJldHVybiAoc3ltVG9TdHJpbmdUYWcgJiYgc3ltVG9TdHJpbmdUYWcgaW4gT2JqZWN0KHZhbHVlKSkKICAgICAgPyBnZXRSYXdUYWcodmFsdWUpCiAgICAgIDogb2JqZWN0VG9TdHJpbmcodmFsdWUpOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uaXNBcmd1bWVudHNgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhbiBgYXJndW1lbnRzYCBvYmplY3QsCiAgICovCiAgZnVuY3Rpb24gYmFzZUlzQXJndW1lbnRzKHZhbHVlKSB7CiAgICByZXR1cm4gaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBiYXNlR2V0VGFnKHZhbHVlKSA9PSBhcmdzVGFnOwogIH0KCiAgLyoqCiAgICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uaXNFcXVhbGAgd2hpY2ggc3VwcG9ydHMgcGFydGlhbCBjb21wYXJpc29ucwogICAqIGFuZCB0cmFja3MgdHJhdmVyc2VkIG9iamVjdHMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbXBhcmUuCiAgICogQHBhcmFtIHsqfSBvdGhlciBUaGUgb3RoZXIgdmFsdWUgdG8gY29tcGFyZS4KICAgKiBAcGFyYW0ge2Jvb2xlYW59IGJpdG1hc2sgVGhlIGJpdG1hc2sgZmxhZ3MuCiAgICogIDEgLSBVbm9yZGVyZWQgY29tcGFyaXNvbgogICAqICAyIC0gUGFydGlhbCBjb21wYXJpc29uCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2N1c3RvbWl6ZXJdIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgY29tcGFyaXNvbnMuCiAgICogQHBhcmFtIHtPYmplY3R9IFtzdGFja10gVHJhY2tzIHRyYXZlcnNlZCBgdmFsdWVgIGFuZCBgb3RoZXJgIG9iamVjdHMuCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSB2YWx1ZXMgYXJlIGVxdWl2YWxlbnQsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBiYXNlSXNFcXVhbCh2YWx1ZSwgb3RoZXIsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIHN0YWNrKSB7CiAgICBpZiAodmFsdWUgPT09IG90aGVyKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgaWYgKHZhbHVlID09IG51bGwgfHwgb3RoZXIgPT0gbnVsbCB8fCAoIWlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYgIWlzT2JqZWN0TGlrZShvdGhlcikpKSB7CiAgICAgIHJldHVybiB2YWx1ZSAhPT0gdmFsdWUgJiYgb3RoZXIgIT09IG90aGVyOwogICAgfQogICAgcmV0dXJuIGJhc2VJc0VxdWFsRGVlcCh2YWx1ZSwgb3RoZXIsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGJhc2VJc0VxdWFsLCBzdGFjayk7CiAgfQoKICAvKioKICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYGJhc2VJc0VxdWFsYCBmb3IgYXJyYXlzIGFuZCBvYmplY3RzIHdoaWNoIHBlcmZvcm1zCiAgICogZGVlcCBjb21wYXJpc29ucyBhbmQgdHJhY2tzIHRyYXZlcnNlZCBvYmplY3RzIGVuYWJsaW5nIG9iamVjdHMgd2l0aCBjaXJjdWxhcgogICAqIHJlZmVyZW5jZXMgdG8gYmUgY29tcGFyZWQuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBjb21wYXJlLgogICAqIEBwYXJhbSB7T2JqZWN0fSBvdGhlciBUaGUgb3RoZXIgb2JqZWN0IHRvIGNvbXBhcmUuCiAgICogQHBhcmFtIHtudW1iZXJ9IGJpdG1hc2sgVGhlIGJpdG1hc2sgZmxhZ3MuIFNlZSBgYmFzZUlzRXF1YWxgIGZvciBtb3JlIGRldGFpbHMuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY3VzdG9taXplciBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGNvbXBhcmlzb25zLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGVxdWFsRnVuYyBUaGUgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGVxdWl2YWxlbnRzIG9mIHZhbHVlcy4KICAgKiBAcGFyYW0ge09iamVjdH0gW3N0YWNrXSBUcmFja3MgdHJhdmVyc2VkIGBvYmplY3RgIGFuZCBgb3RoZXJgIG9iamVjdHMuCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBvYmplY3RzIGFyZSBlcXVpdmFsZW50LCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gYmFzZUlzRXF1YWxEZWVwKG9iamVjdCwgb3RoZXIsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGVxdWFsRnVuYywgc3RhY2spIHsKICAgIHZhciBvYmpJc0FyciA9IGlzQXJyYXkob2JqZWN0KSwKICAgICAgICBvdGhJc0FyciA9IGlzQXJyYXkob3RoZXIpLAogICAgICAgIG9ialRhZyA9IG9iaklzQXJyID8gYXJyYXlUYWcgOiBnZXRUYWcob2JqZWN0KSwKICAgICAgICBvdGhUYWcgPSBvdGhJc0FyciA/IGFycmF5VGFnIDogZ2V0VGFnKG90aGVyKTsKCiAgICBvYmpUYWcgPSBvYmpUYWcgPT0gYXJnc1RhZyA/IG9iamVjdFRhZyA6IG9ialRhZzsKICAgIG90aFRhZyA9IG90aFRhZyA9PSBhcmdzVGFnID8gb2JqZWN0VGFnIDogb3RoVGFnOwoKICAgIHZhciBvYmpJc09iaiA9IG9ialRhZyA9PSBvYmplY3RUYWcsCiAgICAgICAgb3RoSXNPYmogPSBvdGhUYWcgPT0gb2JqZWN0VGFnLAogICAgICAgIGlzU2FtZVRhZyA9IG9ialRhZyA9PSBvdGhUYWc7CgogICAgaWYgKGlzU2FtZVRhZyAmJiBpc0J1ZmZlcihvYmplY3QpKSB7CiAgICAgIGlmICghaXNCdWZmZXIob3RoZXIpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIG9iaklzQXJyID0gdHJ1ZTsKICAgICAgb2JqSXNPYmogPSBmYWxzZTsKICAgIH0KICAgIGlmIChpc1NhbWVUYWcgJiYgIW9iaklzT2JqKSB7CiAgICAgIHN0YWNrIHx8IChzdGFjayA9IG5ldyBTdGFjayk7CiAgICAgIHJldHVybiAob2JqSXNBcnIgfHwgaXNUeXBlZEFycmF5KG9iamVjdCkpCiAgICAgICAgPyBlcXVhbEFycmF5cyhvYmplY3QsIG90aGVyLCBiaXRtYXNrLCBjdXN0b21pemVyLCBlcXVhbEZ1bmMsIHN0YWNrKQogICAgICAgIDogZXF1YWxCeVRhZyhvYmplY3QsIG90aGVyLCBvYmpUYWcsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGVxdWFsRnVuYywgc3RhY2spOwogICAgfQogICAgaWYgKCEoYml0bWFzayAmIENPTVBBUkVfUEFSVElBTF9GTEFHKSkgewogICAgICB2YXIgb2JqSXNXcmFwcGVkID0gb2JqSXNPYmogJiYgaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsICdfX3dyYXBwZWRfXycpLAogICAgICAgICAgb3RoSXNXcmFwcGVkID0gb3RoSXNPYmogJiYgaGFzT3duUHJvcGVydHkuY2FsbChvdGhlciwgJ19fd3JhcHBlZF9fJyk7CgogICAgICBpZiAob2JqSXNXcmFwcGVkIHx8IG90aElzV3JhcHBlZCkgewogICAgICAgIHZhciBvYmpVbndyYXBwZWQgPSBvYmpJc1dyYXBwZWQgPyBvYmplY3QudmFsdWUoKSA6IG9iamVjdCwKICAgICAgICAgICAgb3RoVW53cmFwcGVkID0gb3RoSXNXcmFwcGVkID8gb3RoZXIudmFsdWUoKSA6IG90aGVyOwoKICAgICAgICBzdGFjayB8fCAoc3RhY2sgPSBuZXcgU3RhY2spOwogICAgICAgIHJldHVybiBlcXVhbEZ1bmMob2JqVW53cmFwcGVkLCBvdGhVbndyYXBwZWQsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIHN0YWNrKTsKICAgICAgfQogICAgfQogICAgaWYgKCFpc1NhbWVUYWcpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgc3RhY2sgfHwgKHN0YWNrID0gbmV3IFN0YWNrKTsKICAgIHJldHVybiBlcXVhbE9iamVjdHMob2JqZWN0LCBvdGhlciwgYml0bWFzaywgY3VzdG9taXplciwgZXF1YWxGdW5jLCBzdGFjayk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5pc05hdGl2ZWAgd2l0aG91dCBiYWQgc2hpbSBjaGVja3MuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgbmF0aXZlIGZ1bmN0aW9uLAogICAqICBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gYmFzZUlzTmF0aXZlKHZhbHVlKSB7CiAgICBpZiAoIWlzT2JqZWN0KHZhbHVlKSB8fCBpc01hc2tlZCh2YWx1ZSkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgdmFyIHBhdHRlcm4gPSBpc0Z1bmN0aW9uKHZhbHVlKSA/IHJlSXNOYXRpdmUgOiByZUlzSG9zdEN0b3I7CiAgICByZXR1cm4gcGF0dGVybi50ZXN0KHRvU291cmNlKHZhbHVlKSk7CiAgfQoKICAvKioKICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5pc1R5cGVkQXJyYXlgIHdpdGhvdXQgTm9kZS5qcyBvcHRpbWl6YXRpb25zLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHR5cGVkIGFycmF5LCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gYmFzZUlzVHlwZWRBcnJheSh2YWx1ZSkgewogICAgcmV0dXJuIGlzT2JqZWN0TGlrZSh2YWx1ZSkgJiYKICAgICAgaXNMZW5ndGgodmFsdWUubGVuZ3RoKSAmJiAhIXR5cGVkQXJyYXlUYWdzW2Jhc2VHZXRUYWcodmFsdWUpXTsKICB9CgogIC8qKgogICAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmtleXNgIHdoaWNoIGRvZXNuJ3QgdHJlYXQgc3BhcnNlIGFycmF5cyBhcyBkZW5zZS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LgogICAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgb2YgcHJvcGVydHkgbmFtZXMuCiAgICovCiAgZnVuY3Rpb24gYmFzZUtleXMob2JqZWN0KSB7CiAgICBpZiAoIWlzUHJvdG90eXBlKG9iamVjdCkpIHsKICAgICAgcmV0dXJuIG5hdGl2ZUtleXMob2JqZWN0KTsKICAgIH0KICAgIHZhciByZXN1bHQgPSBbXTsKICAgIGZvciAodmFyIGtleSBpbiBPYmplY3Qob2JqZWN0KSkgewogICAgICBpZiAoaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIGtleSkgJiYga2V5ICE9ICdjb25zdHJ1Y3RvcicpIHsKICAgICAgICByZXN1bHQucHVzaChrZXkpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBiYXNlSXNFcXVhbERlZXBgIGZvciBhcnJheXMgd2l0aCBzdXBwb3J0IGZvcgogICAqIHBhcnRpYWwgZGVlcCBjb21wYXJpc29ucy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGNvbXBhcmUuCiAgICogQHBhcmFtIHtBcnJheX0gb3RoZXIgVGhlIG90aGVyIGFycmF5IHRvIGNvbXBhcmUuCiAgICogQHBhcmFtIHtudW1iZXJ9IGJpdG1hc2sgVGhlIGJpdG1hc2sgZmxhZ3MuIFNlZSBgYmFzZUlzRXF1YWxgIGZvciBtb3JlIGRldGFpbHMuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY3VzdG9taXplciBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGNvbXBhcmlzb25zLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGVxdWFsRnVuYyBUaGUgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGVxdWl2YWxlbnRzIG9mIHZhbHVlcy4KICAgKiBAcGFyYW0ge09iamVjdH0gc3RhY2sgVHJhY2tzIHRyYXZlcnNlZCBgYXJyYXlgIGFuZCBgb3RoZXJgIG9iamVjdHMuCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBhcnJheXMgYXJlIGVxdWl2YWxlbnQsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBlcXVhbEFycmF5cyhhcnJheSwgb3RoZXIsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGVxdWFsRnVuYywgc3RhY2spIHsKICAgIHZhciBpc1BhcnRpYWwgPSBiaXRtYXNrICYgQ09NUEFSRV9QQVJUSUFMX0ZMQUcsCiAgICAgICAgYXJyTGVuZ3RoID0gYXJyYXkubGVuZ3RoLAogICAgICAgIG90aExlbmd0aCA9IG90aGVyLmxlbmd0aDsKCiAgICBpZiAoYXJyTGVuZ3RoICE9IG90aExlbmd0aCAmJiAhKGlzUGFydGlhbCAmJiBvdGhMZW5ndGggPiBhcnJMZW5ndGgpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8vIEFzc3VtZSBjeWNsaWMgdmFsdWVzIGFyZSBlcXVhbC4KICAgIHZhciBzdGFja2VkID0gc3RhY2suZ2V0KGFycmF5KTsKICAgIGlmIChzdGFja2VkICYmIHN0YWNrLmdldChvdGhlcikpIHsKICAgICAgcmV0dXJuIHN0YWNrZWQgPT0gb3RoZXI7CiAgICB9CiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgICByZXN1bHQgPSB0cnVlLAogICAgICAgIHNlZW4gPSAoYml0bWFzayAmIENPTVBBUkVfVU5PUkRFUkVEX0ZMQUcpID8gbmV3IFNldENhY2hlIDogdW5kZWZpbmVkOwoKICAgIHN0YWNrLnNldChhcnJheSwgb3RoZXIpOwogICAgc3RhY2suc2V0KG90aGVyLCBhcnJheSk7CgogICAgLy8gSWdub3JlIG5vbi1pbmRleCBwcm9wZXJ0aWVzLgogICAgd2hpbGUgKCsraW5kZXggPCBhcnJMZW5ndGgpIHsKICAgICAgdmFyIGFyclZhbHVlID0gYXJyYXlbaW5kZXhdLAogICAgICAgICAgb3RoVmFsdWUgPSBvdGhlcltpbmRleF07CgogICAgICBpZiAoY3VzdG9taXplcikgewogICAgICAgIHZhciBjb21wYXJlZCA9IGlzUGFydGlhbAogICAgICAgICAgPyBjdXN0b21pemVyKG90aFZhbHVlLCBhcnJWYWx1ZSwgaW5kZXgsIG90aGVyLCBhcnJheSwgc3RhY2spCiAgICAgICAgICA6IGN1c3RvbWl6ZXIoYXJyVmFsdWUsIG90aFZhbHVlLCBpbmRleCwgYXJyYXksIG90aGVyLCBzdGFjayk7CiAgICAgIH0KICAgICAgaWYgKGNvbXBhcmVkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBpZiAoY29tcGFyZWQpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICByZXN1bHQgPSBmYWxzZTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICAvLyBSZWN1cnNpdmVseSBjb21wYXJlIGFycmF5cyAoc3VzY2VwdGlibGUgdG8gY2FsbCBzdGFjayBsaW1pdHMpLgogICAgICBpZiAoc2VlbikgewogICAgICAgIGlmICghYXJyYXlTb21lKG90aGVyLCBmdW5jdGlvbihvdGhWYWx1ZSwgb3RoSW5kZXgpIHsKICAgICAgICAgICAgICBpZiAoIWNhY2hlSGFzKHNlZW4sIG90aEluZGV4KSAmJgogICAgICAgICAgICAgICAgICAoYXJyVmFsdWUgPT09IG90aFZhbHVlIHx8IGVxdWFsRnVuYyhhcnJWYWx1ZSwgb3RoVmFsdWUsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIHN0YWNrKSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZWVuLnB1c2gob3RoSW5kZXgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkpIHsKICAgICAgICAgIHJlc3VsdCA9IGZhbHNlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKCEoCiAgICAgICAgICAgIGFyclZhbHVlID09PSBvdGhWYWx1ZSB8fAogICAgICAgICAgICAgIGVxdWFsRnVuYyhhcnJWYWx1ZSwgb3RoVmFsdWUsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIHN0YWNrKQogICAgICAgICAgKSkgewogICAgICAgIHJlc3VsdCA9IGZhbHNlOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBzdGFja1snZGVsZXRlJ10oYXJyYXkpOwogICAgc3RhY2tbJ2RlbGV0ZSddKG90aGVyKTsKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYGJhc2VJc0VxdWFsRGVlcGAgZm9yIGNvbXBhcmluZyBvYmplY3RzIG9mCiAgICogdGhlIHNhbWUgYHRvU3RyaW5nVGFnYC4KICAgKgogICAqICoqTm90ZToqKiBUaGlzIGZ1bmN0aW9uIG9ubHkgc3VwcG9ydHMgY29tcGFyaW5nIHZhbHVlcyB3aXRoIHRhZ3Mgb2YKICAgKiBgQm9vbGVhbmAsIGBEYXRlYCwgYEVycm9yYCwgYE51bWJlcmAsIGBSZWdFeHBgLCBvciBgU3RyaW5nYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGNvbXBhcmUuCiAgICogQHBhcmFtIHtPYmplY3R9IG90aGVyIFRoZSBvdGhlciBvYmplY3QgdG8gY29tcGFyZS4KICAgKiBAcGFyYW0ge3N0cmluZ30gdGFnIFRoZSBgdG9TdHJpbmdUYWdgIG9mIHRoZSBvYmplY3RzIHRvIGNvbXBhcmUuCiAgICogQHBhcmFtIHtudW1iZXJ9IGJpdG1hc2sgVGhlIGJpdG1hc2sgZmxhZ3MuIFNlZSBgYmFzZUlzRXF1YWxgIGZvciBtb3JlIGRldGFpbHMuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY3VzdG9taXplciBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGNvbXBhcmlzb25zLgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGVxdWFsRnVuYyBUaGUgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGVxdWl2YWxlbnRzIG9mIHZhbHVlcy4KICAgKiBAcGFyYW0ge09iamVjdH0gc3RhY2sgVHJhY2tzIHRyYXZlcnNlZCBgb2JqZWN0YCBhbmQgYG90aGVyYCBvYmplY3RzLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgb2JqZWN0cyBhcmUgZXF1aXZhbGVudCwgZWxzZSBgZmFsc2VgLgogICAqLwogIGZ1bmN0aW9uIGVxdWFsQnlUYWcob2JqZWN0LCBvdGhlciwgdGFnLCBiaXRtYXNrLCBjdXN0b21pemVyLCBlcXVhbEZ1bmMsIHN0YWNrKSB7CiAgICBzd2l0Y2ggKHRhZykgewogICAgICBjYXNlIGRhdGFWaWV3VGFnOgogICAgICAgIGlmICgob2JqZWN0LmJ5dGVMZW5ndGggIT0gb3RoZXIuYnl0ZUxlbmd0aCkgfHwKICAgICAgICAgICAgKG9iamVjdC5ieXRlT2Zmc2V0ICE9IG90aGVyLmJ5dGVPZmZzZXQpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIG9iamVjdCA9IG9iamVjdC5idWZmZXI7CiAgICAgICAgb3RoZXIgPSBvdGhlci5idWZmZXI7CgogICAgICBjYXNlIGFycmF5QnVmZmVyVGFnOgogICAgICAgIGlmICgob2JqZWN0LmJ5dGVMZW5ndGggIT0gb3RoZXIuYnl0ZUxlbmd0aCkgfHwKICAgICAgICAgICAgIWVxdWFsRnVuYyhuZXcgVWludDhBcnJheShvYmplY3QpLCBuZXcgVWludDhBcnJheShvdGhlcikpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgY2FzZSBib29sVGFnOgogICAgICBjYXNlIGRhdGVUYWc6CiAgICAgIGNhc2UgbnVtYmVyVGFnOgogICAgICAgIC8vIENvZXJjZSBib29sZWFucyB0byBgMWAgb3IgYDBgIGFuZCBkYXRlcyB0byBtaWxsaXNlY29uZHMuCiAgICAgICAgLy8gSW52YWxpZCBkYXRlcyBhcmUgY29lcmNlZCB0byBgTmFOYC4KICAgICAgICByZXR1cm4gZXEoK29iamVjdCwgK290aGVyKTsKCiAgICAgIGNhc2UgZXJyb3JUYWc6CiAgICAgICAgcmV0dXJuIG9iamVjdC5uYW1lID09IG90aGVyLm5hbWUgJiYgb2JqZWN0Lm1lc3NhZ2UgPT0gb3RoZXIubWVzc2FnZTsKCiAgICAgIGNhc2UgcmVnZXhwVGFnOgogICAgICBjYXNlIHN0cmluZ1RhZzoKICAgICAgICAvLyBDb2VyY2UgcmVnZXhlcyB0byBzdHJpbmdzIGFuZCB0cmVhdCBzdHJpbmdzLCBwcmltaXRpdmVzIGFuZCBvYmplY3RzLAogICAgICAgIC8vIGFzIGVxdWFsLiBTZWUgaHR0cDovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLXJlZ2V4cC5wcm90b3R5cGUudG9zdHJpbmcKICAgICAgICAvLyBmb3IgbW9yZSBkZXRhaWxzLgogICAgICAgIHJldHVybiBvYmplY3QgPT0gKG90aGVyICsgJycpOwoKICAgICAgY2FzZSBtYXBUYWc6CiAgICAgICAgdmFyIGNvbnZlcnQgPSBtYXBUb0FycmF5OwoKICAgICAgY2FzZSBzZXRUYWc6CiAgICAgICAgdmFyIGlzUGFydGlhbCA9IGJpdG1hc2sgJiBDT01QQVJFX1BBUlRJQUxfRkxBRzsKICAgICAgICBjb252ZXJ0IHx8IChjb252ZXJ0ID0gc2V0VG9BcnJheSk7CgogICAgICAgIGlmIChvYmplY3Quc2l6ZSAhPSBvdGhlci5zaXplICYmICFpc1BhcnRpYWwpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgLy8gQXNzdW1lIGN5Y2xpYyB2YWx1ZXMgYXJlIGVxdWFsLgogICAgICAgIHZhciBzdGFja2VkID0gc3RhY2suZ2V0KG9iamVjdCk7CiAgICAgICAgaWYgKHN0YWNrZWQpIHsKICAgICAgICAgIHJldHVybiBzdGFja2VkID09IG90aGVyOwogICAgICAgIH0KICAgICAgICBiaXRtYXNrIHw9IENPTVBBUkVfVU5PUkRFUkVEX0ZMQUc7CgogICAgICAgIC8vIFJlY3Vyc2l2ZWx5IGNvbXBhcmUgb2JqZWN0cyAoc3VzY2VwdGlibGUgdG8gY2FsbCBzdGFjayBsaW1pdHMpLgogICAgICAgIHN0YWNrLnNldChvYmplY3QsIG90aGVyKTsKICAgICAgICB2YXIgcmVzdWx0ID0gZXF1YWxBcnJheXMoY29udmVydChvYmplY3QpLCBjb252ZXJ0KG90aGVyKSwgYml0bWFzaywgY3VzdG9taXplciwgZXF1YWxGdW5jLCBzdGFjayk7CiAgICAgICAgc3RhY2tbJ2RlbGV0ZSddKG9iamVjdCk7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKCiAgICAgIGNhc2Ugc3ltYm9sVGFnOgogICAgICAgIGlmIChzeW1ib2xWYWx1ZU9mKSB7CiAgICAgICAgICByZXR1cm4gc3ltYm9sVmFsdWVPZi5jYWxsKG9iamVjdCkgPT0gc3ltYm9sVmFsdWVPZi5jYWxsKG90aGVyKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICAvKioKICAgKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYGJhc2VJc0VxdWFsRGVlcGAgZm9yIG9iamVjdHMgd2l0aCBzdXBwb3J0IGZvcgogICAqIHBhcnRpYWwgZGVlcCBjb21wYXJpc29ucy4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIGNvbXBhcmUuCiAgICogQHBhcmFtIHtPYmplY3R9IG90aGVyIFRoZSBvdGhlciBvYmplY3QgdG8gY29tcGFyZS4KICAgKiBAcGFyYW0ge251bWJlcn0gYml0bWFzayBUaGUgYml0bWFzayBmbGFncy4gU2VlIGBiYXNlSXNFcXVhbGAgZm9yIG1vcmUgZGV0YWlscy4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjdXN0b21pemVyIFRoZSBmdW5jdGlvbiB0byBjdXN0b21pemUgY29tcGFyaXNvbnMuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZXF1YWxGdW5jIFRoZSBmdW5jdGlvbiB0byBkZXRlcm1pbmUgZXF1aXZhbGVudHMgb2YgdmFsdWVzLgogICAqIEBwYXJhbSB7T2JqZWN0fSBzdGFjayBUcmFja3MgdHJhdmVyc2VkIGBvYmplY3RgIGFuZCBgb3RoZXJgIG9iamVjdHMuCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBvYmplY3RzIGFyZSBlcXVpdmFsZW50LCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gZXF1YWxPYmplY3RzKG9iamVjdCwgb3RoZXIsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIGVxdWFsRnVuYywgc3RhY2spIHsKICAgIHZhciBpc1BhcnRpYWwgPSBiaXRtYXNrICYgQ09NUEFSRV9QQVJUSUFMX0ZMQUcsCiAgICAgICAgb2JqUHJvcHMgPSBnZXRBbGxLZXlzKG9iamVjdCksCiAgICAgICAgb2JqTGVuZ3RoID0gb2JqUHJvcHMubGVuZ3RoLAogICAgICAgIG90aFByb3BzID0gZ2V0QWxsS2V5cyhvdGhlciksCiAgICAgICAgb3RoTGVuZ3RoID0gb3RoUHJvcHMubGVuZ3RoOwoKICAgIGlmIChvYmpMZW5ndGggIT0gb3RoTGVuZ3RoICYmICFpc1BhcnRpYWwpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgdmFyIGluZGV4ID0gb2JqTGVuZ3RoOwogICAgd2hpbGUgKGluZGV4LS0pIHsKICAgICAgdmFyIGtleSA9IG9ialByb3BzW2luZGV4XTsKICAgICAgaWYgKCEoaXNQYXJ0aWFsID8ga2V5IGluIG90aGVyIDogaGFzT3duUHJvcGVydHkuY2FsbChvdGhlciwga2V5KSkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIC8vIEFzc3VtZSBjeWNsaWMgdmFsdWVzIGFyZSBlcXVhbC4KICAgIHZhciBzdGFja2VkID0gc3RhY2suZ2V0KG9iamVjdCk7CiAgICBpZiAoc3RhY2tlZCAmJiBzdGFjay5nZXQob3RoZXIpKSB7CiAgICAgIHJldHVybiBzdGFja2VkID09IG90aGVyOwogICAgfQogICAgdmFyIHJlc3VsdCA9IHRydWU7CiAgICBzdGFjay5zZXQob2JqZWN0LCBvdGhlcik7CiAgICBzdGFjay5zZXQob3RoZXIsIG9iamVjdCk7CgogICAgdmFyIHNraXBDdG9yID0gaXNQYXJ0aWFsOwogICAgd2hpbGUgKCsraW5kZXggPCBvYmpMZW5ndGgpIHsKICAgICAga2V5ID0gb2JqUHJvcHNbaW5kZXhdOwogICAgICB2YXIgb2JqVmFsdWUgPSBvYmplY3Rba2V5XSwKICAgICAgICAgIG90aFZhbHVlID0gb3RoZXJba2V5XTsKCiAgICAgIGlmIChjdXN0b21pemVyKSB7CiAgICAgICAgdmFyIGNvbXBhcmVkID0gaXNQYXJ0aWFsCiAgICAgICAgICA/IGN1c3RvbWl6ZXIob3RoVmFsdWUsIG9ialZhbHVlLCBrZXksIG90aGVyLCBvYmplY3QsIHN0YWNrKQogICAgICAgICAgOiBjdXN0b21pemVyKG9ialZhbHVlLCBvdGhWYWx1ZSwga2V5LCBvYmplY3QsIG90aGVyLCBzdGFjayk7CiAgICAgIH0KICAgICAgLy8gUmVjdXJzaXZlbHkgY29tcGFyZSBvYmplY3RzIChzdXNjZXB0aWJsZSB0byBjYWxsIHN0YWNrIGxpbWl0cykuCiAgICAgIGlmICghKGNvbXBhcmVkID09PSB1bmRlZmluZWQKICAgICAgICAgICAgPyAob2JqVmFsdWUgPT09IG90aFZhbHVlIHx8IGVxdWFsRnVuYyhvYmpWYWx1ZSwgb3RoVmFsdWUsIGJpdG1hc2ssIGN1c3RvbWl6ZXIsIHN0YWNrKSkKICAgICAgICAgICAgOiBjb21wYXJlZAogICAgICAgICAgKSkgewogICAgICAgIHJlc3VsdCA9IGZhbHNlOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHNraXBDdG9yIHx8IChza2lwQ3RvciA9IGtleSA9PSAnY29uc3RydWN0b3InKTsKICAgIH0KICAgIGlmIChyZXN1bHQgJiYgIXNraXBDdG9yKSB7CiAgICAgIHZhciBvYmpDdG9yID0gb2JqZWN0LmNvbnN0cnVjdG9yLAogICAgICAgICAgb3RoQ3RvciA9IG90aGVyLmNvbnN0cnVjdG9yOwoKICAgICAgLy8gTm9uIGBPYmplY3RgIG9iamVjdCBpbnN0YW5jZXMgd2l0aCBkaWZmZXJlbnQgY29uc3RydWN0b3JzIGFyZSBub3QgZXF1YWwuCiAgICAgIGlmIChvYmpDdG9yICE9IG90aEN0b3IgJiYKICAgICAgICAgICgnY29uc3RydWN0b3InIGluIG9iamVjdCAmJiAnY29uc3RydWN0b3InIGluIG90aGVyKSAmJgogICAgICAgICAgISh0eXBlb2Ygb2JqQ3RvciA9PSAnZnVuY3Rpb24nICYmIG9iakN0b3IgaW5zdGFuY2VvZiBvYmpDdG9yICYmCiAgICAgICAgICAgIHR5cGVvZiBvdGhDdG9yID09ICdmdW5jdGlvbicgJiYgb3RoQ3RvciBpbnN0YW5jZW9mIG90aEN0b3IpKSB7CiAgICAgICAgcmVzdWx0ID0gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIHN0YWNrWydkZWxldGUnXShvYmplY3QpOwogICAgc3RhY2tbJ2RlbGV0ZSddKG90aGVyKTsKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIG93biBlbnVtZXJhYmxlIHByb3BlcnR5IG5hbWVzIGFuZCBzeW1ib2xzIG9mIGBvYmplY3RgLgogICAqCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBvZiBwcm9wZXJ0eSBuYW1lcyBhbmQgc3ltYm9scy4KICAgKi8KICBmdW5jdGlvbiBnZXRBbGxLZXlzKG9iamVjdCkgewogICAgcmV0dXJuIGJhc2VHZXRBbGxLZXlzKG9iamVjdCwga2V5cywgZ2V0U3ltYm9scyk7CiAgfQoKICAvKioKICAgKiBHZXRzIHRoZSBkYXRhIGZvciBgbWFwYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtPYmplY3R9IG1hcCBUaGUgbWFwIHRvIHF1ZXJ5LgogICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIHJlZmVyZW5jZSBrZXkuCiAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIG1hcCBkYXRhLgogICAqLwogIGZ1bmN0aW9uIGdldE1hcERhdGEobWFwLCBrZXkpIHsKICAgIHZhciBkYXRhID0gbWFwLl9fZGF0YV9fOwogICAgcmV0dXJuIGlzS2V5YWJsZShrZXkpCiAgICAgID8gZGF0YVt0eXBlb2Yga2V5ID09ICdzdHJpbmcnID8gJ3N0cmluZycgOiAnaGFzaCddCiAgICAgIDogZGF0YS5tYXA7CiAgfQoKICAvKioKICAgKiBHZXRzIHRoZSBuYXRpdmUgZnVuY3Rpb24gYXQgYGtleWAgb2YgYG9iamVjdGAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS4KICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIG1ldGhvZCB0byBnZXQuCiAgICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGZ1bmN0aW9uIGlmIGl0J3MgbmF0aXZlLCBlbHNlIGB1bmRlZmluZWRgLgogICAqLwogIGZ1bmN0aW9uIGdldE5hdGl2ZShvYmplY3QsIGtleSkgewogICAgdmFyIHZhbHVlID0gZ2V0VmFsdWUob2JqZWN0LCBrZXkpOwogICAgcmV0dXJuIGJhc2VJc05hdGl2ZSh2YWx1ZSkgPyB2YWx1ZSA6IHVuZGVmaW5lZDsKICB9CgogIC8qKgogICAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgYmFzZUdldFRhZ2Agd2hpY2ggaWdub3JlcyBgU3ltYm9sLnRvU3RyaW5nVGFnYCB2YWx1ZXMuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHF1ZXJ5LgogICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIHJhdyBgdG9TdHJpbmdUYWdgLgogICAqLwogIGZ1bmN0aW9uIGdldFJhd1RhZyh2YWx1ZSkgewogICAgdmFyIGlzT3duID0gaGFzT3duUHJvcGVydHkuY2FsbCh2YWx1ZSwgc3ltVG9TdHJpbmdUYWcpLAogICAgICAgIHRhZyA9IHZhbHVlW3N5bVRvU3RyaW5nVGFnXTsKCiAgICB0cnkgewogICAgICB2YWx1ZVtzeW1Ub1N0cmluZ1RhZ10gPSB1bmRlZmluZWQ7CiAgICAgIHZhciB1bm1hc2tlZCA9IHRydWU7CiAgICB9IGNhdGNoIChlKSB7fQoKICAgIHZhciByZXN1bHQgPSBuYXRpdmVPYmplY3RUb1N0cmluZy5jYWxsKHZhbHVlKTsKICAgIGlmICh1bm1hc2tlZCkgewogICAgICBpZiAoaXNPd24pIHsKICAgICAgICB2YWx1ZVtzeW1Ub1N0cmluZ1RhZ10gPSB0YWc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGVsZXRlIHZhbHVlW3N5bVRvU3RyaW5nVGFnXTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIC8qKgogICAqIENyZWF0ZXMgYW4gYXJyYXkgb2YgdGhlIG93biBlbnVtZXJhYmxlIHN5bWJvbHMgb2YgYG9iamVjdGAuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHN5bWJvbHMuCiAgICovCiAgdmFyIGdldFN5bWJvbHMgPSAhbmF0aXZlR2V0U3ltYm9scyA/IHN0dWJBcnJheSA6IGZ1bmN0aW9uKG9iamVjdCkgewogICAgaWYgKG9iamVjdCA9PSBudWxsKSB7CiAgICAgIHJldHVybiBbXTsKICAgIH0KICAgIG9iamVjdCA9IE9iamVjdChvYmplY3QpOwogICAgcmV0dXJuIGFycmF5RmlsdGVyKG5hdGl2ZUdldFN5bWJvbHMob2JqZWN0KSwgZnVuY3Rpb24oc3ltYm9sKSB7CiAgICAgIHJldHVybiBwcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKG9iamVjdCwgc3ltYm9sKTsKICAgIH0pOwogIH07CgogIC8qKgogICAqIEdldHMgdGhlIGB0b1N0cmluZ1RhZ2Agb2YgYHZhbHVlYC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcXVlcnkuCiAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgYHRvU3RyaW5nVGFnYC4KICAgKi8KICB2YXIgZ2V0VGFnID0gYmFzZUdldFRhZzsKCiAgLy8gRmFsbGJhY2sgZm9yIGRhdGEgdmlld3MsIG1hcHMsIHNldHMsIGFuZCB3ZWFrIG1hcHMgaW4gSUUgMTEgYW5kIHByb21pc2VzIGluIE5vZGUuanMgPCA2LgogIGlmICgoRGF0YVZpZXcgJiYgZ2V0VGFnKG5ldyBEYXRhVmlldyhuZXcgQXJyYXlCdWZmZXIoMSkpKSAhPSBkYXRhVmlld1RhZykgfHwKICAgICAgKE1hcCAmJiBnZXRUYWcobmV3IE1hcCkgIT0gbWFwVGFnKSB8fAogICAgICAoUHJvbWlzZSAmJiBnZXRUYWcoUHJvbWlzZS5yZXNvbHZlKCkpICE9IHByb21pc2VUYWcpIHx8CiAgICAgIChTZXQgJiYgZ2V0VGFnKG5ldyBTZXQpICE9IHNldFRhZykgfHwKICAgICAgKFdlYWtNYXAgJiYgZ2V0VGFnKG5ldyBXZWFrTWFwKSAhPSB3ZWFrTWFwVGFnKSkgewogICAgZ2V0VGFnID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgdmFyIHJlc3VsdCA9IGJhc2VHZXRUYWcodmFsdWUpLAogICAgICAgICAgQ3RvciA9IHJlc3VsdCA9PSBvYmplY3RUYWcgPyB2YWx1ZS5jb25zdHJ1Y3RvciA6IHVuZGVmaW5lZCwKICAgICAgICAgIGN0b3JTdHJpbmcgPSBDdG9yID8gdG9Tb3VyY2UoQ3RvcikgOiAnJzsKCiAgICAgIGlmIChjdG9yU3RyaW5nKSB7CiAgICAgICAgc3dpdGNoIChjdG9yU3RyaW5nKSB7CiAgICAgICAgICBjYXNlIGRhdGFWaWV3Q3RvclN0cmluZzogcmV0dXJuIGRhdGFWaWV3VGFnOwogICAgICAgICAgY2FzZSBtYXBDdG9yU3RyaW5nOiByZXR1cm4gbWFwVGFnOwogICAgICAgICAgY2FzZSBwcm9taXNlQ3RvclN0cmluZzogcmV0dXJuIHByb21pc2VUYWc7CiAgICAgICAgICBjYXNlIHNldEN0b3JTdHJpbmc6IHJldHVybiBzZXRUYWc7CiAgICAgICAgICBjYXNlIHdlYWtNYXBDdG9yU3RyaW5nOiByZXR1cm4gd2Vha01hcFRhZzsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH07CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBhIHZhbGlkIGFycmF5LWxpa2UgaW5kZXguCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEBwYXJhbSB7bnVtYmVyfSBbbGVuZ3RoPU1BWF9TQUZFX0lOVEVHRVJdIFRoZSB1cHBlciBib3VuZHMgb2YgYSB2YWxpZCBpbmRleC4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHZhbGlkIGluZGV4LCBlbHNlIGBmYWxzZWAuCiAgICovCiAgZnVuY3Rpb24gaXNJbmRleCh2YWx1ZSwgbGVuZ3RoKSB7CiAgICBsZW5ndGggPSBsZW5ndGggPT0gbnVsbCA/IE1BWF9TQUZFX0lOVEVHRVIgOiBsZW5ndGg7CiAgICByZXR1cm4gISFsZW5ndGggJiYKICAgICAgKHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJyB8fCByZUlzVWludC50ZXN0KHZhbHVlKSkgJiYKICAgICAgKHZhbHVlID4gLTEgJiYgdmFsdWUgJSAxID09IDAgJiYgdmFsdWUgPCBsZW5ndGgpOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgc3VpdGFibGUgZm9yIHVzZSBhcyB1bmlxdWUgb2JqZWN0IGtleS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgc3VpdGFibGUsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBpc0tleWFibGUodmFsdWUpIHsKICAgIHZhciB0eXBlID0gdHlwZW9mIHZhbHVlOwogICAgcmV0dXJuICh0eXBlID09ICdzdHJpbmcnIHx8IHR5cGUgPT0gJ251bWJlcicgfHwgdHlwZSA9PSAnc3ltYm9sJyB8fCB0eXBlID09ICdib29sZWFuJykKICAgICAgPyAodmFsdWUgIT09ICdfX3Byb3RvX18nKQogICAgICA6ICh2YWx1ZSA9PT0gbnVsbCk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYGZ1bmNgIGhhcyBpdHMgc291cmNlIG1hc2tlZC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGBmdW5jYCBpcyBtYXNrZWQsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBpc01hc2tlZChmdW5jKSB7CiAgICByZXR1cm4gISFtYXNrU3JjS2V5ICYmIChtYXNrU3JjS2V5IGluIGZ1bmMpOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgbGlrZWx5IGEgcHJvdG90eXBlIG9iamVjdC4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBwcm90b3R5cGUsIGVsc2UgYGZhbHNlYC4KICAgKi8KICBmdW5jdGlvbiBpc1Byb3RvdHlwZSh2YWx1ZSkgewogICAgdmFyIEN0b3IgPSB2YWx1ZSAmJiB2YWx1ZS5jb25zdHJ1Y3RvciwKICAgICAgICBwcm90byA9ICh0eXBlb2YgQ3RvciA9PSAnZnVuY3Rpb24nICYmIEN0b3IucHJvdG90eXBlKSB8fCBvYmplY3RQcm90bzsKCiAgICByZXR1cm4gdmFsdWUgPT09IHByb3RvOwogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYHZhbHVlYCB0byBhIHN0cmluZyB1c2luZyBgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZ2AuCiAgICoKICAgKiBAcHJpdmF0ZQogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbnZlcnQuCiAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgY29udmVydGVkIHN0cmluZy4KICAgKi8KICBmdW5jdGlvbiBvYmplY3RUb1N0cmluZyh2YWx1ZSkgewogICAgcmV0dXJuIG5hdGl2ZU9iamVjdFRvU3RyaW5nLmNhbGwodmFsdWUpOwogIH0KCiAgLyoqCiAgICogQ29udmVydHMgYGZ1bmNgIHRvIGl0cyBzb3VyY2UgY29kZS4KICAgKgogICAqIEBwcml2YXRlCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyBUaGUgZnVuY3Rpb24gdG8gY29udmVydC4KICAgKiBAcmV0dXJucyB7c3RyaW5nfSBSZXR1cm5zIHRoZSBzb3VyY2UgY29kZS4KICAgKi8KICBmdW5jdGlvbiB0b1NvdXJjZShmdW5jKSB7CiAgICBpZiAoZnVuYyAhPSBudWxsKSB7CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIGZ1bmNUb1N0cmluZy5jYWxsKGZ1bmMpOwogICAgICB9IGNhdGNoIChlKSB7fQogICAgICB0cnkgewogICAgICAgIHJldHVybiAoZnVuYyArICcnKTsKICAgICAgfSBjYXRjaCAoZSkge30KICAgIH0KICAgIHJldHVybiAnJzsKICB9CgogIC8qKgogICAqIFBlcmZvcm1zIGEKICAgKiBbYFNhbWVWYWx1ZVplcm9gXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1zYW1ldmFsdWV6ZXJvKQogICAqIGNvbXBhcmlzb24gYmV0d2VlbiB0d28gdmFsdWVzIHRvIGRldGVybWluZSBpZiB0aGV5IGFyZSBlcXVpdmFsZW50LgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMC4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb21wYXJlLgogICAqIEBwYXJhbSB7Kn0gb3RoZXIgVGhlIG90aGVyIHZhbHVlIHRvIGNvbXBhcmUuCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSB2YWx1ZXMgYXJlIGVxdWl2YWxlbnQsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogdmFyIG9iamVjdCA9IHsgJ2EnOiAxIH07CiAgICogdmFyIG90aGVyID0geyAnYSc6IDEgfTsKICAgKgogICAqIF8uZXEob2JqZWN0LCBvYmplY3QpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uZXEob2JqZWN0LCBvdGhlcik7CiAgICogLy8gPT4gZmFsc2UKICAgKgogICAqIF8uZXEoJ2EnLCAnYScpOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uZXEoJ2EnLCBPYmplY3QoJ2EnKSk7CiAgICogLy8gPT4gZmFsc2UKICAgKgogICAqIF8uZXEoTmFOLCBOYU4pOwogICAqIC8vID0+IHRydWUKICAgKi8KICBmdW5jdGlvbiBlcSh2YWx1ZSwgb3RoZXIpIHsKICAgIHJldHVybiB2YWx1ZSA9PT0gb3RoZXIgfHwgKHZhbHVlICE9PSB2YWx1ZSAmJiBvdGhlciAhPT0gb3RoZXIpOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgbGlrZWx5IGFuIGBhcmd1bWVudHNgIG9iamVjdC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYW4gYGFyZ3VtZW50c2Agb2JqZWN0LAogICAqICBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uaXNBcmd1bWVudHMoZnVuY3Rpb24oKSB7IHJldHVybiBhcmd1bWVudHM7IH0oKSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0FyZ3VtZW50cyhbMSwgMiwgM10pOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgdmFyIGlzQXJndW1lbnRzID0gYmFzZUlzQXJndW1lbnRzKGZ1bmN0aW9uKCkgeyByZXR1cm4gYXJndW1lbnRzOyB9KCkpID8gYmFzZUlzQXJndW1lbnRzIDogZnVuY3Rpb24odmFsdWUpIHsKICAgIHJldHVybiBpc09iamVjdExpa2UodmFsdWUpICYmIGhhc093blByb3BlcnR5LmNhbGwodmFsdWUsICdjYWxsZWUnKSAmJgogICAgICAhcHJvcGVydHlJc0VudW1lcmFibGUuY2FsbCh2YWx1ZSwgJ2NhbGxlZScpOwogIH07CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYW4gYEFycmF5YCBvYmplY3QuCiAgICoKICAgKiBAc3RhdGljCiAgICogQG1lbWJlck9mIF8KICAgKiBAc2luY2UgMC4xLjAKICAgKiBAY2F0ZWdvcnkgTGFuZwogICAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGFuIGFycmF5LCBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uaXNBcnJheShbMSwgMiwgM10pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNBcnJheShkb2N1bWVudC5ib2R5LmNoaWxkcmVuKTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5pc0FycmF5KCdhYmMnKTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5pc0FycmF5KF8ubm9vcCk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICB2YXIgaXNBcnJheSA9IEFycmF5LmlzQXJyYXk7CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGFycmF5LWxpa2UuIEEgdmFsdWUgaXMgY29uc2lkZXJlZCBhcnJheS1saWtlIGlmIGl0J3MKICAgKiBub3QgYSBmdW5jdGlvbiBhbmQgaGFzIGEgYHZhbHVlLmxlbmd0aGAgdGhhdCdzIGFuIGludGVnZXIgZ3JlYXRlciB0aGFuIG9yCiAgICogZXF1YWwgdG8gYDBgIGFuZCBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gYE51bWJlci5NQVhfU0FGRV9JTlRFR0VSYC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYXJyYXktbGlrZSwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzQXJyYXlMaWtlKFsxLCAyLCAzXSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0FycmF5TGlrZShkb2N1bWVudC5ib2R5LmNoaWxkcmVuKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzQXJyYXlMaWtlKCdhYmMnKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzQXJyYXlMaWtlKF8ubm9vcCk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICBmdW5jdGlvbiBpc0FycmF5TGlrZSh2YWx1ZSkgewogICAgcmV0dXJuIHZhbHVlICE9IG51bGwgJiYgaXNMZW5ndGgodmFsdWUubGVuZ3RoKSAmJiAhaXNGdW5jdGlvbih2YWx1ZSk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBhIGJ1ZmZlci4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjMuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBidWZmZXIsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc0J1ZmZlcihuZXcgQnVmZmVyKDIpKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzQnVmZmVyKG5ldyBVaW50OEFycmF5KDIpKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIHZhciBpc0J1ZmZlciA9IG5hdGl2ZUlzQnVmZmVyIHx8IHN0dWJGYWxzZTsKCiAgLyoqCiAgICogUGVyZm9ybXMgYSBkZWVwIGNvbXBhcmlzb24gYmV0d2VlbiB0d28gdmFsdWVzIHRvIGRldGVybWluZSBpZiB0aGV5IGFyZQogICAqIGVxdWl2YWxlbnQuCiAgICoKICAgKiAqKk5vdGU6KiogVGhpcyBtZXRob2Qgc3VwcG9ydHMgY29tcGFyaW5nIGFycmF5cywgYXJyYXkgYnVmZmVycywgYm9vbGVhbnMsCiAgICogZGF0ZSBvYmplY3RzLCBlcnJvciBvYmplY3RzLCBtYXBzLCBudW1iZXJzLCBgT2JqZWN0YCBvYmplY3RzLCByZWdleGVzLAogICAqIHNldHMsIHN0cmluZ3MsIHN5bWJvbHMsIGFuZCB0eXBlZCBhcnJheXMuIGBPYmplY3RgIG9iamVjdHMgYXJlIGNvbXBhcmVkCiAgICogYnkgdGhlaXIgb3duLCBub3QgaW5oZXJpdGVkLCBlbnVtZXJhYmxlIHByb3BlcnRpZXMuIEZ1bmN0aW9ucyBhbmQgRE9NCiAgICogbm9kZXMgYXJlIGNvbXBhcmVkIGJ5IHN0cmljdCBlcXVhbGl0eSwgaS5lLiBgPT09YC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29tcGFyZS4KICAgKiBAcGFyYW0geyp9IG90aGVyIFRoZSBvdGhlciB2YWx1ZSB0byBjb21wYXJlLgogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgdmFsdWVzIGFyZSBlcXVpdmFsZW50LCBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIHZhciBvYmplY3QgPSB7ICdhJzogMSB9OwogICAqIHZhciBvdGhlciA9IHsgJ2EnOiAxIH07CiAgICoKICAgKiBfLmlzRXF1YWwob2JqZWN0LCBvdGhlcik7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogb2JqZWN0ID09PSBvdGhlcjsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIGZ1bmN0aW9uIGlzRXF1YWwodmFsdWUsIG90aGVyKSB7CiAgICByZXR1cm4gYmFzZUlzRXF1YWwodmFsdWUsIG90aGVyKTsKICB9CgogIC8qKgogICAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYSBgRnVuY3Rpb25gIG9iamVjdC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBmdW5jdGlvbiwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzRnVuY3Rpb24oXyk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc0Z1bmN0aW9uKC9hYmMvKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIGZ1bmN0aW9uIGlzRnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICghaXNPYmplY3QodmFsdWUpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8vIFRoZSB1c2Ugb2YgYE9iamVjdCN0b1N0cmluZ2AgYXZvaWRzIGlzc3VlcyB3aXRoIHRoZSBgdHlwZW9mYCBvcGVyYXRvcgogICAgLy8gaW4gU2FmYXJpIDkgd2hpY2ggcmV0dXJucyAnb2JqZWN0JyBmb3IgdHlwZWQgYXJyYXlzIGFuZCBvdGhlciBjb25zdHJ1Y3RvcnMuCiAgICB2YXIgdGFnID0gYmFzZUdldFRhZyh2YWx1ZSk7CiAgICByZXR1cm4gdGFnID09IGZ1bmNUYWcgfHwgdGFnID09IGdlblRhZyB8fCB0YWcgPT0gYXN5bmNUYWcgfHwgdGFnID09IHByb3h5VGFnOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYSB2YWxpZCBhcnJheS1saWtlIGxlbmd0aC4KICAgKgogICAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBpcyBsb29zZWx5IGJhc2VkIG9uCiAgICogW2BUb0xlbmd0aGBdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLXRvbGVuZ3RoKS4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjAuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSB2YWxpZCBsZW5ndGgsIGVsc2UgYGZhbHNlYC4KICAgKiBAZXhhbXBsZQogICAqCiAgICogXy5pc0xlbmd0aCgzKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzTGVuZ3RoKE51bWJlci5NSU5fVkFMVUUpOwogICAqIC8vID0+IGZhbHNlCiAgICoKICAgKiBfLmlzTGVuZ3RoKEluZmluaXR5KTsKICAgKiAvLyA9PiBmYWxzZQogICAqCiAgICogXy5pc0xlbmd0aCgnMycpOwogICAqIC8vID0+IGZhbHNlCiAgICovCiAgZnVuY3Rpb24gaXNMZW5ndGgodmFsdWUpIHsKICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ251bWJlcicgJiYKICAgICAgdmFsdWUgPiAtMSAmJiB2YWx1ZSAlIDEgPT0gMCAmJiB2YWx1ZSA8PSBNQVhfU0FGRV9JTlRFR0VSOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgdGhlCiAgICogW2xhbmd1YWdlIHR5cGVdKGh0dHA6Ly93d3cuZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1lY21hc2NyaXB0LWxhbmd1YWdlLXR5cGVzKQogICAqIG9mIGBPYmplY3RgLiAoZS5nLiBhcnJheXMsIGZ1bmN0aW9ucywgb2JqZWN0cywgcmVnZXhlcywgYG5ldyBOdW1iZXIoMClgLCBhbmQgYG5ldyBTdHJpbmcoJycpYCkKICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSAwLjEuMAogICAqIEBjYXRlZ29yeSBMYW5nCiAgICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAgICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYW4gb2JqZWN0LCBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uaXNPYmplY3Qoe30pOwogICAqIC8vID0+IHRydWUKICAgKgogICAqIF8uaXNPYmplY3QoWzEsIDIsIDNdKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzT2JqZWN0KF8ubm9vcCk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc09iamVjdChudWxsKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIGZ1bmN0aW9uIGlzT2JqZWN0KHZhbHVlKSB7CiAgICB2YXIgdHlwZSA9IHR5cGVvZiB2YWx1ZTsKICAgIHJldHVybiB2YWx1ZSAhPSBudWxsICYmICh0eXBlID09ICdvYmplY3QnIHx8IHR5cGUgPT0gJ2Z1bmN0aW9uJyk7CiAgfQoKICAvKioKICAgKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBvYmplY3QtbGlrZS4gQSB2YWx1ZSBpcyBvYmplY3QtbGlrZSBpZiBpdCdzIG5vdCBgbnVsbGAKICAgKiBhbmQgaGFzIGEgYHR5cGVvZmAgcmVzdWx0IG9mICJvYmplY3QiLgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMC4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBvYmplY3QtbGlrZSwgZWxzZSBgZmFsc2VgLgogICAqIEBleGFtcGxlCiAgICoKICAgKiBfLmlzT2JqZWN0TGlrZSh7fSk7CiAgICogLy8gPT4gdHJ1ZQogICAqCiAgICogXy5pc09iamVjdExpa2UoWzEsIDIsIDNdKTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzT2JqZWN0TGlrZShfLm5vb3ApOwogICAqIC8vID0+IGZhbHNlCiAgICoKICAgKiBfLmlzT2JqZWN0TGlrZShudWxsKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIGZ1bmN0aW9uIGlzT2JqZWN0TGlrZSh2YWx1ZSkgewogICAgcmV0dXJuIHZhbHVlICE9IG51bGwgJiYgdHlwZW9mIHZhbHVlID09ICdvYmplY3QnOwogIH0KCiAgLyoqCiAgICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgY2xhc3NpZmllZCBhcyBhIHR5cGVkIGFycmF5LgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDMuMC4wCiAgICogQGNhdGVnb3J5IExhbmcKICAgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHR5cGVkIGFycmF5LCBlbHNlIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8uaXNUeXBlZEFycmF5KG5ldyBVaW50OEFycmF5KTsKICAgKiAvLyA9PiB0cnVlCiAgICoKICAgKiBfLmlzVHlwZWRBcnJheShbXSk7CiAgICogLy8gPT4gZmFsc2UKICAgKi8KICB2YXIgaXNUeXBlZEFycmF5ID0gbm9kZUlzVHlwZWRBcnJheSA/IGJhc2VVbmFyeShub2RlSXNUeXBlZEFycmF5KSA6IGJhc2VJc1R5cGVkQXJyYXk7CgogIC8qKgogICAqIENyZWF0ZXMgYW4gYXJyYXkgb2YgdGhlIG93biBlbnVtZXJhYmxlIHByb3BlcnR5IG5hbWVzIG9mIGBvYmplY3RgLgogICAqCiAgICogKipOb3RlOioqIE5vbi1vYmplY3QgdmFsdWVzIGFyZSBjb2VyY2VkIHRvIG9iamVjdHMuIFNlZSB0aGUKICAgKiBbRVMgc3BlY10oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtb2JqZWN0LmtleXMpCiAgICogZm9yIG1vcmUgZGV0YWlscy4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAc2luY2UgMC4xLjAKICAgKiBAbWVtYmVyT2YgXwogICAqIEBjYXRlZ29yeSBPYmplY3QKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBvZiBwcm9wZXJ0eSBuYW1lcy4KICAgKiBAZXhhbXBsZQogICAqCiAgICogZnVuY3Rpb24gRm9vKCkgewogICAqICAgdGhpcy5hID0gMTsKICAgKiAgIHRoaXMuYiA9IDI7CiAgICogfQogICAqCiAgICogRm9vLnByb3RvdHlwZS5jID0gMzsKICAgKgogICAqIF8ua2V5cyhuZXcgRm9vKTsKICAgKiAvLyA9PiBbJ2EnLCAnYiddIChpdGVyYXRpb24gb3JkZXIgaXMgbm90IGd1YXJhbnRlZWQpCiAgICoKICAgKiBfLmtleXMoJ2hpJyk7CiAgICogLy8gPT4gWycwJywgJzEnXQogICAqLwogIGZ1bmN0aW9uIGtleXMob2JqZWN0KSB7CiAgICByZXR1cm4gaXNBcnJheUxpa2Uob2JqZWN0KSA/IGFycmF5TGlrZUtleXMob2JqZWN0KSA6IGJhc2VLZXlzKG9iamVjdCk7CiAgfQoKICAvKioKICAgKiBUaGlzIG1ldGhvZCByZXR1cm5zIGEgbmV3IGVtcHR5IGFycmF5LgogICAqCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBfCiAgICogQHNpbmNlIDQuMTMuMAogICAqIEBjYXRlZ29yeSBVdGlsCiAgICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgZW1wdHkgYXJyYXkuCiAgICogQGV4YW1wbGUKICAgKgogICAqIHZhciBhcnJheXMgPSBfLnRpbWVzKDIsIF8uc3R1YkFycmF5KTsKICAgKgogICAqIGNvbnNvbGUubG9nKGFycmF5cyk7CiAgICogLy8gPT4gW1tdLCBbXV0KICAgKgogICAqIGNvbnNvbGUubG9nKGFycmF5c1swXSA9PT0gYXJyYXlzWzFdKTsKICAgKiAvLyA9PiBmYWxzZQogICAqLwogIGZ1bmN0aW9uIHN0dWJBcnJheSgpIHsKICAgIHJldHVybiBbXTsKICB9CgogIC8qKgogICAqIFRoaXMgbWV0aG9kIHJldHVybnMgYGZhbHNlYC4KICAgKgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgXwogICAqIEBzaW5jZSA0LjEzLjAKICAgKiBAY2F0ZWdvcnkgVXRpbAogICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGBmYWxzZWAuCiAgICogQGV4YW1wbGUKICAgKgogICAqIF8udGltZXMoMiwgXy5zdHViRmFsc2UpOwogICAqIC8vID0+IFtmYWxzZSwgZmFsc2VdCiAgICovCiAgZnVuY3Rpb24gc3R1YkZhbHNlKCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgbW9kdWxlLmV4cG9ydHMgPSBpc0VxdWFsOwogIH0pOwoKICB2YXIgZGlzdCQzID0gY3JlYXRlQ29tbW9uanNNb2R1bGUkMShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgIWZ1bmN0aW9uKHQsZSl7bW9kdWxlLmV4cG9ydHM9ZShkaXN0JDYscmVxdWlyZSQkMiQxLHJlcXVpcmUkJDIsbG9kYXNoX3Rocm90dGxlLHJlcXVpcmUkJDEscmVxdWlyZSQkNCxsb2Rhc2hfaXNlcXVhbCk7fShjb21tb25qc0dsb2JhbCwoZnVuY3Rpb24odCxlLG4scixvLGksYSl7ZnVuY3Rpb24gbCh0KXtyZXR1cm4gdCYmIm9iamVjdCI9PXR5cGVvZiB0JiYiZGVmYXVsdCJpbiB0P3Q6e2RlZmF1bHQ6dH19dmFyIHU9bChyKSxjPWwobykscz1sKGEpO3QuaTE4bkFkZFJlc291cmNlcygiZW4iLHt0YWJsZU1vZHVsZTp7ZGVsZXRlQ29sOiJEZWxldGUgY29sdW1uIixkZWxldGVSb3c6IkRlbGV0ZSByb3ciLGRlbGV0ZVRhYmxlOiJEZWxldGUgdGFibGUiLHdpZHRoQXV0bzoiV2lkdGggYXV0byIsaW5zZXJ0Q29sOiJJbnNlcnQgY29sdW1uIixpbnNlcnRSb3c6Ikluc2VydCByb3ciLGluc2VydFRhYmxlOiJJbnNlcnQgdGFibGUiLGhlYWRlcjoiSGVhZGVyIn19KSx0LmkxOG5BZGRSZXNvdXJjZXMoInpoLUNOIix7dGFibGVNb2R1bGU6e2RlbGV0ZUNvbDoi5Yig6Zmk5YiXIixkZWxldGVSb3c6IuWIoOmZpOihjCIsZGVsZXRlVGFibGU6IuWIoOmZpOihqOagvCIsd2lkdGhBdXRvOiLlrr3luqboh6rpgILlupQiLGluc2VydENvbDoi5o+S5YWl5YiXIixpbnNlcnRSb3c6IuaPkuWFpeihjCIsaW5zZXJ0VGFibGU6IuaPkuWFpeihqOagvCIsaGVhZGVyOiLooajlpLQifX0pO3ZhciBmPSJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsVGhpcz9nbG9iYWxUaGlzOiJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93P3dpbmRvdzoidW5kZWZpbmVkIiE9dHlwZW9mIGNvbW1vbmpzR2xvYmFsP2NvbW1vbmpzR2xvYmFsOiJ1bmRlZmluZWQiIT10eXBlb2Ygc2VsZj9zZWxmOnt9O2Z1bmN0aW9uIGQodCl7dmFyIGU9e2V4cG9ydHM6e319O3JldHVybiB0KGUsZS5leHBvcnRzKSxlLmV4cG9ydHN9dmFyIHAsdixoPWZ1bmN0aW9uKHQpe3JldHVybiB0JiZ0Lk1hdGg9PU1hdGgmJnR9LGc9aCgib2JqZWN0Ij09dHlwZW9mIGdsb2JhbFRoaXMmJmdsb2JhbFRoaXMpfHxoKCJvYmplY3QiPT10eXBlb2Ygd2luZG93JiZ3aW5kb3cpfHxoKCJvYmplY3QiPT10eXBlb2Ygc2VsZiYmc2VsZil8fGgoIm9iamVjdCI9PXR5cGVvZiBmJiZmKXx8ZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30oKXx8RnVuY3Rpb24oInJldHVybiB0aGlzIikoKSx5PWZ1bmN0aW9uKHQpe3RyeXtyZXR1cm4gISF0KCl9Y2F0Y2godCl7cmV0dXJuICEwfX0sbT0heSgoZnVuY3Rpb24oKXtyZXR1cm4gNyE9T2JqZWN0LmRlZmluZVByb3BlcnR5KHt9LDEse2dldDpmdW5jdGlvbigpe3JldHVybiA3fX0pWzFdfSkpLGI9RnVuY3Rpb24ucHJvdG90eXBlLmNhbGwsRT1iLmJpbmQ/Yi5iaW5kKGIpOmZ1bmN0aW9uKCl7cmV0dXJuIGIuYXBwbHkoYixhcmd1bWVudHMpfSx3PXt9LnByb3BlcnR5SXNFbnVtZXJhYmxlLHg9T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcixTPXtmOngmJiF3LmNhbGwoezE6Mn0sMSk/ZnVuY3Rpb24odCl7dmFyIGU9eCh0aGlzLHQpO3JldHVybiAhIWUmJmUuZW51bWVyYWJsZX06d30sVD1mdW5jdGlvbih0LGUpe3JldHVybiB7ZW51bWVyYWJsZTohKDEmdCksY29uZmlndXJhYmxlOiEoMiZ0KSx3cml0YWJsZTohKDQmdCksdmFsdWU6ZX19LEQ9RnVuY3Rpb24ucHJvdG90eXBlLE49RC5iaW5kLFA9RC5jYWxsLE09TiYmTi5iaW5kKFApLFI9Tj9mdW5jdGlvbih0KXtyZXR1cm4gdCYmTShQLHQpfTpmdW5jdGlvbih0KXtyZXR1cm4gdCYmZnVuY3Rpb24oKXtyZXR1cm4gUC5hcHBseSh0LGFyZ3VtZW50cyl9fSxPPVIoe30udG9TdHJpbmcpLEg9UigiIi5zbGljZSksVj1mdW5jdGlvbih0KXtyZXR1cm4gSChPKHQpLDgsLTEpfSx6PWcuT2JqZWN0LGo9UigiIi5zcGxpdCksTD15KChmdW5jdGlvbigpe3JldHVybiAheigieiIpLnByb3BlcnR5SXNFbnVtZXJhYmxlKDApfSkpP2Z1bmN0aW9uKHQpe3JldHVybiAiU3RyaW5nIj09Vih0KT9qKHQsIiIpOnoodCl9OnosQT1nLlR5cGVFcnJvcixDPWZ1bmN0aW9uKHQpe2lmKG51bGw9PXQpdGhyb3cgQSgiQ2FuJ3QgY2FsbCBtZXRob2Qgb24gIit0KTtyZXR1cm4gdH0sST1mdW5jdGlvbih0KXtyZXR1cm4gTChDKHQpKX0saz1mdW5jdGlvbih0KXtyZXR1cm4gImZ1bmN0aW9uIj09dHlwZW9mIHR9LEI9ZnVuY3Rpb24odCl7cmV0dXJuICJvYmplY3QiPT10eXBlb2YgdD9udWxsIT09dDprKHQpfSwkPWZ1bmN0aW9uKHQpe3JldHVybiBrKHQpP3Q6dm9pZCAwfSxGPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8Mj8kKGdbdF0pOmdbdF0mJmdbdF1bZV19LHE9Uih7fS5pc1Byb3RvdHlwZU9mKSxHPUYoIm5hdmlnYXRvciIsInVzZXJBZ2VudCIpfHwiIixfPWcucHJvY2VzcyxXPWcuRGVubyxVPV8mJl8udmVyc2lvbnN8fFcmJlcudmVyc2lvbixYPVUmJlUudjg7WCYmKHY9KHA9WC5zcGxpdCgiLiIpKVswXT4wJiZwWzBdPDQ/MTorKHBbMF0rcFsxXSkpLCF2JiZHJiYoIShwPUcubWF0Y2goL0VkZ2VcLyhcZCspLykpfHxwWzFdPj03NCkmJihwPUcubWF0Y2goL0Nocm9tZVwvKFxkKykvKSkmJih2PStwWzFdKTt2YXIgWT12LEs9ISFPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzJiYheSgoZnVuY3Rpb24oKXt2YXIgdD1TeW1ib2woKTtyZXR1cm4gIVN0cmluZyh0KXx8IShPYmplY3QodClpbnN0YW5jZW9mIFN5bWJvbCl8fCFTeW1ib2wuc2hhbSYmWSYmWTw0MX0pKSxKPUsmJiFTeW1ib2wuc2hhbSYmInN5bWJvbCI9PXR5cGVvZiBTeW1ib2wuaXRlcmF0b3IsUT1nLk9iamVjdCxaPUo/ZnVuY3Rpb24odCl7cmV0dXJuICJzeW1ib2wiPT10eXBlb2YgdH06ZnVuY3Rpb24odCl7dmFyIGU9RigiU3ltYm9sIik7cmV0dXJuIGsoZSkmJnEoZS5wcm90b3R5cGUsUSh0KSl9LHR0PWcuU3RyaW5nLGV0PWZ1bmN0aW9uKHQpe3RyeXtyZXR1cm4gdHQodCl9Y2F0Y2godCl7cmV0dXJuICJPYmplY3QifX0sbnQ9Zy5UeXBlRXJyb3IscnQ9ZnVuY3Rpb24odCl7aWYoayh0KSlyZXR1cm4gdDt0aHJvdyBudChldCh0KSsiIGlzIG5vdCBhIGZ1bmN0aW9uIil9LG90PWZ1bmN0aW9uKHQsZSl7dmFyIG49dFtlXTtyZXR1cm4gbnVsbD09bj92b2lkIDA6cnQobil9LGl0PWcuVHlwZUVycm9yLGF0PU9iamVjdC5kZWZpbmVQcm9wZXJ0eSxsdD1mdW5jdGlvbih0LGUpe3RyeXthdChnLHQse3ZhbHVlOmUsY29uZmlndXJhYmxlOiEwLHdyaXRhYmxlOiEwfSk7fWNhdGNoKG4pe2dbdF09ZTt9cmV0dXJuIGV9LHV0PSJfX2NvcmUtanNfc2hhcmVkX18iLGN0PWdbdXRdfHxsdCh1dCx7fSksc3Q9ZCgoZnVuY3Rpb24odCl7KHQuZXhwb3J0cz1mdW5jdGlvbih0LGUpe3JldHVybiBjdFt0XXx8KGN0W3RdPXZvaWQgMCE9PWU/ZTp7fSl9KSgidmVyc2lvbnMiLFtdKS5wdXNoKHt2ZXJzaW9uOiIzLjE5LjMiLG1vZGU6Imdsb2JhbCIsY29weXJpZ2h0OiLCqSAyMDIxIERlbmlzIFB1c2hrYXJldiAoemxvaXJvY2sucnUpIn0pO30pKSxmdD1nLk9iamVjdCxkdD1mdW5jdGlvbih0KXtyZXR1cm4gZnQoQyh0KSl9LHB0PVIoe30uaGFzT3duUHJvcGVydHkpLHZ0PU9iamVjdC5oYXNPd258fGZ1bmN0aW9uKHQsZSl7cmV0dXJuIHB0KGR0KHQpLGUpfSxodD0wLGd0PU1hdGgucmFuZG9tKCkseXQ9UigxLi50b1N0cmluZyksbXQ9ZnVuY3Rpb24odCl7cmV0dXJuICJTeW1ib2woIisodm9pZCAwPT09dD8iIjp0KSsiKV8iK3l0KCsraHQrZ3QsMzYpfSxidD1zdCgid2tzIiksRXQ9Zy5TeW1ib2wsd3Q9RXQmJkV0LmZvcix4dD1KP0V0OkV0JiZFdC53aXRob3V0U2V0dGVyfHxtdCxTdD1mdW5jdGlvbih0KXtpZighdnQoYnQsdCl8fCFLJiYic3RyaW5nIiE9dHlwZW9mIGJ0W3RdKXt2YXIgZT0iU3ltYm9sLiIrdDtLJiZ2dChFdCx0KT9idFt0XT1FdFt0XTpidFt0XT1KJiZ3dD93dChlKTp4dChlKTt9cmV0dXJuIGJ0W3RdfSxUdD1nLlR5cGVFcnJvcixEdD1TdCgidG9QcmltaXRpdmUiKSxOdD1mdW5jdGlvbih0LGUpe2lmKCFCKHQpfHxaKHQpKXJldHVybiB0O3ZhciBuLHI9b3QodCxEdCk7aWYocil7aWYodm9pZCAwPT09ZSYmKGU9ImRlZmF1bHQiKSxuPUUocix0LGUpLCFCKG4pfHxaKG4pKXJldHVybiBuO3Rocm93IFR0KCJDYW4ndCBjb252ZXJ0IG9iamVjdCB0byBwcmltaXRpdmUgdmFsdWUiKX1yZXR1cm4gdm9pZCAwPT09ZSYmKGU9Im51bWJlciIpLGZ1bmN0aW9uKHQsZSl7dmFyIG4scjtpZigic3RyaW5nIj09PWUmJmsobj10LnRvU3RyaW5nKSYmIUIocj1FKG4sdCkpKXJldHVybiByO2lmKGsobj10LnZhbHVlT2YpJiYhQihyPUUobix0KSkpcmV0dXJuIHI7aWYoInN0cmluZyIhPT1lJiZrKG49dC50b1N0cmluZykmJiFCKHI9RShuLHQpKSlyZXR1cm4gcjt0aHJvdyBpdCgiQ2FuJ3QgY29udmVydCBvYmplY3QgdG8gcHJpbWl0aXZlIHZhbHVlIil9KHQsZSl9LFB0PWZ1bmN0aW9uKHQpe3ZhciBlPU50KHQsInN0cmluZyIpO3JldHVybiBaKGUpP2U6ZSsiIn0sTXQ9Zy5kb2N1bWVudCxSdD1CKE10KSYmQihNdC5jcmVhdGVFbGVtZW50KSxPdD1mdW5jdGlvbih0KXtyZXR1cm4gUnQ/TXQuY3JlYXRlRWxlbWVudCh0KTp7fX0sSHQ9IW0mJiF5KChmdW5jdGlvbigpe3JldHVybiA3IT1PYmplY3QuZGVmaW5lUHJvcGVydHkoT3QoImRpdiIpLCJhIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIDd9fSkuYX0pKSxWdD1PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLHp0PXtmOm0/VnQ6ZnVuY3Rpb24odCxlKXtpZih0PUkodCksZT1QdChlKSxIdCl0cnl7cmV0dXJuIFZ0KHQsZSl9Y2F0Y2godCl7fWlmKHZ0KHQsZSkpcmV0dXJuIFQoIUUoUy5mLHQsZSksdFtlXSl9fSxqdD1nLlN0cmluZyxMdD1nLlR5cGVFcnJvcixBdD1mdW5jdGlvbih0KXtpZihCKHQpKXJldHVybiB0O3Rocm93IEx0KGp0KHQpKyIgaXMgbm90IGFuIG9iamVjdCIpfSxDdD1nLlR5cGVFcnJvcixJdD1PYmplY3QuZGVmaW5lUHJvcGVydHksa3Q9e2Y6bT9JdDpmdW5jdGlvbih0LGUsbil7aWYoQXQodCksZT1QdChlKSxBdChuKSxIdCl0cnl7cmV0dXJuIEl0KHQsZSxuKX1jYXRjaCh0KXt9aWYoImdldCJpbiBufHwic2V0ImluIG4pdGhyb3cgQ3QoIkFjY2Vzc29ycyBub3Qgc3VwcG9ydGVkIik7cmV0dXJuICJ2YWx1ZSJpbiBuJiYodFtlXT1uLnZhbHVlKSx0fX0sQnQ9bT9mdW5jdGlvbih0LGUsbil7cmV0dXJuIGt0LmYodCxlLFQoMSxuKSl9OmZ1bmN0aW9uKHQsZSxuKXtyZXR1cm4gdFtlXT1uLHR9LCR0PVIoRnVuY3Rpb24udG9TdHJpbmcpO2soY3QuaW5zcGVjdFNvdXJjZSl8fChjdC5pbnNwZWN0U291cmNlPWZ1bmN0aW9uKHQpe3JldHVybiAkdCh0KX0pO3ZhciBGdCxxdCxHdCxfdD1jdC5pbnNwZWN0U291cmNlLFd0PWcuV2Vha01hcCxVdD1rKFd0KSYmL25hdGl2ZSBjb2RlLy50ZXN0KF90KFd0KSksWHQ9c3QoImtleXMiKSxZdD1mdW5jdGlvbih0KXtyZXR1cm4gWHRbdF18fChYdFt0XT1tdCh0KSl9LEt0PXt9LEp0PSJPYmplY3QgYWxyZWFkeSBpbml0aWFsaXplZCIsUXQ9Zy5UeXBlRXJyb3IsWnQ9Zy5XZWFrTWFwO2lmKFV0fHxjdC5zdGF0ZSl7dmFyIHRlPWN0LnN0YXRlfHwoY3Quc3RhdGU9bmV3IFp0KSxlZT1SKHRlLmdldCksbmU9Uih0ZS5oYXMpLHJlPVIodGUuc2V0KTtGdD1mdW5jdGlvbih0LGUpe2lmKG5lKHRlLHQpKXRocm93IG5ldyBRdChKdCk7cmV0dXJuIGUuZmFjYWRlPXQscmUodGUsdCxlKSxlfSxxdD1mdW5jdGlvbih0KXtyZXR1cm4gZWUodGUsdCl8fHt9fSxHdD1mdW5jdGlvbih0KXtyZXR1cm4gbmUodGUsdCl9O31lbHNlIHt2YXIgb2U9WXQoInN0YXRlIik7S3Rbb2VdPSEwLEZ0PWZ1bmN0aW9uKHQsZSl7aWYodnQodCxvZSkpdGhyb3cgbmV3IFF0KEp0KTtyZXR1cm4gZS5mYWNhZGU9dCxCdCh0LG9lLGUpLGV9LHF0PWZ1bmN0aW9uKHQpe3JldHVybiB2dCh0LG9lKT90W29lXTp7fX0sR3Q9ZnVuY3Rpb24odCl7cmV0dXJuIHZ0KHQsb2UpfTt9dmFyIGllPXtzZXQ6RnQsZ2V0OnF0LGhhczpHdCxlbmZvcmNlOmZ1bmN0aW9uKHQpe3JldHVybiBHdCh0KT9xdCh0KTpGdCh0LHt9KX0sZ2V0dGVyRm9yOmZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihlKXt2YXIgbjtpZighQihlKXx8KG49cXQoZSkpLnR5cGUhPT10KXRocm93IFF0KCJJbmNvbXBhdGlibGUgcmVjZWl2ZXIsICIrdCsiIHJlcXVpcmVkIik7cmV0dXJuIG59fX0sYWU9RnVuY3Rpb24ucHJvdG90eXBlLGxlPW0mJk9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IsdWU9dnQoYWUsIm5hbWUiKSxjZT17RVhJU1RTOnVlLFBST1BFUjp1ZSYmInNvbWV0aGluZyI9PT1mdW5jdGlvbigpe30ubmFtZSxDT05GSUdVUkFCTEU6dWUmJighbXx8bSYmbGUoYWUsIm5hbWUiKS5jb25maWd1cmFibGUpfSxzZT1kKChmdW5jdGlvbih0KXt2YXIgZT1jZS5DT05GSUdVUkFCTEUsbj1pZS5nZXQscj1pZS5lbmZvcmNlLG89U3RyaW5nKFN0cmluZykuc3BsaXQoIlN0cmluZyIpOyh0LmV4cG9ydHM9ZnVuY3Rpb24odCxuLGksYSl7dmFyIGwsdT0hIWEmJiEhYS51bnNhZmUsYz0hIWEmJiEhYS5lbnVtZXJhYmxlLHM9ISFhJiYhIWEubm9UYXJnZXRHZXQsZj1hJiZ2b2lkIDAhPT1hLm5hbWU/YS5uYW1lOm47ayhpKSYmKCJTeW1ib2woIj09PVN0cmluZyhmKS5zbGljZSgwLDcpJiYoZj0iWyIrU3RyaW5nKGYpLnJlcGxhY2UoL15TeW1ib2xcKChbXildKilcKS8sIiQxIikrIl0iKSwoIXZ0KGksIm5hbWUiKXx8ZSYmaS5uYW1lIT09ZikmJkJ0KGksIm5hbWUiLGYpLChsPXIoaSkpLnNvdXJjZXx8KGwuc291cmNlPW8uam9pbigic3RyaW5nIj09dHlwZW9mIGY/ZjoiIikpKSx0IT09Zz8odT8hcyYmdFtuXSYmKGM9ITApOmRlbGV0ZSB0W25dLGM/dFtuXT1pOkJ0KHQsbixpKSk6Yz90W25dPWk6bHQobixpKTt9KShGdW5jdGlvbi5wcm90b3R5cGUsInRvU3RyaW5nIiwoZnVuY3Rpb24oKXtyZXR1cm4gayh0aGlzKSYmbih0aGlzKS5zb3VyY2V8fF90KHRoaXMpfSkpO30pKSxmZT1NYXRoLmNlaWwsZGU9TWF0aC5mbG9vcixwZT1mdW5jdGlvbih0KXt2YXIgZT0rdDtyZXR1cm4gZSE9ZXx8MD09PWU/MDooZT4wP2RlOmZlKShlKX0sdmU9TWF0aC5tYXgsaGU9TWF0aC5taW4sZ2U9ZnVuY3Rpb24odCxlKXt2YXIgbj1wZSh0KTtyZXR1cm4gbjwwP3ZlKG4rZSwwKTpoZShuLGUpfSx5ZT1NYXRoLm1pbixtZT1mdW5jdGlvbih0KXtyZXR1cm4gdD4wP3llKHBlKHQpLDkwMDcxOTkyNTQ3NDA5OTEpOjB9LGJlPWZ1bmN0aW9uKHQpe3JldHVybiBtZSh0Lmxlbmd0aCl9LEVlPWZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihlLG4scil7dmFyIG8saT1JKGUpLGE9YmUoaSksbD1nZShyLGEpO2lmKHQmJm4hPW4pe2Zvcig7YT5sOylpZigobz1pW2wrK10pIT1vKXJldHVybiAhMH1lbHNlIGZvcig7YT5sO2wrKylpZigodHx8bCBpbiBpKSYmaVtsXT09PW4pcmV0dXJuIHR8fGx8fDA7cmV0dXJuICF0JiYtMX19LHdlPXtpbmNsdWRlczpFZSghMCksaW5kZXhPZjpFZSghMSl9LmluZGV4T2YseGU9UihbXS5wdXNoKSxTZT1mdW5jdGlvbih0LGUpe3ZhciBuLHI9SSh0KSxvPTAsaT1bXTtmb3IobiBpbiByKSF2dChLdCxuKSYmdnQocixuKSYmeGUoaSxuKTtmb3IoO2UubGVuZ3RoPm87KXZ0KHIsbj1lW28rK10pJiYofndlKGksbil8fHhlKGksbikpO3JldHVybiBpfSxUZT1bImNvbnN0cnVjdG9yIiwiaGFzT3duUHJvcGVydHkiLCJpc1Byb3RvdHlwZU9mIiwicHJvcGVydHlJc0VudW1lcmFibGUiLCJ0b0xvY2FsZVN0cmluZyIsInRvU3RyaW5nIiwidmFsdWVPZiJdLERlPVRlLmNvbmNhdCgibGVuZ3RoIiwicHJvdG90eXBlIiksTmU9e2Y6T2JqZWN0LmdldE93blByb3BlcnR5TmFtZXN8fGZ1bmN0aW9uKHQpe3JldHVybiBTZSh0LERlKX19LFBlPXtmOk9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHN9LE1lPVIoW10uY29uY2F0KSxSZT1GKCJSZWZsZWN0Iiwib3duS2V5cyIpfHxmdW5jdGlvbih0KXt2YXIgZT1OZS5mKEF0KHQpKSxuPVBlLmY7cmV0dXJuIG4/TWUoZSxuKHQpKTplfSxPZT1mdW5jdGlvbih0LGUpe2Zvcih2YXIgbj1SZShlKSxyPWt0LmYsbz16dC5mLGk9MDtpPG4ubGVuZ3RoO2krKyl7dmFyIGE9bltpXTt2dCh0LGEpfHxyKHQsYSxvKGUsYSkpO319LEhlPS8jfFwucHJvdG90eXBlXC4vLFZlPWZ1bmN0aW9uKHQsZSl7dmFyIG49amVbemUodCldO3JldHVybiBuPT1BZXx8biE9TGUmJihrKGUpP3koZSk6ISFlKX0semU9VmUubm9ybWFsaXplPWZ1bmN0aW9uKHQpe3JldHVybiBTdHJpbmcodCkucmVwbGFjZShIZSwiLiIpLnRvTG93ZXJDYXNlKCl9LGplPVZlLmRhdGE9e30sTGU9VmUuTkFUSVZFPSJOIixBZT1WZS5QT0xZRklMTD0iUCIsQ2U9VmUsSWU9enQuZixrZT1mdW5jdGlvbih0LGUpe3ZhciBuLHIsbyxpLGEsbD10LnRhcmdldCx1PXQuZ2xvYmFsLGM9dC5zdGF0O2lmKG49dT9nOmM/Z1tsXXx8bHQobCx7fSk6KGdbbF18fHt9KS5wcm90b3R5cGUpZm9yKHIgaW4gZSl7aWYoaT1lW3JdLG89dC5ub1RhcmdldEdldD8oYT1JZShuLHIpKSYmYS52YWx1ZTpuW3JdLCFDZSh1P3I6bCsoYz8iLiI6IiMiKStyLHQuZm9yY2VkKSYmdm9pZCAwIT09byl7aWYodHlwZW9mIGk9PXR5cGVvZiBvKWNvbnRpbnVlO09lKGksbyk7fSh0LnNoYW18fG8mJm8uc2hhbSkmJkJ0KGksInNoYW0iLCEwKSxzZShuLHIsaSx0KTt9fSxCZT17fTtCZVtTdCgidG9TdHJpbmdUYWciKV09InoiO3ZhciAkZSxGZT0iW29iamVjdCB6XSI9PT1TdHJpbmcoQmUpLHFlPVN0KCJ0b1N0cmluZ1RhZyIpLEdlPWcuT2JqZWN0LF9lPSJBcmd1bWVudHMiPT1WKGZ1bmN0aW9uKCl7cmV0dXJuIGFyZ3VtZW50c30oKSksV2U9RmU/VjpmdW5jdGlvbih0KXt2YXIgZSxuLHI7cmV0dXJuIHZvaWQgMD09PXQ/IlVuZGVmaW5lZCI6bnVsbD09PXQ/Ik51bGwiOiJzdHJpbmciPT10eXBlb2Yobj1mdW5jdGlvbih0LGUpe3RyeXtyZXR1cm4gdFtlXX1jYXRjaCh0KXt9fShlPUdlKHQpLHFlKSk/bjpfZT9WKGUpOiJPYmplY3QiPT0ocj1WKGUpKSYmayhlLmNhbGxlZSk/IkFyZ3VtZW50cyI6cn0sVWU9Zy5TdHJpbmcsWGU9ZnVuY3Rpb24odCl7aWYoIlN5bWJvbCI9PT1XZSh0KSl0aHJvdyBUeXBlRXJyb3IoIkNhbm5vdCBjb252ZXJ0IGEgU3ltYm9sIHZhbHVlIHRvIGEgc3RyaW5nIik7cmV0dXJuIFVlKHQpfSxZZT0vIi9nLEtlPVIoIiIucmVwbGFjZSk7a2Uoe3RhcmdldDoiU3RyaW5nIixwcm90bzohMCxmb3JjZWQ6KCRlPSJhbmNob3IiLHkoKGZ1bmN0aW9uKCl7dmFyIHQ9IiJbJGVdKCciJyk7cmV0dXJuIHQhPT10LnRvTG93ZXJDYXNlKCl8fHQuc3BsaXQoJyInKS5sZW5ndGg+M30pKSl9LHthbmNob3I6ZnVuY3Rpb24odCl7cmV0dXJuIGU9ImEiLG49Im5hbWUiLHI9dCxvPVhlKEModGhpcykpLGk9IjwiK2UsIiIhPT1uJiYoaSs9IiAiK24rJz0iJytLZShYZShyKSxZZSwiJnF1b3Q7IikrJyInKSxpKyI+IitvKyI8LyIrZSsiPiI7dmFyIGUsbixyLG8saTt9fSk7dmFyIEplLFFlPWZ1bmN0aW9uKCl7dmFyIHQ9QXQodGhpcyksZT0iIjtyZXR1cm4gdC5nbG9iYWwmJihlKz0iZyIpLHQuaWdub3JlQ2FzZSYmKGUrPSJpIiksdC5tdWx0aWxpbmUmJihlKz0ibSIpLHQuZG90QWxsJiYoZSs9InMiKSx0LnVuaWNvZGUmJihlKz0idSIpLHQuc3RpY2t5JiYoZSs9InkiKSxlfSxaZT1nLlJlZ0V4cCx0bj15KChmdW5jdGlvbigpe3ZhciB0PVplKCJhIiwieSIpO3JldHVybiB0Lmxhc3RJbmRleD0yLG51bGwhPXQuZXhlYygiYWJjZCIpfSkpLGVuPXRufHx5KChmdW5jdGlvbigpe3JldHVybiAhWmUoImEiLCJ5Iikuc3RpY2t5fSkpLG5uPXtCUk9LRU5fQ0FSRVQ6dG58fHkoKGZ1bmN0aW9uKCl7dmFyIHQ9WmUoIl5yIiwiZ3kiKTtyZXR1cm4gdC5sYXN0SW5kZXg9MixudWxsIT10LmV4ZWMoInN0ciIpfSkpLE1JU1NFRF9TVElDS1k6ZW4sVU5TVVBQT1JURURfWTp0bn0scm49T2JqZWN0LmtleXN8fGZ1bmN0aW9uKHQpe3JldHVybiBTZSh0LFRlKX0sb249bT9PYmplY3QuZGVmaW5lUHJvcGVydGllczpmdW5jdGlvbih0LGUpe0F0KHQpO2Zvcih2YXIgbixyPUkoZSksbz1ybihlKSxpPW8ubGVuZ3RoLGE9MDtpPmE7KWt0LmYodCxuPW9bYSsrXSxyW25dKTtyZXR1cm4gdH0sYW49RigiZG9jdW1lbnQiLCJkb2N1bWVudEVsZW1lbnQiKSxsbj1ZdCgiSUVfUFJPVE8iKSx1bj1mdW5jdGlvbigpe30sY249ZnVuY3Rpb24odCl7cmV0dXJuICI8c2NyaXB0PiIrdCsiPC8iKyJzY3JpcHQ+In0sc249ZnVuY3Rpb24odCl7dC53cml0ZShjbigiIikpLHQuY2xvc2UoKTt2YXIgZT10LnBhcmVudFdpbmRvdy5PYmplY3Q7cmV0dXJuIHQ9bnVsbCxlfSxmbj1mdW5jdGlvbigpe3RyeXtKZT1uZXcgQWN0aXZlWE9iamVjdCgiaHRtbGZpbGUiKTt9Y2F0Y2godCl7fXZhciB0LGU7Zm49InVuZGVmaW5lZCIhPXR5cGVvZiBkb2N1bWVudD9kb2N1bWVudC5kb21haW4mJkplP3NuKEplKTooKGU9T3QoImlmcmFtZSIpKS5zdHlsZS5kaXNwbGF5PSJub25lIixhbi5hcHBlbmRDaGlsZChlKSxlLnNyYz1TdHJpbmcoImphdmFzY3JpcHQ6IiksKHQ9ZS5jb250ZW50V2luZG93LmRvY3VtZW50KS5vcGVuKCksdC53cml0ZShjbigiZG9jdW1lbnQuRj1PYmplY3QiKSksdC5jbG9zZSgpLHQuRik6c24oSmUpO2Zvcih2YXIgbj1UZS5sZW5ndGg7bi0tOylkZWxldGUgZm4ucHJvdG90eXBlW1RlW25dXTtyZXR1cm4gZm4oKX07S3RbbG5dPSEwO3ZhciBkbixwbix2bj1PYmplY3QuY3JlYXRlfHxmdW5jdGlvbih0LGUpe3ZhciBuO3JldHVybiBudWxsIT09dD8odW4ucHJvdG90eXBlPUF0KHQpLG49bmV3IHVuLHVuLnByb3RvdHlwZT1udWxsLG5bbG5dPXQpOm49Zm4oKSx2b2lkIDA9PT1lP246b24obixlKX0saG49Zy5SZWdFeHAsZ249eSgoZnVuY3Rpb24oKXt2YXIgdD1obigiLiIsInMiKTtyZXR1cm4gISh0LmRvdEFsbCYmdC5leGVjKCJcbiIpJiYicyI9PT10LmZsYWdzKX0pKSx5bj1nLlJlZ0V4cCxtbj15KChmdW5jdGlvbigpe3ZhciB0PXluKCIoPzxhPmIpIiwiZyIpO3JldHVybiAiYiIhPT10LmV4ZWMoImIiKS5ncm91cHMuYXx8ImJjIiE9PSJiIi5yZXBsYWNlKHQsIiQ8YT5jIil9KSksYm49aWUuZ2V0LEVuPXN0KCJuYXRpdmUtc3RyaW5nLXJlcGxhY2UiLFN0cmluZy5wcm90b3R5cGUucmVwbGFjZSksd249UmVnRXhwLnByb3RvdHlwZS5leGVjLHhuPXduLFNuPVIoIiIuY2hhckF0KSxUbj1SKCIiLmluZGV4T2YpLERuPVIoIiIucmVwbGFjZSksTm49UigiIi5zbGljZSksUG49KHBuPS9iKi9nLEUod24sZG49L2EvLCJhIiksRSh3bixwbiwiYSIpLDAhPT1kbi5sYXN0SW5kZXh8fDAhPT1wbi5sYXN0SW5kZXgpLE1uPW5uLkJST0tFTl9DQVJFVCxSbj12b2lkIDAhPT0vKCk/Py8uZXhlYygiIilbMV07KFBufHxSbnx8TW58fGdufHxtbikmJih4bj1mdW5jdGlvbih0KXt2YXIgZSxuLHIsbyxpLGEsbCx1PXRoaXMsYz1ibih1KSxzPVhlKHQpLGY9Yy5yYXc7aWYoZilyZXR1cm4gZi5sYXN0SW5kZXg9dS5sYXN0SW5kZXgsZT1FKHhuLGYscyksdS5sYXN0SW5kZXg9Zi5sYXN0SW5kZXgsZTt2YXIgZD1jLmdyb3VwcyxwPU1uJiZ1LnN0aWNreSx2PUUoUWUsdSksaD11LnNvdXJjZSxnPTAseT1zO2lmKHAmJih2PURuKHYsInkiLCIiKSwtMT09PVRuKHYsImciKSYmKHYrPSJnIikseT1ObihzLHUubGFzdEluZGV4KSx1Lmxhc3RJbmRleD4wJiYoIXUubXVsdGlsaW5lfHx1Lm11bHRpbGluZSYmIlxuIiE9PVNuKHMsdS5sYXN0SW5kZXgtMSkpJiYoaD0iKD86ICIraCsiKSIseT0iICIreSxnKyspLG49bmV3IFJlZ0V4cCgiXig/OiIraCsiKSIsdikpLFJuJiYobj1uZXcgUmVnRXhwKCJeIitoKyIkKD8hXFxzKSIsdikpLFBuJiYocj11Lmxhc3RJbmRleCksbz1FKHduLHA/bjp1LHkpLHA/bz8oby5pbnB1dD1ObihvLmlucHV0LGcpLG9bMF09Tm4ob1swXSxnKSxvLmluZGV4PXUubGFzdEluZGV4LHUubGFzdEluZGV4Kz1vWzBdLmxlbmd0aCk6dS5sYXN0SW5kZXg9MDpQbiYmbyYmKHUubGFzdEluZGV4PXUuZ2xvYmFsP28uaW5kZXgrb1swXS5sZW5ndGg6ciksUm4mJm8mJm8ubGVuZ3RoPjEmJkUoRW4sb1swXSxuLChmdW5jdGlvbigpe2ZvcihpPTE7aTxhcmd1bWVudHMubGVuZ3RoLTI7aSsrKXZvaWQgMD09PWFyZ3VtZW50c1tpXSYmKG9baV09dm9pZCAwKTt9KSksbyYmZClmb3Ioby5ncm91cHM9YT12bihudWxsKSxpPTA7aTxkLmxlbmd0aDtpKyspYVsobD1kW2ldKVswXV09b1tsWzFdXTtyZXR1cm4gb30pO3ZhciBPbj14bjtrZSh7dGFyZ2V0OiJSZWdFeHAiLHByb3RvOiEwLGZvcmNlZDovLi8uZXhlYyE9PU9ufSx7ZXhlYzpPbn0pO3ZhciBIbj1BcnJheS5pc0FycmF5fHxmdW5jdGlvbih0KXtyZXR1cm4gIkFycmF5Ij09Vih0KX0sVm49ZnVuY3Rpb24oKXt9LHpuPVtdLGpuPUYoIlJlZmxlY3QiLCJjb25zdHJ1Y3QiKSxMbj0vXlxzKig/OmNsYXNzfGZ1bmN0aW9uKVxiLyxBbj1SKExuLmV4ZWMpLENuPSFMbi5leGVjKFZuKSxJbj1mdW5jdGlvbih0KXtpZighayh0KSlyZXR1cm4gITE7dHJ5e3JldHVybiBqbihWbix6bix0KSwhMH1jYXRjaCh0KXtyZXR1cm4gITF9fSxrbj0ham58fHkoKGZ1bmN0aW9uKCl7dmFyIHQ7cmV0dXJuIEluKEluLmNhbGwpfHwhSW4oT2JqZWN0KXx8IUluKChmdW5jdGlvbigpe3Q9ITA7fSkpfHx0fSkpP2Z1bmN0aW9uKHQpe2lmKCFrKHQpKXJldHVybiAhMTtzd2l0Y2goV2UodCkpe2Nhc2UiQXN5bmNGdW5jdGlvbiI6Y2FzZSJHZW5lcmF0b3JGdW5jdGlvbiI6Y2FzZSJBc3luY0dlbmVyYXRvckZ1bmN0aW9uIjpyZXR1cm4gITF9cmV0dXJuIENufHwhIUFuKExuLF90KHQpKX06SW4sQm49ZnVuY3Rpb24odCxlLG4pe3ZhciByPVB0KGUpO3IgaW4gdD9rdC5mKHQscixUKDAsbikpOnRbcl09bjt9LCRuPVN0KCJzcGVjaWVzIiksRm49ZnVuY3Rpb24odCl7cmV0dXJuIFk+PTUxfHwheSgoZnVuY3Rpb24oKXt2YXIgZT1bXTtyZXR1cm4gKGUuY29uc3RydWN0b3I9e30pWyRuXT1mdW5jdGlvbigpe3JldHVybiB7Zm9vOjF9fSwxIT09ZVt0XShCb29sZWFuKS5mb299KSl9LHFuPVIoW10uc2xpY2UpLEduPUZuKCJzbGljZSIpLF9uPVN0KCJzcGVjaWVzIiksV249Zy5BcnJheSxVbj1NYXRoLm1heDtmdW5jdGlvbiBYbih0LGUpe3ZhciBuPSJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2wmJnRbU3ltYm9sLml0ZXJhdG9yXTtpZighbilyZXR1cm4gdDt2YXIgcixvLGk9bi5jYWxsKHQpLGE9W107dHJ5e2Zvcig7KHZvaWQgMD09PWV8fGUtLSA+MCkmJiEocj1pLm5leHQoKSkuZG9uZTspYS5wdXNoKHIudmFsdWUpO31jYXRjaCh0KXtvPXtlcnJvcjp0fTt9ZmluYWxseXt0cnl7ciYmIXIuZG9uZSYmKG49aS5yZXR1cm4pJiZuLmNhbGwoaSk7fWZpbmFsbHl7aWYobyl0aHJvdyBvLmVycm9yfX1yZXR1cm4gYX1mdW5jdGlvbiBZbihuKXt2YXIgcj1uLnNlbGVjdGlvbjtpZihudWxsPT1yKXJldHVybiAhMTt2YXIgbz1YbihlLkVkaXRvci5ub2RlcyhuLHttYXRjaDpmdW5jdGlvbihlKXtyZXR1cm4gdC5Eb21FZGl0b3IuY2hlY2tOb2RlVHlwZShlLCJ0YWJsZS1jZWxsIil9fSksMSlbMF07aWYobyl7dmFyIGk9WG4obywyKVsxXSxhPWUuRWRpdG9yLnN0YXJ0KG4saSk7aWYoZS5Qb2ludC5lcXVhbHMoci5hbmNob3IsYSkpcmV0dXJuICEwfXJldHVybiAhMX1mdW5jdGlvbiBLbihuLHIpe3ZhciBvLGksYT1lLkVkaXRvci5ub2RlcyhuLHthdDpyLG1hdGNoOmZ1bmN0aW9uKGUpe3JldHVybiAidGFibGUiPT09dC5Eb21FZGl0b3IuZ2V0Tm9kZVR5cGUoZSl9fSksbD0hMTt0cnl7Zm9yKHZhciB1PQogIC8qISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uCgogICAgUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55CiAgICBwdXJwb3NlIHdpdGggb3Igd2l0aG91dCBmZWUgaXMgaGVyZWJ5IGdyYW50ZWQuCgogICAgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEgKICAgIFJFR0FSRCBUTyBUSElTIFNPRlRXQVJFIElOQ0xVRElORyBBTEwgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWQogICAgQU5EIEZJVE5FU1MuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1IgQkUgTElBQkxFIEZPUiBBTlkgU1BFQ0lBTCwgRElSRUNULAogICAgSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NCiAgICBMT1NTIE9GIFVTRSwgREFUQSBPUiBQUk9GSVRTLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgTkVHTElHRU5DRSBPUgogICAgT1RIRVIgVE9SVElPVVMgQUNUSU9OLCBBUklTSU5HIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFVTRSBPUgogICAgUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS4KICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovCiAgZnVuY3Rpb24odCl7dmFyIGU9ImZ1bmN0aW9uIj09dHlwZW9mIFN5bWJvbCYmU3ltYm9sLml0ZXJhdG9yLG49ZSYmdFtlXSxyPTA7aWYobilyZXR1cm4gbi5jYWxsKHQpO2lmKHQmJiJudW1iZXIiPT10eXBlb2YgdC5sZW5ndGgpcmV0dXJuIHtuZXh0OmZ1bmN0aW9uKCl7cmV0dXJuIHQmJnI+PXQubGVuZ3RoJiYodD12b2lkIDApLHt2YWx1ZTp0JiZ0W3IrK10sZG9uZTohdH19fTt0aHJvdyBuZXcgVHlwZUVycm9yKGU/Ik9iamVjdCBpcyBub3QgaXRlcmFibGUuIjoiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLiIpfShhKSxjPXUubmV4dCgpOyFjLmRvbmU7Yz11Lm5leHQoKSl7Yy52YWx1ZTtsPSEwO319Y2F0Y2godCl7bz17ZXJyb3I6dH07fWZpbmFsbHl7dHJ5e2MmJiFjLmRvbmUmJihpPXUucmV0dXJuKSYmaS5jYWxsKHUpO31maW5hbGx5e2lmKG8pdGhyb3cgby5lcnJvcn19cmV0dXJuIGx9a2Uoe3RhcmdldDoiQXJyYXkiLHByb3RvOiEwLGZvcmNlZDohR259LHtzbGljZTpmdW5jdGlvbih0LGUpe3ZhciBuLHIsbyxpPUkodGhpcyksYT1iZShpKSxsPWdlKHQsYSksdT1nZSh2b2lkIDA9PT1lP2E6ZSxhKTtpZihIbihpKSYmKG49aS5jb25zdHJ1Y3Rvciwoa24obikmJihuPT09V258fEhuKG4ucHJvdG90eXBlKSl8fEIobikmJm51bGw9PT0obj1uW19uXSkpJiYobj12b2lkIDApLG49PT1Xbnx8dm9pZCAwPT09bikpcmV0dXJuIHFuKGksbCx1KTtmb3Iocj1uZXcodm9pZCAwPT09bj9XbjpuKShVbih1LWwsMCkpLG89MDtsPHU7bCsrLG8rKylsIGluIGkmJkJuKHIsbyxpW2xdKTtyZXR1cm4gci5sZW5ndGg9byxyfX0pO3ZhciBKbj1SKFIuYmluZCksUW49U3QoInNwZWNpZXMiKSxabj1nLkFycmF5LHRyPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIG5ldyhmdW5jdGlvbih0KXt2YXIgZTtyZXR1cm4gSG4odCkmJihlPXQuY29uc3RydWN0b3IsKGtuKGUpJiYoZT09PVpufHxIbihlLnByb3RvdHlwZSkpfHxCKGUpJiZudWxsPT09KGU9ZVtRbl0pKSYmKGU9dm9pZCAwKSksdm9pZCAwPT09ZT9abjplfSh0KSkoMD09PWU/MDplKX0sZXI9UihbXS5wdXNoKSxucj1mdW5jdGlvbih0KXt2YXIgZT0xPT10LG49Mj09dCxyPTM9PXQsbz00PT10LGk9Nj09dCxhPTc9PXQsbD01PT10fHxpO3JldHVybiBmdW5jdGlvbih1LGMscyxmKXtmb3IodmFyIGQscCx2PWR0KHUpLGg9TCh2KSxnPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIHJ0KHQpLHZvaWQgMD09PWU/dDpKbj9Kbih0LGUpOmZ1bmN0aW9uKCl7cmV0dXJuIHQuYXBwbHkoZSxhcmd1bWVudHMpfX0oYyxzKSx5PWJlKGgpLG09MCxiPWZ8fHRyLEU9ZT9iKHUseSk6bnx8YT9iKHUsMCk6dm9pZCAwO3k+bTttKyspaWYoKGx8fG0gaW4gaCkmJihwPWcoZD1oW21dLG0sdiksdCkpaWYoZSlFW21dPXA7ZWxzZSBpZihwKXN3aXRjaCh0KXtjYXNlIDM6cmV0dXJuICEwO2Nhc2UgNTpyZXR1cm4gZDtjYXNlIDY6cmV0dXJuIG07Y2FzZSAyOmVyKEUsZCk7fWVsc2Ugc3dpdGNoKHQpe2Nhc2UgNDpyZXR1cm4gITE7Y2FzZSA3OmVyKEUsZCk7fXJldHVybiBpPy0xOnJ8fG8/bzpFfX0scnI9e2ZvckVhY2g6bnIoMCksbWFwOm5yKDEpLGZpbHRlcjpucigyKSxzb21lOm5yKDMpLGV2ZXJ5Om5yKDQpLGZpbmQ6bnIoNSksZmluZEluZGV4Om5yKDYpLGZpbHRlclJlamVjdDpucig3KX0sb3I9cnIubWFwO2tlKHt0YXJnZXQ6IkFycmF5Iixwcm90bzohMCxmb3JjZWQ6IUZuKCJtYXAiKX0se21hcDpmdW5jdGlvbih0KXtyZXR1cm4gb3IodGhpcyx0LGFyZ3VtZW50cy5sZW5ndGg+MT9hcmd1bWVudHNbMV06dm9pZCAwKX19KTt2YXIgaXI9RmU/e30udG9TdHJpbmc6ZnVuY3Rpb24oKXtyZXR1cm4gIltvYmplY3QgIitXZSh0aGlzKSsiXSJ9O2Z1bmN0aW9uIGFyKHQpe3ZhciBlPXQuY2hpbGRyZW58fFtdO3JldHVybiAwPT09ZS5sZW5ndGg/W106KGVbMF18fHt9KS5jaGlsZHJlbnx8W119ZnVuY3Rpb24gbHIodCl7cmV0dXJuIGFyKHQpLmV2ZXJ5KChmdW5jdGlvbih0KXtyZXR1cm4gISF0LmlzSGVhZGVyfSkpfUZlfHxzZShPYmplY3QucHJvdG90eXBlLCJ0b1N0cmluZyIsaXIse3Vuc2FmZTohMH0pO3ZhciB1cj1jZS5QUk9QRVIsY3I9InRvU3RyaW5nIixzcj1SZWdFeHAucHJvdG90eXBlLGZyPXNyLnRvU3RyaW5nLGRyPVIoUWUpLHByPXkoKGZ1bmN0aW9uKCl7cmV0dXJuICIvYS9iIiE9ZnIuY2FsbCh7c291cmNlOiJhIixmbGFnczoiYiJ9KX0pKSx2cj11ciYmZnIubmFtZSE9Y3I7KHByfHx2cikmJnNlKFJlZ0V4cC5wcm90b3R5cGUsY3IsKGZ1bmN0aW9uKCl7dmFyIHQ9QXQodGhpcyksZT1YZSh0LnNvdXJjZSksbj10LmZsYWdzO3JldHVybiAiLyIrZSsiLyIrWGUodm9pZCAwPT09biYmcShzcix0KSYmISgiZmxhZ3MiaW4gc3IpP2RyKHQpOm4pfSkse3Vuc2FmZTohMH0pO3ZhciBocj1TdCgidW5zY29wYWJsZXMiKSxncj1BcnJheS5wcm90b3R5cGU7bnVsbD09Z3JbaHJdJiZrdC5mKGdyLGhyLHtjb25maWd1cmFibGU6ITAsdmFsdWU6dm4obnVsbCl9KTt2YXIgeXIsbXI9cnIuZmluZCxicj0iZmluZCIsRXI9ITA7YnIgaW5bXSYmQXJyYXkoMSkuZmluZCgoZnVuY3Rpb24oKXtFcj0hMTt9KSksa2Uoe3RhcmdldDoiQXJyYXkiLHByb3RvOiEwLGZvcmNlZDpFcn0se2ZpbmQ6ZnVuY3Rpb24odCl7cmV0dXJuIG1yKHRoaXMsdCxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCl9fSkseXI9YnIsZ3JbaHJdW3lyXT0hMDt2YXIgd3I9RnVuY3Rpb24ucHJvdG90eXBlLHhyPXdyLmFwcGx5LFNyPXdyLmJpbmQsVHI9d3IuY2FsbCxEcj0ib2JqZWN0Ij09dHlwZW9mIFJlZmxlY3QmJlJlZmxlY3QuYXBwbHl8fChTcj9Uci5iaW5kKHhyKTpmdW5jdGlvbigpe3JldHVybiBUci5hcHBseSh4cixhcmd1bWVudHMpfSksTnI9U3QoInNwZWNpZXMiKSxQcj1SZWdFeHAucHJvdG90eXBlLE1yPWZ1bmN0aW9uKHQsZSxuLHIpe3ZhciBvPVN0KHQpLGk9IXkoKGZ1bmN0aW9uKCl7dmFyIGU9e307cmV0dXJuIGVbb109ZnVuY3Rpb24oKXtyZXR1cm4gN30sNyE9IiJbdF0oZSl9KSksYT1pJiYheSgoZnVuY3Rpb24oKXt2YXIgZT0hMSxuPS9hLztyZXR1cm4gInNwbGl0Ij09PXQmJigobj17fSkuY29uc3RydWN0b3I9e30sbi5jb25zdHJ1Y3RvcltOcl09ZnVuY3Rpb24oKXtyZXR1cm4gbn0sbi5mbGFncz0iIixuW29dPS8uL1tvXSksbi5leGVjPWZ1bmN0aW9uKCl7cmV0dXJuIGU9ITAsbnVsbH0sbltvXSgiIiksIWV9KSk7aWYoIWl8fCFhfHxuKXt2YXIgbD1SKC8uL1tvXSksdT1lKG8sIiJbdF0sKGZ1bmN0aW9uKHQsZSxuLHIsbyl7dmFyIGE9Uih0KSx1PWUuZXhlYztyZXR1cm4gdT09PU9ufHx1PT09UHIuZXhlYz9pJiYhbz97ZG9uZTohMCx2YWx1ZTpsKGUsbixyKX06e2RvbmU6ITAsdmFsdWU6YShuLGUscil9Ontkb25lOiExfX0pKTtzZShTdHJpbmcucHJvdG90eXBlLHQsdVswXSksc2UoUHIsbyx1WzFdKTt9ciYmQnQoUHJbb10sInNoYW0iLCEwKTt9LFJyPVN0KCJtYXRjaCIpLE9yPWcuVHlwZUVycm9yLEhyPVN0KCJzcGVjaWVzIiksVnI9ZnVuY3Rpb24odCxlKXt2YXIgbixyPUF0KHQpLmNvbnN0cnVjdG9yO3JldHVybiB2b2lkIDA9PT1yfHxudWxsPT0obj1BdChyKVtIcl0pP2U6ZnVuY3Rpb24odCl7aWYoa24odCkpcmV0dXJuIHQ7dGhyb3cgT3IoZXQodCkrIiBpcyBub3QgYSBjb25zdHJ1Y3RvciIpfShuKX0senI9UigiIi5jaGFyQXQpLGpyPVIoIiIuY2hhckNvZGVBdCksTHI9UigiIi5zbGljZSksQXI9ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGUsbil7dmFyIHIsbyxpPVhlKEMoZSkpLGE9cGUobiksbD1pLmxlbmd0aDtyZXR1cm4gYTwwfHxhPj1sP3Q/IiI6dm9pZCAwOihyPWpyKGksYSkpPDU1Mjk2fHxyPjU2MzE5fHxhKzE9PT1sfHwobz1qcihpLGErMSkpPDU2MzIwfHxvPjU3MzQzP3Q/enIoaSxhKTpyOnQ/THIoaSxhLGErMik6by01NjMyMCsoci01NTI5Njw8MTApKzY1NTM2fX0sQ3I9e2NvZGVBdDpBcighMSksY2hhckF0OkFyKCEwKX0uY2hhckF0LElyPWZ1bmN0aW9uKHQsZSxuKXtyZXR1cm4gZSsobj9Dcih0LGUpLmxlbmd0aDoxKX0sa3I9Zy5BcnJheSxCcj1NYXRoLm1heCwkcj1mdW5jdGlvbih0LGUsbil7Zm9yKHZhciByPWJlKHQpLG89Z2UoZSxyKSxpPWdlKHZvaWQgMD09PW4/cjpuLHIpLGE9a3IoQnIoaS1vLDApKSxsPTA7bzxpO28rKyxsKyspQm4oYSxsLHRbb10pO3JldHVybiBhLmxlbmd0aD1sLGF9LEZyPWcuVHlwZUVycm9yLHFyPWZ1bmN0aW9uKHQsZSl7dmFyIG49dC5leGVjO2lmKGsobikpe3ZhciByPUUobix0LGUpO3JldHVybiBudWxsIT09ciYmQXQocikscn1pZigiUmVnRXhwIj09PVYodCkpcmV0dXJuIEUoT24sdCxlKTt0aHJvdyBGcigiUmVnRXhwI2V4ZWMgY2FsbGVkIG9uIGluY29tcGF0aWJsZSByZWNlaXZlciIpfSxHcj1ubi5VTlNVUFBPUlRFRF9ZLF9yPTQyOTQ5NjcyOTUsV3I9TWF0aC5taW4sVXI9W10ucHVzaCxYcj1SKC8uLy5leGVjKSxZcj1SKFVyKSxLcj1SKCIiLnNsaWNlKSxKcj0heSgoZnVuY3Rpb24oKXt2YXIgdD0vKD86KS8sZT10LmV4ZWM7dC5leGVjPWZ1bmN0aW9uKCl7cmV0dXJuIGUuYXBwbHkodGhpcyxhcmd1bWVudHMpfTt2YXIgbj0iYWIiLnNwbGl0KHQpO3JldHVybiAyIT09bi5sZW5ndGh8fCJhIiE9PW5bMF18fCJiIiE9PW5bMV19KSk7TXIoInNwbGl0IiwoZnVuY3Rpb24odCxlLG4pe3ZhciByO3JldHVybiByPSJjIj09ImFiYmMiLnNwbGl0KC8oYikqLylbMV18fDQhPSJ0ZXN0Ii5zcGxpdCgvKD86KS8sLTEpLmxlbmd0aHx8MiE9ImFiIi5zcGxpdCgvKD86YWIpKi8pLmxlbmd0aHx8NCE9Ii4iLnNwbGl0KC8oLj8pKC4/KS8pLmxlbmd0aHx8Ii4iLnNwbGl0KC8oKSgpLykubGVuZ3RoPjF8fCIiLnNwbGl0KC8uPy8pLmxlbmd0aD9mdW5jdGlvbih0LG4pe3ZhciByLG8saT1YZShDKHRoaXMpKSxhPXZvaWQgMD09PW4/X3I6bj4+PjA7aWYoMD09PWEpcmV0dXJuIFtdO2lmKHZvaWQgMD09PXQpcmV0dXJuIFtpXTtpZighQihyPXQpfHwhKHZvaWQgMCE9PShvPXJbUnJdKT9vOiJSZWdFeHAiPT1WKHIpKSlyZXR1cm4gRShlLGksdCxhKTtmb3IodmFyIGwsdSxjLHM9W10sZj0odC5pZ25vcmVDYXNlPyJpIjoiIikrKHQubXVsdGlsaW5lPyJtIjoiIikrKHQudW5pY29kZT8idSI6IiIpKyh0LnN0aWNreT8ieSI6IiIpLGQ9MCxwPW5ldyBSZWdFeHAodC5zb3VyY2UsZisiZyIpOyhsPUUoT24scCxpKSkmJiEoKHU9cC5sYXN0SW5kZXgpPmQmJihZcihzLEtyKGksZCxsLmluZGV4KSksbC5sZW5ndGg+MSYmbC5pbmRleDxpLmxlbmd0aCYmRHIoVXIscywkcihsLDEpKSxjPWxbMF0ubGVuZ3RoLGQ9dSxzLmxlbmd0aD49YSkpOylwLmxhc3RJbmRleD09PWwuaW5kZXgmJnAubGFzdEluZGV4Kys7cmV0dXJuIGQ9PT1pLmxlbmd0aD8hYyYmWHIocCwiIil8fFlyKHMsIiIpOllyKHMsS3IoaSxkKSkscy5sZW5ndGg+YT8kcihzLDAsYSk6c306IjAiLnNwbGl0KHZvaWQgMCwwKS5sZW5ndGg/ZnVuY3Rpb24odCxuKXtyZXR1cm4gdm9pZCAwPT09dCYmMD09PW4/W106RShlLHRoaXMsdCxuKX06ZSxbZnVuY3Rpb24oZSxuKXt2YXIgbz1DKHRoaXMpLGk9bnVsbD09ZT92b2lkIDA6b3QoZSx0KTtyZXR1cm4gaT9FKGksZSxvLG4pOkUocixYZShvKSxlLG4pfSxmdW5jdGlvbih0LG8pe3ZhciBpPUF0KHRoaXMpLGE9WGUodCksbD1uKHIsaSxhLG8sciE9PWUpO2lmKGwuZG9uZSlyZXR1cm4gbC52YWx1ZTt2YXIgdT1WcihpLFJlZ0V4cCksYz1pLnVuaWNvZGUscz0oaS5pZ25vcmVDYXNlPyJpIjoiIikrKGkubXVsdGlsaW5lPyJtIjoiIikrKGkudW5pY29kZT8idSI6IiIpKyhHcj8iZyI6InkiKSxmPW5ldyB1KEdyPyJeKD86IitpLnNvdXJjZSsiKSI6aSxzKSxkPXZvaWQgMD09PW8/X3I6bz4+PjA7aWYoMD09PWQpcmV0dXJuIFtdO2lmKDA9PT1hLmxlbmd0aClyZXR1cm4gbnVsbD09PXFyKGYsYSk/W2FdOltdO2Zvcih2YXIgcD0wLHY9MCxoPVtdO3Y8YS5sZW5ndGg7KXtmLmxhc3RJbmRleD1Hcj8wOnY7dmFyIGcseT1xcihmLEdyP0tyKGEsdik6YSk7aWYobnVsbD09PXl8fChnPVdyKG1lKGYubGFzdEluZGV4KyhHcj92OjApKSxhLmxlbmd0aCkpPT09cCl2PUlyKGEsdixjKTtlbHNlIHtpZihZcihoLEtyKGEscCx2KSksaC5sZW5ndGg9PT1kKXJldHVybiBoO2Zvcih2YXIgbT0xO208PXkubGVuZ3RoLTE7bSsrKWlmKFlyKGgseVttXSksaC5sZW5ndGg9PT1kKXJldHVybiBoO3Y9cD1nO319cmV0dXJuIFlyKGgsS3IoYSxwKSksaH1dfSksIUpyLEdyKTt2YXIgUXI9Ilx0XG5cdlxmXHIgwqDhmoDigIDigIHigILigIPigITigIXigIbigIfigIjigInigIrigK/igZ/jgIBcdTIwMjhcdTIwMjlcdWZlZmYiLFpyPVIoIiIucmVwbGFjZSksdG89IlsiK1FyKyJdIixlbz1SZWdFeHAoIl4iK3RvK3RvKyIqIiksbm89UmVnRXhwKHRvK3RvKyIqJCIpLHJvPWZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihlKXt2YXIgbj1YZShDKGUpKTtyZXR1cm4gMSZ0JiYobj1acihuLGVvLCIiKSksMiZ0JiYobj1acihuLG5vLCIiKSksbn19LG9vPXtzdGFydDpybygxKSxlbmQ6cm8oMiksdHJpbTpybygzKX0saW89Y2UuUFJPUEVSLGFvPW9vLnRyaW07ZnVuY3Rpb24gbG8odCl7cmV0dXJuIHQubGVuZ3RoP3RbMF0udGFnTmFtZS50b0xvd2VyQ2FzZSgpOiIifWtlKHt0YXJnZXQ6IlN0cmluZyIscHJvdG86ITAsZm9yY2VkOmZ1bmN0aW9uKHQpe3JldHVybiB5KChmdW5jdGlvbigpe3JldHVybiAhIVFyW3RdKCl8fCLigIvCheGgjiIhPT0i4oCLwoXhoI4iW3RdKCl8fGlvJiZRclt0XS5uYW1lIT09dH0pKX0oInRyaW0iKX0se3RyaW06ZnVuY3Rpb24oKXtyZXR1cm4gYW8odGhpcyl9fSksa2Uoe2dsb2JhbDohMH0se2dsb2JhbFRoaXM6Z30pLG8uYXBwZW5kJiYoYy5kZWZhdWx0LmZuLmFwcGVuZD1vLmFwcGVuZCksby5vbiYmKGMuZGVmYXVsdC5mbi5vbj1vLm9uKSxvLmZvY3VzJiYoYy5kZWZhdWx0LmZuLmZvY3VzPW8uZm9jdXMpLG8uYXR0ciYmKGMuZGVmYXVsdC5mbi5hdHRyPW8uYXR0ciksby52YWwmJihjLmRlZmF1bHQuZm4udmFsPW8udmFsKSxvLmh0bWwmJihjLmRlZmF1bHQuZm4uaHRtbD1vLmh0bWwpLG8uZGF0YXNldCYmKGMuZGVmYXVsdC5mbi5kYXRhc2V0PW8uZGF0YXNldCksby5hZGRDbGFzcyYmKGMuZGVmYXVsdC5mbi5hZGRDbGFzcz1vLmFkZENsYXNzKSxvLnJlbW92ZUNsYXNzJiYoYy5kZWZhdWx0LmZuLnJlbW92ZUNsYXNzPW8ucmVtb3ZlQ2xhc3MpLG8uY2hpbGRyZW4mJihjLmRlZmF1bHQuZm4uY2hpbGRyZW49by5jaGlsZHJlbiksby5lYWNoJiYoYy5kZWZhdWx0LmZuLmVhY2g9by5lYWNoKSxvLmZpbmQmJihjLmRlZmF1bHQuZm4uZmluZD1vLmZpbmQpO3ZhciB1bz0hMSxjbz0wLHNvPTAsZm89bnVsbCxwbz1udWxsLHZvPWMuZGVmYXVsdCgiYm9keSIpO2Z1bmN0aW9uIGhvKHQpe3VvPSExLHBvPW51bGwsZm89bnVsbCx2by5vZmYoIm1vdXNlbW92ZSIsZ28pLHZvLm9mZigibW91c2V1cCIsaG8pO312by5vbigibW91c2Vkb3duIiwoZnVuY3Rpb24odCl7dmFyIGU9dC50YXJnZXQ7aWYoKCJUSCI9PT1lLnRhZ05hbWV8fCJURCI9PT1lLnRhZ05hbWUpJiYiY29sLXJlc2l6ZSI9PT1lLnN0eWxlLmN1cnNvcil7ZS5zdHlsZS5jdXJzb3I9ImF1dG8iLHQucHJldmVudERlZmF1bHQoKSx1bz0hMDt2YXIgbj10LmNsaWVudFg7Y289bjt2YXIgcj1lLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoO3NvPXIsdm8ub24oIm1vdXNlbW92ZSIsZ28pLHZvLm9uKCJtb3VzZXVwIixobyk7fX0pKTt2YXIgZ289dS5kZWZhdWx0KChmdW5jdGlvbih0KXtpZih1byYmbnVsbCE9cG8mJm51bGwhPWZvKXt0LnByZXZlbnREZWZhdWx0KCk7dmFyIG49dC5jbGllbnRYLHI9c28rKG4tY28pOyhyPU1hdGguZmxvb3IoMTAwKnIpLzEwMCk8MzAmJihyPTMwKSxlLlRyYW5zZm9ybXMuc2V0Tm9kZXMocG8se3dpZHRoOnIudG9TdHJpbmcoKX0se2F0OmZvfSk7fX0pLDEwMCk7dmFyIHlvPXt0eXBlOiJ0YWJsZSIscmVuZGVyRWxlbTpmdW5jdGlvbihyLG8saSl7dmFyIGE9ZnVuY3Rpb24obixyKXtpZihuLmlzRGlzYWJsZWQoKSlyZXR1cm4gITE7dmFyIG89bi5zZWxlY3Rpb247aWYobnVsbD09bylyZXR1cm4gITA7aWYoZS5SYW5nZS5pc0NvbGxhcHNlZChvKSlyZXR1cm4gITA7dmFyIGk9by5hbmNob3IsYT1vLmZvY3VzLGw9dC5Eb21FZGl0b3IuZmluZFBhdGgobixyKSx1PWUuRWRpdG9yLnN0YXJ0KG4sbCksYz1lLkVkaXRvci5lbmQobixsKSxzPWUuUG9pbnQuY29tcGFyZShpLGMpPD0wJiZlLlBvaW50LmNvbXBhcmUoaSx1KT49MCxmPWUuUG9pbnQuY29tcGFyZShhLGMpPD0wJiZlLlBvaW50LmNvbXBhcmUoYSx1KT49MDtyZXR1cm4gISEocyYmZiYmZS5QYXRoLmVxdWFscyhpLnBhdGguc2xpY2UoMCwzKSxhLnBhdGguc2xpY2UoMCwzKSkpfShpLHIpLGw9ci53aWR0aCx1PXZvaWQgMD09PWw/ImF1dG8iOmwsYz10LkRvbUVkaXRvci5pc05vZGVTZWxlY3RlZChpLHIpLHM9YXIociksZj1uLmpzeCgiZGl2Iix7Y2xhc3NOYW1lOiJ0YWJsZS1jb250YWluZXIiLCJkYXRhLXNlbGVjdGVkIjpjLG9uOnttb3VzZWRvd246ZnVuY3Rpb24obil7aWYoIkRJViI9PT1uLnRhcmdldC50YWdOYW1lJiZuLnByZXZlbnREZWZhdWx0KCksIWkuaXNEaXNhYmxlZCgpKXt2YXIgbz10LkRvbUVkaXRvci5maW5kUGF0aChpLHIpLGE9ZS5FZGl0b3Iuc3RhcnQoaSxvKSxsPWkuc2VsZWN0aW9uO2lmKG51bGwhPWwpbC5hbmNob3IucGF0aFswXSE9PW9bMF0mJmkuc2VsZWN0KGEpO2Vsc2UgaS5zZWxlY3QoYSk7fX19fSxuLmpzeCgidGFibGUiLHt3aWR0aDp1LGNvbnRlbnRFZGl0YWJsZTphfSxuLmpzeCgiY29sZ3JvdXAiLG51bGwscy5tYXAoKGZ1bmN0aW9uKHQpe3ZhciBlPXQud2lkdGgscj12b2lkIDA9PT1lPyJhdXRvIjplO3JldHVybiBuLmpzeCgiY29sIix7d2lkdGg6cn0pfSkpKSxuLmpzeCgidGJvZHkiLG51bGwsbykpKTtyZXR1cm4gZn19LG1vPXt0eXBlOiJ0YWJsZS1yb3ciLHJlbmRlckVsZW06ZnVuY3Rpb24odCxlLHIpe3JldHVybiBuLmpzeCgidHIiLG51bGwsZSl9fSxibz17dHlwZToidGFibGUtY2VsbCIscmVuZGVyRWxlbTpmdW5jdGlvbihlLHIsbyl7dmFyIGk9ZnVuY3Rpb24oZSxuKXt2YXIgcj10LkRvbUVkaXRvci5nZXRQYXJlbnROb2RlKGUsbik7aWYobnVsbD09cilyZXR1cm4gITE7dmFyIG89dC5Eb21FZGl0b3IuZ2V0UGFyZW50Tm9kZShlLHIpO3JldHVybiBudWxsIT1vJiZhcihvKS5zb21lKChmdW5jdGlvbih0KXtyZXR1cm4gdD09PW59KSl9KG8sZSksYT1lLGw9YS5jb2xTcGFuLGM9dm9pZCAwPT09bD8xOmwscz1hLnJvd1NwYW4sZj12b2lkIDA9PT1zPzE6cyxkPWEuaXNIZWFkZXIscD12b2lkIDAhPT1kJiZkO2lmKCFpKXJldHVybiBuLmpzeCgidGQiLHtjb2xTcGFuOmMscm93U3BhbjpmfSxyKTt2YXIgdj1wPyJ0aCI6InRkIixoPW4uanN4KHYse2NvbFNwYW46Yyxyb3dTcGFuOmYsc3R5bGU6e2JvcmRlclJpZ2h0V2lkdGg6IjNweCJ9LG9uOnttb3VzZW1vdmU6dS5kZWZhdWx0KChmdW5jdGlvbihuKXt2YXIgcj10aGlzLmVsbTtpZihudWxsIT1yKXt2YXIgaT1yLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLGE9aS5sZWZ0LGw9aS53aWR0aCx1PWkudG9wLGM9aS5oZWlnaHQscz1uLmNsaWVudFgsZj1uLmNsaWVudFk7aWYoIXVvKXM+YStsLTUmJnM8YStsJiYoZj51JiZmPHUrYyk/KHIuc3R5bGUuY3Vyc29yPSJjb2wtcmVzaXplIixwbz1vLGZvPXQuRG9tRWRpdG9yLmZpbmRQYXRoKG8sZSkpOnVvfHwoci5zdHlsZS5jdXJzb3I9ImF1dG8iLHBvPW51bGwsZm89bnVsbCk7fX0pLDEwMCl9fSxyKTtyZXR1cm4gaH19O3ZhciBFbz17dHlwZToidGFibGUiLGVsZW1Ub0h0bWw6ZnVuY3Rpb24odCxlKXt2YXIgbj10LndpZHRoO3JldHVybiAnPHRhYmxlIHN0eWxlPSJ3aWR0aDogJysodm9pZCAwPT09bj8iYXV0byI6bikrJzsiPjx0Ym9keT4nK2UrIjwvdGJvZHk+PC90YWJsZT4ifX0sd289e3R5cGU6InRhYmxlLXJvdyIsZWxlbVRvSHRtbDpmdW5jdGlvbih0LGUpe3JldHVybiAiPHRyPiIrZSsiPC90cj4ifX0seG89e3R5cGU6InRhYmxlLWNlbGwiLGVsZW1Ub0h0bWw6ZnVuY3Rpb24odCxlKXt2YXIgbj10LHI9bi5jb2xTcGFuLG89dm9pZCAwPT09cj8xOnIsaT1uLnJvd1NwYW4sYT12b2lkIDA9PT1pPzE6aSxsPW4uaXNIZWFkZXIsdT12b2lkIDAhPT1sJiZsLGM9bi53aWR0aCxzPXU/InRoIjoidGQiO3JldHVybiAiPCIrcysnIGNvbFNwYW49IicrbysnIiByb3dTcGFuPSInK2ErJyIgd2lkdGg9IicrKHZvaWQgMD09PWM/ImF1dG8iOmMpKyciPicrZSsiPC8iK3MrIj4ifX07dmFyIFNvPXtzZWxlY3RvcjoidGFibGUiLHByZVBhcnNlSHRtbDpmdW5jdGlvbih0KXt2YXIgZT1jLmRlZmF1bHQodCk7aWYoInRhYmxlIiE9PWxvKGUpKXJldHVybiB0O3ZhciBuPWUuZmluZCgidGJvZHkiKTtpZigwPT09bi5sZW5ndGgpcmV0dXJuIHQ7dmFyIHI9ZS5maW5kKCJ0ciIpO3JldHVybiBlLmFwcGVuZChyKSxuLnJlbW92ZSgpLGVbMF19fSxUbz1yci5maWx0ZXI7a2Uoe3RhcmdldDoiQXJyYXkiLHByb3RvOiEwLGZvcmNlZDohRm4oImZpbHRlciIpfSx7ZmlsdGVyOmZ1bmN0aW9uKHQpe3JldHVybiBUbyh0aGlzLHQsYXJndW1lbnRzLmxlbmd0aD4xP2FyZ3VtZW50c1sxXTp2b2lkIDApfX0pO3ZhciBEbz1NYXRoLmZsb29yLE5vPVIoIiIuY2hhckF0KSxQbz1SKCIiLnJlcGxhY2UpLE1vPVIoIiIuc2xpY2UpLFJvPS9cJChbJCYnYF18XGR7MSwyfXw8W14+XSo+KS9nLE9vPS9cJChbJCYnYF18XGR7MSwyfSkvZyxIbz1mdW5jdGlvbih0LGUsbixyLG8saSl7dmFyIGE9bit0Lmxlbmd0aCxsPXIubGVuZ3RoLHU9T287cmV0dXJuIHZvaWQgMCE9PW8mJihvPWR0KG8pLHU9Um8pLFBvKGksdSwoZnVuY3Rpb24oaSx1KXt2YXIgYztzd2l0Y2goTm8odSwwKSl7Y2FzZSIkIjpyZXR1cm4gIiQiO2Nhc2UiJiI6cmV0dXJuIHQ7Y2FzZSJgIjpyZXR1cm4gTW8oZSwwLG4pO2Nhc2UiJyI6cmV0dXJuIE1vKGUsYSk7Y2FzZSI8IjpjPW9bTW8odSwxLC0xKV07YnJlYWs7ZGVmYXVsdDp2YXIgcz0rdTtpZigwPT09cylyZXR1cm4gaTtpZihzPmwpe3ZhciBmPURvKHMvMTApO3JldHVybiAwPT09Zj9pOmY8PWw/dm9pZCAwPT09cltmLTFdP05vKHUsMSk6cltmLTFdK05vKHUsMSk6aX1jPXJbcy0xXTt9cmV0dXJuIHZvaWQgMD09PWM/IiI6Y30pKX0sVm89U3QoInJlcGxhY2UiKSx6bz1NYXRoLm1heCxqbz1NYXRoLm1pbixMbz1SKFtdLmNvbmNhdCksQW89UihbXS5wdXNoKSxDbz1SKCIiLmluZGV4T2YpLElvPVIoIiIuc2xpY2UpLGtvPSIkMCI9PT0iYSIucmVwbGFjZSgvLi8sIiQwIiksQm89ISEvLi9bVm9dJiYiIj09PS8uL1tWb10oImEiLCIkMCIpO01yKCJyZXBsYWNlIiwoZnVuY3Rpb24odCxlLG4pe3ZhciByPUJvPyIkIjoiJDAiO3JldHVybiBbZnVuY3Rpb24odCxuKXt2YXIgcj1DKHRoaXMpLG89bnVsbD09dD92b2lkIDA6b3QodCxWbyk7cmV0dXJuIG8/RShvLHQscixuKTpFKGUsWGUociksdCxuKX0sZnVuY3Rpb24odCxvKXt2YXIgaT1BdCh0aGlzKSxhPVhlKHQpO2lmKCJzdHJpbmciPT10eXBlb2YgbyYmLTE9PT1DbyhvLHIpJiYtMT09PUNvKG8sIiQ8Iikpe3ZhciBsPW4oZSxpLGEsbyk7aWYobC5kb25lKXJldHVybiBsLnZhbHVlfXZhciB1PWsobyk7dXx8KG89WGUobykpO3ZhciBjPWkuZ2xvYmFsO2lmKGMpe3ZhciBzPWkudW5pY29kZTtpLmxhc3RJbmRleD0wO31mb3IodmFyIGY9W107Oyl7dmFyIGQ9cXIoaSxhKTtpZihudWxsPT09ZClicmVhaztpZihBbyhmLGQpLCFjKWJyZWFrOyIiPT09WGUoZFswXSkmJihpLmxhc3RJbmRleD1JcihhLG1lKGkubGFzdEluZGV4KSxzKSk7fWZvcih2YXIgcCx2PSIiLGg9MCxnPTA7ZzxmLmxlbmd0aDtnKyspe2Zvcih2YXIgeT1YZSgoZD1mW2ddKVswXSksbT16byhqbyhwZShkLmluZGV4KSxhLmxlbmd0aCksMCksYj1bXSxFPTE7RTxkLmxlbmd0aDtFKyspQW8oYix2b2lkIDA9PT0ocD1kW0VdKT9wOlN0cmluZyhwKSk7dmFyIHc9ZC5ncm91cHM7aWYodSl7dmFyIHg9TG8oW3ldLGIsbSxhKTt2b2lkIDAhPT13JiZBbyh4LHcpO3ZhciBTPVhlKERyKG8sdm9pZCAwLHgpKTt9ZWxzZSBTPUhvKHksYSxtLGIsdyxvKTttPj1oJiYodis9SW8oYSxoLG0pK1MsaD1tK3kubGVuZ3RoKTt9cmV0dXJuIHYrSW8oYSxoKX1dfSksISF5KChmdW5jdGlvbigpe3ZhciB0PS8uLztyZXR1cm4gdC5leGVjPWZ1bmN0aW9uKCl7dmFyIHQ9W107cmV0dXJuIHQuZ3JvdXBzPXthOiI3In0sdH0sIjciIT09IiIucmVwbGFjZSh0LCIkPGE+Iil9KSl8fCFrb3x8Qm8pO3ZhciAkbz17c2VsZWN0b3I6InRkOm5vdChbZGF0YS13LWUtdHlwZV0pLHRoOm5vdChbZGF0YS13LWUtdHlwZV0pIixwYXJzZUVsZW1IdG1sOmZ1bmN0aW9uKHQsbixyKXt2YXIgbz1jLmRlZmF1bHQodCk7MD09PShuPW4uZmlsdGVyKChmdW5jdGlvbih0KXtyZXR1cm4gISFlLlRleHQuaXNUZXh0KHQpfHwhIXIuaXNJbmxpbmUodCl9KSkpLmxlbmd0aCYmKG49W3t0ZXh0Om8udGV4dCgpLnJlcGxhY2UoL1xzKy9nbSwiICIpfV0pO3ZhciBpPXBhcnNlSW50KG8uYXR0cigiY29sU3BhbiIpfHwiMSIpLGE9cGFyc2VJbnQoby5hdHRyKCJyb3dTcGFuIil8fCIxIiksbD1vLmF0dHIoIndpZHRoIil8fCJhdXRvIjtyZXR1cm4ge3R5cGU6InRhYmxlLWNlbGwiLGlzSGVhZGVyOiJ0aCI9PT1sbyhvKSxjb2xTcGFuOmkscm93U3BhbjphLHdpZHRoOmwsY2hpbGRyZW46bn19fTt2YXIgRm89e3NlbGVjdG9yOiJ0cjpub3QoW2RhdGEtdy1lLXR5cGVdKSIscGFyc2VFbGVtSHRtbDpmdW5jdGlvbihlLG4scil7cmV0dXJuIHt0eXBlOiJ0YWJsZS1yb3ciLGNoaWxkcmVuOm4uZmlsdGVyKChmdW5jdGlvbihlKXtyZXR1cm4gInRhYmxlLWNlbGwiPT09dC5Eb21FZGl0b3IuZ2V0Tm9kZVR5cGUoZSl9KSl9fX07dmFyIHFvPXtzZWxlY3RvcjoidGFibGU6bm90KFtkYXRhLXctZS10eXBlXSkiLHBhcnNlRWxlbUh0bWw6ZnVuY3Rpb24oZSxuLHIpe3ZhciBvPWMuZGVmYXVsdChlKSxpPSJhdXRvIjtyZXR1cm4gIjEwMCUiPT09ZnVuY3Rpb24odCxlKXtmb3IodmFyIG49IiIscj0odC5hdHRyKCJzdHlsZSIpfHwiIikuc3BsaXQoIjsiKSxvPXIubGVuZ3RoLGk9MDtpPG87aSsrKXt2YXIgYT1yW2ldO2lmKGEpe3ZhciBsPWEuc3BsaXQoIjoiKTtsWzBdLnRyaW0oKT09PWUmJihuPWxbMV0udHJpbSgpKTt9fXJldHVybiBufShvLCJ3aWR0aCIpJiYoaT0iMTAwJSIpLCIxMDAlIj09PW8uYXR0cigid2lkdGgiKSYmKGk9IjEwMCUiKSx7dHlwZToidGFibGUiLHdpZHRoOmksY2hpbGRyZW46bi5maWx0ZXIoKGZ1bmN0aW9uKGUpe3JldHVybiAidGFibGUtcm93Ij09PXQuRG9tRWRpdG9yLmdldE5vZGVUeXBlKGUpfSkpfX19O3ZhciBHbz1mdW5jdGlvbigpe2Z1bmN0aW9uIG4oKXt0aGlzLnRpdGxlPXQudCgidGFibGVNb2R1bGUuaW5zZXJ0VGFibGUiKSx0aGlzLmljb25Tdmc9Jzxzdmcgdmlld0JveD0iMCAwIDEwMjQgMTAyNCI+PHBhdGggZD0iTTAgNjR2ODk2aDEwMjRWNjRIMHogbTM4NCA1NzZ2LTE5MmgyNTZ2MTkyaC0yNTZ6IG0yNTYgNjR2MTkyaC0yNTZ2LTE5MmgyNTZ6IG0wLTUxMnYxOTJoLTI1NlYxOTJoMjU2ek0zMjAgMTkydjE5Mkg2NFYxOTJoMjU2eiBtLTI1NiAyNTZoMjU2djE5Mkg2NHYtMTkyeiBtNjQwIDBoMjU2djE5MmgtMjU2di0xOTJ6IG0wLTY0VjE5MmgyNTZ2MTkyaC0yNTZ6TTY0IDcwNGgyNTZ2MTkySDY0di0xOTJ6IG02NDAgMTkydi0xOTJoMjU2djE5MmgtMjU2eiI+PC9wYXRoPjwvc3ZnPicsdGhpcy50YWc9ImJ1dHRvbiIsdGhpcy5zaG93RHJvcFBhbmVsPSEwLHRoaXMuJGNvbnRlbnQ9bnVsbDt9cmV0dXJuIG4ucHJvdG90eXBlLmdldFZhbHVlPWZ1bmN0aW9uKHQpe3JldHVybiAiIn0sbi5wcm90b3R5cGUuaXNBY3RpdmU9ZnVuY3Rpb24odCl7cmV0dXJuICExfSxuLnByb3RvdHlwZS5leGVjPWZ1bmN0aW9uKHQsZSl7fSxuLnByb3RvdHlwZS5pc0Rpc2FibGVkPWZ1bmN0aW9uKG4pe3ZhciByPW4uc2VsZWN0aW9uO3JldHVybiBudWxsPT1yfHwoIWUuUmFuZ2UuaXNDb2xsYXBzZWQocil8fCEhdC5Eb21FZGl0b3IuZ2V0U2VsZWN0ZWRFbGVtcyhuKS5zb21lKChmdW5jdGlvbihlKXt2YXIgcj10LkRvbUVkaXRvci5nZXROb2RlVHlwZShlKTtyZXR1cm4gInByZSI9PT1yfHwoInRhYmxlIj09PXJ8fCgibGlzdC1pdGVtIj09PXJ8fCEhbi5pc1ZvaWQoZSkpKX0pKSl9LG4ucHJvdG90eXBlLmdldFBhbmVsQ29udGVudEVsZW09ZnVuY3Rpb24odCl7dmFyIGU9dGhpcztpZih0aGlzLiRjb250ZW50KXJldHVybiB0aGlzLiRjb250ZW50WzBdO2Zvcih2YXIgbj1jLmRlZmF1bHQoJzxkaXYgY2xhc3M9InctZS1wYW5lbC1jb250ZW50LXRhYmxlIj48L2Rpdj4nKSxyPWMuZGVmYXVsdCgiPHNwYW4+MCAmdGltZXM7IDA8L3NwYW4+Iiksbz1jLmRlZmF1bHQoIjx0YWJsZT48L3RhYmxlPiIpLGk9MDtpPDEwO2krKyl7Zm9yKHZhciBhPWMuZGVmYXVsdCgiPHRyPjwvdHI+IiksbD0wO2w8MTA7bCsrKXt2YXIgdT1jLmRlZmF1bHQoIjx0ZD48L3RkPiIpO3UuYXR0cigiZGF0YS14IixsLnRvU3RyaW5nKCkpLHUuYXR0cigiZGF0YS15IixpLnRvU3RyaW5nKCkpLGEuYXBwZW5kKHUpLHUub24oIm1vdXNlZW50ZXIiLChmdW5jdGlvbih0KXt2YXIgZT10LnRhcmdldDtpZihudWxsIT1lKXt2YXIgbj1jLmRlZmF1bHQoZSkuZGF0YXNldCgpLGk9bi54LGE9bi55O3JbMF0uaW5uZXJIVE1MPWkrMSsiICZ0aW1lczsgIisoYSsxKSxvLmNoaWxkcmVuKCkuZWFjaCgoZnVuY3Rpb24odCl7Yy5kZWZhdWx0KHQpLmNoaWxkcmVuKCkuZWFjaCgoZnVuY3Rpb24odCl7dmFyIGU9Yy5kZWZhdWx0KHQpLG49ZS5kYXRhc2V0KCkscj1uLngsbz1uLnk7cjw9aSYmbzw9YT9lLmFkZENsYXNzKCJhY3RpdmUiKTplLnJlbW92ZUNsYXNzKCJhY3RpdmUiKTt9KSk7fSkpO319KSksdS5vbigiY2xpY2siLChmdW5jdGlvbihuKXtuLnByZXZlbnREZWZhdWx0KCk7dmFyIHI9bi50YXJnZXQ7aWYobnVsbCE9cil7dmFyIG89Yy5kZWZhdWx0KHIpLmRhdGFzZXQoKSxpPW8ueCxhPW8ueTtlLmluc2VydFRhYmxlKHQsYSsxLGkrMSk7fX0pKTt9by5hcHBlbmQoYSk7fXJldHVybiBuLmFwcGVuZChvKSxuLmFwcGVuZChyKSx0aGlzLiRjb250ZW50PW4sblswXX0sbi5wcm90b3R5cGUuaW5zZXJ0VGFibGU9ZnVuY3Rpb24obixyLG8pe3ZhciBpPXBhcnNlSW50KHIsMTApLGE9cGFyc2VJbnQobywxMCk7aWYoaSYmYSYmIShpPD0wfHxhPD0wKSl7dC5Eb21FZGl0b3IuaXNTZWxlY3RlZEVtcHR5UGFyYWdyYXBoKG4pJiZlLlRyYW5zZm9ybXMucmVtb3ZlTm9kZXMobix7bW9kZToiaGlnaGVzdCJ9KTt2YXIgbD1mdW5jdGlvbih0LGUpe2Zvcih2YXIgbj1bXSxyPTA7cjx0O3IrKyl7Zm9yKHZhciBvPVtdLGk9MDtpPGU7aSsrKXt2YXIgYT17dHlwZToidGFibGUtY2VsbCIsY2hpbGRyZW46W3t0ZXh0OiIifV19OzA9PT1yJiYoYS5pc0hlYWRlcj0hMCksby5wdXNoKGEpO31uLnB1c2goe3R5cGU6InRhYmxlLXJvdyIsY2hpbGRyZW46b30pO31yZXR1cm4ge3R5cGU6InRhYmxlIix3aWR0aDoiYXV0byIsY2hpbGRyZW46bn19KGksYSk7ZS5UcmFuc2Zvcm1zLmluc2VydE5vZGVzKG4sbCx7bW9kZToiaGlnaGVzdCJ9KTt9fSxufSgpLF9vPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbigpe3RoaXMudGl0bGU9dC50KCJ0YWJsZU1vZHVsZS5kZWxldGVUYWJsZSIpLHRoaXMuaWNvblN2Zz0nPHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0Ij48cGF0aCBkPSJNODI2LjgwMzIgMzU2LjUzMTJjLTE5LjMyOCAwLTM2LjM3NzYgMTUuNjkyOC0zNi4zNzc2IDM1LjA0NjR2NTI0LjI2MjRjMCAxOS4zMjgtMTYgMzQuNTYtMzUuMzI4IDM0LjU2SDI2NC45MzQ0Yy0xOS4zMjggMC0zNS41MDcyLTE1LjMwODgtMzUuNTA3Mi0zNC41NlYzOTAuMDQxNmMwLTE5LjMyOC0xNC4xNTY4LTM1LjA0NjQtMzMuNTEwNC0zNS4wNDY0cy0zMy41MTA0IDE1LjY5MjgtMzMuNTEwNCAzNS4wNDY0VjkxNS43MTJjMCA1Ny45MzI4IDQ0LjYyMDggMTA4LjI4OCAxMDIuNTI4IDEwOC4yODhINzU1LjJjNTcuOTMyOCAwIDEwOC4wODMyLTUwLjQ1NzYgMTA4LjA4MzItMTA4LjI4OFYzOTEuNDc1MmMtMC4xMDI0LTE5LjI1MTItMTcuMTI2NC0zNC45NDQtMzYuNDgtMzQuOTQ0eiIgcC1pZD0iOTU3NyI+PC9wYXRoPjxwYXRoIGQ9Ik00MzcuMTcxMiA3NzUuNzU2OFYzOTAuNjA0OGMwLTE5LjMyOC0xNC4xNTY4LTM1LjA0NjQtMzMuNTEwNC0zNS4wNDY0cy0zMy41MTA0IDE1LjYxNi0zMy41MTA0IDM1LjA0NjR2Mzg1LjE1MmMwIDE5LjMyOCAxNC4xNTY4IDM1LjA0NjQgMzMuNTEwNCAzNS4wNDY0czMzLjUxMDQtMTUuNzE4NCAzMy41MTA0LTM1LjA0NjR6TTY0OS43MDI0IDc3NS43NTY4VjM5MC42MDQ4YzAtMTkuMzI4LTE3LjA0OTYtMzUuMDQ2NC0zNi4zNzc2LTM1LjA0NjRzLTM2LjM3NzYgMTUuNjE2LTM2LjM3NzYgMzUuMDQ2NHYzODUuMTUyYzAgMTkuMzI4IDE3LjA0OTYgMzUuMDQ2NCAzNi4zNzc2IDM1LjA0NjRzMzYuMzc3Ni0xNS43MTg0IDM2LjM3NzYtMzUuMDQ2NHpNOTY1LjA0MzIgMjE3LjAzNjhoLTE3NC42MTc2VjE0NS41MTA0YzAtNTcuOTMyOC00Ny4yMDY0LTEwMS43Ni0xMDQuNjUyOC0xMDEuNzZoLTM1MC45NzZjLTU3LjgzMDQgMC0xMDUuMzk1MiA0My44NTI4LTEwNS4zOTUyIDEwMS43NnY3MS41MjY0SDU0Ljc4NGMtMTkuNDMwNCAwLTM1LjA0NjQgMTQuMTU2OC0zNS4wNDY0IDMzLjUxMDQgMCAxOS4zMjggMTUuNjE2IDMzLjUxMDQgMzUuMDQ2NCAzMy41MTA0aDkxMC4zNjE2YzE5LjMyOCAwIDM1LjA0NjQtMTQuMTU2OCAzNS4wNDY0LTMzLjUxMDQgMC0xOS4zNTM2LTE1LjY5MjgtMzMuNTEwNC0zNS4xNDg4LTMzLjUxMDR6IG0tMjQ3LjM3MjggMEgyOTcuMzk1MlYxNDUuNTEwNGMwLTE5LjMyOCAxOC4yMDE2LTM0Ljc2NDggMzcuNDI3Mi0zNC43NjQ4aDM1MC45NzZjMTkuMTQ4OCAwIDMxLjg3MiAxNS4xMjk2IDMxLjg3MiAzNC43NjQ4djcxLjUyNjR6Ij48L3BhdGg+PC9zdmc+Jyx0aGlzLnRhZz0iYnV0dG9uIjt9cmV0dXJuIG4ucHJvdG90eXBlLmdldFZhbHVlPWZ1bmN0aW9uKHQpe3JldHVybiAiIn0sbi5wcm90b3R5cGUuaXNBY3RpdmU9ZnVuY3Rpb24odCl7cmV0dXJuICExfSxuLnByb3RvdHlwZS5pc0Rpc2FibGVkPWZ1bmN0aW9uKGUpe3JldHVybiBudWxsPT1lLnNlbGVjdGlvbnx8bnVsbD09dC5Eb21FZGl0b3IuZ2V0U2VsZWN0ZWROb2RlQnlUeXBlKGUsInRhYmxlIil9LG4ucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24odCxuKXt0aGlzLmlzRGlzYWJsZWQodCl8fGUuVHJhbnNmb3Jtcy5yZW1vdmVOb2Rlcyh0LHttb2RlOiJoaWdoZXN0In0pO30sbn0oKSxXbz1mdW5jdGlvbigpe2Z1bmN0aW9uIG4oKXt0aGlzLnRpdGxlPXQudCgidGFibGVNb2R1bGUuaW5zZXJ0Um93IiksdGhpcy5pY29uU3ZnPSc8c3ZnIHZpZXdCb3g9IjAgMCAxMDQ4IDEwMjQiPjxwYXRoIGQ9Ik03MDcuNzg4OCA1MjEuMDExMmgtMTQ3LjQ1NnYtMTQ3LjQ1Nkg0ODguMjQzMnYxNDcuNDU2aC0xNDcuNDU2djY4LjgxMjhoMTQ3LjQ1NnYxNDcuNDU2aDcyLjA4OTZ2LTE0Ny40NTZoMTQ3LjQ1NnpNMCA5MTcuNTA0VjBoMTA0OC41NzZ2OTE3LjUwNEgwek0zMjcuNjggNjUuNTM2SDY1LjUzNnYxOTYuNjA4SDMyNy42OFY2NS41MzZ6IG0zMjcuNjggMEgzOTMuMjE2djE5Ni42MDhoMjYyLjE0NFY2NS41MzZ6IG0zMjcuNjggMGgtMjYyLjE0NHYxOTYuNjA4aDI2Mi4xNDRWNjUuNTM2eiBtMCAyNTguODY3Mkg2NS41MzZ2NDYyLjAyODhIOTgzLjA0VjMyNC40MDMyeiI+PC9wYXRoPjwvc3ZnPicsdGhpcy50YWc9ImJ1dHRvbiI7fXJldHVybiBuLnByb3RvdHlwZS5nZXRWYWx1ZT1mdW5jdGlvbih0KXtyZXR1cm4gIiJ9LG4ucHJvdG90eXBlLmlzQWN0aXZlPWZ1bmN0aW9uKHQpe3JldHVybiAhMX0sbi5wcm90b3R5cGUuaXNEaXNhYmxlZD1mdW5jdGlvbihuKXt2YXIgcj1uLnNlbGVjdGlvbjtyZXR1cm4gbnVsbD09cnx8KCFlLlJhbmdlLmlzQ29sbGFwc2VkKHIpfHxudWxsPT10LkRvbUVkaXRvci5nZXRTZWxlY3RlZE5vZGVCeVR5cGUobiwidGFibGUiKSl9LG4ucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24obixyKXtpZighdGhpcy5pc0Rpc2FibGVkKG4pKXt2YXIgbz1YbihlLkVkaXRvci5ub2RlcyhuLHttYXRjaDpmdW5jdGlvbihlKXtyZXR1cm4gdC5Eb21FZGl0b3IuY2hlY2tOb2RlVHlwZShlLCJ0YWJsZS1jZWxsIil9LHVuaXZlcnNhbDohMH0pLDEpLGk9WG4ob1swXSwyKSxhPWlbMF0sbD1pWzFdLHU9dC5Eb21FZGl0b3IuZ2V0UGFyZW50Tm9kZShuLGEpLGM9KG51bGw9PXU/dm9pZCAwOnUuY2hpbGRyZW4ubGVuZ3RoKXx8MDtpZigwIT09Yyl7Zm9yKHZhciBzPXt0eXBlOiJ0YWJsZS1yb3ciLGNoaWxkcmVuOltdfSxmPTA7ZjxjO2YrKyl7cy5jaGlsZHJlbi5wdXNoKHt0eXBlOiJ0YWJsZS1jZWxsIixjaGlsZHJlbjpbe3RleHQ6IiJ9XX0pO312YXIgZD1lLlBhdGgucGFyZW50KGwpLHA9ZS5QYXRoLm5leHQoZCk7ZS5UcmFuc2Zvcm1zLmluc2VydE5vZGVzKG4scyx7YXQ6cH0pO319fSxufSgpLFVvPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbigpe3RoaXMudGl0bGU9dC50KCJ0YWJsZU1vZHVsZS5kZWxldGVSb3ciKSx0aGlzLmljb25Tdmc9Jzxzdmcgdmlld0JveD0iMCAwIDEwNDggMTAyNCI+PHBhdGggZD0iTTkwNy42NzM2IDU4Ni41NDcyTDc0Ny4xMTA0IDQyNS45ODRsMTYzLjg0LTE2My44NC03OC42NDMyLTc4LjY0MzItMTYzLjg0IDE2My44NEw1MDcuOTA0IDE4Ni43Nzc2IDQyOS4yNjA4IDI2Mi4xNDRsMTYzLjg0IDE2My44NC0xNjcuMTE2OCAxNjcuMTE2OCA3OC42NDMyIDc4LjY0MzIgMTY3LjExNjgtMTY3LjExNjggMTYwLjU2MzIgMTYwLjU2MzIgNzUuMzY2NC03OC42NDMyek0wIDkxNy41MDRWMGgxMDQ4LjU3NnY5MTcuNTA0SDB6IG05ODMuMDQtMzI3LjY4aC0yMi45Mzc2bC02NS41MzYtNjUuNTM2SDk4My4wNFYzMjcuNjhoLTkxLjc1MDRsNjUuNTM2LTY1LjUzNmgyNi4yMTQ0VjY1LjUzNkg2NS41MzZ2MTk2LjYwOGgzMTcuODQ5Nmw2NS41MzYgNjUuNTM2SDY1LjUzNnYxOTYuNjA4aDM4MC4xMDg4bC02NS41MzYgNjUuNTM2SDY1LjUzNnYxOTYuNjA4SDk4My4wNHYtMTk2LjYwOHoiPjwvcGF0aD48L3N2Zz4nLHRoaXMudGFnPSJidXR0b24iO31yZXR1cm4gbi5wcm90b3R5cGUuZ2V0VmFsdWU9ZnVuY3Rpb24odCl7cmV0dXJuICIifSxuLnByb3RvdHlwZS5pc0FjdGl2ZT1mdW5jdGlvbih0KXtyZXR1cm4gITF9LG4ucHJvdG90eXBlLmlzRGlzYWJsZWQ9ZnVuY3Rpb24obil7dmFyIHI9bi5zZWxlY3Rpb247cmV0dXJuIG51bGw9PXJ8fCghZS5SYW5nZS5pc0NvbGxhcHNlZChyKXx8bnVsbD09dC5Eb21FZGl0b3IuZ2V0U2VsZWN0ZWROb2RlQnlUeXBlKG4sInRhYmxlLXJvdyIpKX0sbi5wcm90b3R5cGUuZXhlYz1mdW5jdGlvbihuLHIpe2lmKCF0aGlzLmlzRGlzYWJsZWQobikpe3ZhciBvPVhuKGUuRWRpdG9yLm5vZGVzKG4se21hdGNoOmZ1bmN0aW9uKGUpe3JldHVybiB0LkRvbUVkaXRvci5jaGVja05vZGVUeXBlKGUsInRhYmxlLXJvdyIpfSx1bml2ZXJzYWw6ITB9KSwxKSxpPVhuKG9bMF0sMiksYT1pWzBdLGw9aVsxXSx1PXQuRG9tRWRpdG9yLmdldFBhcmVudE5vZGUobixhKTsoKG51bGw9PXU/dm9pZCAwOnUuY2hpbGRyZW4ubGVuZ3RoKXx8MCk8PTE/ZS5UcmFuc2Zvcm1zLnJlbW92ZU5vZGVzKG4se21vZGU6ImhpZ2hlc3QifSk6ZS5UcmFuc2Zvcm1zLnJlbW92ZU5vZGVzKG4se2F0Omx9KTt9fSxufSgpLFhvPXtDU1NSdWxlTGlzdDowLENTU1N0eWxlRGVjbGFyYXRpb246MCxDU1NWYWx1ZUxpc3Q6MCxDbGllbnRSZWN0TGlzdDowLERPTVJlY3RMaXN0OjAsRE9NU3RyaW5nTGlzdDowLERPTVRva2VuTGlzdDoxLERhdGFUcmFuc2Zlckl0ZW1MaXN0OjAsRmlsZUxpc3Q6MCxIVE1MQWxsQ29sbGVjdGlvbjowLEhUTUxDb2xsZWN0aW9uOjAsSFRNTEZvcm1FbGVtZW50OjAsSFRNTFNlbGVjdEVsZW1lbnQ6MCxNZWRpYUxpc3Q6MCxNaW1lVHlwZUFycmF5OjAsTmFtZWROb2RlTWFwOjAsTm9kZUxpc3Q6MSxQYWludFJlcXVlc3RMaXN0OjAsUGx1Z2luOjAsUGx1Z2luQXJyYXk6MCxTVkdMZW5ndGhMaXN0OjAsU1ZHTnVtYmVyTGlzdDowLFNWR1BhdGhTZWdMaXN0OjAsU1ZHUG9pbnRMaXN0OjAsU1ZHU3RyaW5nTGlzdDowLFNWR1RyYW5zZm9ybUxpc3Q6MCxTb3VyY2VCdWZmZXJMaXN0OjAsU3R5bGVTaGVldExpc3Q6MCxUZXh0VHJhY2tDdWVMaXN0OjAsVGV4dFRyYWNrTGlzdDowLFRvdWNoTGlzdDowfSxZbz1PdCgic3BhbiIpLmNsYXNzTGlzdCxLbz1ZbyYmWW8uY29uc3RydWN0b3ImJllvLmNvbnN0cnVjdG9yLnByb3RvdHlwZSxKbz1Lbz09PU9iamVjdC5wcm90b3R5cGU/dm9pZCAwOktvLFFvPXJyLmZvckVhY2gsWm89ZnVuY3Rpb24odCxlKXt2YXIgbj1bXVt0XTtyZXR1cm4gISFuJiZ5KChmdW5jdGlvbigpe24uY2FsbChudWxsLGV8fGZ1bmN0aW9uKCl7dGhyb3cgMX0sMSk7fSkpfSgiZm9yRWFjaCIpLHRpPVpvP1tdLmZvckVhY2g6ZnVuY3Rpb24odCl7cmV0dXJuIFFvKHRoaXMsdCxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCl9LGVpPWZ1bmN0aW9uKHQpe2lmKHQmJnQuZm9yRWFjaCE9PXRpKXRyeXtCdCh0LCJmb3JFYWNoIix0aSk7fWNhdGNoKGUpe3QuZm9yRWFjaD10aTt9fTtmb3IodmFyIG5pIGluIFhvKVhvW25pXSYmZWkoZ1tuaV0mJmdbbmldLnByb3RvdHlwZSk7ZWkoSm8pO3ZhciByaT1mdW5jdGlvbigpe2Z1bmN0aW9uIG4oKXt0aGlzLnRpdGxlPXQudCgidGFibGVNb2R1bGUuaW5zZXJ0Q29sIiksdGhpcy5pY29uU3ZnPSc8c3ZnIHZpZXdCb3g9IjAgMCAxMDQ4IDEwMjQiPjxwYXRoIGQ9Ik0zMjcuNjggMTkzLjMzMTJ2MTg2Ljc3NzZIMTQwLjkwMjR2OTEuNzUwNEgzMjcuNjh2MTg2Ljc3NzZoODguNDczNlY0NzEuODU5MmgxOTAuMDU0NFYzODAuMTA4OEg0MTYuMTUzNlYxOTMuMzMxMnpNMCA5MTcuNTA0VjBoMTA0OC41NzZ2OTE3LjUwNEgwek02NTUuMzYgNjUuNTM2SDY1LjUzNnY3MjAuODk2SDY1NS4zNlY2NS41MzZ6IG0zMjcuNjggMGgtMjYyLjE0NHYxOTYuNjA4aDI2Mi4xNDRWNjUuNTM2eiBtMCAyNjIuMTQ0aC0yNjIuMTQ0djE5Ni42MDhoMjYyLjE0NFYzMjcuNjh6IG0wIDI2Mi4xNDRoLTI2Mi4xNDR2MTk2LjYwOGgyNjIuMTQ0di0xOTYuNjA4eiI+PC9wYXRoPjwvc3ZnPicsdGhpcy50YWc9ImJ1dHRvbiI7fXJldHVybiBuLnByb3RvdHlwZS5nZXRWYWx1ZT1mdW5jdGlvbih0KXtyZXR1cm4gIiJ9LG4ucHJvdG90eXBlLmlzQWN0aXZlPWZ1bmN0aW9uKHQpe3JldHVybiAhMX0sbi5wcm90b3R5cGUuaXNEaXNhYmxlZD1mdW5jdGlvbihuKXt2YXIgcj1uLnNlbGVjdGlvbjtyZXR1cm4gbnVsbD09cnx8KCFlLlJhbmdlLmlzQ29sbGFwc2VkKHIpfHxudWxsPT10LkRvbUVkaXRvci5nZXRTZWxlY3RlZE5vZGVCeVR5cGUobiwidGFibGUiKSl9LG4ucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24obixyKXtpZighdGhpcy5pc0Rpc2FibGVkKG4pKXt2YXIgbz1YbihlLkVkaXRvci5ub2RlcyhuLHttYXRjaDpmdW5jdGlvbihlKXtyZXR1cm4gdC5Eb21FZGl0b3IuY2hlY2tOb2RlVHlwZShlLCJ0YWJsZS1jZWxsIil9LHVuaXZlcnNhbDohMH0pLDEpLGk9WG4ob1swXSwyKSxhPWlbMF0sbD1pWzFdLHU9dC5Eb21FZGl0b3IuZ2V0UGFyZW50Tm9kZShuLGEpO2lmKG51bGwhPXUpe3ZhciBjPXQuRG9tRWRpdG9yLmdldFBhcmVudE5vZGUobix1KTtpZihudWxsIT1jKShjLmNoaWxkcmVufHxbXSkuZm9yRWFjaCgoZnVuY3Rpb24ocixvKXtlLkVsZW1lbnQuaXNFbGVtZW50KHIpJiYoci5jaGlsZHJlbnx8W10pLmZvckVhY2goKGZ1bmN0aW9uKHIpe3ZhciBpPXQuRG9tRWRpdG9yLmZpbmRQYXRoKG4scik7aWYoaS5sZW5ndGg9PT1sLmxlbmd0aCYmcy5kZWZhdWx0KGkuc2xpY2UoLTEpLGwuc2xpY2UoLTEpKSl7dmFyIGE9e3R5cGU6InRhYmxlLWNlbGwiLGNoaWxkcmVuOlt7dGV4dDoiIn1dfTswPT09byYmbHIoYykmJihhLmlzSGVhZGVyPSEwKSxlLlRyYW5zZm9ybXMuaW5zZXJ0Tm9kZXMobixhLHthdDppfSk7fX0pKTt9KSk7fX19LG59KCksb2k9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKCl7dGhpcy50aXRsZT10LnQoInRhYmxlTW9kdWxlLmRlbGV0ZUNvbCIpLHRoaXMuaWNvblN2Zz0nPHN2ZyB2aWV3Qm94PSIwIDAgMTA0OCAxMDI0Ij48cGF0aCBkPSJNMzI3LjY4IDUxMC45NzZMMzkzLjIxNiA0NDUuNDR2LTEzLjEwNzJMMzI3LjY4IDM2Ni43OTY4VjUxMC45NzZ6IG0zMjcuNjgtNzguNDM4NGw2NS41MzYtNjUuNTM2VjUwNy45MDRMNjU1LjM2IDQ0Mi4zNjh2LTkuODMwNHogbTM5My4yMTYgNDg0Ljk2NjRWMEgwdjkxNy41MDRoMTA0OC41NzZ6IG0tNjUuNTM2LTEzMS4wNzJoLTI2Mi4xNDR2LTUyLjQyODhsLTEzLjEwNzIgMTMuMTA3Mi01Mi40Mjg4LTUyLjQyODh2OTEuNzUwNEgzOTMuMjE2di05MS43NTA0bC01Mi40Mjg4IDUyLjQyODgtMTMuMTA3Mi0xMy4xMDcydjUyLjQyODhINjUuNTM2VjY1LjUzNkgzMjcuNjh2MTIxLjI0MTZsMzYuMDQ0OC0zNi4wNDQ4IDI5LjQ5MTIgMjkuNDkxMlY2Mi4yNTkyaDI2Mi4xNDRWMTgwLjIyNGw0OS4xNTItNDkuMTUyIDE2LjM4NCAxNi4zODRWNjIuMjU5MmgyNjIuMTQ0Vjc4Ni40MzJ6IG0tMjk0LjkxMi0xMDguMTM0NGwtMTYwLjU2MzItMTYwLjU2MzItMTY3LjExNjggMTY3LjExNjgtNzguNjQzMi03OC42NDMyIDE2Ny4xMTY4LTE2Ny4xMTY4TDI4OC4zNTg0IDI3OC41MjhsNzguNjQzMi03OC42NDMyIDE2MC41NjMyIDE2MC41NjMyIDE2My44NC0xNjMuODQgNzguNjQzMiA3OC42NDMyLTE2My44NCAxNjMuODQgMTYwLjU2MzIgMTYwLjU2MzItNzguNjQzMiA3OC42NDMyeiI+PC9wYXRoPjwvc3ZnPicsdGhpcy50YWc9ImJ1dHRvbiI7fXJldHVybiBuLnByb3RvdHlwZS5nZXRWYWx1ZT1mdW5jdGlvbih0KXtyZXR1cm4gIiJ9LG4ucHJvdG90eXBlLmlzQWN0aXZlPWZ1bmN0aW9uKHQpe3JldHVybiAhMX0sbi5wcm90b3R5cGUuaXNEaXNhYmxlZD1mdW5jdGlvbihuKXt2YXIgcj1uLnNlbGVjdGlvbjtyZXR1cm4gbnVsbD09cnx8KCFlLlJhbmdlLmlzQ29sbGFwc2VkKHIpfHxudWxsPT10LkRvbUVkaXRvci5nZXRTZWxlY3RlZE5vZGVCeVR5cGUobiwidGFibGUtY2VsbCIpKX0sbi5wcm90b3R5cGUuZXhlYz1mdW5jdGlvbihuLHIpe2lmKCF0aGlzLmlzRGlzYWJsZWQobikpe3ZhciBvPVhuKGUuRWRpdG9yLm5vZGVzKG4se21hdGNoOmZ1bmN0aW9uKGUpe3JldHVybiB0LkRvbUVkaXRvci5jaGVja05vZGVUeXBlKGUsInRhYmxlLWNlbGwiKX0sdW5pdmVyc2FsOiEwfSksMSksaT1YbihvWzBdLDIpLGE9aVswXSxsPWlbMV0sdT10LkRvbUVkaXRvci5nZXRQYXJlbnROb2RlKG4sYSksYz0obnVsbD09dT92b2lkIDA6dS5jaGlsZHJlbi5sZW5ndGgpfHwwO2lmKCF1fHxjPD0xKWUuVHJhbnNmb3Jtcy5yZW1vdmVOb2RlcyhuLHttb2RlOiJoaWdoZXN0In0pO2Vsc2Uge3ZhciBmPXQuRG9tRWRpdG9yLmdldFBhcmVudE5vZGUobix1KTtpZihudWxsIT1mKShmLmNoaWxkcmVufHxbXSkuZm9yRWFjaCgoZnVuY3Rpb24ocil7ZS5FbGVtZW50LmlzRWxlbWVudChyKSYmKHIuY2hpbGRyZW58fFtdKS5mb3JFYWNoKChmdW5jdGlvbihyKXt2YXIgbz10LkRvbUVkaXRvci5maW5kUGF0aChuLHIpO28ubGVuZ3RoPT09bC5sZW5ndGgmJnMuZGVmYXVsdChvLnNsaWNlKC0xKSxsLnNsaWNlKC0xKSkmJmUuVHJhbnNmb3Jtcy5yZW1vdmVOb2RlcyhuLHthdDpvfSk7fSkpO30pKTt9fX0sbn0oKSxpaT1mdW5jdGlvbigpe2Z1bmN0aW9uIG4oKXt0aGlzLnRpdGxlPXQudCgidGFibGVNb2R1bGUuaGVhZGVyIiksdGhpcy5pY29uU3ZnPSc8c3ZnIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik03MDQgMTI4bC02NCAwTDM4NCAxMjggMzIwIDEyOCAwIDEyOGwwIDI1NiAwIDY0IDAgMTkyIDAgNjQgMCAyNTYgMzIwIDAgNjQgMCAyNTYgMCA2NCAwIDMyMCAwIDAtMjU2IDAtNjRMMTAyNCA0NDggMTAyNCAzODQgMTAyNCAxMjggNzA0IDEyOHpNNjQwIDY0MCAzODQgNjQwIDM4NCA0NDhsMjU2IDBMNjQwIDY0MHpNNjQgNDQ4bDI1NiAwIDAgMTkyTDY0IDY0MCA2NCA0NDh6TTMyMCA4OTYgNjQgODk2bDAtMTkyIDI1NiAwTDMyMCA4OTZ6TTY0MCA4OTYgMzg0IDg5NmwwLTE5MiAyNTYgMEw2NDAgODk2ek05NjAgODk2bC0yNTYgMCAwLTE5MiAyNTYgMEw5NjAgODk2ek05NjAgNjQwbC0yNTYgMEw3MDQgNDQ4bDI1NiAwTDk2MCA2NDB6Ij48L3BhdGg+PC9zdmc+Jyx0aGlzLnRhZz0iYnV0dG9uIjt9cmV0dXJuIG4ucHJvdG90eXBlLmdldFZhbHVlPWZ1bmN0aW9uKGUpe3ZhciBuPXQuRG9tRWRpdG9yLmdldFNlbGVjdGVkTm9kZUJ5VHlwZShlLCJ0YWJsZSIpO3JldHVybiBudWxsIT1uJiZscihuKX0sbi5wcm90b3R5cGUuaXNBY3RpdmU9ZnVuY3Rpb24odCl7cmV0dXJuICEhdGhpcy5nZXRWYWx1ZSh0KX0sbi5wcm90b3R5cGUuaXNEaXNhYmxlZD1mdW5jdGlvbihuKXt2YXIgcj1uLnNlbGVjdGlvbjtyZXR1cm4gbnVsbD09cnx8KCFlLlJhbmdlLmlzQ29sbGFwc2VkKHIpfHxudWxsPT10LkRvbUVkaXRvci5nZXRTZWxlY3RlZE5vZGVCeVR5cGUobiwidGFibGUiKSl9LG4ucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24obixyKXtpZighdGhpcy5pc0Rpc2FibGVkKG4pKXt2YXIgbz0hcixpPXQuRG9tRWRpdG9yLmdldFNlbGVjdGVkTm9kZUJ5VHlwZShuLCJ0YWJsZSIpO2lmKG51bGwhPWkpYXIoaSkuZm9yRWFjaCgoZnVuY3Rpb24ocil7cmV0dXJuIGUuVHJhbnNmb3Jtcy5zZXROb2RlcyhuLHtpc0hlYWRlcjpvfSx7YXQ6dC5Eb21FZGl0b3IuZmluZFBhdGgobixyKX0pfSkpO319LG59KCksYWk9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKCl7dGhpcy50aXRsZT10LnQoInRhYmxlTW9kdWxlLndpZHRoQXV0byIpLHRoaXMuaWNvblN2Zz0nPHN2ZyB2aWV3Qm94PSIwIDAgMTIyOCAxMDI0Ij48cGF0aCBkPSJNODYyLjUxNDMzNyA1NjMuMjAwNDYxSDQwNC41ODE5OTV2MTIxLjc1MzQ3OGExMy4zMTE5ODcgMTMuMzExOTg3IDAgMCAxLTYuNjU1OTkzIDExLjQ2ODc4OSAxMC4yMzk5OSAxMC4yMzk5OSAwIDAgMS0xMi4wODMxODgtMS40MzM1OTlsLTIwNC43OTk3OTUtMTc5LjE5OTgyMWExMy43MjE1ODYgMTMuNzIxNTg2IDAgMCAxIDAtMjAuNDc5OTc5bDIwNC43OTk3OTUtMTc5LjMwMjIyMWExMC4yMzk5OSAxMC4yMzk5OSAwIDAgMSAxMi4xODU1ODgtMS41MzU5OTggMTMuMjA5NTg3IDEzLjIwOTU4NyAwIDAgMSA2LjU1MzU5MyAxMS42NzM1ODh2MTE1LjA5NzQ4NWg0NTcuOTMyMzQyVjMxOS42OTM1MDRhMTEuNTcxMTg4IDExLjU3MTE4OCAwIDAgMSAxOC44NDE1ODItMTAuMjM5OTg5bDIwNC43OTk3OTUgMTc5LjE5OTgyYTEzLjcyMTU4NiAxMy43MjE1ODYgMCAwIDEgMCAyMC40Nzk5OGwtMjA0Ljc5OTc5NSAxNzkuMTk5ODIxYTEwLjIzOTk5IDEwLjIzOTk5IDAgMCAxLTEyLjE4NTU4OCAxLjUzNTk5OCAxMy4zMTE5ODcgMTMuMzExOTg3IDAgMCAxLTYuNjU1OTk0LTExLjU3MTE4OFY1NjMuMjAwNDYxek0xMzYuNDk5MDY0IDE0Ljk1MTQwOXY5OTMuODkzNDA2YTE1LjI1NzU4NSAxNS4yNTc1ODUgMCAwIDEtMTUuMTU1MTg1IDE1LjA1Mjc4NUgxNS4xNTUxODVBMTUuMTU1MTg1IDE1LjE1NTE4NSAwIDAgMSAwIDEwMDguODQ0ODE1VjE0Ljk1MTQwOWExNS4yNTc1ODUgMTUuMjU3NTg1IDAgMCAxIDE1LjE1NTE4NS0xNS4wNTI3ODVoMTA2LjA4NjI5NGExNS4xNTUxODUgMTUuMTU1MTg1IDAgMCAxIDE1LjI1NzU4NSAxNS4xNTUxODV6TTEyMjguNzk4NzcxIDE0Ljk1MTQwOXY5OTMuODkzNDA2YTE1LjI1NzU4NSAxNS4yNTc1ODUgMCAwIDEtMTUuMTU1MTg1IDE1LjA1Mjc4NWgtMTA2LjE4ODY5M2ExNS4xNTUxODUgMTUuMTU1MTg1IDAgMCAxLTE1LjE1NTE4NS0xNS4wNTI3ODVWMTQuOTUxNDA5YTE1LjI1NzU4NSAxNS4yNTc1ODUgMCAwIDEgMTUuMTU1MTg1LTE1LjA1Mjc4NWgxMDYuMDg2MjkzQTE1LjE1NTE4NSAxNS4xNTUxODUgMCAwIDEgMTIyOC43OTg3NzEgMTUuMDUzODA5eiI+PC9wYXRoPjwvc3ZnPicsdGhpcy50YWc9ImJ1dHRvbiI7fXJldHVybiBuLnByb3RvdHlwZS5nZXRWYWx1ZT1mdW5jdGlvbihlKXt2YXIgbj10LkRvbUVkaXRvci5nZXRTZWxlY3RlZE5vZGVCeVR5cGUoZSwidGFibGUiKTtyZXR1cm4gbnVsbCE9biYmIjEwMCUiPT09bi53aWR0aH0sbi5wcm90b3R5cGUuaXNBY3RpdmU9ZnVuY3Rpb24odCl7cmV0dXJuICEhdGhpcy5nZXRWYWx1ZSh0KX0sbi5wcm90b3R5cGUuaXNEaXNhYmxlZD1mdW5jdGlvbihuKXt2YXIgcj1uLnNlbGVjdGlvbjtyZXR1cm4gbnVsbD09cnx8KCFlLlJhbmdlLmlzQ29sbGFwc2VkKHIpfHxudWxsPT10LkRvbUVkaXRvci5nZXRTZWxlY3RlZE5vZGVCeVR5cGUobiwidGFibGUiKSl9LG4ucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24odCxuKXtpZighdGhpcy5pc0Rpc2FibGVkKHQpKXt2YXIgcj17d2lkdGg6bj8iYXV0byI6IjEwMCUifTtlLlRyYW5zZm9ybXMuc2V0Tm9kZXModCxyLHttb2RlOiJoaWdoZXN0In0pO319LG59KCksbGk9e3JlbmRlckVsZW1zOlt5byxtbyxib10sZWxlbXNUb0h0bWw6W0VvLHdvLHhvXSxwcmVQYXJzZUh0bWw6W1NvXSxwYXJzZUVsZW1zSHRtbDpbJG8sRm8scW9dLG1lbnVzOlt7a2V5OiJpbnNlcnRUYWJsZSIsZmFjdG9yeTpmdW5jdGlvbigpe3JldHVybiBuZXcgR299fSx7a2V5OiJkZWxldGVUYWJsZSIsZmFjdG9yeTpmdW5jdGlvbigpe3JldHVybiBuZXcgX299fSx7a2V5OiJpbnNlcnRUYWJsZVJvdyIsZmFjdG9yeTpmdW5jdGlvbigpe3JldHVybiBuZXcgV299fSx7a2V5OiJkZWxldGVUYWJsZVJvdyIsZmFjdG9yeTpmdW5jdGlvbigpe3JldHVybiBuZXcgVW99fSx7a2V5OiJpbnNlcnRUYWJsZUNvbCIsZmFjdG9yeTpmdW5jdGlvbigpe3JldHVybiBuZXcgcml9fSx7a2V5OiJkZWxldGVUYWJsZUNvbCIsZmFjdG9yeTpmdW5jdGlvbigpe3JldHVybiBuZXcgb2l9fSx7a2V5OiJ0YWJsZUhlYWRlciIsZmFjdG9yeTpmdW5jdGlvbigpe3JldHVybiBuZXcgaWl9fSx7a2V5OiJ0YWJsZUZ1bGxXaWR0aCIsZmFjdG9yeTpmdW5jdGlvbigpe3JldHVybiBuZXcgYWl9fV0sZWRpdG9yUGx1Z2luOmZ1bmN0aW9uKG4pe3ZhciByPW4uaW5zZXJ0QnJlYWssbz1uLmRlbGV0ZUJhY2t3YXJkLGk9bi5kZWxldGVGb3J3YXJkLGE9bi5ub3JtYWxpemVOb2RlLGw9bi5pbnNlcnREYXRhLHU9bi5oYW5kbGVUYWIsYz1uLnNlbGVjdEFsbCxzPW47cmV0dXJuIHMuaW5zZXJ0QnJlYWs9ZnVuY3Rpb24oKXtudWxsPT10LkRvbUVkaXRvci5nZXRTZWxlY3RlZE5vZGVCeVR5cGUocywidGFibGUiKT9yKCk6cy5pbnNlcnRUZXh0KCJcbiIpO30scy5kZWxldGVCYWNrd2FyZD1mdW5jdGlvbih0KXtpZighWW4ocykpe3ZhciBuPXMuc2VsZWN0aW9uO2lmKG4pe3ZhciByPWUuRWRpdG9yLmJlZm9yZShzLG4pO2lmKHIpe3ZhciBpPUtuKHMsciksYT1LbihzLG4pO2lmKGkmJiFhKXJldHVybn19byh0KTt9fSxzLmhhbmRsZVRhYj1mdW5jdGlvbigpe3ZhciByO2lmKHQuRG9tRWRpdG9yLmdldFNlbGVjdGVkTm9kZUJ5VHlwZShzLCJ0YWJsZSIpKXt2YXIgbz1lLkVkaXRvci5hYm92ZShuKTt0LkRvbUVkaXRvci5jaGVja05vZGVUeXBlKG9bMF0sInRhYmxlLWNlbGwiKSYmZS5UcmFuc2Zvcm1zLnNlbGVjdChuLG9bMV0pO3ZhciBpPWUuRWRpdG9yLm5leHQobik7aWYoaSlpWzBdJiZpWzBdLnRleHQmJihpPW51bGwhPT0ocj1lLkVkaXRvci5hYm92ZShuLHthdDppWzFdfSkpJiZ2b2lkIDAhPT1yP3I6aSksZS5UcmFuc2Zvcm1zLnNlbGVjdChuLGlbMV0pO2Vsc2Uge3ZhciBhPXMuY2hpbGRyZW58fFtdLGw9YS5sZW5ndGg7aWYodC5Eb21FZGl0b3IuY2hlY2tOb2RlVHlwZShhW2wtMV0sInRhYmxlIikpe3ZhciBjPXQuRG9tRWRpdG9yLmdlbkVtcHR5UGFyYWdyYXBoKCk7ZS5UcmFuc2Zvcm1zLmluc2VydE5vZGVzKHMsYyx7YXQ6W2xdfSkscy5oYW5kbGVUYWIoKTt9fX1lbHNlIHUoKTt9LHMuZGVsZXRlRm9yd2FyZD1mdW5jdGlvbih0KXtZbihzKXx8aSh0KTt9LHMubm9ybWFsaXplTm9kZT1mdW5jdGlvbihuKXt2YXIgcj1YbihuLDIpLG89clswXSxpPXJbMV07aWYoInRhYmxlIiE9PXQuRG9tRWRpdG9yLmdldE5vZGVUeXBlKG8pKXJldHVybiBhKFtvLGldKTtpZih0LkRvbUVkaXRvci5pc0xhc3ROb2RlKHMsbykpe3ZhciBsPXQuRG9tRWRpdG9yLmdlbkVtcHR5UGFyYWdyYXBoKCk7ZS5UcmFuc2Zvcm1zLmluc2VydE5vZGVzKHMsbCx7YXQ6W2lbMF0rMV19KTt9fSxzLmluc2VydERhdGE9ZnVuY3Rpb24obil7aWYobnVsbCE9dC5Eb21FZGl0b3IuZ2V0U2VsZWN0ZWROb2RlQnlUeXBlKHMsInRhYmxlIikpe3ZhciByPW4uZ2V0RGF0YSgidGV4dC9wbGFpbiIpOyJcbiI9PT1yfHwvPGltZ1tePl0rPi8udGVzdChuLmdldERhdGEoInRleHQvaHRtbCIpKT9sKG4pOmUuRWRpdG9yLmluc2VydFRleHQocyxyKTt9ZWxzZSBsKG4pO30scy5zZWxlY3RBbGw9ZnVuY3Rpb24oKXt2YXIgbj1zLnNlbGVjdGlvbjtpZihudWxsIT1uKXt2YXIgcj10LkRvbUVkaXRvci5nZXRTZWxlY3RlZE5vZGVCeVR5cGUocywidGFibGUtY2VsbCIpO2lmKG51bGwhPXIpe3ZhciBvPW4uYW5jaG9yLGk9bi5mb2N1cztpZihlLlBhdGguZXF1YWxzKG8ucGF0aC5zbGljZSgwLDMpLGkucGF0aC5zbGljZSgwLDMpKSlpZigwIT09ZS5Ob2RlLnN0cmluZyhyKS5sZW5ndGgpe3ZhciBhPXQuRG9tRWRpdG9yLmZpbmRQYXRoKHMsciksbD17YW5jaG9yOmUuRWRpdG9yLnN0YXJ0KHMsYSksZm9jdXM6ZS5FZGl0b3IuZW5kKHMsYSl9O3Muc2VsZWN0KGwpO31lbHNlIGMoKTtlbHNlIGMoKTt9ZWxzZSBjKCk7fWVsc2UgYygpO30sc319O3JldHVybiBsaX0pKTsKCiAgfSk7CgogIHZhciBkaXN0JDIgPSBjcmVhdGVDb21tb25qc01vZHVsZSQxKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKICAhZnVuY3Rpb24odCxlKXttb2R1bGUuZXhwb3J0cz1lKGRpc3QkNixyZXF1aXJlJCQyJDEscmVxdWlyZSQkMixyZXF1aXJlJCQxLHJlcXVpcmUkJDQpO30oY29tbW9uanNHbG9iYWwsKGZ1bmN0aW9uKHQsZSxuLHIsbyl7ZnVuY3Rpb24gaSh0KXtyZXR1cm4gdCYmIm9iamVjdCI9PXR5cGVvZiB0JiYiZGVmYXVsdCJpbiB0P3Q6e2RlZmF1bHQ6dH19dmFyIHU9aShyKTt0LmkxOG5BZGRSZXNvdXJjZXMoImVuIix7dmlkZW9Nb2R1bGU6e2RlbGV0ZToiRGVsZXRlIix1cGxvYWRWaWRlbzoiVXBsb2FkIHZpZGVvIixpbnNlcnRWaWRlbzoiSW5zZXJ0IHZpZGVvIix2aWRlb1NyYzoiVmlkZW8gc291cmNlIix2aWRlb1NyY1BsYWNlSG9sZGVyOiJWaWRlbyBmaWxlIHVybCwgb3IgdGhpcmQtcGFydHkgPGlmcmFtZT4iLHZpZGVvUG9zdGVyOiJWaWRlbyBwb3N0ZXIiLHZpZGVvUG9zdGVyUGxhY2VIb2xkZXI6IlBvc3RlciBpbWFnZSB1cmwiLG9rOiJPayIsZWRpdFNpemU6IkVkaXQgc2l6ZSIsd2lkdGg6IldpZHRoIixoZWlnaHQ6IkhlaWdodCJ9fSksdC5pMThuQWRkUmVzb3VyY2VzKCJ6aC1DTiIse3ZpZGVvTW9kdWxlOntkZWxldGU6IuWIoOmZpOinhumikSIsdXBsb2FkVmlkZW86IuS4iuS8oOinhumikSIsaW5zZXJ0VmlkZW86IuaPkuWFpeinhumikSIsdmlkZW9TcmM6IuinhumikeWcsOWdgCIsdmlkZW9TcmNQbGFjZUhvbGRlcjoi6KeG6aKR5paH5Lu2IHVybCDmiJbnrKzkuInmlrkgPGlmcmFtZT4iLHZpZGVvUG9zdGVyOiLop4bpopHlsIHpnaIiLHZpZGVvUG9zdGVyUGxhY2VIb2xkZXI6IuWwgemdouWbvueJhyB1cmwiLG9rOiLnoa7lrpoiLGVkaXRTaXplOiLkv67mlLnlsLrlr7giLHdpZHRoOiLlrr3luqYiLGhlaWdodDoi6auY5bqmIn19KTsKICAvKiEgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLgoKICAgIFBlcm1pc3Npb24gdG8gdXNlLCBjb3B5LCBtb2RpZnksIGFuZC9vciBkaXN0cmlidXRlIHRoaXMgc29mdHdhcmUgZm9yIGFueQogICAgcHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLgoKICAgIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiIEFORCBUSEUgQVVUSE9SIERJU0NMQUlNUyBBTEwgV0FSUkFOVElFUyBXSVRICiAgICBSRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkKICAgIEFORCBGSVRORVNTLiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SIEJFIExJQUJMRSBGT1IgQU5ZIFNQRUNJQUwsIERJUkVDVCwKICAgIElORElSRUNULCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgT1IgQU5ZIERBTUFHRVMgV0hBVFNPRVZFUiBSRVNVTFRJTkcgRlJPTQogICAgTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1IKICAgIE9USEVSIFRPUlRJT1VTIEFDVElPTiwgQVJJU0lORyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBVU0UgT1IKICAgIFBFUkZPUk1BTkNFIE9GIFRISVMgU09GVFdBUkUuCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqLwogIHZhciBhPWZ1bmN0aW9uKCl7cmV0dXJuIGE9T2JqZWN0LmFzc2lnbnx8ZnVuY3Rpb24odCl7Zm9yKHZhciBlLG49MSxyPWFyZ3VtZW50cy5sZW5ndGg7bjxyO24rKylmb3IodmFyIG8gaW4gZT1hcmd1bWVudHNbbl0pT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsbykmJih0W29dPWVbb10pO3JldHVybiB0fSxhLmFwcGx5KHRoaXMsYXJndW1lbnRzKX07ZnVuY3Rpb24gYyh0LGUsbixyKXtyZXR1cm4gbmV3KG58fChuPVByb21pc2UpKSgoZnVuY3Rpb24obyxpKXtmdW5jdGlvbiB1KHQpe3RyeXtjKHIubmV4dCh0KSk7fWNhdGNoKHQpe2kodCk7fX1mdW5jdGlvbiBhKHQpe3RyeXtjKHIudGhyb3codCkpO31jYXRjaCh0KXtpKHQpO319ZnVuY3Rpb24gYyh0KXt2YXIgZTt0LmRvbmU/byh0LnZhbHVlKTooZT10LnZhbHVlLGUgaW5zdGFuY2VvZiBuP2U6bmV3IG4oKGZ1bmN0aW9uKHQpe3QoZSk7fSkpKS50aGVuKHUsYSk7fWMoKHI9ci5hcHBseSh0LGV8fFtdKSkubmV4dCgpKTt9KSl9ZnVuY3Rpb24gZih0LGUpe3ZhciBuLHIsbyxpLHU9e2xhYmVsOjAsc2VudDpmdW5jdGlvbigpe2lmKDEmb1swXSl0aHJvdyBvWzFdO3JldHVybiBvWzFdfSx0cnlzOltdLG9wczpbXX07cmV0dXJuIGk9e25leHQ6YSgwKSx0aHJvdzphKDEpLHJldHVybjphKDIpfSwiZnVuY3Rpb24iPT10eXBlb2YgU3ltYm9sJiYoaVtTeW1ib2wuaXRlcmF0b3JdPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9KSxpO2Z1bmN0aW9uIGEoaSl7cmV0dXJuIGZ1bmN0aW9uKGEpe3JldHVybiBmdW5jdGlvbihpKXtpZihuKXRocm93IG5ldyBUeXBlRXJyb3IoIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy4iKTtmb3IoO3U7KXRyeXtpZihuPTEsciYmKG89MiZpWzBdP3IucmV0dXJuOmlbMF0/ci50aHJvd3x8KChvPXIucmV0dXJuKSYmby5jYWxsKHIpLDApOnIubmV4dCkmJiEobz1vLmNhbGwocixpWzFdKSkuZG9uZSlyZXR1cm4gbztzd2l0Y2gocj0wLG8mJihpPVsyJmlbMF0sby52YWx1ZV0pLGlbMF0pe2Nhc2UgMDpjYXNlIDE6bz1pO2JyZWFrO2Nhc2UgNDpyZXR1cm4gdS5sYWJlbCsrLHt2YWx1ZTppWzFdLGRvbmU6ITF9O2Nhc2UgNTp1LmxhYmVsKysscj1pWzFdLGk9WzBdO2NvbnRpbnVlO2Nhc2UgNzppPXUub3BzLnBvcCgpLHUudHJ5cy5wb3AoKTtjb250aW51ZTtkZWZhdWx0OmlmKCEobz11LnRyeXMsKG89by5sZW5ndGg+MCYmb1tvLmxlbmd0aC0xXSl8fDYhPT1pWzBdJiYyIT09aVswXSkpe3U9MDtjb250aW51ZX1pZigzPT09aVswXSYmKCFvfHxpWzFdPm9bMF0mJmlbMV08b1szXSkpe3UubGFiZWw9aVsxXTticmVha31pZig2PT09aVswXSYmdS5sYWJlbDxvWzFdKXt1LmxhYmVsPW9bMV0sbz1pO2JyZWFrfWlmKG8mJnUubGFiZWw8b1syXSl7dS5sYWJlbD1vWzJdLHUub3BzLnB1c2goaSk7YnJlYWt9b1syXSYmdS5vcHMucG9wKCksdS50cnlzLnBvcCgpO2NvbnRpbnVlfWk9ZS5jYWxsKHQsdSk7fWNhdGNoKHQpe2k9WzYsdF0scj0wO31maW5hbGx5e249bz0wO31pZig1JmlbMF0pdGhyb3cgaVsxXTtyZXR1cm4ge3ZhbHVlOmlbMF0/aVsxXTp2b2lkIDAsZG9uZTohMH19KFtpLGFdKX19fWZ1bmN0aW9uIHModCl7dmFyIGU9ImZ1bmN0aW9uIj09dHlwZW9mIFN5bWJvbCYmU3ltYm9sLml0ZXJhdG9yLG49ZSYmdFtlXSxyPTA7aWYobilyZXR1cm4gbi5jYWxsKHQpO2lmKHQmJiJudW1iZXIiPT10eXBlb2YgdC5sZW5ndGgpcmV0dXJuIHtuZXh0OmZ1bmN0aW9uKCl7cmV0dXJuIHQmJnI+PXQubGVuZ3RoJiYodD12b2lkIDApLHt2YWx1ZTp0JiZ0W3IrK10sZG9uZTohdH19fTt0aHJvdyBuZXcgVHlwZUVycm9yKGU/Ik9iamVjdCBpcyBub3QgaXRlcmFibGUuIjoiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLiIpfWZ1bmN0aW9uIGwodCxlKXt2YXIgbj0iZnVuY3Rpb24iPT10eXBlb2YgU3ltYm9sJiZ0W1N5bWJvbC5pdGVyYXRvcl07aWYoIW4pcmV0dXJuIHQ7dmFyIHIsbyxpPW4uY2FsbCh0KSx1PVtdO3RyeXtmb3IoOyh2b2lkIDA9PT1lfHxlLS0gPjApJiYhKHI9aS5uZXh0KCkpLmRvbmU7KXUucHVzaChyLnZhbHVlKTt9Y2F0Y2godCl7bz17ZXJyb3I6dH07fWZpbmFsbHl7dHJ5e3ImJiFyLmRvbmUmJihuPWkucmV0dXJuKSYmbi5jYWxsKGkpO31maW5hbGx5e2lmKG8pdGhyb3cgby5lcnJvcn19cmV0dXJuIHV9ZnVuY3Rpb24gZCh0KXtpZighU3ltYm9sLmFzeW5jSXRlcmF0b3IpdGhyb3cgbmV3IFR5cGVFcnJvcigiU3ltYm9sLmFzeW5jSXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7dmFyIGUsbj10W1N5bWJvbC5hc3luY0l0ZXJhdG9yXTtyZXR1cm4gbj9uLmNhbGwodCk6KHQ9cyh0KSxlPXt9LHIoIm5leHQiKSxyKCJ0aHJvdyIpLHIoInJldHVybiIpLGVbU3ltYm9sLmFzeW5jSXRlcmF0b3JdPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9LGUpO2Z1bmN0aW9uIHIobil7ZVtuXT10W25dJiZmdW5jdGlvbihlKXtyZXR1cm4gbmV3IFByb21pc2UoKGZ1bmN0aW9uKHIsbyl7KGZ1bmN0aW9uKHQsZSxuLHIpe1Byb21pc2UucmVzb2x2ZShyKS50aGVuKChmdW5jdGlvbihlKXt0KHt2YWx1ZTplLGRvbmU6bn0pO30pLGUpO30pKHIsbywoZT10W25dKGUpKS5kb25lLGUudmFsdWUpO30pKX07fX12YXIgcD0idW5kZWZpbmVkIiE9dHlwZW9mIGdsb2JhbFRoaXM/Z2xvYmFsVGhpczoidW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdz93aW5kb3c6InVuZGVmaW5lZCIhPXR5cGVvZiBjb21tb25qc0dsb2JhbD9jb21tb25qc0dsb2JhbDoidW5kZWZpbmVkIiE9dHlwZW9mIHNlbGY/c2VsZjp7fTtmdW5jdGlvbiB2KHQpe3ZhciBlPXtleHBvcnRzOnt9fTtyZXR1cm4gdChlLGUuZXhwb3J0cyksZS5leHBvcnRzfXZhciBoLHksZz1mdW5jdGlvbih0KXtyZXR1cm4gdCYmdC5NYXRoPT1NYXRoJiZ0fSxtPWcoIm9iamVjdCI9PXR5cGVvZiBnbG9iYWxUaGlzJiZnbG9iYWxUaGlzKXx8Zygib2JqZWN0Ij09dHlwZW9mIHdpbmRvdyYmd2luZG93KXx8Zygib2JqZWN0Ij09dHlwZW9mIHNlbGYmJnNlbGYpfHxnKCJvYmplY3QiPT10eXBlb2YgcCYmcCl8fGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9KCl8fEZ1bmN0aW9uKCJyZXR1cm4gdGhpcyIpKCksYj1mdW5jdGlvbih0KXt0cnl7cmV0dXJuICEhdCgpfWNhdGNoKHQpe3JldHVybiAhMH19LHc9IWIoKGZ1bmN0aW9uKCl7cmV0dXJuIDchPU9iamVjdC5kZWZpbmVQcm9wZXJ0eSh7fSwxLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gN319KVsxXX0pKSxTPUZ1bmN0aW9uLnByb3RvdHlwZS5jYWxsLHg9Uy5iaW5kP1MuYmluZChTKTpmdW5jdGlvbigpe3JldHVybiBTLmFwcGx5KFMsYXJndW1lbnRzKX0sRT17fS5wcm9wZXJ0eUlzRW51bWVyYWJsZSxPPU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Isaj17ZjpPJiYhRS5jYWxsKHsxOjJ9LDEpP2Z1bmN0aW9uKHQpe3ZhciBlPU8odGhpcyx0KTtyZXR1cm4gISFlJiZlLmVudW1lcmFibGV9OkV9LEk9ZnVuY3Rpb24odCxlKXtyZXR1cm4ge2VudW1lcmFibGU6ISgxJnQpLGNvbmZpZ3VyYWJsZTohKDImdCksd3JpdGFibGU6ISg0JnQpLHZhbHVlOmV9fSxQPUZ1bmN0aW9uLnByb3RvdHlwZSxUPVAuYmluZCxNPVAuY2FsbCxBPVQmJlQuYmluZChNKSxSPVQ/ZnVuY3Rpb24odCl7cmV0dXJuIHQmJkEoTSx0KX06ZnVuY3Rpb24odCl7cmV0dXJuIHQmJmZ1bmN0aW9uKCl7cmV0dXJuIE0uYXBwbHkodCxhcmd1bWVudHMpfX0saz1SKHt9LnRvU3RyaW5nKSxDPVIoIiIuc2xpY2UpLE49ZnVuY3Rpb24odCl7cmV0dXJuIEMoayh0KSw4LC0xKX0sTD1tLk9iamVjdCxWPVIoIiIuc3BsaXQpLEQ9YigoZnVuY3Rpb24oKXtyZXR1cm4gIUwoInoiKS5wcm9wZXJ0eUlzRW51bWVyYWJsZSgwKX0pKT9mdW5jdGlvbih0KXtyZXR1cm4gIlN0cmluZyI9PU4odCk/Vih0LCIiKTpMKHQpfTpMLHo9bS5UeXBlRXJyb3IsRj1mdW5jdGlvbih0KXtpZihudWxsPT10KXRocm93IHooIkNhbid0IGNhbGwgbWV0aG9kIG9uICIrdCk7cmV0dXJuIHR9LF89ZnVuY3Rpb24odCl7cmV0dXJuIEQoRih0KSl9LCQ9ZnVuY3Rpb24odCl7cmV0dXJuICJmdW5jdGlvbiI9PXR5cGVvZiB0fSxIPWZ1bmN0aW9uKHQpe3JldHVybiAib2JqZWN0Ij09dHlwZW9mIHQ/bnVsbCE9PXQ6JCh0KX0sQj1mdW5jdGlvbih0KXtyZXR1cm4gJCh0KT90OnZvaWQgMH0sRz1mdW5jdGlvbih0LGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPDI/QihtW3RdKTptW3RdJiZtW3RdW2VdfSxXPVIoe30uaXNQcm90b3R5cGVPZiksVT1HKCJuYXZpZ2F0b3IiLCJ1c2VyQWdlbnQiKXx8IiIscT1tLnByb2Nlc3MsSz1tLkRlbm8sWD1xJiZxLnZlcnNpb25zfHxLJiZLLnZlcnNpb24sWT1YJiZYLnY4O1kmJih5PShoPVkuc3BsaXQoIi4iKSlbMF0+MCYmaFswXTw0PzE6KyhoWzBdK2hbMV0pKSwheSYmVSYmKCEoaD1VLm1hdGNoKC9FZGdlXC8oXGQrKS8pKXx8aFsxXT49NzQpJiYoaD1VLm1hdGNoKC9DaHJvbWVcLyhcZCspLykpJiYoeT0raFsxXSk7dmFyIEo9eSxRPSEhT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyYmIWIoKGZ1bmN0aW9uKCl7dmFyIHQ9U3ltYm9sKCk7cmV0dXJuICFTdHJpbmcodCl8fCEoT2JqZWN0KHQpaW5zdGFuY2VvZiBTeW1ib2wpfHwhU3ltYm9sLnNoYW0mJkomJko8NDF9KSksWj1RJiYhU3ltYm9sLnNoYW0mJiJzeW1ib2wiPT10eXBlb2YgU3ltYm9sLml0ZXJhdG9yLHR0PW0uT2JqZWN0LGV0PVo/ZnVuY3Rpb24odCl7cmV0dXJuICJzeW1ib2wiPT10eXBlb2YgdH06ZnVuY3Rpb24odCl7dmFyIGU9RygiU3ltYm9sIik7cmV0dXJuICQoZSkmJlcoZS5wcm90b3R5cGUsdHQodCkpfSxudD1tLlN0cmluZyxydD1mdW5jdGlvbih0KXt0cnl7cmV0dXJuIG50KHQpfWNhdGNoKHQpe3JldHVybiAiT2JqZWN0In19LG90PW0uVHlwZUVycm9yLGl0PWZ1bmN0aW9uKHQpe2lmKCQodCkpcmV0dXJuIHQ7dGhyb3cgb3QocnQodCkrIiBpcyBub3QgYSBmdW5jdGlvbiIpfSx1dD1mdW5jdGlvbih0LGUpe3ZhciBuPXRbZV07cmV0dXJuIG51bGw9PW4/dm9pZCAwOml0KG4pfSxhdD1tLlR5cGVFcnJvcixjdD1PYmplY3QuZGVmaW5lUHJvcGVydHksZnQ9ZnVuY3Rpb24odCxlKXt0cnl7Y3QobSx0LHt2YWx1ZTplLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMH0pO31jYXRjaChuKXttW3RdPWU7fXJldHVybiBlfSxzdD0iX19jb3JlLWpzX3NoYXJlZF9fIixsdD1tW3N0XXx8ZnQoc3Qse30pLGR0PXYoKGZ1bmN0aW9uKHQpeyh0LmV4cG9ydHM9ZnVuY3Rpb24odCxlKXtyZXR1cm4gbHRbdF18fChsdFt0XT12b2lkIDAhPT1lP2U6e30pfSkoInZlcnNpb25zIixbXSkucHVzaCh7dmVyc2lvbjoiMy4xOS4zIixtb2RlOiJnbG9iYWwiLGNvcHlyaWdodDoiwqkgMjAyMSBEZW5pcyBQdXNoa2FyZXYgKHpsb2lyb2NrLnJ1KSJ9KTt9KSkscHQ9bS5PYmplY3QsdnQ9ZnVuY3Rpb24odCl7cmV0dXJuIHB0KEYodCkpfSxodD1SKHt9Lmhhc093blByb3BlcnR5KSx5dD1PYmplY3QuaGFzT3dufHxmdW5jdGlvbih0LGUpe3JldHVybiBodCh2dCh0KSxlKX0sZ3Q9MCxtdD1NYXRoLnJhbmRvbSgpLGJ0PVIoMS4udG9TdHJpbmcpLHd0PWZ1bmN0aW9uKHQpe3JldHVybiAiU3ltYm9sKCIrKHZvaWQgMD09PXQ/IiI6dCkrIilfIitidCgrK2d0K210LDM2KX0sU3Q9ZHQoIndrcyIpLHh0PW0uU3ltYm9sLEV0PXh0JiZ4dC5mb3IsT3Q9Wj94dDp4dCYmeHQud2l0aG91dFNldHRlcnx8d3QsanQ9ZnVuY3Rpb24odCl7aWYoIXl0KFN0LHQpfHwhUSYmInN0cmluZyIhPXR5cGVvZiBTdFt0XSl7dmFyIGU9IlN5bWJvbC4iK3Q7USYmeXQoeHQsdCk/U3RbdF09eHRbdF06U3RbdF09WiYmRXQ/RXQoZSk6T3QoZSk7fXJldHVybiBTdFt0XX0sSXQ9bS5UeXBlRXJyb3IsUHQ9anQoInRvUHJpbWl0aXZlIiksVHQ9ZnVuY3Rpb24odCxlKXtpZighSCh0KXx8ZXQodCkpcmV0dXJuIHQ7dmFyIG4scj11dCh0LFB0KTtpZihyKXtpZih2b2lkIDA9PT1lJiYoZT0iZGVmYXVsdCIpLG49eChyLHQsZSksIUgobil8fGV0KG4pKXJldHVybiBuO3Rocm93IEl0KCJDYW4ndCBjb252ZXJ0IG9iamVjdCB0byBwcmltaXRpdmUgdmFsdWUiKX1yZXR1cm4gdm9pZCAwPT09ZSYmKGU9Im51bWJlciIpLGZ1bmN0aW9uKHQsZSl7dmFyIG4scjtpZigic3RyaW5nIj09PWUmJiQobj10LnRvU3RyaW5nKSYmIUgocj14KG4sdCkpKXJldHVybiByO2lmKCQobj10LnZhbHVlT2YpJiYhSChyPXgobix0KSkpcmV0dXJuIHI7aWYoInN0cmluZyIhPT1lJiYkKG49dC50b1N0cmluZykmJiFIKHI9eChuLHQpKSlyZXR1cm4gcjt0aHJvdyBhdCgiQ2FuJ3QgY29udmVydCBvYmplY3QgdG8gcHJpbWl0aXZlIHZhbHVlIil9KHQsZSl9LE10PWZ1bmN0aW9uKHQpe3ZhciBlPVR0KHQsInN0cmluZyIpO3JldHVybiBldChlKT9lOmUrIiJ9LEF0PW0uZG9jdW1lbnQsUnQ9SChBdCkmJkgoQXQuY3JlYXRlRWxlbWVudCksa3Q9ZnVuY3Rpb24odCl7cmV0dXJuIFJ0P0F0LmNyZWF0ZUVsZW1lbnQodCk6e319LEN0PSF3JiYhYigoZnVuY3Rpb24oKXtyZXR1cm4gNyE9T2JqZWN0LmRlZmluZVByb3BlcnR5KGt0KCJkaXYiKSwiYSIse2dldDpmdW5jdGlvbigpe3JldHVybiA3fX0pLmF9KSksTnQ9T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcixMdD17Zjp3P050OmZ1bmN0aW9uKHQsZSl7aWYodD1fKHQpLGU9TXQoZSksQ3QpdHJ5e3JldHVybiBOdCh0LGUpfWNhdGNoKHQpe31pZih5dCh0LGUpKXJldHVybiBJKCF4KGouZix0LGUpLHRbZV0pfX0sVnQ9bS5TdHJpbmcsRHQ9bS5UeXBlRXJyb3IsenQ9ZnVuY3Rpb24odCl7aWYoSCh0KSlyZXR1cm4gdDt0aHJvdyBEdChWdCh0KSsiIGlzIG5vdCBhbiBvYmplY3QiKX0sRnQ9bS5UeXBlRXJyb3IsX3Q9T2JqZWN0LmRlZmluZVByb3BlcnR5LCR0PXtmOnc/X3Q6ZnVuY3Rpb24odCxlLG4pe2lmKHp0KHQpLGU9TXQoZSksenQobiksQ3QpdHJ5e3JldHVybiBfdCh0LGUsbil9Y2F0Y2godCl7fWlmKCJnZXQiaW4gbnx8InNldCJpbiBuKXRocm93IEZ0KCJBY2Nlc3NvcnMgbm90IHN1cHBvcnRlZCIpO3JldHVybiAidmFsdWUiaW4gbiYmKHRbZV09bi52YWx1ZSksdH19LEh0PXc/ZnVuY3Rpb24odCxlLG4pe3JldHVybiAkdC5mKHQsZSxJKDEsbikpfTpmdW5jdGlvbih0LGUsbil7cmV0dXJuIHRbZV09bix0fSxCdD1SKEZ1bmN0aW9uLnRvU3RyaW5nKTskKGx0Lmluc3BlY3RTb3VyY2UpfHwobHQuaW5zcGVjdFNvdXJjZT1mdW5jdGlvbih0KXtyZXR1cm4gQnQodCl9KTt2YXIgR3QsV3QsVXQscXQ9bHQuaW5zcGVjdFNvdXJjZSxLdD1tLldlYWtNYXAsWHQ9JChLdCkmJi9uYXRpdmUgY29kZS8udGVzdChxdChLdCkpLFl0PWR0KCJrZXlzIiksSnQ9ZnVuY3Rpb24odCl7cmV0dXJuIFl0W3RdfHwoWXRbdF09d3QodCkpfSxRdD17fSxadD0iT2JqZWN0IGFscmVhZHkgaW5pdGlhbGl6ZWQiLHRlPW0uVHlwZUVycm9yLGVlPW0uV2Vha01hcDtpZihYdHx8bHQuc3RhdGUpe3ZhciBuZT1sdC5zdGF0ZXx8KGx0LnN0YXRlPW5ldyBlZSkscmU9UihuZS5nZXQpLG9lPVIobmUuaGFzKSxpZT1SKG5lLnNldCk7R3Q9ZnVuY3Rpb24odCxlKXtpZihvZShuZSx0KSl0aHJvdyBuZXcgdGUoWnQpO3JldHVybiBlLmZhY2FkZT10LGllKG5lLHQsZSksZX0sV3Q9ZnVuY3Rpb24odCl7cmV0dXJuIHJlKG5lLHQpfHx7fX0sVXQ9ZnVuY3Rpb24odCl7cmV0dXJuIG9lKG5lLHQpfTt9ZWxzZSB7dmFyIHVlPUp0KCJzdGF0ZSIpO1F0W3VlXT0hMCxHdD1mdW5jdGlvbih0LGUpe2lmKHl0KHQsdWUpKXRocm93IG5ldyB0ZShadCk7cmV0dXJuIGUuZmFjYWRlPXQsSHQodCx1ZSxlKSxlfSxXdD1mdW5jdGlvbih0KXtyZXR1cm4geXQodCx1ZSk/dFt1ZV06e319LFV0PWZ1bmN0aW9uKHQpe3JldHVybiB5dCh0LHVlKX07fXZhciBhZT17c2V0Okd0LGdldDpXdCxoYXM6VXQsZW5mb3JjZTpmdW5jdGlvbih0KXtyZXR1cm4gVXQodCk/V3QodCk6R3QodCx7fSl9LGdldHRlckZvcjpmdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSl7dmFyIG47aWYoIUgoZSl8fChuPVd0KGUpKS50eXBlIT09dCl0aHJvdyB0ZSgiSW5jb21wYXRpYmxlIHJlY2VpdmVyLCAiK3QrIiByZXF1aXJlZCIpO3JldHVybiBufX19LGNlPUZ1bmN0aW9uLnByb3RvdHlwZSxmZT13JiZPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLHNlPXl0KGNlLCJuYW1lIiksbGU9e0VYSVNUUzpzZSxQUk9QRVI6c2UmJiJzb21ldGhpbmciPT09ZnVuY3Rpb24oKXt9Lm5hbWUsQ09ORklHVVJBQkxFOnNlJiYoIXd8fHcmJmZlKGNlLCJuYW1lIikuY29uZmlndXJhYmxlKX0sZGU9digoZnVuY3Rpb24odCl7dmFyIGU9bGUuQ09ORklHVVJBQkxFLG49YWUuZ2V0LHI9YWUuZW5mb3JjZSxvPVN0cmluZyhTdHJpbmcpLnNwbGl0KCJTdHJpbmciKTsodC5leHBvcnRzPWZ1bmN0aW9uKHQsbixpLHUpe3ZhciBhLGM9ISF1JiYhIXUudW5zYWZlLGY9ISF1JiYhIXUuZW51bWVyYWJsZSxzPSEhdSYmISF1Lm5vVGFyZ2V0R2V0LGw9dSYmdm9pZCAwIT09dS5uYW1lP3UubmFtZTpuOyQoaSkmJigiU3ltYm9sKCI9PT1TdHJpbmcobCkuc2xpY2UoMCw3KSYmKGw9IlsiK1N0cmluZyhsKS5yZXBsYWNlKC9eU3ltYm9sXCgoW14pXSopXCkvLCIkMSIpKyJdIiksKCF5dChpLCJuYW1lIil8fGUmJmkubmFtZSE9PWwpJiZIdChpLCJuYW1lIixsKSwoYT1yKGkpKS5zb3VyY2V8fChhLnNvdXJjZT1vLmpvaW4oInN0cmluZyI9PXR5cGVvZiBsP2w6IiIpKSksdCE9PW0/KGM/IXMmJnRbbl0mJihmPSEwKTpkZWxldGUgdFtuXSxmP3Rbbl09aTpIdCh0LG4saSkpOmY/dFtuXT1pOmZ0KG4saSk7fSkoRnVuY3Rpb24ucHJvdG90eXBlLCJ0b1N0cmluZyIsKGZ1bmN0aW9uKCl7cmV0dXJuICQodGhpcykmJm4odGhpcykuc291cmNlfHxxdCh0aGlzKX0pKTt9KSkscGU9TWF0aC5jZWlsLHZlPU1hdGguZmxvb3IsaGU9ZnVuY3Rpb24odCl7dmFyIGU9K3Q7cmV0dXJuIGUhPWV8fDA9PT1lPzA6KGU+MD92ZTpwZSkoZSl9LHllPU1hdGgubWF4LGdlPU1hdGgubWluLG1lPWZ1bmN0aW9uKHQsZSl7dmFyIG49aGUodCk7cmV0dXJuIG48MD95ZShuK2UsMCk6Z2UobixlKX0sYmU9TWF0aC5taW4sd2U9ZnVuY3Rpb24odCl7cmV0dXJuIHQ+MD9iZShoZSh0KSw5MDA3MTk5MjU0NzQwOTkxKTowfSxTZT1mdW5jdGlvbih0KXtyZXR1cm4gd2UodC5sZW5ndGgpfSx4ZT1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSxuLHIpe3ZhciBvLGk9XyhlKSx1PVNlKGkpLGE9bWUocix1KTtpZih0JiZuIT1uKXtmb3IoO3U+YTspaWYoKG89aVthKytdKSE9bylyZXR1cm4gITB9ZWxzZSBmb3IoO3U+YTthKyspaWYoKHR8fGEgaW4gaSkmJmlbYV09PT1uKXJldHVybiB0fHxhfHwwO3JldHVybiAhdCYmLTF9fSxFZT17aW5jbHVkZXM6eGUoITApLGluZGV4T2Y6eGUoITEpfSxPZT1FZS5pbmRleE9mLGplPVIoW10ucHVzaCksSWU9ZnVuY3Rpb24odCxlKXt2YXIgbixyPV8odCksbz0wLGk9W107Zm9yKG4gaW4gcikheXQoUXQsbikmJnl0KHIsbikmJmplKGksbik7Zm9yKDtlLmxlbmd0aD5vOyl5dChyLG49ZVtvKytdKSYmKH5PZShpLG4pfHxqZShpLG4pKTtyZXR1cm4gaX0sUGU9WyJjb25zdHJ1Y3RvciIsImhhc093blByb3BlcnR5IiwiaXNQcm90b3R5cGVPZiIsInByb3BlcnR5SXNFbnVtZXJhYmxlIiwidG9Mb2NhbGVTdHJpbmciLCJ0b1N0cmluZyIsInZhbHVlT2YiXSxUZT1QZS5jb25jYXQoImxlbmd0aCIsInByb3RvdHlwZSIpLE1lPXtmOk9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzfHxmdW5jdGlvbih0KXtyZXR1cm4gSWUodCxUZSl9fSxBZT17ZjpPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzfSxSZT1SKFtdLmNvbmNhdCksa2U9RygiUmVmbGVjdCIsIm93bktleXMiKXx8ZnVuY3Rpb24odCl7dmFyIGU9TWUuZih6dCh0KSksbj1BZS5mO3JldHVybiBuP1JlKGUsbih0KSk6ZX0sQ2U9ZnVuY3Rpb24odCxlKXtmb3IodmFyIG49a2UoZSkscj0kdC5mLG89THQuZixpPTA7aTxuLmxlbmd0aDtpKyspe3ZhciB1PW5baV07eXQodCx1KXx8cih0LHUsbyhlLHUpKTt9fSxOZT0vI3xcLnByb3RvdHlwZVwuLyxMZT1mdW5jdGlvbih0LGUpe3ZhciBuPURlW1ZlKHQpXTtyZXR1cm4gbj09RmV8fG4hPXplJiYoJChlKT9iKGUpOiEhZSl9LFZlPUxlLm5vcm1hbGl6ZT1mdW5jdGlvbih0KXtyZXR1cm4gU3RyaW5nKHQpLnJlcGxhY2UoTmUsIi4iKS50b0xvd2VyQ2FzZSgpfSxEZT1MZS5kYXRhPXt9LHplPUxlLk5BVElWRT0iTiIsRmU9TGUuUE9MWUZJTEw9IlAiLF9lPUxlLCRlPUx0LmYsSGU9ZnVuY3Rpb24odCxlKXt2YXIgbixyLG8saSx1LGE9dC50YXJnZXQsYz10Lmdsb2JhbCxmPXQuc3RhdDtpZihuPWM/bTpmP21bYV18fGZ0KGEse30pOihtW2FdfHx7fSkucHJvdG90eXBlKWZvcihyIGluIGUpe2lmKGk9ZVtyXSxvPXQubm9UYXJnZXRHZXQ/KHU9JGUobixyKSkmJnUudmFsdWU6bltyXSwhX2UoYz9yOmErKGY/Ii4iOiIjIikrcix0LmZvcmNlZCkmJnZvaWQgMCE9PW8pe2lmKHR5cGVvZiBpPT10eXBlb2Ygbyljb250aW51ZTtDZShpLG8pO30odC5zaGFtfHxvJiZvLnNoYW0pJiZIdChpLCJzaGFtIiwhMCksZGUobixyLGksdCk7fX0sQmU9e307QmVbanQoInRvU3RyaW5nVGFnIildPSJ6Ijt2YXIgR2UsV2U9IltvYmplY3Qgel0iPT09U3RyaW5nKEJlKSxVZT1qdCgidG9TdHJpbmdUYWciKSxxZT1tLk9iamVjdCxLZT0iQXJndW1lbnRzIj09TihmdW5jdGlvbigpe3JldHVybiBhcmd1bWVudHN9KCkpLFhlPVdlP046ZnVuY3Rpb24odCl7dmFyIGUsbixyO3JldHVybiB2b2lkIDA9PT10PyJVbmRlZmluZWQiOm51bGw9PT10PyJOdWxsIjoic3RyaW5nIj09dHlwZW9mKG49ZnVuY3Rpb24odCxlKXt0cnl7cmV0dXJuIHRbZV19Y2F0Y2godCl7fX0oZT1xZSh0KSxVZSkpP246S2U/TihlKToiT2JqZWN0Ij09KHI9TihlKSkmJiQoZS5jYWxsZWUpPyJBcmd1bWVudHMiOnJ9LFllPW0uU3RyaW5nLEplPWZ1bmN0aW9uKHQpe2lmKCJTeW1ib2wiPT09WGUodCkpdGhyb3cgVHlwZUVycm9yKCJDYW5ub3QgY29udmVydCBhIFN5bWJvbCB2YWx1ZSB0byBhIHN0cmluZyIpO3JldHVybiBZZSh0KX0sUWU9Ilx0XG5cdlxmXHIgwqDhmoDigIDigIHigILigIPigITigIXigIbigIfigIjigInigIrigK/igZ/jgIBcdTIwMjhcdTIwMjlcdWZlZmYiLFplPVIoIiIucmVwbGFjZSksdG49IlsiK1FlKyJdIixlbj1SZWdFeHAoIl4iK3RuK3RuKyIqIiksbm49UmVnRXhwKHRuK3RuKyIqJCIpLHJuPWZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihlKXt2YXIgbj1KZShGKGUpKTtyZXR1cm4gMSZ0JiYobj1aZShuLGVuLCIiKSksMiZ0JiYobj1aZShuLG5uLCIiKSksbn19LG9uPXtzdGFydDpybigxKSxlbmQ6cm4oMiksdHJpbTpybigzKX0sdW49bGUuUFJPUEVSLGFuPW9uLnRyaW07ZnVuY3Rpb24gY24odCl7cmV0dXJuIHQubGVuZ3RoP3RbMF0udGFnTmFtZS50b0xvd2VyQ2FzZSgpOiIifWZ1bmN0aW9uIGZuKHQsZSxuKXt2b2lkIDA9PT1lJiYoZT0iYXV0byIpLHZvaWQgMD09PW4mJihuPSJhdXRvIik7dmFyIHI9dS5kZWZhdWx0KHQpO3JldHVybiByLmF0dHIoIndpZHRoIixlKSxyLmF0dHIoImhlaWdodCIsbiksclswXS5vdXRlckhUTUx9SGUoe3RhcmdldDoiU3RyaW5nIixwcm90bzohMCxmb3JjZWQ6KEdlPSJ0cmltIixiKChmdW5jdGlvbigpe3JldHVybiAhIVFlW0dlXSgpfHwi4oCLwoXhoI4iIT09IuKAi8KF4aCOIltHZV0oKXx8dW4mJlFlW0dlXS5uYW1lIT09R2V9KSkpfSx7dHJpbTpmdW5jdGlvbigpe3JldHVybiBhbih0aGlzKX19KSxIZSh7Z2xvYmFsOiEwfSx7Z2xvYmFsVGhpczptfSksci5hcHBlbmQmJih1LmRlZmF1bHQuZm4uYXBwZW5kPXIuYXBwZW5kKSxyLm9uJiYodS5kZWZhdWx0LmZuLm9uPXIub24pLHIuZm9jdXMmJih1LmRlZmF1bHQuZm4uZm9jdXM9ci5mb2N1cyksci5hdHRyJiYodS5kZWZhdWx0LmZuLmF0dHI9ci5hdHRyKSxyLnZhbCYmKHUuZGVmYXVsdC5mbi52YWw9ci52YWwpLHIuaHRtbCYmKHUuZGVmYXVsdC5mbi5odG1sPXIuaHRtbCksci5wYXJlbnQmJih1LmRlZmF1bHQuZm4ucGFyZW50PXIucGFyZW50KSxyLmhhc0NsYXNzJiYodS5kZWZhdWx0LmZuLmhhc0NsYXNzPXIuaGFzQ2xhc3MpLHIuZW1wdHkmJih1LmRlZmF1bHQuZm4uZW1wdHk9ci5lbXB0eSk7dmFyIHNuPXt0eXBlOiJ2aWRlbyIscmVuZGVyRWxlbTpmdW5jdGlvbihlLHIsbyl7dmFyIGksdT1lLGE9dS5zcmMsYz12b2lkIDA9PT1hPyIiOmEsZj11LnBvc3RlcixzPXZvaWQgMD09PWY/IiI6ZixsPXUud2lkdGgsZD12b2lkIDA9PT1sPyJhdXRvIjpsLHA9dS5oZWlnaHQsdj12b2lkIDA9PT1wPyJhdXRvIjpwLGg9dC5Eb21FZGl0b3IuaXNOb2RlU2VsZWN0ZWQobyxlKTtpZigwPT09Yy50cmltKCkuaW5kZXhPZigiPGlmcmFtZSAiKSl7dmFyIHk9Zm4oYyxkLHYpO2k9bi5qc3goImRpdiIse2NsYXNzTmFtZToidy1lLXRleHRhcmVhLXZpZGVvLWNvbnRhaW5lciIsImRhdGEtc2VsZWN0ZWQiOmg/InRydWUiOiIiLGlubmVySFRNTDp5fSk7fWVsc2Uge3ZhciBnPW4uanN4KCJ2aWRlbyIse3Bvc3RlcjpzLGNvbnRyb2xzOiEwfSxuLmpzeCgic291cmNlIix7c3JjOmMsdHlwZToidmlkZW8vbXA0In0pLCJTb3JyeSwgeW91ciBicm93c2VyIGRvZXNuJ3Qgc3VwcG9ydCBlbWJlZGRlZCB2aWRlb3MuXG4g5oqx5q2J77yM5rWP6KeI5Zmo5LiN5pSv5oyBIHZpZGVvIOinhumikSIpOyJhdXRvIiE9PWQmJihnLmRhdGEud2lkdGg9ZCksImF1dG8iIT09diYmKGcuZGF0YS5oZWlnaHQ9diksaT1uLmpzeCgiZGl2Iix7Y2xhc3NOYW1lOiJ3LWUtdGV4dGFyZWEtdmlkZW8tY29udGFpbmVyIiwiZGF0YS1zZWxlY3RlZCI6aD8idHJ1ZSI6IiJ9LGcpO31yZXR1cm4gbi5oKCJkaXYiLHtwcm9wczp7Y29udGVudEVkaXRhYmxlOiExfSxvbjp7bW91c2Vkb3duOmZ1bmN0aW9uKHQpe3JldHVybiB0LnByZXZlbnREZWZhdWx0KCl9fX0saSl9fTt2YXIgbG4sZG49e3R5cGU6InZpZGVvIixlbGVtVG9IdG1sOmZ1bmN0aW9uKHQsZSl7dmFyIG49dCxyPW4uc3JjLG89dm9pZCAwPT09cj8iIjpyLGk9bi5wb3N0ZXIsdT12b2lkIDA9PT1pPyIiOmksYT1uLndpZHRoLGM9dm9pZCAwPT09YT8iYXV0byI6YSxmPW4uaGVpZ2h0LHM9dm9pZCAwPT09Zj8iYXV0byI6ZixsPSc8ZGl2IGRhdGEtdy1lLXR5cGU9InZpZGVvIiBkYXRhLXctZS1pcy12b2lkPlxuJztyZXR1cm4gMD09PW8udHJpbSgpLmluZGV4T2YoIjxpZnJhbWUgIik/bCs9Zm4obyxjLHMpOmwrPSc8dmlkZW8gcG9zdGVyPSInK3UrJyIgY29udHJvbHM9InRydWUiIHdpZHRoPSInK2MrJyIgaGVpZ2h0PSInK3MrJyI+PHNvdXJjZSBzcmM9IicrbysnIiB0eXBlPSJ2aWRlby9tcDQiLz48L3ZpZGVvPicsbCs9IlxuPC9kaXY+In19LHBuPU9iamVjdC5rZXlzfHxmdW5jdGlvbih0KXtyZXR1cm4gSWUodCxQZSl9LHZuPXc/T2JqZWN0LmRlZmluZVByb3BlcnRpZXM6ZnVuY3Rpb24odCxlKXt6dCh0KTtmb3IodmFyIG4scj1fKGUpLG89cG4oZSksaT1vLmxlbmd0aCx1PTA7aT51OykkdC5mKHQsbj1vW3UrK10scltuXSk7cmV0dXJuIHR9LGhuPUcoImRvY3VtZW50IiwiZG9jdW1lbnRFbGVtZW50IikseW49SnQoIklFX1BST1RPIiksZ249ZnVuY3Rpb24oKXt9LG1uPWZ1bmN0aW9uKHQpe3JldHVybiAiPHNjcmlwdD4iK3QrIjwvIisic2NyaXB0PiJ9LGJuPWZ1bmN0aW9uKHQpe3Qud3JpdGUobW4oIiIpKSx0LmNsb3NlKCk7dmFyIGU9dC5wYXJlbnRXaW5kb3cuT2JqZWN0O3JldHVybiB0PW51bGwsZX0sd249ZnVuY3Rpb24oKXt0cnl7bG49bmV3IEFjdGl2ZVhPYmplY3QoImh0bWxmaWxlIik7fWNhdGNoKHQpe312YXIgdCxlO3duPSJ1bmRlZmluZWQiIT10eXBlb2YgZG9jdW1lbnQ/ZG9jdW1lbnQuZG9tYWluJiZsbj9ibihsbik6KChlPWt0KCJpZnJhbWUiKSkuc3R5bGUuZGlzcGxheT0ibm9uZSIsaG4uYXBwZW5kQ2hpbGQoZSksZS5zcmM9U3RyaW5nKCJqYXZhc2NyaXB0OiIpLCh0PWUuY29udGVudFdpbmRvdy5kb2N1bWVudCkub3BlbigpLHQud3JpdGUobW4oImRvY3VtZW50LkY9T2JqZWN0IikpLHQuY2xvc2UoKSx0LkYpOmJuKGxuKTtmb3IodmFyIG49UGUubGVuZ3RoO24tLTspZGVsZXRlIHduLnByb3RvdHlwZVtQZVtuXV07cmV0dXJuIHduKCl9O1F0W3luXT0hMDt2YXIgU249T2JqZWN0LmNyZWF0ZXx8ZnVuY3Rpb24odCxlKXt2YXIgbjtyZXR1cm4gbnVsbCE9PXQ/KGduLnByb3RvdHlwZT16dCh0KSxuPW5ldyBnbixnbi5wcm90b3R5cGU9bnVsbCxuW3luXT10KTpuPXduKCksdm9pZCAwPT09ZT9uOnZuKG4sZSl9LHhuPWp0KCJ1bnNjb3BhYmxlcyIpLEVuPUFycmF5LnByb3RvdHlwZTtudWxsPT1Fblt4bl0mJiR0LmYoRW4seG4se2NvbmZpZ3VyYWJsZTohMCx2YWx1ZTpTbihudWxsKX0pO3ZhciBPbj1mdW5jdGlvbih0KXtFblt4bl1bdF09ITA7fSxqbj1FZS5pbmNsdWRlcztIZSh7dGFyZ2V0OiJBcnJheSIscHJvdG86ITB9LHtpbmNsdWRlczpmdW5jdGlvbih0KXtyZXR1cm4gam4odGhpcyx0LGFyZ3VtZW50cy5sZW5ndGg+MT9hcmd1bWVudHNbMV06dm9pZCAwKX19KSxPbigiaW5jbHVkZXMiKTt2YXIgSW49e3NlbGVjdG9yOiJpZnJhbWUsdmlkZW8scCIscHJlUGFyc2VIdG1sOmZ1bmN0aW9uKHQpe3ZhciBlPXUuZGVmYXVsdCh0KSxuPWU7aWYoInAiPT09Y24oZSkpe3ZhciByPWUuY2hpbGRyZW4oKTtpZigxPT09ci5sZW5ndGgpe3ZhciBvPXJbMF0saT1vLnRhZ05hbWUudG9Mb3dlckNhc2UoKTtbImlmcmFtZSIsInZpZGVvIl0uaW5jbHVkZXMoaSkmJihuPXUuZGVmYXVsdChvKSk7fX12YXIgYT1jbihuKTtpZigiaWZyYW1lIiE9PWEmJiJ2aWRlbyIhPT1hKXJldHVybiBuWzBdO2lmKCJ2aWRlbyI9PT1uLnBhcmVudCgpLmF0dHIoImRhdGEtdy1lLXR5cGUiKSlyZXR1cm4gblswXTt2YXIgYz11LmRlZmF1bHQoJzxkaXYgZGF0YS13LWUtdHlwZT0idmlkZW8iIGRhdGEtdy1lLWlzLXZvaWQ+PC9kaXY+Jyk7cmV0dXJuIGMuYXBwZW5kKG4pLGNbMF19fSxQbj1SKFIuYmluZCksVG49ZnVuY3Rpb24odCxlKXtyZXR1cm4gaXQodCksdm9pZCAwPT09ZT90OlBuP1BuKHQsZSk6ZnVuY3Rpb24oKXtyZXR1cm4gdC5hcHBseShlLGFyZ3VtZW50cyl9fSxNbj1BcnJheS5pc0FycmF5fHxmdW5jdGlvbih0KXtyZXR1cm4gIkFycmF5Ij09Tih0KX0sQW49ZnVuY3Rpb24oKXt9LFJuPVtdLGtuPUcoIlJlZmxlY3QiLCJjb25zdHJ1Y3QiKSxDbj0vXlxzKig/OmNsYXNzfGZ1bmN0aW9uKVxiLyxObj1SKENuLmV4ZWMpLExuPSFDbi5leGVjKEFuKSxWbj1mdW5jdGlvbih0KXtpZighJCh0KSlyZXR1cm4gITE7dHJ5e3JldHVybiBrbihBbixSbix0KSwhMH1jYXRjaCh0KXtyZXR1cm4gITF9fSxEbj0ha258fGIoKGZ1bmN0aW9uKCl7dmFyIHQ7cmV0dXJuIFZuKFZuLmNhbGwpfHwhVm4oT2JqZWN0KXx8IVZuKChmdW5jdGlvbigpe3Q9ITA7fSkpfHx0fSkpP2Z1bmN0aW9uKHQpe2lmKCEkKHQpKXJldHVybiAhMTtzd2l0Y2goWGUodCkpe2Nhc2UiQXN5bmNGdW5jdGlvbiI6Y2FzZSJHZW5lcmF0b3JGdW5jdGlvbiI6Y2FzZSJBc3luY0dlbmVyYXRvckZ1bmN0aW9uIjpyZXR1cm4gITF9cmV0dXJuIExufHwhIU5uKENuLHF0KHQpKX06Vm4sem49anQoInNwZWNpZXMiKSxGbj1tLkFycmF5LF9uPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIG5ldyhmdW5jdGlvbih0KXt2YXIgZTtyZXR1cm4gTW4odCkmJihlPXQuY29uc3RydWN0b3IsKERuKGUpJiYoZT09PUZufHxNbihlLnByb3RvdHlwZSkpfHxIKGUpJiZudWxsPT09KGU9ZVt6bl0pKSYmKGU9dm9pZCAwKSksdm9pZCAwPT09ZT9GbjplfSh0KSkoMD09PWU/MDplKX0sJG49UihbXS5wdXNoKSxIbj1mdW5jdGlvbih0KXt2YXIgZT0xPT10LG49Mj09dCxyPTM9PXQsbz00PT10LGk9Nj09dCx1PTc9PXQsYT01PT10fHxpO3JldHVybiBmdW5jdGlvbihjLGYscyxsKXtmb3IodmFyIGQscCx2PXZ0KGMpLGg9RCh2KSx5PVRuKGYscyksZz1TZShoKSxtPTAsYj1sfHxfbix3PWU/YihjLGcpOm58fHU/YihjLDApOnZvaWQgMDtnPm07bSsrKWlmKChhfHxtIGluIGgpJiYocD15KGQ9aFttXSxtLHYpLHQpKWlmKGUpd1ttXT1wO2Vsc2UgaWYocClzd2l0Y2godCl7Y2FzZSAzOnJldHVybiAhMDtjYXNlIDU6cmV0dXJuIGQ7Y2FzZSA2OnJldHVybiBtO2Nhc2UgMjokbih3LGQpO31lbHNlIHN3aXRjaCh0KXtjYXNlIDQ6cmV0dXJuICExO2Nhc2UgNzokbih3LGQpO31yZXR1cm4gaT8tMTpyfHxvP286d319LEJuPXtmb3JFYWNoOkhuKDApLG1hcDpIbigxKSxmaWx0ZXI6SG4oMiksc29tZTpIbigzKSxldmVyeTpIbig0KSxmaW5kOkhuKDUpLGZpbmRJbmRleDpIbig2KSxmaWx0ZXJSZWplY3Q6SG4oNyl9LEduPUJuLmZpbmQsV249ImZpbmQiLFVuPSEwO1duIGluW10mJkFycmF5KDEpLmZpbmQoKGZ1bmN0aW9uKCl7VW49ITE7fSkpLEhlKHt0YXJnZXQ6IkFycmF5Iixwcm90bzohMCxmb3JjZWQ6VW59LHtmaW5kOmZ1bmN0aW9uKHQpe3JldHVybiBHbih0aGlzLHQsYXJndW1lbnRzLmxlbmd0aD4xP2FyZ3VtZW50c1sxXTp2b2lkIDApfX0pLE9uKFduKTt2YXIgcW49V2U/e30udG9TdHJpbmc6ZnVuY3Rpb24oKXtyZXR1cm4gIltvYmplY3QgIitYZSh0aGlzKSsiXSJ9O2Z1bmN0aW9uIEtuKHQsZSxuLHIpe3JldHVybiB2b2lkIDA9PT1lJiYoZT0iIiksdm9pZCAwPT09biYmKG49ImF1dG8iKSx2b2lkIDA9PT1yJiYocj0iYXV0byIpLHt0eXBlOiJ2aWRlbyIsc3JjOnQscG9zdGVyOmUsd2lkdGg6bixoZWlnaHQ6cixjaGlsZHJlbjpbe3RleHQ6IiJ9XX19V2V8fGRlKE9iamVjdC5wcm90b3R5cGUsInRvU3RyaW5nIixxbix7dW5zYWZlOiEwfSk7dmFyIFhuLFluLEpuPXtzZWxlY3RvcjonZGl2W2RhdGEtdy1lLXR5cGU9InZpZGVvIl0nLHBhcnNlRWxlbUh0bWw6ZnVuY3Rpb24odCxlLG4pe3ZhciByPXUuZGVmYXVsdCh0KSxvPSIiLGk9IiIsYT0iYXV0byIsYz0iYXV0byIsZj1yLmZpbmQoImlmcmFtZSIpO2lmKGYubGVuZ3RoPjApcmV0dXJuIGE9Zi5hdHRyKCJ3aWR0aCIpfHwiYXV0byIsYz1mLmF0dHIoImhlaWdodCIpfHwiYXV0byIsS24obz1mWzBdLm91dGVySFRNTCxpLGEsYyk7dmFyIHM9ci5maW5kKCJ2aWRlbyIpO3JldHVybiAobz1zLmF0dHIoInNyYyIpfHwiIil8fHMubGVuZ3RoPjAmJihvPXMuZmluZCgic291cmNlIikuYXR0cigic3JjIil8fCIiKSxhPXMuYXR0cigid2lkdGgiKXx8ImF1dG8iLGM9cy5hdHRyKCJoZWlnaHQiKXx8ImF1dG8iLEtuKG8saT1zLmF0dHIoInBvc3RlciIpfHwiIixhLGMpfX0sUW49ZnVuY3Rpb24oKXt2YXIgdD16dCh0aGlzKSxlPSIiO3JldHVybiB0Lmdsb2JhbCYmKGUrPSJnIiksdC5pZ25vcmVDYXNlJiYoZSs9ImkiKSx0Lm11bHRpbGluZSYmKGUrPSJtIiksdC5kb3RBbGwmJihlKz0icyIpLHQudW5pY29kZSYmKGUrPSJ1IiksdC5zdGlja3kmJihlKz0ieSIpLGV9LFpuPW0uUmVnRXhwLHRyPWIoKGZ1bmN0aW9uKCl7dmFyIHQ9Wm4oImEiLCJ5Iik7cmV0dXJuIHQubGFzdEluZGV4PTIsbnVsbCE9dC5leGVjKCJhYmNkIil9KSksZXI9dHJ8fGIoKGZ1bmN0aW9uKCl7cmV0dXJuICFabigiYSIsInkiKS5zdGlja3l9KSksbnI9e0JST0tFTl9DQVJFVDp0cnx8YigoZnVuY3Rpb24oKXt2YXIgdD1abigiXnIiLCJneSIpO3JldHVybiB0Lmxhc3RJbmRleD0yLG51bGwhPXQuZXhlYygic3RyIil9KSksTUlTU0VEX1NUSUNLWTplcixVTlNVUFBPUlRFRF9ZOnRyfSxycj1tLlJlZ0V4cCxvcj1iKChmdW5jdGlvbigpe3ZhciB0PXJyKCIuIiwicyIpO3JldHVybiAhKHQuZG90QWxsJiZ0LmV4ZWMoIlxuIikmJiJzIj09PXQuZmxhZ3MpfSkpLGlyPW0uUmVnRXhwLHVyPWIoKGZ1bmN0aW9uKCl7dmFyIHQ9aXIoIig/PGE+YikiLCJnIik7cmV0dXJuICJiIiE9PXQuZXhlYygiYiIpLmdyb3Vwcy5hfHwiYmMiIT09ImIiLnJlcGxhY2UodCwiJDxhPmMiKX0pKSxhcj1hZS5nZXQsY3I9ZHQoIm5hdGl2ZS1zdHJpbmctcmVwbGFjZSIsU3RyaW5nLnByb3RvdHlwZS5yZXBsYWNlKSxmcj1SZWdFeHAucHJvdG90eXBlLmV4ZWMsc3I9ZnIsbHI9UigiIi5jaGFyQXQpLGRyPVIoIiIuaW5kZXhPZikscHI9UigiIi5yZXBsYWNlKSx2cj1SKCIiLnNsaWNlKSxocj0oWW49L2IqL2cseChmcixYbj0vYS8sImEiKSx4KGZyLFluLCJhIiksMCE9PVhuLmxhc3RJbmRleHx8MCE9PVluLmxhc3RJbmRleCkseXI9bnIuQlJPS0VOX0NBUkVULGdyPXZvaWQgMCE9PS8oKT8/Ly5leGVjKCIiKVsxXTsoaHJ8fGdyfHx5cnx8b3J8fHVyKSYmKHNyPWZ1bmN0aW9uKHQpe3ZhciBlLG4scixvLGksdSxhLGM9dGhpcyxmPWFyKGMpLHM9SmUodCksbD1mLnJhdztpZihsKXJldHVybiBsLmxhc3RJbmRleD1jLmxhc3RJbmRleCxlPXgoc3IsbCxzKSxjLmxhc3RJbmRleD1sLmxhc3RJbmRleCxlO3ZhciBkPWYuZ3JvdXBzLHA9eXImJmMuc3RpY2t5LHY9eChRbixjKSxoPWMuc291cmNlLHk9MCxnPXM7aWYocCYmKHY9cHIodiwieSIsIiIpLC0xPT09ZHIodiwiZyIpJiYodis9ImciKSxnPXZyKHMsYy5sYXN0SW5kZXgpLGMubGFzdEluZGV4PjAmJighYy5tdWx0aWxpbmV8fGMubXVsdGlsaW5lJiYiXG4iIT09bHIocyxjLmxhc3RJbmRleC0xKSkmJihoPSIoPzogIitoKyIpIixnPSIgIitnLHkrKyksbj1uZXcgUmVnRXhwKCJeKD86IitoKyIpIix2KSksZ3ImJihuPW5ldyBSZWdFeHAoIl4iK2grIiQoPyFcXHMpIix2KSksaHImJihyPWMubGFzdEluZGV4KSxvPXgoZnIscD9uOmMsZykscD9vPyhvLmlucHV0PXZyKG8uaW5wdXQseSksb1swXT12cihvWzBdLHkpLG8uaW5kZXg9Yy5sYXN0SW5kZXgsYy5sYXN0SW5kZXgrPW9bMF0ubGVuZ3RoKTpjLmxhc3RJbmRleD0wOmhyJiZvJiYoYy5sYXN0SW5kZXg9Yy5nbG9iYWw/by5pbmRleCtvWzBdLmxlbmd0aDpyKSxnciYmbyYmby5sZW5ndGg+MSYmeChjcixvWzBdLG4sKGZ1bmN0aW9uKCl7Zm9yKGk9MTtpPGFyZ3VtZW50cy5sZW5ndGgtMjtpKyspdm9pZCAwPT09YXJndW1lbnRzW2ldJiYob1tpXT12b2lkIDApO30pKSxvJiZkKWZvcihvLmdyb3Vwcz11PVNuKG51bGwpLGk9MDtpPGQubGVuZ3RoO2krKyl1WyhhPWRbaV0pWzBdXT1vW2FbMV1dO3JldHVybiBvfSk7dmFyIG1yPXNyO0hlKHt0YXJnZXQ6IlJlZ0V4cCIscHJvdG86ITAsZm9yY2VkOi8uLy5leGVjIT09bXJ9LHtleGVjOm1yfSk7dmFyIGJyPUZ1bmN0aW9uLnByb3RvdHlwZSx3cj1ici5hcHBseSxTcj1ici5iaW5kLHhyPWJyLmNhbGwsRXI9Im9iamVjdCI9PXR5cGVvZiBSZWZsZWN0JiZSZWZsZWN0LmFwcGx5fHwoU3I/eHIuYmluZCh3cik6ZnVuY3Rpb24oKXtyZXR1cm4geHIuYXBwbHkod3IsYXJndW1lbnRzKX0pLE9yPWp0KCJzcGVjaWVzIiksanI9UmVnRXhwLnByb3RvdHlwZSxJcj1SKCIiLmNoYXJBdCksUHI9UigiIi5jaGFyQ29kZUF0KSxUcj1SKCIiLnNsaWNlKSxNcj1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSxuKXt2YXIgcixvLGk9SmUoRihlKSksdT1oZShuKSxhPWkubGVuZ3RoO3JldHVybiB1PDB8fHU+PWE/dD8iIjp2b2lkIDA6KHI9UHIoaSx1KSk8NTUyOTZ8fHI+NTYzMTl8fHUrMT09PWF8fChvPVByKGksdSsxKSk8NTYzMjB8fG8+NTczNDM/dD9JcihpLHUpOnI6dD9UcihpLHUsdSsyKTpvLTU2MzIwKyhyLTU1Mjk2PDwxMCkrNjU1MzZ9fSxBcj17Y29kZUF0Ok1yKCExKSxjaGFyQXQ6TXIoITApfSxScj1Bci5jaGFyQXQsa3I9ZnVuY3Rpb24odCxlLG4pe3JldHVybiBlKyhuP1JyKHQsZSkubGVuZ3RoOjEpfSxDcj1NYXRoLmZsb29yLE5yPVIoIiIuY2hhckF0KSxMcj1SKCIiLnJlcGxhY2UpLFZyPVIoIiIuc2xpY2UpLERyPS9cJChbJCYnYF18XGR7MSwyfXw8W14+XSo+KS9nLHpyPS9cJChbJCYnYF18XGR7MSwyfSkvZyxGcj1mdW5jdGlvbih0LGUsbixyLG8saSl7dmFyIHU9bit0Lmxlbmd0aCxhPXIubGVuZ3RoLGM9enI7cmV0dXJuIHZvaWQgMCE9PW8mJihvPXZ0KG8pLGM9RHIpLExyKGksYywoZnVuY3Rpb24oaSxjKXt2YXIgZjtzd2l0Y2goTnIoYywwKSl7Y2FzZSIkIjpyZXR1cm4gIiQiO2Nhc2UiJiI6cmV0dXJuIHQ7Y2FzZSJgIjpyZXR1cm4gVnIoZSwwLG4pO2Nhc2UiJyI6cmV0dXJuIFZyKGUsdSk7Y2FzZSI8IjpmPW9bVnIoYywxLC0xKV07YnJlYWs7ZGVmYXVsdDp2YXIgcz0rYztpZigwPT09cylyZXR1cm4gaTtpZihzPmEpe3ZhciBsPUNyKHMvMTApO3JldHVybiAwPT09bD9pOmw8PWE/dm9pZCAwPT09cltsLTFdP05yKGMsMSk6cltsLTFdK05yKGMsMSk6aX1mPXJbcy0xXTt9cmV0dXJuIHZvaWQgMD09PWY/IiI6Zn0pKX0sX3I9bS5UeXBlRXJyb3IsJHI9ZnVuY3Rpb24odCxlKXt2YXIgbj10LmV4ZWM7aWYoJChuKSl7dmFyIHI9eChuLHQsZSk7cmV0dXJuIG51bGwhPT1yJiZ6dChyKSxyfWlmKCJSZWdFeHAiPT09Tih0KSlyZXR1cm4geChtcix0LGUpO3Rocm93IF9yKCJSZWdFeHAjZXhlYyBjYWxsZWQgb24gaW5jb21wYXRpYmxlIHJlY2VpdmVyIil9LEhyPWp0KCJyZXBsYWNlIiksQnI9TWF0aC5tYXgsR3I9TWF0aC5taW4sV3I9UihbXS5jb25jYXQpLFVyPVIoW10ucHVzaCkscXI9UigiIi5pbmRleE9mKSxLcj1SKCIiLnNsaWNlKSxYcj0iJDAiPT09ImEiLnJlcGxhY2UoLy4vLCIkMCIpLFlyPSEhLy4vW0hyXSYmIiI9PT0vLi9bSHJdKCJhIiwiJDAiKTtmdW5jdGlvbiBKcih0KXtyZXR1cm4gdm9pZCAwPT09dCYmKHQ9InIiKSx0KyItIitvLm5hbm9pZCgpfSFmdW5jdGlvbih0LGUsbixyKXt2YXIgbz1qdCh0KSxpPSFiKChmdW5jdGlvbigpe3ZhciBlPXt9O3JldHVybiBlW29dPWZ1bmN0aW9uKCl7cmV0dXJuIDd9LDchPSIiW3RdKGUpfSkpLHU9aSYmIWIoKGZ1bmN0aW9uKCl7dmFyIGU9ITEsbj0vYS87cmV0dXJuICJzcGxpdCI9PT10JiYoKG49e30pLmNvbnN0cnVjdG9yPXt9LG4uY29uc3RydWN0b3JbT3JdPWZ1bmN0aW9uKCl7cmV0dXJuIG59LG4uZmxhZ3M9IiIsbltvXT0vLi9bb10pLG4uZXhlYz1mdW5jdGlvbigpe3JldHVybiBlPSEwLG51bGx9LG5bb10oIiIpLCFlfSkpO2lmKCFpfHwhdXx8bil7dmFyIGE9UigvLi9bb10pLGM9ZShvLCIiW3RdLChmdW5jdGlvbih0LGUsbixyLG8pe3ZhciB1PVIodCksYz1lLmV4ZWM7cmV0dXJuIGM9PT1tcnx8Yz09PWpyLmV4ZWM/aSYmIW8/e2RvbmU6ITAsdmFsdWU6YShlLG4scil9Ontkb25lOiEwLHZhbHVlOnUobixlLHIpfTp7ZG9uZTohMX19KSk7ZGUoU3RyaW5nLnByb3RvdHlwZSx0LGNbMF0pLGRlKGpyLG8sY1sxXSk7fXImJkh0KGpyW29dLCJzaGFtIiwhMCk7fSgicmVwbGFjZSIsKGZ1bmN0aW9uKHQsZSxuKXt2YXIgcj1Zcj8iJCI6IiQwIjtyZXR1cm4gW2Z1bmN0aW9uKHQsbil7dmFyIHI9Rih0aGlzKSxvPW51bGw9PXQ/dm9pZCAwOnV0KHQsSHIpO3JldHVybiBvP3gobyx0LHIsbik6eChlLEplKHIpLHQsbil9LGZ1bmN0aW9uKHQsbyl7dmFyIGk9enQodGhpcyksdT1KZSh0KTtpZigic3RyaW5nIj09dHlwZW9mIG8mJi0xPT09cXIobyxyKSYmLTE9PT1xcihvLCIkPCIpKXt2YXIgYT1uKGUsaSx1LG8pO2lmKGEuZG9uZSlyZXR1cm4gYS52YWx1ZX12YXIgYz0kKG8pO2N8fChvPUplKG8pKTt2YXIgZj1pLmdsb2JhbDtpZihmKXt2YXIgcz1pLnVuaWNvZGU7aS5sYXN0SW5kZXg9MDt9Zm9yKHZhciBsPVtdOzspe3ZhciBkPSRyKGksdSk7aWYobnVsbD09PWQpYnJlYWs7aWYoVXIobCxkKSwhZilicmVhazsiIj09PUplKGRbMF0pJiYoaS5sYXN0SW5kZXg9a3IodSx3ZShpLmxhc3RJbmRleCkscykpO31mb3IodmFyIHAsdj0iIixoPTAseT0wO3k8bC5sZW5ndGg7eSsrKXtmb3IodmFyIGc9SmUoKGQ9bFt5XSlbMF0pLG09QnIoR3IoaGUoZC5pbmRleCksdS5sZW5ndGgpLDApLGI9W10sdz0xO3c8ZC5sZW5ndGg7dysrKVVyKGIsdm9pZCAwPT09KHA9ZFt3XSk/cDpTdHJpbmcocCkpO3ZhciBTPWQuZ3JvdXBzO2lmKGMpe3ZhciB4PVdyKFtnXSxiLG0sdSk7dm9pZCAwIT09UyYmVXIoeCxTKTt2YXIgRT1KZShFcihvLHZvaWQgMCx4KSk7fWVsc2UgRT1GcihnLHUsbSxiLFMsbyk7bT49aCYmKHYrPUtyKHUsaCxtKStFLGg9bStnLmxlbmd0aCk7fXJldHVybiB2K0tyKHUsaCl9XX0pLCEhYigoZnVuY3Rpb24oKXt2YXIgdD0vLi87cmV0dXJuIHQuZXhlYz1mdW5jdGlvbigpe3ZhciB0PVtdO3JldHVybiB0Lmdyb3Vwcz17YToiNyJ9LHR9LCI3IiE9PSIiLnJlcGxhY2UodCwiJDxhPiIpfSkpfHwhWHJ8fFlyKTt2YXIgUXI9bS5Qcm9taXNlLFpyPWZ1bmN0aW9uKHQsZSxuKXtmb3IodmFyIHIgaW4gZSlkZSh0LHIsZVtyXSxuKTtyZXR1cm4gdH0sdG89bS5TdHJpbmcsZW89bS5UeXBlRXJyb3Isbm89T2JqZWN0LnNldFByb3RvdHlwZU9mfHwoIl9fcHJvdG9fXyJpbnt9P2Z1bmN0aW9uKCl7dmFyIHQsZT0hMSxuPXt9O3RyeXsodD1SKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoT2JqZWN0LnByb3RvdHlwZSwiX19wcm90b19fIikuc2V0KSkobixbXSksZT1uIGluc3RhbmNlb2YgQXJyYXk7fWNhdGNoKHQpe31yZXR1cm4gZnVuY3Rpb24obixyKXtyZXR1cm4genQobiksZnVuY3Rpb24odCl7aWYoIm9iamVjdCI9PXR5cGVvZiB0fHwkKHQpKXJldHVybiB0O3Rocm93IGVvKCJDYW4ndCBzZXQgIit0byh0KSsiIGFzIGEgcHJvdG90eXBlIil9KHIpLGU/dChuLHIpOm4uX19wcm90b19fPXIsbn19KCk6dm9pZCAwKSxybz0kdC5mLG9vPWp0KCJ0b1N0cmluZ1RhZyIpLGlvPWZ1bmN0aW9uKHQsZSxuKXt0JiYheXQodD1uP3Q6dC5wcm90b3R5cGUsb28pJiZybyh0LG9vLHtjb25maWd1cmFibGU6ITAsdmFsdWU6ZX0pO30sdW89anQoInNwZWNpZXMiKSxhbz1tLlR5cGVFcnJvcixjbz1mdW5jdGlvbih0LGUpe2lmKFcoZSx0KSlyZXR1cm4gdDt0aHJvdyBhbygiSW5jb3JyZWN0IGludm9jYXRpb24iKX0sZm89e30sc289anQoIml0ZXJhdG9yIiksbG89QXJyYXkucHJvdG90eXBlLHBvPWp0KCJpdGVyYXRvciIpLHZvPWZ1bmN0aW9uKHQpe2lmKG51bGwhPXQpcmV0dXJuIHV0KHQscG8pfHx1dCh0LCJAQGl0ZXJhdG9yIil8fGZvW1hlKHQpXX0saG89bS5UeXBlRXJyb3IseW89ZnVuY3Rpb24odCxlLG4pe3ZhciByLG87enQodCk7dHJ5e2lmKCEocj11dCh0LCJyZXR1cm4iKSkpe2lmKCJ0aHJvdyI9PT1lKXRocm93IG47cmV0dXJuIG59cj14KHIsdCk7fWNhdGNoKHQpe289ITAscj10O31pZigidGhyb3ciPT09ZSl0aHJvdyBuO2lmKG8pdGhyb3cgcjtyZXR1cm4genQociksbn0sZ289bS5UeXBlRXJyb3IsbW89ZnVuY3Rpb24odCxlKXt0aGlzLnN0b3BwZWQ9dCx0aGlzLnJlc3VsdD1lO30sYm89bW8ucHJvdG90eXBlLHdvPWZ1bmN0aW9uKHQsZSxuKXt2YXIgcixvLGksdSxhLGMsZixzLGw9biYmbi50aGF0LGQ9ISghbnx8IW4uQVNfRU5UUklFUykscD0hKCFufHwhbi5JU19JVEVSQVRPUiksdj0hKCFufHwhbi5JTlRFUlJVUFRFRCksaD1UbihlLGwpLHk9ZnVuY3Rpb24odCl7cmV0dXJuIHImJnlvKHIsIm5vcm1hbCIsdCksbmV3IG1vKCEwLHQpfSxnPWZ1bmN0aW9uKHQpe3JldHVybiBkPyh6dCh0KSx2P2godFswXSx0WzFdLHkpOmgodFswXSx0WzFdKSk6dj9oKHQseSk6aCh0KX07aWYocClyPXQ7ZWxzZSB7aWYoIShvPXZvKHQpKSl0aHJvdyBnbyhydCh0KSsiIGlzIG5vdCBpdGVyYWJsZSIpO2lmKHZvaWQgMCE9PShzPW8pJiYoZm8uQXJyYXk9PT1zfHxsb1tzb109PT1zKSl7Zm9yKGk9MCx1PVNlKHQpO3U+aTtpKyspaWYoKGE9Zyh0W2ldKSkmJlcoYm8sYSkpcmV0dXJuIGE7cmV0dXJuIG5ldyBtbyghMSl9cj1mdW5jdGlvbih0LGUpe3ZhciBuPWFyZ3VtZW50cy5sZW5ndGg8Mj92byh0KTplO2lmKGl0KG4pKXJldHVybiB6dCh4KG4sdCkpO3Rocm93IGhvKHJ0KHQpKyIgaXMgbm90IGl0ZXJhYmxlIil9KHQsbyk7fWZvcihjPXIubmV4dDshKGY9eChjLHIpKS5kb25lOyl7dHJ5e2E9ZyhmLnZhbHVlKTt9Y2F0Y2godCl7eW8ociwidGhyb3ciLHQpO31pZigib2JqZWN0Ij09dHlwZW9mIGEmJmEmJlcoYm8sYSkpcmV0dXJuIGF9cmV0dXJuIG5ldyBtbyghMSl9LFNvPWp0KCJpdGVyYXRvciIpLHhvPSExO3RyeXt2YXIgRW89MCxPbz17bmV4dDpmdW5jdGlvbigpe3JldHVybiB7ZG9uZTohIUVvKyt9fSxyZXR1cm46ZnVuY3Rpb24oKXt4bz0hMDt9fTtPb1tTb109ZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30sQXJyYXkuZnJvbShPbywoZnVuY3Rpb24oKXt0aHJvdyAyfSkpO31jYXRjaCh0KXt9dmFyIGpvLElvLFBvLFRvLE1vPWZ1bmN0aW9uKHQsZSl7aWYoIWUmJiF4bylyZXR1cm4gITE7dmFyIG49ITE7dHJ5e3ZhciByPXt9O3JbU29dPWZ1bmN0aW9uKCl7cmV0dXJuIHtuZXh0OmZ1bmN0aW9uKCl7cmV0dXJuIHtkb25lOm49ITB9fX19LHQocik7fWNhdGNoKHQpe31yZXR1cm4gbn0sQW89bS5UeXBlRXJyb3IsUm89anQoInNwZWNpZXMiKSxrbz1mdW5jdGlvbih0LGUpe3ZhciBuLHI9enQodCkuY29uc3RydWN0b3I7cmV0dXJuIHZvaWQgMD09PXJ8fG51bGw9PShuPXp0KHIpW1JvXSk/ZTpmdW5jdGlvbih0KXtpZihEbih0KSlyZXR1cm4gdDt0aHJvdyBBbyhydCh0KSsiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIil9KG4pfSxDbz1SKFtdLnNsaWNlKSxObz0vKD86aXBhZHxpcGhvbmV8aXBvZCkuKmFwcGxld2Via2l0L2kudGVzdChVKSxMbz0icHJvY2VzcyI9PU4obS5wcm9jZXNzKSxWbz1tLnNldEltbWVkaWF0ZSxEbz1tLmNsZWFySW1tZWRpYXRlLHpvPW0ucHJvY2VzcyxGbz1tLkRpc3BhdGNoLF9vPW0uRnVuY3Rpb24sJG89bS5NZXNzYWdlQ2hhbm5lbCxIbz1tLlN0cmluZyxCbz0wLEdvPXt9LFdvPSJvbnJlYWR5c3RhdGVjaGFuZ2UiO3RyeXtqbz1tLmxvY2F0aW9uO31jYXRjaCh0KXt9dmFyIFVvPWZ1bmN0aW9uKHQpe2lmKHl0KEdvLHQpKXt2YXIgZT1Hb1t0XTtkZWxldGUgR29bdF0sZSgpO319LHFvPWZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbigpe1VvKHQpO319LEtvPWZ1bmN0aW9uKHQpe1VvKHQuZGF0YSk7fSxYbz1mdW5jdGlvbih0KXttLnBvc3RNZXNzYWdlKEhvKHQpLGpvLnByb3RvY29sKyIvLyIram8uaG9zdCk7fTtWbyYmRG98fChWbz1mdW5jdGlvbih0KXt2YXIgZT1Dbyhhcmd1bWVudHMsMSk7cmV0dXJuIEdvWysrQm9dPWZ1bmN0aW9uKCl7RXIoJCh0KT90Ol9vKHQpLHZvaWQgMCxlKTt9LElvKEJvKSxCb30sRG89ZnVuY3Rpb24odCl7ZGVsZXRlIEdvW3RdO30sTG8/SW89ZnVuY3Rpb24odCl7em8ubmV4dFRpY2socW8odCkpO306Rm8mJkZvLm5vdz9Jbz1mdW5jdGlvbih0KXtGby5ub3cocW8odCkpO306JG8mJiFObz8oVG89KFBvPW5ldyAkbykucG9ydDIsUG8ucG9ydDEub25tZXNzYWdlPUtvLElvPVRuKFRvLnBvc3RNZXNzYWdlLFRvKSk6bS5hZGRFdmVudExpc3RlbmVyJiYkKG0ucG9zdE1lc3NhZ2UpJiYhbS5pbXBvcnRTY3JpcHRzJiZqbyYmImZpbGU6IiE9PWpvLnByb3RvY29sJiYhYihYbyk/KElvPVhvLG0uYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsS28sITEpKTpJbz1XbyBpbiBrdCgic2NyaXB0Iik/ZnVuY3Rpb24odCl7aG4uYXBwZW5kQ2hpbGQoa3QoInNjcmlwdCIpKS5vbnJlYWR5c3RhdGVjaGFuZ2U9ZnVuY3Rpb24oKXtobi5yZW1vdmVDaGlsZCh0aGlzKSxVbyh0KTt9O306ZnVuY3Rpb24odCl7c2V0VGltZW91dChxbyh0KSwwKTt9KTt2YXIgWW8sSm8sUW8sWm8sdGksZWksbmkscmksb2k9e3NldDpWbyxjbGVhcjpEb30saWk9L2lwYWR8aXBob25lfGlwb2QvaS50ZXN0KFUpJiZ2b2lkIDAhPT1tLlBlYmJsZSx1aT0vd2ViMHMoPyEuKmNocm9tZSkvaS50ZXN0KFUpLGFpPUx0LmYsY2k9b2kuc2V0LGZpPW0uTXV0YXRpb25PYnNlcnZlcnx8bS5XZWJLaXRNdXRhdGlvbk9ic2VydmVyLHNpPW0uZG9jdW1lbnQsbGk9bS5wcm9jZXNzLGRpPW0uUHJvbWlzZSxwaT1haShtLCJxdWV1ZU1pY3JvdGFzayIpLHZpPXBpJiZwaS52YWx1ZTt2aXx8KFlvPWZ1bmN0aW9uKCl7dmFyIHQsZTtmb3IoTG8mJih0PWxpLmRvbWFpbikmJnQuZXhpdCgpO0pvOyl7ZT1Kby5mbixKbz1Kby5uZXh0O3RyeXtlKCk7fWNhdGNoKHQpe3Rocm93IEpvP1pvKCk6UW89dm9pZCAwLHR9fVFvPXZvaWQgMCx0JiZ0LmVudGVyKCk7fSxOb3x8TG98fHVpfHwhZml8fCFzaT8haWkmJmRpJiZkaS5yZXNvbHZlPygobmk9ZGkucmVzb2x2ZSh2b2lkIDApKS5jb25zdHJ1Y3Rvcj1kaSxyaT1UbihuaS50aGVuLG5pKSxabz1mdW5jdGlvbigpe3JpKFlvKTt9KTpMbz9abz1mdW5jdGlvbigpe2xpLm5leHRUaWNrKFlvKTt9OihjaT1UbihjaSxtKSxabz1mdW5jdGlvbigpe2NpKFlvKTt9KToodGk9ITAsZWk9c2kuY3JlYXRlVGV4dE5vZGUoIiIpLG5ldyBmaShZbykub2JzZXJ2ZShlaSx7Y2hhcmFjdGVyRGF0YTohMH0pLFpvPWZ1bmN0aW9uKCl7ZWkuZGF0YT10aT0hdGk7fSkpO3ZhciBoaSx5aSxnaSxtaSxiaT12aXx8ZnVuY3Rpb24odCl7dmFyIGU9e2ZuOnQsbmV4dDp2b2lkIDB9O1FvJiYoUW8ubmV4dD1lKSxKb3x8KEpvPWUsWm8oKSksUW89ZTt9LHdpPWZ1bmN0aW9uKHQpe3ZhciBlLG47dGhpcy5wcm9taXNlPW5ldyB0KChmdW5jdGlvbih0LHIpe2lmKHZvaWQgMCE9PWV8fHZvaWQgMCE9PW4pdGhyb3cgVHlwZUVycm9yKCJCYWQgUHJvbWlzZSBjb25zdHJ1Y3RvciIpO2U9dCxuPXI7fSkpLHRoaXMucmVzb2x2ZT1pdChlKSx0aGlzLnJlamVjdD1pdChuKTt9LFNpPXtmOmZ1bmN0aW9uKHQpe3JldHVybiBuZXcgd2kodCl9fSx4aT1mdW5jdGlvbih0KXt0cnl7cmV0dXJuIHtlcnJvcjohMSx2YWx1ZTp0KCl9fWNhdGNoKHQpe3JldHVybiB7ZXJyb3I6ITAsdmFsdWU6dH19fSxFaT0ib2JqZWN0Ij09dHlwZW9mIHdpbmRvdyxPaT1vaS5zZXQsamk9anQoInNwZWNpZXMiKSxJaT0iUHJvbWlzZSIsUGk9YWUuZ2V0dGVyRm9yKElpKSxUaT1hZS5zZXQsTWk9YWUuZ2V0dGVyRm9yKElpKSxBaT1RciYmUXIucHJvdG90eXBlLFJpPVFyLGtpPUFpLENpPW0uVHlwZUVycm9yLE5pPW0uZG9jdW1lbnQsTGk9bS5wcm9jZXNzLFZpPVNpLmYsRGk9Vmksemk9ISEoTmkmJk5pLmNyZWF0ZUV2ZW50JiZtLmRpc3BhdGNoRXZlbnQpLEZpPSQobS5Qcm9taXNlUmVqZWN0aW9uRXZlbnQpLF9pPSJ1bmhhbmRsZWRyZWplY3Rpb24iLCRpPSExLEhpPV9lKElpLChmdW5jdGlvbigpe3ZhciB0PXF0KFJpKSxlPXQhPT1TdHJpbmcoUmkpO2lmKCFlJiY2Nj09PUopcmV0dXJuICEwO2lmKEo+PTUxJiYvbmF0aXZlIGNvZGUvLnRlc3QodCkpcmV0dXJuICExO3ZhciBuPW5ldyBSaSgoZnVuY3Rpb24odCl7dCgxKTt9KSkscj1mdW5jdGlvbih0KXt0KChmdW5jdGlvbigpe30pLChmdW5jdGlvbigpe30pKTt9O3JldHVybiAobi5jb25zdHJ1Y3Rvcj17fSlbamldPXIsISgkaT1uLnRoZW4oKGZ1bmN0aW9uKCl7fSkpaW5zdGFuY2VvZiByKXx8IWUmJkVpJiYhRml9KSksQmk9SGl8fCFNbygoZnVuY3Rpb24odCl7UmkuYWxsKHQpLmNhdGNoKChmdW5jdGlvbigpe30pKTt9KSksR2k9ZnVuY3Rpb24odCl7dmFyIGU7cmV0dXJuICEoIUgodCl8fCEkKGU9dC50aGVuKSkmJmV9LFdpPWZ1bmN0aW9uKHQsZSl7aWYoIXQubm90aWZpZWQpe3Qubm90aWZpZWQ9ITA7dmFyIG49dC5yZWFjdGlvbnM7YmkoKGZ1bmN0aW9uKCl7Zm9yKHZhciByPXQudmFsdWUsbz0xPT10LnN0YXRlLGk9MDtuLmxlbmd0aD5pOyl7dmFyIHUsYSxjLGY9bltpKytdLHM9bz9mLm9rOmYuZmFpbCxsPWYucmVzb2x2ZSxkPWYucmVqZWN0LHA9Zi5kb21haW47dHJ5e3M/KG98fCgyPT09dC5yZWplY3Rpb24mJlhpKHQpLHQucmVqZWN0aW9uPTEpLCEwPT09cz91PXI6KHAmJnAuZW50ZXIoKSx1PXMocikscCYmKHAuZXhpdCgpLGM9ITApKSx1PT09Zi5wcm9taXNlP2QoQ2koIlByb21pc2UtY2hhaW4gY3ljbGUiKSk6KGE9R2kodSkpP3goYSx1LGwsZCk6bCh1KSk6ZChyKTt9Y2F0Y2godCl7cCYmIWMmJnAuZXhpdCgpLGQodCk7fX10LnJlYWN0aW9ucz1bXSx0Lm5vdGlmaWVkPSExLGUmJiF0LnJlamVjdGlvbiYmcWkodCk7fSkpO319LFVpPWZ1bmN0aW9uKHQsZSxuKXt2YXIgcixvO3ppPygocj1OaS5jcmVhdGVFdmVudCgiRXZlbnQiKSkucHJvbWlzZT1lLHIucmVhc29uPW4sci5pbml0RXZlbnQodCwhMSwhMCksbS5kaXNwYXRjaEV2ZW50KHIpKTpyPXtwcm9taXNlOmUscmVhc29uOm59LCFGaSYmKG89bVsib24iK3RdKT9vKHIpOnQ9PT1faSYmZnVuY3Rpb24odCxlKXt2YXIgbj1tLmNvbnNvbGU7biYmbi5lcnJvciYmKDE9PWFyZ3VtZW50cy5sZW5ndGg/bi5lcnJvcih0KTpuLmVycm9yKHQsZSkpO30oIlVuaGFuZGxlZCBwcm9taXNlIHJlamVjdGlvbiIsbik7fSxxaT1mdW5jdGlvbih0KXt4KE9pLG0sKGZ1bmN0aW9uKCl7dmFyIGUsbj10LmZhY2FkZSxyPXQudmFsdWU7aWYoS2kodCkmJihlPXhpKChmdW5jdGlvbigpe0xvP0xpLmVtaXQoInVuaGFuZGxlZFJlamVjdGlvbiIscixuKTpVaShfaSxuLHIpO30pKSx0LnJlamVjdGlvbj1Mb3x8S2kodCk/MjoxLGUuZXJyb3IpKXRocm93IGUudmFsdWV9KSk7fSxLaT1mdW5jdGlvbih0KXtyZXR1cm4gMSE9PXQucmVqZWN0aW9uJiYhdC5wYXJlbnR9LFhpPWZ1bmN0aW9uKHQpe3goT2ksbSwoZnVuY3Rpb24oKXt2YXIgZT10LmZhY2FkZTtMbz9MaS5lbWl0KCJyZWplY3Rpb25IYW5kbGVkIixlKTpVaSgicmVqZWN0aW9uaGFuZGxlZCIsZSx0LnZhbHVlKTt9KSk7fSxZaT1mdW5jdGlvbih0LGUsbil7cmV0dXJuIGZ1bmN0aW9uKHIpe3QoZSxyLG4pO319LEppPWZ1bmN0aW9uKHQsZSxuKXt0LmRvbmV8fCh0LmRvbmU9ITAsbiYmKHQ9biksdC52YWx1ZT1lLHQuc3RhdGU9MixXaSh0LCEwKSk7fSxRaT1mdW5jdGlvbih0LGUsbil7aWYoIXQuZG9uZSl7dC5kb25lPSEwLG4mJih0PW4pO3RyeXtpZih0LmZhY2FkZT09PWUpdGhyb3cgQ2koIlByb21pc2UgY2FuJ3QgYmUgcmVzb2x2ZWQgaXRzZWxmIik7dmFyIHI9R2koZSk7cj9iaSgoZnVuY3Rpb24oKXt2YXIgbj17ZG9uZTohMX07dHJ5e3gocixlLFlpKFFpLG4sdCksWWkoSmksbix0KSk7fWNhdGNoKGUpe0ppKG4sZSx0KTt9fSkpOih0LnZhbHVlPWUsdC5zdGF0ZT0xLFdpKHQsITEpKTt9Y2F0Y2goZSl7Smkoe2RvbmU6ITF9LGUsdCk7fX19O2lmKEhpJiYoa2k9KFJpPWZ1bmN0aW9uKHQpe2NvKHRoaXMsa2kpLGl0KHQpLHgoaGksdGhpcyk7dmFyIGU9UGkodGhpcyk7dHJ5e3QoWWkoUWksZSksWWkoSmksZSkpO31jYXRjaCh0KXtKaShlLHQpO319KS5wcm90b3R5cGUsKGhpPWZ1bmN0aW9uKHQpe1RpKHRoaXMse3R5cGU6SWksZG9uZTohMSxub3RpZmllZDohMSxwYXJlbnQ6ITEscmVhY3Rpb25zOltdLHJlamVjdGlvbjohMSxzdGF0ZTowLHZhbHVlOnZvaWQgMH0pO30pLnByb3RvdHlwZT1acihraSx7dGhlbjpmdW5jdGlvbih0LGUpe3ZhciBuPU1pKHRoaXMpLHI9bi5yZWFjdGlvbnMsbz1WaShrbyh0aGlzLFJpKSk7cmV0dXJuIG8ub2s9ISQodCl8fHQsby5mYWlsPSQoZSkmJmUsby5kb21haW49TG8/TGkuZG9tYWluOnZvaWQgMCxuLnBhcmVudD0hMCxyW3IubGVuZ3RoXT1vLDAhPW4uc3RhdGUmJldpKG4sITEpLG8ucHJvbWlzZX0sY2F0Y2g6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMudGhlbih2b2lkIDAsdCl9fSkseWk9ZnVuY3Rpb24oKXt2YXIgdD1uZXcgaGksZT1QaSh0KTt0aGlzLnByb21pc2U9dCx0aGlzLnJlc29sdmU9WWkoUWksZSksdGhpcy5yZWplY3Q9WWkoSmksZSk7fSxTaS5mPVZpPWZ1bmN0aW9uKHQpe3JldHVybiB0PT09Uml8fHQ9PT1naT9uZXcgeWkodCk6RGkodCl9LCQoUXIpJiZBaSE9PU9iamVjdC5wcm90b3R5cGUpKXttaT1BaS50aGVuLCRpfHwoZGUoQWksInRoZW4iLChmdW5jdGlvbih0LGUpe3ZhciBuPXRoaXM7cmV0dXJuIG5ldyBSaSgoZnVuY3Rpb24odCxlKXt4KG1pLG4sdCxlKTt9KSkudGhlbih0LGUpfSkse3Vuc2FmZTohMH0pLGRlKEFpLCJjYXRjaCIsa2kuY2F0Y2gse3Vuc2FmZTohMH0pKTt0cnl7ZGVsZXRlIEFpLmNvbnN0cnVjdG9yO31jYXRjaCh0KXt9bm8mJm5vKEFpLGtpKTt9ZnVuY3Rpb24gWmkodCxuLHIpe3JldHVybiB2b2lkIDA9PT1yJiYocj0iIiksYyh0aGlzLHZvaWQgMCx2b2lkIDAsKGZ1bmN0aW9uKCl7dmFyIG8saSx1LGEsYyxzLGw7cmV0dXJuIGYodGhpcywoZnVuY3Rpb24oZil7c3dpdGNoKGYubGFiZWwpe2Nhc2UgMDpyZXR1cm4gbj8odC5yZXN0b3JlU2VsZWN0aW9uKCksbz10LmdldE1lbnVDb25maWcoImluc2VydFZpZGVvIiksaT1vLm9uSW5zZXJ0ZWRWaWRlbyx1PW8uY2hlY2tWaWRlbyxhPW8ucGFyc2VWaWRlb1NyYyxbNCx1KG4scildKTpbMl07Y2FzZSAxOnJldHVybiAic3RyaW5nIj09dHlwZW9mKGM9Zi5zZW50KCkpPyh0LmFsZXJ0KGMsImVycm9yIiksWzJdKTpudWxsPT1jP1syXTpbNCxhKG4pXTtjYXNlIDI6cmV0dXJuIDAhPT0ocz1mLnNlbnQoKSkudHJpbSgpLmluZGV4T2YoIjxpZnJhbWUgIikmJihzPXMucmVwbGFjZSgvPC9nLCImbHQ7IikucmVwbGFjZSgvPi9nLCImZ3Q7IikpLGw9e3R5cGU6InZpZGVvIixzcmM6cyxwb3N0ZXI6cixjaGlsZHJlbjpbe3RleHQ6IiJ9XX0sUHJvbWlzZS5yZXNvbHZlKCkudGhlbigoZnVuY3Rpb24oKXtlLlRyYW5zZm9ybXMuaW5zZXJ0Tm9kZXModCxsKTt9KSksaShsKSxbMl19fSkpfSkpfWZ1bmN0aW9uIHR1KCl7cmV0dXJuIEpyKCJ3LWUtaW5zZXJ0LXZpZGVvIil9SGUoe2dsb2JhbDohMCx3cmFwOiEwLGZvcmNlZDpIaX0se1Byb21pc2U6Uml9KSxpbyhSaSxJaSwhMSksZnVuY3Rpb24odCl7dmFyIGU9Ryh0KSxuPSR0LmY7dyYmZSYmIWVbdW9dJiZuKGUsdW8se2NvbmZpZ3VyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpc319KTt9KElpKSxnaT1HKElpKSxIZSh7dGFyZ2V0OklpLHN0YXQ6ITAsZm9yY2VkOkhpfSx7cmVqZWN0OmZ1bmN0aW9uKHQpe3ZhciBlPVZpKHRoaXMpO3JldHVybiB4KGUucmVqZWN0LHZvaWQgMCx0KSxlLnByb21pc2V9fSksSGUoe3RhcmdldDpJaSxzdGF0OiEwLGZvcmNlZDpIaX0se3Jlc29sdmU6ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKHQsZSl7aWYoenQodCksSChlKSYmZS5jb25zdHJ1Y3Rvcj09PXQpcmV0dXJuIGU7dmFyIG49U2kuZih0KTtyZXR1cm4gKDAsIG4ucmVzb2x2ZSkoZSksbi5wcm9taXNlfSh0aGlzLHQpfX0pLEhlKHt0YXJnZXQ6SWksc3RhdDohMCxmb3JjZWQ6Qml9LHthbGw6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcyxuPVZpKGUpLHI9bi5yZXNvbHZlLG89bi5yZWplY3QsaT14aSgoZnVuY3Rpb24oKXt2YXIgbj1pdChlLnJlc29sdmUpLGk9W10sdT0wLGE9MTt3byh0LChmdW5jdGlvbih0KXt2YXIgYz11KyssZj0hMTthKysseChuLGUsdCkudGhlbigoZnVuY3Rpb24odCl7Znx8KGY9ITAsaVtjXT10LC0tYXx8cihpKSk7fSksbyk7fSkpLC0tYXx8cihpKTt9KSk7cmV0dXJuIGkuZXJyb3ImJm8oaS52YWx1ZSksbi5wcm9taXNlfSxyYWNlOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMsbj1WaShlKSxyPW4ucmVqZWN0LG89eGkoKGZ1bmN0aW9uKCl7dmFyIG89aXQoZS5yZXNvbHZlKTt3byh0LChmdW5jdGlvbih0KXt4KG8sZSx0KS50aGVuKG4ucmVzb2x2ZSxyKTt9KSk7fSkpO3JldHVybiBvLmVycm9yJiZyKG8udmFsdWUpLG4ucHJvbWlzZX19KTt2YXIgZXU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKCl7dGhpcy50aXRsZT10LnQoInZpZGVvTW9kdWxlLmluc2VydFZpZGVvIiksdGhpcy5pY29uU3ZnPSc8c3ZnIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik05ODEuMTg0IDE2MC4wOTZDODM3LjU2OCAxMzkuNDU2IDY3OC44NDggMTI4IDUxMiAxMjhTMTg2LjQzMiAxMzkuNDU2IDQyLjgxNiAxNjAuMDk2QzE1LjI5NiAyNjcuODA4IDAgMzg2Ljg0OCAwIDUxMnMxNS4yNjQgMjQ0LjE2IDQyLjgxNiAzNTEuOTA0QzE4Ni40NjQgODg0LjU0NCAzNDUuMTUyIDg5NiA1MTIgODk2czMyNS41NjgtMTEuNDU2IDQ2OS4xODQtMzIuMDk2QzEwMDguNzA0IDc1Ni4xOTIgMTAyNCA2MzcuMTUyIDEwMjQgNTEycy0xNS4yNjQtMjQ0LjE2LTQyLjgxNi0zNTEuOTA0ek0zODQgNzA0VjMyMGwzMjAgMTkyLTMyMCAxOTJ6Ij48L3BhdGg+PC9zdmc+Jyx0aGlzLnRhZz0iYnV0dG9uIix0aGlzLnNob3dNb2RhbD0hMCx0aGlzLm1vZGFsV2lkdGg9MzIwLHRoaXMuJGNvbnRlbnQ9bnVsbCx0aGlzLnNyY0lucHV0SWQ9dHUoKSx0aGlzLnBvc3RlcklucHV0SWQ9dHUoKSx0aGlzLmJ1dHRvbklkPXR1KCk7fXJldHVybiBuLnByb3RvdHlwZS5nZXRWYWx1ZT1mdW5jdGlvbih0KXtyZXR1cm4gIiJ9LG4ucHJvdG90eXBlLmlzQWN0aXZlPWZ1bmN0aW9uKHQpe3JldHVybiAhMX0sbi5wcm90b3R5cGUuZXhlYz1mdW5jdGlvbih0LGUpe30sbi5wcm90b3R5cGUuaXNEaXNhYmxlZD1mdW5jdGlvbihuKXt2YXIgcj1uLnNlbGVjdGlvbjtyZXR1cm4gbnVsbD09cnx8KCFlLlJhbmdlLmlzQ29sbGFwc2VkKHIpfHwhIXQuRG9tRWRpdG9yLmdldFNlbGVjdGVkRWxlbXMobikuc29tZSgoZnVuY3Rpb24oZSl7dmFyIHI9dC5Eb21FZGl0b3IuZ2V0Tm9kZVR5cGUoZSk7cmV0dXJuICJwcmUiPT09cnx8KCJsaXN0LWl0ZW0iPT09cnx8ISFuLmlzVm9pZChlKSl9KSkpfSxuLnByb3RvdHlwZS5nZXRNb2RhbFBvc2l0aW9uTm9kZT1mdW5jdGlvbih0KXtyZXR1cm4gbnVsbH0sbi5wcm90b3R5cGUuZ2V0TW9kYWxDb250ZW50RWxlbT1mdW5jdGlvbihlKXt2YXIgbj10aGlzLHI9dGhpcyxvPXIuc3JjSW5wdXRJZCxpPXIucG9zdGVySW5wdXRJZCxhPXIuYnV0dG9uSWQscz1sKHQuZ2VuTW9kYWxJbnB1dEVsZW1zKHQudCgidmlkZW9Nb2R1bGUudmlkZW9TcmMiKSxvLHQudCgidmlkZW9Nb2R1bGUudmlkZW9TcmNQbGFjZUhvbGRlciIpKSwyKSxkPXNbMF0scD1zWzFdLHY9bCh0Lmdlbk1vZGFsSW5wdXRFbGVtcyh0LnQoInZpZGVvTW9kdWxlLnZpZGVvUG9zdGVyIiksaSx0LnQoInZpZGVvTW9kdWxlLnZpZGVvUG9zdGVyUGxhY2VIb2xkZXIiKSksMiksaD12WzBdLHk9dlsxXSxnPXUuZGVmYXVsdChwKSxtPXUuZGVmYXVsdCh5KSxiPWwodC5nZW5Nb2RhbEJ1dHRvbkVsZW1zKGEsdC50KCJ2aWRlb01vZHVsZS5vayIpKSwxKVswXTtpZihudWxsPT10aGlzLiRjb250ZW50KXt2YXIgdz11LmRlZmF1bHQoIjxkaXY+PC9kaXY+Iik7dy5vbigiY2xpY2siLCIjIithLChmdW5jdGlvbih0KXtyZXR1cm4gYyhuLHZvaWQgMCx2b2lkIDAsKGZ1bmN0aW9uKCl7dmFyIG4scjtyZXR1cm4gZih0aGlzLChmdW5jdGlvbih1KXtzd2l0Y2godS5sYWJlbCl7Y2FzZSAwOnJldHVybiB0LnByZXZlbnREZWZhdWx0KCksbj13LmZpbmQoIiMiK28pLnZhbCgpLnRyaW0oKSxyPXcuZmluZCgiIyIraSkudmFsKCkudHJpbSgpLFs0LFppKGUsbixyKV07Y2FzZSAxOnJldHVybiB1LnNlbnQoKSxlLmhpZGVQYW5lbE9yTW9kYWwoKSxbMl19fSkpfSkpfSkpLHRoaXMuJGNvbnRlbnQ9dzt9dmFyIFM9dGhpcy4kY29udGVudDtyZXR1cm4gUy5lbXB0eSgpLFMuYXBwZW5kKGQpLFMuYXBwZW5kKGgpLFMuYXBwZW5kKGIpLGcudmFsKCIiKSxtLnZhbCgiIiksc2V0VGltZW91dCgoZnVuY3Rpb24oKXtnLmZvY3VzKCk7fSkpLFNbMF19LG59KCksbnU9UihbXS5qb2luKSxydT1EIT1PYmplY3Qsb3U9ZnVuY3Rpb24odCxlKXt2YXIgbj1bXVt0XTtyZXR1cm4gISFuJiZiKChmdW5jdGlvbigpe24uY2FsbChudWxsLGV8fGZ1bmN0aW9uKCl7dGhyb3cgMX0sMSk7fSkpfSgiam9pbiIsIiwiKTtIZSh7dGFyZ2V0OiJBcnJheSIscHJvdG86ITAsZm9yY2VkOnJ1fHwhb3V9LHtqb2luOmZ1bmN0aW9uKHQpe3JldHVybiBudShfKHRoaXMpLHZvaWQgMD09PXQ/IiwiOnQpfX0pO3ZhciBpdSx1dSxhdSxjdT0hYigoZnVuY3Rpb24oKXtmdW5jdGlvbiB0KCl7fXJldHVybiB0LnByb3RvdHlwZS5jb25zdHJ1Y3Rvcj1udWxsLE9iamVjdC5nZXRQcm90b3R5cGVPZihuZXcgdCkhPT10LnByb3RvdHlwZX0pKSxmdT1KdCgiSUVfUFJPVE8iKSxzdT1tLk9iamVjdCxsdT1zdS5wcm90b3R5cGUsZHU9Y3U/c3UuZ2V0UHJvdG90eXBlT2Y6ZnVuY3Rpb24odCl7dmFyIGU9dnQodCk7aWYoeXQoZSxmdSkpcmV0dXJuIGVbZnVdO3ZhciBuPWUuY29uc3RydWN0b3I7cmV0dXJuICQobikmJmUgaW5zdGFuY2VvZiBuP24ucHJvdG90eXBlOmUgaW5zdGFuY2VvZiBzdT9sdTpudWxsfSxwdT1qdCgiaXRlcmF0b3IiKSx2dT0hMTtbXS5rZXlzJiYoIm5leHQiaW4oYXU9W10ua2V5cygpKT8odXU9ZHUoZHUoYXUpKSkhPT1PYmplY3QucHJvdG90eXBlJiYoaXU9dXUpOnZ1PSEwKTt2YXIgaHU9bnVsbD09aXV8fGIoKGZ1bmN0aW9uKCl7dmFyIHQ9e307cmV0dXJuIGl1W3B1XS5jYWxsKHQpIT09dH0pKTtodSYmKGl1PXt9KSwkKGl1W3B1XSl8fGRlKGl1LHB1LChmdW5jdGlvbigpe3JldHVybiB0aGlzfSkpO3ZhciB5dT17SXRlcmF0b3JQcm90b3R5cGU6aXUsQlVHR1lfU0FGQVJJX0lURVJBVE9SUzp2dX0sZ3U9eXUuSXRlcmF0b3JQcm90b3R5cGUsbXU9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30sYnU9bGUuUFJPUEVSLHd1PWxlLkNPTkZJR1VSQUJMRSxTdT15dS5JdGVyYXRvclByb3RvdHlwZSx4dT15dS5CVUdHWV9TQUZBUklfSVRFUkFUT1JTLEV1PWp0KCJpdGVyYXRvciIpLE91PSJrZXlzIixqdT0idmFsdWVzIixJdT0iZW50cmllcyIsUHU9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30sVHU9ZnVuY3Rpb24odCxlLG4scixvLGksdSl7IWZ1bmN0aW9uKHQsZSxuLHIpe3ZhciBvPWUrIiBJdGVyYXRvciI7dC5wcm90b3R5cGU9U24oZ3Use25leHQ6SSgrIXIsbil9KSxpbyh0LG8sITEpLGZvW29dPW11O30obixlLHIpO3ZhciBhLGMsZixzPWZ1bmN0aW9uKHQpe2lmKHQ9PT1vJiZoKXJldHVybiBoO2lmKCF4dSYmdCBpbiBwKXJldHVybiBwW3RdO3N3aXRjaCh0KXtjYXNlIE91OmNhc2UganU6Y2FzZSBJdTpyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gbmV3IG4odGhpcyx0KX19cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBuKHRoaXMpfX0sbD1lKyIgSXRlcmF0b3IiLGQ9ITEscD10LnByb3RvdHlwZSx2PXBbRXVdfHxwWyJAQGl0ZXJhdG9yIl18fG8mJnBbb10saD0heHUmJnZ8fHMobykseT0iQXJyYXkiPT1lJiZwLmVudHJpZXN8fHY7aWYoeSYmKGE9ZHUoeS5jYWxsKG5ldyB0KSkpIT09T2JqZWN0LnByb3RvdHlwZSYmYS5uZXh0JiYoZHUoYSkhPT1TdSYmKG5vP25vKGEsU3UpOiQoYVtFdV0pfHxkZShhLEV1LFB1KSksaW8oYSxsLCEwKSksYnUmJm89PWp1JiZ2JiZ2Lm5hbWUhPT1qdSYmKHd1P0h0KHAsIm5hbWUiLGp1KTooZD0hMCxoPWZ1bmN0aW9uKCl7cmV0dXJuIHgodix0aGlzKX0pKSxvKWlmKGM9e3ZhbHVlczpzKGp1KSxrZXlzOmk/aDpzKE91KSxlbnRyaWVzOnMoSXUpfSx1KWZvcihmIGluIGMpKHh1fHxkfHwhKGYgaW4gcCkpJiZkZShwLGYsY1tmXSk7ZWxzZSBIZSh7dGFyZ2V0OmUscHJvdG86ITAsZm9yY2VkOnh1fHxkfSxjKTtyZXR1cm4gcFtFdV0hPT1oJiZkZShwLEV1LGgse25hbWU6b30pLGZvW2VdPWgsY30sTXU9IkFycmF5IEl0ZXJhdG9yIixBdT1hZS5zZXQsUnU9YWUuZ2V0dGVyRm9yKE11KSxrdT1UdShBcnJheSwiQXJyYXkiLChmdW5jdGlvbih0LGUpe0F1KHRoaXMse3R5cGU6TXUsdGFyZ2V0Ol8odCksaW5kZXg6MCxraW5kOmV9KTt9KSwoZnVuY3Rpb24oKXt2YXIgdD1SdSh0aGlzKSxlPXQudGFyZ2V0LG49dC5raW5kLHI9dC5pbmRleCsrO3JldHVybiAhZXx8cj49ZS5sZW5ndGg/KHQudGFyZ2V0PXZvaWQgMCx7dmFsdWU6dm9pZCAwLGRvbmU6ITB9KToia2V5cyI9PW4/e3ZhbHVlOnIsZG9uZTohMX06InZhbHVlcyI9PW4/e3ZhbHVlOmVbcl0sZG9uZTohMX06e3ZhbHVlOltyLGVbcl1dLGRvbmU6ITF9fSksInZhbHVlcyIpO2ZvLkFyZ3VtZW50cz1mby5BcnJheSxPbigia2V5cyIpLE9uKCJ2YWx1ZXMiKSxPbigiZW50cmllcyIpO3ZhciBDdT1Bci5jaGFyQXQsTnU9IlN0cmluZyBJdGVyYXRvciIsTHU9YWUuc2V0LFZ1PWFlLmdldHRlckZvcihOdSk7VHUoU3RyaW5nLCJTdHJpbmciLChmdW5jdGlvbih0KXtMdSh0aGlzLHt0eXBlOk51LHN0cmluZzpKZSh0KSxpbmRleDowfSk7fSksKGZ1bmN0aW9uKCl7dmFyIHQsZT1WdSh0aGlzKSxuPWUuc3RyaW5nLHI9ZS5pbmRleDtyZXR1cm4gcj49bi5sZW5ndGg/e3ZhbHVlOnZvaWQgMCxkb25lOiEwfToodD1DdShuLHIpLGUuaW5kZXgrPXQubGVuZ3RoLHt2YWx1ZTp0LGRvbmU6ITF9KX0pKTt2YXIgRHU9ZnVuY3Rpb24odCxlLG4pe3ZhciByPU10KGUpO3IgaW4gdD8kdC5mKHQscixJKDAsbikpOnRbcl09bjt9LHp1PW0uQXJyYXksRnU9TWF0aC5tYXgsX3U9TWUuZiwkdT0ib2JqZWN0Ij09dHlwZW9mIHdpbmRvdyYmd2luZG93JiZPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcz9PYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh3aW5kb3cpOltdLEh1PWZ1bmN0aW9uKHQpe3RyeXtyZXR1cm4gX3UodCl9Y2F0Y2godCl7cmV0dXJuIGZ1bmN0aW9uKHQsZSxuKXtmb3IodmFyIHI9U2UodCksbz1tZShlLHIpLGk9bWUodm9pZCAwPT09bj9yOm4sciksdT16dShGdShpLW8sMCkpLGE9MDtvPGk7bysrLGErKylEdSh1LGEsdFtvXSk7cmV0dXJuIHUubGVuZ3RoPWEsdX0oJHUpfX0sQnU9e2Y6ZnVuY3Rpb24odCl7cmV0dXJuICR1JiYiV2luZG93Ij09Tih0KT9IdSh0KTpfdShfKHQpKX19LEd1PWIoKGZ1bmN0aW9uKCl7aWYoImZ1bmN0aW9uIj09dHlwZW9mIEFycmF5QnVmZmVyKXt2YXIgdD1uZXcgQXJyYXlCdWZmZXIoOCk7T2JqZWN0LmlzRXh0ZW5zaWJsZSh0KSYmT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsImEiLHt2YWx1ZTo4fSk7fX0pKSxXdT1PYmplY3QuaXNFeHRlbnNpYmxlLFV1PWIoKGZ1bmN0aW9uKCl7V3UoMSk7fSkpfHxHdT9mdW5jdGlvbih0KXtyZXR1cm4gISFIKHQpJiYoKCFHdXx8IkFycmF5QnVmZmVyIiE9Tih0KSkmJighV3V8fFd1KHQpKSl9Old1LHF1PSFiKChmdW5jdGlvbigpe3JldHVybiBPYmplY3QuaXNFeHRlbnNpYmxlKE9iamVjdC5wcmV2ZW50RXh0ZW5zaW9ucyh7fSkpfSkpLEt1PXYoKGZ1bmN0aW9uKHQpe3ZhciBlPSR0LmYsbj0hMSxyPXd0KCJtZXRhIiksbz0wLGk9ZnVuY3Rpb24odCl7ZSh0LHIse3ZhbHVlOntvYmplY3RJRDoiTyIrbysrLHdlYWtEYXRhOnt9fX0pO30sdT10LmV4cG9ydHM9e2VuYWJsZTpmdW5jdGlvbigpe3UuZW5hYmxlPWZ1bmN0aW9uKCl7fSxuPSEwO3ZhciB0PU1lLmYsZT1SKFtdLnNwbGljZSksbz17fTtvW3JdPTEsdChvKS5sZW5ndGgmJihNZS5mPWZ1bmN0aW9uKG4pe2Zvcih2YXIgbz10KG4pLGk9MCx1PW8ubGVuZ3RoO2k8dTtpKyspaWYob1tpXT09PXIpe2UobyxpLDEpO2JyZWFrfXJldHVybiBvfSxIZSh7dGFyZ2V0OiJPYmplY3QiLHN0YXQ6ITAsZm9yY2VkOiEwfSx7Z2V0T3duUHJvcGVydHlOYW1lczpCdS5mfSkpO30sZmFzdEtleTpmdW5jdGlvbih0LGUpe2lmKCFIKHQpKXJldHVybiAic3ltYm9sIj09dHlwZW9mIHQ/dDooInN0cmluZyI9PXR5cGVvZiB0PyJTIjoiUCIpK3Q7aWYoIXl0KHQscikpe2lmKCFVdSh0KSlyZXR1cm4gIkYiO2lmKCFlKXJldHVybiAiRSI7aSh0KTt9cmV0dXJuIHRbcl0ub2JqZWN0SUR9LGdldFdlYWtEYXRhOmZ1bmN0aW9uKHQsZSl7aWYoIXl0KHQscikpe2lmKCFVdSh0KSlyZXR1cm4gITA7aWYoIWUpcmV0dXJuICExO2kodCk7fXJldHVybiB0W3JdLndlYWtEYXRhfSxvbkZyZWV6ZTpmdW5jdGlvbih0KXtyZXR1cm4gcXUmJm4mJlV1KHQpJiYheXQodCxyKSYmaSh0KSx0fX07UXRbcl09ITA7fSkpLFh1PUt1LmdldFdlYWtEYXRhLFl1PWFlLnNldCxKdT1hZS5nZXR0ZXJGb3IsUXU9Qm4uZmluZCxadT1Cbi5maW5kSW5kZXgsdGE9UihbXS5zcGxpY2UpLGVhPTAsbmE9ZnVuY3Rpb24odCl7cmV0dXJuIHQuZnJvemVufHwodC5mcm96ZW49bmV3IHJhKX0scmE9ZnVuY3Rpb24oKXt0aGlzLmVudHJpZXM9W107fSxvYT1mdW5jdGlvbih0LGUpe3JldHVybiBRdSh0LmVudHJpZXMsKGZ1bmN0aW9uKHQpe3JldHVybiB0WzBdPT09ZX0pKX07cmEucHJvdG90eXBlPXtnZXQ6ZnVuY3Rpb24odCl7dmFyIGU9b2EodGhpcyx0KTtpZihlKXJldHVybiBlWzFdfSxoYXM6ZnVuY3Rpb24odCl7cmV0dXJuICEhb2EodGhpcyx0KX0sc2V0OmZ1bmN0aW9uKHQsZSl7dmFyIG49b2EodGhpcyx0KTtuP25bMV09ZTp0aGlzLmVudHJpZXMucHVzaChbdCxlXSk7fSxkZWxldGU6ZnVuY3Rpb24odCl7dmFyIGU9WnUodGhpcy5lbnRyaWVzLChmdW5jdGlvbihlKXtyZXR1cm4gZVswXT09PXR9KSk7cmV0dXJuIH5lJiZ0YSh0aGlzLmVudHJpZXMsZSwxKSwhIX5lfX07dmFyIGlhLHVhPXtnZXRDb25zdHJ1Y3RvcjpmdW5jdGlvbih0LGUsbixyKXt2YXIgbz10KChmdW5jdGlvbih0LG8pe2NvKHQsaSksWXUodCx7dHlwZTplLGlkOmVhKyssZnJvemVuOnZvaWQgMH0pLG51bGwhPW8mJndvKG8sdFtyXSx7dGhhdDp0LEFTX0VOVFJJRVM6bn0pO30pKSxpPW8ucHJvdG90eXBlLHU9SnUoZSksYT1mdW5jdGlvbih0LGUsbil7dmFyIHI9dSh0KSxvPVh1KHp0KGUpLCEwKTtyZXR1cm4gITA9PT1vP25hKHIpLnNldChlLG4pOm9bci5pZF09bix0fTtyZXR1cm4gWnIoaSx7ZGVsZXRlOmZ1bmN0aW9uKHQpe3ZhciBlPXUodGhpcyk7aWYoIUgodCkpcmV0dXJuICExO3ZhciBuPVh1KHQpO3JldHVybiAhMD09PW4/bmEoZSkuZGVsZXRlKHQpOm4mJnl0KG4sZS5pZCkmJmRlbGV0ZSBuW2UuaWRdfSxoYXM6ZnVuY3Rpb24odCl7dmFyIGU9dSh0aGlzKTtpZighSCh0KSlyZXR1cm4gITE7dmFyIG49WHUodCk7cmV0dXJuICEwPT09bj9uYShlKS5oYXModCk6biYmeXQobixlLmlkKX19KSxacihpLG4/e2dldDpmdW5jdGlvbih0KXt2YXIgZT11KHRoaXMpO2lmKEgodCkpe3ZhciBuPVh1KHQpO3JldHVybiAhMD09PW4/bmEoZSkuZ2V0KHQpOm4/bltlLmlkXTp2b2lkIDB9fSxzZXQ6ZnVuY3Rpb24odCxlKXtyZXR1cm4gYSh0aGlzLHQsZSl9fTp7YWRkOmZ1bmN0aW9uKHQpe3JldHVybiBhKHRoaXMsdCwhMCl9fSksb319LGFhPWFlLmVuZm9yY2UsY2E9IW0uQWN0aXZlWE9iamVjdCYmIkFjdGl2ZVhPYmplY3QiaW4gbSxmYT1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gdCh0aGlzLGFyZ3VtZW50cy5sZW5ndGg/YXJndW1lbnRzWzBdOnZvaWQgMCl9fSxzYT1mdW5jdGlvbih0LGUsbil7dmFyIHI9LTEhPT10LmluZGV4T2YoIk1hcCIpLG89LTEhPT10LmluZGV4T2YoIldlYWsiKSxpPXI/InNldCI6ImFkZCIsdT1tW3RdLGE9dSYmdS5wcm90b3R5cGUsYz11LGY9e30scz1mdW5jdGlvbih0KXt2YXIgZT1SKGFbdF0pO2RlKGEsdCwiYWRkIj09dD9mdW5jdGlvbih0KXtyZXR1cm4gZSh0aGlzLDA9PT10PzA6dCksdGhpc306ImRlbGV0ZSI9PXQ/ZnVuY3Rpb24odCl7cmV0dXJuICEobyYmIUgodCkpJiZlKHRoaXMsMD09PXQ/MDp0KX06ImdldCI9PXQ/ZnVuY3Rpb24odCl7cmV0dXJuIG8mJiFIKHQpP3ZvaWQgMDplKHRoaXMsMD09PXQ/MDp0KX06ImhhcyI9PXQ/ZnVuY3Rpb24odCl7cmV0dXJuICEobyYmIUgodCkpJiZlKHRoaXMsMD09PXQ/MDp0KX06ZnVuY3Rpb24odCxuKXtyZXR1cm4gZSh0aGlzLDA9PT10PzA6dCxuKSx0aGlzfSk7fTtpZihfZSh0LCEkKHUpfHwhKG98fGEuZm9yRWFjaCYmIWIoKGZ1bmN0aW9uKCl7KG5ldyB1KS5lbnRyaWVzKCkubmV4dCgpO30pKSkpKWM9bi5nZXRDb25zdHJ1Y3RvcihlLHQscixpKSxLdS5lbmFibGUoKTtlbHNlIGlmKF9lKHQsITApKXt2YXIgbD1uZXcgYyxkPWxbaV0obz97fTotMCwxKSE9bCxwPWIoKGZ1bmN0aW9uKCl7bC5oYXMoMSk7fSkpLHY9TW8oKGZ1bmN0aW9uKHQpe25ldyB1KHQpO30pKSxoPSFvJiZiKChmdW5jdGlvbigpe2Zvcih2YXIgdD1uZXcgdSxlPTU7ZS0tOyl0W2ldKGUsZSk7cmV0dXJuICF0LmhhcygtMCl9KSk7dnx8KChjPWUoKGZ1bmN0aW9uKHQsZSl7Y28odCxhKTt2YXIgbj1mdW5jdGlvbih0LGUsbil7dmFyIHIsbztyZXR1cm4gbm8mJiQocj1lLmNvbnN0cnVjdG9yKSYmciE9PW4mJkgobz1yLnByb3RvdHlwZSkmJm8hPT1uLnByb3RvdHlwZSYmbm8odCxvKSx0fShuZXcgdSx0LGMpO3JldHVybiBudWxsIT1lJiZ3byhlLG5baV0se3RoYXQ6bixBU19FTlRSSUVTOnJ9KSxufSkpKS5wcm90b3R5cGU9YSxhLmNvbnN0cnVjdG9yPWMpLChwfHxoKSYmKHMoImRlbGV0ZSIpLHMoImhhcyIpLHImJnMoImdldCIpKSwoaHx8ZCkmJnMoaSksbyYmYS5jbGVhciYmZGVsZXRlIGEuY2xlYXI7fXJldHVybiBmW3RdPWMsSGUoe2dsb2JhbDohMCxmb3JjZWQ6YyE9dX0sZiksaW8oYyx0KSxvfHxuLnNldFN0cm9uZyhjLHQsciksY30oIldlYWtNYXAiLGZhLHVhKTtpZihYdCYmY2Epe2lhPXVhLmdldENvbnN0cnVjdG9yKGZhLCJXZWFrTWFwIiwhMCksS3UuZW5hYmxlKCk7dmFyIGxhPXNhLnByb3RvdHlwZSxkYT1SKGxhLmRlbGV0ZSkscGE9UihsYS5oYXMpLHZhPVIobGEuZ2V0KSxoYT1SKGxhLnNldCk7WnIobGEse2RlbGV0ZTpmdW5jdGlvbih0KXtpZihIKHQpJiYhVXUodCkpe3ZhciBlPWFhKHRoaXMpO3JldHVybiBlLmZyb3plbnx8KGUuZnJvemVuPW5ldyBpYSksZGEodGhpcyx0KXx8ZS5mcm96ZW4uZGVsZXRlKHQpfXJldHVybiBkYSh0aGlzLHQpfSxoYXM6ZnVuY3Rpb24odCl7aWYoSCh0KSYmIVV1KHQpKXt2YXIgZT1hYSh0aGlzKTtyZXR1cm4gZS5mcm96ZW58fChlLmZyb3plbj1uZXcgaWEpLHBhKHRoaXMsdCl8fGUuZnJvemVuLmhhcyh0KX1yZXR1cm4gcGEodGhpcyx0KX0sZ2V0OmZ1bmN0aW9uKHQpe2lmKEgodCkmJiFVdSh0KSl7dmFyIGU9YWEodGhpcyk7cmV0dXJuIGUuZnJvemVufHwoZS5mcm96ZW49bmV3IGlhKSxwYSh0aGlzLHQpP3ZhKHRoaXMsdCk6ZS5mcm96ZW4uZ2V0KHQpfXJldHVybiB2YSh0aGlzLHQpfSxzZXQ6ZnVuY3Rpb24odCxlKXtpZihIKHQpJiYhVXUodCkpe3ZhciBuPWFhKHRoaXMpO24uZnJvemVufHwobi5mcm96ZW49bmV3IGlhKSxwYSh0aGlzLHQpP2hhKHRoaXMsdCxlKTpuLmZyb3plbi5zZXQodCxlKTt9ZWxzZSBoYSh0aGlzLHQsZSk7cmV0dXJuIHRoaXN9fSk7fXZhciB5YT17Q1NTUnVsZUxpc3Q6MCxDU1NTdHlsZURlY2xhcmF0aW9uOjAsQ1NTVmFsdWVMaXN0OjAsQ2xpZW50UmVjdExpc3Q6MCxET01SZWN0TGlzdDowLERPTVN0cmluZ0xpc3Q6MCxET01Ub2tlbkxpc3Q6MSxEYXRhVHJhbnNmZXJJdGVtTGlzdDowLEZpbGVMaXN0OjAsSFRNTEFsbENvbGxlY3Rpb246MCxIVE1MQ29sbGVjdGlvbjowLEhUTUxGb3JtRWxlbWVudDowLEhUTUxTZWxlY3RFbGVtZW50OjAsTWVkaWFMaXN0OjAsTWltZVR5cGVBcnJheTowLE5hbWVkTm9kZU1hcDowLE5vZGVMaXN0OjEsUGFpbnRSZXF1ZXN0TGlzdDowLFBsdWdpbjowLFBsdWdpbkFycmF5OjAsU1ZHTGVuZ3RoTGlzdDowLFNWR051bWJlckxpc3Q6MCxTVkdQYXRoU2VnTGlzdDowLFNWR1BvaW50TGlzdDowLFNWR1N0cmluZ0xpc3Q6MCxTVkdUcmFuc2Zvcm1MaXN0OjAsU291cmNlQnVmZmVyTGlzdDowLFN0eWxlU2hlZXRMaXN0OjAsVGV4dFRyYWNrQ3VlTGlzdDowLFRleHRUcmFja0xpc3Q6MCxUb3VjaExpc3Q6MH0sZ2E9a3QoInNwYW4iKS5jbGFzc0xpc3QsbWE9Z2EmJmdhLmNvbnN0cnVjdG9yJiZnYS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUsYmE9bWE9PT1PYmplY3QucHJvdG90eXBlP3ZvaWQgMDptYSx3YT1qdCgiaXRlcmF0b3IiKSxTYT1qdCgidG9TdHJpbmdUYWciKSx4YT1rdS52YWx1ZXMsRWE9ZnVuY3Rpb24odCxlKXtpZih0KXtpZih0W3dhXSE9PXhhKXRyeXtIdCh0LHdhLHhhKTt9Y2F0Y2goZSl7dFt3YV09eGE7fWlmKHRbU2FdfHxIdCh0LFNhLGUpLHlhW2VdKWZvcih2YXIgbiBpbiBrdSlpZih0W25dIT09a3Vbbl0pdHJ5e0h0KHQsbixrdVtuXSk7fWNhdGNoKGUpe3Rbbl09a3Vbbl07fX19O2Zvcih2YXIgT2EgaW4geWEpRWEobVtPYV0mJm1bT2FdLnByb3RvdHlwZSxPYSk7RWEoYmEsIkRPTVRva2VuTGlzdCIpO3ZhciBqYT1sZS5FWElTVFMsSWE9JHQuZixQYT1GdW5jdGlvbi5wcm90b3R5cGUsVGE9UihQYS50b1N0cmluZyksTWE9L2Z1bmN0aW9uXGIoPzpcc3xcL1wqW1xTXHNdKj9cKlwvfFwvXC9bXlxuXHJdKltcblxyXSspKihbXlxzKC9dKikvLEFhPVIoTWEuZXhlYyk7dyYmIWphJiZJYShQYSwibmFtZSIse2NvbmZpZ3VyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXt0cnl7cmV0dXJuIEFhKE1hLFRhKHRoaXMpKVsxXX1jYXRjaCh0KXtyZXR1cm4gIiJ9fX0pO3ZhciBSYT1qdCgic3BlY2llcyIpLGthPWZ1bmN0aW9uKHQpe3JldHVybiBKPj01MXx8IWIoKGZ1bmN0aW9uKCl7dmFyIGU9W107cmV0dXJuIChlLmNvbnN0cnVjdG9yPXt9KVtSYV09ZnVuY3Rpb24oKXtyZXR1cm4ge2ZvbzoxfX0sMSE9PWVbdF0oQm9vbGVhbikuZm9vfSkpfSgic2xpY2UiKSxDYT1qdCgic3BlY2llcyIpLE5hPW0uQXJyYXksTGE9TWF0aC5tYXg7ZnVuY3Rpb24gVmEodCl7cmV0dXJuIHQuZ2V0TWVudUNvbmZpZygidXBsb2FkVmlkZW8iKX1IZSh7dGFyZ2V0OiJBcnJheSIscHJvdG86ITAsZm9yY2VkOiFrYX0se3NsaWNlOmZ1bmN0aW9uKHQsZSl7dmFyIG4scixvLGk9Xyh0aGlzKSx1PVNlKGkpLGE9bWUodCx1KSxjPW1lKHZvaWQgMD09PWU/dTplLHUpO2lmKE1uKGkpJiYobj1pLmNvbnN0cnVjdG9yLChEbihuKSYmKG49PT1OYXx8TW4obi5wcm90b3R5cGUpKXx8SChuKSYmbnVsbD09PShuPW5bQ2FdKSkmJihuPXZvaWQgMCksbj09PU5hfHx2b2lkIDA9PT1uKSlyZXR1cm4gQ28oaSxhLGMpO2ZvcihyPW5ldyh2b2lkIDA9PT1uP05hOm4pKExhKGMtYSwwKSksbz0wO2E8YzthKyssbysrKWEgaW4gaSYmRHUocixvLGlbYV0pO3JldHVybiByLmxlbmd0aD1vLHJ9fSk7dmFyIERhPW5ldyBXZWFrTWFwO2Z1bmN0aW9uIHphKGUsbil7cmV0dXJuIGModGhpcyx2b2lkIDAsdm9pZCAwLChmdW5jdGlvbigpe3ZhciByLG8saSx1O3JldHVybiBmKHRoaXMsKGZ1bmN0aW9uKGMpe3N3aXRjaChjLmxhYmVsKXtjYXNlIDA6cmV0dXJuIHI9ZnVuY3Rpb24oZSl7dmFyIG49RGEuZ2V0KGUpO2lmKG51bGwhPW4pcmV0dXJuIG47dmFyIHI9VmEoZSksbz1yLm9uU3VjY2VzcyxpPXIub25Qcm9ncmVzcyx1PXIub25GYWlsZWQsYz1yLmN1c3RvbUluc2VydCxmPXIub25FcnJvcjtyZXR1cm4gbj10LmNyZWF0ZVVwbG9hZGVyKGEoYSh7fSxyKSx7b25Qcm9ncmVzczpmdW5jdGlvbih0KXtlLnNob3dQcm9ncmVzc0Jhcih0KSxpJiZpKHQpO30sb25TdWNjZXNzOmZ1bmN0aW9uKHQsbil7aWYoYylyZXR1cm4gYyhuLChmdW5jdGlvbih0LG4pe3JldHVybiBaaShlLHQsbil9KSksdm9pZCBvKHQsbik7dmFyIHI9bi5lcnJubyxpPXZvaWQgMD09PXI/MTpyLGE9bi5kYXRhLGY9dm9pZCAwPT09YT97fTphO2lmKDA9PT1pKXt2YXIgcz1mLnVybCxsPXZvaWQgMD09PXM/IiI6cyxkPWYucG9zdGVyO1ppKGUsbCx2b2lkIDA9PT1kPyIiOmQpLG8odCxuKTt9ZWxzZSB1KHQsbik7fSxvbkVycm9yOmZ1bmN0aW9uKHQsZSxuKXtmKHQsZSxuKTt9fSkpLERhLnNldChlLG4pLG59KGUpLG89bi5uYW1lLGk9bi50eXBlLHU9bi5zaXplLHIuYWRkRmlsZSh7bmFtZTpvLHR5cGU6aSxzaXplOnUsZGF0YTpufSksWzQsci51cGxvYWQoKV07Y2FzZSAxOnJldHVybiBjLnNlbnQoKSxbMl19fSkpfSkpfXZhciBGYT1mdW5jdGlvbigpe2Z1bmN0aW9uIG4oKXt0aGlzLnRpdGxlPXQudCgidmlkZW9Nb2R1bGUudXBsb2FkVmlkZW8iKSx0aGlzLmljb25Tdmc9Jzxzdmcgdmlld0JveD0iMCAwIDEwNTYgMTAyNCI+PHBhdGggZD0iTTgwNS45MDIyNjEgNTIxLjgxOTg4MmEyNTEuNDQxNDUyIDI1MS40NDE0NTIgMCAwIDAtMjUxLjAxMTk3MiAyNDYuNjAwMDMzIDI1MS4wNTEwMTUgMjUxLjA1MTAxNSAwIDEgMCA1MDIuMDIzOTQ0IDguODIzODc3IDI1My4yMzc0NjMgMjUzLjIzNzQ2MyAwIDAgMC0yNTEuMDExOTcyLTI1NS40MjM5MXogbTU5LjQ2MzU2MSAyNDAuMDAxNjQ3djEyOS44OTg0MDNoLTExNi43MDE2MzF2LTEyOS44OTg0MDNoLTQ0LjA0MTI5OGwxMDEuMjc5MzY4LTEwMy41MDQ4NTkgMTAxLjI3OTM2OCAxMDMuNTA0ODU5eiIgcC1pZD0iNjgwMiI+PC9wYXRoPjxwYXRoIGQ9Ik03ODguMjU0NTA3IDAuMDAwNzgxSDk5LjA5NDA5MkE5OC42NjM0MzkgOTguNjYzNDM5IDAgMCAwIDAuMDAxMTcxIDk5LjA5MzcwMXY1OTAuMDY3NDk1YTk4LjY2MzQzOSA5OC42NjM0MzkgMCAwIDAgOTkuMDkyOTIxIDk5LjA5MjkyMWg0MTEuNzU0OWEyNjYuNDM0MjM1IDI2Ni40MzQyMzUgMCAwIDEtMi4xODY0NDgtNDEuODE1ODA3IDI3NS44NDM3NjcgMjc1Ljg0Mzc2NyAwIDAgMSAyNzUuMTgwMDI0LTI3MC43MjkwNDIgMjcwLjY1MDk1NSAyNzAuNjUwOTU1IDAgMCAxIDEwMy41MDQ4NTkgMTkuODM0MjAxVjk5LjA5MzcwMUExMDEuNTEzNjMgMTAxLjUxMzYzIDAgMCAwIDc4OC4yNTQ1MDcgMC4wMDA3ODF6TTI5NS4wNTQ0NDEgNjQwLjc0NzAwNFYxNDcuNTA3ODk0bDM5NC4xNDYxODkgMjQ2LjYwMDAzM3oiPjwvcGF0aD48L3N2Zz4nLHRoaXMudGFnPSJidXR0b24iO31yZXR1cm4gbi5wcm90b3R5cGUuZ2V0VmFsdWU9ZnVuY3Rpb24odCl7cmV0dXJuICIifSxuLnByb3RvdHlwZS5pc0FjdGl2ZT1mdW5jdGlvbih0KXtyZXR1cm4gITF9LG4ucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24odCxlKXt2YXIgbj10aGlzLmdldE1lbnVDb25maWcodCkscj1uLmFsbG93ZWRGaWxlVHlwZXMsbz12b2lkIDA9PT1yP1tdOnIsaT1uLmN1c3RvbUJyb3dzZUFuZFVwbG9hZDtpZihpKWkoKGZ1bmN0aW9uKGUsbil7cmV0dXJuIFppKHQsZSxuKX0pKTtlbHNlIHt2YXIgYT0iIjtvLmxlbmd0aD4wJiYoYT0nYWNjZXB0PSInK28uam9pbigiLCAiKSsnIicpO3ZhciBzPXUuZGVmYXVsdCgiYm9keSIpLGw9dS5kZWZhdWx0KCc8aW5wdXQgdHlwZT0iZmlsZSIgJythKyIgbXVsdGlwbGUvPiIpO2wuaGlkZSgpLHMuYXBwZW5kKGwpLGwuY2xpY2soKSxsLm9uKCJjaGFuZ2UiLChmdW5jdGlvbigpe3ZhciBlPWxbMF0uZmlsZXM7IWZ1bmN0aW9uKHQsZSl7dmFyIG4scjtjKHRoaXMsdm9pZCAwLHZvaWQgMCwoZnVuY3Rpb24oKXt2YXIgbyxpLHUsYSxjLHM7cmV0dXJuIGYodGhpcywoZnVuY3Rpb24oZil7c3dpdGNoKGYubGFiZWwpe2Nhc2UgMDppZihudWxsPT1lKXJldHVybiBbMl07bz1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChlKSxpPVZhKHQpLmN1c3RvbVVwbG9hZCxmLmxhYmVsPTE7Y2FzZSAxOmYudHJ5cy5wdXNoKFsxLDksMTAsMTVdKSx1PWQobyksZi5sYWJlbD0yO2Nhc2UgMjpyZXR1cm4gWzQsdS5uZXh0KCldO2Nhc2UgMzpyZXR1cm4gKGE9Zi5zZW50KCkpLmRvbmU/WzMsOF06KGM9YS52YWx1ZSxpP1s0LGkoYywoZnVuY3Rpb24oZSxuKXtyZXR1cm4gWmkodCxlLG4pfSkpXTpbMyw1XSk7Y2FzZSA0OnJldHVybiBmLnNlbnQoKSxbMyw3XTtjYXNlIDU6cmV0dXJuIFs0LHphKHQsYyldO2Nhc2UgNjpmLnNlbnQoKSxmLmxhYmVsPTc7Y2FzZSA3OnJldHVybiBbMywyXTtjYXNlIDg6cmV0dXJuIFszLDE1XTtjYXNlIDk6cmV0dXJuIHM9Zi5zZW50KCksbj17ZXJyb3I6c30sWzMsMTVdO2Nhc2UgMTA6cmV0dXJuIGYudHJ5cy5wdXNoKFsxMCwsMTMsMTRdKSxhJiYhYS5kb25lJiYocj11LnJldHVybik/WzQsci5jYWxsKHUpXTpbMywxMl07Y2FzZSAxMTpmLnNlbnQoKSxmLmxhYmVsPTEyO2Nhc2UgMTI6cmV0dXJuIFszLDE0XTtjYXNlIDEzOmlmKG4pdGhyb3cgbi5lcnJvcjtyZXR1cm4gWzddO2Nhc2UgMTQ6cmV0dXJuIFs3XTtjYXNlIDE1OnJldHVybiBbMl19fSkpfSkpO30odCxlKTt9KSk7fX0sbi5wcm90b3R5cGUuaXNEaXNhYmxlZD1mdW5jdGlvbihuKXt2YXIgcj1uLnNlbGVjdGlvbjtyZXR1cm4gbnVsbD09cnx8KCFlLlJhbmdlLmlzQ29sbGFwc2VkKHIpfHwhIXQuRG9tRWRpdG9yLmdldFNlbGVjdGVkRWxlbXMobikuc29tZSgoZnVuY3Rpb24oZSl7dmFyIHI9dC5Eb21FZGl0b3IuZ2V0Tm9kZVR5cGUoZSk7cmV0dXJuICJwcmUiPT09cnx8KCJsaXN0LWl0ZW0iPT09cnx8ISFuLmlzVm9pZChlKSl9KSkpfSxuLnByb3RvdHlwZS5nZXRNZW51Q29uZmlnPWZ1bmN0aW9uKHQpe3JldHVybiB0LmdldE1lbnVDb25maWcoInVwbG9hZFZpZGVvIil9LG59KCksX2E9bGUuUFJPUEVSLCRhPSJ0b1N0cmluZyIsSGE9UmVnRXhwLnByb3RvdHlwZSxCYT1IYS50b1N0cmluZyxHYT1SKFFuKSxXYT1iKChmdW5jdGlvbigpe3JldHVybiAiL2EvYiIhPUJhLmNhbGwoe3NvdXJjZToiYSIsZmxhZ3M6ImIifSl9KSksVWE9X2EmJkJhLm5hbWUhPSRhO2Z1bmN0aW9uIHFhKCl7cmV0dXJuIEpyKCJ3LWUtaW5zZXJ0LXZpZGVvIil9KFdhfHxVYSkmJmRlKFJlZ0V4cC5wcm90b3R5cGUsJGEsKGZ1bmN0aW9uKCl7dmFyIHQ9enQodGhpcyksZT1KZSh0LnNvdXJjZSksbj10LmZsYWdzO3JldHVybiAiLyIrZSsiLyIrSmUodm9pZCAwPT09biYmVyhIYSx0KSYmISgiZmxhZ3MiaW4gSGEpP0dhKHQpOm4pfSkse3Vuc2FmZTohMH0pO3ZhciBLYT1mdW5jdGlvbigpe2Z1bmN0aW9uIG4oKXt0aGlzLnRpdGxlPXQudCgidmlkZW9Nb2R1bGUuZWRpdFNpemUiKSx0aGlzLnRhZz0iYnV0dG9uIix0aGlzLnNob3dNb2RhbD0hMCx0aGlzLm1vZGFsV2lkdGg9MzIwLHRoaXMuJGNvbnRlbnQ9bnVsbCx0aGlzLndpZHRoSW5wdXRJZD1xYSgpLHRoaXMuaGVpZ2h0SW5wdXRJZD1xYSgpLHRoaXMuYnV0dG9uSWQ9cWEoKTt9cmV0dXJuIG4ucHJvdG90eXBlLmdldFNlbGVjdGVkVmlkZW9Ob2RlPWZ1bmN0aW9uKGUpe3JldHVybiB0LkRvbUVkaXRvci5nZXRTZWxlY3RlZE5vZGVCeVR5cGUoZSwidmlkZW8iKX0sbi5wcm90b3R5cGUuZ2V0VmFsdWU9ZnVuY3Rpb24odCl7cmV0dXJuICIifSxuLnByb3RvdHlwZS5pc0FjdGl2ZT1mdW5jdGlvbih0KXtyZXR1cm4gITF9LG4ucHJvdG90eXBlLmV4ZWM9ZnVuY3Rpb24odCxlKXt9LG4ucHJvdG90eXBlLmlzRGlzYWJsZWQ9ZnVuY3Rpb24odCl7cmV0dXJuIG51bGw9PXQuc2VsZWN0aW9ufHxudWxsPT10aGlzLmdldFNlbGVjdGVkVmlkZW9Ob2RlKHQpfSxuLnByb3RvdHlwZS5nZXRNb2RhbFBvc2l0aW9uTm9kZT1mdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5nZXRTZWxlY3RlZFZpZGVvTm9kZSh0KX0sbi5wcm90b3R5cGUuZ2V0TW9kYWxDb250ZW50RWxlbT1mdW5jdGlvbihuKXt2YXIgcj10aGlzLG89ci53aWR0aElucHV0SWQsaT1yLmhlaWdodElucHV0SWQsYT1yLmJ1dHRvbklkLGM9bCh0Lmdlbk1vZGFsSW5wdXRFbGVtcyh0LnQoInZpZGVvTW9kdWxlLndpZHRoIiksbywiYXV0byIpLDIpLGY9Y1swXSxzPWNbMV0sZD11LmRlZmF1bHQocykscD1sKHQuZ2VuTW9kYWxJbnB1dEVsZW1zKHQudCgidmlkZW9Nb2R1bGUuaGVpZ2h0IiksaSwiYXV0byIpLDIpLHY9cFswXSxoPXBbMV0seT11LmRlZmF1bHQoaCksZz1sKHQuZ2VuTW9kYWxCdXR0b25FbGVtcyhhLHQudCgidmlkZW9Nb2R1bGUub2siKSksMSlbMF07aWYobnVsbD09dGhpcy4kY29udGVudCl7dmFyIG09dS5kZWZhdWx0KCI8ZGl2PjwvZGl2PiIpO20ub24oImNsaWNrIiwiIyIrYSwoZnVuY3Rpb24ocil7ci5wcmV2ZW50RGVmYXVsdCgpO3ZhciB1PW0uZmluZCgiIyIrbykudmFsKCkudHJpbSgpLGE9bS5maW5kKCIjIitpKS52YWwoKS50cmltKCksYz1wYXJzZUludCh1KSxmPXBhcnNlSW50KGEpLHM9Yz9jLnRvU3RyaW5nKCk6ImF1dG8iLGw9Zj9mLnRvU3RyaW5nKCk6ImF1dG8iO24ucmVzdG9yZVNlbGVjdGlvbigpLGUuVHJhbnNmb3Jtcy5zZXROb2RlcyhuLHt3aWR0aDpzLGhlaWdodDpsfSx7bWF0Y2g6ZnVuY3Rpb24oZSl7cmV0dXJuIHQuRG9tRWRpdG9yLmNoZWNrTm9kZVR5cGUoZSwidmlkZW8iKX19KSxuLmhpZGVQYW5lbE9yTW9kYWwoKTt9KSksdGhpcy4kY29udGVudD1tO312YXIgYj10aGlzLiRjb250ZW50O2IuZW1wdHkoKSxiLmFwcGVuZChmKSxiLmFwcGVuZCh2KSxiLmFwcGVuZChnKTt2YXIgdz10aGlzLmdldFNlbGVjdGVkVmlkZW9Ob2RlKG4pO2lmKG51bGw9PXcpcmV0dXJuIGJbMF07dmFyIFM9dy53aWR0aCx4PXZvaWQgMD09PVM/ImF1dG8iOlMsRT13LmhlaWdodCxPPXZvaWQgMD09PUU/ImF1dG8iOkU7cmV0dXJuIGQudmFsKHgpLHkudmFsKE8pLHNldFRpbWVvdXQoKGZ1bmN0aW9uKCl7ZC5mb2N1cygpO30pKSxiWzBdfSxufSgpO3ZhciBYYT17cmVuZGVyRWxlbXM6W3NuXSxlbGVtc1RvSHRtbDpbZG5dLHByZVBhcnNlSHRtbDpbSW5dLHBhcnNlRWxlbXNIdG1sOltKbl0sbWVudXM6W3trZXk6Imluc2VydFZpZGVvIixmYWN0b3J5OmZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBldX0sY29uZmlnOntvbkluc2VydGVkVmlkZW86ZnVuY3Rpb24odCl7fSxjaGVja1ZpZGVvOmZ1bmN0aW9uKHQsZSl7cmV0dXJuICEwfSxwYXJzZVZpZGVvU3JjOmZ1bmN0aW9uKHQpe3JldHVybiB0fX19LHtrZXk6InVwbG9hZFZpZGVvIixmYWN0b3J5OmZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBGYX0sY29uZmlnOntzZXJ2ZXI6IiIsZmllbGROYW1lOiJ3YW5nZWRpdG9yLXVwbG9hZGVkLXZpZGVvIixtYXhGaWxlU2l6ZToxMDQ4NTc2MCxtYXhOdW1iZXJPZkZpbGVzOjUsYWxsb3dlZEZpbGVUeXBlczpbInZpZGVvLyoiXSxtZXRhOnt9LG1ldGFXaXRoVXJsOiExLHdpdGhDcmVkZW50aWFsczohMSx0aW1lb3V0OjNlNCxvbkJlZm9yZVVwbG9hZDpmdW5jdGlvbih0KXtyZXR1cm4gdH0sb25Qcm9ncmVzczpmdW5jdGlvbih0KXt9LG9uU3VjY2VzczpmdW5jdGlvbih0LGUpe30sb25GYWlsZWQ6ZnVuY3Rpb24odCxlKXtjb25zb2xlLmVycm9yKCInIit0Lm5hbWUrIicgdXBsb2FkIGZhaWxlZCIsZSk7fSxvbkVycm9yOmZ1bmN0aW9uKHQsZSxuKXtjb25zb2xlLmVycm9yKCInIit0Lm5hbWUrIiB1cGxvYWQgZXJyb3IiLGUsbik7fX19LHtrZXk6ImVkaXRWaWRlb1NpemUiLGZhY3Rvcnk6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IEthfX1dLGVkaXRvclBsdWdpbjpmdW5jdGlvbihuKXt2YXIgcj1uLmlzVm9pZCxvPW4ubm9ybWFsaXplTm9kZSxpPW47cmV0dXJuIGkuaXNWb2lkPWZ1bmN0aW9uKHQpe3JldHVybiAidmlkZW8iPT09dC50eXBlfHxyKHQpfSxpLm5vcm1hbGl6ZU5vZGU9ZnVuY3Rpb24obil7dmFyIHI9bChuLDIpLHU9clswXSxhPXJbMV07InZpZGVvIj09PXQuRG9tRWRpdG9yLmdldE5vZGVUeXBlKHUpJiYodC5Eb21FZGl0b3IuaXNMYXN0Tm9kZShpLHUpJiZlLlRyYW5zZm9ybXMuaW5zZXJ0Tm9kZXMoaSx0LkRvbUVkaXRvci5nZW5FbXB0eVBhcmFncmFwaCgpLHthdDpbYVswXSsxXX0pKTtyZXR1cm4gbyhbdSxhXSl9LGl9fTtyZXR1cm4gWGF9KSk7CgogIH0pOwoKICB2YXIgZGlzdCQxID0gY3JlYXRlQ29tbW9uanNNb2R1bGUkMShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgIWZ1bmN0aW9uKHQsZSl7bW9kdWxlLmV4cG9ydHM9ZShkaXN0JDYsZGlzdCQ1LHJlcXVpcmUkJDEpO30oY29tbW9uanNHbG9iYWwsKGZ1bmN0aW9uKHQsZSxuKXtmdW5jdGlvbiByKHQpe3JldHVybiB0JiYib2JqZWN0Ij09dHlwZW9mIHQmJiJkZWZhdWx0ImluIHQ/dDp7ZGVmYXVsdDp0fX12YXIgbz1yKG4pO3QuaTE4bkFkZFJlc291cmNlcygiZW4iLHt1cGxvYWRJbWdNb2R1bGU6e3VwbG9hZEltYWdlOiJVcGxvYWQgSW1hZ2UiLHVwbG9hZEVycm9yOiJ7e2ZpbGVOYW1lfX0gdXBsb2FkIGVycm9yIn19KSx0LmkxOG5BZGRSZXNvdXJjZXMoInpoLUNOIix7dXBsb2FkSW1nTW9kdWxlOnt1cGxvYWRJbWFnZToi5LiK5Lyg5Zu+54mHIix1cGxvYWRFcnJvcjoie3tmaWxlTmFtZX19IOS4iuS8oOWHuumUmSJ9fSk7dmFyIGk9InVuZGVmaW5lZCIhPXR5cGVvZiBnbG9iYWxUaGlzP2dsb2JhbFRoaXM6InVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3c/d2luZG93OiJ1bmRlZmluZWQiIT10eXBlb2YgY29tbW9uanNHbG9iYWw/Y29tbW9uanNHbG9iYWw6InVuZGVmaW5lZCIhPXR5cGVvZiBzZWxmP3NlbGY6e307ZnVuY3Rpb24gdSh0KXt2YXIgZT17ZXhwb3J0czp7fX07cmV0dXJuIHQoZSxlLmV4cG9ydHMpLGUuZXhwb3J0c312YXIgYSxjLGY9ZnVuY3Rpb24odCl7cmV0dXJuIHQmJnQuTWF0aD09TWF0aCYmdH0scz1mKCJvYmplY3QiPT10eXBlb2YgZ2xvYmFsVGhpcyYmZ2xvYmFsVGhpcyl8fGYoIm9iamVjdCI9PXR5cGVvZiB3aW5kb3cmJndpbmRvdyl8fGYoIm9iamVjdCI9PXR5cGVvZiBzZWxmJiZzZWxmKXx8Zigib2JqZWN0Ij09dHlwZW9mIGkmJmkpfHxmdW5jdGlvbigpe3JldHVybiB0aGlzfSgpfHxGdW5jdGlvbigicmV0dXJuIHRoaXMiKSgpLGw9ZnVuY3Rpb24odCl7dHJ5e3JldHVybiAhIXQoKX1jYXRjaCh0KXtyZXR1cm4gITB9fSxwPSFsKChmdW5jdGlvbigpe3JldHVybiA3IT1PYmplY3QuZGVmaW5lUHJvcGVydHkoe30sMSx7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIDd9fSlbMV19KSksZD1GdW5jdGlvbi5wcm90b3R5cGUuY2FsbCx2PWQuYmluZD9kLmJpbmQoZCk6ZnVuY3Rpb24oKXtyZXR1cm4gZC5hcHBseShkLGFyZ3VtZW50cyl9LGg9e30ucHJvcGVydHlJc0VudW1lcmFibGUseT1PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLGc9e2Y6eSYmIWguY2FsbCh7MToyfSwxKT9mdW5jdGlvbih0KXt2YXIgZT15KHRoaXMsdCk7cmV0dXJuICEhZSYmZS5lbnVtZXJhYmxlfTpofSxtPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIHtlbnVtZXJhYmxlOiEoMSZ0KSxjb25maWd1cmFibGU6ISgyJnQpLHdyaXRhYmxlOiEoNCZ0KSx2YWx1ZTplfX0sYj1GdW5jdGlvbi5wcm90b3R5cGUsdz1iLmJpbmQseD1iLmNhbGwsUz13JiZ3LmJpbmQoeCksTz13P2Z1bmN0aW9uKHQpe3JldHVybiB0JiZTKHgsdCl9OmZ1bmN0aW9uKHQpe3JldHVybiB0JiZmdW5jdGlvbigpe3JldHVybiB4LmFwcGx5KHQsYXJndW1lbnRzKX19LEU9Tyh7fS50b1N0cmluZyksaj1PKCIiLnNsaWNlKSxJPWZ1bmN0aW9uKHQpe3JldHVybiBqKEUodCksOCwtMSl9LFQ9cy5PYmplY3QsQT1PKCIiLnNwbGl0KSxQPWwoKGZ1bmN0aW9uKCl7cmV0dXJuICFUKCJ6IikucHJvcGVydHlJc0VudW1lcmFibGUoMCl9KSk/ZnVuY3Rpb24odCl7cmV0dXJuICJTdHJpbmciPT1JKHQpP0EodCwiIik6VCh0KX06VCxSPXMuVHlwZUVycm9yLE09ZnVuY3Rpb24odCl7aWYobnVsbD09dCl0aHJvdyBSKCJDYW4ndCBjYWxsIG1ldGhvZCBvbiAiK3QpO3JldHVybiB0fSxrPWZ1bmN0aW9uKHQpe3JldHVybiBQKE0odCkpfSxMPWZ1bmN0aW9uKHQpe3JldHVybiAiZnVuY3Rpb24iPT10eXBlb2YgdH0sRj1mdW5jdGlvbih0KXtyZXR1cm4gIm9iamVjdCI9PXR5cGVvZiB0P251bGwhPT10OkwodCl9LEM9ZnVuY3Rpb24odCl7cmV0dXJuIEwodCk/dDp2b2lkIDB9LE49ZnVuY3Rpb24odCxlKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aDwyP0Moc1t0XSk6c1t0XSYmc1t0XVtlXX0sej1PKHt9LmlzUHJvdG90eXBlT2YpLF89TigibmF2aWdhdG9yIiwidXNlckFnZW50Iil8fCIiLEQ9cy5wcm9jZXNzLFU9cy5EZW5vLEc9RCYmRC52ZXJzaW9uc3x8VSYmVS52ZXJzaW9uLEI9RyYmRy52ODtCJiYoYz0oYT1CLnNwbGl0KCIuIikpWzBdPjAmJmFbMF08ND8xOisoYVswXSthWzFdKSksIWMmJl8mJighKGE9Xy5tYXRjaCgvRWRnZVwvKFxkKykvKSl8fGFbMV0+PTc0KSYmKGE9Xy5tYXRjaCgvQ2hyb21lXC8oXGQrKS8pKSYmKGM9K2FbMV0pO3ZhciBXPWMsVj0hIU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMmJiFsKChmdW5jdGlvbigpe3ZhciB0PVN5bWJvbCgpO3JldHVybiAhU3RyaW5nKHQpfHwhKE9iamVjdCh0KWluc3RhbmNlb2YgU3ltYm9sKXx8IVN5bWJvbC5zaGFtJiZXJiZXPDQxfSkpLEg9ViYmIVN5bWJvbC5zaGFtJiYic3ltYm9sIj09dHlwZW9mIFN5bWJvbC5pdGVyYXRvcixxPXMuT2JqZWN0LEs9SD9mdW5jdGlvbih0KXtyZXR1cm4gInN5bWJvbCI9PXR5cGVvZiB0fTpmdW5jdGlvbih0KXt2YXIgZT1OKCJTeW1ib2wiKTtyZXR1cm4gTChlKSYmeihlLnByb3RvdHlwZSxxKHQpKX0sWT1zLlN0cmluZyxYPWZ1bmN0aW9uKHQpe3RyeXtyZXR1cm4gWSh0KX1jYXRjaCh0KXtyZXR1cm4gIk9iamVjdCJ9fSwkPXMuVHlwZUVycm9yLEo9ZnVuY3Rpb24odCl7aWYoTCh0KSlyZXR1cm4gdDt0aHJvdyAkKFgodCkrIiBpcyBub3QgYSBmdW5jdGlvbiIpfSxRPWZ1bmN0aW9uKHQsZSl7dmFyIG49dFtlXTtyZXR1cm4gbnVsbD09bj92b2lkIDA6SihuKX0sWj1zLlR5cGVFcnJvcix0dD1PYmplY3QuZGVmaW5lUHJvcGVydHksZXQ9ZnVuY3Rpb24odCxlKXt0cnl7dHQocyx0LHt2YWx1ZTplLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMH0pO31jYXRjaChuKXtzW3RdPWU7fXJldHVybiBlfSxudD0iX19jb3JlLWpzX3NoYXJlZF9fIixydD1zW250XXx8ZXQobnQse30pLG90PXUoKGZ1bmN0aW9uKHQpeyh0LmV4cG9ydHM9ZnVuY3Rpb24odCxlKXtyZXR1cm4gcnRbdF18fChydFt0XT12b2lkIDAhPT1lP2U6e30pfSkoInZlcnNpb25zIixbXSkucHVzaCh7dmVyc2lvbjoiMy4xOS4zIixtb2RlOiJnbG9iYWwiLGNvcHlyaWdodDoiwqkgMjAyMSBEZW5pcyBQdXNoa2FyZXYgKHpsb2lyb2NrLnJ1KSJ9KTt9KSksaXQ9cy5PYmplY3QsdXQ9ZnVuY3Rpb24odCl7cmV0dXJuIGl0KE0odCkpfSxhdD1PKHt9Lmhhc093blByb3BlcnR5KSxjdD1PYmplY3QuaGFzT3dufHxmdW5jdGlvbih0LGUpe3JldHVybiBhdCh1dCh0KSxlKX0sZnQ9MCxzdD1NYXRoLnJhbmRvbSgpLGx0PU8oMS4udG9TdHJpbmcpLHB0PWZ1bmN0aW9uKHQpe3JldHVybiAiU3ltYm9sKCIrKHZvaWQgMD09PXQ/IiI6dCkrIilfIitsdCgrK2Z0K3N0LDM2KX0sZHQ9b3QoIndrcyIpLHZ0PXMuU3ltYm9sLGh0PXZ0JiZ2dC5mb3IseXQ9SD92dDp2dCYmdnQud2l0aG91dFNldHRlcnx8cHQsZ3Q9ZnVuY3Rpb24odCl7aWYoIWN0KGR0LHQpfHwhViYmInN0cmluZyIhPXR5cGVvZiBkdFt0XSl7dmFyIGU9IlN5bWJvbC4iK3Q7ViYmY3QodnQsdCk/ZHRbdF09dnRbdF06ZHRbdF09SCYmaHQ/aHQoZSk6eXQoZSk7fXJldHVybiBkdFt0XX0sbXQ9cy5UeXBlRXJyb3IsYnQ9Z3QoInRvUHJpbWl0aXZlIiksd3Q9ZnVuY3Rpb24odCxlKXtpZighRih0KXx8Syh0KSlyZXR1cm4gdDt2YXIgbixyPVEodCxidCk7aWYocil7aWYodm9pZCAwPT09ZSYmKGU9ImRlZmF1bHQiKSxuPXYocix0LGUpLCFGKG4pfHxLKG4pKXJldHVybiBuO3Rocm93IG10KCJDYW4ndCBjb252ZXJ0IG9iamVjdCB0byBwcmltaXRpdmUgdmFsdWUiKX1yZXR1cm4gdm9pZCAwPT09ZSYmKGU9Im51bWJlciIpLGZ1bmN0aW9uKHQsZSl7dmFyIG4scjtpZigic3RyaW5nIj09PWUmJkwobj10LnRvU3RyaW5nKSYmIUYocj12KG4sdCkpKXJldHVybiByO2lmKEwobj10LnZhbHVlT2YpJiYhRihyPXYobix0KSkpcmV0dXJuIHI7aWYoInN0cmluZyIhPT1lJiZMKG49dC50b1N0cmluZykmJiFGKHI9dihuLHQpKSlyZXR1cm4gcjt0aHJvdyBaKCJDYW4ndCBjb252ZXJ0IG9iamVjdCB0byBwcmltaXRpdmUgdmFsdWUiKX0odCxlKX0seHQ9ZnVuY3Rpb24odCl7dmFyIGU9d3QodCwic3RyaW5nIik7cmV0dXJuIEsoZSk/ZTplKyIifSxTdD1zLmRvY3VtZW50LE90PUYoU3QpJiZGKFN0LmNyZWF0ZUVsZW1lbnQpLEV0PWZ1bmN0aW9uKHQpe3JldHVybiBPdD9TdC5jcmVhdGVFbGVtZW50KHQpOnt9fSxqdD0hcCYmIWwoKGZ1bmN0aW9uKCl7cmV0dXJuIDchPU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFdCgiZGl2IiksImEiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gN319KS5hfSkpLEl0PU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IsVHQ9e2Y6cD9JdDpmdW5jdGlvbih0LGUpe2lmKHQ9ayh0KSxlPXh0KGUpLGp0KXRyeXtyZXR1cm4gSXQodCxlKX1jYXRjaCh0KXt9aWYoY3QodCxlKSlyZXR1cm4gbSghdihnLmYsdCxlKSx0W2VdKX19LEF0PXMuU3RyaW5nLFB0PXMuVHlwZUVycm9yLFJ0PWZ1bmN0aW9uKHQpe2lmKEYodCkpcmV0dXJuIHQ7dGhyb3cgUHQoQXQodCkrIiBpcyBub3QgYW4gb2JqZWN0Iil9LE10PXMuVHlwZUVycm9yLGt0PU9iamVjdC5kZWZpbmVQcm9wZXJ0eSxMdD17ZjpwP2t0OmZ1bmN0aW9uKHQsZSxuKXtpZihSdCh0KSxlPXh0KGUpLFJ0KG4pLGp0KXRyeXtyZXR1cm4ga3QodCxlLG4pfWNhdGNoKHQpe31pZigiZ2V0ImluIG58fCJzZXQiaW4gbil0aHJvdyBNdCgiQWNjZXNzb3JzIG5vdCBzdXBwb3J0ZWQiKTtyZXR1cm4gInZhbHVlImluIG4mJih0W2VdPW4udmFsdWUpLHR9fSxGdD1wP2Z1bmN0aW9uKHQsZSxuKXtyZXR1cm4gTHQuZih0LGUsbSgxLG4pKX06ZnVuY3Rpb24odCxlLG4pe3JldHVybiB0W2VdPW4sdH0sQ3Q9TyhGdW5jdGlvbi50b1N0cmluZyk7TChydC5pbnNwZWN0U291cmNlKXx8KHJ0Lmluc3BlY3RTb3VyY2U9ZnVuY3Rpb24odCl7cmV0dXJuIEN0KHQpfSk7dmFyIE50LHp0LF90LER0PXJ0Lmluc3BlY3RTb3VyY2UsVXQ9cy5XZWFrTWFwLEd0PUwoVXQpJiYvbmF0aXZlIGNvZGUvLnRlc3QoRHQoVXQpKSxCdD1vdCgia2V5cyIpLFd0PWZ1bmN0aW9uKHQpe3JldHVybiBCdFt0XXx8KEJ0W3RdPXB0KHQpKX0sVnQ9e30sSHQ9Ik9iamVjdCBhbHJlYWR5IGluaXRpYWxpemVkIixxdD1zLlR5cGVFcnJvcixLdD1zLldlYWtNYXA7aWYoR3R8fHJ0LnN0YXRlKXt2YXIgWXQ9cnQuc3RhdGV8fChydC5zdGF0ZT1uZXcgS3QpLFh0PU8oWXQuZ2V0KSwkdD1PKFl0LmhhcyksSnQ9TyhZdC5zZXQpO050PWZ1bmN0aW9uKHQsZSl7aWYoJHQoWXQsdCkpdGhyb3cgbmV3IHF0KEh0KTtyZXR1cm4gZS5mYWNhZGU9dCxKdChZdCx0LGUpLGV9LHp0PWZ1bmN0aW9uKHQpe3JldHVybiBYdChZdCx0KXx8e319LF90PWZ1bmN0aW9uKHQpe3JldHVybiAkdChZdCx0KX07fWVsc2Uge3ZhciBRdD1XdCgic3RhdGUiKTtWdFtRdF09ITAsTnQ9ZnVuY3Rpb24odCxlKXtpZihjdCh0LFF0KSl0aHJvdyBuZXcgcXQoSHQpO3JldHVybiBlLmZhY2FkZT10LEZ0KHQsUXQsZSksZX0senQ9ZnVuY3Rpb24odCl7cmV0dXJuIGN0KHQsUXQpP3RbUXRdOnt9fSxfdD1mdW5jdGlvbih0KXtyZXR1cm4gY3QodCxRdCl9O312YXIgWnQ9e3NldDpOdCxnZXQ6enQsaGFzOl90LGVuZm9yY2U6ZnVuY3Rpb24odCl7cmV0dXJuIF90KHQpP3p0KHQpOk50KHQse30pfSxnZXR0ZXJGb3I6ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGUpe3ZhciBuO2lmKCFGKGUpfHwobj16dChlKSkudHlwZSE9PXQpdGhyb3cgcXQoIkluY29tcGF0aWJsZSByZWNlaXZlciwgIit0KyIgcmVxdWlyZWQiKTtyZXR1cm4gbn19fSx0ZT1GdW5jdGlvbi5wcm90b3R5cGUsZWU9cCYmT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcixuZT1jdCh0ZSwibmFtZSIpLHJlPXtFWElTVFM6bmUsUFJPUEVSOm5lJiYic29tZXRoaW5nIj09PWZ1bmN0aW9uKCl7fS5uYW1lLENPTkZJR1VSQUJMRTpuZSYmKCFwfHxwJiZlZSh0ZSwibmFtZSIpLmNvbmZpZ3VyYWJsZSl9LG9lPXUoKGZ1bmN0aW9uKHQpe3ZhciBlPXJlLkNPTkZJR1VSQUJMRSxuPVp0LmdldCxyPVp0LmVuZm9yY2Usbz1TdHJpbmcoU3RyaW5nKS5zcGxpdCgiU3RyaW5nIik7KHQuZXhwb3J0cz1mdW5jdGlvbih0LG4saSx1KXt2YXIgYSxjPSEhdSYmISF1LnVuc2FmZSxmPSEhdSYmISF1LmVudW1lcmFibGUsbD0hIXUmJiEhdS5ub1RhcmdldEdldCxwPXUmJnZvaWQgMCE9PXUubmFtZT91Lm5hbWU6bjtMKGkpJiYoIlN5bWJvbCgiPT09U3RyaW5nKHApLnNsaWNlKDAsNykmJihwPSJbIitTdHJpbmcocCkucmVwbGFjZSgvXlN5bWJvbFwoKFteKV0qKVwpLywiJDEiKSsiXSIpLCghY3QoaSwibmFtZSIpfHxlJiZpLm5hbWUhPT1wKSYmRnQoaSwibmFtZSIscCksKGE9cihpKSkuc291cmNlfHwoYS5zb3VyY2U9by5qb2luKCJzdHJpbmciPT10eXBlb2YgcD9wOiIiKSkpLHQhPT1zPyhjPyFsJiZ0W25dJiYoZj0hMCk6ZGVsZXRlIHRbbl0sZj90W25dPWk6RnQodCxuLGkpKTpmP3Rbbl09aTpldChuLGkpO30pKEZ1bmN0aW9uLnByb3RvdHlwZSwidG9TdHJpbmciLChmdW5jdGlvbigpe3JldHVybiBMKHRoaXMpJiZuKHRoaXMpLnNvdXJjZXx8RHQodGhpcyl9KSk7fSkpLGllPU1hdGguY2VpbCx1ZT1NYXRoLmZsb29yLGFlPWZ1bmN0aW9uKHQpe3ZhciBlPSt0O3JldHVybiBlIT1lfHwwPT09ZT8wOihlPjA/dWU6aWUpKGUpfSxjZT1NYXRoLm1heCxmZT1NYXRoLm1pbixzZT1mdW5jdGlvbih0LGUpe3ZhciBuPWFlKHQpO3JldHVybiBuPDA/Y2UobitlLDApOmZlKG4sZSl9LGxlPU1hdGgubWluLHBlPWZ1bmN0aW9uKHQpe3JldHVybiB0PjA/bGUoYWUodCksOTAwNzE5OTI1NDc0MDk5MSk6MH0sZGU9ZnVuY3Rpb24odCl7cmV0dXJuIHBlKHQubGVuZ3RoKX0sdmU9ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGUsbixyKXt2YXIgbyxpPWsoZSksdT1kZShpKSxhPXNlKHIsdSk7aWYodCYmbiE9bil7Zm9yKDt1PmE7KWlmKChvPWlbYSsrXSkhPW8pcmV0dXJuICEwfWVsc2UgZm9yKDt1PmE7YSsrKWlmKCh0fHxhIGluIGkpJiZpW2FdPT09bilyZXR1cm4gdHx8YXx8MDtyZXR1cm4gIXQmJi0xfX0saGU9e2luY2x1ZGVzOnZlKCEwKSxpbmRleE9mOnZlKCExKX0uaW5kZXhPZix5ZT1PKFtdLnB1c2gpLGdlPWZ1bmN0aW9uKHQsZSl7dmFyIG4scj1rKHQpLG89MCxpPVtdO2ZvcihuIGluIHIpIWN0KFZ0LG4pJiZjdChyLG4pJiZ5ZShpLG4pO2Zvcig7ZS5sZW5ndGg+bzspY3QocixuPWVbbysrXSkmJih+aGUoaSxuKXx8eWUoaSxuKSk7cmV0dXJuIGl9LG1lPVsiY29uc3RydWN0b3IiLCJoYXNPd25Qcm9wZXJ0eSIsImlzUHJvdG90eXBlT2YiLCJwcm9wZXJ0eUlzRW51bWVyYWJsZSIsInRvTG9jYWxlU3RyaW5nIiwidG9TdHJpbmciLCJ2YWx1ZU9mIl0sYmU9bWUuY29uY2F0KCJsZW5ndGgiLCJwcm90b3R5cGUiKSx3ZT17ZjpPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lc3x8ZnVuY3Rpb24odCl7cmV0dXJuIGdlKHQsYmUpfX0seGU9e2Y6T2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9sc30sU2U9TyhbXS5jb25jYXQpLE9lPU4oIlJlZmxlY3QiLCJvd25LZXlzIil8fGZ1bmN0aW9uKHQpe3ZhciBlPXdlLmYoUnQodCkpLG49eGUuZjtyZXR1cm4gbj9TZShlLG4odCkpOmV9LEVlPWZ1bmN0aW9uKHQsZSl7Zm9yKHZhciBuPU9lKGUpLHI9THQuZixvPVR0LmYsaT0wO2k8bi5sZW5ndGg7aSsrKXt2YXIgdT1uW2ldO2N0KHQsdSl8fHIodCx1LG8oZSx1KSk7fX0samU9LyN8XC5wcm90b3R5cGVcLi8sSWU9ZnVuY3Rpb24odCxlKXt2YXIgbj1BZVtUZSh0KV07cmV0dXJuIG49PVJlfHxuIT1QZSYmKEwoZSk/bChlKTohIWUpfSxUZT1JZS5ub3JtYWxpemU9ZnVuY3Rpb24odCl7cmV0dXJuIFN0cmluZyh0KS5yZXBsYWNlKGplLCIuIikudG9Mb3dlckNhc2UoKX0sQWU9SWUuZGF0YT17fSxQZT1JZS5OQVRJVkU9Ik4iLFJlPUllLlBPTFlGSUxMPSJQIixNZT1JZSxrZT1UdC5mLExlPWZ1bmN0aW9uKHQsZSl7dmFyIG4scixvLGksdSxhPXQudGFyZ2V0LGM9dC5nbG9iYWwsZj10LnN0YXQ7aWYobj1jP3M6Zj9zW2FdfHxldChhLHt9KTooc1thXXx8e30pLnByb3RvdHlwZSlmb3IociBpbiBlKXtpZihpPWVbcl0sbz10Lm5vVGFyZ2V0R2V0Pyh1PWtlKG4scikpJiZ1LnZhbHVlOm5bcl0sIU1lKGM/cjphKyhmPyIuIjoiIyIpK3IsdC5mb3JjZWQpJiZ2b2lkIDAhPT1vKXtpZih0eXBlb2YgaT09dHlwZW9mIG8pY29udGludWU7RWUoaSxvKTt9KHQuc2hhbXx8byYmby5zaGFtKSYmRnQoaSwic2hhbSIsITApLG9lKG4scixpLHQpO319LEZlPUFycmF5LmlzQXJyYXl8fGZ1bmN0aW9uKHQpe3JldHVybiAiQXJyYXkiPT1JKHQpfSxDZT17fTtDZVtndCgidG9TdHJpbmdUYWciKV09InoiO3ZhciBOZSx6ZT0iW29iamVjdCB6XSI9PT1TdHJpbmcoQ2UpLF9lPWd0KCJ0b1N0cmluZ1RhZyIpLERlPXMuT2JqZWN0LFVlPSJBcmd1bWVudHMiPT1JKGZ1bmN0aW9uKCl7cmV0dXJuIGFyZ3VtZW50c30oKSksR2U9emU/STpmdW5jdGlvbih0KXt2YXIgZSxuLHI7cmV0dXJuIHZvaWQgMD09PXQ/IlVuZGVmaW5lZCI6bnVsbD09PXQ/Ik51bGwiOiJzdHJpbmciPT10eXBlb2Yobj1mdW5jdGlvbih0LGUpe3RyeXtyZXR1cm4gdFtlXX1jYXRjaCh0KXt9fShlPURlKHQpLF9lKSk/bjpVZT9JKGUpOiJPYmplY3QiPT0ocj1JKGUpKSYmTChlLmNhbGxlZSk/IkFyZ3VtZW50cyI6cn0sQmU9ZnVuY3Rpb24oKXt9LFdlPVtdLFZlPU4oIlJlZmxlY3QiLCJjb25zdHJ1Y3QiKSxIZT0vXlxzKig/OmNsYXNzfGZ1bmN0aW9uKVxiLyxxZT1PKEhlLmV4ZWMpLEtlPSFIZS5leGVjKEJlKSxZZT1mdW5jdGlvbih0KXtpZighTCh0KSlyZXR1cm4gITE7dHJ5e3JldHVybiBWZShCZSxXZSx0KSwhMH1jYXRjaCh0KXtyZXR1cm4gITF9fSxYZT0hVmV8fGwoKGZ1bmN0aW9uKCl7dmFyIHQ7cmV0dXJuIFllKFllLmNhbGwpfHwhWWUoT2JqZWN0KXx8IVllKChmdW5jdGlvbigpe3Q9ITA7fSkpfHx0fSkpP2Z1bmN0aW9uKHQpe2lmKCFMKHQpKXJldHVybiAhMTtzd2l0Y2goR2UodCkpe2Nhc2UiQXN5bmNGdW5jdGlvbiI6Y2FzZSJHZW5lcmF0b3JGdW5jdGlvbiI6Y2FzZSJBc3luY0dlbmVyYXRvckZ1bmN0aW9uIjpyZXR1cm4gITF9cmV0dXJuIEtlfHwhIXFlKEhlLER0KHQpKX06WWUsJGU9ZnVuY3Rpb24odCxlLG4pe3ZhciByPXh0KGUpO3IgaW4gdD9MdC5mKHQscixtKDAsbikpOnRbcl09bjt9LEplPWd0KCJzcGVjaWVzIiksUWU9TyhbXS5zbGljZSksWmU9KE5lPSJzbGljZSIsVz49NTF8fCFsKChmdW5jdGlvbigpe3ZhciB0PVtdO3JldHVybiAodC5jb25zdHJ1Y3Rvcj17fSlbSmVdPWZ1bmN0aW9uKCl7cmV0dXJuIHtmb286MX19LDEhPT10W05lXShCb29sZWFuKS5mb299KSkpLHRuPWd0KCJzcGVjaWVzIiksZW49cy5BcnJheSxubj1NYXRoLm1heDtMZSh7dGFyZ2V0OiJBcnJheSIscHJvdG86ITAsZm9yY2VkOiFaZX0se3NsaWNlOmZ1bmN0aW9uKHQsZSl7dmFyIG4scixvLGk9ayh0aGlzKSx1PWRlKGkpLGE9c2UodCx1KSxjPXNlKHZvaWQgMD09PWU/dTplLHUpO2lmKEZlKGkpJiYobj1pLmNvbnN0cnVjdG9yLChYZShuKSYmKG49PT1lbnx8RmUobi5wcm90b3R5cGUpKXx8RihuKSYmbnVsbD09PShuPW5bdG5dKSkmJihuPXZvaWQgMCksbj09PWVufHx2b2lkIDA9PT1uKSlyZXR1cm4gUWUoaSxhLGMpO2ZvcihyPW5ldyh2b2lkIDA9PT1uP2VuOm4pKG5uKGMtYSwwKSksbz0wO2E8YzthKyssbysrKWEgaW4gaSYmJGUocixvLGlbYV0pO3JldHVybiByLmxlbmd0aD1vLHJ9fSk7dmFyIHJuPXplP3t9LnRvU3RyaW5nOmZ1bmN0aW9uKCl7cmV0dXJuICJbb2JqZWN0ICIrR2UodGhpcykrIl0ifTt6ZXx8b2UoT2JqZWN0LnByb3RvdHlwZSwidG9TdHJpbmciLHJuLHt1bnNhZmU6ITB9KTt2YXIgb24sdW49cy5TdHJpbmcsYW49ZnVuY3Rpb24odCl7aWYoIlN5bWJvbCI9PT1HZSh0KSl0aHJvdyBUeXBlRXJyb3IoIkNhbm5vdCBjb252ZXJ0IGEgU3ltYm9sIHZhbHVlIHRvIGEgc3RyaW5nIik7cmV0dXJuIHVuKHQpfSxjbj1mdW5jdGlvbigpe3ZhciB0PVJ0KHRoaXMpLGU9IiI7cmV0dXJuIHQuZ2xvYmFsJiYoZSs9ImciKSx0Lmlnbm9yZUNhc2UmJihlKz0iaSIpLHQubXVsdGlsaW5lJiYoZSs9Im0iKSx0LmRvdEFsbCYmKGUrPSJzIiksdC51bmljb2RlJiYoZSs9InUiKSx0LnN0aWNreSYmKGUrPSJ5IiksZX0sZm49cy5SZWdFeHAsc249bCgoZnVuY3Rpb24oKXt2YXIgdD1mbigiYSIsInkiKTtyZXR1cm4gdC5sYXN0SW5kZXg9MixudWxsIT10LmV4ZWMoImFiY2QiKX0pKSxsbj1zbnx8bCgoZnVuY3Rpb24oKXtyZXR1cm4gIWZuKCJhIiwieSIpLnN0aWNreX0pKSxwbj17QlJPS0VOX0NBUkVUOnNufHxsKChmdW5jdGlvbigpe3ZhciB0PWZuKCJeciIsImd5Iik7cmV0dXJuIHQubGFzdEluZGV4PTIsbnVsbCE9dC5leGVjKCJzdHIiKX0pKSxNSVNTRURfU1RJQ0tZOmxuLFVOU1VQUE9SVEVEX1k6c259LGRuPU9iamVjdC5rZXlzfHxmdW5jdGlvbih0KXtyZXR1cm4gZ2UodCxtZSl9LHZuPXA/T2JqZWN0LmRlZmluZVByb3BlcnRpZXM6ZnVuY3Rpb24odCxlKXtSdCh0KTtmb3IodmFyIG4scj1rKGUpLG89ZG4oZSksaT1vLmxlbmd0aCx1PTA7aT51OylMdC5mKHQsbj1vW3UrK10scltuXSk7cmV0dXJuIHR9LGhuPU4oImRvY3VtZW50IiwiZG9jdW1lbnRFbGVtZW50IikseW49V3QoIklFX1BST1RPIiksZ249ZnVuY3Rpb24oKXt9LG1uPWZ1bmN0aW9uKHQpe3JldHVybiAiPHNjcmlwdD4iK3QrIjwvIisic2NyaXB0PiJ9LGJuPWZ1bmN0aW9uKHQpe3Qud3JpdGUobW4oIiIpKSx0LmNsb3NlKCk7dmFyIGU9dC5wYXJlbnRXaW5kb3cuT2JqZWN0O3JldHVybiB0PW51bGwsZX0sd249ZnVuY3Rpb24oKXt0cnl7b249bmV3IEFjdGl2ZVhPYmplY3QoImh0bWxmaWxlIik7fWNhdGNoKHQpe312YXIgdCxlO3duPSJ1bmRlZmluZWQiIT10eXBlb2YgZG9jdW1lbnQ/ZG9jdW1lbnQuZG9tYWluJiZvbj9ibihvbik6KChlPUV0KCJpZnJhbWUiKSkuc3R5bGUuZGlzcGxheT0ibm9uZSIsaG4uYXBwZW5kQ2hpbGQoZSksZS5zcmM9U3RyaW5nKCJqYXZhc2NyaXB0OiIpLCh0PWUuY29udGVudFdpbmRvdy5kb2N1bWVudCkub3BlbigpLHQud3JpdGUobW4oImRvY3VtZW50LkY9T2JqZWN0IikpLHQuY2xvc2UoKSx0LkYpOmJuKG9uKTtmb3IodmFyIG49bWUubGVuZ3RoO24tLTspZGVsZXRlIHduLnByb3RvdHlwZVttZVtuXV07cmV0dXJuIHduKCl9O1Z0W3luXT0hMDt2YXIgeG4sU24sT249T2JqZWN0LmNyZWF0ZXx8ZnVuY3Rpb24odCxlKXt2YXIgbjtyZXR1cm4gbnVsbCE9PXQ/KGduLnByb3RvdHlwZT1SdCh0KSxuPW5ldyBnbixnbi5wcm90b3R5cGU9bnVsbCxuW3luXT10KTpuPXduKCksdm9pZCAwPT09ZT9uOnZuKG4sZSl9LEVuPXMuUmVnRXhwLGpuPWwoKGZ1bmN0aW9uKCl7dmFyIHQ9RW4oIi4iLCJzIik7cmV0dXJuICEodC5kb3RBbGwmJnQuZXhlYygiXG4iKSYmInMiPT09dC5mbGFncyl9KSksSW49cy5SZWdFeHAsVG49bCgoZnVuY3Rpb24oKXt2YXIgdD1JbigiKD88YT5iKSIsImciKTtyZXR1cm4gImIiIT09dC5leGVjKCJiIikuZ3JvdXBzLmF8fCJiYyIhPT0iYiIucmVwbGFjZSh0LCIkPGE+YyIpfSkpLEFuPVp0LmdldCxQbj1vdCgibmF0aXZlLXN0cmluZy1yZXBsYWNlIixTdHJpbmcucHJvdG90eXBlLnJlcGxhY2UpLFJuPVJlZ0V4cC5wcm90b3R5cGUuZXhlYyxNbj1Sbixrbj1PKCIiLmNoYXJBdCksTG49TygiIi5pbmRleE9mKSxGbj1PKCIiLnJlcGxhY2UpLENuPU8oIiIuc2xpY2UpLE5uPShTbj0vYiovZyx2KFJuLHhuPS9hLywiYSIpLHYoUm4sU24sImEiKSwwIT09eG4ubGFzdEluZGV4fHwwIT09U24ubGFzdEluZGV4KSx6bj1wbi5CUk9LRU5fQ0FSRVQsX249dm9pZCAwIT09LygpPz8vLmV4ZWMoIiIpWzFdOyhObnx8X258fHpufHxqbnx8VG4pJiYoTW49ZnVuY3Rpb24odCl7dmFyIGUsbixyLG8saSx1LGEsYz10aGlzLGY9QW4oYykscz1hbih0KSxsPWYucmF3O2lmKGwpcmV0dXJuIGwubGFzdEluZGV4PWMubGFzdEluZGV4LGU9dihNbixsLHMpLGMubGFzdEluZGV4PWwubGFzdEluZGV4LGU7dmFyIHA9Zi5ncm91cHMsZD16biYmYy5zdGlja3ksaD12KGNuLGMpLHk9Yy5zb3VyY2UsZz0wLG09cztpZihkJiYoaD1GbihoLCJ5IiwiIiksLTE9PT1MbihoLCJnIikmJihoKz0iZyIpLG09Q24ocyxjLmxhc3RJbmRleCksYy5sYXN0SW5kZXg+MCYmKCFjLm11bHRpbGluZXx8Yy5tdWx0aWxpbmUmJiJcbiIhPT1rbihzLGMubGFzdEluZGV4LTEpKSYmKHk9Iig/OiAiK3krIikiLG09IiAiK20sZysrKSxuPW5ldyBSZWdFeHAoIl4oPzoiK3krIikiLGgpKSxfbiYmKG49bmV3IFJlZ0V4cCgiXiIreSsiJCg/IVxccykiLGgpKSxObiYmKHI9Yy5sYXN0SW5kZXgpLG89dihSbixkP246YyxtKSxkP28/KG8uaW5wdXQ9Q24oby5pbnB1dCxnKSxvWzBdPUNuKG9bMF0sZyksby5pbmRleD1jLmxhc3RJbmRleCxjLmxhc3RJbmRleCs9b1swXS5sZW5ndGgpOmMubGFzdEluZGV4PTA6Tm4mJm8mJihjLmxhc3RJbmRleD1jLmdsb2JhbD9vLmluZGV4K29bMF0ubGVuZ3RoOnIpLF9uJiZvJiZvLmxlbmd0aD4xJiZ2KFBuLG9bMF0sbiwoZnVuY3Rpb24oKXtmb3IoaT0xO2k8YXJndW1lbnRzLmxlbmd0aC0yO2krKyl2b2lkIDA9PT1hcmd1bWVudHNbaV0mJihvW2ldPXZvaWQgMCk7fSkpLG8mJnApZm9yKG8uZ3JvdXBzPXU9T24obnVsbCksaT0wO2k8cC5sZW5ndGg7aSsrKXVbKGE9cFtpXSlbMF1dPW9bYVsxXV07cmV0dXJuIG99KTt2YXIgRG49TW47TGUoe3RhcmdldDoiUmVnRXhwIixwcm90bzohMCxmb3JjZWQ6Ly4vLmV4ZWMhPT1Ebn0se2V4ZWM6RG59KTt2YXIgVW49RnVuY3Rpb24ucHJvdG90eXBlLEduPVVuLmFwcGx5LEJuPVVuLmJpbmQsV249VW4uY2FsbCxWbj0ib2JqZWN0Ij09dHlwZW9mIFJlZmxlY3QmJlJlZmxlY3QuYXBwbHl8fChCbj9Xbi5iaW5kKEduKTpmdW5jdGlvbigpe3JldHVybiBXbi5hcHBseShHbixhcmd1bWVudHMpfSksSG49Z3QoInNwZWNpZXMiKSxxbj1SZWdFeHAucHJvdG90eXBlLEtuPWd0KCJtYXRjaCIpLFluPXMuVHlwZUVycm9yLFhuPWd0KCJzcGVjaWVzIiksJG49ZnVuY3Rpb24odCxlKXt2YXIgbixyPVJ0KHQpLmNvbnN0cnVjdG9yO3JldHVybiB2b2lkIDA9PT1yfHxudWxsPT0obj1SdChyKVtYbl0pP2U6ZnVuY3Rpb24odCl7aWYoWGUodCkpcmV0dXJuIHQ7dGhyb3cgWW4oWCh0KSsiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIil9KG4pfSxKbj1PKCIiLmNoYXJBdCksUW49TygiIi5jaGFyQ29kZUF0KSxabj1PKCIiLnNsaWNlKSx0cj1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSxuKXt2YXIgcixvLGk9YW4oTShlKSksdT1hZShuKSxhPWkubGVuZ3RoO3JldHVybiB1PDB8fHU+PWE/dD8iIjp2b2lkIDA6KHI9UW4oaSx1KSk8NTUyOTZ8fHI+NTYzMTl8fHUrMT09PWF8fChvPVFuKGksdSsxKSk8NTYzMjB8fG8+NTczNDM/dD9KbihpLHUpOnI6dD9abihpLHUsdSsyKTpvLTU2MzIwKyhyLTU1Mjk2PDwxMCkrNjU1MzZ9fSxlcj17Y29kZUF0OnRyKCExKSxjaGFyQXQ6dHIoITApfSxucj1lci5jaGFyQXQscnI9ZnVuY3Rpb24odCxlLG4pe3JldHVybiBlKyhuP25yKHQsZSkubGVuZ3RoOjEpfSxvcj1zLkFycmF5LGlyPU1hdGgubWF4LHVyPWZ1bmN0aW9uKHQsZSxuKXtmb3IodmFyIHI9ZGUodCksbz1zZShlLHIpLGk9c2Uodm9pZCAwPT09bj9yOm4sciksdT1vcihpcihpLW8sMCkpLGE9MDtvPGk7bysrLGErKykkZSh1LGEsdFtvXSk7cmV0dXJuIHUubGVuZ3RoPWEsdX0sYXI9cy5UeXBlRXJyb3IsY3I9ZnVuY3Rpb24odCxlKXt2YXIgbj10LmV4ZWM7aWYoTChuKSl7dmFyIHI9dihuLHQsZSk7cmV0dXJuIG51bGwhPT1yJiZSdChyKSxyfWlmKCJSZWdFeHAiPT09SSh0KSlyZXR1cm4gdihEbix0LGUpO3Rocm93IGFyKCJSZWdFeHAjZXhlYyBjYWxsZWQgb24gaW5jb21wYXRpYmxlIHJlY2VpdmVyIil9LGZyPXBuLlVOU1VQUE9SVEVEX1ksc3I9NDI5NDk2NzI5NSxscj1NYXRoLm1pbixwcj1bXS5wdXNoLGRyPU8oLy4vLmV4ZWMpLHZyPU8ocHIpLGhyPU8oIiIuc2xpY2UpLHlyPSFsKChmdW5jdGlvbigpe3ZhciB0PS8oPzopLyxlPXQuZXhlYzt0LmV4ZWM9ZnVuY3Rpb24oKXtyZXR1cm4gZS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9O3ZhciBuPSJhYiIuc3BsaXQodCk7cmV0dXJuIDIhPT1uLmxlbmd0aHx8ImEiIT09blswXXx8ImIiIT09blsxXX0pKTshZnVuY3Rpb24odCxlLG4scil7dmFyIG89Z3QodCksaT0hbCgoZnVuY3Rpb24oKXt2YXIgZT17fTtyZXR1cm4gZVtvXT1mdW5jdGlvbigpe3JldHVybiA3fSw3IT0iIlt0XShlKX0pKSx1PWkmJiFsKChmdW5jdGlvbigpe3ZhciBlPSExLG49L2EvO3JldHVybiAic3BsaXQiPT09dCYmKChuPXt9KS5jb25zdHJ1Y3Rvcj17fSxuLmNvbnN0cnVjdG9yW0huXT1mdW5jdGlvbigpe3JldHVybiBufSxuLmZsYWdzPSIiLG5bb109Ly4vW29dKSxuLmV4ZWM9ZnVuY3Rpb24oKXtyZXR1cm4gZT0hMCxudWxsfSxuW29dKCIiKSwhZX0pKTtpZighaXx8IXV8fG4pe3ZhciBhPU8oLy4vW29dKSxjPWUobywiIlt0XSwoZnVuY3Rpb24odCxlLG4scixvKXt2YXIgdT1PKHQpLGM9ZS5leGVjO3JldHVybiBjPT09RG58fGM9PT1xbi5leGVjP2kmJiFvP3tkb25lOiEwLHZhbHVlOmEoZSxuLHIpfTp7ZG9uZTohMCx2YWx1ZTp1KG4sZSxyKX06e2RvbmU6ITF9fSkpO29lKFN0cmluZy5wcm90b3R5cGUsdCxjWzBdKSxvZShxbixvLGNbMV0pO31yJiZGdChxbltvXSwic2hhbSIsITApO30oInNwbGl0IiwoZnVuY3Rpb24odCxlLG4pe3ZhciByO3JldHVybiByPSJjIj09ImFiYmMiLnNwbGl0KC8oYikqLylbMV18fDQhPSJ0ZXN0Ii5zcGxpdCgvKD86KS8sLTEpLmxlbmd0aHx8MiE9ImFiIi5zcGxpdCgvKD86YWIpKi8pLmxlbmd0aHx8NCE9Ii4iLnNwbGl0KC8oLj8pKC4/KS8pLmxlbmd0aHx8Ii4iLnNwbGl0KC8oKSgpLykubGVuZ3RoPjF8fCIiLnNwbGl0KC8uPy8pLmxlbmd0aD9mdW5jdGlvbih0LG4pe3ZhciByLG8saT1hbihNKHRoaXMpKSx1PXZvaWQgMD09PW4/c3I6bj4+PjA7aWYoMD09PXUpcmV0dXJuIFtdO2lmKHZvaWQgMD09PXQpcmV0dXJuIFtpXTtpZighRihyPXQpfHwhKHZvaWQgMCE9PShvPXJbS25dKT9vOiJSZWdFeHAiPT1JKHIpKSlyZXR1cm4gdihlLGksdCx1KTtmb3IodmFyIGEsYyxmLHM9W10sbD0odC5pZ25vcmVDYXNlPyJpIjoiIikrKHQubXVsdGlsaW5lPyJtIjoiIikrKHQudW5pY29kZT8idSI6IiIpKyh0LnN0aWNreT8ieSI6IiIpLHA9MCxkPW5ldyBSZWdFeHAodC5zb3VyY2UsbCsiZyIpOyhhPXYoRG4sZCxpKSkmJiEoKGM9ZC5sYXN0SW5kZXgpPnAmJih2cihzLGhyKGkscCxhLmluZGV4KSksYS5sZW5ndGg+MSYmYS5pbmRleDxpLmxlbmd0aCYmVm4ocHIscyx1cihhLDEpKSxmPWFbMF0ubGVuZ3RoLHA9YyxzLmxlbmd0aD49dSkpOylkLmxhc3RJbmRleD09PWEuaW5kZXgmJmQubGFzdEluZGV4Kys7cmV0dXJuIHA9PT1pLmxlbmd0aD8hZiYmZHIoZCwiIil8fHZyKHMsIiIpOnZyKHMsaHIoaSxwKSkscy5sZW5ndGg+dT91cihzLDAsdSk6c306IjAiLnNwbGl0KHZvaWQgMCwwKS5sZW5ndGg/ZnVuY3Rpb24odCxuKXtyZXR1cm4gdm9pZCAwPT09dCYmMD09PW4/W106dihlLHRoaXMsdCxuKX06ZSxbZnVuY3Rpb24oZSxuKXt2YXIgbz1NKHRoaXMpLGk9bnVsbD09ZT92b2lkIDA6UShlLHQpO3JldHVybiBpP3YoaSxlLG8sbik6dihyLGFuKG8pLGUsbil9LGZ1bmN0aW9uKHQsbyl7dmFyIGk9UnQodGhpcyksdT1hbih0KSxhPW4ocixpLHUsbyxyIT09ZSk7aWYoYS5kb25lKXJldHVybiBhLnZhbHVlO3ZhciBjPSRuKGksUmVnRXhwKSxmPWkudW5pY29kZSxzPShpLmlnbm9yZUNhc2U/ImkiOiIiKSsoaS5tdWx0aWxpbmU/Im0iOiIiKSsoaS51bmljb2RlPyJ1IjoiIikrKGZyPyJnIjoieSIpLGw9bmV3IGMoZnI/Il4oPzoiK2kuc291cmNlKyIpIjppLHMpLHA9dm9pZCAwPT09bz9zcjpvPj4+MDtpZigwPT09cClyZXR1cm4gW107aWYoMD09PXUubGVuZ3RoKXJldHVybiBudWxsPT09Y3IobCx1KT9bdV06W107Zm9yKHZhciBkPTAsdj0wLGg9W107djx1Lmxlbmd0aDspe2wubGFzdEluZGV4PWZyPzA6djt2YXIgeSxnPWNyKGwsZnI/aHIodSx2KTp1KTtpZihudWxsPT09Z3x8KHk9bHIocGUobC5sYXN0SW5kZXgrKGZyP3Y6MCkpLHUubGVuZ3RoKSk9PT1kKXY9cnIodSx2LGYpO2Vsc2Uge2lmKHZyKGgsaHIodSxkLHYpKSxoLmxlbmd0aD09PXApcmV0dXJuIGg7Zm9yKHZhciBtPTE7bTw9Zy5sZW5ndGgtMTttKyspaWYodnIoaCxnW21dKSxoLmxlbmd0aD09PXApcmV0dXJuIGg7dj1kPXk7fX1yZXR1cm4gdnIoaCxocih1LGQpKSxofV19KSwheXIsZnIpOwogIC8qISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uCgogICAgUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55CiAgICBwdXJwb3NlIHdpdGggb3Igd2l0aG91dCBmZWUgaXMgaGVyZWJ5IGdyYW50ZWQuCgogICAgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEgKICAgIFJFR0FSRCBUTyBUSElTIFNPRlRXQVJFIElOQ0xVRElORyBBTEwgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWQogICAgQU5EIEZJVE5FU1MuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1IgQkUgTElBQkxFIEZPUiBBTlkgU1BFQ0lBTCwgRElSRUNULAogICAgSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NCiAgICBMT1NTIE9GIFVTRSwgREFUQSBPUiBQUk9GSVRTLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgTkVHTElHRU5DRSBPUgogICAgT1RIRVIgVE9SVElPVVMgQUNUSU9OLCBBUklTSU5HIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFVTRSBPUgogICAgUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS4KICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovCiAgdmFyIGdyPWZ1bmN0aW9uKCl7cmV0dXJuIGdyPU9iamVjdC5hc3NpZ258fGZ1bmN0aW9uKHQpe2Zvcih2YXIgZSxuPTEscj1hcmd1bWVudHMubGVuZ3RoO248cjtuKyspZm9yKHZhciBvIGluIGU9YXJndW1lbnRzW25dKU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLG8pJiYodFtvXT1lW29dKTtyZXR1cm4gdH0sZ3IuYXBwbHkodGhpcyxhcmd1bWVudHMpfTtmdW5jdGlvbiBtcih0LGUsbixyKXtyZXR1cm4gbmV3KG58fChuPVByb21pc2UpKSgoZnVuY3Rpb24obyxpKXtmdW5jdGlvbiB1KHQpe3RyeXtjKHIubmV4dCh0KSk7fWNhdGNoKHQpe2kodCk7fX1mdW5jdGlvbiBhKHQpe3RyeXtjKHIudGhyb3codCkpO31jYXRjaCh0KXtpKHQpO319ZnVuY3Rpb24gYyh0KXt2YXIgZTt0LmRvbmU/byh0LnZhbHVlKTooZT10LnZhbHVlLGUgaW5zdGFuY2VvZiBuP2U6bmV3IG4oKGZ1bmN0aW9uKHQpe3QoZSk7fSkpKS50aGVuKHUsYSk7fWMoKHI9ci5hcHBseSh0LGV8fFtdKSkubmV4dCgpKTt9KSl9ZnVuY3Rpb24gYnIodCxlKXt2YXIgbixyLG8saSx1PXtsYWJlbDowLHNlbnQ6ZnVuY3Rpb24oKXtpZigxJm9bMF0pdGhyb3cgb1sxXTtyZXR1cm4gb1sxXX0sdHJ5czpbXSxvcHM6W119O3JldHVybiBpPXtuZXh0OmEoMCksdGhyb3c6YSgxKSxyZXR1cm46YSgyKX0sImZ1bmN0aW9uIj09dHlwZW9mIFN5bWJvbCYmKGlbU3ltYm9sLml0ZXJhdG9yXT1mdW5jdGlvbigpe3JldHVybiB0aGlzfSksaTtmdW5jdGlvbiBhKGkpe3JldHVybiBmdW5jdGlvbihhKXtyZXR1cm4gZnVuY3Rpb24oaSl7aWYobil0aHJvdyBuZXcgVHlwZUVycm9yKCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBleGVjdXRpbmcuIik7Zm9yKDt1Oyl0cnl7aWYobj0xLHImJihvPTImaVswXT9yLnJldHVybjppWzBdP3IudGhyb3d8fCgobz1yLnJldHVybikmJm8uY2FsbChyKSwwKTpyLm5leHQpJiYhKG89by5jYWxsKHIsaVsxXSkpLmRvbmUpcmV0dXJuIG87c3dpdGNoKHI9MCxvJiYoaT1bMiZpWzBdLG8udmFsdWVdKSxpWzBdKXtjYXNlIDA6Y2FzZSAxOm89aTticmVhaztjYXNlIDQ6cmV0dXJuIHUubGFiZWwrKyx7dmFsdWU6aVsxXSxkb25lOiExfTtjYXNlIDU6dS5sYWJlbCsrLHI9aVsxXSxpPVswXTtjb250aW51ZTtjYXNlIDc6aT11Lm9wcy5wb3AoKSx1LnRyeXMucG9wKCk7Y29udGludWU7ZGVmYXVsdDppZighKG89dS50cnlzLChvPW8ubGVuZ3RoPjAmJm9bby5sZW5ndGgtMV0pfHw2IT09aVswXSYmMiE9PWlbMF0pKXt1PTA7Y29udGludWV9aWYoMz09PWlbMF0mJighb3x8aVsxXT5vWzBdJiZpWzFdPG9bM10pKXt1LmxhYmVsPWlbMV07YnJlYWt9aWYoNj09PWlbMF0mJnUubGFiZWw8b1sxXSl7dS5sYWJlbD1vWzFdLG89aTticmVha31pZihvJiZ1LmxhYmVsPG9bMl0pe3UubGFiZWw9b1syXSx1Lm9wcy5wdXNoKGkpO2JyZWFrfW9bMl0mJnUub3BzLnBvcCgpLHUudHJ5cy5wb3AoKTtjb250aW51ZX1pPWUuY2FsbCh0LHUpO31jYXRjaCh0KXtpPVs2LHRdLHI9MDt9ZmluYWxseXtuPW89MDt9aWYoNSZpWzBdKXRocm93IGlbMV07cmV0dXJuIHt2YWx1ZTppWzBdP2lbMV06dm9pZCAwLGRvbmU6ITB9fShbaSxhXSl9fX1mdW5jdGlvbiB3cih0KXt2YXIgZT0iZnVuY3Rpb24iPT10eXBlb2YgU3ltYm9sJiZTeW1ib2wuaXRlcmF0b3Isbj1lJiZ0W2VdLHI9MDtpZihuKXJldHVybiBuLmNhbGwodCk7aWYodCYmIm51bWJlciI9PXR5cGVvZiB0Lmxlbmd0aClyZXR1cm4ge25leHQ6ZnVuY3Rpb24oKXtyZXR1cm4gdCYmcj49dC5sZW5ndGgmJih0PXZvaWQgMCkse3ZhbHVlOnQmJnRbcisrXSxkb25lOiF0fX19O3Rocm93IG5ldyBUeXBlRXJyb3IoZT8iT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iOiJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIil9ZnVuY3Rpb24geHIodCl7aWYoIVN5bWJvbC5hc3luY0l0ZXJhdG9yKXRocm93IG5ldyBUeXBlRXJyb3IoIlN5bWJvbC5hc3luY0l0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLiIpO3ZhciBlLG49dFtTeW1ib2wuYXN5bmNJdGVyYXRvcl07cmV0dXJuIG4/bi5jYWxsKHQpOih0PXdyKHQpLGU9e30scigibmV4dCIpLHIoInRocm93IikscigicmV0dXJuIiksZVtTeW1ib2wuYXN5bmNJdGVyYXRvcl09ZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30sZSk7ZnVuY3Rpb24gcihuKXtlW25dPXRbbl0mJmZ1bmN0aW9uKGUpe3JldHVybiBuZXcgUHJvbWlzZSgoZnVuY3Rpb24ocixvKXsoZnVuY3Rpb24odCxlLG4scil7UHJvbWlzZS5yZXNvbHZlKHIpLnRoZW4oKGZ1bmN0aW9uKGUpe3Qoe3ZhbHVlOmUsZG9uZTpufSk7fSksZSk7fSkocixvLChlPXRbbl0oZSkpLmRvbmUsZS52YWx1ZSk7fSkpfTt9fXZhciBTcj1ndCgidW5zY29wYWJsZXMiKSxPcj1BcnJheS5wcm90b3R5cGU7bnVsbD09T3JbU3JdJiZMdC5mKE9yLFNyLHtjb25maWd1cmFibGU6ITAsdmFsdWU6T24obnVsbCl9KTt2YXIgRXIsanIsSXIsVHI9ZnVuY3Rpb24odCl7T3JbU3JdW3RdPSEwO30sQXI9e30sUHI9IWwoKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe31yZXR1cm4gdC5wcm90b3R5cGUuY29uc3RydWN0b3I9bnVsbCxPYmplY3QuZ2V0UHJvdG90eXBlT2YobmV3IHQpIT09dC5wcm90b3R5cGV9KSksUnI9V3QoIklFX1BST1RPIiksTXI9cy5PYmplY3Qsa3I9TXIucHJvdG90eXBlLExyPVByP01yLmdldFByb3RvdHlwZU9mOmZ1bmN0aW9uKHQpe3ZhciBlPXV0KHQpO2lmKGN0KGUsUnIpKXJldHVybiBlW1JyXTt2YXIgbj1lLmNvbnN0cnVjdG9yO3JldHVybiBMKG4pJiZlIGluc3RhbmNlb2Ygbj9uLnByb3RvdHlwZTplIGluc3RhbmNlb2YgTXI/a3I6bnVsbH0sRnI9Z3QoIml0ZXJhdG9yIiksQ3I9ITE7W10ua2V5cyYmKCJuZXh0ImluKElyPVtdLmtleXMoKSk/KGpyPUxyKExyKElyKSkpIT09T2JqZWN0LnByb3RvdHlwZSYmKEVyPWpyKTpDcj0hMCk7dmFyIE5yPW51bGw9PUVyfHxsKChmdW5jdGlvbigpe3ZhciB0PXt9O3JldHVybiBFcltGcl0uY2FsbCh0KSE9PXR9KSk7TnImJihFcj17fSksTChFcltGcl0pfHxvZShFcixGciwoZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30pKTt2YXIgenI9e0l0ZXJhdG9yUHJvdG90eXBlOkVyLEJVR0dZX1NBRkFSSV9JVEVSQVRPUlM6Q3J9LF9yPUx0LmYsRHI9Z3QoInRvU3RyaW5nVGFnIiksVXI9ZnVuY3Rpb24odCxlLG4pe3QmJiFjdCh0PW4/dDp0LnByb3RvdHlwZSxEcikmJl9yKHQsRHIse2NvbmZpZ3VyYWJsZTohMCx2YWx1ZTplfSk7fSxHcj16ci5JdGVyYXRvclByb3RvdHlwZSxCcj1mdW5jdGlvbigpe3JldHVybiB0aGlzfSxXcj1zLlN0cmluZyxWcj1zLlR5cGVFcnJvcixIcj1PYmplY3Quc2V0UHJvdG90eXBlT2Z8fCgiX19wcm90b19fImlue30/ZnVuY3Rpb24oKXt2YXIgdCxlPSExLG49e307dHJ5eyh0PU8oT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihPYmplY3QucHJvdG90eXBlLCJfX3Byb3RvX18iKS5zZXQpKShuLFtdKSxlPW4gaW5zdGFuY2VvZiBBcnJheTt9Y2F0Y2godCl7fXJldHVybiBmdW5jdGlvbihuLHIpe3JldHVybiBSdChuKSxmdW5jdGlvbih0KXtpZigib2JqZWN0Ij09dHlwZW9mIHR8fEwodCkpcmV0dXJuIHQ7dGhyb3cgVnIoIkNhbid0IHNldCAiK1dyKHQpKyIgYXMgYSBwcm90b3R5cGUiKX0ociksZT90KG4scik6bi5fX3Byb3RvX189cixufX0oKTp2b2lkIDApLHFyPXJlLlBST1BFUixLcj1yZS5DT05GSUdVUkFCTEUsWXI9enIuSXRlcmF0b3JQcm90b3R5cGUsWHI9enIuQlVHR1lfU0FGQVJJX0lURVJBVE9SUywkcj1ndCgiaXRlcmF0b3IiKSxKcj0ia2V5cyIsUXI9InZhbHVlcyIsWnI9ImVudHJpZXMiLHRvPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9LGVvPWZ1bmN0aW9uKHQsZSxuLHIsbyxpLHUpeyFmdW5jdGlvbih0LGUsbixyKXt2YXIgbz1lKyIgSXRlcmF0b3IiO3QucHJvdG90eXBlPU9uKEdyLHtuZXh0Om0oKyFyLG4pfSksVXIodCxvLCExKSxBcltvXT1Ccjt9KG4sZSxyKTt2YXIgYSxjLGYscz1mdW5jdGlvbih0KXtpZih0PT09byYmeSlyZXR1cm4geTtpZighWHImJnQgaW4gZClyZXR1cm4gZFt0XTtzd2l0Y2godCl7Y2FzZSBKcjpjYXNlIFFyOmNhc2UgWnI6cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBuKHRoaXMsdCl9fXJldHVybiBmdW5jdGlvbigpe3JldHVybiBuZXcgbih0aGlzKX19LGw9ZSsiIEl0ZXJhdG9yIixwPSExLGQ9dC5wcm90b3R5cGUsaD1kWyRyXXx8ZFsiQEBpdGVyYXRvciJdfHxvJiZkW29dLHk9IVhyJiZofHxzKG8pLGc9IkFycmF5Ij09ZSYmZC5lbnRyaWVzfHxoO2lmKGcmJihhPUxyKGcuY2FsbChuZXcgdCkpKSE9PU9iamVjdC5wcm90b3R5cGUmJmEubmV4dCYmKExyKGEpIT09WXImJihIcj9IcihhLFlyKTpMKGFbJHJdKXx8b2UoYSwkcix0bykpLFVyKGEsbCwhMCkpLHFyJiZvPT1RciYmaCYmaC5uYW1lIT09UXImJihLcj9GdChkLCJuYW1lIixRcik6KHA9ITAseT1mdW5jdGlvbigpe3JldHVybiB2KGgsdGhpcyl9KSksbylpZihjPXt2YWx1ZXM6cyhRciksa2V5czppP3k6cyhKciksZW50cmllczpzKFpyKX0sdSlmb3IoZiBpbiBjKShYcnx8cHx8IShmIGluIGQpKSYmb2UoZCxmLGNbZl0pO2Vsc2UgTGUoe3RhcmdldDplLHByb3RvOiEwLGZvcmNlZDpYcnx8cH0sYyk7cmV0dXJuIGRbJHJdIT09eSYmb2UoZCwkcix5LHtuYW1lOm99KSxBcltlXT15LGN9LG5vPSJBcnJheSBJdGVyYXRvciIscm89WnQuc2V0LG9vPVp0LmdldHRlckZvcihubyksaW89ZW8oQXJyYXksIkFycmF5IiwoZnVuY3Rpb24odCxlKXtybyh0aGlzLHt0eXBlOm5vLHRhcmdldDprKHQpLGluZGV4OjAsa2luZDplfSk7fSksKGZ1bmN0aW9uKCl7dmFyIHQ9b28odGhpcyksZT10LnRhcmdldCxuPXQua2luZCxyPXQuaW5kZXgrKztyZXR1cm4gIWV8fHI+PWUubGVuZ3RoPyh0LnRhcmdldD12b2lkIDAse3ZhbHVlOnZvaWQgMCxkb25lOiEwfSk6ImtleXMiPT1uP3t2YWx1ZTpyLGRvbmU6ITF9OiJ2YWx1ZXMiPT1uP3t2YWx1ZTplW3JdLGRvbmU6ITF9Ont2YWx1ZTpbcixlW3JdXSxkb25lOiExfX0pLCJ2YWx1ZXMiKTtBci5Bcmd1bWVudHM9QXIuQXJyYXksVHIoImtleXMiKSxUcigidmFsdWVzIiksVHIoImVudHJpZXMiKTt2YXIgdW89ZXIuY2hhckF0LGFvPSJTdHJpbmcgSXRlcmF0b3IiLGNvPVp0LnNldCxmbz1adC5nZXR0ZXJGb3IoYW8pO2VvKFN0cmluZywiU3RyaW5nIiwoZnVuY3Rpb24odCl7Y28odGhpcyx7dHlwZTphbyxzdHJpbmc6YW4odCksaW5kZXg6MH0pO30pLChmdW5jdGlvbigpe3ZhciB0LGU9Zm8odGhpcyksbj1lLnN0cmluZyxyPWUuaW5kZXg7cmV0dXJuIHI+PW4ubGVuZ3RoP3t2YWx1ZTp2b2lkIDAsZG9uZTohMH06KHQ9dW8obixyKSxlLmluZGV4Kz10Lmxlbmd0aCx7dmFsdWU6dCxkb25lOiExfSl9KSk7dmFyIHNvPWZ1bmN0aW9uKHQsZSxuKXtmb3IodmFyIHIgaW4gZSlvZSh0LHIsZVtyXSxuKTtyZXR1cm4gdH0sbG89d2UuZixwbz0ib2JqZWN0Ij09dHlwZW9mIHdpbmRvdyYmd2luZG93JiZPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcz9PYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh3aW5kb3cpOltdLHZvPXtmOmZ1bmN0aW9uKHQpe3JldHVybiBwbyYmIldpbmRvdyI9PUkodCk/ZnVuY3Rpb24odCl7dHJ5e3JldHVybiBsbyh0KX1jYXRjaCh0KXtyZXR1cm4gdXIocG8pfX0odCk6bG8oayh0KSl9fSxobz1sKChmdW5jdGlvbigpe2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBBcnJheUJ1ZmZlcil7dmFyIHQ9bmV3IEFycmF5QnVmZmVyKDgpO09iamVjdC5pc0V4dGVuc2libGUodCkmJk9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCJhIix7dmFsdWU6OH0pO319KSkseW89T2JqZWN0LmlzRXh0ZW5zaWJsZSxnbz1sKChmdW5jdGlvbigpe3lvKDEpO30pKXx8aG8/ZnVuY3Rpb24odCl7cmV0dXJuICEhRih0KSYmKCghaG98fCJBcnJheUJ1ZmZlciIhPUkodCkpJiYoIXlvfHx5byh0KSkpfTp5byxtbz0hbCgoZnVuY3Rpb24oKXtyZXR1cm4gT2JqZWN0LmlzRXh0ZW5zaWJsZShPYmplY3QucHJldmVudEV4dGVuc2lvbnMoe30pKX0pKSxibz11KChmdW5jdGlvbih0KXt2YXIgZT1MdC5mLG49ITEscj1wdCgibWV0YSIpLG89MCxpPWZ1bmN0aW9uKHQpe2UodCxyLHt2YWx1ZTp7b2JqZWN0SUQ6Ik8iK28rKyx3ZWFrRGF0YTp7fX19KTt9LHU9dC5leHBvcnRzPXtlbmFibGU6ZnVuY3Rpb24oKXt1LmVuYWJsZT1mdW5jdGlvbigpe30sbj0hMDt2YXIgdD13ZS5mLGU9TyhbXS5zcGxpY2UpLG89e307b1tyXT0xLHQobykubGVuZ3RoJiYod2UuZj1mdW5jdGlvbihuKXtmb3IodmFyIG89dChuKSxpPTAsdT1vLmxlbmd0aDtpPHU7aSsrKWlmKG9baV09PT1yKXtlKG8saSwxKTticmVha31yZXR1cm4gb30sTGUoe3RhcmdldDoiT2JqZWN0IixzdGF0OiEwLGZvcmNlZDohMH0se2dldE93blByb3BlcnR5TmFtZXM6dm8uZn0pKTt9LGZhc3RLZXk6ZnVuY3Rpb24odCxlKXtpZighRih0KSlyZXR1cm4gInN5bWJvbCI9PXR5cGVvZiB0P3Q6KCJzdHJpbmciPT10eXBlb2YgdD8iUyI6IlAiKSt0O2lmKCFjdCh0LHIpKXtpZighZ28odCkpcmV0dXJuICJGIjtpZighZSlyZXR1cm4gIkUiO2kodCk7fXJldHVybiB0W3JdLm9iamVjdElEfSxnZXRXZWFrRGF0YTpmdW5jdGlvbih0LGUpe2lmKCFjdCh0LHIpKXtpZighZ28odCkpcmV0dXJuICEwO2lmKCFlKXJldHVybiAhMTtpKHQpO31yZXR1cm4gdFtyXS53ZWFrRGF0YX0sb25GcmVlemU6ZnVuY3Rpb24odCl7cmV0dXJuIG1vJiZuJiZnbyh0KSYmIWN0KHQscikmJmkodCksdH19O1Z0W3JdPSEwO30pKSx3bz1PKE8uYmluZCkseG89ZnVuY3Rpb24odCxlKXtyZXR1cm4gSih0KSx2b2lkIDA9PT1lP3Q6d28/d28odCxlKTpmdW5jdGlvbigpe3JldHVybiB0LmFwcGx5KGUsYXJndW1lbnRzKX19LFNvPWd0KCJpdGVyYXRvciIpLE9vPUFycmF5LnByb3RvdHlwZSxFbz1ndCgiaXRlcmF0b3IiKSxqbz1mdW5jdGlvbih0KXtpZihudWxsIT10KXJldHVybiBRKHQsRW8pfHxRKHQsIkBAaXRlcmF0b3IiKXx8QXJbR2UodCldfSxJbz1zLlR5cGVFcnJvcixUbz1mdW5jdGlvbih0LGUsbil7dmFyIHIsbztSdCh0KTt0cnl7aWYoIShyPVEodCwicmV0dXJuIikpKXtpZigidGhyb3ciPT09ZSl0aHJvdyBuO3JldHVybiBufXI9dihyLHQpO31jYXRjaCh0KXtvPSEwLHI9dDt9aWYoInRocm93Ij09PWUpdGhyb3cgbjtpZihvKXRocm93IHI7cmV0dXJuIFJ0KHIpLG59LEFvPXMuVHlwZUVycm9yLFBvPWZ1bmN0aW9uKHQsZSl7dGhpcy5zdG9wcGVkPXQsdGhpcy5yZXN1bHQ9ZTt9LFJvPVBvLnByb3RvdHlwZSxNbz1mdW5jdGlvbih0LGUsbil7dmFyIHIsbyxpLHUsYSxjLGYscyxsPW4mJm4udGhhdCxwPSEoIW58fCFuLkFTX0VOVFJJRVMpLGQ9ISghbnx8IW4uSVNfSVRFUkFUT1IpLGg9ISghbnx8IW4uSU5URVJSVVBURUQpLHk9eG8oZSxsKSxnPWZ1bmN0aW9uKHQpe3JldHVybiByJiZUbyhyLCJub3JtYWwiLHQpLG5ldyBQbyghMCx0KX0sbT1mdW5jdGlvbih0KXtyZXR1cm4gcD8oUnQodCksaD95KHRbMF0sdFsxXSxnKTp5KHRbMF0sdFsxXSkpOmg/eSh0LGcpOnkodCl9O2lmKGQpcj10O2Vsc2Uge2lmKCEobz1qbyh0KSkpdGhyb3cgQW8oWCh0KSsiIGlzIG5vdCBpdGVyYWJsZSIpO2lmKHZvaWQgMCE9PShzPW8pJiYoQXIuQXJyYXk9PT1zfHxPb1tTb109PT1zKSl7Zm9yKGk9MCx1PWRlKHQpO3U+aTtpKyspaWYoKGE9bSh0W2ldKSkmJnooUm8sYSkpcmV0dXJuIGE7cmV0dXJuIG5ldyBQbyghMSl9cj1mdW5jdGlvbih0LGUpe3ZhciBuPWFyZ3VtZW50cy5sZW5ndGg8Mj9qbyh0KTplO2lmKEoobikpcmV0dXJuIFJ0KHYobix0KSk7dGhyb3cgSW8oWCh0KSsiIGlzIG5vdCBpdGVyYWJsZSIpfSh0LG8pO31mb3IoYz1yLm5leHQ7IShmPXYoYyxyKSkuZG9uZTspe3RyeXthPW0oZi52YWx1ZSk7fWNhdGNoKHQpe1RvKHIsInRocm93Iix0KTt9aWYoIm9iamVjdCI9PXR5cGVvZiBhJiZhJiZ6KFJvLGEpKXJldHVybiBhfXJldHVybiBuZXcgUG8oITEpfSxrbz1zLlR5cGVFcnJvcixMbz1mdW5jdGlvbih0LGUpe2lmKHooZSx0KSlyZXR1cm4gdDt0aHJvdyBrbygiSW5jb3JyZWN0IGludm9jYXRpb24iKX0sRm89Z3QoIml0ZXJhdG9yIiksQ289ITE7dHJ5e3ZhciBObz0wLHpvPXtuZXh0OmZ1bmN0aW9uKCl7cmV0dXJuIHtkb25lOiEhTm8rK319LHJldHVybjpmdW5jdGlvbigpe0NvPSEwO319O3pvW0ZvXT1mdW5jdGlvbigpe3JldHVybiB0aGlzfSxBcnJheS5mcm9tKHpvLChmdW5jdGlvbigpe3Rocm93IDJ9KSk7fWNhdGNoKHQpe312YXIgX289ZnVuY3Rpb24odCxlKXtpZighZSYmIUNvKXJldHVybiAhMTt2YXIgbj0hMTt0cnl7dmFyIHI9e307cltGb109ZnVuY3Rpb24oKXtyZXR1cm4ge25leHQ6ZnVuY3Rpb24oKXtyZXR1cm4ge2RvbmU6bj0hMH19fX0sdChyKTt9Y2F0Y2godCl7fXJldHVybiBufSxEbz1ndCgic3BlY2llcyIpLFVvPXMuQXJyYXksR289ZnVuY3Rpb24odCxlKXtyZXR1cm4gbmV3KGZ1bmN0aW9uKHQpe3ZhciBlO3JldHVybiBGZSh0KSYmKGU9dC5jb25zdHJ1Y3RvciwoWGUoZSkmJihlPT09VW98fEZlKGUucHJvdG90eXBlKSl8fEYoZSkmJm51bGw9PT0oZT1lW0RvXSkpJiYoZT12b2lkIDApKSx2b2lkIDA9PT1lP1VvOmV9KHQpKSgwPT09ZT8wOmUpfSxCbz1PKFtdLnB1c2gpLFdvPWZ1bmN0aW9uKHQpe3ZhciBlPTE9PXQsbj0yPT10LHI9Mz09dCxvPTQ9PXQsaT02PT10LHU9Nz09dCxhPTU9PXR8fGk7cmV0dXJuIGZ1bmN0aW9uKGMsZixzLGwpe2Zvcih2YXIgcCxkLHY9dXQoYyksaD1QKHYpLHk9eG8oZixzKSxnPWRlKGgpLG09MCxiPWx8fEdvLHc9ZT9iKGMsZyk6bnx8dT9iKGMsMCk6dm9pZCAwO2c+bTttKyspaWYoKGF8fG0gaW4gaCkmJihkPXkocD1oW21dLG0sdiksdCkpaWYoZSl3W21dPWQ7ZWxzZSBpZihkKXN3aXRjaCh0KXtjYXNlIDM6cmV0dXJuICEwO2Nhc2UgNTpyZXR1cm4gcDtjYXNlIDY6cmV0dXJuIG07Y2FzZSAyOkJvKHcscCk7fWVsc2Ugc3dpdGNoKHQpe2Nhc2UgNDpyZXR1cm4gITE7Y2FzZSA3OkJvKHcscCk7fXJldHVybiBpPy0xOnJ8fG8/bzp3fX0sVm89e2ZvckVhY2g6V28oMCksbWFwOldvKDEpLGZpbHRlcjpXbygyKSxzb21lOldvKDMpLGV2ZXJ5OldvKDQpLGZpbmQ6V28oNSksZmluZEluZGV4OldvKDYpLGZpbHRlclJlamVjdDpXbyg3KX0sSG89Ym8uZ2V0V2Vha0RhdGEscW89WnQuc2V0LEtvPVp0LmdldHRlckZvcixZbz1Wby5maW5kLFhvPVZvLmZpbmRJbmRleCwkbz1PKFtdLnNwbGljZSksSm89MCxRbz1mdW5jdGlvbih0KXtyZXR1cm4gdC5mcm96ZW58fCh0LmZyb3plbj1uZXcgWm8pfSxabz1mdW5jdGlvbigpe3RoaXMuZW50cmllcz1bXTt9LHRpPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIFlvKHQuZW50cmllcywoZnVuY3Rpb24odCl7cmV0dXJuIHRbMF09PT1lfSkpfTtaby5wcm90b3R5cGU9e2dldDpmdW5jdGlvbih0KXt2YXIgZT10aSh0aGlzLHQpO2lmKGUpcmV0dXJuIGVbMV19LGhhczpmdW5jdGlvbih0KXtyZXR1cm4gISF0aSh0aGlzLHQpfSxzZXQ6ZnVuY3Rpb24odCxlKXt2YXIgbj10aSh0aGlzLHQpO24/blsxXT1lOnRoaXMuZW50cmllcy5wdXNoKFt0LGVdKTt9LGRlbGV0ZTpmdW5jdGlvbih0KXt2YXIgZT1Ybyh0aGlzLmVudHJpZXMsKGZ1bmN0aW9uKGUpe3JldHVybiBlWzBdPT09dH0pKTtyZXR1cm4gfmUmJiRvKHRoaXMuZW50cmllcyxlLDEpLCEhfmV9fTt2YXIgZWksbmk9e2dldENvbnN0cnVjdG9yOmZ1bmN0aW9uKHQsZSxuLHIpe3ZhciBvPXQoKGZ1bmN0aW9uKHQsbyl7TG8odCxpKSxxbyh0LHt0eXBlOmUsaWQ6Sm8rKyxmcm96ZW46dm9pZCAwfSksbnVsbCE9byYmTW8obyx0W3JdLHt0aGF0OnQsQVNfRU5UUklFUzpufSk7fSkpLGk9by5wcm90b3R5cGUsdT1LbyhlKSxhPWZ1bmN0aW9uKHQsZSxuKXt2YXIgcj11KHQpLG89SG8oUnQoZSksITApO3JldHVybiAhMD09PW8/UW8ocikuc2V0KGUsbik6b1tyLmlkXT1uLHR9O3JldHVybiBzbyhpLHtkZWxldGU6ZnVuY3Rpb24odCl7dmFyIGU9dSh0aGlzKTtpZighRih0KSlyZXR1cm4gITE7dmFyIG49SG8odCk7cmV0dXJuICEwPT09bj9RbyhlKS5kZWxldGUodCk6biYmY3QobixlLmlkKSYmZGVsZXRlIG5bZS5pZF19LGhhczpmdW5jdGlvbih0KXt2YXIgZT11KHRoaXMpO2lmKCFGKHQpKXJldHVybiAhMTt2YXIgbj1Ibyh0KTtyZXR1cm4gITA9PT1uP1FvKGUpLmhhcyh0KTpuJiZjdChuLGUuaWQpfX0pLHNvKGksbj97Z2V0OmZ1bmN0aW9uKHQpe3ZhciBlPXUodGhpcyk7aWYoRih0KSl7dmFyIG49SG8odCk7cmV0dXJuICEwPT09bj9RbyhlKS5nZXQodCk6bj9uW2UuaWRdOnZvaWQgMH19LHNldDpmdW5jdGlvbih0LGUpe3JldHVybiBhKHRoaXMsdCxlKX19OnthZGQ6ZnVuY3Rpb24odCl7cmV0dXJuIGEodGhpcyx0LCEwKX19KSxvfX0scmk9WnQuZW5mb3JjZSxvaT0hcy5BY3RpdmVYT2JqZWN0JiYiQWN0aXZlWE9iamVjdCJpbiBzLGlpPWZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbigpe3JldHVybiB0KHRoaXMsYXJndW1lbnRzLmxlbmd0aD9hcmd1bWVudHNbMF06dm9pZCAwKX19LHVpPWZ1bmN0aW9uKHQsZSxuKXt2YXIgcj0tMSE9PXQuaW5kZXhPZigiTWFwIiksbz0tMSE9PXQuaW5kZXhPZigiV2VhayIpLGk9cj8ic2V0IjoiYWRkIix1PXNbdF0sYT11JiZ1LnByb3RvdHlwZSxjPXUsZj17fSxwPWZ1bmN0aW9uKHQpe3ZhciBlPU8oYVt0XSk7b2UoYSx0LCJhZGQiPT10P2Z1bmN0aW9uKHQpe3JldHVybiBlKHRoaXMsMD09PXQ/MDp0KSx0aGlzfToiZGVsZXRlIj09dD9mdW5jdGlvbih0KXtyZXR1cm4gIShvJiYhRih0KSkmJmUodGhpcywwPT09dD8wOnQpfToiZ2V0Ij09dD9mdW5jdGlvbih0KXtyZXR1cm4gbyYmIUYodCk/dm9pZCAwOmUodGhpcywwPT09dD8wOnQpfToiaGFzIj09dD9mdW5jdGlvbih0KXtyZXR1cm4gIShvJiYhRih0KSkmJmUodGhpcywwPT09dD8wOnQpfTpmdW5jdGlvbih0LG4pe3JldHVybiBlKHRoaXMsMD09PXQ/MDp0LG4pLHRoaXN9KTt9O2lmKE1lKHQsIUwodSl8fCEob3x8YS5mb3JFYWNoJiYhbCgoZnVuY3Rpb24oKXsobmV3IHUpLmVudHJpZXMoKS5uZXh0KCk7fSkpKSkpYz1uLmdldENvbnN0cnVjdG9yKGUsdCxyLGkpLGJvLmVuYWJsZSgpO2Vsc2UgaWYoTWUodCwhMCkpe3ZhciBkPW5ldyBjLHY9ZFtpXShvP3t9Oi0wLDEpIT1kLGg9bCgoZnVuY3Rpb24oKXtkLmhhcygxKTt9KSkseT1fbygoZnVuY3Rpb24odCl7bmV3IHUodCk7fSkpLGc9IW8mJmwoKGZ1bmN0aW9uKCl7Zm9yKHZhciB0PW5ldyB1LGU9NTtlLS07KXRbaV0oZSxlKTtyZXR1cm4gIXQuaGFzKC0wKX0pKTt5fHwoKGM9ZSgoZnVuY3Rpb24odCxlKXtMbyh0LGEpO3ZhciBuPWZ1bmN0aW9uKHQsZSxuKXt2YXIgcixvO3JldHVybiBIciYmTChyPWUuY29uc3RydWN0b3IpJiZyIT09biYmRihvPXIucHJvdG90eXBlKSYmbyE9PW4ucHJvdG90eXBlJiZIcih0LG8pLHR9KG5ldyB1LHQsYyk7cmV0dXJuIG51bGwhPWUmJk1vKGUsbltpXSx7dGhhdDpuLEFTX0VOVFJJRVM6cn0pLG59KSkpLnByb3RvdHlwZT1hLGEuY29uc3RydWN0b3I9YyksKGh8fGcpJiYocCgiZGVsZXRlIikscCgiaGFzIiksciYmcCgiZ2V0IikpLChnfHx2KSYmcChpKSxvJiZhLmNsZWFyJiZkZWxldGUgYS5jbGVhcjt9cmV0dXJuIGZbdF09YyxMZSh7Z2xvYmFsOiEwLGZvcmNlZDpjIT11fSxmKSxVcihjLHQpLG98fG4uc2V0U3Ryb25nKGMsdCxyKSxjfSgiV2Vha01hcCIsaWksbmkpO2lmKEd0JiZvaSl7ZWk9bmkuZ2V0Q29uc3RydWN0b3IoaWksIldlYWtNYXAiLCEwKSxiby5lbmFibGUoKTt2YXIgYWk9dWkucHJvdG90eXBlLGNpPU8oYWkuZGVsZXRlKSxmaT1PKGFpLmhhcyksc2k9TyhhaS5nZXQpLGxpPU8oYWkuc2V0KTtzbyhhaSx7ZGVsZXRlOmZ1bmN0aW9uKHQpe2lmKEYodCkmJiFnbyh0KSl7dmFyIGU9cmkodGhpcyk7cmV0dXJuIGUuZnJvemVufHwoZS5mcm96ZW49bmV3IGVpKSxjaSh0aGlzLHQpfHxlLmZyb3plbi5kZWxldGUodCl9cmV0dXJuIGNpKHRoaXMsdCl9LGhhczpmdW5jdGlvbih0KXtpZihGKHQpJiYhZ28odCkpe3ZhciBlPXJpKHRoaXMpO3JldHVybiBlLmZyb3plbnx8KGUuZnJvemVuPW5ldyBlaSksZmkodGhpcyx0KXx8ZS5mcm96ZW4uaGFzKHQpfXJldHVybiBmaSh0aGlzLHQpfSxnZXQ6ZnVuY3Rpb24odCl7aWYoRih0KSYmIWdvKHQpKXt2YXIgZT1yaSh0aGlzKTtyZXR1cm4gZS5mcm96ZW58fChlLmZyb3plbj1uZXcgZWkpLGZpKHRoaXMsdCk/c2kodGhpcyx0KTplLmZyb3plbi5nZXQodCl9cmV0dXJuIHNpKHRoaXMsdCl9LHNldDpmdW5jdGlvbih0LGUpe2lmKEYodCkmJiFnbyh0KSl7dmFyIG49cmkodGhpcyk7bi5mcm96ZW58fChuLmZyb3plbj1uZXcgZWkpLGZpKHRoaXMsdCk/bGkodGhpcyx0LGUpOm4uZnJvemVuLnNldCh0LGUpO31lbHNlIGxpKHRoaXMsdCxlKTtyZXR1cm4gdGhpc319KTt9dmFyIHBpPXtDU1NSdWxlTGlzdDowLENTU1N0eWxlRGVjbGFyYXRpb246MCxDU1NWYWx1ZUxpc3Q6MCxDbGllbnRSZWN0TGlzdDowLERPTVJlY3RMaXN0OjAsRE9NU3RyaW5nTGlzdDowLERPTVRva2VuTGlzdDoxLERhdGFUcmFuc2Zlckl0ZW1MaXN0OjAsRmlsZUxpc3Q6MCxIVE1MQWxsQ29sbGVjdGlvbjowLEhUTUxDb2xsZWN0aW9uOjAsSFRNTEZvcm1FbGVtZW50OjAsSFRNTFNlbGVjdEVsZW1lbnQ6MCxNZWRpYUxpc3Q6MCxNaW1lVHlwZUFycmF5OjAsTmFtZWROb2RlTWFwOjAsTm9kZUxpc3Q6MSxQYWludFJlcXVlc3RMaXN0OjAsUGx1Z2luOjAsUGx1Z2luQXJyYXk6MCxTVkdMZW5ndGhMaXN0OjAsU1ZHTnVtYmVyTGlzdDowLFNWR1BhdGhTZWdMaXN0OjAsU1ZHUG9pbnRMaXN0OjAsU1ZHU3RyaW5nTGlzdDowLFNWR1RyYW5zZm9ybUxpc3Q6MCxTb3VyY2VCdWZmZXJMaXN0OjAsU3R5bGVTaGVldExpc3Q6MCxUZXh0VHJhY2tDdWVMaXN0OjAsVGV4dFRyYWNrTGlzdDowLFRvdWNoTGlzdDowfSxkaT1FdCgic3BhbiIpLmNsYXNzTGlzdCx2aT1kaSYmZGkuY29uc3RydWN0b3ImJmRpLmNvbnN0cnVjdG9yLnByb3RvdHlwZSxoaT12aT09PU9iamVjdC5wcm90b3R5cGU/dm9pZCAwOnZpLHlpPWd0KCJpdGVyYXRvciIpLGdpPWd0KCJ0b1N0cmluZ1RhZyIpLG1pPWlvLnZhbHVlcyxiaT1mdW5jdGlvbih0LGUpe2lmKHQpe2lmKHRbeWldIT09bWkpdHJ5e0Z0KHQseWksbWkpO31jYXRjaChlKXt0W3lpXT1taTt9aWYodFtnaV18fEZ0KHQsZ2ksZSkscGlbZV0pZm9yKHZhciBuIGluIGlvKWlmKHRbbl0hPT1pb1tuXSl0cnl7RnQodCxuLGlvW25dKTt9Y2F0Y2goZSl7dFtuXT1pb1tuXTt9fX07Zm9yKHZhciB3aSBpbiBwaSliaShzW3dpXSYmc1t3aV0ucHJvdG90eXBlLHdpKTtiaShoaSwiRE9NVG9rZW5MaXN0Iik7dmFyIHhpPWZ1bmN0aW9uKHQsZSl7dmFyIG49W11bdF07cmV0dXJuICEhbiYmbCgoZnVuY3Rpb24oKXtuLmNhbGwobnVsbCxlfHxmdW5jdGlvbigpe3Rocm93IDF9LDEpO30pKX0sU2k9Vm8uZm9yRWFjaCxPaT14aSgiZm9yRWFjaCIpP1tdLmZvckVhY2g6ZnVuY3Rpb24odCl7cmV0dXJuIFNpKHRoaXMsdCxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCl9LEVpPWZ1bmN0aW9uKHQpe2lmKHQmJnQuZm9yRWFjaCE9PU9pKXRyeXtGdCh0LCJmb3JFYWNoIixPaSk7fWNhdGNoKGUpe3QuZm9yRWFjaD1PaTt9fTtmb3IodmFyIGppIGluIHBpKXBpW2ppXSYmRWkoc1tqaV0mJnNbamldLnByb3RvdHlwZSk7RWkoaGkpO3ZhciBJaSxUaSxBaSxQaSxSaT1zLlByb21pc2UsTWk9Z3QoInNwZWNpZXMiKSxraT0vKD86aXBhZHxpcGhvbmV8aXBvZCkuKmFwcGxld2Via2l0L2kudGVzdChfKSxMaT0icHJvY2VzcyI9PUkocy5wcm9jZXNzKSxGaT1zLnNldEltbWVkaWF0ZSxDaT1zLmNsZWFySW1tZWRpYXRlLE5pPXMucHJvY2Vzcyx6aT1zLkRpc3BhdGNoLF9pPXMuRnVuY3Rpb24sRGk9cy5NZXNzYWdlQ2hhbm5lbCxVaT1zLlN0cmluZyxHaT0wLEJpPXt9LFdpPSJvbnJlYWR5c3RhdGVjaGFuZ2UiO3RyeXtJaT1zLmxvY2F0aW9uO31jYXRjaCh0KXt9dmFyIFZpPWZ1bmN0aW9uKHQpe2lmKGN0KEJpLHQpKXt2YXIgZT1CaVt0XTtkZWxldGUgQmlbdF0sZSgpO319LEhpPWZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbigpe1ZpKHQpO319LHFpPWZ1bmN0aW9uKHQpe1ZpKHQuZGF0YSk7fSxLaT1mdW5jdGlvbih0KXtzLnBvc3RNZXNzYWdlKFVpKHQpLElpLnByb3RvY29sKyIvLyIrSWkuaG9zdCk7fTtGaSYmQ2l8fChGaT1mdW5jdGlvbih0KXt2YXIgZT1RZShhcmd1bWVudHMsMSk7cmV0dXJuIEJpWysrR2ldPWZ1bmN0aW9uKCl7Vm4oTCh0KT90Ol9pKHQpLHZvaWQgMCxlKTt9LFRpKEdpKSxHaX0sQ2k9ZnVuY3Rpb24odCl7ZGVsZXRlIEJpW3RdO30sTGk/VGk9ZnVuY3Rpb24odCl7TmkubmV4dFRpY2soSGkodCkpO306emkmJnppLm5vdz9UaT1mdW5jdGlvbih0KXt6aS5ub3coSGkodCkpO306RGkmJiFraT8oUGk9KEFpPW5ldyBEaSkucG9ydDIsQWkucG9ydDEub25tZXNzYWdlPXFpLFRpPXhvKFBpLnBvc3RNZXNzYWdlLFBpKSk6cy5hZGRFdmVudExpc3RlbmVyJiZMKHMucG9zdE1lc3NhZ2UpJiYhcy5pbXBvcnRTY3JpcHRzJiZJaSYmImZpbGU6IiE9PUlpLnByb3RvY29sJiYhbChLaSk/KFRpPUtpLHMuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIscWksITEpKTpUaT1XaSBpbiBFdCgic2NyaXB0Iik/ZnVuY3Rpb24odCl7aG4uYXBwZW5kQ2hpbGQoRXQoInNjcmlwdCIpKS5vbnJlYWR5c3RhdGVjaGFuZ2U9ZnVuY3Rpb24oKXtobi5yZW1vdmVDaGlsZCh0aGlzKSxWaSh0KTt9O306ZnVuY3Rpb24odCl7c2V0VGltZW91dChIaSh0KSwwKTt9KTt2YXIgWWksWGksJGksSmksUWksWmksdHUsZXUsbnU9e3NldDpGaSxjbGVhcjpDaX0scnU9L2lwYWR8aXBob25lfGlwb2QvaS50ZXN0KF8pJiZ2b2lkIDAhPT1zLlBlYmJsZSxvdT0vd2ViMHMoPyEuKmNocm9tZSkvaS50ZXN0KF8pLGl1PVR0LmYsdXU9bnUuc2V0LGF1PXMuTXV0YXRpb25PYnNlcnZlcnx8cy5XZWJLaXRNdXRhdGlvbk9ic2VydmVyLGN1PXMuZG9jdW1lbnQsZnU9cy5wcm9jZXNzLHN1PXMuUHJvbWlzZSxsdT1pdShzLCJxdWV1ZU1pY3JvdGFzayIpLHB1PWx1JiZsdS52YWx1ZTtwdXx8KFlpPWZ1bmN0aW9uKCl7dmFyIHQsZTtmb3IoTGkmJih0PWZ1LmRvbWFpbikmJnQuZXhpdCgpO1hpOyl7ZT1YaS5mbixYaT1YaS5uZXh0O3RyeXtlKCk7fWNhdGNoKHQpe3Rocm93IFhpP0ppKCk6JGk9dm9pZCAwLHR9fSRpPXZvaWQgMCx0JiZ0LmVudGVyKCk7fSxraXx8TGl8fG91fHwhYXV8fCFjdT8hcnUmJnN1JiZzdS5yZXNvbHZlPygodHU9c3UucmVzb2x2ZSh2b2lkIDApKS5jb25zdHJ1Y3Rvcj1zdSxldT14byh0dS50aGVuLHR1KSxKaT1mdW5jdGlvbigpe2V1KFlpKTt9KTpMaT9KaT1mdW5jdGlvbigpe2Z1Lm5leHRUaWNrKFlpKTt9Oih1dT14byh1dSxzKSxKaT1mdW5jdGlvbigpe3V1KFlpKTt9KTooUWk9ITAsWmk9Y3UuY3JlYXRlVGV4dE5vZGUoIiIpLG5ldyBhdShZaSkub2JzZXJ2ZShaaSx7Y2hhcmFjdGVyRGF0YTohMH0pLEppPWZ1bmN0aW9uKCl7WmkuZGF0YT1RaT0hUWk7fSkpO3ZhciBkdSx2dSxodSx5dSxndT1wdXx8ZnVuY3Rpb24odCl7dmFyIGU9e2ZuOnQsbmV4dDp2b2lkIDB9OyRpJiYoJGkubmV4dD1lKSxYaXx8KFhpPWUsSmkoKSksJGk9ZTt9LG11PWZ1bmN0aW9uKHQpe3ZhciBlLG47dGhpcy5wcm9taXNlPW5ldyB0KChmdW5jdGlvbih0LHIpe2lmKHZvaWQgMCE9PWV8fHZvaWQgMCE9PW4pdGhyb3cgVHlwZUVycm9yKCJCYWQgUHJvbWlzZSBjb25zdHJ1Y3RvciIpO2U9dCxuPXI7fSkpLHRoaXMucmVzb2x2ZT1KKGUpLHRoaXMucmVqZWN0PUoobik7fSxidT17ZjpmdW5jdGlvbih0KXtyZXR1cm4gbmV3IG11KHQpfX0sd3U9ZnVuY3Rpb24odCl7dHJ5e3JldHVybiB7ZXJyb3I6ITEsdmFsdWU6dCgpfX1jYXRjaCh0KXtyZXR1cm4ge2Vycm9yOiEwLHZhbHVlOnR9fX0seHU9Im9iamVjdCI9PXR5cGVvZiB3aW5kb3csU3U9bnUuc2V0LE91PWd0KCJzcGVjaWVzIiksRXU9IlByb21pc2UiLGp1PVp0LmdldHRlckZvcihFdSksSXU9WnQuc2V0LFR1PVp0LmdldHRlckZvcihFdSksQXU9UmkmJlJpLnByb3RvdHlwZSxQdT1SaSxSdT1BdSxNdT1zLlR5cGVFcnJvcixrdT1zLmRvY3VtZW50LEx1PXMucHJvY2VzcyxGdT1idS5mLEN1PUZ1LE51PSEhKGt1JiZrdS5jcmVhdGVFdmVudCYmcy5kaXNwYXRjaEV2ZW50KSx6dT1MKHMuUHJvbWlzZVJlamVjdGlvbkV2ZW50KSxfdT0idW5oYW5kbGVkcmVqZWN0aW9uIixEdT0hMSxVdT1NZShFdSwoZnVuY3Rpb24oKXt2YXIgdD1EdChQdSksZT10IT09U3RyaW5nKFB1KTtpZighZSYmNjY9PT1XKXJldHVybiAhMDtpZihXPj01MSYmL25hdGl2ZSBjb2RlLy50ZXN0KHQpKXJldHVybiAhMTt2YXIgbj1uZXcgUHUoKGZ1bmN0aW9uKHQpe3QoMSk7fSkpLHI9ZnVuY3Rpb24odCl7dCgoZnVuY3Rpb24oKXt9KSwoZnVuY3Rpb24oKXt9KSk7fTtyZXR1cm4gKG4uY29uc3RydWN0b3I9e30pW091XT1yLCEoRHU9bi50aGVuKChmdW5jdGlvbigpe30pKWluc3RhbmNlb2Ygcil8fCFlJiZ4dSYmIXp1fSkpLEd1PVV1fHwhX28oKGZ1bmN0aW9uKHQpe1B1LmFsbCh0KS5jYXRjaCgoZnVuY3Rpb24oKXt9KSk7fSkpLEJ1PWZ1bmN0aW9uKHQpe3ZhciBlO3JldHVybiAhKCFGKHQpfHwhTChlPXQudGhlbikpJiZlfSxXdT1mdW5jdGlvbih0LGUpe2lmKCF0Lm5vdGlmaWVkKXt0Lm5vdGlmaWVkPSEwO3ZhciBuPXQucmVhY3Rpb25zO2d1KChmdW5jdGlvbigpe2Zvcih2YXIgcj10LnZhbHVlLG89MT09dC5zdGF0ZSxpPTA7bi5sZW5ndGg+aTspe3ZhciB1LGEsYyxmPW5baSsrXSxzPW8/Zi5vazpmLmZhaWwsbD1mLnJlc29sdmUscD1mLnJlamVjdCxkPWYuZG9tYWluO3RyeXtzPyhvfHwoMj09PXQucmVqZWN0aW9uJiZLdSh0KSx0LnJlamVjdGlvbj0xKSwhMD09PXM/dT1yOihkJiZkLmVudGVyKCksdT1zKHIpLGQmJihkLmV4aXQoKSxjPSEwKSksdT09PWYucHJvbWlzZT9wKE11KCJQcm9taXNlLWNoYWluIGN5Y2xlIikpOihhPUJ1KHUpKT92KGEsdSxsLHApOmwodSkpOnAocik7fWNhdGNoKHQpe2QmJiFjJiZkLmV4aXQoKSxwKHQpO319dC5yZWFjdGlvbnM9W10sdC5ub3RpZmllZD0hMSxlJiYhdC5yZWplY3Rpb24mJkh1KHQpO30pKTt9fSxWdT1mdW5jdGlvbih0LGUsbil7dmFyIHIsbztOdT8oKHI9a3UuY3JlYXRlRXZlbnQoIkV2ZW50IikpLnByb21pc2U9ZSxyLnJlYXNvbj1uLHIuaW5pdEV2ZW50KHQsITEsITApLHMuZGlzcGF0Y2hFdmVudChyKSk6cj17cHJvbWlzZTplLHJlYXNvbjpufSwhenUmJihvPXNbIm9uIit0XSk/byhyKTp0PT09X3UmJmZ1bmN0aW9uKHQsZSl7dmFyIG49cy5jb25zb2xlO24mJm4uZXJyb3ImJigxPT1hcmd1bWVudHMubGVuZ3RoP24uZXJyb3IodCk6bi5lcnJvcih0LGUpKTt9KCJVbmhhbmRsZWQgcHJvbWlzZSByZWplY3Rpb24iLG4pO30sSHU9ZnVuY3Rpb24odCl7dihTdSxzLChmdW5jdGlvbigpe3ZhciBlLG49dC5mYWNhZGUscj10LnZhbHVlO2lmKHF1KHQpJiYoZT13dSgoZnVuY3Rpb24oKXtMaT9MdS5lbWl0KCJ1bmhhbmRsZWRSZWplY3Rpb24iLHIsbik6VnUoX3UsbixyKTt9KSksdC5yZWplY3Rpb249TGl8fHF1KHQpPzI6MSxlLmVycm9yKSl0aHJvdyBlLnZhbHVlfSkpO30scXU9ZnVuY3Rpb24odCl7cmV0dXJuIDEhPT10LnJlamVjdGlvbiYmIXQucGFyZW50fSxLdT1mdW5jdGlvbih0KXt2KFN1LHMsKGZ1bmN0aW9uKCl7dmFyIGU9dC5mYWNhZGU7TGk/THUuZW1pdCgicmVqZWN0aW9uSGFuZGxlZCIsZSk6VnUoInJlamVjdGlvbmhhbmRsZWQiLGUsdC52YWx1ZSk7fSkpO30sWXU9ZnVuY3Rpb24odCxlLG4pe3JldHVybiBmdW5jdGlvbihyKXt0KGUscixuKTt9fSxYdT1mdW5jdGlvbih0LGUsbil7dC5kb25lfHwodC5kb25lPSEwLG4mJih0PW4pLHQudmFsdWU9ZSx0LnN0YXRlPTIsV3UodCwhMCkpO30sJHU9ZnVuY3Rpb24odCxlLG4pe2lmKCF0LmRvbmUpe3QuZG9uZT0hMCxuJiYodD1uKTt0cnl7aWYodC5mYWNhZGU9PT1lKXRocm93IE11KCJQcm9taXNlIGNhbid0IGJlIHJlc29sdmVkIGl0c2VsZiIpO3ZhciByPUJ1KGUpO3I/Z3UoKGZ1bmN0aW9uKCl7dmFyIG49e2RvbmU6ITF9O3RyeXt2KHIsZSxZdSgkdSxuLHQpLFl1KFh1LG4sdCkpO31jYXRjaChlKXtYdShuLGUsdCk7fX0pKToodC52YWx1ZT1lLHQuc3RhdGU9MSxXdSh0LCExKSk7fWNhdGNoKGUpe1h1KHtkb25lOiExfSxlLHQpO319fTtpZihVdSYmKFJ1PShQdT1mdW5jdGlvbih0KXtMbyh0aGlzLFJ1KSxKKHQpLHYoZHUsdGhpcyk7dmFyIGU9anUodGhpcyk7dHJ5e3QoWXUoJHUsZSksWXUoWHUsZSkpO31jYXRjaCh0KXtYdShlLHQpO319KS5wcm90b3R5cGUsKGR1PWZ1bmN0aW9uKHQpe0l1KHRoaXMse3R5cGU6RXUsZG9uZTohMSxub3RpZmllZDohMSxwYXJlbnQ6ITEscmVhY3Rpb25zOltdLHJlamVjdGlvbjohMSxzdGF0ZTowLHZhbHVlOnZvaWQgMH0pO30pLnByb3RvdHlwZT1zbyhSdSx7dGhlbjpmdW5jdGlvbih0LGUpe3ZhciBuPVR1KHRoaXMpLHI9bi5yZWFjdGlvbnMsbz1GdSgkbih0aGlzLFB1KSk7cmV0dXJuIG8ub2s9IUwodCl8fHQsby5mYWlsPUwoZSkmJmUsby5kb21haW49TGk/THUuZG9tYWluOnZvaWQgMCxuLnBhcmVudD0hMCxyW3IubGVuZ3RoXT1vLDAhPW4uc3RhdGUmJld1KG4sITEpLG8ucHJvbWlzZX0sY2F0Y2g6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMudGhlbih2b2lkIDAsdCl9fSksdnU9ZnVuY3Rpb24oKXt2YXIgdD1uZXcgZHUsZT1qdSh0KTt0aGlzLnByb21pc2U9dCx0aGlzLnJlc29sdmU9WXUoJHUsZSksdGhpcy5yZWplY3Q9WXUoWHUsZSk7fSxidS5mPUZ1PWZ1bmN0aW9uKHQpe3JldHVybiB0PT09UHV8fHQ9PT1odT9uZXcgdnUodCk6Q3UodCl9LEwoUmkpJiZBdSE9PU9iamVjdC5wcm90b3R5cGUpKXt5dT1BdS50aGVuLER1fHwob2UoQXUsInRoZW4iLChmdW5jdGlvbih0LGUpe3ZhciBuPXRoaXM7cmV0dXJuIG5ldyBQdSgoZnVuY3Rpb24odCxlKXt2KHl1LG4sdCxlKTt9KSkudGhlbih0LGUpfSkse3Vuc2FmZTohMH0pLG9lKEF1LCJjYXRjaCIsUnUuY2F0Y2gse3Vuc2FmZTohMH0pKTt0cnl7ZGVsZXRlIEF1LmNvbnN0cnVjdG9yO31jYXRjaCh0KXt9SHImJkhyKEF1LFJ1KTt9TGUoe2dsb2JhbDohMCx3cmFwOiEwLGZvcmNlZDpVdX0se1Byb21pc2U6UHV9KSxVcihQdSxFdSwhMSksZnVuY3Rpb24odCl7dmFyIGU9Tih0KSxuPUx0LmY7cCYmZSYmIWVbTWldJiZuKGUsTWkse2NvbmZpZ3VyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpc319KTt9KEV1KSxodT1OKEV1KSxMZSh7dGFyZ2V0OkV1LHN0YXQ6ITAsZm9yY2VkOlV1fSx7cmVqZWN0OmZ1bmN0aW9uKHQpe3ZhciBlPUZ1KHRoaXMpO3JldHVybiB2KGUucmVqZWN0LHZvaWQgMCx0KSxlLnByb21pc2V9fSksTGUoe3RhcmdldDpFdSxzdGF0OiEwLGZvcmNlZDpVdX0se3Jlc29sdmU6ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKHQsZSl7aWYoUnQodCksRihlKSYmZS5jb25zdHJ1Y3Rvcj09PXQpcmV0dXJuIGU7dmFyIG49YnUuZih0KTtyZXR1cm4gKDAsIG4ucmVzb2x2ZSkoZSksbi5wcm9taXNlfSh0aGlzLHQpfX0pLExlKHt0YXJnZXQ6RXUsc3RhdDohMCxmb3JjZWQ6R3V9LHthbGw6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcyxuPUZ1KGUpLHI9bi5yZXNvbHZlLG89bi5yZWplY3QsaT13dSgoZnVuY3Rpb24oKXt2YXIgbj1KKGUucmVzb2x2ZSksaT1bXSx1PTAsYT0xO01vKHQsKGZ1bmN0aW9uKHQpe3ZhciBjPXUrKyxmPSExO2ErKyx2KG4sZSx0KS50aGVuKChmdW5jdGlvbih0KXtmfHwoZj0hMCxpW2NdPXQsLS1hfHxyKGkpKTt9KSxvKTt9KSksLS1hfHxyKGkpO30pKTtyZXR1cm4gaS5lcnJvciYmbyhpLnZhbHVlKSxuLnByb21pc2V9LHJhY2U6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcyxuPUZ1KGUpLHI9bi5yZWplY3Qsbz13dSgoZnVuY3Rpb24oKXt2YXIgbz1KKGUucmVzb2x2ZSk7TW8odCwoZnVuY3Rpb24odCl7dihvLGUsdCkudGhlbihuLnJlc29sdmUscik7fSkpO30pKTtyZXR1cm4gby5lcnJvciYmcihvLnZhbHVlKSxuLnByb21pc2V9fSk7dmFyIEp1PXJlLlBST1BFUixRdT0idG9TdHJpbmciLFp1PVJlZ0V4cC5wcm90b3R5cGUsdGE9WnUudG9TdHJpbmcsZWE9TyhjbiksbmE9bCgoZnVuY3Rpb24oKXtyZXR1cm4gIi9hL2IiIT10YS5jYWxsKHtzb3VyY2U6ImEiLGZsYWdzOiJiIn0pfSkpLHJhPUp1JiZ0YS5uYW1lIT1RdTsobmF8fHJhKSYmb2UoUmVnRXhwLnByb3RvdHlwZSxRdSwoZnVuY3Rpb24oKXt2YXIgdD1SdCh0aGlzKSxlPWFuKHQuc291cmNlKSxuPXQuZmxhZ3M7cmV0dXJuICIvIitlKyIvIithbih2b2lkIDA9PT1uJiZ6KFp1LHQpJiYhKCJmbGFncyJpbiBadSk/ZWEodCk6bil9KSx7dW5zYWZlOiEwfSk7dmFyIG9hPXJlLkVYSVNUUyxpYT1MdC5mLHVhPUZ1bmN0aW9uLnByb3RvdHlwZSxhYT1PKHVhLnRvU3RyaW5nKSxjYT0vZnVuY3Rpb25cYig/OlxzfFwvXCpbXFNcc10qP1wqXC98XC9cL1teXG5ccl0qW1xuXHJdKykqKFteXHMoL10qKS8sZmE9TyhjYS5leGVjKTtwJiYhb2EmJmlhKHVhLCJuYW1lIix7Y29uZmlndXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3RyeXtyZXR1cm4gZmEoY2EsYWEodGhpcykpWzFdfWNhdGNoKHQpe3JldHVybiAiIn19fSk7dmFyIHNhPW5ldyBXZWFrTWFwO2Z1bmN0aW9uIGxhKHQpe3JldHVybiB0LmdldE1lbnVDb25maWcoInVwbG9hZEltYWdlIil9ZnVuY3Rpb24gcGEodCxuKXtyZXR1cm4gbXIodGhpcyx2b2lkIDAsdm9pZCAwLChmdW5jdGlvbigpe3JldHVybiBicih0aGlzLChmdW5jdGlvbihyKXtyZXR1cm4gWzIsbmV3IFByb21pc2UoKGZ1bmN0aW9uKHIpe3ZhciBvPW5ldyBGaWxlUmVhZGVyO28ucmVhZEFzRGF0YVVSTChuKSxvLm9ubG9hZD1mdW5jdGlvbigpe3ZhciBpPW8ucmVzdWx0O2lmKGkpe3ZhciB1PWkudG9TdHJpbmcoKSxhPTA9PT11LmluZGV4T2YoImRhdGE6aW1hZ2UiKT8iIjp1O2UuaW5zZXJ0SW1hZ2VOb2RlKHQsdSxuLm5hbWUsYSkscigib2siKTt9fTt9KSldfSkpfSkpfWZ1bmN0aW9uIGRhKG4scil7cmV0dXJuIG1yKHRoaXMsdm9pZCAwLHZvaWQgMCwoZnVuY3Rpb24oKXt2YXIgbyxpLHUsYTtyZXR1cm4gYnIodGhpcywoZnVuY3Rpb24oYyl7c3dpdGNoKGMubGFiZWwpe2Nhc2UgMDpyZXR1cm4gbz1mdW5jdGlvbihuKXt2YXIgcj1zYS5nZXQobik7aWYobnVsbCE9cilyZXR1cm4gcjt2YXIgbz1sYShuKSxpPW8ub25TdWNjZXNzLHU9by5vblByb2dyZXNzLGE9by5vbkZhaWxlZCxjPW8uY3VzdG9tSW5zZXJ0LGY9by5vbkVycm9yO3JldHVybiByPXQuY3JlYXRlVXBsb2FkZXIoZ3IoZ3Ioe30sbykse29uUHJvZ3Jlc3M6ZnVuY3Rpb24odCl7bi5zaG93UHJvZ3Jlc3NCYXIodCksdSYmdSh0KTt9LG9uU3VjY2VzczpmdW5jdGlvbih0LHIpe2lmKGMpcmV0dXJuIGMociwoZnVuY3Rpb24odCxyLG8pe3JldHVybiBlLmluc2VydEltYWdlTm9kZShuLHQscixvKX0pKSx2b2lkIGkodCxyKTt2YXIgbz1yLmVycm5vLHU9dm9pZCAwPT09bz8xOm8sZj1yLmRhdGEscz12b2lkIDA9PT1mP3t9OmY7aWYoMD09PXUpe2lmKEFycmF5LmlzQXJyYXkocykpcy5mb3JFYWNoKChmdW5jdGlvbih0KXt2YXIgcj10LnVybCxvPXZvaWQgMD09PXI/IiI6cixpPXQuYWx0LHU9dm9pZCAwPT09aT8iIjppLGE9dC5ocmVmLGM9dm9pZCAwPT09YT8iIjphO2UuaW5zZXJ0SW1hZ2VOb2RlKG4sbyx1LGMpO30pKTtlbHNlIHt2YXIgbD1zLnVybCxwPXZvaWQgMD09PWw/IiI6bCxkPXMuYWx0LHY9dm9pZCAwPT09ZD8iIjpkLGg9cy5ocmVmLHk9dm9pZCAwPT09aD8iIjpoO2UuaW5zZXJ0SW1hZ2VOb2RlKG4scCx2LHkpO31pKHQscik7fWVsc2UgYSh0LHIpO30sb25FcnJvcjpmdW5jdGlvbih0LGUsbil7Zih0LGUsbik7fX0pKSxzYS5zZXQobixyKSxyfShuKSxpPXIubmFtZSx1PXIudHlwZSxhPXIuc2l6ZSxvLmFkZEZpbGUoe25hbWU6aSx0eXBlOnUsc2l6ZTphLGRhdGE6cn0pLFs0LG8udXBsb2FkKCldO2Nhc2UgMTpyZXR1cm4gYy5zZW50KCksWzJdfX0pKX0pKX1mdW5jdGlvbiB2YSh0LG4pe3ZhciByLG87cmV0dXJuIG1yKHRoaXMsdm9pZCAwLHZvaWQgMCwoZnVuY3Rpb24oKXt2YXIgaSx1LGEsYyxmLHMsbCxwLGQ7cmV0dXJuIGJyKHRoaXMsKGZ1bmN0aW9uKHYpe3N3aXRjaCh2LmxhYmVsKXtjYXNlIDA6aWYobnVsbD09bilyZXR1cm4gWzJdO2k9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwobiksdT1sYSh0KSxhPXUuY3VzdG9tVXBsb2FkLGM9dS5iYXNlNjRMaW1pdFNpemUsdi5sYWJlbD0xO2Nhc2UgMTp2LnRyeXMucHVzaChbMSwxMSwxMiwxN10pLGY9eHIoaSksdi5sYWJlbD0yO2Nhc2UgMjpyZXR1cm4gWzQsZi5uZXh0KCldO2Nhc2UgMzpyZXR1cm4gKHM9di5zZW50KCkpLmRvbmU/WzMsMTBdOihsPXMudmFsdWUscD1sLnNpemUsYyYmcDw9Yz9bNCxwYSh0LGwpXTpbMyw1XSk7Y2FzZSA0OnJldHVybiB2LnNlbnQoKSxbMyw5XTtjYXNlIDU6cmV0dXJuIGE/WzQsYShsLChmdW5jdGlvbihuLHIsbyl7cmV0dXJuIGUuaW5zZXJ0SW1hZ2VOb2RlKHQsbixyLG8pfSkpXTpbMyw3XTtjYXNlIDY6cmV0dXJuIHYuc2VudCgpLFszLDldO2Nhc2UgNzpyZXR1cm4gWzQsZGEodCxsKV07Y2FzZSA4OnYuc2VudCgpLHYubGFiZWw9OTtjYXNlIDk6cmV0dXJuIFszLDJdO2Nhc2UgMTA6cmV0dXJuIFszLDE3XTtjYXNlIDExOnJldHVybiBkPXYuc2VudCgpLHI9e2Vycm9yOmR9LFszLDE3XTtjYXNlIDEyOnJldHVybiB2LnRyeXMucHVzaChbMTIsLDE1LDE2XSkscyYmIXMuZG9uZSYmKG89Zi5yZXR1cm4pP1s0LG8uY2FsbChmKV06WzMsMTRdO2Nhc2UgMTM6di5zZW50KCksdi5sYWJlbD0xNDtjYXNlIDE0OnJldHVybiBbMywxNl07Y2FzZSAxNTppZihyKXRocm93IHIuZXJyb3I7cmV0dXJuIFs3XTtjYXNlIDE2OnJldHVybiBbN107Y2FzZSAxNzpyZXR1cm4gWzJdfX0pKX0pKX12YXIgaGE9TyhbXS5qb2luKSx5YT1QIT1PYmplY3QsZ2E9eGkoImpvaW4iLCIsIik7TGUoe3RhcmdldDoiQXJyYXkiLHByb3RvOiEwLGZvcmNlZDp5YXx8IWdhfSx7am9pbjpmdW5jdGlvbih0KXtyZXR1cm4gaGEoayh0aGlzKSx2b2lkIDA9PT10PyIsIjp0KX19KTtuLmFwcGVuZCYmKG8uZGVmYXVsdC5mbi5hcHBlbmQ9bi5hcHBlbmQpLG4ub24mJihvLmRlZmF1bHQuZm4ub249bi5vbiksbi5yZW1vdmUmJihvLmRlZmF1bHQuZm4ucmVtb3ZlPW4ucmVtb3ZlKSxuLnZhbCYmKG8uZGVmYXVsdC5mbi52YWw9bi52YWwpLG4uY2xpY2smJihvLmRlZmF1bHQuZm4uY2xpY2s9bi5jbGljayksbi5oaWRlJiYoby5kZWZhdWx0LmZuLmhpZGU9bi5oaWRlKTt2YXIgbWE9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKCl7dGhpcy50aXRsZT10LnQoInVwbG9hZEltZ01vZHVsZS51cGxvYWRJbWFnZSIpLHRoaXMuaWNvblN2Zz0nPHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0Ij48cGF0aCBkPSJNODI4LjcwODU3MSA1ODUuMDQ1MzMzYTQ4Ljc2MTkwNSA0OC43NjE5MDUgMCAwIDAtNDguNzM3NTIzIDQ4Ljc2MTkwNXYxOC41Mjk1MjRsLTcyLjE0MzIzOC03Mi4xNjc2MTlhMTM1Ljk3MjU3MSAxMzUuOTcyNTcxIDAgMCAwLTE5MS41ODU1MjQgMGwtMzQuMTMzMzM0IDM0LjEzMzMzMy0xMjAuODgwNzYyLTEyMC45NTM5MDVhMTM4Ljg5ODI4NiAxMzguODk4Mjg2IDAgMCAwLTE5MS41ODU1MjMgMGwtNzIuMTY3NjE5IDcyLjE2NzYxOVYyOTIuNDAwNzYyYTQ4Ljc4NjI4NiA0OC43ODYyODYgMCAwIDEgNDguNzYxOTA0LTQ4Ljc2MTkwNWgzNDEuMjM1ODFhNDguNzM3NTI0IDQ4LjczNzUyNCAwIDAgMCAzNC40NzQ2NjctODMuMjg1MzMzIDQ4LjczNzUyNCA0OC43Mzc1MjQgMCAwIDAtMzQuNDc0NjY3LTE0LjI4NzIzOEgxNDYuMjM2OTUyQTE0Ni4yMTI1NzEgMTQ2LjIxMjU3MSAwIDAgMCAwIDI5Mi40MDA3NjJ2NTg1LjI4OTE0M0ExNDYuMzU4ODU3IDE0Ni4zNTg4NTcgMCAwIDAgMTQ2LjIzNjk1MiAxMDI0aDU4NC45OTY1NzJhMTQ2LjIxMjU3MSAxNDYuMjEyNTcxIDAgMCAwIDE0Ni4yMzY5NTItMTQ2LjMxMDA5NVY2MzMuODA3MjM4YTQ4Ljc4NjI4NiA0OC43ODYyODYgMCAwIDAtNDguNzYxOTA1LTQ4Ljc2MTkwNXpNMTQ2LjI2MTMzMyA5MjYuNDUxODFhNDguNzM3NTI0IDQ4LjczNzUyNCAwIDAgMS00OC43NjE5MDQtNDguNzYxOTA1di0xNzQuMTI4NzYybDE0MS40MDk1MjMtMTQxLjQ1ODI4NmEzOC40OTc1MjQgMzguNDk3NTI0IDAgMCAxIDUzLjEyNjA5NiAwbDE1NC41MjY0NzYgMTU0LjYyNCAyMDkuNjI3NDI4IDIwOS43MjQ5NTNIMTQ2LjIzNjk1MnogbTYzMy43MzQwOTYtNDguNzYxOTA1Yy0wLjA3MzE0MyA5LjMzNzkwNS0zLjE0NTE0MyAxOC4zODMyMzgtOC43NzcxNDMgMjUuODQzODA5bC0yMTkuODQzMDQ4LTIyMC45NDAxOSAzNC4xMzMzMzMtMzQuMTMzMzM0YTM3LjU0NjY2NyAzNy41NDY2NjcgMCAwIDEgNTMuNjEzNzE1IDBsMTQwLjg3MzE0MyAxNDEuODk3MTQzVjg3Ny43MTQyODZ6TTEwMDkuNjE1MjM4IDE2MC4yMzE2MTlMODYzLjMyOTUyNCAxMy44OTcxNDNhNDguNzM3NTI0IDQ4LjczNzUyNCAwIDAgMC0xNi4wOTE0MjktMTAuMjRjLTExLjg0OTE0My00Ljg3NjE5LTI1LjE2MTE0My00Ljg3NjE5LTM3LjA1OTA0NyAwYTQ4Ljc2MTkwNSA0OC43NjE5MDUgMCAwIDAtMTYuMDY3MDQ4IDEwLjI0bC0xNDYuMjM2OTUyIDE0Ni4zMzQ0NzZhNDkuMDA1NzE0IDQ5LjAwNTcxNCAwIDAgMCA2OS4yMTc1MjMgNjkuMjQxOTA1bDYyLjkwMjg1OC02My4zOTA0NzZ2MjcyLjYyNzgwOWE0OC43NjE5MDUgNDguNzYxOTA1IDAgMSAwIDk3LjQ3NTA0NyAwVjE2Ni4wODMwNDhsNjIuOTAyODU3IDYzLjM5MDQ3NmE0OC43Mzc1MjQgNDguNzM3NTI0IDAgMCAwIDY5LjIxNzUyNCAwIDQ4Ljc2MTkwNSA0OC43NjE5MDUgMCAwIDAgMC02OS4yNDE5MDV6Ij48L3BhdGg+PC9zdmc+Jyx0aGlzLnRhZz0iYnV0dG9uIjt9cmV0dXJuIG4ucHJvdG90eXBlLmdldFZhbHVlPWZ1bmN0aW9uKHQpe3JldHVybiAiIn0sbi5wcm90b3R5cGUuaXNBY3RpdmU9ZnVuY3Rpb24odCl7cmV0dXJuICExfSxuLnByb3RvdHlwZS5pc0Rpc2FibGVkPWZ1bmN0aW9uKHQpe3JldHVybiBlLmlzSW5zZXJ0SW1hZ2VNZW51RGlzYWJsZWQodCl9LG4ucHJvdG90eXBlLmdldE1lbnVDb25maWc9ZnVuY3Rpb24odCl7cmV0dXJuIHQuZ2V0TWVudUNvbmZpZygidXBsb2FkSW1hZ2UiKX0sbi5wcm90b3R5cGUuZXhlYz1mdW5jdGlvbih0LG4pe3ZhciByPXRoaXMuZ2V0TWVudUNvbmZpZyh0KSxpPXIuYWxsb3dlZEZpbGVUeXBlcyx1PXZvaWQgMD09PWk/W106aSxhPXIuY3VzdG9tQnJvd3NlQW5kVXBsb2FkO2lmKGEpYSgoZnVuY3Rpb24obixyLG8pe3JldHVybiBlLmluc2VydEltYWdlTm9kZSh0LG4scixvKX0pKTtlbHNlIHt2YXIgYz0iIjt1Lmxlbmd0aD4wJiYoYz0nYWNjZXB0PSInK3Uuam9pbigiLCAiKSsnIicpO3ZhciBmPW8uZGVmYXVsdCgiYm9keSIpLHM9by5kZWZhdWx0KCc8aW5wdXQgdHlwZT0iZmlsZSIgJytjKyIgbXVsdGlwbGUvPiIpO3MuaGlkZSgpLGYuYXBwZW5kKHMpLHMuY2xpY2soKSxzLm9uKCJjaGFuZ2UiLChmdW5jdGlvbigpe3ZhciBlPXNbMF0uZmlsZXM7dmEodCxlKTt9KSk7fX0sbn0oKTt2YXIgYmE9e21lbnVzOlt7a2V5OiJ1cGxvYWRJbWFnZSIsZmFjdG9yeTpmdW5jdGlvbigpe3JldHVybiBuZXcgbWF9LGNvbmZpZzp7c2VydmVyOiIiLGZpZWxkTmFtZToid2FuZ2VkaXRvci11cGxvYWRlZC1pbWFnZSIsbWF4RmlsZVNpemU6MjA5NzE1MixtYXhOdW1iZXJPZkZpbGVzOjEwMCxhbGxvd2VkRmlsZVR5cGVzOlsiaW1hZ2UvKiJdLG1ldGE6e30sbWV0YVdpdGhVcmw6ITEsd2l0aENyZWRlbnRpYWxzOiExLHRpbWVvdXQ6MWU0LG9uQmVmb3JlVXBsb2FkOmZ1bmN0aW9uKHQpe3JldHVybiB0fSxvblByb2dyZXNzOmZ1bmN0aW9uKHQpe30sb25TdWNjZXNzOmZ1bmN0aW9uKHQsZSl7fSxvbkZhaWxlZDpmdW5jdGlvbih0LGUpe2NvbnNvbGUuZXJyb3IoIiciK3QubmFtZSsiJyB1cGxvYWQgZmFpbGVkIixlKTt9LG9uRXJyb3I6ZnVuY3Rpb24odCxlLG4pe2NvbnNvbGUuZXJyb3IoIiciK3QubmFtZSsiJyB1cGxvYWQgZXJyb3IiLG4pO30sYmFzZTY0TGltaXRTaXplOjB9fV0sZWRpdG9yUGx1Z2luOmZ1bmN0aW9uKHQpe3ZhciBuPXQuaW5zZXJ0RGF0YSxyPXQ7cmV0dXJuIHIuaW5zZXJ0RGF0YT1mdW5jdGlvbihvKXtpZihlLmlzSW5zZXJ0SW1hZ2VNZW51RGlzYWJsZWQocikpbihvKTtlbHNlIGlmKG8uZ2V0RGF0YSgidGV4dC9wbGFpbiIpKW4obyk7ZWxzZSB7dmFyIGk9by5maWxlcztpZihpLmxlbmd0aDw9MCluKG8pO2Vsc2UgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoaSkuc29tZSgoZnVuY3Rpb24odCl7cmV0dXJuICJpbWFnZSI9PT1mdW5jdGlvbih0LGUpe3ZhciBuPSJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2wmJnRbU3ltYm9sLml0ZXJhdG9yXTtpZighbilyZXR1cm4gdDt2YXIgcixvLGk9bi5jYWxsKHQpLHU9W107dHJ5e2Zvcig7KHZvaWQgMD09PWV8fGUtLSA+MCkmJiEocj1pLm5leHQoKSkuZG9uZTspdS5wdXNoKHIudmFsdWUpO31jYXRjaCh0KXtvPXtlcnJvcjp0fTt9ZmluYWxseXt0cnl7ciYmIXIuZG9uZSYmKG49aS5yZXR1cm4pJiZuLmNhbGwoaSk7fWZpbmFsbHl7aWYobyl0aHJvdyBvLmVycm9yfX1yZXR1cm4gdX0odC50eXBlLnNwbGl0KCIvIiksMSlbMF19KSk/dmEodCxpKTpuKG8pO319LHJ9fTtyZXR1cm4gYmF9KSk7CgogIH0pOwoKICB2YXIgZGlzdCA9IGNyZWF0ZUNvbW1vbmpzTW9kdWxlJDEoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICFmdW5jdGlvbihlLHQpe3QoZXhwb3J0cyxkaXN0JDYscmVxdWlyZSQkMSxyZXF1aXJlJCQyJDEpO30oY29tbW9uanNHbG9iYWwsKGZ1bmN0aW9uKGUsdCxuLGEpe2Z1bmN0aW9uIHIoZSl7cmV0dXJuIGUmJiJvYmplY3QiPT10eXBlb2YgZSYmImRlZmF1bHQiaW4gZT9lOntkZWZhdWx0OmV9fXZhciBpPXIobik7dC5pMThuQWRkUmVzb3VyY2VzKCJlbiIse2hpZ2hMaWdodE1vZHVsZTp7c2VsZWN0TGFuZzoiTGFuZ3VhZ2UifX0pLHQuaTE4bkFkZFJlc291cmNlcygiemgtQ04iLHtoaWdoTGlnaHRNb2R1bGU6e3NlbGVjdExhbmc6IumAieaLqeivreiogCJ9fSk7dmFyIHM9InVuZGVmaW5lZCIhPXR5cGVvZiBnbG9iYWxUaGlzP2dsb2JhbFRoaXM6InVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3c/d2luZG93OiJ1bmRlZmluZWQiIT10eXBlb2YgY29tbW9uanNHbG9iYWw/Y29tbW9uanNHbG9iYWw6InVuZGVmaW5lZCIhPXR5cGVvZiBzZWxmP3NlbGY6e307ZnVuY3Rpb24gbyhlKXt2YXIgdD17ZXhwb3J0czp7fX07cmV0dXJuIGUodCx0LmV4cG9ydHMpLHQuZXhwb3J0c312YXIgbCx1LGM9ZnVuY3Rpb24oZSl7cmV0dXJuIGUmJmUuTWF0aD09TWF0aCYmZX0sZD1jKCJvYmplY3QiPT10eXBlb2YgZ2xvYmFsVGhpcyYmZ2xvYmFsVGhpcyl8fGMoIm9iamVjdCI9PXR5cGVvZiB3aW5kb3cmJndpbmRvdyl8fGMoIm9iamVjdCI9PXR5cGVvZiBzZWxmJiZzZWxmKXx8Yygib2JqZWN0Ij09dHlwZW9mIHMmJnMpfHxmdW5jdGlvbigpe3JldHVybiB0aGlzfSgpfHxGdW5jdGlvbigicmV0dXJuIHRoaXMiKSgpLHA9T2JqZWN0LmRlZmluZVByb3BlcnR5LGc9ZnVuY3Rpb24oZSx0KXt0cnl7cChkLGUse3ZhbHVlOnQsY29uZmlndXJhYmxlOiEwLHdyaXRhYmxlOiEwfSk7fWNhdGNoKG4pe2RbZV09dDt9cmV0dXJuIHR9LGY9Il9fY29yZS1qc19zaGFyZWRfXyIsYj1kW2ZdfHxnKGYse30pLGg9bygoZnVuY3Rpb24oZSl7KGUuZXhwb3J0cz1mdW5jdGlvbihlLHQpe3JldHVybiBiW2VdfHwoYltlXT12b2lkIDAhPT10P3Q6e30pfSkoInZlcnNpb25zIixbXSkucHVzaCh7dmVyc2lvbjoiMy4xOS4zIixtb2RlOiJnbG9iYWwiLGNvcHlyaWdodDoiwqkgMjAyMSBEZW5pcyBQdXNoa2FyZXYgKHpsb2lyb2NrLnJ1KSJ9KTt9KSksbT1GdW5jdGlvbi5wcm90b3R5cGUseT1tLmJpbmQsRT1tLmNhbGwsdj15JiZ5LmJpbmQoRSksUz15P2Z1bmN0aW9uKGUpe3JldHVybiBlJiZ2KEUsZSl9OmZ1bmN0aW9uKGUpe3JldHVybiBlJiZmdW5jdGlvbigpe3JldHVybiBFLmFwcGx5KGUsYXJndW1lbnRzKX19LHc9ZC5UeXBlRXJyb3Isaz1mdW5jdGlvbihlKXtpZihudWxsPT1lKXRocm93IHcoIkNhbid0IGNhbGwgbWV0aG9kIG9uICIrZSk7cmV0dXJuIGV9LEE9ZC5PYmplY3QseD1mdW5jdGlvbihlKXtyZXR1cm4gQShrKGUpKX0sVD1TKHt9Lmhhc093blByb3BlcnR5KSxfPU9iamVjdC5oYXNPd258fGZ1bmN0aW9uKGUsdCl7cmV0dXJuIFQoeChlKSx0KX0sTz0wLEk9TWF0aC5yYW5kb20oKSxSPVMoMS4udG9TdHJpbmcpLE49ZnVuY3Rpb24oZSl7cmV0dXJuICJTeW1ib2woIisodm9pZCAwPT09ZT8iIjplKSsiKV8iK1IoKytPK0ksMzYpfSxMPWZ1bmN0aW9uKGUpe3JldHVybiAiZnVuY3Rpb24iPT10eXBlb2YgZX0sUD1mdW5jdGlvbihlKXtyZXR1cm4gTChlKT9lOnZvaWQgMH0sQz1mdW5jdGlvbihlLHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPDI/UChkW2VdKTpkW2VdJiZkW2VdW3RdfSxGPUMoIm5hdmlnYXRvciIsInVzZXJBZ2VudCIpfHwiIixEPWQucHJvY2VzcywkPWQuRGVubyxNPUQmJkQudmVyc2lvbnN8fCQmJiQudmVyc2lvbixCPU0mJk0udjg7QiYmKHU9KGw9Qi5zcGxpdCgiLiIpKVswXT4wJiZsWzBdPDQ/MTorKGxbMF0rbFsxXSkpLCF1JiZGJiYoIShsPUYubWF0Y2goL0VkZ2VcLyhcZCspLykpfHxsWzFdPj03NCkmJihsPUYubWF0Y2goL0Nocm9tZVwvKFxkKykvKSkmJih1PStsWzFdKTt2YXIgVT11LGo9ZnVuY3Rpb24oZSl7dHJ5e3JldHVybiAhIWUoKX1jYXRjaChlKXtyZXR1cm4gITB9fSx6PSEhT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyYmIWooKGZ1bmN0aW9uKCl7dmFyIGU9U3ltYm9sKCk7cmV0dXJuICFTdHJpbmcoZSl8fCEoT2JqZWN0KGUpaW5zdGFuY2VvZiBTeW1ib2wpfHwhU3ltYm9sLnNoYW0mJlUmJlU8NDF9KSksRz16JiYhU3ltYm9sLnNoYW0mJiJzeW1ib2wiPT10eXBlb2YgU3ltYm9sLml0ZXJhdG9yLEg9aCgid2tzIikscT1kLlN5bWJvbCxZPXEmJnEuZm9yLFc9Rz9xOnEmJnEud2l0aG91dFNldHRlcnx8TixYPWZ1bmN0aW9uKGUpe2lmKCFfKEgsZSl8fCF6JiYic3RyaW5nIiE9dHlwZW9mIEhbZV0pe3ZhciB0PSJTeW1ib2wuIitlO3omJl8ocSxlKT9IW2VdPXFbZV06SFtlXT1HJiZZP1kodCk6Vyh0KTt9cmV0dXJuIEhbZV19LFo9e307WltYKCJ0b1N0cmluZ1RhZyIpXT0ieiI7dmFyIFY9IltvYmplY3Qgel0iPT09U3RyaW5nKFopLEs9IWooKGZ1bmN0aW9uKCl7cmV0dXJuIDchPU9iamVjdC5kZWZpbmVQcm9wZXJ0eSh7fSwxLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gN319KVsxXX0pKSxKPWZ1bmN0aW9uKGUpe3JldHVybiAib2JqZWN0Ij09dHlwZW9mIGU/bnVsbCE9PWU6TChlKX0sUT1kLmRvY3VtZW50LGVlPUooUSkmJkooUS5jcmVhdGVFbGVtZW50KSx0ZT1mdW5jdGlvbihlKXtyZXR1cm4gZWU/US5jcmVhdGVFbGVtZW50KGUpOnt9fSxuZT0hSyYmIWooKGZ1bmN0aW9uKCl7cmV0dXJuIDchPU9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0ZSgiZGl2IiksImEiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gN319KS5hfSkpLGFlPWQuU3RyaW5nLHJlPWQuVHlwZUVycm9yLGllPWZ1bmN0aW9uKGUpe2lmKEooZSkpcmV0dXJuIGU7dGhyb3cgcmUoYWUoZSkrIiBpcyBub3QgYW4gb2JqZWN0Iil9LHNlPUZ1bmN0aW9uLnByb3RvdHlwZS5jYWxsLG9lPXNlLmJpbmQ/c2UuYmluZChzZSk6ZnVuY3Rpb24oKXtyZXR1cm4gc2UuYXBwbHkoc2UsYXJndW1lbnRzKX0sbGU9Uyh7fS5pc1Byb3RvdHlwZU9mKSx1ZT1kLk9iamVjdCxjZT1HP2Z1bmN0aW9uKGUpe3JldHVybiAic3ltYm9sIj09dHlwZW9mIGV9OmZ1bmN0aW9uKGUpe3ZhciB0PUMoIlN5bWJvbCIpO3JldHVybiBMKHQpJiZsZSh0LnByb3RvdHlwZSx1ZShlKSl9LGRlPWQuU3RyaW5nLHBlPWZ1bmN0aW9uKGUpe3RyeXtyZXR1cm4gZGUoZSl9Y2F0Y2goZSl7cmV0dXJuICJPYmplY3QifX0sZ2U9ZC5UeXBlRXJyb3IsZmU9ZnVuY3Rpb24oZSl7aWYoTChlKSlyZXR1cm4gZTt0aHJvdyBnZShwZShlKSsiIGlzIG5vdCBhIGZ1bmN0aW9uIil9LGJlPWZ1bmN0aW9uKGUsdCl7dmFyIG49ZVt0XTtyZXR1cm4gbnVsbD09bj92b2lkIDA6ZmUobil9LGhlPWQuVHlwZUVycm9yLG1lPWQuVHlwZUVycm9yLHllPVgoInRvUHJpbWl0aXZlIiksRWU9ZnVuY3Rpb24oZSx0KXtpZighSihlKXx8Y2UoZSkpcmV0dXJuIGU7dmFyIG4sYT1iZShlLHllKTtpZihhKXtpZih2b2lkIDA9PT10JiYodD0iZGVmYXVsdCIpLG49b2UoYSxlLHQpLCFKKG4pfHxjZShuKSlyZXR1cm4gbjt0aHJvdyBtZSgiQ2FuJ3QgY29udmVydCBvYmplY3QgdG8gcHJpbWl0aXZlIHZhbHVlIil9cmV0dXJuIHZvaWQgMD09PXQmJih0PSJudW1iZXIiKSxmdW5jdGlvbihlLHQpe3ZhciBuLGE7aWYoInN0cmluZyI9PT10JiZMKG49ZS50b1N0cmluZykmJiFKKGE9b2UobixlKSkpcmV0dXJuIGE7aWYoTChuPWUudmFsdWVPZikmJiFKKGE9b2UobixlKSkpcmV0dXJuIGE7aWYoInN0cmluZyIhPT10JiZMKG49ZS50b1N0cmluZykmJiFKKGE9b2UobixlKSkpcmV0dXJuIGE7dGhyb3cgaGUoIkNhbid0IGNvbnZlcnQgb2JqZWN0IHRvIHByaW1pdGl2ZSB2YWx1ZSIpfShlLHQpfSx2ZT1mdW5jdGlvbihlKXt2YXIgdD1FZShlLCJzdHJpbmciKTtyZXR1cm4gY2UodCk/dDp0KyIifSxTZT1kLlR5cGVFcnJvcix3ZT1PYmplY3QuZGVmaW5lUHJvcGVydHksa2U9e2Y6Sz93ZTpmdW5jdGlvbihlLHQsbil7aWYoaWUoZSksdD12ZSh0KSxpZShuKSxuZSl0cnl7cmV0dXJuIHdlKGUsdCxuKX1jYXRjaChlKXt9aWYoImdldCJpbiBufHwic2V0ImluIG4pdGhyb3cgU2UoIkFjY2Vzc29ycyBub3Qgc3VwcG9ydGVkIik7cmV0dXJuICJ2YWx1ZSJpbiBuJiYoZVt0XT1uLnZhbHVlKSxlfX0sQWU9ZnVuY3Rpb24oZSx0KXtyZXR1cm4ge2VudW1lcmFibGU6ISgxJmUpLGNvbmZpZ3VyYWJsZTohKDImZSksd3JpdGFibGU6ISg0JmUpLHZhbHVlOnR9fSx4ZT1LP2Z1bmN0aW9uKGUsdCxuKXtyZXR1cm4ga2UuZihlLHQsQWUoMSxuKSl9OmZ1bmN0aW9uKGUsdCxuKXtyZXR1cm4gZVt0XT1uLGV9LFRlPVMoRnVuY3Rpb24udG9TdHJpbmcpO0woYi5pbnNwZWN0U291cmNlKXx8KGIuaW5zcGVjdFNvdXJjZT1mdW5jdGlvbihlKXtyZXR1cm4gVGUoZSl9KTt2YXIgX2UsT2UsSWUsUmU9Yi5pbnNwZWN0U291cmNlLE5lPWQuV2Vha01hcCxMZT1MKE5lKSYmL25hdGl2ZSBjb2RlLy50ZXN0KFJlKE5lKSksUGU9aCgia2V5cyIpLENlPWZ1bmN0aW9uKGUpe3JldHVybiBQZVtlXXx8KFBlW2VdPU4oZSkpfSxGZT17fSxEZT0iT2JqZWN0IGFscmVhZHkgaW5pdGlhbGl6ZWQiLCRlPWQuVHlwZUVycm9yLE1lPWQuV2Vha01hcDtpZihMZXx8Yi5zdGF0ZSl7dmFyIEJlPWIuc3RhdGV8fChiLnN0YXRlPW5ldyBNZSksVWU9UyhCZS5nZXQpLGplPVMoQmUuaGFzKSx6ZT1TKEJlLnNldCk7X2U9ZnVuY3Rpb24oZSx0KXtpZihqZShCZSxlKSl0aHJvdyBuZXcgJGUoRGUpO3JldHVybiB0LmZhY2FkZT1lLHplKEJlLGUsdCksdH0sT2U9ZnVuY3Rpb24oZSl7cmV0dXJuIFVlKEJlLGUpfHx7fX0sSWU9ZnVuY3Rpb24oZSl7cmV0dXJuIGplKEJlLGUpfTt9ZWxzZSB7dmFyIEdlPUNlKCJzdGF0ZSIpO0ZlW0dlXT0hMCxfZT1mdW5jdGlvbihlLHQpe2lmKF8oZSxHZSkpdGhyb3cgbmV3ICRlKERlKTtyZXR1cm4gdC5mYWNhZGU9ZSx4ZShlLEdlLHQpLHR9LE9lPWZ1bmN0aW9uKGUpe3JldHVybiBfKGUsR2UpP2VbR2VdOnt9fSxJZT1mdW5jdGlvbihlKXtyZXR1cm4gXyhlLEdlKX07fXZhciBIZT17c2V0Ol9lLGdldDpPZSxoYXM6SWUsZW5mb3JjZTpmdW5jdGlvbihlKXtyZXR1cm4gSWUoZSk/T2UoZSk6X2UoZSx7fSl9LGdldHRlckZvcjpmdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24odCl7dmFyIG47aWYoIUoodCl8fChuPU9lKHQpKS50eXBlIT09ZSl0aHJvdyAkZSgiSW5jb21wYXRpYmxlIHJlY2VpdmVyLCAiK2UrIiByZXF1aXJlZCIpO3JldHVybiBufX19LHFlPUZ1bmN0aW9uLnByb3RvdHlwZSxZZT1LJiZPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLFdlPV8ocWUsIm5hbWUiKSxYZT17RVhJU1RTOldlLFBST1BFUjpXZSYmInNvbWV0aGluZyI9PT1mdW5jdGlvbigpe30ubmFtZSxDT05GSUdVUkFCTEU6V2UmJighS3x8SyYmWWUocWUsIm5hbWUiKS5jb25maWd1cmFibGUpfSxaZT1vKChmdW5jdGlvbihlKXt2YXIgdD1YZS5DT05GSUdVUkFCTEUsbj1IZS5nZXQsYT1IZS5lbmZvcmNlLHI9U3RyaW5nKFN0cmluZykuc3BsaXQoIlN0cmluZyIpOyhlLmV4cG9ydHM9ZnVuY3Rpb24oZSxuLGkscyl7dmFyIG8sbD0hIXMmJiEhcy51bnNhZmUsdT0hIXMmJiEhcy5lbnVtZXJhYmxlLGM9ISFzJiYhIXMubm9UYXJnZXRHZXQscD1zJiZ2b2lkIDAhPT1zLm5hbWU/cy5uYW1lOm47TChpKSYmKCJTeW1ib2woIj09PVN0cmluZyhwKS5zbGljZSgwLDcpJiYocD0iWyIrU3RyaW5nKHApLnJlcGxhY2UoL15TeW1ib2xcKChbXildKilcKS8sIiQxIikrIl0iKSwoIV8oaSwibmFtZSIpfHx0JiZpLm5hbWUhPT1wKSYmeGUoaSwibmFtZSIscCksKG89YShpKSkuc291cmNlfHwoby5zb3VyY2U9ci5qb2luKCJzdHJpbmciPT10eXBlb2YgcD9wOiIiKSkpLGUhPT1kPyhsPyFjJiZlW25dJiYodT0hMCk6ZGVsZXRlIGVbbl0sdT9lW25dPWk6eGUoZSxuLGkpKTp1P2Vbbl09aTpnKG4saSk7fSkoRnVuY3Rpb24ucHJvdG90eXBlLCJ0b1N0cmluZyIsKGZ1bmN0aW9uKCl7cmV0dXJuIEwodGhpcykmJm4odGhpcykuc291cmNlfHxSZSh0aGlzKX0pKTt9KSksVmU9Uyh7fS50b1N0cmluZyksS2U9UygiIi5zbGljZSksSmU9ZnVuY3Rpb24oZSl7cmV0dXJuIEtlKFZlKGUpLDgsLTEpfSxRZT1YKCJ0b1N0cmluZ1RhZyIpLGV0PWQuT2JqZWN0LHR0PSJBcmd1bWVudHMiPT1KZShmdW5jdGlvbigpe3JldHVybiBhcmd1bWVudHN9KCkpLG50PVY/SmU6ZnVuY3Rpb24oZSl7dmFyIHQsbixhO3JldHVybiB2b2lkIDA9PT1lPyJVbmRlZmluZWQiOm51bGw9PT1lPyJOdWxsIjoic3RyaW5nIj09dHlwZW9mKG49ZnVuY3Rpb24oZSx0KXt0cnl7cmV0dXJuIGVbdF19Y2F0Y2goZSl7fX0odD1ldChlKSxRZSkpP246dHQ/SmUodCk6Ik9iamVjdCI9PShhPUplKHQpKSYmTCh0LmNhbGxlZSk/IkFyZ3VtZW50cyI6YX0sYXQ9Vj97fS50b1N0cmluZzpmdW5jdGlvbigpe3JldHVybiAiW29iamVjdCAiK250KHRoaXMpKyJdIn07Vnx8WmUoT2JqZWN0LnByb3RvdHlwZSwidG9TdHJpbmciLGF0LHt1bnNhZmU6ITB9KTt2YXIgcnQsaXQsc3Q9e0NTU1J1bGVMaXN0OjAsQ1NTU3R5bGVEZWNsYXJhdGlvbjowLENTU1ZhbHVlTGlzdDowLENsaWVudFJlY3RMaXN0OjAsRE9NUmVjdExpc3Q6MCxET01TdHJpbmdMaXN0OjAsRE9NVG9rZW5MaXN0OjEsRGF0YVRyYW5zZmVySXRlbUxpc3Q6MCxGaWxlTGlzdDowLEhUTUxBbGxDb2xsZWN0aW9uOjAsSFRNTENvbGxlY3Rpb246MCxIVE1MRm9ybUVsZW1lbnQ6MCxIVE1MU2VsZWN0RWxlbWVudDowLE1lZGlhTGlzdDowLE1pbWVUeXBlQXJyYXk6MCxOYW1lZE5vZGVNYXA6MCxOb2RlTGlzdDoxLFBhaW50UmVxdWVzdExpc3Q6MCxQbHVnaW46MCxQbHVnaW5BcnJheTowLFNWR0xlbmd0aExpc3Q6MCxTVkdOdW1iZXJMaXN0OjAsU1ZHUGF0aFNlZ0xpc3Q6MCxTVkdQb2ludExpc3Q6MCxTVkdTdHJpbmdMaXN0OjAsU1ZHVHJhbnNmb3JtTGlzdDowLFNvdXJjZUJ1ZmZlckxpc3Q6MCxTdHlsZVNoZWV0TGlzdDowLFRleHRUcmFja0N1ZUxpc3Q6MCxUZXh0VHJhY2tMaXN0OjAsVG91Y2hMaXN0OjB9LG90PXRlKCJzcGFuIikuY2xhc3NMaXN0LGx0PW90JiZvdC5jb25zdHJ1Y3RvciYmb3QuY29uc3RydWN0b3IucHJvdG90eXBlLHV0PWx0PT09T2JqZWN0LnByb3RvdHlwZT92b2lkIDA6bHQsY3Q9UyhTLmJpbmQpLGR0PWQuT2JqZWN0LHB0PVMoIiIuc3BsaXQpLGd0PWooKGZ1bmN0aW9uKCl7cmV0dXJuICFkdCgieiIpLnByb3BlcnR5SXNFbnVtZXJhYmxlKDApfSkpP2Z1bmN0aW9uKGUpe3JldHVybiAiU3RyaW5nIj09SmUoZSk/cHQoZSwiIik6ZHQoZSl9OmR0LGZ0PU1hdGguY2VpbCxidD1NYXRoLmZsb29yLGh0PWZ1bmN0aW9uKGUpe3ZhciB0PStlO3JldHVybiB0IT10fHwwPT09dD8wOih0PjA/YnQ6ZnQpKHQpfSxtdD1NYXRoLm1pbix5dD1mdW5jdGlvbihlKXtyZXR1cm4gZT4wP210KGh0KGUpLDkwMDcxOTkyNTQ3NDA5OTEpOjB9LEV0PWZ1bmN0aW9uKGUpe3JldHVybiB5dChlLmxlbmd0aCl9LHZ0PUFycmF5LmlzQXJyYXl8fGZ1bmN0aW9uKGUpe3JldHVybiAiQXJyYXkiPT1KZShlKX0sU3Q9ZnVuY3Rpb24oKXt9LHd0PVtdLGt0PUMoIlJlZmxlY3QiLCJjb25zdHJ1Y3QiKSxBdD0vXlxzKig/OmNsYXNzfGZ1bmN0aW9uKVxiLyx4dD1TKEF0LmV4ZWMpLFR0PSFBdC5leGVjKFN0KSxfdD1mdW5jdGlvbihlKXtpZighTChlKSlyZXR1cm4gITE7dHJ5e3JldHVybiBrdChTdCx3dCxlKSwhMH1jYXRjaChlKXtyZXR1cm4gITF9fSxPdD0ha3R8fGooKGZ1bmN0aW9uKCl7dmFyIGU7cmV0dXJuIF90KF90LmNhbGwpfHwhX3QoT2JqZWN0KXx8IV90KChmdW5jdGlvbigpe2U9ITA7fSkpfHxlfSkpP2Z1bmN0aW9uKGUpe2lmKCFMKGUpKXJldHVybiAhMTtzd2l0Y2gobnQoZSkpe2Nhc2UiQXN5bmNGdW5jdGlvbiI6Y2FzZSJHZW5lcmF0b3JGdW5jdGlvbiI6Y2FzZSJBc3luY0dlbmVyYXRvckZ1bmN0aW9uIjpyZXR1cm4gITF9cmV0dXJuIFR0fHwhIXh0KEF0LFJlKGUpKX06X3QsSXQ9WCgic3BlY2llcyIpLFJ0PWQuQXJyYXksTnQ9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gbmV3KGZ1bmN0aW9uKGUpe3ZhciB0O3JldHVybiB2dChlKSYmKHQ9ZS5jb25zdHJ1Y3RvciwoT3QodCkmJih0PT09UnR8fHZ0KHQucHJvdG90eXBlKSl8fEoodCkmJm51bGw9PT0odD10W0l0XSkpJiYodD12b2lkIDApKSx2b2lkIDA9PT10P1J0OnR9KGUpKSgwPT09dD8wOnQpfSxMdD1TKFtdLnB1c2gpLFB0PWZ1bmN0aW9uKGUpe3ZhciB0PTE9PWUsbj0yPT1lLGE9Mz09ZSxyPTQ9PWUsaT02PT1lLHM9Nz09ZSxvPTU9PWV8fGk7cmV0dXJuIGZ1bmN0aW9uKGwsdSxjLGQpe2Zvcih2YXIgcCxnLGY9eChsKSxiPWd0KGYpLGg9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZmUoZSksdm9pZCAwPT09dD9lOmN0P2N0KGUsdCk6ZnVuY3Rpb24oKXtyZXR1cm4gZS5hcHBseSh0LGFyZ3VtZW50cyl9fSh1LGMpLG09RXQoYikseT0wLEU9ZHx8TnQsdj10P0UobCxtKTpufHxzP0UobCwwKTp2b2lkIDA7bT55O3krKylpZigob3x8eSBpbiBiKSYmKGc9aChwPWJbeV0seSxmKSxlKSlpZih0KXZbeV09ZztlbHNlIGlmKGcpc3dpdGNoKGUpe2Nhc2UgMzpyZXR1cm4gITA7Y2FzZSA1OnJldHVybiBwO2Nhc2UgNjpyZXR1cm4geTtjYXNlIDI6THQodixwKTt9ZWxzZSBzd2l0Y2goZSl7Y2FzZSA0OnJldHVybiAhMTtjYXNlIDc6THQodixwKTt9cmV0dXJuIGk/LTE6YXx8cj9yOnZ9fSxDdD17Zm9yRWFjaDpQdCgwKSxtYXA6UHQoMSksZmlsdGVyOlB0KDIpLHNvbWU6UHQoMyksZXZlcnk6UHQoNCksZmluZDpQdCg1KSxmaW5kSW5kZXg6UHQoNiksZmlsdGVyUmVqZWN0OlB0KDcpfS5mb3JFYWNoLEZ0PSEhKGl0PVtdWyJmb3JFYWNoIl0pJiZqKChmdW5jdGlvbigpe2l0LmNhbGwobnVsbCxydHx8ZnVuY3Rpb24oKXt0aHJvdyAxfSwxKTt9KSk/W10uZm9yRWFjaDpmdW5jdGlvbihlKXtyZXR1cm4gQ3QodGhpcyxlLGFyZ3VtZW50cy5sZW5ndGg+MT9hcmd1bWVudHNbMV06dm9pZCAwKX0sRHQ9ZnVuY3Rpb24oZSl7aWYoZSYmZS5mb3JFYWNoIT09RnQpdHJ5e3hlKGUsImZvckVhY2giLEZ0KTt9Y2F0Y2godCl7ZS5mb3JFYWNoPUZ0O319O2Zvcih2YXIgJHQgaW4gc3Qpc3RbJHRdJiZEdChkWyR0XSYmZFskdF0ucHJvdG90eXBlKTtEdCh1dCk7dmFyIE10PXt9LnByb3BlcnR5SXNFbnVtZXJhYmxlLEJ0PU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IsVXQ9e2Y6QnQmJiFNdC5jYWxsKHsxOjJ9LDEpP2Z1bmN0aW9uKGUpe3ZhciB0PUJ0KHRoaXMsZSk7cmV0dXJuICEhdCYmdC5lbnVtZXJhYmxlfTpNdH0sanQ9ZnVuY3Rpb24oZSl7cmV0dXJuIGd0KGsoZSkpfSx6dD1PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLEd0PXtmOks/enQ6ZnVuY3Rpb24oZSx0KXtpZihlPWp0KGUpLHQ9dmUodCksbmUpdHJ5e3JldHVybiB6dChlLHQpfWNhdGNoKGUpe31pZihfKGUsdCkpcmV0dXJuIEFlKCFvZShVdC5mLGUsdCksZVt0XSl9fSxIdD1NYXRoLm1heCxxdD1NYXRoLm1pbixZdD1mdW5jdGlvbihlLHQpe3ZhciBuPWh0KGUpO3JldHVybiBuPDA/SHQobit0LDApOnF0KG4sdCl9LFd0PWZ1bmN0aW9uKGUpe3JldHVybiBmdW5jdGlvbih0LG4sYSl7dmFyIHIsaT1qdCh0KSxzPUV0KGkpLG89WXQoYSxzKTtpZihlJiZuIT1uKXtmb3IoO3M+bzspaWYoKHI9aVtvKytdKSE9cilyZXR1cm4gITB9ZWxzZSBmb3IoO3M+bztvKyspaWYoKGV8fG8gaW4gaSkmJmlbb109PT1uKXJldHVybiBlfHxvfHwwO3JldHVybiAhZSYmLTF9fSxYdD17aW5jbHVkZXM6V3QoITApLGluZGV4T2Y6V3QoITEpfS5pbmRleE9mLFp0PVMoW10ucHVzaCksVnQ9ZnVuY3Rpb24oZSx0KXt2YXIgbixhPWp0KGUpLHI9MCxpPVtdO2ZvcihuIGluIGEpIV8oRmUsbikmJl8oYSxuKSYmWnQoaSxuKTtmb3IoO3QubGVuZ3RoPnI7KV8oYSxuPXRbcisrXSkmJih+WHQoaSxuKXx8WnQoaSxuKSk7cmV0dXJuIGl9LEt0PVsiY29uc3RydWN0b3IiLCJoYXNPd25Qcm9wZXJ0eSIsImlzUHJvdG90eXBlT2YiLCJwcm9wZXJ0eUlzRW51bWVyYWJsZSIsInRvTG9jYWxlU3RyaW5nIiwidG9TdHJpbmciLCJ2YWx1ZU9mIl0sSnQ9S3QuY29uY2F0KCJsZW5ndGgiLCJwcm90b3R5cGUiKSxRdD17ZjpPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lc3x8ZnVuY3Rpb24oZSl7cmV0dXJuIFZ0KGUsSnQpfX0sZW49e2Y6T2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9sc30sdG49UyhbXS5jb25jYXQpLG5uPUMoIlJlZmxlY3QiLCJvd25LZXlzIil8fGZ1bmN0aW9uKGUpe3ZhciB0PVF0LmYoaWUoZSkpLG49ZW4uZjtyZXR1cm4gbj90bih0LG4oZSkpOnR9LGFuPWZ1bmN0aW9uKGUsdCl7Zm9yKHZhciBuPW5uKHQpLGE9a2UuZixyPUd0LmYsaT0wO2k8bi5sZW5ndGg7aSsrKXt2YXIgcz1uW2ldO18oZSxzKXx8YShlLHMscih0LHMpKTt9fSxybj0vI3xcLnByb3RvdHlwZVwuLyxzbj1mdW5jdGlvbihlLHQpe3ZhciBuPWxuW29uKGUpXTtyZXR1cm4gbj09Y258fG4hPXVuJiYoTCh0KT9qKHQpOiEhdCl9LG9uPXNuLm5vcm1hbGl6ZT1mdW5jdGlvbihlKXtyZXR1cm4gU3RyaW5nKGUpLnJlcGxhY2Uocm4sIi4iKS50b0xvd2VyQ2FzZSgpfSxsbj1zbi5kYXRhPXt9LHVuPXNuLk5BVElWRT0iTiIsY249c24uUE9MWUZJTEw9IlAiLGRuPXNuLHBuPUd0LmYsZ249ZnVuY3Rpb24oZSx0KXt2YXIgbixhLHIsaSxzLG89ZS50YXJnZXQsbD1lLmdsb2JhbCx1PWUuc3RhdDtpZihuPWw/ZDp1P2Rbb118fGcobyx7fSk6KGRbb118fHt9KS5wcm90b3R5cGUpZm9yKGEgaW4gdCl7aWYoaT10W2FdLHI9ZS5ub1RhcmdldEdldD8ocz1wbihuLGEpKSYmcy52YWx1ZTpuW2FdLCFkbihsP2E6bysodT8iLiI6IiMiKSthLGUuZm9yY2VkKSYmdm9pZCAwIT09cil7aWYodHlwZW9mIGk9PXR5cGVvZiByKWNvbnRpbnVlO2FuKGkscik7fShlLnNoYW18fHImJnIuc2hhbSkmJnhlKGksInNoYW0iLCEwKSxaZShuLGEsaSxlKTt9fSxmbj1PYmplY3Qua2V5c3x8ZnVuY3Rpb24oZSl7cmV0dXJuIFZ0KGUsS3QpfSxibj1PYmplY3QuYXNzaWduLGhuPU9iamVjdC5kZWZpbmVQcm9wZXJ0eSxtbj1TKFtdLmNvbmNhdCkseW49IWJufHxqKChmdW5jdGlvbigpe2lmKEsmJjEhPT1ibih7YjoxfSxibihobih7fSwiYSIse2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7aG4odGhpcywiYiIse3ZhbHVlOjMsZW51bWVyYWJsZTohMX0pO319KSx7YjoyfSkpLmIpcmV0dXJuICEwO3ZhciBlPXt9LHQ9e30sbj1TeW1ib2woKSxhPSJhYmNkZWZnaGlqa2xtbm9wcXJzdCI7cmV0dXJuIGVbbl09NyxhLnNwbGl0KCIiKS5mb3JFYWNoKChmdW5jdGlvbihlKXt0W2VdPWU7fSkpLDchPWJuKHt9LGUpW25dfHxmbihibih7fSx0KSkuam9pbigiIikhPWF9KSk/ZnVuY3Rpb24oZSx0KXtmb3IodmFyIG49eChlKSxhPWFyZ3VtZW50cy5sZW5ndGgscj0xLGk9ZW4uZixzPVV0LmY7YT5yOylmb3IodmFyIG8sbD1ndChhcmd1bWVudHNbcisrXSksdT1pP21uKGZuKGwpLGkobCkpOmZuKGwpLGM9dS5sZW5ndGgsZD0wO2M+ZDspbz11W2QrK10sSyYmIW9lKHMsbCxvKXx8KG5bb109bFtvXSk7cmV0dXJuIG59OmJuO2duKHt0YXJnZXQ6Ik9iamVjdCIsc3RhdDohMCxmb3JjZWQ6T2JqZWN0LmFzc2lnbiE9PXlufSx7YXNzaWduOnlufSk7dmFyIEVuPW8oKGZ1bmN0aW9uKGUpe3ZhciB0PWZ1bmN0aW9uKGUpe3ZhciB0PS9cYmxhbmcoPzp1YWdlKT8tKFtcdy1dKylcYi9pLG49MCxhPXt9LHI9e21hbnVhbDplLlByaXNtJiZlLlByaXNtLm1hbnVhbCxkaXNhYmxlV29ya2VyTWVzc2FnZUhhbmRsZXI6ZS5QcmlzbSYmZS5QcmlzbS5kaXNhYmxlV29ya2VyTWVzc2FnZUhhbmRsZXIsdXRpbDp7ZW5jb2RlOmZ1bmN0aW9uIGUodCl7cmV0dXJuIHQgaW5zdGFuY2VvZiBpP25ldyBpKHQudHlwZSxlKHQuY29udGVudCksdC5hbGlhcyk6QXJyYXkuaXNBcnJheSh0KT90Lm1hcChlKTp0LnJlcGxhY2UoLyYvZywiJmFtcDsiKS5yZXBsYWNlKC88L2csIiZsdDsiKS5yZXBsYWNlKC9cdTAwYTAvZywiICIpfSx0eXBlOmZ1bmN0aW9uKGUpe3JldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoZSkuc2xpY2UoOCwtMSl9LG9iaklkOmZ1bmN0aW9uKGUpe3JldHVybiBlLl9faWR8fE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2lkIix7dmFsdWU6KytufSksZS5fX2lkfSxjbG9uZTpmdW5jdGlvbiBlKHQsbil7dmFyIGEsaTtzd2l0Y2gobj1ufHx7fSxyLnV0aWwudHlwZSh0KSl7Y2FzZSJPYmplY3QiOmlmKGk9ci51dGlsLm9iaklkKHQpLG5baV0pcmV0dXJuIG5baV07Zm9yKHZhciBzIGluIGE9e30sbltpXT1hLHQpdC5oYXNPd25Qcm9wZXJ0eShzKSYmKGFbc109ZSh0W3NdLG4pKTtyZXR1cm4gYTtjYXNlIkFycmF5IjpyZXR1cm4gaT1yLnV0aWwub2JqSWQodCksbltpXT9uW2ldOihhPVtdLG5baV09YSx0LmZvckVhY2goKGZ1bmN0aW9uKHQscil7YVtyXT1lKHQsbik7fSkpLGEpO2RlZmF1bHQ6cmV0dXJuIHR9fSxnZXRMYW5ndWFnZTpmdW5jdGlvbihlKXtmb3IoO2UmJiF0LnRlc3QoZS5jbGFzc05hbWUpOyllPWUucGFyZW50RWxlbWVudDtyZXR1cm4gZT8oZS5jbGFzc05hbWUubWF0Y2godCl8fFssIm5vbmUiXSlbMV0udG9Mb3dlckNhc2UoKToibm9uZSJ9LGN1cnJlbnRTY3JpcHQ6ZnVuY3Rpb24oKXtpZigidW5kZWZpbmVkIj09dHlwZW9mIGRvY3VtZW50KXJldHVybiBudWxsO2lmKCJjdXJyZW50U2NyaXB0ImluIGRvY3VtZW50KXJldHVybiBkb2N1bWVudC5jdXJyZW50U2NyaXB0O3RyeXt0aHJvdyBuZXcgRXJyb3J9Y2F0Y2goYSl7dmFyIGU9KC9hdCBbXihcclxuXSpcKCguKik6W146XSs6W146XStcKSQvaS5leGVjKGEuc3RhY2spfHxbXSlbMV07aWYoZSl7dmFyIHQ9ZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInNjcmlwdCIpO2Zvcih2YXIgbiBpbiB0KWlmKHRbbl0uc3JjPT1lKXJldHVybiB0W25dfXJldHVybiBudWxsfX0saXNBY3RpdmU6ZnVuY3Rpb24oZSx0LG4pe2Zvcih2YXIgYT0ibm8tIit0O2U7KXt2YXIgcj1lLmNsYXNzTGlzdDtpZihyLmNvbnRhaW5zKHQpKXJldHVybiAhMDtpZihyLmNvbnRhaW5zKGEpKXJldHVybiAhMTtlPWUucGFyZW50RWxlbWVudDt9cmV0dXJuICEhbn19LGxhbmd1YWdlczp7cGxhaW46YSxwbGFpbnRleHQ6YSx0ZXh0OmEsdHh0OmEsZXh0ZW5kOmZ1bmN0aW9uKGUsdCl7dmFyIG49ci51dGlsLmNsb25lKHIubGFuZ3VhZ2VzW2VdKTtmb3IodmFyIGEgaW4gdCluW2FdPXRbYV07cmV0dXJuIG59LGluc2VydEJlZm9yZTpmdW5jdGlvbihlLHQsbixhKXt2YXIgaT0oYT1hfHxyLmxhbmd1YWdlcylbZV0scz17fTtmb3IodmFyIG8gaW4gaSlpZihpLmhhc093blByb3BlcnR5KG8pKXtpZihvPT10KWZvcih2YXIgbCBpbiBuKW4uaGFzT3duUHJvcGVydHkobCkmJihzW2xdPW5bbF0pO24uaGFzT3duUHJvcGVydHkobyl8fChzW29dPWlbb10pO312YXIgdT1hW2VdO3JldHVybiBhW2VdPXMsci5sYW5ndWFnZXMuREZTKHIubGFuZ3VhZ2VzLChmdW5jdGlvbih0LG4pe249PT11JiZ0IT1lJiYodGhpc1t0XT1zKTt9KSksc30sREZTOmZ1bmN0aW9uIGUodCxuLGEsaSl7aT1pfHx7fTt2YXIgcz1yLnV0aWwub2JqSWQ7Zm9yKHZhciBvIGluIHQpaWYodC5oYXNPd25Qcm9wZXJ0eShvKSl7bi5jYWxsKHQsbyx0W29dLGF8fG8pO3ZhciBsPXRbb10sdT1yLnV0aWwudHlwZShsKTsiT2JqZWN0IiE9PXV8fGlbcyhsKV0/IkFycmF5IiE9PXV8fGlbcyhsKV18fChpW3MobCldPSEwLGUobCxuLG8saSkpOihpW3MobCldPSEwLGUobCxuLG51bGwsaSkpO319fSxwbHVnaW5zOnt9LGhpZ2hsaWdodEFsbDpmdW5jdGlvbihlLHQpe3IuaGlnaGxpZ2h0QWxsVW5kZXIoZG9jdW1lbnQsZSx0KTt9LGhpZ2hsaWdodEFsbFVuZGVyOmZ1bmN0aW9uKGUsdCxuKXt2YXIgYT17Y2FsbGJhY2s6bixjb250YWluZXI6ZSxzZWxlY3RvcjonY29kZVtjbGFzcyo9Imxhbmd1YWdlLSJdLCBbY2xhc3MqPSJsYW5ndWFnZS0iXSBjb2RlLCBjb2RlW2NsYXNzKj0ibGFuZy0iXSwgW2NsYXNzKj0ibGFuZy0iXSBjb2RlJ307ci5ob29rcy5ydW4oImJlZm9yZS1oaWdobGlnaHRhbGwiLGEpLGEuZWxlbWVudHM9QXJyYXkucHJvdG90eXBlLnNsaWNlLmFwcGx5KGEuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoYS5zZWxlY3RvcikpLHIuaG9va3MucnVuKCJiZWZvcmUtYWxsLWVsZW1lbnRzLWhpZ2hsaWdodCIsYSk7Zm9yKHZhciBpLHM9MDtpPWEuZWxlbWVudHNbcysrXTspci5oaWdobGlnaHRFbGVtZW50KGksITA9PT10LGEuY2FsbGJhY2spO30saGlnaGxpZ2h0RWxlbWVudDpmdW5jdGlvbihuLGEsaSl7dmFyIHM9ci51dGlsLmdldExhbmd1YWdlKG4pLG89ci5sYW5ndWFnZXNbc107bi5jbGFzc05hbWU9bi5jbGFzc05hbWUucmVwbGFjZSh0LCIiKS5yZXBsYWNlKC9ccysvZywiICIpKyIgbGFuZ3VhZ2UtIitzO3ZhciBsPW4ucGFyZW50RWxlbWVudDtsJiYicHJlIj09PWwubm9kZU5hbWUudG9Mb3dlckNhc2UoKSYmKGwuY2xhc3NOYW1lPWwuY2xhc3NOYW1lLnJlcGxhY2UodCwiIikucmVwbGFjZSgvXHMrL2csIiAiKSsiIGxhbmd1YWdlLSIrcyk7dmFyIHU9e2VsZW1lbnQ6bixsYW5ndWFnZTpzLGdyYW1tYXI6byxjb2RlOm4udGV4dENvbnRlbnR9O2Z1bmN0aW9uIGMoZSl7dS5oaWdobGlnaHRlZENvZGU9ZSxyLmhvb2tzLnJ1bigiYmVmb3JlLWluc2VydCIsdSksdS5lbGVtZW50LmlubmVySFRNTD11LmhpZ2hsaWdodGVkQ29kZSxyLmhvb2tzLnJ1bigiYWZ0ZXItaGlnaGxpZ2h0Iix1KSxyLmhvb2tzLnJ1bigiY29tcGxldGUiLHUpLGkmJmkuY2FsbCh1LmVsZW1lbnQpO31pZihyLmhvb2tzLnJ1bigiYmVmb3JlLXNhbml0eS1jaGVjayIsdSksKGw9dS5lbGVtZW50LnBhcmVudEVsZW1lbnQpJiYicHJlIj09PWwubm9kZU5hbWUudG9Mb3dlckNhc2UoKSYmIWwuaGFzQXR0cmlidXRlKCJ0YWJpbmRleCIpJiZsLnNldEF0dHJpYnV0ZSgidGFiaW5kZXgiLCIwIiksIXUuY29kZSlyZXR1cm4gci5ob29rcy5ydW4oImNvbXBsZXRlIix1KSx2b2lkKGkmJmkuY2FsbCh1LmVsZW1lbnQpKTtpZihyLmhvb2tzLnJ1bigiYmVmb3JlLWhpZ2hsaWdodCIsdSksdS5ncmFtbWFyKWlmKGEmJmUuV29ya2VyKXt2YXIgZD1uZXcgV29ya2VyKHIuZmlsZW5hbWUpO2Qub25tZXNzYWdlPWZ1bmN0aW9uKGUpe2MoZS5kYXRhKTt9LGQucG9zdE1lc3NhZ2UoSlNPTi5zdHJpbmdpZnkoe2xhbmd1YWdlOnUubGFuZ3VhZ2UsY29kZTp1LmNvZGUsaW1tZWRpYXRlQ2xvc2U6ITB9KSk7fWVsc2UgYyhyLmhpZ2hsaWdodCh1LmNvZGUsdS5ncmFtbWFyLHUubGFuZ3VhZ2UpKTtlbHNlIGMoci51dGlsLmVuY29kZSh1LmNvZGUpKTt9LGhpZ2hsaWdodDpmdW5jdGlvbihlLHQsbil7dmFyIGE9e2NvZGU6ZSxncmFtbWFyOnQsbGFuZ3VhZ2U6bn07cmV0dXJuIHIuaG9va3MucnVuKCJiZWZvcmUtdG9rZW5pemUiLGEpLGEudG9rZW5zPXIudG9rZW5pemUoYS5jb2RlLGEuZ3JhbW1hciksci5ob29rcy5ydW4oImFmdGVyLXRva2VuaXplIixhKSxpLnN0cmluZ2lmeShyLnV0aWwuZW5jb2RlKGEudG9rZW5zKSxhLmxhbmd1YWdlKX0sdG9rZW5pemU6ZnVuY3Rpb24oZSx0KXt2YXIgbj10LnJlc3Q7aWYobil7Zm9yKHZhciBhIGluIG4pdFthXT1uW2FdO2RlbGV0ZSB0LnJlc3Q7fXZhciByPW5ldyBsO3JldHVybiB1KHIsci5oZWFkLGUpLG8oZSxyLHQsci5oZWFkLDApLGZ1bmN0aW9uKGUpe3ZhciB0PVtdLG49ZS5oZWFkLm5leHQ7Zm9yKDtuIT09ZS50YWlsOyl0LnB1c2gobi52YWx1ZSksbj1uLm5leHQ7cmV0dXJuIHR9KHIpfSxob29rczp7YWxsOnt9LGFkZDpmdW5jdGlvbihlLHQpe3ZhciBuPXIuaG9va3MuYWxsO25bZV09bltlXXx8W10sbltlXS5wdXNoKHQpO30scnVuOmZ1bmN0aW9uKGUsdCl7dmFyIG49ci5ob29rcy5hbGxbZV07aWYobiYmbi5sZW5ndGgpZm9yKHZhciBhLGk9MDthPW5baSsrXTspYSh0KTt9fSxUb2tlbjppfTtmdW5jdGlvbiBpKGUsdCxuLGEpe3RoaXMudHlwZT1lLHRoaXMuY29udGVudD10LHRoaXMuYWxpYXM9bix0aGlzLmxlbmd0aD0wfChhfHwiIikubGVuZ3RoO31mdW5jdGlvbiBzKGUsdCxuLGEpe2UubGFzdEluZGV4PXQ7dmFyIHI9ZS5leGVjKG4pO2lmKHImJmEmJnJbMV0pe3ZhciBpPXJbMV0ubGVuZ3RoO3IuaW5kZXgrPWksclswXT1yWzBdLnNsaWNlKGkpO31yZXR1cm4gcn1mdW5jdGlvbiBvKGUsdCxuLGEsbCxkKXtmb3IodmFyIHAgaW4gbilpZihuLmhhc093blByb3BlcnR5KHApJiZuW3BdKXt2YXIgZz1uW3BdO2c9QXJyYXkuaXNBcnJheShnKT9nOltnXTtmb3IodmFyIGY9MDtmPGcubGVuZ3RoOysrZil7aWYoZCYmZC5jYXVzZT09cCsiLCIrZilyZXR1cm47dmFyIGI9Z1tmXSxoPWIuaW5zaWRlLG09ISFiLmxvb2tiZWhpbmQseT0hIWIuZ3JlZWR5LEU9Yi5hbGlhcztpZih5JiYhYi5wYXR0ZXJuLmdsb2JhbCl7dmFyIHY9Yi5wYXR0ZXJuLnRvU3RyaW5nKCkubWF0Y2goL1tpbXN1eV0qJC8pWzBdO2IucGF0dGVybj1SZWdFeHAoYi5wYXR0ZXJuLnNvdXJjZSx2KyJnIik7fWZvcih2YXIgUz1iLnBhdHRlcm58fGIsdz1hLm5leHQsaz1sO3chPT10LnRhaWwmJiEoZCYmaz49ZC5yZWFjaCk7ays9dy52YWx1ZS5sZW5ndGgsdz13Lm5leHQpe3ZhciBBPXcudmFsdWU7aWYodC5sZW5ndGg+ZS5sZW5ndGgpcmV0dXJuO2lmKCEoQSBpbnN0YW5jZW9mIGkpKXt2YXIgeCxUPTE7aWYoeSl7aWYoISh4PXMoUyxrLGUsbSkpKWJyZWFrO3ZhciBfPXguaW5kZXgsTz14LmluZGV4K3hbMF0ubGVuZ3RoLEk9aztmb3IoSSs9dy52YWx1ZS5sZW5ndGg7Xz49STspSSs9KHc9dy5uZXh0KS52YWx1ZS5sZW5ndGg7aWYoaz1JLT13LnZhbHVlLmxlbmd0aCx3LnZhbHVlIGluc3RhbmNlb2YgaSljb250aW51ZTtmb3IodmFyIFI9dztSIT09dC50YWlsJiYoSTxPfHwic3RyaW5nIj09dHlwZW9mIFIudmFsdWUpO1I9Ui5uZXh0KVQrKyxJKz1SLnZhbHVlLmxlbmd0aDtULS0sQT1lLnNsaWNlKGssSSkseC5pbmRleC09azt9ZWxzZSBpZighKHg9cyhTLDAsQSxtKSkpY29udGludWU7Xz14LmluZGV4O3ZhciBOPXhbMF0sTD1BLnNsaWNlKDAsXyksUD1BLnNsaWNlKF8rTi5sZW5ndGgpLEM9aytBLmxlbmd0aDtkJiZDPmQucmVhY2gmJihkLnJlYWNoPUMpO3ZhciBGPXcucHJldjtpZihMJiYoRj11KHQsRixMKSxrKz1MLmxlbmd0aCksYyh0LEYsVCksdz11KHQsRixuZXcgaShwLGg/ci50b2tlbml6ZShOLGgpOk4sRSxOKSksUCYmdSh0LHcsUCksVD4xKXt2YXIgRD17Y2F1c2U6cCsiLCIrZixyZWFjaDpDfTtvKGUsdCxuLHcucHJldixrLEQpLGQmJkQucmVhY2g+ZC5yZWFjaCYmKGQucmVhY2g9RC5yZWFjaCk7fX19fX19ZnVuY3Rpb24gbCgpe3ZhciBlPXt2YWx1ZTpudWxsLHByZXY6bnVsbCxuZXh0Om51bGx9LHQ9e3ZhbHVlOm51bGwscHJldjplLG5leHQ6bnVsbH07ZS5uZXh0PXQsdGhpcy5oZWFkPWUsdGhpcy50YWlsPXQsdGhpcy5sZW5ndGg9MDt9ZnVuY3Rpb24gdShlLHQsbil7dmFyIGE9dC5uZXh0LHI9e3ZhbHVlOm4scHJldjp0LG5leHQ6YX07cmV0dXJuIHQubmV4dD1yLGEucHJldj1yLGUubGVuZ3RoKysscn1mdW5jdGlvbiBjKGUsdCxuKXtmb3IodmFyIGE9dC5uZXh0LHI9MDtyPG4mJmEhPT1lLnRhaWw7cisrKWE9YS5uZXh0O3QubmV4dD1hLGEucHJldj10LGUubGVuZ3RoLT1yO31pZihlLlByaXNtPXIsaS5zdHJpbmdpZnk9ZnVuY3Rpb24gZSh0LG4pe2lmKCJzdHJpbmciPT10eXBlb2YgdClyZXR1cm4gdDtpZihBcnJheS5pc0FycmF5KHQpKXt2YXIgYT0iIjtyZXR1cm4gdC5mb3JFYWNoKChmdW5jdGlvbih0KXthKz1lKHQsbik7fSkpLGF9dmFyIGk9e3R5cGU6dC50eXBlLGNvbnRlbnQ6ZSh0LmNvbnRlbnQsbiksdGFnOiJzcGFuIixjbGFzc2VzOlsidG9rZW4iLHQudHlwZV0sYXR0cmlidXRlczp7fSxsYW5ndWFnZTpufSxzPXQuYWxpYXM7cyYmKEFycmF5LmlzQXJyYXkocyk/QXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkoaS5jbGFzc2VzLHMpOmkuY2xhc3Nlcy5wdXNoKHMpKSxyLmhvb2tzLnJ1bigid3JhcCIsaSk7dmFyIG89IiI7Zm9yKHZhciBsIGluIGkuYXR0cmlidXRlcylvKz0iICIrbCsnPSInKyhpLmF0dHJpYnV0ZXNbbF18fCIiKS5yZXBsYWNlKC8iL2csIiZxdW90OyIpKyciJztyZXR1cm4gIjwiK2kudGFnKycgY2xhc3M9IicraS5jbGFzc2VzLmpvaW4oIiAiKSsnIicrbysiPiIraS5jb250ZW50KyI8LyIraS50YWcrIj4ifSwhZS5kb2N1bWVudClyZXR1cm4gZS5hZGRFdmVudExpc3RlbmVyPyhyLmRpc2FibGVXb3JrZXJNZXNzYWdlSGFuZGxlcnx8ZS5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwoZnVuY3Rpb24odCl7dmFyIG49SlNPTi5wYXJzZSh0LmRhdGEpLGE9bi5sYW5ndWFnZSxpPW4uY29kZSxzPW4uaW1tZWRpYXRlQ2xvc2U7ZS5wb3N0TWVzc2FnZShyLmhpZ2hsaWdodChpLHIubGFuZ3VhZ2VzW2FdLGEpKSxzJiZlLmNsb3NlKCk7fSksITEpLHIpOnI7dmFyIGQ9ci51dGlsLmN1cnJlbnRTY3JpcHQoKTtmdW5jdGlvbiBwKCl7ci5tYW51YWx8fHIuaGlnaGxpZ2h0QWxsKCk7fWlmKGQmJihyLmZpbGVuYW1lPWQuc3JjLGQuaGFzQXR0cmlidXRlKCJkYXRhLW1hbnVhbCIpJiYoci5tYW51YWw9ITApKSwhci5tYW51YWwpe3ZhciBnPWRvY3VtZW50LnJlYWR5U3RhdGU7ImxvYWRpbmciPT09Z3x8ImludGVyYWN0aXZlIj09PWcmJmQmJmQuZGVmZXI/ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIscCk6d2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZT93aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHApOndpbmRvdy5zZXRUaW1lb3V0KHAsMTYpO31yZXR1cm4gcn0oInVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3c/d2luZG93OiJ1bmRlZmluZWQiIT10eXBlb2YgV29ya2VyR2xvYmFsU2NvcGUmJnNlbGYgaW5zdGFuY2VvZiBXb3JrZXJHbG9iYWxTY29wZT9zZWxmOnt9KTsKICAvKioKICAgICAqIFByaXNtOiBMaWdodHdlaWdodCwgcm9idXN0LCBlbGVnYW50IHN5bnRheCBoaWdobGlnaHRpbmcKICAgICAqCiAgICAgKiBAbGljZW5zZSBNSVQgPGh0dHBzOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUPgogICAgICogQGF1dGhvciBMZWEgVmVyb3UgPGh0dHBzOi8vbGVhLnZlcm91Lm1lPgogICAgICogQG5hbWVzcGFjZQogICAgICogQHB1YmxpYwogICAgICovZS5leHBvcnRzJiYoZS5leHBvcnRzPXQpLHZvaWQgMCE9PXMmJihzLlByaXNtPXQpLHQubGFuZ3VhZ2VzLm1hcmt1cD17Y29tbWVudDp7cGF0dGVybjovPCEtLSg/Oig/ITwhLS0pW1xzXFNdKSo/LS0+LyxncmVlZHk6ITB9LHByb2xvZzp7cGF0dGVybjovPFw/W1xzXFNdKz9cPz4vLGdyZWVkeTohMH0sZG9jdHlwZTp7cGF0dGVybjovPCFET0NUWVBFKD86W14+IidbXF1dfCJbXiJdKiJ8J1teJ10qJykrKD86XFsoPzpbXjwiJ1xdXXwiW14iXSoifCdbXiddKid8PCg/ISEtLSl8PCEtLSg/OlteLV18LSg/IS0+KSkqLS0+KSpcXVxzKik/Pi9pLGdyZWVkeTohMCxpbnNpZGU6eyJpbnRlcm5hbC1zdWJzZXQiOntwYXR0ZXJuOi8oXlteXFtdKlxbKVtcc1xTXSsoPz1cXT4kKS8sbG9va2JlaGluZDohMCxncmVlZHk6ITAsaW5zaWRlOm51bGx9LHN0cmluZzp7cGF0dGVybjovIlteIl0qInwnW14nXSonLyxncmVlZHk6ITB9LHB1bmN0dWF0aW9uOi9ePCF8PiR8W1tcXV0vLCJkb2N0eXBlLXRhZyI6L15ET0NUWVBFL2ksbmFtZTovW15cczw+JyJdKy99fSxjZGF0YTp7cGF0dGVybjovPCFcW0NEQVRBXFtbXHNcU10qP1xdXF0+L2ksZ3JlZWR5OiEwfSx0YWc6e3BhdHRlcm46LzxcLz8oPyFcZClbXlxzPlwvPSQ8JV0rKD86XHMoPzpccypbXlxzPlwvPV0rKD86XHMqPVxzKig/OiJbXiJdKiJ8J1teJ10qJ3xbXlxzJyI+PV0rKD89W1xzPl0pKXwoPz1bXHMvPl0pKSkrKT9ccypcLz8+LyxncmVlZHk6ITAsaW5zaWRlOnt0YWc6e3BhdHRlcm46L148XC8/W15ccz5cL10rLyxpbnNpZGU6e3B1bmN0dWF0aW9uOi9ePFwvPy8sbmFtZXNwYWNlOi9eW15ccz5cLzpdKzovfX0sInNwZWNpYWwtYXR0ciI6W10sImF0dHItdmFsdWUiOntwYXR0ZXJuOi89XHMqKD86IlteIl0qInwnW14nXSonfFteXHMnIj49XSspLyxpbnNpZGU6e3B1bmN0dWF0aW9uOlt7cGF0dGVybjovXj0vLGFsaWFzOiJhdHRyLWVxdWFscyJ9LC8ifCcvXX19LHB1bmN0dWF0aW9uOi9cLz8+LywiYXR0ci1uYW1lIjp7cGF0dGVybjovW15ccz5cL10rLyxpbnNpZGU6e25hbWVzcGFjZTovXlteXHM+XC86XSs6L319fX0sZW50aXR5Olt7cGF0dGVybjovJltcZGEtel17MSw4fTsvaSxhbGlhczoibmFtZWQtZW50aXR5In0sLyYjeD9bXGRhLWZdezEsOH07L2ldfSx0Lmxhbmd1YWdlcy5tYXJrdXAudGFnLmluc2lkZVsiYXR0ci12YWx1ZSJdLmluc2lkZS5lbnRpdHk9dC5sYW5ndWFnZXMubWFya3VwLmVudGl0eSx0Lmxhbmd1YWdlcy5tYXJrdXAuZG9jdHlwZS5pbnNpZGVbImludGVybmFsLXN1YnNldCJdLmluc2lkZT10Lmxhbmd1YWdlcy5tYXJrdXAsdC5ob29rcy5hZGQoIndyYXAiLChmdW5jdGlvbihlKXsiZW50aXR5Ij09PWUudHlwZSYmKGUuYXR0cmlidXRlcy50aXRsZT1lLmNvbnRlbnQucmVwbGFjZSgvJmFtcDsvLCImIikpO30pKSxPYmplY3QuZGVmaW5lUHJvcGVydHkodC5sYW5ndWFnZXMubWFya3VwLnRhZywiYWRkSW5saW5lZCIse3ZhbHVlOmZ1bmN0aW9uKGUsbil7dmFyIGE9e307YVsibGFuZ3VhZ2UtIituXT17cGF0dGVybjovKF48IVxbQ0RBVEFcWylbXHNcU10rPyg/PVxdXF0+JCkvaSxsb29rYmVoaW5kOiEwLGluc2lkZTp0Lmxhbmd1YWdlc1tuXX0sYS5jZGF0YT0vXjwhXFtDREFUQVxbfFxdXF0+JC9pO3ZhciByPXsiaW5jbHVkZWQtY2RhdGEiOntwYXR0ZXJuOi88IVxbQ0RBVEFcW1tcc1xTXSo/XF1cXT4vaSxpbnNpZGU6YX19O3JbImxhbmd1YWdlLSIrbl09e3BhdHRlcm46L1tcc1xTXSsvLGluc2lkZTp0Lmxhbmd1YWdlc1tuXX07dmFyIGk9e307aVtlXT17cGF0dGVybjpSZWdFeHAoLyg8X19bXj5dKj4pKD86PCFcW0NEQVRBXFsoPzpbXlxdXXxcXSg/IVxdPikpKlxdXF0+fCg/ITwhXFtDREFUQVxbKVtcc1xTXSkqPyg/PTxcL19fPikvLnNvdXJjZS5yZXBsYWNlKC9fXy9nLChmdW5jdGlvbigpe3JldHVybiBlfSkpLCJpIiksbG9va2JlaGluZDohMCxncmVlZHk6ITAsaW5zaWRlOnJ9LHQubGFuZ3VhZ2VzLmluc2VydEJlZm9yZSgibWFya3VwIiwiY2RhdGEiLGkpO319KSxPYmplY3QuZGVmaW5lUHJvcGVydHkodC5sYW5ndWFnZXMubWFya3VwLnRhZywiYWRkQXR0cmlidXRlIix7dmFsdWU6ZnVuY3Rpb24oZSxuKXt0Lmxhbmd1YWdlcy5tYXJrdXAudGFnLmluc2lkZVsic3BlY2lhbC1hdHRyIl0ucHVzaCh7cGF0dGVybjpSZWdFeHAoLyhefFsiJ1xzXSkvLnNvdXJjZSsiKD86IitlKyIpIisvXHMqPVxzKig/OiJbXiJdKiJ8J1teJ10qJ3xbXlxzJyI+PV0rKD89W1xzPl0pKS8uc291cmNlLCJpIiksbG9va2JlaGluZDohMCxpbnNpZGU6eyJhdHRyLW5hbWUiOi9eW15ccz1dKy8sImF0dHItdmFsdWUiOntwYXR0ZXJuOi89W1xzXFNdKy8saW5zaWRlOnt2YWx1ZTp7cGF0dGVybjovKF49XHMqKFsiJ118KD8hWyInXSkpKVxTW1xzXFNdKig/PVwyJCkvLGxvb2tiZWhpbmQ6ITAsYWxpYXM6W24sImxhbmd1YWdlLSIrbl0saW5zaWRlOnQubGFuZ3VhZ2VzW25dfSxwdW5jdHVhdGlvbjpbe3BhdHRlcm46L149LyxhbGlhczoiYXR0ci1lcXVhbHMifSwvInwnL119fX19KTt9fSksdC5sYW5ndWFnZXMuaHRtbD10Lmxhbmd1YWdlcy5tYXJrdXAsdC5sYW5ndWFnZXMubWF0aG1sPXQubGFuZ3VhZ2VzLm1hcmt1cCx0Lmxhbmd1YWdlcy5zdmc9dC5sYW5ndWFnZXMubWFya3VwLHQubGFuZ3VhZ2VzLnhtbD10Lmxhbmd1YWdlcy5leHRlbmQoIm1hcmt1cCIse30pLHQubGFuZ3VhZ2VzLnNzbWw9dC5sYW5ndWFnZXMueG1sLHQubGFuZ3VhZ2VzLmF0b209dC5sYW5ndWFnZXMueG1sLHQubGFuZ3VhZ2VzLnJzcz10Lmxhbmd1YWdlcy54bWwsZnVuY3Rpb24oZSl7dmFyIHQ9Lyg/OiIoPzpcXCg/OlxyXG58W1xzXFNdKXxbXiJcXFxyXG5dKSoifCcoPzpcXCg/OlxyXG58W1xzXFNdKXxbXidcXFxyXG5dKSonKS87ZS5sYW5ndWFnZXMuY3NzPXtjb21tZW50Oi9cL1wqW1xzXFNdKj9cKlwvLyxhdHJ1bGU6e3BhdHRlcm46L0BbXHctXSg/OlteO3tcc118XHMrKD8hW1xze10pKSooPzo7fCg/PVxzKlx7KSkvLGluc2lkZTp7cnVsZTovXkBbXHctXSsvLCJzZWxlY3Rvci1mdW5jdGlvbi1hcmd1bWVudCI6e3BhdHRlcm46LyhcYnNlbGVjdG9yXHMqXChccyooPyFbXHMpXSkpKD86W14oKVxzXXxccysoPyFbXHMpXSl8XCgoPzpbXigpXXxcKFteKCldKlwpKSpcKSkrKD89XHMqXCkpLyxsb29rYmVoaW5kOiEwLGFsaWFzOiJzZWxlY3RvciJ9LGtleXdvcmQ6e3BhdHRlcm46LyhefFteXHctXSkoPzphbmR8bm90fG9ubHl8b3IpKD8hW1x3LV0pLyxsb29rYmVoaW5kOiEwfX19LHVybDp7cGF0dGVybjpSZWdFeHAoIlxcYnVybFxcKCg/OiIrdC5zb3VyY2UrInwiKy8oPzpbXlxcXHJcbigpIiddfFxcW1xzXFNdKSovLnNvdXJjZSsiKVxcKSIsImkiKSxncmVlZHk6ITAsaW5zaWRlOntmdW5jdGlvbjovXnVybC9pLHB1bmN0dWF0aW9uOi9eXCh8XCkkLyxzdHJpbmc6e3BhdHRlcm46UmVnRXhwKCJeIit0LnNvdXJjZSsiJCIpLGFsaWFzOiJ1cmwifX19LHNlbGVjdG9yOntwYXR0ZXJuOlJlZ0V4cCgiKF58W3t9XFxzXSlbXnt9XFxzXSg/Oltee307XCInXFxzXXxcXHMrKD8hW1xcc3tdKXwiK3Quc291cmNlKyIpKig/PVxccypcXHspIiksbG9va2JlaGluZDohMH0sc3RyaW5nOntwYXR0ZXJuOnQsZ3JlZWR5OiEwfSxwcm9wZXJ0eTp7cGF0dGVybjovKF58W14tXHdceEEwLVx1RkZGRl0pKD8hXHMpWy1fYS16XHhBMC1cdUZGRkZdKD86KD8hXHMpWy1cd1x4QTAtXHVGRkZGXSkqKD89XHMqOikvaSxsb29rYmVoaW5kOiEwfSxpbXBvcnRhbnQ6LyFpbXBvcnRhbnRcYi9pLGZ1bmN0aW9uOntwYXR0ZXJuOi8oXnxbXi1hLXowLTldKVstYS16MC05XSsoPz1cKCkvaSxsb29rYmVoaW5kOiEwfSxwdW5jdHVhdGlvbjovWygpe307OixdL30sZS5sYW5ndWFnZXMuY3NzLmF0cnVsZS5pbnNpZGUucmVzdD1lLmxhbmd1YWdlcy5jc3M7dmFyIG49ZS5sYW5ndWFnZXMubWFya3VwO24mJihuLnRhZy5hZGRJbmxpbmVkKCJzdHlsZSIsImNzcyIpLG4udGFnLmFkZEF0dHJpYnV0ZSgic3R5bGUiLCJjc3MiKSk7fSh0KSx0Lmxhbmd1YWdlcy5jbGlrZT17Y29tbWVudDpbe3BhdHRlcm46LyhefFteXFxdKVwvXCpbXHNcU10qPyg/OlwqXC98JCkvLGxvb2tiZWhpbmQ6ITAsZ3JlZWR5OiEwfSx7cGF0dGVybjovKF58W15cXDpdKVwvXC8uKi8sbG9va2JlaGluZDohMCxncmVlZHk6ITB9XSxzdHJpbmc6e3BhdHRlcm46LyhbIiddKSg/OlxcKD86XHJcbnxbXHNcU10pfCg/IVwxKVteXFxcclxuXSkqXDEvLGdyZWVkeTohMH0sImNsYXNzLW5hbWUiOntwYXR0ZXJuOi8oXGIoPzpjbGFzc3xpbnRlcmZhY2V8ZXh0ZW5kc3xpbXBsZW1lbnRzfHRyYWl0fGluc3RhbmNlb2Z8bmV3KVxzK3xcYmNhdGNoXHMrXCgpW1x3LlxcXSsvaSxsb29rYmVoaW5kOiEwLGluc2lkZTp7cHVuY3R1YXRpb246L1suXFxdL319LGtleXdvcmQ6L1xiKD86aWZ8ZWxzZXx3aGlsZXxkb3xmb3J8cmV0dXJufGlufGluc3RhbmNlb2Z8ZnVuY3Rpb258bmV3fHRyeXx0aHJvd3xjYXRjaHxmaW5hbGx5fG51bGx8YnJlYWt8Y29udGludWUpXGIvLGJvb2xlYW46L1xiKD86dHJ1ZXxmYWxzZSlcYi8sZnVuY3Rpb246L1xiXHcrKD89XCgpLyxudW1iZXI6L1xiMHhbXGRhLWZdK1xifCg/OlxiXGQrKD86XC5cZCopP3xcQlwuXGQrKSg/OmVbKy1dP1xkKyk/L2ksb3BlcmF0b3I6L1s8Pl09P3xbIT1dPT89P3wtLT98XCtcKz98JiY/fFx8XHw/fFs/Ki9+XiVdLyxwdW5jdHVhdGlvbjovW3t9W1xdOygpLC46XS99LHQubGFuZ3VhZ2VzLmphdmFzY3JpcHQ9dC5sYW5ndWFnZXMuZXh0ZW5kKCJjbGlrZSIseyJjbGFzcy1uYW1lIjpbdC5sYW5ndWFnZXMuY2xpa2VbImNsYXNzLW5hbWUiXSx7cGF0dGVybjovKF58W14kXHdceEEwLVx1RkZGRl0pKD8hXHMpW18kQS1aXHhBMC1cdUZGRkZdKD86KD8hXHMpWyRcd1x4QTAtXHVGRkZGXSkqKD89XC4oPzpwcm90b3R5cGV8Y29uc3RydWN0b3IpKS8sbG9va2JlaGluZDohMH1dLGtleXdvcmQ6W3twYXR0ZXJuOi8oKD86XnxcfSlccyopY2F0Y2hcYi8sbG9va2JlaGluZDohMH0se3BhdHRlcm46LyhefFteLl18XC5cLlwuXHMqKVxiKD86YXN8YXNzZXJ0KD89XHMqXHspfGFzeW5jKD89XHMqKD86ZnVuY3Rpb25cYnxcKHxbJFx3XHhBMC1cdUZGRkZdfCQpKXxhd2FpdHxicmVha3xjYXNlfGNsYXNzfGNvbnN0fGNvbnRpbnVlfGRlYnVnZ2VyfGRlZmF1bHR8ZGVsZXRlfGRvfGVsc2V8ZW51bXxleHBvcnR8ZXh0ZW5kc3xmaW5hbGx5KD89XHMqKD86XHt8JCkpfGZvcnxmcm9tKD89XHMqKD86WyciXXwkKSl8ZnVuY3Rpb258KD86Z2V0fHNldCkoPz1ccyooPzpbI1xbJFx3XHhBMC1cdUZGRkZdfCQpKXxpZnxpbXBsZW1lbnRzfGltcG9ydHxpbnxpbnN0YW5jZW9mfGludGVyZmFjZXxsZXR8bmV3fG51bGx8b2Z8cGFja2FnZXxwcml2YXRlfHByb3RlY3RlZHxwdWJsaWN8cmV0dXJufHN0YXRpY3xzdXBlcnxzd2l0Y2h8dGhpc3x0aHJvd3x0cnl8dHlwZW9mfHVuZGVmaW5lZHx2YXJ8dm9pZHx3aGlsZXx3aXRofHlpZWxkKVxiLyxsb29rYmVoaW5kOiEwfV0sZnVuY3Rpb246LyM/KD8hXHMpW18kYS16QS1aXHhBMC1cdUZGRkZdKD86KD8hXHMpWyRcd1x4QTAtXHVGRkZGXSkqKD89XHMqKD86XC5ccyooPzphcHBseXxiaW5kfGNhbGwpXHMqKT9cKCkvLG51bWJlcjovXGIoPzooPzowW3hYXSg/OltcZEEtRmEtZl0oPzpfW1xkQS1GYS1mXSk/KSt8MFtiQl0oPzpbMDFdKD86X1swMV0pPykrfDBbb09dKD86WzAtN10oPzpfWzAtN10pPykrKW4/fCg/OlxkKD86X1xkKT8pK258TmFOfEluZmluaXR5KVxifCg/OlxiKD86XGQoPzpfXGQpPykrXC4/KD86XGQoPzpfXGQpPykqfFxCXC4oPzpcZCg/Ol9cZCk/KSspKD86W0VlXVsrLV0/KD86XGQoPzpfXGQpPykrKT8vLG9wZXJhdG9yOi8tLXxcK1wrfFwqXCo9P3w9PnwmJj0/fFx8XHw9P3xbIT1dPT18PDw9P3w+Pj4/PT98Wy0rKi8lJnxeIT08Pl09P3xcLnszfXxcP1w/PT98XD9cLj98W346XS99KSx0Lmxhbmd1YWdlcy5qYXZhc2NyaXB0WyJjbGFzcy1uYW1lIl1bMF0ucGF0dGVybj0vKFxiKD86Y2xhc3N8aW50ZXJmYWNlfGV4dGVuZHN8aW1wbGVtZW50c3xpbnN0YW5jZW9mfG5ldylccyspW1x3LlxcXSsvLHQubGFuZ3VhZ2VzLmluc2VydEJlZm9yZSgiamF2YXNjcmlwdCIsImtleXdvcmQiLHtyZWdleDp7cGF0dGVybjovKCg/Ol58W14kXHdceEEwLVx1RkZGRi4iJ1xdKVxzXXxcYig/OnJldHVybnx5aWVsZCkpXHMqKVwvKD86XFsoPzpbXlxdXFxcclxuXXxcXC4pKlxdfFxcLnxbXi9cXFxbXHJcbl0pK1wvW2RnaW15dXNdezAsN30oPz0oPzpcc3xcL1wqKD86W14qXXxcKig/IVwvKSkqXCpcLykqKD86JHxbXHJcbiwuOzp9KVxdXXxcL1wvKSkvLGxvb2tiZWhpbmQ6ITAsZ3JlZWR5OiEwLGluc2lkZTp7InJlZ2V4LXNvdXJjZSI6e3BhdHRlcm46L14oXC8pW1xzXFNdKyg/PVwvW2Etel0qJCkvLGxvb2tiZWhpbmQ6ITAsYWxpYXM6Imxhbmd1YWdlLXJlZ2V4IixpbnNpZGU6dC5sYW5ndWFnZXMucmVnZXh9LCJyZWdleC1kZWxpbWl0ZXIiOi9eXC98XC8kLywicmVnZXgtZmxhZ3MiOi9eW2Etel0rJC99fSwiZnVuY3Rpb24tdmFyaWFibGUiOntwYXR0ZXJuOi8jPyg/IVxzKVtfJGEtekEtWlx4QTAtXHVGRkZGXSg/Oig/IVxzKVskXHdceEEwLVx1RkZGRl0pKig/PVxzKls9Ol1ccyooPzphc3luY1xzKik/KD86XGJmdW5jdGlvblxifCg/OlwoKD86W14oKV18XChbXigpXSpcKSkqXCl8KD8hXHMpW18kYS16QS1aXHhBMC1cdUZGRkZdKD86KD8hXHMpWyRcd1x4QTAtXHVGRkZGXSkqKVxzKj0+KSkvLGFsaWFzOiJmdW5jdGlvbiJ9LHBhcmFtZXRlcjpbe3BhdHRlcm46LyhmdW5jdGlvbig/OlxzKyg/IVxzKVtfJGEtekEtWlx4QTAtXHVGRkZGXSg/Oig/IVxzKVskXHdceEEwLVx1RkZGRl0pKik/XHMqXChccyopKD8hXHMpKD86W14oKVxzXXxccysoPyFbXHMpXSl8XChbXigpXSpcKSkrKD89XHMqXCkpLyxsb29rYmVoaW5kOiEwLGluc2lkZTp0Lmxhbmd1YWdlcy5qYXZhc2NyaXB0fSx7cGF0dGVybjovKF58W14kXHdceEEwLVx1RkZGRl0pKD8hXHMpW18kYS16XHhBMC1cdUZGRkZdKD86KD8hXHMpWyRcd1x4QTAtXHVGRkZGXSkqKD89XHMqPT4pL2ksbG9va2JlaGluZDohMCxpbnNpZGU6dC5sYW5ndWFnZXMuamF2YXNjcmlwdH0se3BhdHRlcm46LyhcKFxzKikoPyFccykoPzpbXigpXHNdfFxzKyg/IVtccyldKXxcKFteKCldKlwpKSsoPz1ccypcKVxzKj0+KS8sbG9va2JlaGluZDohMCxpbnNpZGU6dC5sYW5ndWFnZXMuamF2YXNjcmlwdH0se3BhdHRlcm46LygoPzpcYnxcc3xeKSg/ISg/OmFzfGFzeW5jfGF3YWl0fGJyZWFrfGNhc2V8Y2F0Y2h8Y2xhc3N8Y29uc3R8Y29udGludWV8ZGVidWdnZXJ8ZGVmYXVsdHxkZWxldGV8ZG98ZWxzZXxlbnVtfGV4cG9ydHxleHRlbmRzfGZpbmFsbHl8Zm9yfGZyb218ZnVuY3Rpb258Z2V0fGlmfGltcGxlbWVudHN8aW1wb3J0fGlufGluc3RhbmNlb2Z8aW50ZXJmYWNlfGxldHxuZXd8bnVsbHxvZnxwYWNrYWdlfHByaXZhdGV8cHJvdGVjdGVkfHB1YmxpY3xyZXR1cm58c2V0fHN0YXRpY3xzdXBlcnxzd2l0Y2h8dGhpc3x0aHJvd3x0cnl8dHlwZW9mfHVuZGVmaW5lZHx2YXJ8dm9pZHx3aGlsZXx3aXRofHlpZWxkKSg/IVskXHdceEEwLVx1RkZGRl0pKSg/Oig/IVxzKVtfJGEtekEtWlx4QTAtXHVGRkZGXSg/Oig/IVxzKVskXHdceEEwLVx1RkZGRl0pKlxzKilcKFxzKnxcXVxzKlwoXHMqKSg/IVxzKSg/OlteKClcc118XHMrKD8hW1xzKV0pfFwoW14oKV0qXCkpKyg/PVxzKlwpXHMqXHspLyxsb29rYmVoaW5kOiEwLGluc2lkZTp0Lmxhbmd1YWdlcy5qYXZhc2NyaXB0fV0sY29uc3RhbnQ6L1xiW0EtWl0oPzpbQS1aX118XGR4PykqXGIvfSksdC5sYW5ndWFnZXMuaW5zZXJ0QmVmb3JlKCJqYXZhc2NyaXB0Iiwic3RyaW5nIix7aGFzaGJhbmc6e3BhdHRlcm46L14jIS4qLyxncmVlZHk6ITAsYWxpYXM6ImNvbW1lbnQifSwidGVtcGxhdGUtc3RyaW5nIjp7cGF0dGVybjovYCg/OlxcW1xzXFNdfFwkXHsoPzpbXnt9XXxceyg/Oltee31dfFx7W159XSpcfSkqXH0pK1x9fCg/IVwkXHspW15cXGBdKSpgLyxncmVlZHk6ITAsaW5zaWRlOnsidGVtcGxhdGUtcHVuY3R1YXRpb24iOntwYXR0ZXJuOi9eYHxgJC8sYWxpYXM6InN0cmluZyJ9LGludGVycG9sYXRpb246e3BhdHRlcm46LygoPzpefFteXFxdKSg/OlxcezJ9KSopXCRceyg/Oltee31dfFx7KD86W157fV18XHtbXn1dKlx9KSpcfSkrXH0vLGxvb2tiZWhpbmQ6ITAsaW5zaWRlOnsiaW50ZXJwb2xhdGlvbi1wdW5jdHVhdGlvbiI6e3BhdHRlcm46L15cJFx7fFx9JC8sYWxpYXM6InB1bmN0dWF0aW9uIn0scmVzdDp0Lmxhbmd1YWdlcy5qYXZhc2NyaXB0fX0sc3RyaW5nOi9bXHNcU10rL319fSksdC5sYW5ndWFnZXMubWFya3VwJiYodC5sYW5ndWFnZXMubWFya3VwLnRhZy5hZGRJbmxpbmVkKCJzY3JpcHQiLCJqYXZhc2NyaXB0IiksdC5sYW5ndWFnZXMubWFya3VwLnRhZy5hZGRBdHRyaWJ1dGUoL29uKD86YWJvcnR8Ymx1cnxjaGFuZ2V8Y2xpY2t8Y29tcG9zaXRpb24oPzplbmR8c3RhcnR8dXBkYXRlKXxkYmxjbGlja3xlcnJvcnxmb2N1cyg/OmlufG91dCk/fGtleSg/OmRvd258dXApfGxvYWR8bW91c2UoPzpkb3dufGVudGVyfGxlYXZlfG1vdmV8b3V0fG92ZXJ8dXApfHJlc2V0fHJlc2l6ZXxzY3JvbGx8c2VsZWN0fHNsb3RjaGFuZ2V8c3VibWl0fHVubG9hZHx3aGVlbCkvLnNvdXJjZSwiamF2YXNjcmlwdCIpKSx0Lmxhbmd1YWdlcy5qcz10Lmxhbmd1YWdlcy5qYXZhc2NyaXB0LGZ1bmN0aW9uKCl7aWYodm9pZCAwIT09dCYmInVuZGVmaW5lZCIhPXR5cGVvZiBkb2N1bWVudCl7RWxlbWVudC5wcm90b3R5cGUubWF0Y2hlc3x8KEVsZW1lbnQucHJvdG90eXBlLm1hdGNoZXM9RWxlbWVudC5wcm90b3R5cGUubXNNYXRjaGVzU2VsZWN0b3J8fEVsZW1lbnQucHJvdG90eXBlLndlYmtpdE1hdGNoZXNTZWxlY3Rvcik7dmFyIGU9e2pzOiJqYXZhc2NyaXB0IixweToicHl0aG9uIixyYjoicnVieSIscHMxOiJwb3dlcnNoZWxsIixwc20xOiJwb3dlcnNoZWxsIixzaDoiYmFzaCIsYmF0OiJiYXRjaCIsaDoiYyIsdGV4OiJsYXRleCJ9LG49ImRhdGEtc3JjLXN0YXR1cyIsYT0ibG9hZGluZyIscj0ibG9hZGVkIixpPSdwcmVbZGF0YS1zcmNdOm5vdChbZGF0YS1zcmMtc3RhdHVzPSJsb2FkZWQiXSk6bm90KFtkYXRhLXNyYy1zdGF0dXM9ImxvYWRpbmciXSknLHM9L1xibGFuZyg/OnVhZ2UpPy0oW1x3LV0rKVxiL2k7dC5ob29rcy5hZGQoImJlZm9yZS1oaWdobGlnaHRhbGwiLChmdW5jdGlvbihlKXtlLnNlbGVjdG9yKz0iLCAiK2k7fSkpLHQuaG9va3MuYWRkKCJiZWZvcmUtc2FuaXR5LWNoZWNrIiwoZnVuY3Rpb24ocyl7dmFyIG89cy5lbGVtZW50O2lmKG8ubWF0Y2hlcyhpKSl7cy5jb2RlPSIiLG8uc2V0QXR0cmlidXRlKG4sYSk7dmFyIHU9by5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJDT0RFIikpO3UudGV4dENvbnRlbnQ9IkxvYWRpbmfigKYiO3ZhciBjPW8uZ2V0QXR0cmlidXRlKCJkYXRhLXNyYyIpLGQ9cy5sYW5ndWFnZTtpZigibm9uZSI9PT1kKXt2YXIgcD0oL1wuKFx3KykkLy5leGVjKGMpfHxbLCJub25lIl0pWzFdO2Q9ZVtwXXx8cDt9bCh1LGQpLGwobyxkKTt2YXIgZz10LnBsdWdpbnMuYXV0b2xvYWRlcjtnJiZnLmxvYWRMYW5ndWFnZXMoZCk7dmFyIGY9bmV3IFhNTEh0dHBSZXF1ZXN0O2Yub3BlbigiR0VUIixjLCEwKSxmLm9ucmVhZHlzdGF0ZWNoYW5nZT1mdW5jdGlvbigpe3ZhciBlLGE7ND09Zi5yZWFkeVN0YXRlJiYoZi5zdGF0dXM8NDAwJiZmLnJlc3BvbnNlVGV4dD8oby5zZXRBdHRyaWJ1dGUobixyKSx1LnRleHRDb250ZW50PWYucmVzcG9uc2VUZXh0LHQuaGlnaGxpZ2h0RWxlbWVudCh1KSk6KG8uc2V0QXR0cmlidXRlKG4sImZhaWxlZCIpLGYuc3RhdHVzPj00MDA/dS50ZXh0Q29udGVudD0oZT1mLnN0YXR1cyxhPWYuc3RhdHVzVGV4dCwi4pyWIEVycm9yICIrZSsiIHdoaWxlIGZldGNoaW5nIGZpbGU6ICIrYSk6dS50ZXh0Q29udGVudD0i4pyWIEVycm9yOiBGaWxlIGRvZXMgbm90IGV4aXN0IG9yIGlzIGVtcHR5IikpO30sZi5zZW5kKG51bGwpO319KSksdC5wbHVnaW5zLmZpbGVIaWdobGlnaHQ9e2hpZ2hsaWdodDpmdW5jdGlvbihlKXtmb3IodmFyIG4sYT0oZXx8ZG9jdW1lbnQpLnF1ZXJ5U2VsZWN0b3JBbGwoaSkscj0wO249YVtyKytdOyl0LmhpZ2hsaWdodEVsZW1lbnQobik7fX07dmFyIG89ITE7dC5maWxlSGlnaGxpZ2h0PWZ1bmN0aW9uKCl7b3x8KGNvbnNvbGUud2FybigiUHJpc20uZmlsZUhpZ2hsaWdodCBpcyBkZXByZWNhdGVkLiBVc2UgYFByaXNtLnBsdWdpbnMuZmlsZUhpZ2hsaWdodC5oaWdobGlnaHRgIGluc3RlYWQuIiksbz0hMCksdC5wbHVnaW5zLmZpbGVIaWdobGlnaHQuaGlnaGxpZ2h0LmFwcGx5KHRoaXMsYXJndW1lbnRzKTt9O31mdW5jdGlvbiBsKGUsdCl7dmFyIG49ZS5jbGFzc05hbWU7bj1uLnJlcGxhY2UocywiICIpKyIgbGFuZ3VhZ2UtIit0LGUuY2xhc3NOYW1lPW4ucmVwbGFjZSgvXHMrL2csIiAiKS50cmltKCk7fX0oKTt9KSk7IWZ1bmN0aW9uKGUpe3ZhciB0PWUudXRpbC5jbG9uZShlLmxhbmd1YWdlcy5qYXZhc2NyaXB0KSxuPS8oPzpcc3xcL1wvLiooPyEuKXxcL1wqKD86W14qXXxcKig/IVwvKSlcKlwvKS8uc291cmNlLGE9Lyg/Olx7KD86XHsoPzpce1tee31dKlx9fFtee31dKSpcfXxbXnt9XSkqXH0pLy5zb3VyY2Uscj0vKD86XHs8Uz4qXC57M30oPzpbXnt9XXw8QlJBQ0VTPikqXH0pLy5zb3VyY2U7ZnVuY3Rpb24gaShlLHQpe3JldHVybiBlPWUucmVwbGFjZSgvPFM+L2csKGZ1bmN0aW9uKCl7cmV0dXJuIG59KSkucmVwbGFjZSgvPEJSQUNFUz4vZywoZnVuY3Rpb24oKXtyZXR1cm4gYX0pKS5yZXBsYWNlKC88U1BSRUFEPi9nLChmdW5jdGlvbigpe3JldHVybiByfSkpLFJlZ0V4cChlLHQpfXI9aShyKS5zb3VyY2UsZS5sYW5ndWFnZXMuanN4PWUubGFuZ3VhZ2VzLmV4dGVuZCgibWFya3VwIix0KSxlLmxhbmd1YWdlcy5qc3gudGFnLnBhdHRlcm49aSgvPFwvPyg/Oltcdy46LV0rKD86PFM+Kyg/Oltcdy46JC1dKyg/Oj0oPzoiKD86XFxbXHNcU118W15cXCJdKSoifCcoPzpcXFtcc1xTXXxbXlxcJ10pKid8W15cc3snIi8+PV0rfDxCUkFDRVM+KSk/fDxTUFJFQUQ+KSkqPFM+KlwvPyk/Pi8uc291cmNlKSxlLmxhbmd1YWdlcy5qc3gudGFnLmluc2lkZS50YWcucGF0dGVybj0vXjxcLz9bXlxzPlwvXSovaSxlLmxhbmd1YWdlcy5qc3gudGFnLmluc2lkZVsiYXR0ci12YWx1ZSJdLnBhdHRlcm49Lz0oPyFceykoPzoiKD86XFxbXHNcU118W15cXCJdKSoifCcoPzpcXFtcc1xTXXxbXlxcJ10pKid8W15ccyciPl0rKS9pLGUubGFuZ3VhZ2VzLmpzeC50YWcuaW5zaWRlLnRhZy5pbnNpZGVbImNsYXNzLW5hbWUiXT0vXltBLVpdXHcqKD86XC5bQS1aXVx3KikqJC8sZS5sYW5ndWFnZXMuanN4LnRhZy5pbnNpZGUuY29tbWVudD10LmNvbW1lbnQsZS5sYW5ndWFnZXMuaW5zZXJ0QmVmb3JlKCJpbnNpZGUiLCJhdHRyLW5hbWUiLHtzcHJlYWQ6e3BhdHRlcm46aSgvPFNQUkVBRD4vLnNvdXJjZSksaW5zaWRlOmUubGFuZ3VhZ2VzLmpzeH19LGUubGFuZ3VhZ2VzLmpzeC50YWcpLGUubGFuZ3VhZ2VzLmluc2VydEJlZm9yZSgiaW5zaWRlIiwic3BlY2lhbC1hdHRyIix7c2NyaXB0OntwYXR0ZXJuOmkoLz08QlJBQ0VTPi8uc291cmNlKSxpbnNpZGU6eyJzY3JpcHQtcHVuY3R1YXRpb24iOntwYXR0ZXJuOi9ePSg/PVx7KS8sYWxpYXM6InB1bmN0dWF0aW9uIn0scmVzdDplLmxhbmd1YWdlcy5qc3h9LGFsaWFzOiJsYW5ndWFnZS1qYXZhc2NyaXB0In19LGUubGFuZ3VhZ2VzLmpzeC50YWcpO3ZhciBzPWZ1bmN0aW9uKGUpe3JldHVybiBlPyJzdHJpbmciPT10eXBlb2YgZT9lOiJzdHJpbmciPT10eXBlb2YgZS5jb250ZW50P2UuY29udGVudDplLmNvbnRlbnQubWFwKHMpLmpvaW4oIiIpOiIifSxvPWZ1bmN0aW9uKHQpe2Zvcih2YXIgbj1bXSxhPTA7YTx0Lmxlbmd0aDthKyspe3ZhciByPXRbYV0saT0hMTtpZigic3RyaW5nIiE9dHlwZW9mIHImJigidGFnIj09PXIudHlwZSYmci5jb250ZW50WzBdJiYidGFnIj09PXIuY29udGVudFswXS50eXBlPyI8LyI9PT1yLmNvbnRlbnRbMF0uY29udGVudFswXS5jb250ZW50P24ubGVuZ3RoPjAmJm5bbi5sZW5ndGgtMV0udGFnTmFtZT09PXMoci5jb250ZW50WzBdLmNvbnRlbnRbMV0pJiZuLnBvcCgpOiIvPiI9PT1yLmNvbnRlbnRbci5jb250ZW50Lmxlbmd0aC0xXS5jb250ZW50fHxuLnB1c2goe3RhZ05hbWU6cyhyLmNvbnRlbnRbMF0uY29udGVudFsxXSksb3BlbmVkQnJhY2VzOjB9KTpuLmxlbmd0aD4wJiYicHVuY3R1YXRpb24iPT09ci50eXBlJiYieyI9PT1yLmNvbnRlbnQ/bltuLmxlbmd0aC0xXS5vcGVuZWRCcmFjZXMrKzpuLmxlbmd0aD4wJiZuW24ubGVuZ3RoLTFdLm9wZW5lZEJyYWNlcz4wJiYicHVuY3R1YXRpb24iPT09ci50eXBlJiYifSI9PT1yLmNvbnRlbnQ/bltuLmxlbmd0aC0xXS5vcGVuZWRCcmFjZXMtLTppPSEwKSwoaXx8InN0cmluZyI9PXR5cGVvZiByKSYmbi5sZW5ndGg+MCYmMD09PW5bbi5sZW5ndGgtMV0ub3BlbmVkQnJhY2VzKXt2YXIgbD1zKHIpO2E8dC5sZW5ndGgtMSYmKCJzdHJpbmciPT10eXBlb2YgdFthKzFdfHwicGxhaW4tdGV4dCI9PT10W2ErMV0udHlwZSkmJihsKz1zKHRbYSsxXSksdC5zcGxpY2UoYSsxLDEpKSxhPjAmJigic3RyaW5nIj09dHlwZW9mIHRbYS0xXXx8InBsYWluLXRleHQiPT09dFthLTFdLnR5cGUpJiYobD1zKHRbYS0xXSkrbCx0LnNwbGljZShhLTEsMSksYS0tKSx0W2FdPW5ldyBlLlRva2VuKCJwbGFpbi10ZXh0IixsLG51bGwsbCk7fXIuY29udGVudCYmInN0cmluZyIhPXR5cGVvZiByLmNvbnRlbnQmJm8oci5jb250ZW50KTt9fTtlLmhvb2tzLmFkZCgiYWZ0ZXItdG9rZW5pemUiLChmdW5jdGlvbihlKXsianN4IiE9PWUubGFuZ3VhZ2UmJiJ0c3giIT09ZS5sYW5ndWFnZXx8byhlLnRva2Vucyk7fSkpO30oUHJpc20pLGZ1bmN0aW9uKGUpe2UubGFuZ3VhZ2VzLnR5cGVzY3JpcHQ9ZS5sYW5ndWFnZXMuZXh0ZW5kKCJqYXZhc2NyaXB0Iix7ImNsYXNzLW5hbWUiOntwYXR0ZXJuOi8oXGIoPzpjbGFzc3xleHRlbmRzfGltcGxlbWVudHN8aW5zdGFuY2VvZnxpbnRlcmZhY2V8bmV3fHR5cGUpXHMrKSg/IWtleW9mXGIpKD8hXHMpW18kYS16QS1aXHhBMC1cdUZGRkZdKD86KD8hXHMpWyRcd1x4QTAtXHVGRkZGXSkqKD86XHMqPCg/OltePD5dfDwoPzpbXjw+XXw8W148Pl0qPikqPikqPik/Lyxsb29rYmVoaW5kOiEwLGdyZWVkeTohMCxpbnNpZGU6bnVsbH0sYnVpbHRpbjovXGIoPzpzdHJpbmd8RnVuY3Rpb258YW55fG51bWJlcnxib29sZWFufEFycmF5fHN5bWJvbHxjb25zb2xlfFByb21pc2V8dW5rbm93bnxuZXZlcilcYi99KSxlLmxhbmd1YWdlcy50eXBlc2NyaXB0LmtleXdvcmQucHVzaCgvXGIoPzphYnN0cmFjdHxhc3xkZWNsYXJlfGltcGxlbWVudHN8aXN8a2V5b2Z8cmVhZG9ubHl8cmVxdWlyZSlcYi8sL1xiKD86YXNzZXJ0c3xpbmZlcnxpbnRlcmZhY2V8bW9kdWxlfG5hbWVzcGFjZXx0eXBlKVxiKD89XHMqKD86W3tfJGEtekEtWlx4QTAtXHVGRkZGXXwkKSkvLC9cYnR5cGVcYig/PVxzKig/OltceypdfCQpKS8pLGRlbGV0ZSBlLmxhbmd1YWdlcy50eXBlc2NyaXB0LnBhcmFtZXRlcjt2YXIgdD1lLmxhbmd1YWdlcy5leHRlbmQoInR5cGVzY3JpcHQiLHt9KTtkZWxldGUgdFsiY2xhc3MtbmFtZSJdLGUubGFuZ3VhZ2VzLnR5cGVzY3JpcHRbImNsYXNzLW5hbWUiXS5pbnNpZGU9dCxlLmxhbmd1YWdlcy5pbnNlcnRCZWZvcmUoInR5cGVzY3JpcHQiLCJmdW5jdGlvbiIse2RlY29yYXRvcjp7cGF0dGVybjovQFskXHdceEEwLVx1RkZGRl0rLyxpbnNpZGU6e2F0OntwYXR0ZXJuOi9eQC8sYWxpYXM6Im9wZXJhdG9yIn0sZnVuY3Rpb246L15bXHNcU10rL319LCJnZW5lcmljLWZ1bmN0aW9uIjp7cGF0dGVybjovIz8oPyFccylbXyRhLXpBLVpceEEwLVx1RkZGRl0oPzooPyFccylbJFx3XHhBMC1cdUZGRkZdKSpccyo8KD86W148Pl18PCg/OltePD5dfDxbXjw+XSo+KSo+KSo+KD89XHMqXCgpLyxncmVlZHk6ITAsaW5zaWRlOntmdW5jdGlvbjovXiM/KD8hXHMpW18kYS16QS1aXHhBMC1cdUZGRkZdKD86KD8hXHMpWyRcd1x4QTAtXHVGRkZGXSkqLyxnZW5lcmljOntwYXR0ZXJuOi88W1xzXFNdKy8sYWxpYXM6ImNsYXNzLW5hbWUiLGluc2lkZTp0fX19fSksZS5sYW5ndWFnZXMudHM9ZS5sYW5ndWFnZXMudHlwZXNjcmlwdDt9KFByaXNtKSxQcmlzbS5sYW5ndWFnZXMubWFya3VwPXtjb21tZW50OntwYXR0ZXJuOi88IS0tKD86KD8hPCEtLSlbXHNcU10pKj8tLT4vLGdyZWVkeTohMH0scHJvbG9nOntwYXR0ZXJuOi88XD9bXHNcU10rP1w/Pi8sZ3JlZWR5OiEwfSxkb2N0eXBlOntwYXR0ZXJuOi88IURPQ1RZUEUoPzpbXj4iJ1tcXV18IlteIl0qInwnW14nXSonKSsoPzpcWyg/OltePCInXF1dfCJbXiJdKiJ8J1teJ10qJ3w8KD8hIS0tKXw8IS0tKD86W14tXXwtKD8hLT4pKSotLT4pKlxdXHMqKT8+L2ksZ3JlZWR5OiEwLGluc2lkZTp7ImludGVybmFsLXN1YnNldCI6e3BhdHRlcm46LyheW15cW10qXFspW1xzXFNdKyg/PVxdPiQpLyxsb29rYmVoaW5kOiEwLGdyZWVkeTohMCxpbnNpZGU6bnVsbH0sc3RyaW5nOntwYXR0ZXJuOi8iW14iXSoifCdbXiddKicvLGdyZWVkeTohMH0scHVuY3R1YXRpb246L148IXw+JHxbW1xdXS8sImRvY3R5cGUtdGFnIjovXkRPQ1RZUEUvaSxuYW1lOi9bXlxzPD4nIl0rL319LGNkYXRhOntwYXR0ZXJuOi88IVxbQ0RBVEFcW1tcc1xTXSo/XF1cXT4vaSxncmVlZHk6ITB9LHRhZzp7cGF0dGVybjovPFwvPyg/IVxkKVteXHM+XC89JDwlXSsoPzpccyg/OlxzKlteXHM+XC89XSsoPzpccyo9XHMqKD86IlteIl0qInwnW14nXSonfFteXHMnIj49XSsoPz1bXHM+XSkpfCg/PVtccy8+XSkpKSspP1xzKlwvPz4vLGdyZWVkeTohMCxpbnNpZGU6e3RhZzp7cGF0dGVybjovXjxcLz9bXlxzPlwvXSsvLGluc2lkZTp7cHVuY3R1YXRpb246L148XC8/LyxuYW1lc3BhY2U6L15bXlxzPlwvOl0rOi99fSwic3BlY2lhbC1hdHRyIjpbXSwiYXR0ci12YWx1ZSI6e3BhdHRlcm46Lz1ccyooPzoiW14iXSoifCdbXiddKid8W15ccyciPj1dKykvLGluc2lkZTp7cHVuY3R1YXRpb246W3twYXR0ZXJuOi9ePS8sYWxpYXM6ImF0dHItZXF1YWxzIn0sLyJ8Jy9dfX0scHVuY3R1YXRpb246L1wvPz4vLCJhdHRyLW5hbWUiOntwYXR0ZXJuOi9bXlxzPlwvXSsvLGluc2lkZTp7bmFtZXNwYWNlOi9eW15ccz5cLzpdKzovfX19fSxlbnRpdHk6W3twYXR0ZXJuOi8mW1xkYS16XXsxLDh9Oy9pLGFsaWFzOiJuYW1lZC1lbnRpdHkifSwvJiN4P1tcZGEtZl17MSw4fTsvaV19LFByaXNtLmxhbmd1YWdlcy5tYXJrdXAudGFnLmluc2lkZVsiYXR0ci12YWx1ZSJdLmluc2lkZS5lbnRpdHk9UHJpc20ubGFuZ3VhZ2VzLm1hcmt1cC5lbnRpdHksUHJpc20ubGFuZ3VhZ2VzLm1hcmt1cC5kb2N0eXBlLmluc2lkZVsiaW50ZXJuYWwtc3Vic2V0Il0uaW5zaWRlPVByaXNtLmxhbmd1YWdlcy5tYXJrdXAsUHJpc20uaG9va3MuYWRkKCJ3cmFwIiwoZnVuY3Rpb24oZSl7ImVudGl0eSI9PT1lLnR5cGUmJihlLmF0dHJpYnV0ZXMudGl0bGU9ZS5jb250ZW50LnJlcGxhY2UoLyZhbXA7LywiJiIpKTt9KSksT2JqZWN0LmRlZmluZVByb3BlcnR5KFByaXNtLmxhbmd1YWdlcy5tYXJrdXAudGFnLCJhZGRJbmxpbmVkIix7dmFsdWU6ZnVuY3Rpb24oZSx0KXt2YXIgbj17fTtuWyJsYW5ndWFnZS0iK3RdPXtwYXR0ZXJuOi8oXjwhXFtDREFUQVxbKVtcc1xTXSs/KD89XF1cXT4kKS9pLGxvb2tiZWhpbmQ6ITAsaW5zaWRlOlByaXNtLmxhbmd1YWdlc1t0XX0sbi5jZGF0YT0vXjwhXFtDREFUQVxbfFxdXF0+JC9pO3ZhciBhPXsiaW5jbHVkZWQtY2RhdGEiOntwYXR0ZXJuOi88IVxbQ0RBVEFcW1tcc1xTXSo/XF1cXT4vaSxpbnNpZGU6bn19O2FbImxhbmd1YWdlLSIrdF09e3BhdHRlcm46L1tcc1xTXSsvLGluc2lkZTpQcmlzbS5sYW5ndWFnZXNbdF19O3ZhciByPXt9O3JbZV09e3BhdHRlcm46UmVnRXhwKC8oPF9fW14+XSo+KSg/OjwhXFtDREFUQVxbKD86W15cXV18XF0oPyFcXT4pKSpcXVxdPnwoPyE8IVxbQ0RBVEFcWylbXHNcU10pKj8oPz08XC9fXz4pLy5zb3VyY2UucmVwbGFjZSgvX18vZywoZnVuY3Rpb24oKXtyZXR1cm4gZX0pKSwiaSIpLGxvb2tiZWhpbmQ6ITAsZ3JlZWR5OiEwLGluc2lkZTphfSxQcmlzbS5sYW5ndWFnZXMuaW5zZXJ0QmVmb3JlKCJtYXJrdXAiLCJjZGF0YSIscik7fX0pLE9iamVjdC5kZWZpbmVQcm9wZXJ0eShQcmlzbS5sYW5ndWFnZXMubWFya3VwLnRhZywiYWRkQXR0cmlidXRlIix7dmFsdWU6ZnVuY3Rpb24oZSx0KXtQcmlzbS5sYW5ndWFnZXMubWFya3VwLnRhZy5pbnNpZGVbInNwZWNpYWwtYXR0ciJdLnB1c2goe3BhdHRlcm46UmVnRXhwKC8oXnxbIidcc10pLy5zb3VyY2UrIig/OiIrZSsiKSIrL1xzKj1ccyooPzoiW14iXSoifCdbXiddKid8W15ccyciPj1dKyg/PVtccz5dKSkvLnNvdXJjZSwiaSIpLGxvb2tiZWhpbmQ6ITAsaW5zaWRlOnsiYXR0ci1uYW1lIjovXlteXHM9XSsvLCJhdHRyLXZhbHVlIjp7cGF0dGVybjovPVtcc1xTXSsvLGluc2lkZTp7dmFsdWU6e3BhdHRlcm46LyhePVxzKihbIiddfCg/IVsiJ10pKSlcU1tcc1xTXSooPz1cMiQpLyxsb29rYmVoaW5kOiEwLGFsaWFzOlt0LCJsYW5ndWFnZS0iK3RdLGluc2lkZTpQcmlzbS5sYW5ndWFnZXNbdF19LHB1bmN0dWF0aW9uOlt7cGF0dGVybjovXj0vLGFsaWFzOiJhdHRyLWVxdWFscyJ9LC8ifCcvXX19fX0pO319KSxQcmlzbS5sYW5ndWFnZXMuaHRtbD1QcmlzbS5sYW5ndWFnZXMubWFya3VwLFByaXNtLmxhbmd1YWdlcy5tYXRobWw9UHJpc20ubGFuZ3VhZ2VzLm1hcmt1cCxQcmlzbS5sYW5ndWFnZXMuc3ZnPVByaXNtLmxhbmd1YWdlcy5tYXJrdXAsUHJpc20ubGFuZ3VhZ2VzLnhtbD1QcmlzbS5sYW5ndWFnZXMuZXh0ZW5kKCJtYXJrdXAiLHt9KSxQcmlzbS5sYW5ndWFnZXMuc3NtbD1QcmlzbS5sYW5ndWFnZXMueG1sLFByaXNtLmxhbmd1YWdlcy5hdG9tPVByaXNtLmxhbmd1YWdlcy54bWwsUHJpc20ubGFuZ3VhZ2VzLnJzcz1QcmlzbS5sYW5ndWFnZXMueG1sLFByaXNtLmxhbmd1YWdlcy5nbz1QcmlzbS5sYW5ndWFnZXMuZXh0ZW5kKCJjbGlrZSIse3N0cmluZzp7cGF0dGVybjovKFsiJ2BdKSg/OlxcW1xzXFNdfCg/IVwxKVteXFxdKSpcMS8sZ3JlZWR5OiEwfSxrZXl3b3JkOi9cYig/OmJyZWFrfGNhc2V8Y2hhbnxjb25zdHxjb250aW51ZXxkZWZhdWx0fGRlZmVyfGVsc2V8ZmFsbHRocm91Z2h8Zm9yfGZ1bmN8Z28oPzp0byk/fGlmfGltcG9ydHxpbnRlcmZhY2V8bWFwfHBhY2thZ2V8cmFuZ2V8cmV0dXJufHNlbGVjdHxzdHJ1Y3R8c3dpdGNofHR5cGV8dmFyKVxiLyxib29sZWFuOi9cYig/Ol98aW90YXxuaWx8dHJ1ZXxmYWxzZSlcYi8sbnVtYmVyOi8oPzpcYjB4W2EtZlxkXSt8KD86XGJcZCsoPzpcLlxkKik/fFxCXC5cZCspKD86ZVstK10/XGQrKT8paT8vaSxvcGVyYXRvcjovWypcLyVeIT1dPT98XCtbPStdP3wtWz0tXT98XHxbPXxdP3wmKD86PXwmfFxePT8pP3w+KD86Pj0/fD0pP3w8KD86PD0/fD18LSk/fDo9fFwuXC5cLi8sYnVpbHRpbjovXGIoPzpib29sfGJ5dGV8Y29tcGxleCg/OjY0fDEyOCl8ZXJyb3J8ZmxvYXQoPzozMnw2NCl8cnVuZXxzdHJpbmd8dT9pbnQoPzo4fDE2fDMyfDY0KT98dWludHB0cnxhcHBlbmR8Y2FwfGNsb3NlfGNvbXBsZXh8Y29weXxkZWxldGV8aW1hZ3xsZW58bWFrZXxuZXd8cGFuaWN8cHJpbnQoPzpsbik/fHJlYWx8cmVjb3ZlcilcYi99KSxkZWxldGUgUHJpc20ubGFuZ3VhZ2VzLmdvWyJjbGFzcy1uYW1lIl0sZnVuY3Rpb24oZSl7dmFyIHQ9L1wvXCpbXHNcU10qP1wqXC98XC9cLy4qfCMoPyFcWykuKi8sbj1be3BhdHRlcm46L1xiKD86ZmFsc2V8dHJ1ZSlcYi9pLGFsaWFzOiJib29sZWFuIn0se3BhdHRlcm46Lyg6OlxzKilcYlthLXpfXVx3KlxiKD8hXHMqXCgpL2ksZ3JlZWR5OiEwLGxvb2tiZWhpbmQ6ITB9LHtwYXR0ZXJuOi8oXGIoPzpjYXNlfGNvbnN0KVxzKylcYlthLXpfXVx3Kig/PVxzKls7PV0pL2ksZ3JlZWR5OiEwLGxvb2tiZWhpbmQ6ITB9LC9cYig/Om51bGwpXGIvaSwvXGJbQS1aX11bQS1aMC05X10qXGIoPyFccypcKCkvXSxhPS9cYjBiWzAxXSsoPzpfWzAxXSspKlxifFxiMG9bMC03XSsoPzpfWzAtN10rKSpcYnxcYjB4W1xkYS1mXSsoPzpfW1xkYS1mXSspKlxifCg/OlxiXGQrKD86X1xkKykqXC4/KD86XGQrKD86X1xkKykqKT98XEJcLlxkKykoPzplWystXT9cZCspPy9pLHI9Lzw/PT58XD9cPz0/fFwuezN9fFw/Py0+fFshPV09Pz0/fDo6fFwqXCo9P3wtLXxcK1wrfCYmfFx8XHx8PDx8Pj58Wz9+XXxbL158JSomPD4uKy1dPT8vLGk9L1t7fVxbXF0oKSw6O10vO2UubGFuZ3VhZ2VzLnBocD17ZGVsaW1pdGVyOntwYXR0ZXJuOi9cPz4kfF48XD8oPzpwaHAoPz1ccyl8PSk/L2ksYWxpYXM6ImltcG9ydGFudCJ9LGNvbW1lbnQ6dCx2YXJpYWJsZTovXCQrKD86XHcrXGJ8KD89XHspKS9pLHBhY2thZ2U6e3BhdHRlcm46LyhuYW1lc3BhY2Vccyt8dXNlXHMrKD86ZnVuY3Rpb25ccyspPykoPzpcXD9cYlthLXpfXVx3KikrXGIoPyFcXCkvaSxsb29rYmVoaW5kOiEwLGluc2lkZTp7cHVuY3R1YXRpb246L1xcL319LCJjbGFzcy1uYW1lLWRlZmluaXRpb24iOntwYXR0ZXJuOi8oXGIoPzpjbGFzc3xlbnVtfGludGVyZmFjZXx0cmFpdClccyspXGJbYS16X11cdyooPyFcXClcYi9pLGxvb2tiZWhpbmQ6ITAsYWxpYXM6ImNsYXNzLW5hbWUifSwiZnVuY3Rpb24tZGVmaW5pdGlvbiI6e3BhdHRlcm46LyhcYmZ1bmN0aW9uXHMrKVthLXpfXVx3Kig/PVxzKlwoKS9pLGxvb2tiZWhpbmQ6ITAsYWxpYXM6ImZ1bmN0aW9uIn0sa2V5d29yZDpbe3BhdHRlcm46LyhcKFxzKilcYig/OmJvb2x8Ym9vbGVhbnxpbnR8aW50ZWdlcnxmbG9hdHxzdHJpbmd8b2JqZWN0fGFycmF5KVxiKD89XHMqXCkpL2ksYWxpYXM6InR5cGUtY2FzdGluZyIsZ3JlZWR5OiEwLGxvb2tiZWhpbmQ6ITB9LHtwYXR0ZXJuOi8oWygsP11ccyopXGIoPzpib29sfGludHxmbG9hdHxzdHJpbmd8b2JqZWN0fGFycmF5KD8hXHMqXCgpfG1peGVkfHNlbGZ8c3RhdGljfGNhbGxhYmxlfGl0ZXJhYmxlfCg/Om51bGx8ZmFsc2UpKD89XHMqXHwpKVxiKD89XHMqXCQpL2ksYWxpYXM6InR5cGUtaGludCIsZ3JlZWR5OiEwLGxvb2tiZWhpbmQ6ITB9LHtwYXR0ZXJuOi8oWygsP11ccypbXHd8XVx8XHMqKSg/Om51bGx8ZmFsc2UpXGIoPz1ccypcJCkvaSxhbGlhczoidHlwZS1oaW50IixncmVlZHk6ITAsbG9va2JlaGluZDohMH0se3BhdHRlcm46LyhcKVxzKjpccyooPzpcP1xzKik/KVxiKD86Ym9vbHxpbnR8ZmxvYXR8c3RyaW5nfG9iamVjdHx2b2lkfGFycmF5KD8hXHMqXCgpfG1peGVkfHNlbGZ8c3RhdGljfGNhbGxhYmxlfGl0ZXJhYmxlfCg/Om51bGx8ZmFsc2UpKD89XHMqXHwpKVxiL2ksYWxpYXM6InJldHVybi10eXBlIixncmVlZHk6ITAsbG9va2JlaGluZDohMH0se3BhdHRlcm46LyhcKVxzKjpccyooPzpcP1xzKik/W1x3fF1cfFxzKikoPzpudWxsfGZhbHNlKVxiL2ksYWxpYXM6InJldHVybi10eXBlIixncmVlZHk6ITAsbG9va2JlaGluZDohMH0se3BhdHRlcm46L1xiKD86Ym9vbHxpbnR8ZmxvYXR8c3RyaW5nfG9iamVjdHx2b2lkfGFycmF5KD8hXHMqXCgpfG1peGVkfGl0ZXJhYmxlfCg/Om51bGx8ZmFsc2UpKD89XHMqXHwpKVxiL2ksYWxpYXM6InR5cGUtZGVjbGFyYXRpb24iLGdyZWVkeTohMH0se3BhdHRlcm46LyhcfFxzKikoPzpudWxsfGZhbHNlKVxiL2ksYWxpYXM6InR5cGUtZGVjbGFyYXRpb24iLGdyZWVkeTohMCxsb29rYmVoaW5kOiEwfSx7cGF0dGVybjovXGIoPzpwYXJlbnR8c2VsZnxzdGF0aWMpKD89XHMqOjopL2ksYWxpYXM6InN0YXRpYy1jb250ZXh0IixncmVlZHk6ITB9LHtwYXR0ZXJuOi8oXGJ5aWVsZFxzKylmcm9tXGIvaSxsb29rYmVoaW5kOiEwfSwvXGJjbGFzc1xiL2kse3BhdHRlcm46LygoPzpefFteXHM+Ol18KD86XnxbXi1dKT58KD86XnxbXjpdKTopXHMqKVxiKD86X19oYWx0X2NvbXBpbGVyfGFic3RyYWN0fGFuZHxhcnJheXxhc3xicmVha3xjYWxsYWJsZXxjYXNlfGNhdGNofGNsb25lfGNvbnN0fGNvbnRpbnVlfGRlY2xhcmV8ZGVmYXVsdHxkaWV8ZG98ZWNob3xlbHNlfGVsc2VpZnxlbXB0eXxlbmRkZWNsYXJlfGVuZGZvcnxlbmRmb3JlYWNofGVuZGlmfGVuZHN3aXRjaHxlbmR3aGlsZXxlbnVtfGV2YWx8ZXhpdHxleHRlbmRzfGZpbmFsfGZpbmFsbHl8Zm58Zm9yfGZvcmVhY2h8ZnVuY3Rpb258Z2xvYmFsfGdvdG98aWZ8aW1wbGVtZW50c3xpbmNsdWRlfGluY2x1ZGVfb25jZXxpbnN0YW5jZW9mfGluc3RlYWRvZnxpbnRlcmZhY2V8aXNzZXR8bGlzdHxuYW1lc3BhY2V8bWF0Y2h8bmV3fG9yfHBhcmVudHxwcmludHxwcml2YXRlfHByb3RlY3RlZHxwdWJsaWN8cmVxdWlyZXxyZXF1aXJlX29uY2V8cmV0dXJufHNlbGZ8c3RhdGljfHN3aXRjaHx0aHJvd3x0cmFpdHx0cnl8dW5zZXR8dXNlfHZhcnx3aGlsZXx4b3J8eWllbGQpXGIvaSxsb29rYmVoaW5kOiEwfV0sImFyZ3VtZW50LW5hbWUiOntwYXR0ZXJuOi8oWygsXVxzKylcYlthLXpfXVx3Kig/PVxzKjooPyE6KSkvaSxsb29rYmVoaW5kOiEwfSwiY2xhc3MtbmFtZSI6W3twYXR0ZXJuOi8oXGIoPzpleHRlbmRzfGltcGxlbWVudHN8aW5zdGFuY2VvZnxuZXcoPyFccytzZWxmfFxzK3N0YXRpYykpXHMrfFxiY2F0Y2hccypcKClcYlthLXpfXVx3Kig/IVxcKVxiL2ksZ3JlZWR5OiEwLGxvb2tiZWhpbmQ6ITB9LHtwYXR0ZXJuOi8oXHxccyopXGJbYS16X11cdyooPyFcXClcYi9pLGdyZWVkeTohMCxsb29rYmVoaW5kOiEwfSx7cGF0dGVybjovXGJbYS16X11cdyooPyFcXClcYig/PVxzKlx8KS9pLGdyZWVkeTohMH0se3BhdHRlcm46LyhcfFxzKikoPzpcXD9cYlthLXpfXVx3KikrXGIvaSxhbGlhczoiY2xhc3MtbmFtZS1mdWxseS1xdWFsaWZpZWQiLGdyZWVkeTohMCxsb29rYmVoaW5kOiEwLGluc2lkZTp7cHVuY3R1YXRpb246L1xcL319LHtwYXR0ZXJuOi8oPzpcXD9cYlthLXpfXVx3KikrXGIoPz1ccypcfCkvaSxhbGlhczoiY2xhc3MtbmFtZS1mdWxseS1xdWFsaWZpZWQiLGdyZWVkeTohMCxpbnNpZGU6e3B1bmN0dWF0aW9uOi9cXC99fSx7cGF0dGVybjovKFxiKD86ZXh0ZW5kc3xpbXBsZW1lbnRzfGluc3RhbmNlb2Z8bmV3KD8hXHMrc2VsZlxifFxzK3N0YXRpY1xiKSlccyt8XGJjYXRjaFxzKlwoKSg/OlxcP1xiW2Etel9dXHcqKStcYig/IVxcKS9pLGFsaWFzOiJjbGFzcy1uYW1lLWZ1bGx5LXF1YWxpZmllZCIsZ3JlZWR5OiEwLGxvb2tiZWhpbmQ6ITAsaW5zaWRlOntwdW5jdHVhdGlvbjovXFwvfX0se3BhdHRlcm46L1xiW2Etel9dXHcqKD89XHMqXCQpL2ksYWxpYXM6InR5cGUtZGVjbGFyYXRpb24iLGdyZWVkeTohMH0se3BhdHRlcm46Lyg/OlxcP1xiW2Etel9dXHcqKSsoPz1ccypcJCkvaSxhbGlhczpbImNsYXNzLW5hbWUtZnVsbHktcXVhbGlmaWVkIiwidHlwZS1kZWNsYXJhdGlvbiJdLGdyZWVkeTohMCxpbnNpZGU6e3B1bmN0dWF0aW9uOi9cXC99fSx7cGF0dGVybjovXGJbYS16X11cdyooPz1ccyo6OikvaSxhbGlhczoic3RhdGljLWNvbnRleHQiLGdyZWVkeTohMH0se3BhdHRlcm46Lyg/OlxcP1xiW2Etel9dXHcqKSsoPz1ccyo6OikvaSxhbGlhczpbImNsYXNzLW5hbWUtZnVsbHktcXVhbGlmaWVkIiwic3RhdGljLWNvbnRleHQiXSxncmVlZHk6ITAsaW5zaWRlOntwdW5jdHVhdGlvbjovXFwvfX0se3BhdHRlcm46LyhbKCw/XVxzKilbYS16X11cdyooPz1ccypcJCkvaSxhbGlhczoidHlwZS1oaW50IixncmVlZHk6ITAsbG9va2JlaGluZDohMH0se3BhdHRlcm46LyhbKCw/XVxzKikoPzpcXD9cYlthLXpfXVx3KikrKD89XHMqXCQpL2ksYWxpYXM6WyJjbGFzcy1uYW1lLWZ1bGx5LXF1YWxpZmllZCIsInR5cGUtaGludCJdLGdyZWVkeTohMCxsb29rYmVoaW5kOiEwLGluc2lkZTp7cHVuY3R1YXRpb246L1xcL319LHtwYXR0ZXJuOi8oXClccyo6XHMqKD86XD9ccyopPylcYlthLXpfXVx3Kig/IVxcKVxiL2ksYWxpYXM6InJldHVybi10eXBlIixncmVlZHk6ITAsbG9va2JlaGluZDohMH0se3BhdHRlcm46LyhcKVxzKjpccyooPzpcP1xzKik/KSg/OlxcP1xiW2Etel9dXHcqKStcYig/IVxcKS9pLGFsaWFzOlsiY2xhc3MtbmFtZS1mdWxseS1xdWFsaWZpZWQiLCJyZXR1cm4tdHlwZSJdLGdyZWVkeTohMCxsb29rYmVoaW5kOiEwLGluc2lkZTp7cHVuY3R1YXRpb246L1xcL319XSxjb25zdGFudDpuLGZ1bmN0aW9uOntwYXR0ZXJuOi8oXnxbXlxcXHddKVxcP1thLXpfXSg/Oltcd1xcXSpcdyk/KD89XHMqXCgpL2ksbG9va2JlaGluZDohMCxpbnNpZGU6e3B1bmN0dWF0aW9uOi9cXC99fSxwcm9wZXJ0eTp7cGF0dGVybjovKC0+XHMqKVx3Ky8sbG9va2JlaGluZDohMH0sbnVtYmVyOmEsb3BlcmF0b3I6cixwdW5jdHVhdGlvbjppfTt2YXIgcz17cGF0dGVybjovXHtcJCg/Olx7KD86XHtbXnt9XStcfXxbXnt9XSspXH18W157fV0pK1x9fChefFteXFx7XSlcJCsoPzpcdysoPzpcW1teXHJcblxbXF1dK1xdfC0+XHcrKT8pLyxsb29rYmVoaW5kOiEwLGluc2lkZTplLmxhbmd1YWdlcy5waHB9LG89W3twYXR0ZXJuOi88PDwnKFteJ10rKSdbXHJcbl0oPzouKltcclxuXSkqP1wxOy8sYWxpYXM6Im5vd2RvYy1zdHJpbmciLGdyZWVkeTohMCxpbnNpZGU6e2RlbGltaXRlcjp7cGF0dGVybjovXjw8PCdbXiddKyd8W2Etel9dXHcqOyQvaSxhbGlhczoic3ltYm9sIixpbnNpZGU6e3B1bmN0dWF0aW9uOi9ePDw8Jz98Wyc7XSQvfX19fSx7cGF0dGVybjovPDw8KD86IihbXiJdKykiW1xyXG5dKD86LipbXHJcbl0pKj9cMTt8KFthLXpfXVx3KilbXHJcbl0oPzouKltcclxuXSkqP1wyOykvaSxhbGlhczoiaGVyZWRvYy1zdHJpbmciLGdyZWVkeTohMCxpbnNpZGU6e2RlbGltaXRlcjp7cGF0dGVybjovXjw8PCg/OiJbXiJdKyJ8W2Etel9dXHcqKXxbYS16X11cdyo7JC9pLGFsaWFzOiJzeW1ib2wiLGluc2lkZTp7cHVuY3R1YXRpb246L148PDwiP3xbIjtdJC99fSxpbnRlcnBvbGF0aW9uOnN9fSx7cGF0dGVybjovYCg/OlxcW1xzXFNdfFteXFxgXSkqYC8sYWxpYXM6ImJhY2t0aWNrLXF1b3RlZC1zdHJpbmciLGdyZWVkeTohMH0se3BhdHRlcm46LycoPzpcXFtcc1xTXXxbXlxcJ10pKicvLGFsaWFzOiJzaW5nbGUtcXVvdGVkLXN0cmluZyIsZ3JlZWR5OiEwfSx7cGF0dGVybjovIig/OlxcW1xzXFNdfFteXFwiXSkqIi8sYWxpYXM6ImRvdWJsZS1xdW90ZWQtc3RyaW5nIixncmVlZHk6ITAsaW5zaWRlOntpbnRlcnBvbGF0aW9uOnN9fV07ZS5sYW5ndWFnZXMuaW5zZXJ0QmVmb3JlKCJwaHAiLCJ2YXJpYWJsZSIse3N0cmluZzpvLGF0dHJpYnV0ZTp7cGF0dGVybjovI1xbKD86W14iJ1wvI118XC8oPyFbKi9dKXxcL1wvLiokfCMoPyFcWykuKiR8XC9cKig/OlteKl18XCooPyFcLykpKlwqXC98Iig/OlxcW1xzXFNdfFteXFwiXSkqInwnKD86XFxbXHNcU118W15cXCddKSonKStcXSg/PVxzKlthLXokI10pL2ltLGdyZWVkeTohMCxpbnNpZGU6eyJhdHRyaWJ1dGUtY29udGVudCI6e3BhdHRlcm46L14oI1xbKVtcc1xTXSsoPz1cXSQpLyxsb29rYmVoaW5kOiEwLGluc2lkZTp7Y29tbWVudDp0LHN0cmluZzpvLCJhdHRyaWJ1dGUtY2xhc3MtbmFtZSI6W3twYXR0ZXJuOi8oW146XXxeKVxiW2Etel9dXHcqKD8hXFwpXGIvaSxhbGlhczoiY2xhc3MtbmFtZSIsZ3JlZWR5OiEwLGxvb2tiZWhpbmQ6ITB9LHtwYXR0ZXJuOi8oW146XXxeKSg/OlxcP1xiW2Etel9dXHcqKSsvaSxhbGlhczpbImNsYXNzLW5hbWUiLCJjbGFzcy1uYW1lLWZ1bGx5LXF1YWxpZmllZCJdLGdyZWVkeTohMCxsb29rYmVoaW5kOiEwLGluc2lkZTp7cHVuY3R1YXRpb246L1xcL319XSxjb25zdGFudDpuLG51bWJlcjphLG9wZXJhdG9yOnIscHVuY3R1YXRpb246aX19LGRlbGltaXRlcjp7cGF0dGVybjovXiNcW3xcXSQvLGFsaWFzOiJwdW5jdHVhdGlvbiJ9fX19KSxlLmhvb2tzLmFkZCgiYmVmb3JlLXRva2VuaXplIiwoZnVuY3Rpb24odCl7aWYoLzxcPy8udGVzdCh0LmNvZGUpKXtlLmxhbmd1YWdlc1sibWFya3VwLXRlbXBsYXRpbmciXS5idWlsZFBsYWNlaG9sZGVycyh0LCJwaHAiLC88XD8oPzpbXiInLyNdfFwvKD8hWyovXSl8KCJ8JykoPzpcXFtcc1xTXXwoPyFcMSlbXlxcXSkqXDF8KD86XC9cL3wjKD8hXFspKSg/OlteP1xuXHJdfFw/KD8hPikpKig/PSR8XD8+fFtcclxuXSl8I1xbfFwvXCooPzpbXipdfFwqKD8hXC8pKSooPzpcKlwvfCQpKSo/KD86XD8+fCQpL2dpKTt9fSkpLGUuaG9va3MuYWRkKCJhZnRlci10b2tlbml6ZSIsKGZ1bmN0aW9uKHQpe2UubGFuZ3VhZ2VzWyJtYXJrdXAtdGVtcGxhdGluZyJdLnRva2VuaXplUGxhY2Vob2xkZXJzKHQsInBocCIpO30pKTt9KFByaXNtKSxQcmlzbS5sYW5ndWFnZXMuYz1QcmlzbS5sYW5ndWFnZXMuZXh0ZW5kKCJjbGlrZSIse2NvbW1lbnQ6e3BhdHRlcm46L1wvXC8oPzpbXlxyXG5cXF18XFwoPzpcclxuP3xcbnwoPyFbXHJcbl0pKSkqfFwvXCpbXHNcU10qPyg/OlwqXC98JCkvLGdyZWVkeTohMH0sImNsYXNzLW5hbWUiOntwYXR0ZXJuOi8oXGIoPzplbnVtfHN0cnVjdClccysoPzpfX2F0dHJpYnV0ZV9fXHMqXChcKFtcc1xTXSo/XClcKVxzKik/KVx3K3xcYlthLXpdXHcqX3RcYi8sbG9va2JlaGluZDohMH0sa2V5d29yZDovXGIoPzpfX2F0dHJpYnV0ZV9ffF9BbGlnbmFzfF9BbGlnbm9mfF9BdG9taWN8X0Jvb2x8X0NvbXBsZXh8X0dlbmVyaWN8X0ltYWdpbmFyeXxfTm9yZXR1cm58X1N0YXRpY19hc3NlcnR8X1RocmVhZF9sb2NhbHxhc218dHlwZW9mfGlubGluZXxhdXRvfGJyZWFrfGNhc2V8Y2hhcnxjb25zdHxjb250aW51ZXxkZWZhdWx0fGRvfGRvdWJsZXxlbHNlfGVudW18ZXh0ZXJufGZsb2F0fGZvcnxnb3RvfGlmfGludHxsb25nfHJlZ2lzdGVyfHJldHVybnxzaG9ydHxzaWduZWR8c2l6ZW9mfHN0YXRpY3xzdHJ1Y3R8c3dpdGNofHR5cGVkZWZ8dW5pb258dW5zaWduZWR8dm9pZHx2b2xhdGlsZXx3aGlsZSlcYi8sZnVuY3Rpb246L1xiW2Etel9dXHcqKD89XHMqXCgpL2ksbnVtYmVyOi8oPzpcYjB4KD86W1xkYS1mXSsoPzpcLltcZGEtZl0qKT98XC5bXGRhLWZdKykoPzpwWystXT9cZCspP3woPzpcYlxkKyg/OlwuXGQqKT98XEJcLlxkKykoPzplWystXT9cZCspPylbZnVsXXswLDR9L2ksb3BlcmF0b3I6Lz4+PT98PDw9P3wtPnwoWy0rJnw6XSlcMXxbPzp+XXxbLSsqLyUmfF4hPTw+XT0/L30pLFByaXNtLmxhbmd1YWdlcy5pbnNlcnRCZWZvcmUoImMiLCJzdHJpbmciLHttYWNybzp7cGF0dGVybjovKF5bXHQgXSopI1xzKlthLXpdKD86W15cclxuXFwvXXxcLyg/IVwqKXxcL1wqKD86W14qXXxcKig/IVwvKSkqXCpcL3xcXCg/OlxyXG58W1xzXFNdKSkqL2ltLGxvb2tiZWhpbmQ6ITAsZ3JlZWR5OiEwLGFsaWFzOiJwcm9wZXJ0eSIsaW5zaWRlOntzdHJpbmc6W3twYXR0ZXJuOi9eKCNccyppbmNsdWRlXHMqKTxbXj5dKz4vLGxvb2tiZWhpbmQ6ITB9LFByaXNtLmxhbmd1YWdlcy5jLnN0cmluZ10sY29tbWVudDpQcmlzbS5sYW5ndWFnZXMuYy5jb21tZW50LCJtYWNyby1uYW1lIjpbe3BhdHRlcm46LyheI1xzKmRlZmluZVxzKylcdytcYig/IVwoKS9pLGxvb2tiZWhpbmQ6ITB9LHtwYXR0ZXJuOi8oXiNccypkZWZpbmVccyspXHcrXGIoPz1cKCkvaSxsb29rYmVoaW5kOiEwLGFsaWFzOiJmdW5jdGlvbiJ9XSxkaXJlY3RpdmU6e3BhdHRlcm46L14oI1xzKilbYS16XSsvLGxvb2tiZWhpbmQ6ITAsYWxpYXM6ImtleXdvcmQifSwiZGlyZWN0aXZlLWhhc2giOi9eIy8scHVuY3R1YXRpb246LyMjfFxcKD89W1xyXG5dKS8sZXhwcmVzc2lvbjp7cGF0dGVybjovXFNbXHNcU10qLyxpbnNpZGU6UHJpc20ubGFuZ3VhZ2VzLmN9fX0sY29uc3RhbnQ6L1xiKD86X19GSUxFX198X19MSU5FX198X19EQVRFX198X19USU1FX198X19USU1FU1RBTVBfX3xfX2Z1bmNfX3xFT0Z8TlVMTHxTRUVLX0NVUnxTRUVLX0VORHxTRUVLX1NFVHxzdGRpbnxzdGRvdXR8c3RkZXJyKVxiL30pLGRlbGV0ZSBQcmlzbS5sYW5ndWFnZXMuYy5ib29sZWFuLFByaXNtLmxhbmd1YWdlcy5weXRob249e2NvbW1lbnQ6e3BhdHRlcm46LyhefFteXFxdKSMuKi8sbG9va2JlaGluZDohMH0sInN0cmluZy1pbnRlcnBvbGF0aW9uIjp7cGF0dGVybjovKD86ZnxyZnxmcikoPzooIiIifCcnJylbXHNcU10qP1wxfCgifCcpKD86XFwufCg/IVwyKVteXFxcclxuXSkqXDIpL2ksZ3JlZWR5OiEwLGluc2lkZTp7aW50ZXJwb2xhdGlvbjp7cGF0dGVybjovKCg/Ol58W157XSkoPzpce1x7KSopXHsoPyFceykoPzpbXnt9XXxceyg/IVx7KSg/Oltee31dfFx7KD8hXHspKD86W157fV0pK1x9KStcfSkrXH0vLGxvb2tiZWhpbmQ6ITAsaW5zaWRlOnsiZm9ybWF0LXNwZWMiOntwYXR0ZXJuOi8oOilbXjooKXt9XSsoPz1cfSQpLyxsb29rYmVoaW5kOiEwfSwiY29udmVyc2lvbi1vcHRpb24iOntwYXR0ZXJuOi8hW3NyYV0oPz1bOn1dJCkvLGFsaWFzOiJwdW5jdHVhdGlvbiJ9LHJlc3Q6bnVsbH19LHN0cmluZzovW1xzXFNdKy99fSwidHJpcGxlLXF1b3RlZC1zdHJpbmciOntwYXR0ZXJuOi8oPzpbcnViXXxyYnxicik/KCIiInwnJycpW1xzXFNdKj9cMS9pLGdyZWVkeTohMCxhbGlhczoic3RyaW5nIn0sc3RyaW5nOntwYXR0ZXJuOi8oPzpbcnViXXxyYnxicik/KCJ8JykoPzpcXC58KD8hXDEpW15cXFxyXG5dKSpcMS9pLGdyZWVkeTohMH0sZnVuY3Rpb246e3BhdHRlcm46LygoPzpefFxzKWRlZlsgXHRdKylbYS16QS1aX11cdyooPz1ccypcKCkvZyxsb29rYmVoaW5kOiEwfSwiY2xhc3MtbmFtZSI6e3BhdHRlcm46LyhcYmNsYXNzXHMrKVx3Ky9pLGxvb2tiZWhpbmQ6ITB9LGRlY29yYXRvcjp7cGF0dGVybjovKF5bXHQgXSopQFx3Kyg/OlwuXHcrKSovaW0sbG9va2JlaGluZDohMCxhbGlhczpbImFubm90YXRpb24iLCJwdW5jdHVhdGlvbiJdLGluc2lkZTp7cHVuY3R1YXRpb246L1wuL319LGtleXdvcmQ6L1xiKD86YW5kfGFzfGFzc2VydHxhc3luY3xhd2FpdHxicmVha3xjbGFzc3xjb250aW51ZXxkZWZ8ZGVsfGVsaWZ8ZWxzZXxleGNlcHR8ZXhlY3xmaW5hbGx5fGZvcnxmcm9tfGdsb2JhbHxpZnxpbXBvcnR8aW58aXN8bGFtYmRhfG5vbmxvY2FsfG5vdHxvcnxwYXNzfHByaW50fHJhaXNlfHJldHVybnx0cnl8d2hpbGV8d2l0aHx5aWVsZClcYi8sYnVpbHRpbjovXGIoPzpfX2ltcG9ydF9ffGFic3xhbGx8YW55fGFwcGx5fGFzY2lpfGJhc2VzdHJpbmd8YmlufGJvb2x8YnVmZmVyfGJ5dGVhcnJheXxieXRlc3xjYWxsYWJsZXxjaHJ8Y2xhc3NtZXRob2R8Y21wfGNvZXJjZXxjb21waWxlfGNvbXBsZXh8ZGVsYXR0cnxkaWN0fGRpcnxkaXZtb2R8ZW51bWVyYXRlfGV2YWx8ZXhlY2ZpbGV8ZmlsZXxmaWx0ZXJ8ZmxvYXR8Zm9ybWF0fGZyb3plbnNldHxnZXRhdHRyfGdsb2JhbHN8aGFzYXR0cnxoYXNofGhlbHB8aGV4fGlkfGlucHV0fGludHxpbnRlcm58aXNpbnN0YW5jZXxpc3N1YmNsYXNzfGl0ZXJ8bGVufGxpc3R8bG9jYWxzfGxvbmd8bWFwfG1heHxtZW1vcnl2aWV3fG1pbnxuZXh0fG9iamVjdHxvY3R8b3BlbnxvcmR8cG93fHByb3BlcnR5fHJhbmdlfHJhd19pbnB1dHxyZWR1Y2V8cmVsb2FkfHJlcHJ8cmV2ZXJzZWR8cm91bmR8c2V0fHNldGF0dHJ8c2xpY2V8c29ydGVkfHN0YXRpY21ldGhvZHxzdHJ8c3VtfHN1cGVyfHR1cGxlfHR5cGV8dW5pY2hyfHVuaWNvZGV8dmFyc3x4cmFuZ2V8emlwKVxiLyxib29sZWFuOi9cYig/OlRydWV8RmFsc2V8Tm9uZSlcYi8sbnVtYmVyOi9cYjAoPzpiKD86Xz9bMDFdKSt8byg/Ol8/WzAtN10pK3x4KD86Xz9bYS1mMC05XSkrKVxifCg/OlxiXGQrKD86X1xkKykqKD86XC4oPzpcZCsoPzpfXGQrKSopPyk/fFxCXC5cZCsoPzpfXGQrKSopKD86ZVsrLV0/XGQrKD86X1xkKykqKT9qP1xiL2ksb3BlcmF0b3I6L1stKyU9XT0/fCE9fFwqXCo/PT98XC9cLz89P3w8Wzw9Pl0/fD5bPT5dP3xbJnxefl0vLHB1bmN0dWF0aW9uOi9be31bXF07KCksLjpdL30sUHJpc20ubGFuZ3VhZ2VzLnB5dGhvblsic3RyaW5nLWludGVycG9sYXRpb24iXS5pbnNpZGUuaW50ZXJwb2xhdGlvbi5pbnNpZGUucmVzdD1QcmlzbS5sYW5ndWFnZXMucHl0aG9uLFByaXNtLmxhbmd1YWdlcy5weT1QcmlzbS5sYW5ndWFnZXMucHl0aG9uLGZ1bmN0aW9uKGUpe3ZhciB0PS9cYig/OmFic3RyYWN0fGFzc2VydHxib29sZWFufGJyZWFrfGJ5dGV8Y2FzZXxjYXRjaHxjaGFyfGNsYXNzfGNvbnN0fGNvbnRpbnVlfGRlZmF1bHR8ZG98ZG91YmxlfGVsc2V8ZW51bXxleHBvcnRzfGV4dGVuZHN8ZmluYWx8ZmluYWxseXxmbG9hdHxmb3J8Z290b3xpZnxpbXBsZW1lbnRzfGltcG9ydHxpbnN0YW5jZW9mfGludHxpbnRlcmZhY2V8bG9uZ3xtb2R1bGV8bmF0aXZlfG5ld3xub24tc2VhbGVkfG51bGx8b3BlbnxvcGVuc3xwYWNrYWdlfHBlcm1pdHN8cHJpdmF0ZXxwcm90ZWN0ZWR8cHJvdmlkZXN8cHVibGljfHJlY29yZHxyZXF1aXJlc3xyZXR1cm58c2VhbGVkfHNob3J0fHN0YXRpY3xzdHJpY3RmcHxzdXBlcnxzd2l0Y2h8c3luY2hyb25pemVkfHRoaXN8dGhyb3d8dGhyb3dzfHRvfHRyYW5zaWVudHx0cmFuc2l0aXZlfHRyeXx1c2VzfHZhcnx2b2lkfHZvbGF0aWxlfHdoaWxlfHdpdGh8eWllbGQpXGIvLG49LyhefFteXHcuXSkoPzpbYS16XVx3KlxzKlwuXHMqKSooPzpbQS1aXVx3KlxzKlwuXHMqKSovLnNvdXJjZSxhPXtwYXR0ZXJuOlJlZ0V4cChuKy9bQS1aXSg/OltcZF9BLVpdKlthLXpdXHcqKT9cYi8uc291cmNlKSxsb29rYmVoaW5kOiEwLGluc2lkZTp7bmFtZXNwYWNlOntwYXR0ZXJuOi9eW2Etel1cdyooPzpccypcLlxzKlthLXpdXHcqKSooPzpccypcLik/LyxpbnNpZGU6e3B1bmN0dWF0aW9uOi9cLi99fSxwdW5jdHVhdGlvbjovXC4vfX07ZS5sYW5ndWFnZXMuamF2YT1lLmxhbmd1YWdlcy5leHRlbmQoImNsaWtlIix7ImNsYXNzLW5hbWUiOlthLHtwYXR0ZXJuOlJlZ0V4cChuKy9bQS1aXVx3Kig/PVxzK1x3K1xzKls7LD0oKV0pLy5zb3VyY2UpLGxvb2tiZWhpbmQ6ITAsaW5zaWRlOmEuaW5zaWRlfV0sa2V5d29yZDp0LGZ1bmN0aW9uOltlLmxhbmd1YWdlcy5jbGlrZS5mdW5jdGlvbix7cGF0dGVybjovKDo6XHMqKVthLXpfXVx3Ki8sbG9va2JlaGluZDohMH1dLG51bWJlcjovXGIwYlswMV1bMDFfXSpMP1xifFxiMHgoPzpcLltcZGEtZl9wKy1dK3xbXGRhLWZfXSsoPzpcLltcZGEtZl9wKy1dKyk/KVxifCg/OlxiXGRbXGRfXSooPzpcLltcZF9dKik/fFxCXC5cZFtcZF9dKikoPzplWystXT9cZFtcZF9dKik/W2RmbF0/L2ksb3BlcmF0b3I6e3BhdHRlcm46LyhefFteLl0pKD86PDw9P3w+Pj4/PT98LT58LS18XCtcK3wmJnxcfFx8fDo6fFs/On5dfFstKyovJSZ8XiE9PD5dPT8pL20sbG9va2JlaGluZDohMH19KSxlLmxhbmd1YWdlcy5pbnNlcnRCZWZvcmUoImphdmEiLCJzdHJpbmciLHsidHJpcGxlLXF1b3RlZC1zdHJpbmciOntwYXR0ZXJuOi8iIiJbIFx0XSpbXHJcbl0oPzooPzoifCIiKT8oPzpcXC58W14iXFxdKSkqIiIiLyxncmVlZHk6ITAsYWxpYXM6InN0cmluZyJ9fSksZS5sYW5ndWFnZXMuaW5zZXJ0QmVmb3JlKCJqYXZhIiwiY2xhc3MtbmFtZSIse2Fubm90YXRpb246e3BhdHRlcm46LyhefFteLl0pQFx3Kyg/OlxzKlwuXHMqXHcrKSovLGxvb2tiZWhpbmQ6ITAsYWxpYXM6InB1bmN0dWF0aW9uIn0sZ2VuZXJpY3M6e3BhdHRlcm46LzwoPzpbXHdccywuP118Jig/ISYpfDwoPzpbXHdccywuP118Jig/ISYpfDwoPzpbXHdccywuP118Jig/ISYpfDwoPzpbXHdccywuP118Jig/ISYpKSo+KSo+KSo+KSo+LyxpbnNpZGU6eyJjbGFzcy1uYW1lIjphLGtleXdvcmQ6dCxwdW5jdHVhdGlvbjovWzw+KCksLjpdLyxvcGVyYXRvcjovWz8mfF0vfX0sbmFtZXNwYWNlOntwYXR0ZXJuOlJlZ0V4cCgvKFxiKD86ZXhwb3J0c3xpbXBvcnQoPzpccytzdGF0aWMpP3xtb2R1bGV8b3BlbnxvcGVuc3xwYWNrYWdlfHByb3ZpZGVzfHJlcXVpcmVzfHRvfHRyYW5zaXRpdmV8dXNlc3x3aXRoKVxzKykoPyE8a2V5d29yZD4pW2Etel1cdyooPzpcLlthLXpdXHcqKSpcLj8vLnNvdXJjZS5yZXBsYWNlKC88a2V5d29yZD4vZywoZnVuY3Rpb24oKXtyZXR1cm4gdC5zb3VyY2V9KSkpLGxvb2tiZWhpbmQ6ITAsaW5zaWRlOntwdW5jdHVhdGlvbjovXC4vfX19KTt9KFByaXNtKSxmdW5jdGlvbihlKXt2YXIgdD0vXGIoPzphbGlnbmFzfGFsaWdub2Z8YXNtfGF1dG98Ym9vbHxicmVha3xjYXNlfGNhdGNofGNoYXJ8Y2hhcjhfdHxjaGFyMTZfdHxjaGFyMzJfdHxjbGFzc3xjb21wbHxjb25jZXB0fGNvbnN0fGNvbnN0ZXZhbHxjb25zdGV4cHJ8Y29uc3Rpbml0fGNvbnN0X2Nhc3R8Y29udGludWV8Y29fYXdhaXR8Y29fcmV0dXJufGNvX3lpZWxkfGRlY2x0eXBlfGRlZmF1bHR8ZGVsZXRlfGRvfGRvdWJsZXxkeW5hbWljX2Nhc3R8ZWxzZXxlbnVtfGV4cGxpY2l0fGV4cG9ydHxleHRlcm58ZmluYWx8ZmxvYXR8Zm9yfGZyaWVuZHxnb3RvfGlmfGltcG9ydHxpbmxpbmV8aW50fGludDhfdHxpbnQxNl90fGludDMyX3R8aW50NjRfdHx1aW50OF90fHVpbnQxNl90fHVpbnQzMl90fHVpbnQ2NF90fGxvbmd8bW9kdWxlfG11dGFibGV8bmFtZXNwYWNlfG5ld3xub2V4Y2VwdHxudWxscHRyfG9wZXJhdG9yfG92ZXJyaWRlfHByaXZhdGV8cHJvdGVjdGVkfHB1YmxpY3xyZWdpc3RlcnxyZWludGVycHJldF9jYXN0fHJlcXVpcmVzfHJldHVybnxzaG9ydHxzaWduZWR8c2l6ZW9mfHN0YXRpY3xzdGF0aWNfYXNzZXJ0fHN0YXRpY19jYXN0fHN0cnVjdHxzd2l0Y2h8dGVtcGxhdGV8dGhpc3x0aHJlYWRfbG9jYWx8dGhyb3d8dHJ5fHR5cGVkZWZ8dHlwZWlkfHR5cGVuYW1lfHVuaW9ufHVuc2lnbmVkfHVzaW5nfHZpcnR1YWx8dm9pZHx2b2xhdGlsZXx3Y2hhcl90fHdoaWxlKVxiLyxuPS9cYig/ITxrZXl3b3JkPilcdysoPzpccypcLlxzKlx3KykqXGIvLnNvdXJjZS5yZXBsYWNlKC88a2V5d29yZD4vZywoZnVuY3Rpb24oKXtyZXR1cm4gdC5zb3VyY2V9KSk7ZS5sYW5ndWFnZXMuY3BwPWUubGFuZ3VhZ2VzLmV4dGVuZCgiYyIseyJjbGFzcy1uYW1lIjpbe3BhdHRlcm46UmVnRXhwKC8oXGIoPzpjbGFzc3xjb25jZXB0fGVudW18c3RydWN0fHR5cGVuYW1lKVxzKykoPyE8a2V5d29yZD4pXHcrLy5zb3VyY2UucmVwbGFjZSgvPGtleXdvcmQ+L2csKGZ1bmN0aW9uKCl7cmV0dXJuIHQuc291cmNlfSkpKSxsb29rYmVoaW5kOiEwfSwvXGJbQS1aXVx3Kig/PVxzKjo6XHMqXHcrXHMqXCgpLywvXGJbQS1aX11cdyooPz1ccyo6OlxzKn5cdytccypcKCkvaSwvXGJcdysoPz1ccyo8KD86W148Pl18PCg/OltePD5dfDxbXjw+XSo+KSo+KSo+XHMqOjpccypcdytccypcKCkvXSxrZXl3b3JkOnQsbnVtYmVyOntwYXR0ZXJuOi8oPzpcYjBiWzAxJ10rfFxiMHgoPzpbXGRhLWYnXSsoPzpcLltcZGEtZiddKik/fFwuW1xkYS1mJ10rKSg/OnBbKy1dP1tcZCddKyk/fCg/OlxiW1xkJ10rKD86XC5bXGQnXSopP3xcQlwuW1xkJ10rKSg/OmVbKy1dP1tcZCddKyk/KVtmdWxdezAsNH0vaSxncmVlZHk6ITB9LG9wZXJhdG9yOi8+Pj0/fDw8PT98LT58LS18XCtcK3wmJnxcfFx8fFs/On5dfDw9PnxbLSsqLyUmfF4hPTw+XT0/fFxiKD86YW5kfGFuZF9lcXxiaXRhbmR8Yml0b3J8bm90fG5vdF9lcXxvcnxvcl9lcXx4b3J8eG9yX2VxKVxiLyxib29sZWFuOi9cYig/OnRydWV8ZmFsc2UpXGIvfSksZS5sYW5ndWFnZXMuaW5zZXJ0QmVmb3JlKCJjcHAiLCJzdHJpbmciLHttb2R1bGU6e3BhdHRlcm46UmVnRXhwKC8oXGIoPzptb2R1bGV8aW1wb3J0KVxzKykvLnNvdXJjZSsiKD86IisvIig/OlxcKD86XHJcbnxbXHNcU10pfFteIlxcXHJcbl0pKiJ8PFtePD5cclxuXSo+Ly5zb3VyY2UrInwiKy88bW9kLW5hbWU+KD86XHMqOlxzKjxtb2QtbmFtZT4pP3w6XHMqPG1vZC1uYW1lPi8uc291cmNlLnJlcGxhY2UoLzxtb2QtbmFtZT4vZywoZnVuY3Rpb24oKXtyZXR1cm4gbn0pKSsiKSIpLGxvb2tiZWhpbmQ6ITAsZ3JlZWR5OiEwLGluc2lkZTp7c3RyaW5nOi9eWzwiXVtcc1xTXSsvLG9wZXJhdG9yOi86LyxwdW5jdHVhdGlvbjovXC4vfX0sInJhdy1zdHJpbmciOntwYXR0ZXJuOi9SIihbXigpXFwgXXswLDE2fSlcKFtcc1xTXSo/XClcMSIvLGFsaWFzOiJzdHJpbmciLGdyZWVkeTohMH19KSxlLmxhbmd1YWdlcy5pbnNlcnRCZWZvcmUoImNwcCIsImtleXdvcmQiLHsiZ2VuZXJpYy1mdW5jdGlvbiI6e3BhdHRlcm46L1xiKD8hb3BlcmF0b3JcYilbYS16X11cdypccyo8KD86W148Pl18PFtePD5dKj4pKj4oPz1ccypcKCkvaSxpbnNpZGU6e2Z1bmN0aW9uOi9eXHcrLyxnZW5lcmljOntwYXR0ZXJuOi88W1xzXFNdKy8sYWxpYXM6ImNsYXNzLW5hbWUiLGluc2lkZTplLmxhbmd1YWdlcy5jcHB9fX19KSxlLmxhbmd1YWdlcy5pbnNlcnRCZWZvcmUoImNwcCIsIm9wZXJhdG9yIix7ImRvdWJsZS1jb2xvbiI6e3BhdHRlcm46Lzo6LyxhbGlhczoicHVuY3R1YXRpb24ifX0pLGUubGFuZ3VhZ2VzLmluc2VydEJlZm9yZSgiY3BwIiwiY2xhc3MtbmFtZSIseyJiYXNlLWNsYXVzZSI6e3BhdHRlcm46LyhcYig/OmNsYXNzfHN0cnVjdClccytcdytccyo6XHMqKVteO3t9Iidcc10rKD86XHMrW147e30iJ1xzXSspKig/PVxzKls7e10pLyxsb29rYmVoaW5kOiEwLGdyZWVkeTohMCxpbnNpZGU6ZS5sYW5ndWFnZXMuZXh0ZW5kKCJjcHAiLHt9KX19KSxlLmxhbmd1YWdlcy5pbnNlcnRCZWZvcmUoImluc2lkZSIsImRvdWJsZS1jb2xvbiIseyJjbGFzcy1uYW1lIjovXGJbYS16X11cdypcYig/IVxzKjo6KS9pfSxlLmxhbmd1YWdlcy5jcHBbImJhc2UtY2xhdXNlIl0pO30oUHJpc20pLGZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHQoZSx0KXtyZXR1cm4gZS5yZXBsYWNlKC88PChcZCspPj4vZywoZnVuY3Rpb24oZSxuKXtyZXR1cm4gIig/OiIrdFsrbl0rIikifSkpfWZ1bmN0aW9uIG4oZSxuLGEpe3JldHVybiBSZWdFeHAodChlLG4pLGF8fCIiKX1mdW5jdGlvbiBhKGUsdCl7Zm9yKHZhciBuPTA7bjx0O24rKyllPWUucmVwbGFjZSgvPDxzZWxmPj4vZywoZnVuY3Rpb24oKXtyZXR1cm4gIig/OiIrZSsiKSJ9KSk7cmV0dXJuIGUucmVwbGFjZSgvPDxzZWxmPj4vZywiW15cXHNcXFNdIil9dmFyIHI9ImJvb2wgYnl0ZSBjaGFyIGRlY2ltYWwgZG91YmxlIGR5bmFtaWMgZmxvYXQgaW50IGxvbmcgb2JqZWN0IHNieXRlIHNob3J0IHN0cmluZyB1aW50IHVsb25nIHVzaG9ydCB2YXIgdm9pZCIsaT0iY2xhc3MgZW51bSBpbnRlcmZhY2UgcmVjb3JkIHN0cnVjdCIscz0iYWRkIGFsaWFzIGFuZCBhc2NlbmRpbmcgYXN5bmMgYXdhaXQgYnkgZGVzY2VuZGluZyBmcm9tKD89XFxzKig/Olxcd3wkKSkgZ2V0IGdsb2JhbCBncm91cCBpbnRvIGluaXQoPz1cXHMqOykgam9pbiBsZXQgbmFtZW9mIG5vdCBub3RudWxsIG9uIG9yIG9yZGVyYnkgcGFydGlhbCByZW1vdmUgc2VsZWN0IHNldCB1bm1hbmFnZWQgdmFsdWUgd2hlbiB3aGVyZSB3aXRoKD89XFxzKnspIixvPSJhYnN0cmFjdCBhcyBiYXNlIGJyZWFrIGNhc2UgY2F0Y2ggY2hlY2tlZCBjb25zdCBjb250aW51ZSBkZWZhdWx0IGRlbGVnYXRlIGRvIGVsc2UgZXZlbnQgZXhwbGljaXQgZXh0ZXJuIGZpbmFsbHkgZml4ZWQgZm9yIGZvcmVhY2ggZ290byBpZiBpbXBsaWNpdCBpbiBpbnRlcm5hbCBpcyBsb2NrIG5hbWVzcGFjZSBuZXcgbnVsbCBvcGVyYXRvciBvdXQgb3ZlcnJpZGUgcGFyYW1zIHByaXZhdGUgcHJvdGVjdGVkIHB1YmxpYyByZWFkb25seSByZWYgcmV0dXJuIHNlYWxlZCBzaXplb2Ygc3RhY2thbGxvYyBzdGF0aWMgc3dpdGNoIHRoaXMgdGhyb3cgdHJ5IHR5cGVvZiB1bmNoZWNrZWQgdW5zYWZlIHVzaW5nIHZpcnR1YWwgdm9sYXRpbGUgd2hpbGUgeWllbGQiO2Z1bmN0aW9uIGwoZSl7cmV0dXJuICJcXGIoPzoiK2UudHJpbSgpLnJlcGxhY2UoLyAvZywifCIpKyIpXFxiIn12YXIgdT1sKGkpLGM9UmVnRXhwKGwocisiICIraSsiICIrcysiICIrbykpLGQ9bChpKyIgIitzKyIgIitvKSxwPWwocisiICIraSsiICIrbyksZz1hKC88KD86W148Pjs9K1wtKi8lJnxeXXw8PHNlbGY+PikqPi8uc291cmNlLDIpLGY9YSgvXCgoPzpbXigpXXw8PHNlbGY+PikqXCkvLnNvdXJjZSwyKSxiPS9AP1xiW0EtWmEtel9dXHcqXGIvLnNvdXJjZSxoPXQoLzw8MD4+KD86XHMqPDwxPj4pPy8uc291cmNlLFtiLGddKSxtPXQoLyg/ITw8MD4+KTw8MT4+KD86XHMqXC5ccyo8PDE+PikqLy5zb3VyY2UsW2QsaF0pLHk9L1xbXHMqKD86LFxzKikqXF0vLnNvdXJjZSxFPXQoLzw8MD4+KD86XHMqKD86XD9ccyopPzw8MT4+KSooPzpccypcPyk/Ly5zb3VyY2UsW20seV0pLHY9dCgvW14sKCk8PltcXTs9K1wtKi8lJnxeXXw8PDA+Pnw8PDE+Pnw8PDI+Pi8uc291cmNlLFtnLGYseV0pLFM9dCgvXCg8PDA+PisoPzosPDwwPj4rKStcKS8uc291cmNlLFt2XSksdz10KC8oPzo8PDA+Pnw8PDE+PikoPzpccyooPzpcP1xzKik/PDwyPj4pKig/OlxzKlw/KT8vLnNvdXJjZSxbUyxtLHldKSxrPXtrZXl3b3JkOmMscHVuY3R1YXRpb246L1s8PigpPywuOltcXV0vfSxBPS8nKD86W15cclxuJ1xcXXxcXC58XFxbVXV4XVtcZGEtZkEtRl17MSw4fSknLy5zb3VyY2UseD0vIig/OlxcLnxbXlxcIlxyXG5dKSoiLy5zb3VyY2UsVD0vQCIoPzoiInxcXFtcc1xTXXxbXlxcIl0pKiIoPyEiKS8uc291cmNlO2UubGFuZ3VhZ2VzLmNzaGFycD1lLmxhbmd1YWdlcy5leHRlbmQoImNsaWtlIix7c3RyaW5nOlt7cGF0dGVybjpuKC8oXnxbXiRcXF0pPDwwPj4vLnNvdXJjZSxbVF0pLGxvb2tiZWhpbmQ6ITAsZ3JlZWR5OiEwfSx7cGF0dGVybjpuKC8oXnxbXkAkXFxdKTw8MD4+Ly5zb3VyY2UsW3hdKSxsb29rYmVoaW5kOiEwLGdyZWVkeTohMH0se3BhdHRlcm46UmVnRXhwKEEpLGdyZWVkeTohMCxhbGlhczoiY2hhcmFjdGVyIn1dLCJjbGFzcy1uYW1lIjpbe3BhdHRlcm46bigvKFxidXNpbmdccytzdGF0aWNccyspPDwwPj4oPz1ccyo7KS8uc291cmNlLFttXSksbG9va2JlaGluZDohMCxpbnNpZGU6a30se3BhdHRlcm46bigvKFxidXNpbmdccys8PDA+PlxzKj1ccyopPDwxPj4oPz1ccyo7KS8uc291cmNlLFtiLHddKSxsb29rYmVoaW5kOiEwLGluc2lkZTprfSx7cGF0dGVybjpuKC8oXGJ1c2luZ1xzKyk8PDA+Pig/PVxzKj0pLy5zb3VyY2UsW2JdKSxsb29rYmVoaW5kOiEwfSx7cGF0dGVybjpuKC8oXGI8PDA+PlxzKyk8PDE+Pi8uc291cmNlLFt1LGhdKSxsb29rYmVoaW5kOiEwLGluc2lkZTprfSx7cGF0dGVybjpuKC8oXGJjYXRjaFxzKlwoXHMqKTw8MD4+Ly5zb3VyY2UsW21dKSxsb29rYmVoaW5kOiEwLGluc2lkZTprfSx7cGF0dGVybjpuKC8oXGJ3aGVyZVxzKyk8PDA+Pi8uc291cmNlLFtiXSksbG9va2JlaGluZDohMH0se3BhdHRlcm46bigvKFxiKD86aXMoPzpccytub3QpP3xhcylccyspPDwwPj4vLnNvdXJjZSxbRV0pLGxvb2tiZWhpbmQ6ITAsaW5zaWRlOmt9LHtwYXR0ZXJuOm4oL1xiPDwwPj4oPz1ccysoPyE8PDE+Pnx3aXRoXHMqXHspPDwyPj4oPzpccypbPSw7OnspXF1dfFxzKyg/OmlufHdoZW4pXGIpKS8uc291cmNlLFt3LHAsYl0pLGluc2lkZTprfV0sa2V5d29yZDpjLG51bWJlcjovKD86XGIwKD86eFtcZGEtZl9dKltcZGEtZl18YlswMV9dKlswMV0pfCg/OlxCXC5cZCsoPzpfK1xkKykqfFxiXGQrKD86XytcZCspKig/OlwuXGQrKD86XytcZCspKik/KSg/OmVbLStdP1xkKyg/Ol8rXGQrKSopPykoPzp1bHxsdXxbZGZsbXVdKT9cYi9pLG9wZXJhdG9yOi8+Pj0/fDw8PT98Wy09XT58KFstKyZ8XSlcMXx+fFw/XD89P3xbLSsqLyUmfF4hPTw+XT0/LyxwdW5jdHVhdGlvbjovXD9cLj98Ojp8W3t9W1xdOygpLC46XS99KSxlLmxhbmd1YWdlcy5pbnNlcnRCZWZvcmUoImNzaGFycCIsIm51bWJlciIse3JhbmdlOntwYXR0ZXJuOi9cLlwuLyxhbGlhczoib3BlcmF0b3IifX0pLGUubGFuZ3VhZ2VzLmluc2VydEJlZm9yZSgiY3NoYXJwIiwicHVuY3R1YXRpb24iLHsibmFtZWQtcGFyYW1ldGVyIjp7cGF0dGVybjpuKC8oWygsXVxzKik8PDA+Pig/PVxzKjopLy5zb3VyY2UsW2JdKSxsb29rYmVoaW5kOiEwLGFsaWFzOiJwdW5jdHVhdGlvbiJ9fSksZS5sYW5ndWFnZXMuaW5zZXJ0QmVmb3JlKCJjc2hhcnAiLCJjbGFzcy1uYW1lIix7bmFtZXNwYWNlOntwYXR0ZXJuOm4oLyhcYig/Om5hbWVzcGFjZXx1c2luZylccyspPDwwPj4oPzpccypcLlxzKjw8MD4+KSooPz1ccypbO3tdKS8uc291cmNlLFtiXSksbG9va2JlaGluZDohMCxpbnNpZGU6e3B1bmN0dWF0aW9uOi9cLi99fSwidHlwZS1leHByZXNzaW9uIjp7cGF0dGVybjpuKC8oXGIoPzpkZWZhdWx0fHR5cGVvZnxzaXplb2YpXHMqXChccyooPyFccykpKD86W14oKVxzXXxccyg/IVxzKXw8PDA+PikqKD89XHMqXCkpLy5zb3VyY2UsW2ZdKSxsb29rYmVoaW5kOiEwLGFsaWFzOiJjbGFzcy1uYW1lIixpbnNpZGU6a30sInJldHVybi10eXBlIjp7cGF0dGVybjpuKC88PDA+Pig/PVxzKyg/Ojw8MT4+XHMqKD86PT58Wyh7XXxcLlxzKnRoaXNccypcWyl8dGhpc1xzKlxbKSkvLnNvdXJjZSxbdyxtXSksaW5zaWRlOmssYWxpYXM6ImNsYXNzLW5hbWUifSwiY29uc3RydWN0b3ItaW52b2NhdGlvbiI6e3BhdHRlcm46bigvKFxibmV3XHMrKTw8MD4+KD89XHMqW1soe10pLy5zb3VyY2UsW3ddKSxsb29rYmVoaW5kOiEwLGluc2lkZTprLGFsaWFzOiJjbGFzcy1uYW1lIn0sImdlbmVyaWMtbWV0aG9kIjp7cGF0dGVybjpuKC88PDA+PlxzKjw8MT4+KD89XHMqXCgpLy5zb3VyY2UsW2IsZ10pLGluc2lkZTp7ZnVuY3Rpb246bigvXjw8MD4+Ly5zb3VyY2UsW2JdKSxnZW5lcmljOntwYXR0ZXJuOlJlZ0V4cChnKSxhbGlhczoiY2xhc3MtbmFtZSIsaW5zaWRlOmt9fX0sInR5cGUtbGlzdCI6e3BhdHRlcm46bigvXGIoKD86PDwwPj5ccys8PDE+PnxyZWNvcmRccys8PDE+PlxzKjw8NT4+fHdoZXJlXHMrPDwyPj4pXHMqOlxzKikoPzo8PDM+Pnw8PDQ+Pnw8PDE+PlxzKjw8NT4+fDw8Nj4+KSg/OlxzKixccyooPzo8PDM+Pnw8PDQ+Pnw8PDY+PikpKig/PVxzKig/OndoZXJlfFt7O118PT58JCkpLy5zb3VyY2UsW3UsaCxiLHcsYy5zb3VyY2UsZiwvXGJuZXdccypcKFxzKlwpLy5zb3VyY2VdKSxsb29rYmVoaW5kOiEwLGluc2lkZTp7InJlY29yZC1hcmd1bWVudHMiOntwYXR0ZXJuOm4oLyheKD8hbmV3XHMqXCgpPDwwPj5ccyopPDwxPj4vLnNvdXJjZSxbaCxmXSksbG9va2JlaGluZDohMCxncmVlZHk6ITAsaW5zaWRlOmUubGFuZ3VhZ2VzLmNzaGFycH0sa2V5d29yZDpjLCJjbGFzcy1uYW1lIjp7cGF0dGVybjpSZWdFeHAodyksZ3JlZWR5OiEwLGluc2lkZTprfSxwdW5jdHVhdGlvbjovWywoKV0vfX0scHJlcHJvY2Vzc29yOntwYXR0ZXJuOi8oXltcdCBdKikjLiovbSxsb29rYmVoaW5kOiEwLGFsaWFzOiJwcm9wZXJ0eSIsaW5zaWRlOntkaXJlY3RpdmU6e3BhdHRlcm46LygjKVxiKD86ZGVmaW5lfGVsaWZ8ZWxzZXxlbmRpZnxlbmRyZWdpb258ZXJyb3J8aWZ8bGluZXxudWxsYWJsZXxwcmFnbWF8cmVnaW9ufHVuZGVmfHdhcm5pbmcpXGIvLGxvb2tiZWhpbmQ6ITAsYWxpYXM6ImtleXdvcmQifX19fSk7dmFyIF89eCsifCIrQSxPPXQoL1wvKD8hWyovXSl8XC9cL1teXHJcbl0qW1xyXG5dfFwvXCooPzpbXipdfFwqKD8hXC8pKSpcKlwvfDw8MD4+Ly5zb3VyY2UsW19dKSxJPWEodCgvW14iJy8oKV18PDwwPj58XCg8PHNlbGY+PipcKS8uc291cmNlLFtPXSksMiksUj0vXGIoPzphc3NlbWJseXxldmVudHxmaWVsZHxtZXRob2R8bW9kdWxlfHBhcmFtfHByb3BlcnR5fHJldHVybnx0eXBlKVxiLy5zb3VyY2UsTj10KC88PDA+Pig/OlxzKlwoPDwxPj4qXCkpPy8uc291cmNlLFttLEldKTtlLmxhbmd1YWdlcy5pbnNlcnRCZWZvcmUoImNzaGFycCIsImNsYXNzLW5hbWUiLHthdHRyaWJ1dGU6e3BhdHRlcm46bigvKCg/Ol58W15cc1x3Pik/XSlccypcW1xzKikoPzo8PDA+PlxzKjpccyopPzw8MT4+KD86XHMqLFxzKjw8MT4+KSooPz1ccypcXSkvLnNvdXJjZSxbUixOXSksbG9va2JlaGluZDohMCxncmVlZHk6ITAsaW5zaWRlOnt0YXJnZXQ6e3BhdHRlcm46bigvXjw8MD4+KD89XHMqOikvLnNvdXJjZSxbUl0pLGFsaWFzOiJrZXl3b3JkIn0sImF0dHJpYnV0ZS1hcmd1bWVudHMiOntwYXR0ZXJuOm4oL1woPDwwPj4qXCkvLnNvdXJjZSxbSV0pLGluc2lkZTplLmxhbmd1YWdlcy5jc2hhcnB9LCJjbGFzcy1uYW1lIjp7cGF0dGVybjpSZWdFeHAobSksaW5zaWRlOntwdW5jdHVhdGlvbjovXC4vfX0scHVuY3R1YXRpb246L1s6LF0vfX19KTt2YXIgTD0vOltefVxyXG5dKy8uc291cmNlLFA9YSh0KC9bXiInLygpXXw8PDA+PnxcKDw8c2VsZj4+KlwpLy5zb3VyY2UsW09dKSwyKSxDPXQoL1x7KD8hXHspKD86KD8hW306XSk8PDA+PikqPDwxPj4/XH0vLnNvdXJjZSxbUCxMXSksRj1hKHQoL1teIicvKCldfFwvKD8hXCopfFwvXCooPzpbXipdfFwqKD8hXC8pKSpcKlwvfDw8MD4+fFwoPDxzZWxmPj4qXCkvLnNvdXJjZSxbX10pLDIpLEQ9dCgvXHsoPyFceykoPzooPyFbfTpdKTw8MD4+KSo8PDE+Pj9cfS8uc291cmNlLFtGLExdKTtmdW5jdGlvbiAkKHQsYSl7cmV0dXJuIHtpbnRlcnBvbGF0aW9uOntwYXR0ZXJuOm4oLygoPzpefFtee10pKD86XHtceykqKTw8MD4+Ly5zb3VyY2UsW3RdKSxsb29rYmVoaW5kOiEwLGluc2lkZTp7ImZvcm1hdC1zdHJpbmciOntwYXR0ZXJuOm4oLyheXHsoPzooPyFbfTpdKTw8MD4+KSopPDwxPj4oPz1cfSQpLy5zb3VyY2UsW2EsTF0pLGxvb2tiZWhpbmQ6ITAsaW5zaWRlOntwdW5jdHVhdGlvbjovXjovfX0scHVuY3R1YXRpb246L15ce3xcfSQvLGV4cHJlc3Npb246e3BhdHRlcm46L1tcc1xTXSsvLGFsaWFzOiJsYW5ndWFnZS1jc2hhcnAiLGluc2lkZTplLmxhbmd1YWdlcy5jc2hhcnB9fX0sc3RyaW5nOi9bXHNcU10rL319ZS5sYW5ndWFnZXMuaW5zZXJ0QmVmb3JlKCJjc2hhcnAiLCJzdHJpbmciLHsiaW50ZXJwb2xhdGlvbi1zdHJpbmciOlt7cGF0dGVybjpuKC8oXnxbXlxcXSkoPzpcJEB8QFwkKSIoPzoiInxcXFtcc1xTXXxce1x7fDw8MD4+fFteXFx7Il0pKiIvLnNvdXJjZSxbQ10pLGxvb2tiZWhpbmQ6ITAsZ3JlZWR5OiEwLGluc2lkZTokKEMsUCl9LHtwYXR0ZXJuOm4oLyhefFteQFxcXSlcJCIoPzpcXC58XHtce3w8PDA+PnxbXlxcIntdKSoiLy5zb3VyY2UsW0RdKSxsb29rYmVoaW5kOiEwLGdyZWVkeTohMCxpbnNpZGU6JChELEYpfV19KTt9KFByaXNtKSxQcmlzbS5sYW5ndWFnZXMuZG90bmV0PVByaXNtLmxhbmd1YWdlcy5jcz1QcmlzbS5sYW5ndWFnZXMuY3NoYXJwLFByaXNtLmxhbmd1YWdlc1sidmlzdWFsLWJhc2ljIl09e2NvbW1lbnQ6e3BhdHRlcm46Lyg/Olsn4oCY4oCZXXxSRU1cYikoPzpbXlxyXG5fXXxfKD86XHJcbj98XG4pPykqL2ksaW5zaWRlOntrZXl3b3JkOi9eUkVNL2l9fSxkaXJlY3RpdmU6e3BhdHRlcm46LyMoPzpDb25zdHxFbHNlfEVsc2VJZnxFbmR8RXh0ZXJuYWxDaGVja3N1bXxFeHRlcm5hbFNvdXJjZXxJZnxSZWdpb24pKD86W15cU1xyXG5dX1teXFNcclxuXSooPzpcclxuP3xcbil8LikrL2ksYWxpYXM6ImNvbW1lbnQiLGdyZWVkeTohMH0sc3RyaW5nOntwYXR0ZXJuOi9cJD9bIuKAnOKAnV0oPzpbIuKAnOKAnV17Mn18W14i4oCc4oCdXSkqWyLigJzigJ1dQz8vaSxncmVlZHk6ITB9LGRhdGU6e3BhdHRlcm46LyNbXlxTXHJcbl0qKD86XGQrKFsvLV0pXGQrXDFcZCsoPzpbXlxTXHJcbl0rKD86XGQrW15cU1xyXG5dKig/OkFNfFBNKXxcZCs6XGQrKD86OlxkKyk/KD86W15cU1xyXG5dKig/OkFNfFBNKSk/KSk/fFxkK1teXFNcclxuXSooPzpBTXxQTSl8XGQrOlxkKyg/OjpcZCspPyg/OlteXFNcclxuXSooPzpBTXxQTSkpPylbXlxTXHJcbl0qIy9pLGFsaWFzOiJidWlsdGluIn0sbnVtYmVyOi8oPzooPzpcYlxkKyg/OlwuXGQrKT98XC5cZCspKD86RVsrLV0/XGQrKT98JltIT11bXGRBLUZdKykoPzpVP1tJTFNdfFtGUkRdKT8vaSxib29sZWFuOi9cYig/OlRydWV8RmFsc2V8Tm90aGluZylcYi9pLGtleXdvcmQ6L1xiKD86QWRkSGFuZGxlcnxBZGRyZXNzT2Z8QWxpYXN8QW5kKD86QWxzbyk/fEFzfEJvb2xlYW58QnlSZWZ8Qnl0ZXxCeVZhbHxDYWxsfENhc2V8Q2F0Y2h8Qyg/OkJvb2x8Qnl0ZXxDaGFyfERhdGV8RGJsfERlY3xJbnR8TG5nfE9ianxTQnl0ZXxTaG9ydHxTbmd8U3RyfFR5cGV8VUludHxVTG5nfFVTaG9ydCl8Q2hhcnxDbGFzc3xDb25zdHxDb250aW51ZXxDdXJyZW5jeXxEYXRlfERlY2ltYWx8RGVjbGFyZXxEZWZhdWx0fERlbGVnYXRlfERpbXxEaXJlY3RDYXN0fERvfERvdWJsZXxFYWNofEVsc2UoPzpJZik/fEVuZCg/OklmKT98RW51bXxFcmFzZXxFcnJvcnxFdmVudHxFeGl0fEZpbmFsbHl8Rm9yfEZyaWVuZHxGdW5jdGlvbnxHZXQoPzpUeXBlfFhNTE5hbWVzcGFjZSk/fEdsb2JhbHxHb1N1YnxHb1RvfEhhbmRsZXN8SWZ8SW1wbGVtZW50c3xJbXBvcnRzfElufEluaGVyaXRzfEludGVnZXJ8SW50ZXJmYWNlfElzfElzTm90fExldHxMaWJ8TGlrZXxMb25nfExvb3B8TWV8TW9kfE1vZHVsZXxNdXN0KD86SW5oZXJpdHxPdmVycmlkZSl8TXkoPzpCYXNlfENsYXNzKXxOYW1lc3BhY2V8TmFycm93aW5nfE5ld3xOZXh0fE5vdCg/OkluaGVyaXRhYmxlfE92ZXJyaWRhYmxlKT98T2JqZWN0fE9mfE9ufE9wZXJhdG9yfE9wdGlvbig/OmFsKT98T3IoPzpFbHNlKT98T3V0fE92ZXJsb2Fkc3xPdmVycmlkYWJsZXxPdmVycmlkZXN8UGFyYW1BcnJheXxQYXJ0aWFsfFByaXZhdGV8UHJvcGVydHl8UHJvdGVjdGVkfFB1YmxpY3xSYWlzZUV2ZW50fFJlYWRPbmx5fFJlRGltfFJlbW92ZUhhbmRsZXJ8UmVzdW1lfFJldHVybnxTQnl0ZXxTZWxlY3R8U2V0fFNoYWRvd3N8U2hhcmVkfHNob3J0fFNpbmdsZXxTdGF0aWN8U3RlcHxTdG9wfFN0cmluZ3xTdHJ1Y3R1cmV8U3VifFN5bmNMb2NrfFRoZW58VGhyb3d8VG98VHJ5fFRyeUNhc3R8VHlwZXxUeXBlT2Z8VSg/OkludGVnZXJ8TG9uZ3xTaG9ydCl8VXNpbmd8VmFyaWFudHxXZW5kfFdoZW58V2hpbGV8V2lkZW5pbmd8V2l0aCg/OkV2ZW50cyk/fFdyaXRlT25seXxVbnRpbHxYb3IpXGIvaSxvcGVyYXRvcjpbL1srXC0qL1xcXjw9PiYjQCQlIV0vLHtwYXR0ZXJuOi8oW15cU1xyXG5dKV8oPz1bXlxTXHJcbl0qW1xyXG5dKS8sbG9va2JlaGluZDohMH1dLHB1bmN0dWF0aW9uOi9be30oKS4sOj9dL30sUHJpc20ubGFuZ3VhZ2VzLnZiPVByaXNtLmxhbmd1YWdlc1sidmlzdWFsLWJhc2ljIl0sUHJpc20ubGFuZ3VhZ2VzLnZiYT1QcmlzbS5sYW5ndWFnZXNbInZpc3VhbC1iYXNpYyJdLFByaXNtLmxhbmd1YWdlcy5zcWw9e2NvbW1lbnQ6e3BhdHRlcm46LyhefFteXFxdKSg/OlwvXCpbXHNcU10qP1wqXC98KD86LS18XC9cL3wjKS4qKS8sbG9va2JlaGluZDohMH0sdmFyaWFibGU6W3twYXR0ZXJuOi9AKFsiJ2BdKSg/OlxcW1xzXFNdfCg/IVwxKVteXFxdKStcMS8sZ3JlZWR5OiEwfSwvQFtcdy4kXSsvXSxzdHJpbmc6e3BhdHRlcm46LyhefFteQFxcXSkoInwnKSg/OlxcW1xzXFNdfCg/IVwyKVteXFxdfFwyXDIpKlwyLyxncmVlZHk6ITAsbG9va2JlaGluZDohMH0sZnVuY3Rpb246L1xiKD86QVZHfENPVU5UfEZJUlNUfEZPUk1BVHxMQVNUfExDQVNFfExFTnxNQVh8TUlEfE1JTnxNT0R8Tk9XfFJPVU5EfFNVTXxVQ0FTRSkoPz1ccypcKCkvaSxrZXl3b3JkOi9cYig/OkFDVElPTnxBRER8QUZURVJ8QUxHT1JJVEhNfEFMTHxBTFRFUnxBTkFMWVpFfEFOWXxBUFBMWXxBU3xBU0N8QVVUSE9SSVpBVElPTnxBVVRPX0lOQ1JFTUVOVHxCQUNLVVB8QkRCfEJFR0lOfEJFUktFTEVZREJ8QklHSU5UfEJJTkFSWXxCSVR8QkxPQnxCT09MfEJPT0xFQU58QlJFQUt8QlJPV1NFfEJUUkVFfEJVTEt8Qll8Q0FMTHxDQVNDQURFRD98Q0FTRXxDSEFJTnxDSEFSKD86QUNURVJ8U0VUKT98Q0hFQ0soPzpQT0lOVCk/fENMT1NFfENMVVNURVJFRHxDT0FMRVNDRXxDT0xMQVRFfENPTFVNTlM/fENPTU1FTlR8Q09NTUlUKD86VEVEKT98Q09NUFVURXxDT05ORUNUfENPTlNJU1RFTlR8Q09OU1RSQUlOVHxDT05UQUlOUyg/OlRBQkxFKT98Q09OVElOVUV8Q09OVkVSVHxDUkVBVEV8Q1JPU1N8Q1VSUkVOVCg/Ol9EQVRFfF9USU1FfF9USU1FU1RBTVB8X1VTRVIpP3xDVVJTT1J8Q1lDTEV8REFUQSg/OkJBU0VTPyk/fERBVEUoPzpUSU1FKT98REFZfERCQ0N8REVBTExPQ0FURXxERUN8REVDSU1BTHxERUNMQVJFfERFRkFVTFR8REVGSU5FUnxERUxBWUVEfERFTEVURXxERUxJTUlURVJTP3xERU5ZfERFU0N8REVTQ1JJQkV8REVURVJNSU5JU1RJQ3xESVNBQkxFfERJU0NBUkR8RElTS3xESVNUSU5DVHxESVNUSU5DVFJPV3xESVNUUklCVVRFRHxET3xET1VCTEV8RFJPUHxEVU1NWXxEVU1QKD86RklMRSk/fERVUExJQ0FURXxFTFNFKD86SUYpP3xFTkFCTEV8RU5DTE9TRUR8RU5EfEVOR0lORXxFTlVNfEVSUkxWTHxFUlJPUlN8RVNDQVBFRD98RVhDRVBUfEVYRUMoPzpVVEUpP3xFWElTVFN8RVhJVHxFWFBMQUlOfEVYVEVOREVEfEZFVENIfEZJRUxEU3xGSUxFfEZJTExGQUNUT1J8RklSU1R8RklYRUR8RkxPQVR8Rk9MTE9XSU5HfEZPUig/OiBFQUNIIFJPVyk/fEZPUkNFfEZPUkVJR058RlJFRVRFWFQoPzpUQUJMRSk/fEZST018RlVMTHxGVU5DVElPTnxHRU9NRVRSWSg/OkNPTExFQ1RJT04pP3xHTE9CQUx8R09UT3xHUkFOVHxHUk9VUHxIQU5ETEVSfEhBU0h8SEFWSU5HfEhPTERMT0NLfEhPVVJ8SURFTlRJVFkoPzpfSU5TRVJUfENPTCk/fElGfElHTk9SRXxJTVBPUlR8SU5ERVh8SU5GSUxFfElOTkVSfElOTk9EQnxJTk9VVHxJTlNFUlR8SU5UfElOVEVHRVJ8SU5URVJTRUNUfElOVEVSVkFMfElOVE98SU5WT0tFUnxJU09MQVRJT058SVRFUkFURXxKT0lOfEtFWVM/fEtJTEx8TEFOR1VBR0V8TEFTVHxMRUFWRXxMRUZUfExFVkVMfExJTUlUfExJTkVOT3xMSU5FU3xMSU5FU1RSSU5HfExPQUR8TE9DQUx8TE9DS3xMT05HKD86QkxPQnxURVhUKXxMT09QfE1BVENIKD86RUQpP3xNRURJVU0oPzpCTE9CfElOVHxURVhUKXxNRVJHRXxNSURETEVJTlR8TUlOVVRFfE1PREV8TU9ESUZJRVN8TU9ESUZZfE1PTlRIfE1VTFRJKD86TElORVNUUklOR3xQT0lOVHxQT0xZR09OKXxOQVRJT05BTHxOQVRVUkFMfE5DSEFSfE5FWFR8Tk98Tk9OQ0xVU1RFUkVEfE5VTExJRnxOVU1FUklDfE9GRj98T0ZGU0VUUz98T058T1BFTig/OkRBVEFTT1VSQ0V8UVVFUll8Uk9XU0VUKT98T1BUSU1JWkV8T1BUSU9OKD86QUxMWSk/fE9SREVSfE9VVCg/OkVSfEZJTEUpP3xPVkVSfFBBUlRJQUx8UEFSVElUSU9OfFBFUkNFTlR8UElWT1R8UExBTnxQT0lOVHxQT0xZR09OfFBSRUNFRElOR3xQUkVDSVNJT058UFJFUEFSRXxQUkVWfFBSSU1BUll8UFJJTlR8UFJJVklMRUdFU3xQUk9DKD86RURVUkUpP3xQVUJMSUN8UFVSR0V8UVVJQ0t8UkFJU0VSUk9SfFJFQURTP3xSRUFMfFJFQ09ORklHVVJFfFJFRkVSRU5DRVN8UkVMRUFTRXxSRU5BTUV8UkVQRUFUKD86QUJMRSk/fFJFUExBQ0V8UkVQTElDQVRJT058UkVRVUlSRXxSRVNJR05BTHxSRVNUT1JFfFJFU1RSSUNUfFJFVFVSTig/OlN8SU5HKT98UkVWT0tFfFJJR0hUfFJPTExCQUNLfFJPVVRJTkV8Uk9XKD86Q09VTlR8R1VJRENPTHxTKT98UlRSRUV8UlVMRXxTQVZFKD86UE9JTlQpP3xTQ0hFTUF8U0VDT05EfFNFTEVDVHxTRVJJQUwoPzpJWkFCTEUpP3xTRVNTSU9OKD86X1VTRVIpP3xTRVQoPzpVU0VSKT98U0hBUkV8U0hPV3xTSFVURE9XTnxTSU1QTEV8U01BTExJTlR8U05BUFNIT1R8U09NRXxTT05BTUV8U1FMfFNUQVJUKD86SU5HKT98U1RBVElTVElDU3xTVEFUVVN8U1RSSVBFRHxTWVNURU1fVVNFUnxUQUJMRVM/fFRBQkxFU1BBQ0V8VEVNUCg/Ok9SQVJZfFRBQkxFKT98VEVSTUlOQVRFRHxURVhUKD86U0laRSk/fFRIRU58VElNRSg/OlNUQU1QKT98VElOWSg/OkJMT0J8SU5UfFRFWFQpfFRPUD98VFJBTig/OlNBQ1RJT05TPyk/fFRSSUdHRVJ8VFJVTkNBVEV8VFNFUVVBTHxUWVBFUz98VU5CT1VOREVEfFVOQ09NTUlUVEVEfFVOREVGSU5FRHxVTklPTnxVTklRVUV8VU5MT0NLfFVOUElWT1R8VU5TSUdORUR8VVBEQVRFKD86VEVYVCk/fFVTQUdFfFVTRXxVU0VSfFVTSU5HfFZBTFVFUz98VkFSKD86QklOQVJZfENIQVJ8Q0hBUkFDVEVSfFlJTkcpfFZJRVd8V0FJVEZPUnxXQVJOSU5HU3xXSEVOfFdIRVJFfFdISUxFfFdJVEgoPzogUk9MTFVQfElOKT98V09SS3xXUklURSg/OlRFWFQpP3xZRUFSKVxiL2ksYm9vbGVhbjovXGIoPzpUUlVFfEZBTFNFfE5VTEwpXGIvaSxudW1iZXI6L1xiMHhbXGRhLWZdK1xifFxiXGQrKD86XC5cZCopP3xcQlwuXGQrXGIvaSxvcGVyYXRvcjovWy0rKlwvPSVefl18JiY/fFx8XHw/fCE9P3w8KD86PT4/fDx8Pik/fD5bPj1dP3xcYig/OkFORHxCRVRXRUVOfERJVnxJTnxJTElLRXxJU3xMSUtFfE5PVHxPUnxSRUdFWFB8UkxJS0V8U09VTkRTIExJS0V8WE9SKVxiL2kscHVuY3R1YXRpb246L1s7W1xdKClgLC5dL30sZnVuY3Rpb24oZSl7ZS5sYW5ndWFnZXMucnVieT1lLmxhbmd1YWdlcy5leHRlbmQoImNsaWtlIix7Y29tbWVudDpbLyMuKi8se3BhdHRlcm46L149YmVnaW5cc1tcc1xTXSo/Xj1lbmQvbSxncmVlZHk6ITB9XSwiY2xhc3MtbmFtZSI6e3BhdHRlcm46LyhcYig/OmNsYXNzKVxzK3xcYmNhdGNoXHMrXCgpW1x3LlxcXSsvaSxsb29rYmVoaW5kOiEwLGluc2lkZTp7cHVuY3R1YXRpb246L1suXFxdL319LGtleXdvcmQ6L1xiKD86YWxpYXN8YW5kfEJFR0lOfGJlZ2lufGJyZWFrfGNhc2V8Y2xhc3N8ZGVmfGRlZmluZV9tZXRob2R8ZGVmaW5lZHxkb3xlYWNofGVsc2V8ZWxzaWZ8RU5EfGVuZHxlbnN1cmV8ZXh0ZW5kfGZvcnxpZnxpbnxpbmNsdWRlfG1vZHVsZXxuZXd8bmV4dHxuaWx8bm90fG9yfHByZXBlbmR8cHJvdGVjdGVkfHByaXZhdGV8cHVibGljfHJhaXNlfHJlZG98cmVxdWlyZXxyZXNjdWV8cmV0cnl8cmV0dXJufHNlbGZ8c3VwZXJ8dGhlbnx0aHJvd3x1bmRlZnx1bmxlc3N8dW50aWx8d2hlbnx3aGlsZXx5aWVsZClcYi99KTt2YXIgdD17cGF0dGVybjovI1x7W159XStcfS8saW5zaWRlOntkZWxpbWl0ZXI6e3BhdHRlcm46L14jXHt8XH0kLyxhbGlhczoidGFnIn0scmVzdDplLmxhbmd1YWdlcy5ydWJ5fX07ZGVsZXRlIGUubGFuZ3VhZ2VzLnJ1YnkuZnVuY3Rpb24sZS5sYW5ndWFnZXMuaW5zZXJ0QmVmb3JlKCJydWJ5Iiwia2V5d29yZCIse3JlZ2V4Olt7cGF0dGVybjpSZWdFeHAoLyVyLy5zb3VyY2UrIig/OiIrWy8oW15hLXpBLVowLTlcc3soXFs8XSkoPzooPyFcMSlbXlxcXXxcXFtcc1xTXSkqXDEvLnNvdXJjZSwvXCgoPzpbXigpXFxdfFxcW1xzXFNdKSpcKS8uc291cmNlLC9ceyg/OlteI3t9XFxdfCMoPzpce1tefV0rXH0pP3xcXFtcc1xTXSkqXH0vLnNvdXJjZSwvXFsoPzpbXlxbXF1cXF18XFxbXHNcU10pKlxdLy5zb3VyY2UsLzwoPzpbXjw+XFxdfFxcW1xzXFNdKSo+Ly5zb3VyY2VdLmpvaW4oInwiKSsiKSIrL1tlZ2ltbm9zdXhdezAsNn0vLnNvdXJjZSksZ3JlZWR5OiEwLGluc2lkZTp7aW50ZXJwb2xhdGlvbjp0fX0se3BhdHRlcm46LyhefFteL10pXC8oPyFcLykoPzpcW1teXHJcblxdXStcXXxcXC58W15bL1xcXHJcbl0pK1wvW2VnaW1ub3N1eF17MCw2fSg/PVxzKig/OiR8W1xyXG4sLjt9KSNdKSkvLGxvb2tiZWhpbmQ6ITAsZ3JlZWR5OiEwLGluc2lkZTp7aW50ZXJwb2xhdGlvbjp0fX1dLHZhcmlhYmxlOi9bQCRdK1thLXpBLVpfXVx3Kig/Ols/IV18XGIpLyxzeW1ib2w6e3BhdHRlcm46LyhefFteOl0pOlthLXpBLVpfXVx3Kig/Ols/IV18XGIpLyxsb29rYmVoaW5kOiEwfSwibWV0aG9kLWRlZmluaXRpb24iOntwYXR0ZXJuOi8oXGJkZWZccyspW1x3Ll0rLyxsb29rYmVoaW5kOiEwLGluc2lkZTp7ZnVuY3Rpb246L1x3KyQvLHJlc3Q6ZS5sYW5ndWFnZXMucnVieX19fSksZS5sYW5ndWFnZXMuaW5zZXJ0QmVmb3JlKCJydWJ5IiwibnVtYmVyIix7YnVpbHRpbjovXGIoPzpBcnJheXxCaWdudW18QmluZGluZ3xDbGFzc3xDb250aW51YXRpb258RGlyfEV4Y2VwdGlvbnxGYWxzZUNsYXNzfEZpbGV8U3RhdHxGaXhudW18RmxvYXR8SGFzaHxJbnRlZ2VyfElPfE1hdGNoRGF0YXxNZXRob2R8TW9kdWxlfE5pbENsYXNzfE51bWVyaWN8T2JqZWN0fFByb2N8UmFuZ2V8UmVnZXhwfFN0cmluZ3xTdHJ1Y3R8VE1TfFN5bWJvbHxUaHJlYWRHcm91cHxUaHJlYWR8VGltZXxUcnVlQ2xhc3MpXGIvLGNvbnN0YW50Oi9cYltBLVpdXHcqKD86Wz8hXXxcYikvfSksZS5sYW5ndWFnZXMucnVieS5zdHJpbmc9W3twYXR0ZXJuOlJlZ0V4cCgvJVtxUWlJd1d4c10/Ly5zb3VyY2UrIig/OiIrWy8oW15hLXpBLVowLTlcc3soXFs8XSkoPzooPyFcMSlbXlxcXXxcXFtcc1xTXSkqXDEvLnNvdXJjZSwvXCgoPzpbXigpXFxdfFxcW1xzXFNdKSpcKS8uc291cmNlLC9ceyg/OlteI3t9XFxdfCMoPzpce1tefV0rXH0pP3xcXFtcc1xTXSkqXH0vLnNvdXJjZSwvXFsoPzpbXlxbXF1cXF18XFxbXHNcU10pKlxdLy5zb3VyY2UsLzwoPzpbXjw+XFxdfFxcW1xzXFNdKSo+Ly5zb3VyY2VdLmpvaW4oInwiKSsiKSIpLGdyZWVkeTohMCxpbnNpZGU6e2ludGVycG9sYXRpb246dH19LHtwYXR0ZXJuOi8oInwnKSg/OiNce1tefV0rXH18Iyg/IVx7KXxcXCg/OlxyXG58W1xzXFNdKXwoPyFcMSlbXlxcI1xyXG5dKSpcMS8sZ3JlZWR5OiEwLGluc2lkZTp7aW50ZXJwb2xhdGlvbjp0fX0se3BhdHRlcm46Lzw8Wy1+XT8oW2Etel9dXHcqKVtcclxuXSg/Oi4qW1xyXG5dKSo/W1x0IF0qXDEvaSxhbGlhczoiaGVyZWRvYy1zdHJpbmciLGdyZWVkeTohMCxpbnNpZGU6e2RlbGltaXRlcjp7cGF0dGVybjovXjw8Wy1+XT9bYS16X11cdyp8W2Etel9dXHcqJC9pLGFsaWFzOiJzeW1ib2wiLGluc2lkZTp7cHVuY3R1YXRpb246L148PFstfl0/L319LGludGVycG9sYXRpb246dH19LHtwYXR0ZXJuOi88PFstfl0/JyhbYS16X11cdyopJ1tcclxuXSg/Oi4qW1xyXG5dKSo/W1x0IF0qXDEvaSxhbGlhczoiaGVyZWRvYy1zdHJpbmciLGdyZWVkeTohMCxpbnNpZGU6e2RlbGltaXRlcjp7cGF0dGVybjovXjw8Wy1+XT8nW2Etel9dXHcqJ3xbYS16X11cdyokL2ksYWxpYXM6InN5bWJvbCIsaW5zaWRlOntwdW5jdHVhdGlvbjovXjw8Wy1+XT8nfCckL319fX1dLGUubGFuZ3VhZ2VzLnJiPWUubGFuZ3VhZ2VzLnJ1Ynk7fShQcmlzbSksUHJpc20ubGFuZ3VhZ2VzLnN3aWZ0PXtjb21tZW50OntwYXR0ZXJuOi8oXnxbXlxcOl0pKD86XC9cLy4qfFwvXCooPzpbXi8qXXxcLyg/IVwqKXxcKig/IVwvKXxcL1wqKD86W14qXXxcKig/IVwvKSkqXCpcLykqXCpcLykvLGxvb2tiZWhpbmQ6ITAsZ3JlZWR5OiEwfSwic3RyaW5nLWxpdGVyYWwiOlt7cGF0dGVybjpSZWdFeHAoLyhefFteIiNdKS8uc291cmNlKyIoPzoiKy8iKD86XFwoPzpcKCg/OlteKCldfFwoW14oKV0qXCkpKlwpfFxyXG58W14oXSl8W15cXFxyXG4iXSkqIi8uc291cmNlKyJ8IisvIiIiKD86XFwoPzpcKCg/OlteKCldfFwoW14oKV0qXCkpKlwpfFteKF0pfFteXFwiXXwiKD8hIiIpKSoiIiIvLnNvdXJjZSsiKSIrLyg/IVsiI10pLy5zb3VyY2UpLGxvb2tiZWhpbmQ6ITAsZ3JlZWR5OiEwLGluc2lkZTp7aW50ZXJwb2xhdGlvbjp7cGF0dGVybjovKFxcXCgpKD86W14oKV18XChbXigpXSpcKSkqKD89XCkpLyxsb29rYmVoaW5kOiEwLGluc2lkZTpudWxsfSwiaW50ZXJwb2xhdGlvbi1wdW5jdHVhdGlvbiI6e3BhdHRlcm46L15cKXxcXFwoJC8sYWxpYXM6InB1bmN0dWF0aW9uIn0scHVuY3R1YXRpb246L1xcKD89W1xyXG5dKS8sc3RyaW5nOi9bXHNcU10rL319LHtwYXR0ZXJuOlJlZ0V4cCgvKF58W14iI10pKCMrKS8uc291cmNlKyIoPzoiKy8iKD86XFwoPzojK1woKD86W14oKV18XChbXigpXSpcKSkqXCl8XHJcbnxbXiNdKXxbXlxcXHJcbl0pKj8iLy5zb3VyY2UrInwiKy8iIiIoPzpcXCg/OiMrXCgoPzpbXigpXXxcKFteKCldKlwpKSpcKXxbXiNdKXxbXlxcXSkqPyIiIi8uc291cmNlKyIpXFwyIiksbG9va2JlaGluZDohMCxncmVlZHk6ITAsaW5zaWRlOntpbnRlcnBvbGF0aW9uOntwYXR0ZXJuOi8oXFwjK1woKSg/OlteKCldfFwoW14oKV0qXCkpKig/PVwpKS8sbG9va2JlaGluZDohMCxpbnNpZGU6bnVsbH0sImludGVycG9sYXRpb24tcHVuY3R1YXRpb24iOntwYXR0ZXJuOi9eXCl8XFwjK1woJC8sYWxpYXM6InB1bmN0dWF0aW9uIn0sc3RyaW5nOi9bXHNcU10rL319XSxkaXJlY3RpdmU6e3BhdHRlcm46UmVnRXhwKC8jLy5zb3VyY2UrIig/OiIrLyg/OmVsc2VpZnxpZilcYi8uc291cmNlKyIoPzpbIFx0XSoiKy8oPzohWyBcdF0qKT8oPzpcYlx3K1xiKD86WyBcdF0qXCgoPzpbXigpXXxcKFteKCldKlwpKSpcKSk/fFwoKD86W14oKV18XChbXigpXSpcKSkqXCkpKD86WyBcdF0qKD86JiZ8XHxcfCkpPy8uc291cmNlKyIpK3wiKy8oPzplbHNlfGVuZGlmKVxiLy5zb3VyY2UrIikiKSxhbGlhczoicHJvcGVydHkiLGluc2lkZTp7ImRpcmVjdGl2ZS1uYW1lIjovXiNcdysvLGJvb2xlYW46L1xiKD86dHJ1ZXxmYWxzZSlcYi8sbnVtYmVyOi9cYlxkKyg/OlwuXGQrKSpcYi8sb3BlcmF0b3I6LyF8JiZ8XHxcfHxbPD5dPT8vLHB1bmN0dWF0aW9uOi9bKCksXS99fSxsaXRlcmFsOntwYXR0ZXJuOi8jKD86Y29sb3JMaXRlcmFsfGNvbHVtbnxkc29oYW5kbGV8ZmlsZSg/OklEfExpdGVyYWx8UGF0aCk/fGZ1bmN0aW9ufGltYWdlTGl0ZXJhbHxsaW5lKVxiLyxhbGlhczoiY29uc3RhbnQifSwib3RoZXItZGlyZWN0aXZlIjp7cGF0dGVybjovI1x3K1xiLyxhbGlhczoicHJvcGVydHkifSxhdHRyaWJ1dGU6e3BhdHRlcm46L0BcdysvLGFsaWFzOiJhdHJ1bGUifSwiZnVuY3Rpb24tZGVmaW5pdGlvbiI6e3BhdHRlcm46LyhcYmZ1bmNccyspXHcrLyxsb29rYmVoaW5kOiEwLGFsaWFzOiJmdW5jdGlvbiJ9LGxhYmVsOntwYXR0ZXJuOi9cYihicmVha3xjb250aW51ZSlccytcdyt8XGJbYS16QS1aX11cdyooPz1ccyo6XHMqKD86Zm9yfHJlcGVhdHx3aGlsZSlcYikvLGxvb2tiZWhpbmQ6ITAsYWxpYXM6ImltcG9ydGFudCJ9LGtleXdvcmQ6L1xiKD86QW55fFByb3RvY29sfFNlbGZ8VHlwZXxhY3Rvcnxhc3xhc3NpZ25tZW50fGFzc29jaWF0ZWR0eXBlfGFzc29jaWF0aXZpdHl8YXN5bmN8YXdhaXR8YnJlYWt8Y2FzZXxjYXRjaHxjbGFzc3xjb250aW51ZXxjb252ZW5pZW5jZXxkZWZhdWx0fGRlZmVyfGRlaW5pdHxkaWRTZXR8ZG98ZHluYW1pY3xlbHNlfGVudW18ZXh0ZW5zaW9ufGZhbGx0aHJvdWdofGZpbGVwcml2YXRlfGZpbmFsfGZvcnxmdW5jfGdldHxndWFyZHxoaWdoZXJUaGFufGlmfGltcG9ydHxpbnxpbmRpcmVjdHxpbmZpeHxpbml0fGlub3V0fGludGVybmFsfGlzfGxhenl8bGVmdHxsZXR8bG93ZXJUaGFufG11dGF0aW5nfG5vbmV8bm9uaXNvbGF0ZWR8bm9ubXV0YXRpbmd8b3BlbnxvcGVyYXRvcnxvcHRpb25hbHxvdmVycmlkZXxwb3N0Zml4fHByZWNlZGVuY2Vncm91cHxwcmVmaXh8cHJpdmF0ZXxwcm90b2NvbHxwdWJsaWN8cmVwZWF0fHJlcXVpcmVkfHJldGhyb3dzfHJldHVybnxyaWdodHxzYWZlfHNlbGZ8c2V0fHNvbWV8c3RhdGljfHN0cnVjdHxzdWJzY3JpcHR8c3VwZXJ8c3dpdGNofHRocm93fHRocm93c3x0cnl8dHlwZWFsaWFzfHVub3duZWR8dW5zYWZlfHZhcnx3ZWFrfHdoZXJlfHdoaWxlfHdpbGxTZXQpXGIvLGJvb2xlYW46L1xiKD86dHJ1ZXxmYWxzZSlcYi8sbmlsOntwYXR0ZXJuOi9cYm5pbFxiLyxhbGlhczoiY29uc3RhbnQifSwic2hvcnQtYXJndW1lbnQiOi9cJFxkK1xiLyxvbWl0OntwYXR0ZXJuOi9cYl9cYi8sYWxpYXM6ImtleXdvcmQifSxudW1iZXI6L1xiKD86W1xkX10rKD86XC5bXGRlX10rKT98MHhbYS1mMC05X10rKD86XC5bYS1mMC05cF9dKyk/fDBiWzAxX10rfDBvWzAtN19dKylcYi9pLCJjbGFzcy1uYW1lIjovXGJbQS1aXSg/OltBLVpfXGRdKlthLXpdXHcqKT9cYi8sZnVuY3Rpb246L1xiW2Etel9dXHcqKD89XHMqXCgpL2ksY29uc3RhbnQ6L1xiKD86W0EtWl9dezIsfXxrW0EtWl1bQS1aYS16X10rKVxiLyxvcGVyYXRvcjovWy0rKi8lPSE8PiZ8Xn4/XSt8XC5bLlwtKyovJT0hPD4mfF5+P10rLyxwdW5jdHVhdGlvbjovW3t9W1xdKCk7LC46XFxdL30sUHJpc20ubGFuZ3VhZ2VzLnN3aWZ0WyJzdHJpbmctbGl0ZXJhbCJdLmZvckVhY2goKGZ1bmN0aW9uKGUpe2UuaW5zaWRlLmludGVycG9sYXRpb24uaW5zaWRlPVByaXNtLmxhbmd1YWdlcy5zd2lmdDt9KSksZnVuY3Rpb24oZSl7dmFyIHQ9IlxcYig/OkJBU0h8QkFTSE9QVFN8QkFTSF9BTElBU0VTfEJBU0hfQVJHQ3xCQVNIX0FSR1Z8QkFTSF9DTURTfEJBU0hfQ09NUExFVElPTl9DT01QQVRfRElSfEJBU0hfTElORU5PfEJBU0hfUkVNQVRDSHxCQVNIX1NPVVJDRXxCQVNIX1ZFUlNJTkZPfEJBU0hfVkVSU0lPTnxDT0xPUlRFUk18Q09MVU1OU3xDT01QX1dPUkRCUkVBS1N8REJVU19TRVNTSU9OX0JVU19BRERSRVNTfERFRkFVTFRTX1BBVEh8REVTS1RPUF9TRVNTSU9OfERJUlNUQUNLfERJU1BMQVl8RVVJRHxHRE1TRVNTSU9OfEdETV9MQU5HfEdOT01FX0tFWVJJTkdfQ09OVFJPTHxHTk9NRV9LRVlSSU5HX1BJRHxHUEdfQUdFTlRfSU5GT3xHUk9VUFN8SElTVENPTlRST0x8SElTVEZJTEV8SElTVEZJTEVTSVpFfEhJU1RTSVpFfEhPTUV8SE9TVE5BTUV8SE9TVFRZUEV8SUZTfElOU1RBTkNFfEpPQnxMQU5HfExBTkdVQUdFfExDX0FERFJFU1N8TENfQUxMfExDX0lERU5USUZJQ0FUSU9OfExDX01FQVNVUkVNRU5UfExDX01PTkVUQVJZfExDX05BTUV8TENfTlVNRVJJQ3xMQ19QQVBFUnxMQ19URUxFUEhPTkV8TENfVElNRXxMRVNTQ0xPU0V8TEVTU09QRU58TElORVN8TE9HTkFNRXxMU19DT0xPUlN8TUFDSFRZUEV8TUFJTENIRUNLfE1BTkRBVE9SWV9QQVRIfE5PX0FUX0JSSURHRXxPTERQV0R8T1BURVJSfE9QVElORHxPUkJJVF9TT0NLRVRESVJ8T1NUWVBFfFBBUEVSU0laRXxQQVRIfFBJUEVTVEFUVVN8UFBJRHxQUzF8UFMyfFBTM3xQUzR8UFdEfFJBTkRPTXxSRVBMWXxTRUNPTkRTfFNFTElOVVhfSU5JVHxTRVNTSU9OfFNFU1NJT05UWVBFfFNFU1NJT05fTUFOQUdFUnxTSEVMTHxTSEVMTE9QVFN8U0hMVkx8U1NIX0FVVEhfU09DS3xURVJNfFVJRHxVUFNUQVJUX0VWRU5UU3xVUFNUQVJUX0lOU1RBTkNFfFVQU1RBUlRfSk9CfFVQU1RBUlRfU0VTU0lPTnxVU0VSfFdJTkRPV0lEfFhBVVRIT1JJVFl8WERHX0NPTkZJR19ESVJTfFhER19DVVJSRU5UX0RFU0tUT1B8WERHX0RBVEFfRElSU3xYREdfR1JFRVRFUl9EQVRBX0RJUnxYREdfTUVOVV9QUkVGSVh8WERHX1JVTlRJTUVfRElSfFhER19TRUFUfFhER19TRUFUX1BBVEh8WERHX1NFU1NJT05fREVTS1RPUHxYREdfU0VTU0lPTl9JRHxYREdfU0VTU0lPTl9QQVRIfFhER19TRVNTSU9OX1RZUEV8WERHX1ZUTlJ8WE1PRElGSUVSUylcXGIiLG49e3BhdHRlcm46LyheKFsiJ10/KVx3K1wyKVsgXHRdK1xTLiovLGxvb2tiZWhpbmQ6ITAsYWxpYXM6InB1bmN0dWF0aW9uIixpbnNpZGU6bnVsbH0sYT17YmFzaDpuLGVudmlyb25tZW50OntwYXR0ZXJuOlJlZ0V4cCgiXFwkIit0KSxhbGlhczoiY29uc3RhbnQifSx2YXJpYWJsZTpbe3BhdHRlcm46L1wkP1woXChbXHNcU10rP1wpXCkvLGdyZWVkeTohMCxpbnNpZGU6e3ZhcmlhYmxlOlt7cGF0dGVybjovKF5cJFwoXChbXHNcU10rKVwpXCkvLGxvb2tiZWhpbmQ6ITB9LC9eXCRcKFwoL10sbnVtYmVyOi9cYjB4W1xkQS1GYS1mXStcYnwoPzpcYlxkKyg/OlwuXGQqKT98XEJcLlxkKykoPzpbRWVdLT9cZCspPy8sb3BlcmF0b3I6Ly0tfFwrXCt8XCpcKj0/fDw8PT98Pj49P3wmJnxcfFx8fFs9IStcLSovJTw+XiZ8XT0/fFs/fjpdLyxwdW5jdHVhdGlvbjovXChcKD98XClcKT98LHw7L319LHtwYXR0ZXJuOi9cJFwoKD86XChbXildK1wpfFteKCldKStcKXxgW15gXStgLyxncmVlZHk6ITAsaW5zaWRlOnt2YXJpYWJsZTovXlwkXCh8XmB8XCkkfGAkL319LHtwYXR0ZXJuOi9cJFx7W159XStcfS8sZ3JlZWR5OiEwLGluc2lkZTp7b3BlcmF0b3I6LzpbLT0/K10/fFshXC9dfCMjP3wlJT98XF5cXj98LCw/LyxwdW5jdHVhdGlvbjovW1xbXF1dLyxlbnZpcm9ubWVudDp7cGF0dGVybjpSZWdFeHAoIihcXHspIit0KSxsb29rYmVoaW5kOiEwLGFsaWFzOiJjb25zdGFudCJ9fX0sL1wkKD86XHcrfFsjPyohQCRdKS9dLGVudGl0eTovXFwoPzpbYWJjZUVmbnJ0dlxcIl18Tz9bMC03XXsxLDN9fHhbMC05YS1mQS1GXXsxLDJ9fHVbMC05YS1mQS1GXXs0fXxVWzAtOWEtZkEtRl17OH0pL307ZS5sYW5ndWFnZXMuYmFzaD17c2hlYmFuZzp7cGF0dGVybjovXiMhXHMqXC8uKi8sYWxpYXM6ImltcG9ydGFudCJ9LGNvbW1lbnQ6e3BhdHRlcm46LyhefFteIntcXCRdKSMuKi8sbG9va2JlaGluZDohMH0sImZ1bmN0aW9uLW5hbWUiOlt7cGF0dGVybjovKFxiZnVuY3Rpb25ccyspW1x3LV0rKD89KD86XHMqXCg/OlxzKlwpKT9ccypceykvLGxvb2tiZWhpbmQ6ITAsYWxpYXM6ImZ1bmN0aW9uIn0se3BhdHRlcm46L1xiW1x3LV0rKD89XHMqXChccypcKVxzKlx7KS8sYWxpYXM6ImZ1bmN0aW9uIn1dLCJmb3Itb3Itc2VsZWN0Ijp7cGF0dGVybjovKFxiKD86Zm9yfHNlbGVjdClccyspXHcrKD89XHMraW5ccykvLGFsaWFzOiJ2YXJpYWJsZSIsbG9va2JlaGluZDohMH0sImFzc2lnbi1sZWZ0Ijp7cGF0dGVybjovKF58W1xzO3wmXXxbPD5dXCgpXHcrKD89XCs/PSkvLGluc2lkZTp7ZW52aXJvbm1lbnQ6e3BhdHRlcm46UmVnRXhwKCIoXnxbXFxzO3wmXXxbPD5dXFwoKSIrdCksbG9va2JlaGluZDohMCxhbGlhczoiY29uc3RhbnQifX0sYWxpYXM6InZhcmlhYmxlIixsb29rYmVoaW5kOiEwfSxzdHJpbmc6W3twYXR0ZXJuOi8oKD86XnxbXjxdKTw8LT9ccyopKFx3Kylcc1tcc1xTXSo/KD86XHI/XG58XHIpXDIvLGxvb2tiZWhpbmQ6ITAsZ3JlZWR5OiEwLGluc2lkZTphfSx7cGF0dGVybjovKCg/Ol58W148XSk8PC0/XHMqKShbIiddKShcdyspXDJcc1tcc1xTXSo/KD86XHI/XG58XHIpXDMvLGxvb2tiZWhpbmQ6ITAsZ3JlZWR5OiEwLGluc2lkZTp7YmFzaDpufX0se3BhdHRlcm46LyhefFteXFxdKD86XFxcXCkqKSIoPzpcXFtcc1xTXXxcJFwoW14pXStcKXxcJCg/IVwoKXxgW15gXStgfFteIlxcYCRdKSoiLyxsb29rYmVoaW5kOiEwLGdyZWVkeTohMCxpbnNpZGU6YX0se3BhdHRlcm46LyhefFteJFxcXSknW14nXSonLyxsb29rYmVoaW5kOiEwLGdyZWVkeTohMH0se3BhdHRlcm46L1wkJyg/OlteJ1xcXXxcXFtcc1xTXSkqJy8sZ3JlZWR5OiEwLGluc2lkZTp7ZW50aXR5OmEuZW50aXR5fX1dLGVudmlyb25tZW50OntwYXR0ZXJuOlJlZ0V4cCgiXFwkPyIrdCksYWxpYXM6ImNvbnN0YW50In0sdmFyaWFibGU6YS52YXJpYWJsZSxmdW5jdGlvbjp7cGF0dGVybjovKF58W1xzO3wmXXxbPD5dXCgpKD86YWRkfGFwcm9wb3N8YXB0fGFwdGl0dWRlfGFwdC1jYWNoZXxhcHQtZ2V0fGFzcGVsbHxhdXRvbXlzcWxiYWNrdXB8YXdrfGJhc2VuYW1lfGJhc2h8YmN8YmNvbnNvbGV8Ymd8YnppcDJ8Y2FsfGNhdHxjZmRpc2t8Y2hncnB8Y2hrY29uZmlnfGNobW9kfGNob3dufGNocm9vdHxja3N1bXxjbGVhcnxjbXB8Y29sdW1ufGNvbW18Y29tcG9zZXJ8Y3B8Y3Jvbnxjcm9udGFifGNzcGxpdHxjdXJsfGN1dHxkYXRlfGRjfGRkfGRkcmVzY3VlfGRlYm9vdHN0cmFwfGRmfGRpZmZ8ZGlmZjN8ZGlnfGRpcnxkaXJjb2xvcnN8ZGlybmFtZXxkaXJzfGRtZXNnfGR1fGVncmVwfGVqZWN0fGVudnxldGh0b29sfGV4cGFuZHxleHBlY3R8ZXhwcnxmZGZvcm1hdHxmZGlza3xmZ3xmZ3JlcHxmaWxlfGZpbmR8Zm10fGZvbGR8Zm9ybWF0fGZyZWV8ZnNja3xmdHB8ZnVzZXJ8Z2F3a3xnaXR8Z3BhcnRlZHxncmVwfGdyb3VwYWRkfGdyb3VwZGVsfGdyb3VwbW9kfGdyb3Vwc3xncnViLW1rY29uZmlnfGd6aXB8aGFsdHxoZWFkfGhnfGhpc3Rvcnl8aG9zdHxob3N0bmFtZXxodG9wfGljb252fGlkfGlmY29uZmlnfGlmZG93bnxpZnVwfGltcG9ydHxpbnN0YWxsfGlwfGpvYnN8am9pbnxraWxsfGtpbGxhbGx8bGVzc3xsaW5rfGxufGxvY2F0ZXxsb2duYW1lfGxvZ3JvdGF0ZXxsb29rfGxwY3xscHJ8bHByaW50fGxwcmludGR8bHByaW50cXxscHJtfGxzfGxzb2Z8bHlueHxtYWtlfG1hbnxtY3xtZGFkbXxta2NvbmZpZ3xta2Rpcnxta2UyZnN8bWtmaWZvfG1rZnN8bWtpc29mc3xta25vZHxta3N3YXB8bW12fG1vcmV8bW9zdHxtb3VudHxtdG9vbHN8bXRyfG11dHR8bXZ8bmFub3xuY3xuZXRzdGF0fG5pY2V8bmx8bm9odXB8bm90aWZ5LXNlbmR8bnBtfG5zbG9va3VwfG9wfG9wZW58cGFydGVkfHBhc3N3ZHxwYXN0ZXxwYXRoY2hrfHBpbmd8cGtpbGx8cG5wbXxwb3BkfHByfHByaW50Y2FwfHByaW50ZW52fHBzfHB1c2hkfHB2fHF1b3RhfHF1b3RhY2hlY2t8cXVvdGFjdGx8cmFtfHJhcnxyY3B8cmVib290fHJlbXN5bmN8cmVuYW1lfHJlbmljZXxyZXZ8cm18cm1kaXJ8cnBtfHJzeW5jfHNjcHxzY3JlZW58c2RpZmZ8c2VkfHNlbmRtYWlsfHNlcXxzZXJ2aWNlfHNmdHB8c2h8c2hlbGxjaGVja3xzaHVmfHNodXRkb3dufHNsZWVwfHNsb2NhdGV8c29ydHxzcGxpdHxzc2h8c3RhdHxzdHJhY2V8c3V8c3Vkb3xzdW18c3VzcGVuZHxzd2Fwb258c3luY3x0YWN8dGFpbHx0YXJ8dGVlfHRpbWV8dGltZW91dHx0b3B8dG91Y2h8dHJ8dHJhY2Vyb3V0ZXx0c29ydHx0dHl8dW1vdW50fHVuYW1lfHVuZXhwYW5kfHVuaXF8dW5pdHN8dW5yYXJ8dW5zaGFyfHVuemlwfHVwZGF0ZS1ncnVifHVwdGltZXx1c2VyYWRkfHVzZXJkZWx8dXNlcm1vZHx1c2Vyc3x1dWRlY29kZXx1dWVuY29kZXx2fHZkaXJ8dml8dmltfHZpcnNofHZtc3RhdHx3YWl0fHdhdGNofHdjfHdnZXR8d2hlcmVpc3x3aGljaHx3aG98d2hvYW1pfHdyaXRlfHhhcmdzfHhkZy1vcGVufHlhcm58eWVzfHplbml0eXx6aXB8enNofHp5cHBlcikoPz0kfFspXHM7fCZdKS8sbG9va2JlaGluZDohMH0sa2V5d29yZDp7cGF0dGVybjovKF58W1xzO3wmXXxbPD5dXCgpKD86aWZ8dGhlbnxlbHNlfGVsaWZ8Zml8Zm9yfHdoaWxlfGlufGNhc2V8ZXNhY3xmdW5jdGlvbnxzZWxlY3R8ZG98ZG9uZXx1bnRpbCkoPz0kfFspXHM7fCZdKS8sbG9va2JlaGluZDohMH0sYnVpbHRpbjp7cGF0dGVybjovKF58W1xzO3wmXXxbPD5dXCgpKD86XC58OnxicmVha3xjZHxjb250aW51ZXxldmFsfGV4ZWN8ZXhpdHxleHBvcnR8Z2V0b3B0c3xoYXNofHB3ZHxyZWFkb25seXxyZXR1cm58c2hpZnR8dGVzdHx0aW1lc3x0cmFwfHVtYXNrfHVuc2V0fGFsaWFzfGJpbmR8YnVpbHRpbnxjYWxsZXJ8Y29tbWFuZHxkZWNsYXJlfGVjaG98ZW5hYmxlfGhlbHB8bGV0fGxvY2FsfGxvZ291dHxtYXBmaWxlfHByaW50ZnxyZWFkfHJlYWRhcnJheXxzb3VyY2V8dHlwZXx0eXBlc2V0fHVsaW1pdHx1bmFsaWFzfHNldHxzaG9wdCkoPz0kfFspXHM7fCZdKS8sbG9va2JlaGluZDohMCxhbGlhczoiY2xhc3MtbmFtZSJ9LGJvb2xlYW46e3BhdHRlcm46LyhefFtcczt8Jl18Wzw+XVwoKSg/OnRydWV8ZmFsc2UpKD89JHxbKVxzO3wmXSkvLGxvb2tiZWhpbmQ6ITB9LCJmaWxlLWRlc2NyaXB0b3IiOntwYXR0ZXJuOi9cQiZcZFxiLyxhbGlhczoiaW1wb3J0YW50In0sb3BlcmF0b3I6e3BhdHRlcm46L1xkPzw+fD5cfHxcKz18PVs9fl0/fCE9P3w8PFs8LV0/fFsmXGRdPz4+fFxkWzw+XSY/fFs8Pl1bJj1dP3wmWz4mXT98XHxbJnxdPy8saW5zaWRlOnsiZmlsZS1kZXNjcmlwdG9yIjp7cGF0dGVybjovXlxkLyxhbGlhczoiaW1wb3J0YW50In19fSxwdW5jdHVhdGlvbjovXCQ/XChcKD98XClcKT98XC5cLnxbe31bXF07XFxdLyxudW1iZXI6e3BhdHRlcm46LyhefFxzKSg/OlsxLTldXGQqfDApKD86Wy4sXVxkKyk/XGIvLGxvb2tiZWhpbmQ6ITB9fSxuLmluc2lkZT1lLmxhbmd1YWdlcy5iYXNoO2Zvcih2YXIgcj1bImNvbW1lbnQiLCJmdW5jdGlvbi1uYW1lIiwiZm9yLW9yLXNlbGVjdCIsImFzc2lnbi1sZWZ0Iiwic3RyaW5nIiwiZW52aXJvbm1lbnQiLCJmdW5jdGlvbiIsImtleXdvcmQiLCJidWlsdGluIiwiYm9vbGVhbiIsImZpbGUtZGVzY3JpcHRvciIsIm9wZXJhdG9yIiwicHVuY3R1YXRpb24iLCJudW1iZXIiXSxpPWEudmFyaWFibGVbMV0uaW5zaWRlLHM9MDtzPHIubGVuZ3RoO3MrKylpW3Jbc11dPWUubGFuZ3VhZ2VzLmJhc2hbcltzXV07ZS5sYW5ndWFnZXMuc2hlbGw9ZS5sYW5ndWFnZXMuYmFzaDt9KFByaXNtKSxmdW5jdGlvbihlKXt2YXIgdD0vKD86XFwufFteXFxcblxyXXwoPzpcbnxcclxuPykoPyFbXHJcbl0pKS8uc291cmNlO2Z1bmN0aW9uIG4oZSl7cmV0dXJuIGU9ZS5yZXBsYWNlKC88aW5uZXI+L2csKGZ1bmN0aW9uKCl7cmV0dXJuIHR9KSksUmVnRXhwKC8oKD86XnxbXlxcXSkoPzpcXHsyfSkqKS8uc291cmNlKyIoPzoiK2UrIikiKX12YXIgYT0vKD86XFwufGBgKD86W15gXHJcbl18YCg/IWApKStgYHxgW15gXHJcbl0rYHxbXlxcfFxyXG5gXSkrLy5zb3VyY2Uscj0vXHw/X18oPzpcfF9fKStcfD8oPzooPzpcbnxcclxuPyl8KD8hW1xzXFNdKSkvLnNvdXJjZS5yZXBsYWNlKC9fXy9nLChmdW5jdGlvbigpe3JldHVybiBhfSkpLGk9L1x8P1sgXHRdKjo/LXszLH06P1sgXHRdKig/Olx8WyBcdF0qOj8tezMsfTo/WyBcdF0qKStcfD8oPzpcbnxcclxuPykvLnNvdXJjZTtlLmxhbmd1YWdlcy5tYXJrZG93bj1lLmxhbmd1YWdlcy5leHRlbmQoIm1hcmt1cCIse30pLGUubGFuZ3VhZ2VzLmluc2VydEJlZm9yZSgibWFya2Rvd24iLCJwcm9sb2ciLHsiZnJvbnQtbWF0dGVyLWJsb2NrIjp7cGF0dGVybjovKF4oPzpccypbXHJcbl0pPyktLS0oPyEuKVtcc1xTXSo/W1xyXG5dLS0tKD8hLikvLGxvb2tiZWhpbmQ6ITAsZ3JlZWR5OiEwLGluc2lkZTp7cHVuY3R1YXRpb246L14tLS18LS0tJC8sImZvbnQtbWF0dGVyIjp7cGF0dGVybjovXFMrKD86XHMrXFMrKSovLGFsaWFzOlsieWFtbCIsImxhbmd1YWdlLXlhbWwiXSxpbnNpZGU6ZS5sYW5ndWFnZXMueWFtbH19fSxibG9ja3F1b3RlOntwYXR0ZXJuOi9ePig/OltcdCBdKj4pKi9tLGFsaWFzOiJwdW5jdHVhdGlvbiJ9LHRhYmxlOntwYXR0ZXJuOlJlZ0V4cCgiXiIrcitpKyIoPzoiK3IrIikqIiwibSIpLGluc2lkZTp7InRhYmxlLWRhdGEtcm93cyI6e3BhdHRlcm46UmVnRXhwKCJeKCIrcitpKyIpKD86IityKyIpKiQiKSxsb29rYmVoaW5kOiEwLGluc2lkZTp7InRhYmxlLWRhdGEiOntwYXR0ZXJuOlJlZ0V4cChhKSxpbnNpZGU6ZS5sYW5ndWFnZXMubWFya2Rvd259LHB1bmN0dWF0aW9uOi9cfC99fSwidGFibGUtbGluZSI6e3BhdHRlcm46UmVnRXhwKCJeKCIrcisiKSIraSsiJCIpLGxvb2tiZWhpbmQ6ITAsaW5zaWRlOntwdW5jdHVhdGlvbjovXHx8Oj8tezMsfTo/L319LCJ0YWJsZS1oZWFkZXItcm93Ijp7cGF0dGVybjpSZWdFeHAoIl4iK3IrIiQiKSxpbnNpZGU6eyJ0YWJsZS1oZWFkZXIiOntwYXR0ZXJuOlJlZ0V4cChhKSxhbGlhczoiaW1wb3J0YW50IixpbnNpZGU6ZS5sYW5ndWFnZXMubWFya2Rvd259LHB1bmN0dWF0aW9uOi9cfC99fX19LGNvZGU6W3twYXR0ZXJuOi8oKD86XnxcbilbIFx0XSpcbnwoPzpefFxyXG4/KVsgXHRdKlxyXG4/KSg/OiB7NH18XHQpLisoPzooPzpcbnxcclxuPykoPzogezR9fFx0KS4rKSovLGxvb2tiZWhpbmQ6ITAsYWxpYXM6ImtleXdvcmQifSx7cGF0dGVybjovXmBgYFtcc1xTXSo/XmBgYCQvbSxncmVlZHk6ITAsaW5zaWRlOnsiY29kZS1ibG9jayI6e3BhdHRlcm46L14oYGBgLiooPzpcbnxcclxuPykpW1xzXFNdKz8oPz0oPzpcbnxcclxuPyleYGBgJCkvbSxsb29rYmVoaW5kOiEwfSwiY29kZS1sYW5ndWFnZSI6e3BhdHRlcm46L14oYGBgKS4rLyxsb29rYmVoaW5kOiEwfSxwdW5jdHVhdGlvbjovYGBgL319XSx0aXRsZTpbe3BhdHRlcm46L1xTLiooPzpcbnxcclxuPykoPzo9PSt8LS0rKSg/PVsgXHRdKiQpL20sYWxpYXM6ImltcG9ydGFudCIsaW5zaWRlOntwdW5jdHVhdGlvbjovPT0rJHwtLSskL319LHtwYXR0ZXJuOi8oXlxzKikjLisvbSxsb29rYmVoaW5kOiEwLGFsaWFzOiJpbXBvcnRhbnQiLGluc2lkZTp7cHVuY3R1YXRpb246L14jK3wjKyQvfX1dLGhyOntwYXR0ZXJuOi8oXlxzKikoWyotXSkoPzpbXHQgXSpcMil7Mix9KD89XHMqJCkvbSxsb29rYmVoaW5kOiEwLGFsaWFzOiJwdW5jdHVhdGlvbiJ9LGxpc3Q6e3BhdHRlcm46LyheXHMqKSg/OlsqKy1dfFxkK1wuKSg/PVtcdCBdLikvbSxsb29rYmVoaW5kOiEwLGFsaWFzOiJwdW5jdHVhdGlvbiJ9LCJ1cmwtcmVmZXJlbmNlIjp7cGF0dGVybjovIT9cW1teXF1dK1xdOltcdCBdKyg/OlxTK3w8KD86XFwufFtePlxcXSkrPikoPzpbXHQgXSsoPzoiKD86XFwufFteIlxcXSkqInwnKD86XFwufFteJ1xcXSkqJ3xcKCg/OlxcLnxbXilcXF0pKlwpKSk/LyxpbnNpZGU6e3ZhcmlhYmxlOntwYXR0ZXJuOi9eKCE/XFspW15cXV0rLyxsb29rYmVoaW5kOiEwfSxzdHJpbmc6Lyg/OiIoPzpcXC58W14iXFxdKSoifCcoPzpcXC58W14nXFxdKSonfFwoKD86XFwufFteKVxcXSkqXCkpJC8scHVuY3R1YXRpb246L15bXFtcXSE6XXxbPD5dL30sYWxpYXM6InVybCJ9LGJvbGQ6e3BhdHRlcm46bigvXGJfXyg/Oig/IV8pPGlubmVyPnxfKD86KD8hXyk8aW5uZXI+KStfKStfX1xifFwqXCooPzooPyFcKik8aW5uZXI+fFwqKD86KD8hXCopPGlubmVyPikrXCopK1wqXCovLnNvdXJjZSksbG9va2JlaGluZDohMCxncmVlZHk6ITAsaW5zaWRlOntjb250ZW50OntwYXR0ZXJuOi8oXi4uKVtcc1xTXSsoPz0uLiQpLyxsb29rYmVoaW5kOiEwLGluc2lkZTp7fX0scHVuY3R1YXRpb246L1wqXCp8X18vfX0saXRhbGljOntwYXR0ZXJuOm4oL1xiXyg/Oig/IV8pPGlubmVyPnxfXyg/Oig/IV8pPGlubmVyPikrX18pK19cYnxcKig/Oig/IVwqKTxpbm5lcj58XCpcKig/Oig/IVwqKTxpbm5lcj4pK1wqXCopK1wqLy5zb3VyY2UpLGxvb2tiZWhpbmQ6ITAsZ3JlZWR5OiEwLGluc2lkZTp7Y29udGVudDp7cGF0dGVybjovKF4uKVtcc1xTXSsoPz0uJCkvLGxvb2tiZWhpbmQ6ITAsaW5zaWRlOnt9fSxwdW5jdHVhdGlvbjovWypfXS99fSxzdHJpa2U6e3BhdHRlcm46bigvKH5+PykoPzooPyF+KTxpbm5lcj4pK1wyLy5zb3VyY2UpLGxvb2tiZWhpbmQ6ITAsZ3JlZWR5OiEwLGluc2lkZTp7Y29udGVudDp7cGF0dGVybjovKF5+fj8pW1xzXFNdKyg/PVwxJCkvLGxvb2tiZWhpbmQ6ITAsaW5zaWRlOnt9fSxwdW5jdHVhdGlvbjovfn4/L319LCJjb2RlLXNuaXBwZXQiOntwYXR0ZXJuOi8oXnxbXlxcYF0pKD86YGBbXmBcclxuXSsoPzpgW15gXHJcbl0rKSpgYCg/IWApfGBbXmBcclxuXStgKD8hYCkpLyxsb29rYmVoaW5kOiEwLGdyZWVkeTohMCxhbGlhczpbImNvZGUiLCJrZXl3b3JkIl19LHVybDp7cGF0dGVybjpuKC8hP1xbKD86KD8hXF0pPGlubmVyPikrXF0oPzpcKFteXHMpXSsoPzpbXHQgXSsiKD86XFwufFteIlxcXSkqIik/XCl8WyBcdF0/XFsoPzooPyFcXSk8aW5uZXI+KStcXSkvLnNvdXJjZSksbG9va2JlaGluZDohMCxncmVlZHk6ITAsaW5zaWRlOntvcGVyYXRvcjovXiEvLGNvbnRlbnQ6e3BhdHRlcm46LyheXFspW15cXV0rKD89XF0pLyxsb29rYmVoaW5kOiEwLGluc2lkZTp7fX0sdmFyaWFibGU6e3BhdHRlcm46LyheXF1bIFx0XT9cWylbXlxdXSsoPz1cXSQpLyxsb29rYmVoaW5kOiEwfSx1cmw6e3BhdHRlcm46LyheXF1cKClbXlxzKV0rLyxsb29rYmVoaW5kOiEwfSxzdHJpbmc6e3BhdHRlcm46LyheWyBcdF0rKSIoPzpcXC58W14iXFxdKSoiKD89XCkkKS8sbG9va2JlaGluZDohMH19fX0pLFsidXJsIiwiYm9sZCIsIml0YWxpYyIsInN0cmlrZSJdLmZvckVhY2goKGZ1bmN0aW9uKHQpe1sidXJsIiwiYm9sZCIsIml0YWxpYyIsInN0cmlrZSIsImNvZGUtc25pcHBldCJdLmZvckVhY2goKGZ1bmN0aW9uKG4pe3QhPT1uJiYoZS5sYW5ndWFnZXMubWFya2Rvd25bdF0uaW5zaWRlLmNvbnRlbnQuaW5zaWRlW25dPWUubGFuZ3VhZ2VzLm1hcmtkb3duW25dKTt9KSk7fSkpLGUuaG9va3MuYWRkKCJhZnRlci10b2tlbml6ZSIsKGZ1bmN0aW9uKGUpeyJtYXJrZG93biIhPT1lLmxhbmd1YWdlJiYibWQiIT09ZS5sYW5ndWFnZXx8ZnVuY3Rpb24gZSh0KXtpZih0JiYic3RyaW5nIiE9dHlwZW9mIHQpZm9yKHZhciBuPTAsYT10Lmxlbmd0aDtuPGE7bisrKXt2YXIgcj10W25dO2lmKCJjb2RlIj09PXIudHlwZSl7dmFyIGk9ci5jb250ZW50WzFdLHM9ci5jb250ZW50WzNdO2lmKGkmJnMmJiJjb2RlLWxhbmd1YWdlIj09PWkudHlwZSYmImNvZGUtYmxvY2siPT09cy50eXBlJiYic3RyaW5nIj09dHlwZW9mIGkuY29udGVudCl7dmFyIG89aS5jb250ZW50LnJlcGxhY2UoL1xiIy9nLCJzaGFycCIpLnJlcGxhY2UoL1xiXCtcKy9nLCJwcCIpLGw9Imxhbmd1YWdlLSIrKG89KC9bYS16XVtcdy1dKi9pLmV4ZWMobyl8fFsiIl0pWzBdLnRvTG93ZXJDYXNlKCkpO3MuYWxpYXM/InN0cmluZyI9PXR5cGVvZiBzLmFsaWFzP3MuYWxpYXM9W3MuYWxpYXMsbF06cy5hbGlhcy5wdXNoKGwpOnMuYWxpYXM9W2xdO319ZWxzZSBlKHIuY29udGVudCk7fX0oZS50b2tlbnMpO30pKSxlLmhvb2tzLmFkZCgid3JhcCIsKGZ1bmN0aW9uKHQpe2lmKCJjb2RlLWJsb2NrIj09PXQudHlwZSl7Zm9yKHZhciBuPSIiLGE9MCxyPXQuY2xhc3Nlcy5sZW5ndGg7YTxyO2ErKyl7dmFyIGk9dC5jbGFzc2VzW2FdLHU9L2xhbmd1YWdlLSguKykvLmV4ZWMoaSk7aWYodSl7bj11WzFdO2JyZWFrfX12YXIgYz1lLmxhbmd1YWdlc1tuXTtpZihjKXQuY29udGVudD1lLmhpZ2hsaWdodChmdW5jdGlvbihlKXt2YXIgdD1lLnJlcGxhY2UocywiIik7cmV0dXJuIHQ9dC5yZXBsYWNlKC8mKFx3ezEsOH18I3g/W1xkYS1mXXsxLDh9KTsvZ2ksKGZ1bmN0aW9uKGUsdCl7dmFyIG47aWYoIiMiPT09KHQ9dC50b0xvd2VyQ2FzZSgpKVswXSlyZXR1cm4gbj0ieCI9PT10WzFdP3BhcnNlSW50KHQuc2xpY2UoMiksMTYpOk51bWJlcih0LnNsaWNlKDEpKSxsKG4pO3ZhciBhPW9bdF07cmV0dXJuIGF8fGV9KSl9KHQuY29udGVudCksYyxuKTtlbHNlIGlmKG4mJiJub25lIiE9PW4mJmUucGx1Z2lucy5hdXRvbG9hZGVyKXt2YXIgZD0ibWQtIisobmV3IERhdGUpLnZhbHVlT2YoKSsiLSIrTWF0aC5mbG9vcigxZTE2Kk1hdGgucmFuZG9tKCkpO3QuYXR0cmlidXRlcy5pZD1kLGUucGx1Z2lucy5hdXRvbG9hZGVyLmxvYWRMYW5ndWFnZXMobiwoZnVuY3Rpb24oKXt2YXIgdD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZChkKTt0JiYodC5pbm5lckhUTUw9ZS5oaWdobGlnaHQodC50ZXh0Q29udGVudCxlLmxhbmd1YWdlc1tuXSxuKSk7fSkpO319fSkpO3ZhciBzPVJlZ0V4cChlLmxhbmd1YWdlcy5tYXJrdXAudGFnLnBhdHRlcm4uc291cmNlLCJnaSIpLG89e2FtcDoiJiIsbHQ6IjwiLGd0OiI+IixxdW90OiciJ30sbD1TdHJpbmcuZnJvbUNvZGVQb2ludHx8U3RyaW5nLmZyb21DaGFyQ29kZTtlLmxhbmd1YWdlcy5tZD1lLmxhbmd1YWdlcy5tYXJrZG93bjt9KFByaXNtKSxQcmlzbS5sYW5ndWFnZXMubHVhPXtjb21tZW50Oi9eIyEuK3wtLSg/OlxbKD0qKVxbW1xzXFNdKj9cXVwxXF18LiopL20sc3RyaW5nOntwYXR0ZXJuOi8oWyInXSkoPzooPyFcMSlbXlxcXHJcbl18XFx6KD86XHJcbnxccyl8XFwoPzpcclxufFteel0pKSpcMXxcWyg9KilcW1tcc1xTXSo/XF1cMlxdLyxncmVlZHk6ITB9LG51bWJlcjovXGIweFthLWZcZF0rKD86XC5bYS1mXGRdKik/KD86cFsrLV0/XGQrKT9cYnxcYlxkKyg/OlwuXEJ8KD86XC5cZCopPyg/OmVbKy1dP1xkKyk/XGIpfFxCXC5cZCsoPzplWystXT9cZCspP1xiL2ksa2V5d29yZDovXGIoPzphbmR8YnJlYWt8ZG98ZWxzZXxlbHNlaWZ8ZW5kfGZhbHNlfGZvcnxmdW5jdGlvbnxnb3RvfGlmfGlufGxvY2FsfG5pbHxub3R8b3J8cmVwZWF0fHJldHVybnx0aGVufHRydWV8dW50aWx8d2hpbGUpXGIvLGZ1bmN0aW9uOi8oPyFcZClcdysoPz1ccyooPzpbKHtdKSkvLG9wZXJhdG9yOlsvWy0rKiVeJnwjXXxcL1wvP3w8Wzw9XT98Pls+PV0/fFs9fl09Py8se3BhdHRlcm46LyhefFteLl0pXC5cLig/IVwuKS8sbG9va2JlaGluZDohMH1dLHB1bmN0dWF0aW9uOi9bXFtcXSgpe30sO118XC4rfDorL30sUHJpc20ubGFuZ3VhZ2VzLmdyb292eT1QcmlzbS5sYW5ndWFnZXMuZXh0ZW5kKCJjbGlrZSIse3N0cmluZzpbe3BhdHRlcm46LygiIiJ8JycnKSg/OlteXFxdfFxcW1xzXFNdKSo/XDF8XCRcLyg/OlteLyRdfFwkKD86Wy8kXXwoPyFbLyRdKSl8XC8oPyFcJCkpKlwvXCQvLGdyZWVkeTohMH0se3BhdHRlcm46LyhbIicvXSkoPzpcXC58KD8hXDEpW15cXFxyXG5dKSpcMS8sZ3JlZWR5OiEwfV0sa2V5d29yZDovXGIoPzphc3xkZWZ8aW58YWJzdHJhY3R8YXNzZXJ0fGJvb2xlYW58YnJlYWt8Ynl0ZXxjYXNlfGNhdGNofGNoYXJ8Y2xhc3N8Y29uc3R8Y29udGludWV8ZGVmYXVsdHxkb3xkb3VibGV8ZWxzZXxlbnVtfGV4dGVuZHN8ZmluYWx8ZmluYWxseXxmbG9hdHxmb3J8Z290b3xpZnxpbXBsZW1lbnRzfGltcG9ydHxpbnN0YW5jZW9mfGludHxpbnRlcmZhY2V8bG9uZ3xuYXRpdmV8bmV3fHBhY2thZ2V8cHJpdmF0ZXxwcm90ZWN0ZWR8cHVibGljfHJldHVybnxzaG9ydHxzdGF0aWN8c3RyaWN0ZnB8c3VwZXJ8c3dpdGNofHN5bmNocm9uaXplZHx0aGlzfHRocm93fHRocm93c3x0cmFpdHx0cmFuc2llbnR8dHJ5fHZvaWR8dm9sYXRpbGV8d2hpbGUpXGIvLG51bWJlcjovXGIoPzowYlswMV9dK3wweFtcZGEtZl9dKyg/OlwuW1xkYS1mX3BcLV0rKT98W1xkX10rKD86XC5bXGRfXSspPyg/OmVbKy1dP1xkKyk/KVtnbGlkZl0/XGIvaSxvcGVyYXRvcjp7cGF0dGVybjovKF58W14uXSkoPzp+fD09P34/fFw/Wy46XT98XCooPzpbLj1dfFwqPT8pP3xcLltAJl18XC5cLjx8XC5cLig/IVwuKXwtWy09Pl0/fFwrWys9XT98IT0/fDwoPzo8PT98PT4/KT98Pig/Oj4+Pz0/fD0pP3wmWyY9XT98XHxbfD1dP3xcLz0/fFxePT98JT0/KS8sbG9va2JlaGluZDohMH0scHVuY3R1YXRpb246L1wuK3xbe31bXF07KCksOiRdL30pLFByaXNtLmxhbmd1YWdlcy5pbnNlcnRCZWZvcmUoImdyb292eSIsInN0cmluZyIse3NoZWJhbmc6e3BhdHRlcm46LyMhLisvLGFsaWFzOiJjb21tZW50In19KSxQcmlzbS5sYW5ndWFnZXMuaW5zZXJ0QmVmb3JlKCJncm9vdnkiLCJwdW5jdHVhdGlvbiIseyJzcG9jay1ibG9jayI6L1xiKD86c2V0dXB8Z2l2ZW58d2hlbnx0aGVufGFuZHxjbGVhbnVwfGV4cGVjdHx3aGVyZSk6L30pLFByaXNtLmxhbmd1YWdlcy5pbnNlcnRCZWZvcmUoImdyb292eSIsImZ1bmN0aW9uIix7YW5ub3RhdGlvbjp7cGF0dGVybjovKF58W14uXSlAXHcrLyxsb29rYmVoaW5kOiEwLGFsaWFzOiJwdW5jdHVhdGlvbiJ9fSksUHJpc20uaG9va3MuYWRkKCJ3cmFwIiwoZnVuY3Rpb24oZSl7aWYoImdyb292eSI9PT1lLmxhbmd1YWdlJiYic3RyaW5nIj09PWUudHlwZSl7dmFyIHQ9ZS5jb250ZW50WzBdO2lmKCInIiE9dCl7dmFyIG49LyhbXlxcXSkoPzpcJCg/Olx7Lio/XH18W1x3Ll0rKSkvOyIkIj09PXQmJihuPS8oW15cJF0pKD86XCQoPzpcey4qP1x9fFtcdy5dKykpLyksZS5jb250ZW50PWUuY29udGVudC5yZXBsYWNlKC8mbHQ7L2csIjwiKS5yZXBsYWNlKC8mYW1wOy9nLCImIiksZS5jb250ZW50PVByaXNtLmhpZ2hsaWdodChlLmNvbnRlbnQse2V4cHJlc3Npb246e3BhdHRlcm46bixsb29rYmVoaW5kOiEwLGluc2lkZTpQcmlzbS5sYW5ndWFnZXMuZ3Jvb3Z5fX0pLGUuY2xhc3Nlcy5wdXNoKCIvIj09PXQ/InJlZ2V4IjoiZ3N0cmluZyIpO319fSkpO3ZhciB2bj1bImNvbW1lbnQiLCJwcm9sb2ciLCJkb2N0eXBlIiwiY2RhdGEiLCJwdW5jdHVhdGlvbiIsIm5hbWVzcGFjZSIsInByb3BlcnR5IiwidGFnIiwiYm9vbGVhbiIsIm51bWJlciIsImNvbnN0YW50Iiwic3ltYm9sIiwiZGVsZXRlZCIsInNlbGVjdG9yIiwiYXR0ci1uYW1lIiwic3RyaW5nIiwiYnVpbHRpbiIsImluc2VydGVkIiwib3BlcmF0b3IiLCJlbnRpdHkiLCJ1cmwiLCJzdHJpbmciLCJhdHJ1bGUiLCJhdHRyLXZhbHVlIiwia2V5d29yZCIsImZ1bmN0aW9uIiwiY2xhc3MtbmFtZSIsInJlZ2V4IiwiaW1wb3J0YW50IiwidmFyaWFibGUiLCJib2xkIiwiaXRhbGljIiwiZW50aXR5IiwiY2hhciJdO2Z1bmN0aW9uIFNuKGUpe3JldHVybiAic3RyaW5nIj09dHlwZW9mIGU/ZS5sZW5ndGg6InN0cmluZyI9PXR5cGVvZiBlLmNvbnRlbnQ/ZS5jb250ZW50Lmxlbmd0aDplLmNvbnRlbnQucmVkdWNlKChmdW5jdGlvbihlLHQpe3JldHVybiBlK1NuKHQpfSksMCl9dmFyIHduLGtuPWQuU3RyaW5nLEFuPWZ1bmN0aW9uKGUpe2lmKCJTeW1ib2wiPT09bnQoZSkpdGhyb3cgVHlwZUVycm9yKCJDYW5ub3QgY29udmVydCBhIFN5bWJvbCB2YWx1ZSB0byBhIHN0cmluZyIpO3JldHVybiBrbihlKX0seG49ZnVuY3Rpb24oKXt2YXIgZT1pZSh0aGlzKSx0PSIiO3JldHVybiBlLmdsb2JhbCYmKHQrPSJnIiksZS5pZ25vcmVDYXNlJiYodCs9ImkiKSxlLm11bHRpbGluZSYmKHQrPSJtIiksZS5kb3RBbGwmJih0Kz0icyIpLGUudW5pY29kZSYmKHQrPSJ1IiksZS5zdGlja3kmJih0Kz0ieSIpLHR9LFRuPWQuUmVnRXhwLF9uPWooKGZ1bmN0aW9uKCl7dmFyIGU9VG4oImEiLCJ5Iik7cmV0dXJuIGUubGFzdEluZGV4PTIsbnVsbCE9ZS5leGVjKCJhYmNkIil9KSksT249X258fGooKGZ1bmN0aW9uKCl7cmV0dXJuICFUbigiYSIsInkiKS5zdGlja3l9KSksSW49e0JST0tFTl9DQVJFVDpfbnx8aigoZnVuY3Rpb24oKXt2YXIgZT1UbigiXnIiLCJneSIpO3JldHVybiBlLmxhc3RJbmRleD0yLG51bGwhPWUuZXhlYygic3RyIil9KSksTUlTU0VEX1NUSUNLWTpPbixVTlNVUFBPUlRFRF9ZOl9ufSxSbj1LP09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzOmZ1bmN0aW9uKGUsdCl7aWUoZSk7Zm9yKHZhciBuLGE9anQodCkscj1mbih0KSxpPXIubGVuZ3RoLHM9MDtpPnM7KWtlLmYoZSxuPXJbcysrXSxhW25dKTtyZXR1cm4gZX0sTm49QygiZG9jdW1lbnQiLCJkb2N1bWVudEVsZW1lbnQiKSxMbj1DZSgiSUVfUFJPVE8iKSxQbj1mdW5jdGlvbigpe30sQ249ZnVuY3Rpb24oZSl7cmV0dXJuICI8c2NyaXB0PiIrZSsiPC8iKyJzY3JpcHQ+In0sRm49ZnVuY3Rpb24oZSl7ZS53cml0ZShDbigiIikpLGUuY2xvc2UoKTt2YXIgdD1lLnBhcmVudFdpbmRvdy5PYmplY3Q7cmV0dXJuIGU9bnVsbCx0fSxEbj1mdW5jdGlvbigpe3RyeXt3bj1uZXcgQWN0aXZlWE9iamVjdCgiaHRtbGZpbGUiKTt9Y2F0Y2goZSl7fXZhciBlLHQ7RG49InVuZGVmaW5lZCIhPXR5cGVvZiBkb2N1bWVudD9kb2N1bWVudC5kb21haW4mJnduP0ZuKHduKTooKHQ9dGUoImlmcmFtZSIpKS5zdHlsZS5kaXNwbGF5PSJub25lIixObi5hcHBlbmRDaGlsZCh0KSx0LnNyYz1TdHJpbmcoImphdmFzY3JpcHQ6IiksKGU9dC5jb250ZW50V2luZG93LmRvY3VtZW50KS5vcGVuKCksZS53cml0ZShDbigiZG9jdW1lbnQuRj1PYmplY3QiKSksZS5jbG9zZSgpLGUuRik6Rm4od24pO2Zvcih2YXIgbj1LdC5sZW5ndGg7bi0tOylkZWxldGUgRG4ucHJvdG90eXBlW0t0W25dXTtyZXR1cm4gRG4oKX07RmVbTG5dPSEwO3ZhciAkbixNbixCbj1PYmplY3QuY3JlYXRlfHxmdW5jdGlvbihlLHQpe3ZhciBuO3JldHVybiBudWxsIT09ZT8oUG4ucHJvdG90eXBlPWllKGUpLG49bmV3IFBuLFBuLnByb3RvdHlwZT1udWxsLG5bTG5dPWUpOm49RG4oKSx2b2lkIDA9PT10P246Um4obix0KX0sVW49ZC5SZWdFeHAsam49aigoZnVuY3Rpb24oKXt2YXIgZT1VbigiLiIsInMiKTtyZXR1cm4gIShlLmRvdEFsbCYmZS5leGVjKCJcbiIpJiYicyI9PT1lLmZsYWdzKX0pKSx6bj1kLlJlZ0V4cCxHbj1qKChmdW5jdGlvbigpe3ZhciBlPXpuKCIoPzxhPmIpIiwiZyIpO3JldHVybiAiYiIhPT1lLmV4ZWMoImIiKS5ncm91cHMuYXx8ImJjIiE9PSJiIi5yZXBsYWNlKGUsIiQ8YT5jIil9KSksSG49SGUuZ2V0LHFuPWgoIm5hdGl2ZS1zdHJpbmctcmVwbGFjZSIsU3RyaW5nLnByb3RvdHlwZS5yZXBsYWNlKSxZbj1SZWdFeHAucHJvdG90eXBlLmV4ZWMsV249WW4sWG49UygiIi5jaGFyQXQpLFpuPVMoIiIuaW5kZXhPZiksVm49UygiIi5yZXBsYWNlKSxLbj1TKCIiLnNsaWNlKSxKbj0oTW49L2IqL2csb2UoWW4sJG49L2EvLCJhIiksb2UoWW4sTW4sImEiKSwwIT09JG4ubGFzdEluZGV4fHwwIT09TW4ubGFzdEluZGV4KSxRbj1Jbi5CUk9LRU5fQ0FSRVQsZWE9dm9pZCAwIT09LygpPz8vLmV4ZWMoIiIpWzFdOyhKbnx8ZWF8fFFufHxqbnx8R24pJiYoV249ZnVuY3Rpb24oZSl7dmFyIHQsbixhLHIsaSxzLG8sbD10aGlzLHU9SG4obCksYz1BbihlKSxkPXUucmF3O2lmKGQpcmV0dXJuIGQubGFzdEluZGV4PWwubGFzdEluZGV4LHQ9b2UoV24sZCxjKSxsLmxhc3RJbmRleD1kLmxhc3RJbmRleCx0O3ZhciBwPXUuZ3JvdXBzLGc9UW4mJmwuc3RpY2t5LGY9b2UoeG4sbCksYj1sLnNvdXJjZSxoPTAsbT1jO2lmKGcmJihmPVZuKGYsInkiLCIiKSwtMT09PVpuKGYsImciKSYmKGYrPSJnIiksbT1LbihjLGwubGFzdEluZGV4KSxsLmxhc3RJbmRleD4wJiYoIWwubXVsdGlsaW5lfHxsLm11bHRpbGluZSYmIlxuIiE9PVhuKGMsbC5sYXN0SW5kZXgtMSkpJiYoYj0iKD86ICIrYisiKSIsbT0iICIrbSxoKyspLG49bmV3IFJlZ0V4cCgiXig/OiIrYisiKSIsZikpLGVhJiYobj1uZXcgUmVnRXhwKCJeIitiKyIkKD8hXFxzKSIsZikpLEpuJiYoYT1sLmxhc3RJbmRleCkscj1vZShZbixnP246bCxtKSxnP3I/KHIuaW5wdXQ9S24oci5pbnB1dCxoKSxyWzBdPUtuKHJbMF0saCksci5pbmRleD1sLmxhc3RJbmRleCxsLmxhc3RJbmRleCs9clswXS5sZW5ndGgpOmwubGFzdEluZGV4PTA6Sm4mJnImJihsLmxhc3RJbmRleD1sLmdsb2JhbD9yLmluZGV4K3JbMF0ubGVuZ3RoOmEpLGVhJiZyJiZyLmxlbmd0aD4xJiZvZShxbixyWzBdLG4sKGZ1bmN0aW9uKCl7Zm9yKGk9MTtpPGFyZ3VtZW50cy5sZW5ndGgtMjtpKyspdm9pZCAwPT09YXJndW1lbnRzW2ldJiYocltpXT12b2lkIDApO30pKSxyJiZwKWZvcihyLmdyb3Vwcz1zPUJuKG51bGwpLGk9MDtpPHAubGVuZ3RoO2krKylzWyhvPXBbaV0pWzBdXT1yW29bMV1dO3JldHVybiByfSk7dmFyIHRhPVduO2duKHt0YXJnZXQ6IlJlZ0V4cCIscHJvdG86ITAsZm9yY2VkOi8uLy5leGVjIT09dGF9LHtleGVjOnRhfSk7dmFyIG5hPUZ1bmN0aW9uLnByb3RvdHlwZSxhYT1uYS5hcHBseSxyYT1uYS5iaW5kLGlhPW5hLmNhbGwsc2E9Im9iamVjdCI9PXR5cGVvZiBSZWZsZWN0JiZSZWZsZWN0LmFwcGx5fHwocmE/aWEuYmluZChhYSk6ZnVuY3Rpb24oKXtyZXR1cm4gaWEuYXBwbHkoYWEsYXJndW1lbnRzKX0pLG9hPVgoInNwZWNpZXMiKSxsYT1SZWdFeHAucHJvdG90eXBlLHVhPVgoIm1hdGNoIiksY2E9ZC5UeXBlRXJyb3IsZGE9WCgic3BlY2llcyIpLHBhPWZ1bmN0aW9uKGUsdCl7dmFyIG4sYT1pZShlKS5jb25zdHJ1Y3RvcjtyZXR1cm4gdm9pZCAwPT09YXx8bnVsbD09KG49aWUoYSlbZGFdKT90OmZ1bmN0aW9uKGUpe2lmKE90KGUpKXJldHVybiBlO3Rocm93IGNhKHBlKGUpKyIgaXMgbm90IGEgY29uc3RydWN0b3IiKX0obil9LGdhPVMoIiIuY2hhckF0KSxmYT1TKCIiLmNoYXJDb2RlQXQpLGJhPVMoIiIuc2xpY2UpLGhhPWZ1bmN0aW9uKGUpe3JldHVybiBmdW5jdGlvbih0LG4pe3ZhciBhLHIsaT1BbihrKHQpKSxzPWh0KG4pLG89aS5sZW5ndGg7cmV0dXJuIHM8MHx8cz49bz9lPyIiOnZvaWQgMDooYT1mYShpLHMpKTw1NTI5Nnx8YT41NjMxOXx8cysxPT09b3x8KHI9ZmEoaSxzKzEpKTw1NjMyMHx8cj41NzM0Mz9lP2dhKGkscyk6YTplP2JhKGkscyxzKzIpOnItNTYzMjArKGEtNTUyOTY8PDEwKSs2NTUzNn19LG1hPXtjb2RlQXQ6aGEoITEpLGNoYXJBdDpoYSghMCl9LmNoYXJBdCx5YT1mdW5jdGlvbihlLHQsbil7cmV0dXJuIHQrKG4/bWEoZSx0KS5sZW5ndGg6MSl9LEVhPWQuQXJyYXksdmE9TWF0aC5tYXgsU2E9ZnVuY3Rpb24oZSx0LG4pe2Zvcih2YXIgYSxyLGkscyxvPUV0KGUpLGw9WXQodCxvKSx1PVl0KHZvaWQgMD09PW4/bzpuLG8pLGM9RWEodmEodS1sLDApKSxkPTA7bDx1O2wrKyxkKyspYT1jLHI9ZCxpPWVbbF0scz12b2lkIDAsKHM9dmUocikpaW4gYT9rZS5mKGEscyxBZSgwLGkpKTphW3NdPWk7cmV0dXJuIGMubGVuZ3RoPWQsY30sd2E9ZC5UeXBlRXJyb3Isa2E9ZnVuY3Rpb24oZSx0KXt2YXIgbj1lLmV4ZWM7aWYoTChuKSl7dmFyIGE9b2UobixlLHQpO3JldHVybiBudWxsIT09YSYmaWUoYSksYX1pZigiUmVnRXhwIj09PUplKGUpKXJldHVybiBvZSh0YSxlLHQpO3Rocm93IHdhKCJSZWdFeHAjZXhlYyBjYWxsZWQgb24gaW5jb21wYXRpYmxlIHJlY2VpdmVyIil9LEFhPUluLlVOU1VQUE9SVEVEX1kseGE9NDI5NDk2NzI5NSxUYT1NYXRoLm1pbixfYT1bXS5wdXNoLE9hPVMoLy4vLmV4ZWMpLElhPVMoX2EpLFJhPVMoIiIuc2xpY2UpLE5hPSFqKChmdW5jdGlvbigpe3ZhciBlPS8oPzopLyx0PWUuZXhlYztlLmV4ZWM9ZnVuY3Rpb24oKXtyZXR1cm4gdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9O3ZhciBuPSJhYiIuc3BsaXQoZSk7cmV0dXJuIDIhPT1uLmxlbmd0aHx8ImEiIT09blswXXx8ImIiIT09blsxXX0pKTshZnVuY3Rpb24oZSx0LG4sYSl7dmFyIHI9WChlKSxpPSFqKChmdW5jdGlvbigpe3ZhciB0PXt9O3JldHVybiB0W3JdPWZ1bmN0aW9uKCl7cmV0dXJuIDd9LDchPSIiW2VdKHQpfSkpLHM9aSYmIWooKGZ1bmN0aW9uKCl7dmFyIHQ9ITEsbj0vYS87cmV0dXJuICJzcGxpdCI9PT1lJiYoKG49e30pLmNvbnN0cnVjdG9yPXt9LG4uY29uc3RydWN0b3Jbb2FdPWZ1bmN0aW9uKCl7cmV0dXJuIG59LG4uZmxhZ3M9IiIsbltyXT0vLi9bcl0pLG4uZXhlYz1mdW5jdGlvbigpe3JldHVybiB0PSEwLG51bGx9LG5bcl0oIiIpLCF0fSkpO2lmKCFpfHwhc3x8bil7dmFyIG89UygvLi9bcl0pLGw9dChyLCIiW2VdLChmdW5jdGlvbihlLHQsbixhLHIpe3ZhciBzPVMoZSksbD10LmV4ZWM7cmV0dXJuIGw9PT10YXx8bD09PWxhLmV4ZWM/aSYmIXI/e2RvbmU6ITAsdmFsdWU6byh0LG4sYSl9Ontkb25lOiEwLHZhbHVlOnMobix0LGEpfTp7ZG9uZTohMX19KSk7WmUoU3RyaW5nLnByb3RvdHlwZSxlLGxbMF0pLFplKGxhLHIsbFsxXSk7fWEmJnhlKGxhW3JdLCJzaGFtIiwhMCk7fSgic3BsaXQiLChmdW5jdGlvbihlLHQsbil7dmFyIGE7cmV0dXJuIGE9ImMiPT0iYWJiYyIuc3BsaXQoLyhiKSovKVsxXXx8NCE9InRlc3QiLnNwbGl0KC8oPzopLywtMSkubGVuZ3RofHwyIT0iYWIiLnNwbGl0KC8oPzphYikqLykubGVuZ3RofHw0IT0iLiIuc3BsaXQoLyguPykoLj8pLykubGVuZ3RofHwiLiIuc3BsaXQoLygpKCkvKS5sZW5ndGg+MXx8IiIuc3BsaXQoLy4/LykubGVuZ3RoP2Z1bmN0aW9uKGUsbil7dmFyIGEscixpPUFuKGsodGhpcykpLHM9dm9pZCAwPT09bj94YTpuPj4+MDtpZigwPT09cylyZXR1cm4gW107aWYodm9pZCAwPT09ZSlyZXR1cm4gW2ldO2lmKCFKKGE9ZSl8fCEodm9pZCAwIT09KHI9YVt1YV0pP3I6IlJlZ0V4cCI9PUplKGEpKSlyZXR1cm4gb2UodCxpLGUscyk7Zm9yKHZhciBvLGwsdSxjPVtdLGQ9KGUuaWdub3JlQ2FzZT8iaSI6IiIpKyhlLm11bHRpbGluZT8ibSI6IiIpKyhlLnVuaWNvZGU/InUiOiIiKSsoZS5zdGlja3k/InkiOiIiKSxwPTAsZz1uZXcgUmVnRXhwKGUuc291cmNlLGQrImciKTsobz1vZSh0YSxnLGkpKSYmISgobD1nLmxhc3RJbmRleCk+cCYmKElhKGMsUmEoaSxwLG8uaW5kZXgpKSxvLmxlbmd0aD4xJiZvLmluZGV4PGkubGVuZ3RoJiZzYShfYSxjLFNhKG8sMSkpLHU9b1swXS5sZW5ndGgscD1sLGMubGVuZ3RoPj1zKSk7KWcubGFzdEluZGV4PT09by5pbmRleCYmZy5sYXN0SW5kZXgrKztyZXR1cm4gcD09PWkubGVuZ3RoPyF1JiZPYShnLCIiKXx8SWEoYywiIik6SWEoYyxSYShpLHApKSxjLmxlbmd0aD5zP1NhKGMsMCxzKTpjfToiMCIuc3BsaXQodm9pZCAwLDApLmxlbmd0aD9mdW5jdGlvbihlLG4pe3JldHVybiB2b2lkIDA9PT1lJiYwPT09bj9bXTpvZSh0LHRoaXMsZSxuKX06dCxbZnVuY3Rpb24odCxuKXt2YXIgcj1rKHRoaXMpLGk9bnVsbD09dD92b2lkIDA6YmUodCxlKTtyZXR1cm4gaT9vZShpLHQscixuKTpvZShhLEFuKHIpLHQsbil9LGZ1bmN0aW9uKGUscil7dmFyIGk9aWUodGhpcykscz1BbihlKSxvPW4oYSxpLHMscixhIT09dCk7aWYoby5kb25lKXJldHVybiBvLnZhbHVlO3ZhciBsPXBhKGksUmVnRXhwKSx1PWkudW5pY29kZSxjPShpLmlnbm9yZUNhc2U/ImkiOiIiKSsoaS5tdWx0aWxpbmU/Im0iOiIiKSsoaS51bmljb2RlPyJ1IjoiIikrKEFhPyJnIjoieSIpLGQ9bmV3IGwoQWE/Il4oPzoiK2kuc291cmNlKyIpIjppLGMpLHA9dm9pZCAwPT09cj94YTpyPj4+MDtpZigwPT09cClyZXR1cm4gW107aWYoMD09PXMubGVuZ3RoKXJldHVybiBudWxsPT09a2EoZCxzKT9bc106W107Zm9yKHZhciBnPTAsZj0wLGI9W107ZjxzLmxlbmd0aDspe2QubGFzdEluZGV4PUFhPzA6Zjt2YXIgaCxtPWthKGQsQWE/UmEocyxmKTpzKTtpZihudWxsPT09bXx8KGg9VGEoeXQoZC5sYXN0SW5kZXgrKEFhP2Y6MCkpLHMubGVuZ3RoKSk9PT1nKWY9eWEocyxmLHUpO2Vsc2Uge2lmKElhKGIsUmEocyxnLGYpKSxiLmxlbmd0aD09PXApcmV0dXJuIGI7Zm9yKHZhciB5PTE7eTw9bS5sZW5ndGgtMTt5KyspaWYoSWEoYixtW3ldKSxiLmxlbmd0aD09PXApcmV0dXJuIGI7Zj1nPWg7fX1yZXR1cm4gSWEoYixSYShzLGcpKSxifV19KSwhTmEsQWEpLGduKHtnbG9iYWw6ITB9LHtnbG9iYWxUaGlzOmR9KSxuLmF0dHImJihpLmRlZmF1bHQuZm4uYXR0cj1uLmF0dHIpO3ZhciBMYT1YZS5QUk9QRVIsUGE9InRvU3RyaW5nIixDYT1SZWdFeHAucHJvdG90eXBlLEZhPUNhLnRvU3RyaW5nLERhPVMoeG4pLCRhPWooKGZ1bmN0aW9uKCl7cmV0dXJuICIvYS9iIiE9RmEuY2FsbCh7c291cmNlOiJhIixmbGFnczoiYiJ9KX0pKSxNYT1MYSYmRmEubmFtZSE9UGE7KCRhfHxNYSkmJlplKFJlZ0V4cC5wcm90b3R5cGUsUGEsKGZ1bmN0aW9uKCl7dmFyIGU9aWUodGhpcyksdD1BbihlLnNvdXJjZSksbj1lLmZsYWdzO3JldHVybiAiLyIrdCsiLyIrQW4odm9pZCAwPT09biYmbGUoQ2EsZSkmJiEoImZsYWdzImluIENhKT9EYShlKTpuKX0pLHt1bnNhZmU6ITB9KTt2YXIgQmE9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKCl7dGhpcy50aXRsZT10LnQoImhpZ2hMaWdodE1vZHVsZS5zZWxlY3RMYW5nIiksdGhpcy5pY29uU3ZnPSc8c3ZnIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik02NCA2NHY4OTZoODk2VjY0SDY0eiBtNDg3LjYgNjk4LjhjMCA4Ny4yLTUxLjIgMTI3LTEyNS44IDEyNy02Ny40IDAtMTA2LjQtMzQuOC0xMjYuNC03N2w2OC42LTQxLjRjMTMuMiAyMy40IDI1LjIgNDMuMiA1NC4yIDQzLjIgMjcuNiAwIDQ1LjItMTAuOCA0NS4yLTUzVjQ3NS40aDg0LjJ2Mjg3LjR6IG0xOTkuMiAxMjdjLTc4LjIgMC0xMjguOC0zNy4yLTE1My40LTg2bDY4LjYtMzkuNmMxOCAyOS40IDQxLjYgNTEuMiA4MyA1MS4yIDM0LjggMCA1Ny4yLTE3LjQgNTcuMi00MS42IDAtMjguOC0yMi44LTM5LTYxLjQtNTZsLTIxLTljLTYwLjgtMjUuOC0xMDEtNTguNC0xMDEtMTI3IDAtNjMuMiA0OC4yLTExMS4yIDEyMy4yLTExMS4yIDUzLjYgMCA5MiAxOC42IDExOS42IDY3LjRMODAwIDU4MGMtMTQuNC0yNS44LTMwLTM2LTU0LjItMzYtMjQuNiAwLTQwLjIgMTUuNi00MC4yIDM2IDAgMjUuMiAxNS42IDM1LjQgNTEuOCA1MS4ybDIxIDljNzEuNiAzMC42IDExMS44IDYyIDExMS44IDEzMi40IDAgNzUuNi01OS42IDExNy4yLTEzOS40IDExNy4yeiI+PC9wYXRoPjwvc3ZnPicsdGhpcy50YWc9InNlbGVjdCIsdGhpcy53aWR0aD05NSx0aGlzLnNlbGVjdFBhbmVsV2lkdGg9MTE1O31yZXR1cm4gZS5wcm90b3R5cGUuZ2V0T3B0aW9ucz1mdW5jdGlvbihlKXt2YXIgdD1bXSxuPWUuZ2V0TWVudUNvbmZpZygiY29kZVNlbGVjdExhbmciKS5jb2RlTGFuZ3MsYT12b2lkIDA9PT1uP1tdOm47dC5wdXNoKHt0ZXh0OiJwbGFpbiB0ZXh0Iix2YWx1ZToiIn0pLGEuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dmFyIG49ZS50ZXh0LGE9ZS52YWx1ZTt0LnB1c2goe3RleHQ6bix2YWx1ZTphfSk7fSkpO3ZhciByPXRoaXMuZ2V0VmFsdWUoZSk7cmV0dXJuIHQuZm9yRWFjaCgoZnVuY3Rpb24oZSl7ZS52YWx1ZT09PXI/ZS5zZWxlY3RlZD0hMDpkZWxldGUgZS5zZWxlY3RlZDt9KSksdH0sZS5wcm90b3R5cGUuaXNBY3RpdmU9ZnVuY3Rpb24oZSl7cmV0dXJuICExfSxlLnByb3RvdHlwZS5nZXRWYWx1ZT1mdW5jdGlvbihlKXt2YXIgdD10aGlzLmdldFNlbGVjdENvZGVFbGVtKGUpO2lmKG51bGw9PXQpcmV0dXJuICIiO2lmKCFhLkVsZW1lbnQuaXNFbGVtZW50KHQpKXJldHVybiAiIjt2YXIgbj10Lmxhbmd1YWdlLnRvU3RyaW5nKCkscj1lLmdldE1lbnVDb25maWcoImNvZGVTZWxlY3RMYW5nIikuY29kZUxhbmdzO3JldHVybiAodm9pZCAwPT09cj9bXTpyKS5zb21lKChmdW5jdGlvbihlKXtyZXR1cm4gZS52YWx1ZT09PW59KSk/bjoiIn0sZS5wcm90b3R5cGUuaXNEaXNhYmxlZD1mdW5jdGlvbihlKXtyZXR1cm4gbnVsbD09ZS5zZWxlY3Rpb258fCF0aGlzLmdldFNlbGVjdENvZGVFbGVtKGUpfSxlLnByb3RvdHlwZS5leGVjPWZ1bmN0aW9uKGUsbil7aWYobnVsbCE9dGhpcy5nZXRTZWxlY3RDb2RlRWxlbShlKSl7dmFyIHI9e2xhbmd1YWdlOm4udG9TdHJpbmcoKX07YS5UcmFuc2Zvcm1zLnNldE5vZGVzKGUscix7bWF0Y2g6ZnVuY3Rpb24oZSl7cmV0dXJuIHQuRG9tRWRpdG9yLmNoZWNrTm9kZVR5cGUoZSwiY29kZSIpfX0pO319LGUucHJvdG90eXBlLmdldFNlbGVjdENvZGVFbGVtPWZ1bmN0aW9uKGUpe3ZhciBuPXQuRG9tRWRpdG9yLmdldFNlbGVjdGVkTm9kZUJ5VHlwZShlLCJjb2RlIik7aWYobnVsbD09bilyZXR1cm4gbnVsbDt2YXIgcj10LkRvbUVkaXRvci5nZXRQYXJlbnROb2RlKGUsbik7cmV0dXJuIGEuRWxlbWVudC5pc0VsZW1lbnQocik/InByZSIhPT1yLnR5cGU/bnVsbDpuOm51bGx9LGV9KCk7dmFyIFVhPXtyZW5kZXJTdHlsZTpmdW5jdGlvbihlLHQpe3ZhciBuPWUsYT10LHI9IiI7cmV0dXJuIHZuLmZvckVhY2goKGZ1bmN0aW9uKGUpe25bZV0mJihyPWUpO30pKSxyJiZmdW5jdGlvbihlLHQpe251bGw9PWUuZGF0YSYmKGUuZGF0YT17fSk7dmFyIG49ZS5kYXRhO251bGw9PW4ucHJvcHMmJihuLnByb3BzPXt9KSxPYmplY3QuYXNzaWduKG4ucHJvcHMse2NsYXNzTmFtZTp0fSk7fShhLHI9InRva2VuICIrciksYX0scGFyc2VTdHlsZUh0bWw6ZnVuY3Rpb24oZSxuLHIpe3ZhciBzPWkuZGVmYXVsdChlKTtpZighYS5FbGVtZW50LmlzRWxlbWVudChuKSlyZXR1cm4gbjtpZigiY29kZSIhPT10LkRvbUVkaXRvci5nZXROb2RlVHlwZShuKSlyZXR1cm4gbjt2YXIgbz1uLGw9cy5hdHRyKCJjbGFzcyIpfHwiIjtyZXR1cm4gMD09PWwuaW5kZXhPZigibGFuZ3VhZ2UtIik/by5sYW5ndWFnZT1sLnNwbGl0KCItIilbMV18fCIiOm8ubGFuZ3VhZ2U9bC50b0xvd2VyQ2FzZSgpLG99LG1lbnVzOlt7a2V5OiJjb2RlU2VsZWN0TGFuZyIsZmFjdG9yeTpmdW5jdGlvbigpe3JldHVybiBuZXcgQmF9LGNvbmZpZzp7Y29kZUxhbmdzOlt7dGV4dDoiQ1NTIix2YWx1ZToiY3NzIn0se3RleHQ6IkhUTUwiLHZhbHVlOiJodG1sIn0se3RleHQ6IlhNTCIsdmFsdWU6InhtbCJ9LHt0ZXh0OiJKYXZhc2NyaXB0Iix2YWx1ZToiamF2YXNjcmlwdCJ9LHt0ZXh0OiJUeXBlc2NyaXB0Iix2YWx1ZToidHlwZXNjcmlwdCJ9LHt0ZXh0OiJKU1giLHZhbHVlOiJqc3gifSx7dGV4dDoiR28iLHZhbHVlOiJnbyJ9LHt0ZXh0OiJQSFAiLHZhbHVlOiJwaHAifSx7dGV4dDoiQyIsdmFsdWU6ImMifSx7dGV4dDoiUHl0aG9uIix2YWx1ZToicHl0aG9uIn0se3RleHQ6IkphdmEiLHZhbHVlOiJqYXZhIn0se3RleHQ6IkMrKyIsdmFsdWU6ImNwcCJ9LHt0ZXh0OiJDIyIsdmFsdWU6ImNzaGFycCJ9LHt0ZXh0OiJWaXN1YWwgQmFzaWMiLHZhbHVlOiJ2aXN1YWwtYmFzaWMifSx7dGV4dDoiU1FMIix2YWx1ZToic3FsIn0se3RleHQ6IlJ1YnkiLHZhbHVlOiJydWJ5In0se3RleHQ6IlN3aWZ0Iix2YWx1ZToic3dpZnQifSx7dGV4dDoiQmFzaCIsdmFsdWU6ImJhc2gifSx7dGV4dDoiTHVhIix2YWx1ZToibHVhIn0se3RleHQ6Ikdyb292eSIsdmFsdWU6Imdyb292eSJ9LHt0ZXh0OiJNYXJrZG93biIsdmFsdWU6Im1hcmtkb3duIn1dfX1dLGVsZW1zVG9IdG1sOlt7dHlwZToiY29kZSIsZWxlbVRvSHRtbDpmdW5jdGlvbihlLHQpe3ZhciBuPWUubGFuZ3VhZ2UsYT12b2lkIDA9PT1uPyIiOm47cmV0dXJuICI8Y29kZSAiKyhhPydjbGFzcz0ibGFuZ3VhZ2UtJythKyciJzoiIikrIj4iK3QrIjwvY29kZT4ifX1dfSxqYT0vIi9nLHphPVMoIiIucmVwbGFjZSk7Z24oe3RhcmdldDoiU3RyaW5nIixwcm90bzohMCxmb3JjZWQ6ZnVuY3Rpb24oZSl7cmV0dXJuIGooKGZ1bmN0aW9uKCl7dmFyIHQ9IiJbZV0oJyInKTtyZXR1cm4gdCE9PXQudG9Mb3dlckNhc2UoKXx8dC5zcGxpdCgnIicpLmxlbmd0aD4zfSkpfSgiYW5jaG9yIil9LHthbmNob3I6ZnVuY3Rpb24oZSl7cmV0dXJuIHQ9ImEiLG49Im5hbWUiLGE9ZSxyPUFuKGsodGhpcykpLGk9IjwiK3QsIiIhPT1uJiYoaSs9IiAiK24rJz0iJyt6YShBbihhKSxqYSwiJnF1b3Q7IikrJyInKSxpKyI+IityKyI8LyIrdCsiPiI7dmFyIHQsbixhLHIsaTt9fSk7ZS53YW5nRWRpdG9yQ29kZUhpZ2hMaWdodERlY29yYXRlPWZ1bmN0aW9uKGUpe3ZhciBuLHIsaSxzPWZ1bmN0aW9uKGUsdCl7dmFyIG49ImZ1bmN0aW9uIj09dHlwZW9mIFN5bWJvbCYmZVtTeW1ib2wuaXRlcmF0b3JdO2lmKCFuKXJldHVybiBlO3ZhciBhLHIsaT1uLmNhbGwoZSkscz1bXTt0cnl7Zm9yKDsodm9pZCAwPT09dHx8dC0tID4wKSYmIShhPWkubmV4dCgpKS5kb25lOylzLnB1c2goYS52YWx1ZSk7fWNhdGNoKGUpe3I9e2Vycm9yOmV9O31maW5hbGx5e3RyeXthJiYhYS5kb25lJiYobj1pLnJldHVybikmJm4uY2FsbChpKTt9ZmluYWxseXtpZihyKXRocm93IHIuZXJyb3J9fXJldHVybiBzfShlLDIpLG89c1swXSxsPXNbMV0sdT1bXSxjPWZ1bmN0aW9uKGUpe2lmKCFhLlRleHQuaXNUZXh0KGUpKXJldHVybiBudWxsO3ZhciBuPXQuRG9tRWRpdG9yLmdldFBhcmVudE5vZGUobnVsbCxlKTtpZihuJiYiY29kZSI9PT10LkRvbUVkaXRvci5nZXROb2RlVHlwZShuKSl7dmFyIHI9dC5Eb21FZGl0b3IuZ2V0UGFyZW50Tm9kZShudWxsLG4pO2lmKHImJiJwcmUiPT09dC5Eb21FZGl0b3IuZ2V0Tm9kZVR5cGUocikpcmV0dXJuIG59cmV0dXJuIG51bGx9KG8pO2lmKG51bGw9PWMpcmV0dXJuIHU7dmFyIGQ9Yy5sYW5ndWFnZSxwPXZvaWQgMD09PWQ/IiI6ZDtpZighcClyZXR1cm4gdTt2YXIgZz1mdW5jdGlvbihlLHQpe2lmKCF0KXJldHVybiBbXTt2YXIgbj1Fbi5sYW5ndWFnZXNbdF07cmV0dXJuIG4/RW4udG9rZW5pemUoZS50ZXh0LG4pOltdfShvLHApLGY9MDt0cnl7Zm9yKHZhciBiPQogIC8qISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uCgogICAgUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55CiAgICBwdXJwb3NlIHdpdGggb3Igd2l0aG91dCBmZWUgaXMgaGVyZWJ5IGdyYW50ZWQuCgogICAgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEgKICAgIFJFR0FSRCBUTyBUSElTIFNPRlRXQVJFIElOQ0xVRElORyBBTEwgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWQogICAgQU5EIEZJVE5FU1MuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1IgQkUgTElBQkxFIEZPUiBBTlkgU1BFQ0lBTCwgRElSRUNULAogICAgSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NCiAgICBMT1NTIE9GIFVTRSwgREFUQSBPUiBQUk9GSVRTLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgTkVHTElHRU5DRSBPUgogICAgT1RIRVIgVE9SVElPVVMgQUNUSU9OLCBBUklTSU5HIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFVTRSBPUgogICAgUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS4KICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovCiAgZnVuY3Rpb24oZSl7dmFyIHQ9ImZ1bmN0aW9uIj09dHlwZW9mIFN5bWJvbCYmU3ltYm9sLml0ZXJhdG9yLG49dCYmZVt0XSxhPTA7aWYobilyZXR1cm4gbi5jYWxsKGUpO2lmKGUmJiJudW1iZXIiPT10eXBlb2YgZS5sZW5ndGgpcmV0dXJuIHtuZXh0OmZ1bmN0aW9uKCl7cmV0dXJuIGUmJmE+PWUubGVuZ3RoJiYoZT12b2lkIDApLHt2YWx1ZTplJiZlW2ErK10sZG9uZTohZX19fTt0aHJvdyBuZXcgVHlwZUVycm9yKHQ/Ik9iamVjdCBpcyBub3QgaXRlcmFibGUuIjoiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLiIpfShnKSxoPWIubmV4dCgpOyFoLmRvbmU7aD1iLm5leHQoKSl7dmFyIG09aC52YWx1ZSx5PWYrU24obSk7InN0cmluZyIhPXR5cGVvZiBtJiZ1LnB1c2goKChpPXt9KVttLnR5cGVdPSEwLGkuYW5jaG9yPXtwYXRoOmwsb2Zmc2V0OmZ9LGkuZm9jdXM9e3BhdGg6bCxvZmZzZXQ6eX0saSkpLGY9eTt9fWNhdGNoKGUpe249e2Vycm9yOmV9O31maW5hbGx5e3RyeXtoJiYhaC5kb25lJiYocj1iLnJldHVybikmJnIuY2FsbChiKTt9ZmluYWxseXtpZihuKXRocm93IG4uZXJyb3J9fXJldHVybiB1fSxlLndhbmdFZGl0b3JDb2RlSGlnaGxpZ2h0TW9kdWxlPVVhLE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KTt9KSk7CgogIH0pOwoKICAvKiEgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4KCiAgUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55CiAgcHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLgoKICBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiBBTkQgVEhFIEFVVEhPUiBESVNDTEFJTVMgQUxMIFdBUlJBTlRJRVMgV0lUSAogIFJFR0FSRCBUTyBUSElTIFNPRlRXQVJFIElOQ0xVRElORyBBTEwgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWQogIEFORCBGSVRORVNTLiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SIEJFIExJQUJMRSBGT1IgQU5ZIFNQRUNJQUwsIERJUkVDVCwKICBJTkRJUkVDVCwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIE9SIEFOWSBEQU1BR0VTIFdIQVRTT0VWRVIgUkVTVUxUSU5HIEZST00KICBMT1NTIE9GIFVTRSwgREFUQSBPUiBQUk9GSVRTLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgTkVHTElHRU5DRSBPUgogIE9USEVSIFRPUlRJT1VTIEFDVElPTiwgQVJJU0lORyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBVU0UgT1IKICBQRVJGT1JNQU5DRSBPRiBUSElTIFNPRlRXQVJFLgogICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovCgogIHZhciBfX2Fzc2lnbiA9IGZ1bmN0aW9uKCkgewogICAgICBfX2Fzc2lnbiA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gX19hc3NpZ24odCkgewogICAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTsKICAgICAgICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpIHRbcF0gPSBzW3BdOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHQ7CiAgICAgIH07CiAgICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07CgogIC8qKgogICAqIEBkZXNjcmlwdGlvbiBFZGl0b3IgVmlldyBjbGFzcwogICAqIEBhdXRob3Igd2FuZ2Z1cGVuZwogICAqLwogIHZhciBCb290ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBCb290KCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfkuI3og73lrp7kvovljJZcbkNhbiBub3QgY29uc3RydWN0IGEgaW5zdGFuY2UnKTsKICAgICAgfQogICAgICBCb290LnNldEVkaXRvckNvbmZpZyA9IGZ1bmN0aW9uIChuZXdDb25maWcpIHsKICAgICAgICAgIGlmIChuZXdDb25maWcgPT09IHZvaWQgMCkgeyBuZXdDb25maWcgPSB7fTsgfQogICAgICAgICAgdGhpcy5lZGl0b3JDb25maWcgPSBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgdGhpcy5lZGl0b3JDb25maWcpLCBuZXdDb25maWcpOwogICAgICB9OwogICAgICBCb290LnNldFNpbXBsZUVkaXRvckNvbmZpZyA9IGZ1bmN0aW9uIChuZXdDb25maWcpIHsKICAgICAgICAgIGlmIChuZXdDb25maWcgPT09IHZvaWQgMCkgeyBuZXdDb25maWcgPSB7fTsgfQogICAgICAgICAgdGhpcy5zaW1wbGVFZGl0b3JDb25maWcgPSBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgdGhpcy5zaW1wbGVFZGl0b3JDb25maWcpLCBuZXdDb25maWcpOwogICAgICB9OwogICAgICBCb290LnNldFRvb2xiYXJDb25maWcgPSBmdW5jdGlvbiAobmV3Q29uZmlnKSB7CiAgICAgICAgICBpZiAobmV3Q29uZmlnID09PSB2b2lkIDApIHsgbmV3Q29uZmlnID0ge307IH0KICAgICAgICAgIHRoaXMudG9vbGJhckNvbmZpZyA9IF9fYXNzaWduKF9fYXNzaWduKHt9LCB0aGlzLnRvb2xiYXJDb25maWcpLCBuZXdDb25maWcpOwogICAgICB9OwogICAgICBCb290LnNldFNpbXBsZVRvb2xiYXJDb25maWcgPSBmdW5jdGlvbiAobmV3Q29uZmlnKSB7CiAgICAgICAgICBpZiAobmV3Q29uZmlnID09PSB2b2lkIDApIHsgbmV3Q29uZmlnID0ge307IH0KICAgICAgICAgIHRoaXMuc2ltcGxlVG9vbGJhckNvbmZpZyA9IF9fYXNzaWduKF9fYXNzaWduKHt9LCB0aGlzLnNpbXBsZVRvb2xiYXJDb25maWcpLCBuZXdDb25maWcpOwogICAgICB9OwogICAgICBCb290LnJlZ2lzdGVyUGx1Z2luID0gZnVuY3Rpb24gKHBsdWdpbikgewogICAgICAgICAgdGhpcy5wbHVnaW5zLnB1c2gocGx1Z2luKTsKICAgICAgfTsKICAgICAgLy8g5rOo5YaMIG1lbnUKICAgICAgLy8gVE9ETyDlj6/lnKjms6jlhozml7bkvKDlhaXphY3nva7vvIzlnKjlvIDlj5HmlofmoaPkuK3or7TmmI4KICAgICAgQm9vdC5yZWdpc3Rlck1lbnUgPSBmdW5jdGlvbiAobWVudUNvbmYsIGN1c3RvbUNvbmZpZykgewogICAgICAgICAgZGlzdCQ2LnJlZ2lzdGVyTWVudShtZW51Q29uZiwgY3VzdG9tQ29uZmlnKTsKICAgICAgfTsKICAgICAgLy8g5rOo5YaMIHJlbmRlckVsZW0KICAgICAgQm9vdC5yZWdpc3RlclJlbmRlckVsZW0gPSBmdW5jdGlvbiAocmVuZGVyRWxlbUNvbmYpIHsKICAgICAgICAgIGRpc3QkNi5yZWdpc3RlclJlbmRlckVsZW1Db25mKHJlbmRlckVsZW1Db25mKTsKICAgICAgfTsKICAgICAgLy8g5rOo5YaMIHJlbmRlclN0eWxlCiAgICAgIEJvb3QucmVnaXN0ZXJSZW5kZXJTdHlsZSA9IGZ1bmN0aW9uIChmbikgewogICAgICAgICAgZGlzdCQ2LnJlZ2lzdGVyU3R5bGVIYW5kbGVyKGZuKTsKICAgICAgfTsKICAgICAgLy8g5rOo5YaMIGVsZW1Ub0h0bWwKICAgICAgQm9vdC5yZWdpc3RlckVsZW1Ub0h0bWwgPSBmdW5jdGlvbiAoZWxlbVRvSHRtbENvbmYpIHsKICAgICAgICAgIGRpc3QkNi5yZWdpc3RlckVsZW1Ub0h0bWxDb25mKGVsZW1Ub0h0bWxDb25mKTsKICAgICAgfTsKICAgICAgLy8g5rOo5YaMIHN0eWxlVG9IdG1sCiAgICAgIEJvb3QucmVnaXN0ZXJTdHlsZVRvSHRtbCA9IGZ1bmN0aW9uIChmbikgewogICAgICAgICAgZGlzdCQ2LnJlZ2lzdGVyU3R5bGVUb0h0bWxIYW5kbGVyKGZuKTsKICAgICAgfTsKICAgICAgLy8g5rOo5YaMIHByZVBhcnNlSHRtbAogICAgICBCb290LnJlZ2lzdGVyUHJlUGFyc2VIdG1sID0gZnVuY3Rpb24gKHByZVBhcnNlSHRtbENvbmYpIHsKICAgICAgICAgIGRpc3QkNi5yZWdpc3RlclByZVBhcnNlSHRtbENvbmYocHJlUGFyc2VIdG1sQ29uZik7CiAgICAgIH07CiAgICAgIC8vIOazqOWGjCBwYXJzZUVsZW1IdG1sCiAgICAgIEJvb3QucmVnaXN0ZXJQYXJzZUVsZW1IdG1sID0gZnVuY3Rpb24gKHBhcnNlRWxlbUh0bWxDb25mKSB7CiAgICAgICAgICBkaXN0JDYucmVnaXN0ZXJQYXJzZUVsZW1IdG1sQ29uZihwYXJzZUVsZW1IdG1sQ29uZik7CiAgICAgIH07CiAgICAgIC8vIOazqOWGjCBwYXJzZVN0eWxlSHRtbAogICAgICBCb290LnJlZ2lzdGVyUGFyc2VTdHlsZUh0bWwgPSBmdW5jdGlvbiAoZm4pIHsKICAgICAgICAgIGRpc3QkNi5yZWdpc3RlclBhcnNlU3R5bGVIdG1sSGFuZGxlcihmbik7CiAgICAgIH07CiAgICAgIC8vIOazqOWGjCBtb2R1bGUKICAgICAgQm9vdC5yZWdpc3Rlck1vZHVsZSA9IGZ1bmN0aW9uIChtb2R1bGUpIHsKICAgICAgICAgIHJlZ2lzdGVyTW9kdWxlKG1vZHVsZSk7CiAgICAgIH07CiAgICAgIC8vIGVkaXRvciDphY3nva4KICAgICAgQm9vdC5lZGl0b3JDb25maWcgPSB7fTsKICAgICAgQm9vdC5zaW1wbGVFZGl0b3JDb25maWcgPSB7fTsKICAgICAgLy90b29sYmFyIOmFjee9rgogICAgICBCb290LnRvb2xiYXJDb25maWcgPSB7fTsKICAgICAgQm9vdC5zaW1wbGVUb29sYmFyQ29uZmlnID0ge307CiAgICAgIC8vIOazqOWGjOaPkuS7tgogICAgICBCb290LnBsdWdpbnMgPSBbXTsKICAgICAgcmV0dXJuIEJvb3Q7CiAgfSgpKTsKCiAgLyoqCiAgICogQGRlc2NyaXB0aW9uIOazqOWGjCBtb2R1bGUKICAgKiBAYXV0aG9yIHdhbmdmdXBlbmcKICAgKi8KICBmdW5jdGlvbiByZWdpc3Rlck1vZHVsZShtb2R1bGUpIHsKICAgICAgdmFyIG1lbnVzID0gbW9kdWxlLm1lbnVzLCByZW5kZXJFbGVtcyA9IG1vZHVsZS5yZW5kZXJFbGVtcywgcmVuZGVyU3R5bGUgPSBtb2R1bGUucmVuZGVyU3R5bGUsIGVsZW1zVG9IdG1sID0gbW9kdWxlLmVsZW1zVG9IdG1sLCBzdHlsZVRvSHRtbCA9IG1vZHVsZS5zdHlsZVRvSHRtbCwgcHJlUGFyc2VIdG1sID0gbW9kdWxlLnByZVBhcnNlSHRtbCwgcGFyc2VFbGVtc0h0bWwgPSBtb2R1bGUucGFyc2VFbGVtc0h0bWwsIHBhcnNlU3R5bGVIdG1sID0gbW9kdWxlLnBhcnNlU3R5bGVIdG1sLCBlZGl0b3JQbHVnaW4gPSBtb2R1bGUuZWRpdG9yUGx1Z2luOwogICAgICBpZiAobWVudXMpIHsKICAgICAgICAgIG1lbnVzLmZvckVhY2goZnVuY3Rpb24gKG1lbnUpIHsgcmV0dXJuIEJvb3QucmVnaXN0ZXJNZW51KG1lbnUpOyB9KTsKICAgICAgfQogICAgICBpZiAocmVuZGVyRWxlbXMpIHsKICAgICAgICAgIHJlbmRlckVsZW1zLmZvckVhY2goZnVuY3Rpb24gKHJlbmRlckVsZW1Db25mKSB7IHJldHVybiBCb290LnJlZ2lzdGVyUmVuZGVyRWxlbShyZW5kZXJFbGVtQ29uZik7IH0pOwogICAgICB9CiAgICAgIGlmIChyZW5kZXJTdHlsZSkgewogICAgICAgICAgQm9vdC5yZWdpc3RlclJlbmRlclN0eWxlKHJlbmRlclN0eWxlKTsKICAgICAgfQogICAgICBpZiAoZWxlbXNUb0h0bWwpIHsKICAgICAgICAgIGVsZW1zVG9IdG1sLmZvckVhY2goZnVuY3Rpb24gKGVsZW1Ub0h0bWxDb25mKSB7IHJldHVybiBCb290LnJlZ2lzdGVyRWxlbVRvSHRtbChlbGVtVG9IdG1sQ29uZik7IH0pOwogICAgICB9CiAgICAgIGlmIChzdHlsZVRvSHRtbCkgewogICAgICAgICAgQm9vdC5yZWdpc3RlclN0eWxlVG9IdG1sKHN0eWxlVG9IdG1sKTsKICAgICAgfQogICAgICBpZiAocHJlUGFyc2VIdG1sKSB7CiAgICAgICAgICBwcmVQYXJzZUh0bWwuZm9yRWFjaChmdW5jdGlvbiAoY29uZikgeyByZXR1cm4gQm9vdC5yZWdpc3RlclByZVBhcnNlSHRtbChjb25mKTsgfSk7CiAgICAgIH0KICAgICAgaWYgKHBhcnNlRWxlbXNIdG1sKSB7CiAgICAgICAgICBwYXJzZUVsZW1zSHRtbC5mb3JFYWNoKGZ1bmN0aW9uIChwYXJzZUVsZW1IdG1sQ29uZikgeyByZXR1cm4gQm9vdC5yZWdpc3RlclBhcnNlRWxlbUh0bWwocGFyc2VFbGVtSHRtbENvbmYpOyB9KTsKICAgICAgfQogICAgICBpZiAocGFyc2VTdHlsZUh0bWwpIHsKICAgICAgICAgIEJvb3QucmVnaXN0ZXJQYXJzZVN0eWxlSHRtbChwYXJzZVN0eWxlSHRtbCk7CiAgICAgIH0KICAgICAgaWYgKGVkaXRvclBsdWdpbikgewogICAgICAgICAgQm9vdC5yZWdpc3RlclBsdWdpbihlZGl0b3JQbHVnaW4pOwogICAgICB9CiAgfQoKICAvKioKICAgKiBAZGVzY3JpcHRpb24gcmVnaXN0ZXIgYnVpbHRpbiBtb2R1bGVzCiAgICogQGF1dGhvciB3YW5nZnVwZW5nCiAgICovCiAgYmFzaWNNb2R1bGVzLmZvckVhY2goZnVuY3Rpb24gKG1vZHVsZSkgeyByZXR1cm4gcmVnaXN0ZXJNb2R1bGUobW9kdWxlKTsgfSk7CiAgcmVnaXN0ZXJNb2R1bGUoZGlzdCQ0KTsKICByZWdpc3Rlck1vZHVsZShkaXN0JDMpOwogIHJlZ2lzdGVyTW9kdWxlKGRpc3QkMik7CiAgcmVnaXN0ZXJNb2R1bGUoZGlzdCQxKTsKICByZWdpc3Rlck1vZHVsZShkaXN0LndhbmdFZGl0b3JDb2RlSGlnaGxpZ2h0TW9kdWxlKTsKCiAgLyoqCiAgICogQGRlc2NyaXB0aW9uIHN2ZyB0YWcKICAgKiBAYXV0aG9yIHdhbmdmdXBlbmcKICAgKi8KICAvKioKICAgKiDjgJDms6jmhI/jgJFzdmcg5a2X56ym5Liy55qE6ZW/5bqmIO+8jOWQpuWImeS8muWvvOiHtOS7o+eggeS9k+enr+i/h+WkpwogICAqIOWwvemHj+mAieaLqSBodHRwczovL3d3dy5pY29uZm9udC5jbi9jb2xsZWN0aW9ucy9kZXRhaWw/c3BtPWEzMTN4Ljc3ODEwNjkuMC5kYTVhNzc4YTQmY2lkPTIwMjkzCiAgICog5om+5LiN5Yiw5YaN5LuOIGljb25mb250LmNvbSDmkJzntKIKICAgKi8KICAvLyDnvKnov5sgcmlnaHQKICB2YXIgSU5ERU5UX1JJR0hUX1NWRyA9ICc8c3ZnIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik0wIDY0aDEwMjR2MTI4SDB6IG0zODQgMTkyaDY0MHYxMjhIMzg0eiBtMCAxOTJoNjQwdjEyOEgzODR6IG0wIDE5Mmg2NDB2MTI4SDM4NHpNMCA4MzJoMTAyNHYxMjhIMHogbTAtMTI4VjMyMGwyNTYgMTkyeiI+PC9wYXRoPjwvc3ZnPic7CiAgLy8g5bem5a+56b2QCiAgdmFyIEpVU1RJRllfTEVGVF9TVkcgPSAnPHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0Ij48cGF0aCBkPSJNNzY4IDc5My42djEwMi40SDUxLjJ2LTEwMi40aDcxNi44eiBtMjA0LjgtMjMwLjR2MTAyLjRINTEuMnYtMTAyLjRoOTIxLjZ6IG0tMjA0LjgtMjMwLjR2MTAyLjRINTEuMnYtMTAyLjRoNzE2Ljh6TTk3Mi44IDEwMi40djEwMi40SDUxLjJWMTAyLjRoOTIxLjZ6Ij48L3BhdGg+PC9zdmc+JzsKICAvLyDlm77niYcKICB2YXIgSU1BR0VfU1ZHID0gJzxzdmcgdmlld0JveD0iMCAwIDEwMjQgMTAyNCI+PHBhdGggZD0iTTk1OS44NzcgMTI4bDAuMTIzIDAuMTIzdjc2Ny43NzVsLTAuMTIzIDAuMTIySDY0LjEwMmwtMC4xMjItMC4xMjJWMTI4LjEyM2wwLjEyMi0wLjEyM2g4OTUuNzc1ek05NjAgNjRINjRDMjguNzk1IDY0IDAgOTIuNzk1IDAgMTI4djc2OGMwIDM1LjIwNSAyOC43OTUgNjQgNjQgNjRoODk2YzM1LjIwNSAwIDY0LTI4Ljc5NSA2NC02NFYxMjhjMC0zNS4yMDUtMjguNzk1LTY0LTY0LTY0ek04MzIgMjg4LjAxYzAgNTMuMDIzLTQyLjk4OCA5Ni4wMS05Ni4wMSA5Ni4wMXMtOTYuMDEtNDIuOTg3LTk2LjAxLTk2LjAxUzY4Mi45NjcgMTkyIDczNS45OSAxOTIgODMyIDIzNC45ODggODMyIDI4OC4wMXpNODk2IDgzMkgxMjhWNzA0bDIyNC4wMS0zODQgMjU2IDMyMGg2NGwyMjQuMDEtMTkyeiI+PC9wYXRoPjwvc3ZnPic7CiAgLy8gcGx1cwogIHZhciBNT1JFX1NWRyA9ICc8c3ZnIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik0yMDQuOCA1MDUuNm0tNzYuOCAwYTc2LjggNzYuOCAwIDEgMCAxNTMuNiAwIDc2LjggNzYuOCAwIDEgMC0xNTMuNiAwWiI+PC9wYXRoPjxwYXRoIGQ9Ik01MDUuNiA1MDUuNm0tNzYuOCAwYTc2LjggNzYuOCAwIDEgMCAxNTMuNiAwIDc2LjggNzYuOCAwIDEgMC0xNTMuNiAwWiI+PC9wYXRoPjxwYXRoIGQ9Ik04MDYuNCA1MDUuNm0tNzYuOCAwYTc2LjggNzYuOCAwIDEgMCAxNTMuNiAwIDc2LjggNzYuOCAwIDEgMC0xNTMuNiAwWiI+PC9wYXRoPjwvc3ZnPic7CiAgLy8g6KeG6aKRCiAgdmFyIFZJREVPX1NWRyA9ICc8c3ZnIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik05ODEuMTg0IDE2MC4wOTZDODM3LjU2OCAxMzkuNDU2IDY3OC44NDggMTI4IDUxMiAxMjhTMTg2LjQzMiAxMzkuNDU2IDQyLjgxNiAxNjAuMDk2QzE1LjI5NiAyNjcuODA4IDAgMzg2Ljg0OCAwIDUxMnMxNS4yNjQgMjQ0LjE2IDQyLjgxNiAzNTEuOTA0QzE4Ni40NjQgODg0LjU0NCAzNDUuMTUyIDg5NiA1MTIgODk2czMyNS41NjgtMTEuNDU2IDQ2OS4xODQtMzIuMDk2QzEwMDguNzA0IDc1Ni4xOTIgMTAyNCA2MzcuMTUyIDEwMjQgNTEycy0xNS4yNjQtMjQ0LjE2LTQyLjgxNi0zNTEuOTA0ek0zODQgNzA0VjMyMGwzMjAgMTkyLTMyMCAxOTJ6Ij48L3BhdGg+PC9zdmc+JzsKCiAgLyoqCiAgICogQGRlc2NyaXB0aW9uIHRvb2xiYXIg6YWN572uCiAgICogQGF1dGhvciB3YW5nZnVwZW5nCiAgICovCiAgZnVuY3Rpb24gZ2VuRGVmYXVsdFRvb2xiYXJLZXlzKCkgewogICAgICByZXR1cm4gWwogICAgICAgICAgJ2hlYWRlclNlbGVjdCcsCiAgICAgICAgICAvLyAnaGVhZGVyMScsCiAgICAgICAgICAvLyAnaGVhZGVyMicsCiAgICAgICAgICAvLyAnaGVhZGVyMycsCiAgICAgICAgICAnYmxvY2txdW90ZScsCiAgICAgICAgICAnfCcsCiAgICAgICAgICAnYm9sZCcsCiAgICAgICAgICAndW5kZXJsaW5lJywKICAgICAgICAgICdpdGFsaWMnLAogICAgICAgICAgewogICAgICAgICAgICAgIGtleTogJ2dyb3VwLW1vcmUtc3R5bGUnLAogICAgICAgICAgICAgIHRpdGxlOiBkaXN0JDYudCgnZWRpdG9yLm1vcmUnKSwKICAgICAgICAgICAgICBpY29uU3ZnOiBNT1JFX1NWRywKICAgICAgICAgICAgICBtZW51S2V5czogWyd0aHJvdWdoJywgJ2NvZGUnLCAnc3VwJywgJ3N1YicsICdjbGVhclN0eWxlJ10sCiAgICAgICAgICB9LAogICAgICAgICAgJ2NvbG9yJywKICAgICAgICAgICdiZ0NvbG9yJywKICAgICAgICAgICd8JywKICAgICAgICAgICdmb250U2l6ZScsCiAgICAgICAgICAnZm9udEZhbWlseScsCiAgICAgICAgICAnbGluZUhlaWdodCcsCiAgICAgICAgICAnfCcsCiAgICAgICAgICAnYnVsbGV0ZWRMaXN0JywKICAgICAgICAgICdudW1iZXJlZExpc3QnLAogICAgICAgICAgJ3RvZG8nLAogICAgICAgICAgewogICAgICAgICAgICAgIGtleTogJ2dyb3VwLWp1c3RpZnknLAogICAgICAgICAgICAgIHRpdGxlOiBkaXN0JDYudCgnZWRpdG9yLmp1c3RpZnknKSwKICAgICAgICAgICAgICBpY29uU3ZnOiBKVVNUSUZZX0xFRlRfU1ZHLAogICAgICAgICAgICAgIG1lbnVLZXlzOiBbJ2p1c3RpZnlMZWZ0JywgJ2p1c3RpZnlSaWdodCcsICdqdXN0aWZ5Q2VudGVyJywgJ2p1c3RpZnlKdXN0aWZ5J10sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICAgIGtleTogJ2dyb3VwLWluZGVudCcsCiAgICAgICAgICAgICAgdGl0bGU6IGRpc3QkNi50KCdlZGl0b3IuaW5kZW50JyksCiAgICAgICAgICAgICAgaWNvblN2ZzogSU5ERU5UX1JJR0hUX1NWRywKICAgICAgICAgICAgICBtZW51S2V5czogWydpbmRlbnQnLCAnZGVsSW5kZW50J10sCiAgICAgICAgICB9LAogICAgICAgICAgJ3wnLAogICAgICAgICAgJ2Vtb3Rpb24nLAogICAgICAgICAgJ2luc2VydExpbmsnLAogICAgICAgICAgLy8gJ2VkaXRMaW5rJywKICAgICAgICAgIC8vICd1bkxpbmsnLAogICAgICAgICAgLy8gJ3ZpZXdMaW5rJywKICAgICAgICAgIHsKICAgICAgICAgICAgICBrZXk6ICdncm91cC1pbWFnZScsCiAgICAgICAgICAgICAgdGl0bGU6IGRpc3QkNi50KCdlZGl0b3IuaW1hZ2UnKSwKICAgICAgICAgICAgICBpY29uU3ZnOiBJTUFHRV9TVkcsCiAgICAgICAgICAgICAgbWVudUtleXM6IFsnaW5zZXJ0SW1hZ2UnLCAndXBsb2FkSW1hZ2UnXSwKICAgICAgICAgIH0sCiAgICAgICAgICAvLyAnZGVsZXRlSW1hZ2UnLAogICAgICAgICAgLy8gJ2VkaXRJbWFnZScsCiAgICAgICAgICAvLyAndmlld0ltYWdlTGluaycsCiAgICAgICAgICB7CiAgICAgICAgICAgICAga2V5OiAnZ3JvdXAtdmlkZW8nLAogICAgICAgICAgICAgIHRpdGxlOiBkaXN0JDYudCgnZWRpdG9yLnZpZGVvJyksCiAgICAgICAgICAgICAgaWNvblN2ZzogVklERU9fU1ZHLAogICAgICAgICAgICAgIG1lbnVLZXlzOiBbJ2luc2VydFZpZGVvJywgJ3VwbG9hZFZpZGVvJ10sCiAgICAgICAgICB9LAogICAgICAgICAgLy8gJ2RlbGV0ZVZpZGVvJywKICAgICAgICAgICdpbnNlcnRUYWJsZScsCiAgICAgICAgICAnY29kZUJsb2NrJywKICAgICAgICAgIC8vICdjb2RlU2VsZWN0TGFuZycsCiAgICAgICAgICAnZGl2aWRlcicsCiAgICAgICAgICAvLyAnZGVsZXRlVGFibGUnLAogICAgICAgICAgJ3wnLAogICAgICAgICAgJ3VuZG8nLAogICAgICAgICAgJ3JlZG8nLAogICAgICAgICAgJ3wnLAogICAgICAgICAgJ2Z1bGxTY3JlZW4nLAogICAgICBdOwogIH0KICBmdW5jdGlvbiBnZW5TaW1wbGVUb29sYmFyS2V5cygpIHsKICAgICAgcmV0dXJuIFsKICAgICAgICAgICdibG9ja3F1b3RlJywKICAgICAgICAgICdoZWFkZXIxJywKICAgICAgICAgICdoZWFkZXIyJywKICAgICAgICAgICdoZWFkZXIzJywKICAgICAgICAgICd8JywKICAgICAgICAgICdib2xkJywKICAgICAgICAgICd1bmRlcmxpbmUnLAogICAgICAgICAgJ2l0YWxpYycsCiAgICAgICAgICAndGhyb3VnaCcsCiAgICAgICAgICAnY29sb3InLAogICAgICAgICAgJ2JnQ29sb3InLAogICAgICAgICAgJ2NsZWFyU3R5bGUnLAogICAgICAgICAgJ3wnLAogICAgICAgICAgJ2J1bGxldGVkTGlzdCcsCiAgICAgICAgICAnbnVtYmVyZWRMaXN0JywKICAgICAgICAgICd0b2RvJywKICAgICAgICAgICdqdXN0aWZ5TGVmdCcsCiAgICAgICAgICAnanVzdGlmeVJpZ2h0JywKICAgICAgICAgICdqdXN0aWZ5Q2VudGVyJywKICAgICAgICAgICd8JywKICAgICAgICAgICdpbnNlcnRMaW5rJywKICAgICAgICAgIHsKICAgICAgICAgICAgICBrZXk6ICdncm91cC1pbWFnZScsCiAgICAgICAgICAgICAgdGl0bGU6IGRpc3QkNi50KCdlZGl0b3IuaW1hZ2UnKSwKICAgICAgICAgICAgICBpY29uU3ZnOiBJTUFHRV9TVkcsCiAgICAgICAgICAgICAgbWVudUtleXM6IFsnaW5zZXJ0SW1hZ2UnLCAndXBsb2FkSW1hZ2UnXSwKICAgICAgICAgIH0sCiAgICAgICAgICAnaW5zZXJ0VmlkZW8nLAogICAgICAgICAgJ2luc2VydFRhYmxlJywKICAgICAgICAgICdjb2RlQmxvY2snLAogICAgICAgICAgJ3wnLAogICAgICAgICAgJ3VuZG8nLAogICAgICAgICAgJ3JlZG8nLAogICAgICAgICAgJ3wnLAogICAgICAgICAgJ2Z1bGxTY3JlZW4nLAogICAgICBdOwogIH0KCiAgLyoqCiAgICogQGRlc2NyaXB0aW9uIGhvdmVyYmFyIOmFjee9rgogICAqIEBhdXRob3Igd2FuZ2Z1cGVuZwogICAqLwogIHZhciBDT01NT05fSE9WRVJCQVJfS0VZUyA9IHsKICAgICAgLy8ga2V5IOWNsyBlbGVtZW50IHR5cGUKICAgICAgbGluazogewogICAgICAgICAgbWVudUtleXM6IFsnZWRpdExpbmsnLCAndW5MaW5rJywgJ3ZpZXdMaW5rJ10sCiAgICAgIH0sCiAgICAgIGltYWdlOiB7CiAgICAgICAgICBtZW51S2V5czogWwogICAgICAgICAgICAgICdpbWFnZVdpZHRoMzAnLAogICAgICAgICAgICAgICdpbWFnZVdpZHRoNTAnLAogICAgICAgICAgICAgICdpbWFnZVdpZHRoMTAwJywKICAgICAgICAgICAgICAnZWRpdEltYWdlJywKICAgICAgICAgICAgICAndmlld0ltYWdlTGluaycsCiAgICAgICAgICAgICAgJ2RlbGV0ZUltYWdlJywKICAgICAgICAgIF0sCiAgICAgIH0sCiAgICAgIHByZTogewogICAgICAgICAgbWVudUtleXM6IFsnZW50ZXInLCAnY29kZUJsb2NrJywgJ2NvZGVTZWxlY3RMYW5nJ10sCiAgICAgIH0sCiAgICAgIHRhYmxlOiB7CiAgICAgICAgICBtZW51S2V5czogWwogICAgICAgICAgICAgICdlbnRlcicsCiAgICAgICAgICAgICAgJ3RhYmxlSGVhZGVyJywKICAgICAgICAgICAgICAndGFibGVGdWxsV2lkdGgnLAogICAgICAgICAgICAgICdpbnNlcnRUYWJsZVJvdycsCiAgICAgICAgICAgICAgJ2RlbGV0ZVRhYmxlUm93JywKICAgICAgICAgICAgICAnaW5zZXJ0VGFibGVDb2wnLAogICAgICAgICAgICAgICdkZWxldGVUYWJsZUNvbCcsCiAgICAgICAgICAgICAgJ2RlbGV0ZVRhYmxlJywKICAgICAgICAgIF0sCiAgICAgIH0sCiAgICAgIGRpdmlkZXI6IHsKICAgICAgICAgIG1lbnVLZXlzOiBbJ2VudGVyJ10sCiAgICAgIH0sCiAgICAgIHZpZGVvOiB7CiAgICAgICAgICBtZW51S2V5czogWydlbnRlcicsICdlZGl0VmlkZW9TaXplJ10sCiAgICAgIH0sCiAgfTsKICBmdW5jdGlvbiBnZW5EZWZhdWx0SG92ZXJiYXJLZXlzKCkgewogICAgICByZXR1cm4gX19hc3NpZ24oX19hc3NpZ24oe30sIENPTU1PTl9IT1ZFUkJBUl9LRVlTKSwgeyAKICAgICAgICAgIC8vIOS5n+WPr+S7peiHquWumuS5iSBtYXRjaCDmnaXljLnphY3lhYPntKDvvIzmraTml7Yga2V5IOWwsemaj+aEj+S6hgogICAgICAgICAgdGV4dDogewogICAgICAgICAgICAgIG1lbnVLZXlzOiBbCiAgICAgICAgICAgICAgICAgICdoZWFkZXJTZWxlY3QnLAogICAgICAgICAgICAgICAgICAnaW5zZXJ0TGluaycsCiAgICAgICAgICAgICAgICAgICdidWxsZXRlZExpc3QnLAogICAgICAgICAgICAgICAgICAnfCcsCiAgICAgICAgICAgICAgICAgICdib2xkJywKICAgICAgICAgICAgICAgICAgJ3Rocm91Z2gnLAogICAgICAgICAgICAgICAgICAnY29sb3InLAogICAgICAgICAgICAgICAgICAnYmdDb2xvcicsCiAgICAgICAgICAgICAgICAgICdjbGVhclN0eWxlJywKICAgICAgICAgICAgICBdLAogICAgICAgICAgfSB9KTsKICB9CiAgZnVuY3Rpb24gZ2VuU2ltcGxlSG92ZXJiYXJLZXlzKCkgewogICAgICByZXR1cm4gQ09NTU9OX0hPVkVSQkFSX0tFWVM7CiAgfQoKICAvKioKICAgKiBAZGVzY3JpcHRpb24g6I635Y+W57yW6L6R5Zmo6buY6K6k6YWN572uCiAgICogQGF1dGhvciB3YW5nZnVwZW5nCiAgICovCiAgZnVuY3Rpb24gZ2V0RGVmYXVsdEVkaXRvckNvbmZpZygpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICAgIGhvdmVyYmFyS2V5czogZ2VuRGVmYXVsdEhvdmVyYmFyS2V5cygpLAogICAgICB9OwogIH0KICBmdW5jdGlvbiBnZXRTaW1wbGVFZGl0b3JDb25maWcoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgICBob3ZlcmJhcktleXM6IGdlblNpbXBsZUhvdmVyYmFyS2V5cygpLAogICAgICB9OwogIH0KICBmdW5jdGlvbiBnZXREZWZhdWx0VG9vbGJhckNvbmZpZygpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICAgIHRvb2xiYXJLZXlzOiBnZW5EZWZhdWx0VG9vbGJhcktleXMoKSwKICAgICAgfTsKICB9CiAgZnVuY3Rpb24gZ2V0U2ltcGxlVG9vbGJhckNvbmZpZygpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICAgIHRvb2xiYXJLZXlzOiBnZW5TaW1wbGVUb29sYmFyS2V5cygpLAogICAgICB9OwogIH0KCiAgLyoqCiAgICogQGRlc2NyaXB0aW9uIHNldCBkZWZhdWx0IGNvbmZpZwogICAqIEBhdXRob3Igd2FuZ2Z1cGVuZwogICAqLwogIHZhciBkZWZhdWx0RWRpdG9yQ29uZmlnID0gZ2V0RGVmYXVsdEVkaXRvckNvbmZpZygpOwogIEJvb3Quc2V0RWRpdG9yQ29uZmlnKF9fYXNzaWduKF9fYXNzaWduKHt9LCBkZWZhdWx0RWRpdG9yQ29uZmlnKSwgeyBkZWNvcmF0ZTogZGlzdC53YW5nRWRpdG9yQ29kZUhpZ2hMaWdodERlY29yYXRlIH0pKTsKICB2YXIgc2ltcGxlRWRpdG9yQ29uZmlnID0gZ2V0U2ltcGxlRWRpdG9yQ29uZmlnKCk7CiAgQm9vdC5zZXRTaW1wbGVFZGl0b3JDb25maWcoX19hc3NpZ24oX19hc3NpZ24oe30sIHNpbXBsZUVkaXRvckNvbmZpZyksIHsgZGVjb3JhdGU6IGRpc3Qud2FuZ0VkaXRvckNvZGVIaWdoTGlnaHREZWNvcmF0ZSB9KSk7CiAgdmFyIGRlZmF1bHRUb29sYmFyQ29uZmlnID0gZ2V0RGVmYXVsdFRvb2xiYXJDb25maWcoKTsKICBCb290LnNldFRvb2xiYXJDb25maWcoZGVmYXVsdFRvb2xiYXJDb25maWcpOwogIHZhciBzaW1wbGVUb29sYmFyQ29uZmlnID0gZ2V0U2ltcGxlVG9vbGJhckNvbmZpZygpOwogIEJvb3Quc2V0U2ltcGxlVG9vbGJhckNvbmZpZyhzaW1wbGVUb29sYmFyQ29uZmlnKTsKCiAgLyoqCiAgICogQGRlc2NyaXB0aW9uIGNyZWF0ZQogICAqIEBhdXRob3Igd2FuZ2Z1cGVuZwogICAqLwogIC8qKgogICAqIOWIm+W7uiBlZGl0b3Ig5a6e5L6LCiAgICovCiAgZnVuY3Rpb24gY3JlYXRlRWRpdG9yKG9wdGlvbikgewogICAgICBpZiAob3B0aW9uID09PSB2b2lkIDApIHsgb3B0aW9uID0ge307IH0KICAgICAgdmFyIF9hID0gb3B0aW9uLnNlbGVjdG9yLCBzZWxlY3RvciA9IF9hID09PSB2b2lkIDAgPyAnJyA6IF9hLCBfYiA9IG9wdGlvbi5jb250ZW50LCBjb250ZW50ID0gX2IgPT09IHZvaWQgMCA/IFtdIDogX2IsIGh0bWwgPSBvcHRpb24uaHRtbCwgX2MgPSBvcHRpb24uY29uZmlnLCBjb25maWcgPSBfYyA9PT0gdm9pZCAwID8ge30gOiBfYywgX2QgPSBvcHRpb24ubW9kZSwgbW9kZSA9IF9kID09PSB2b2lkIDAgPyAnZGVmYXVsdCcgOiBfZDsKICAgICAgdmFyIGdsb2JhbENvbmZpZyA9IG1vZGUgPT09ICdzaW1wbGUnID8gQm9vdC5zaW1wbGVFZGl0b3JDb25maWcgOiBCb290LmVkaXRvckNvbmZpZzsKICAgICAgLy8g5Y2V54us5aSE55CGIGhvdmVyYmFyS2V5cwogICAgICB2YXIgbmV3SG92ZXJiYXJLZXlzID0gX19hc3NpZ24oX19hc3NpZ24oe30sIChnbG9iYWxDb25maWcuaG92ZXJiYXJLZXlzIHx8IHt9KSksIChjb25maWcuaG92ZXJiYXJLZXlzIHx8IHt9KSk7CiAgICAgIHZhciBlZGl0b3IgPSBkaXN0JDYuY29yZUNyZWF0ZUVkaXRvcih7CiAgICAgICAgICBzZWxlY3Rvcjogc2VsZWN0b3IsCiAgICAgICAgICBjb25maWc6IF9fYXNzaWduKF9fYXNzaWduKF9fYXNzaWduKHt9LCBnbG9iYWxDb25maWcpLCBjb25maWcpLCB7IGhvdmVyYmFyS2V5czogbmV3SG92ZXJiYXJLZXlzIH0pLAogICAgICAgICAgY29udGVudDogY29udGVudCwKICAgICAgICAgIGh0bWw6IGh0bWwsCiAgICAgICAgICBwbHVnaW5zOiBCb290LnBsdWdpbnMsCiAgICAgIH0pOwogICAgICByZXR1cm4gZWRpdG9yOwogIH0KICAvKioKICAgKiDliJvlu7ogdG9vbGJhciDlrp7kvosKICAgKi8KICBmdW5jdGlvbiBjcmVhdGVUb29sYmFyKG9wdGlvbikgewogICAgICB2YXIgc2VsZWN0b3IgPSBvcHRpb24uc2VsZWN0b3IsIGVkaXRvciA9IG9wdGlvbi5lZGl0b3IsIF9hID0gb3B0aW9uLmNvbmZpZywgY29uZmlnID0gX2EgPT09IHZvaWQgMCA/IHt9IDogX2EsIF9iID0gb3B0aW9uLm1vZGUsIG1vZGUgPSBfYiA9PT0gdm9pZCAwID8gJ2RlZmF1bHQnIDogX2I7CiAgICAgIGlmICghc2VsZWN0b3IpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2Fubm90IGZpbmQgJ3NlbGVjdG9yJyB3aGVuIGNyZWF0ZSB0b29sYmFyIik7CiAgICAgIH0KICAgICAgdmFyIGdsb2JhbENvbmZpZyA9IG1vZGUgPT09ICdzaW1wbGUnID8gQm9vdC5zaW1wbGVUb29sYmFyQ29uZmlnIDogQm9vdC50b29sYmFyQ29uZmlnOwogICAgICB2YXIgdG9vbGJhciA9IGRpc3QkNi5jb3JlQ3JlYXRlVG9vbGJhcihlZGl0b3IsIHsKICAgICAgICAgIHNlbGVjdG9yOiBzZWxlY3RvciwKICAgICAgICAgIGNvbmZpZzogX19hc3NpZ24oX19hc3NpZ24oe30sIGdsb2JhbENvbmZpZyksIGNvbmZpZyksCiAgICAgIH0pOwogICAgICByZXR1cm4gdG9vbGJhcjsKICB9CgogIC8qKgogICAqIEBkZXNjcmlwdGlvbiBlZGl0b3IgZW50cnkKICAgKiBAYXV0aG9yIHdhbmdmdXBlbmcKICAgKi8KICB2YXIgaW5kZXggPSB7fTsKCiAgZXhwb3J0cy5Cb290ID0gQm9vdDsKICBleHBvcnRzLkRvbUVkaXRvciA9IGRpc3QkNi5Eb21FZGl0b3I7CiAgZXhwb3J0cy5TbGF0ZUVkaXRvciA9IEVkaXRvcl8xOwogIGV4cG9ydHMuU2xhdGVFbGVtZW50ID0gRWxlbWVudF8xOwogIGV4cG9ydHMuU2xhdGVMb2NhdGlvbiA9IExvY2F0aW9uXzE7CiAgZXhwb3J0cy5TbGF0ZU5vZGUgPSBOb2RlXzE7CiAgZXhwb3J0cy5TbGF0ZVBhdGggPSBQYXRoXzE7CiAgZXhwb3J0cy5TbGF0ZVBvaW50ID0gUG9pbnRfMTsKICBleHBvcnRzLlNsYXRlUmFuZ2UgPSBSYW5nZV8xOwogIGV4cG9ydHMuU2xhdGVUZXh0ID0gVGV4dF8xOwogIGV4cG9ydHMuU2xhdGVUcmFuc2Zvcm1zID0gVHJhbnNmb3Jtc18xOwogIGV4cG9ydHMuVG9vbGJhciA9IGRpc3QkNi5Ub29sYmFyOwogIGV4cG9ydHMuY3JlYXRlRWRpdG9yID0gY3JlYXRlRWRpdG9yOwogIGV4cG9ydHMuY3JlYXRlVG9vbGJhciA9IGNyZWF0ZVRvb2xiYXI7CiAgZXhwb3J0cy5jcmVhdGVVcGxvYWRlciA9IGRpc3QkNi5jcmVhdGVVcGxvYWRlcjsKICBleHBvcnRzWyJkZWZhdWx0Il0gPSBpbmRleDsKICBleHBvcnRzLmdlbk1vZGFsQnV0dG9uRWxlbXMgPSBkaXN0JDYuZ2VuTW9kYWxCdXR0b25FbGVtczsKICBleHBvcnRzLmdlbk1vZGFsSW5wdXRFbGVtcyA9IGRpc3QkNi5nZW5Nb2RhbElucHV0RWxlbXM7CiAgZXhwb3J0cy5nZW5Nb2RhbFRleHRhcmVhRWxlbXMgPSBkaXN0JDYuZ2VuTW9kYWxUZXh0YXJlYUVsZW1zOwogIGV4cG9ydHMuaTE4bkFkZFJlc291cmNlcyA9IGRpc3QkNi5pMThuQWRkUmVzb3VyY2VzOwogIGV4cG9ydHMuaTE4bkNoYW5nZUxhbmd1YWdlID0gZGlzdCQ2LmkxOG5DaGFuZ2VMYW5ndWFnZTsKICBleHBvcnRzLmkxOG5HZXRSZXNvdXJjZXMgPSBkaXN0JDYuaTE4bkdldFJlc291cmNlczsKICBleHBvcnRzLnQgPSBkaXN0JDYudDsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTsKCn0pKTsK"
  }
}, function (container, data, task) {
  const {
    createEditor,
    createToolbar,
    Boot
  } = window.wangEditor

  const toolbarConfig = {
    toolbarKeys: ["headerSelect", "webPage", "localImage", "localVideo", "insertImage", "insertVideo", "blockquote", "|", "bold", "underline", "italic", {
      "key": "group-more-style",
      "title": "更多",
      "iconSvg": "<svg viewBox=\"0 0 1024 1024\"><path d=\"M204.8 505.6m-76.8 0a76.8 76.8 0 1 0 153.6 0 76.8 76.8 0 1 0-153.6 0Z\"></path><path d=\"M505.6 505.6m-76.8 0a76.8 76.8 0 1 0 153.6 0 76.8 76.8 0 1 0-153.6 0Z\"></path><path d=\"M806.4 505.6m-76.8 0a76.8 76.8 0 1 0 153.6 0 76.8 76.8 0 1 0-153.6 0Z\"></path></svg>",
      "menuKeys": ["through", "code", "sup", "sub", "clearStyle"]
    }, "color", "bgColor", "|", "fontSize", "fontFamily", "lineHeight", "|", "bulletedList", "numberedList", "todo", {
      "key": "group-justify",
      "title": "对齐",
      "iconSvg": "<svg viewBox=\"0 0 1024 1024\"><path d=\"M768 793.6v102.4H51.2v-102.4h716.8z m204.8-230.4v102.4H51.2v-102.4h921.6z m-204.8-230.4v102.4H51.2v-102.4h716.8zM972.8 102.4v102.4H51.2V102.4h921.6z\"></path></svg>",
      "menuKeys": ["justifyLeft", "justifyRight", "justifyCenter", "justifyJustify"]
    }, {
      "key": "group-indent",
      "title": "缩进",
      "iconSvg": "<svg viewBox=\"0 0 1024 1024\"><path d=\"M0 64h1024v128H0z m384 192h640v128H384z m0 192h640v128H384z m0 192h640v128H384zM0 832h1024v128H0z m0-128V320l256 192z\"></path></svg>",
      "menuKeys": ["indent", "delIndent"]
    }, "|", "emotion", "insertTable", "codeBlock", "divider", "|", "undo", "redo", "|", "fullScreen"],
    excludeKeys: ["fullScreen", "|", "emotion"]
  }

  class WebPageItem {
    constructor() {
      this.title = '插入网页' // 自定义菜单标题
      this.iconSvg = '<svg t="1718860351023" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5205" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M224 416h240v240H224zM16 112h992v128H16z" fill="#54FEBD" p-id="5206"></path><path d="M1008 944H16a16 16 0 0 1-16-16V80a16 16 0 0 1 16-16h992a16 16 0 0 1 16 16v848a16 16 0 0 1-16 16zM32 912h960V96H32v816z" fill="#1D1B4C" p-id="5207"></path><path d="M944 880H80a16 16 0 0 1-16-16V272a16 16 0 0 1 16-16h864a16 16 0 0 1 16 16v592a16 16 0 0 1-16 16zM96 848h832V288H96v560zM1008 224H16a16 16 0 1 1 0-32h992a16 16 0 1 1 0 32zM816 160c-4.16 0-8.32-1.76-11.36-4.64-2.88-3.04-4.64-7.2-4.64-11.36s1.76-8.32 4.64-11.36c5.92-5.92 16.8-5.92 22.72 0 2.88 3.04 4.64 7.2 4.64 11.36s-1.76 8.32-4.64 11.36c-3.04 2.88-7.04 4.64-11.36 4.64zM880 160a16.16 16.16 0 0 1-16-16c0-4.16 1.76-8.32 4.64-11.36 5.92-5.92 16.8-5.92 22.72 0 2.88 3.04 4.64 7.2 4.64 11.36s-1.76 8.32-4.64 11.36c-3.04 2.88-7.04 4.64-11.36 4.64zM944 160a16.16 16.16 0 0 1-16-16c0-4.16 1.76-8.32 4.64-11.36 5.76-5.92 16.8-5.92 22.72 0 2.88 3.04 4.64 7.2 4.64 11.36s-1.76 8.32-4.64 11.36c-3.04 2.88-7.2 4.64-11.36 4.64z" fill="#1D1B4C" p-id="5208"></path><path d="M752 224a16 16 0 0 1-16-16V80a16 16 0 1 1 32 0v128a16 16 0 0 1-16 16zM416 624H176a16 16 0 0 1-16-16V368a16 16 0 0 1 16-16h240a16 16 0 0 1 16 16v240a16 16 0 0 1-16 16z m-224-32h208V384H192v208zM848 384H528a16 16 0 1 1 0-32h320a16 16 0 1 1 0 32zM848 464H528a16 16 0 1 1 0-32h320a16 16 0 1 1 0 32zM848 544H528a16 16 0 1 1 0-32h320a16 16 0 1 1 0 32zM848 624H528a16 16 0 1 1 0-32h320a16 16 0 1 1 0 32zM848 704H176a16 16 0 1 1 0-32h672a16 16 0 1 1 0 32zM848 784H176a16 16 0 1 1 0-32h672a16 16 0 1 1 0 32z" fill="#1D1B4C" p-id="5209"></path></svg>'
      this.tag = 'button'
      this.showModal = true
      this.modalWidth = 500
    }

    getValue(editor) { // JS 语法
      return ''
    }

    // 菜单是否需要激活（如选中加粗文本，“加粗”菜单会激活），用不到则返回 false
    isActive(editor) { // JS 语法
      return false
    }

    isDisabled(editor) { // JS 语法
      return false
    }
    // 点击菜单时触发的函数
    exec(editor, value) { // JS 语法
      // if (this.isDisabled(editor)) return

    }
    // 弹出框 modal 的定位：1. 返回某一个 SlateNode； 2. 返回 null （根据当前选区自动定位）
    getModalPositionNode(editor) { // JS 语法
      return null // modal 依据选区定位
    }

    // 定义 modal 内部的 DOM Element
    getModalContentElem(editor) {
      let inputId1 = `input-${Math.random().toString(16).slice(-8)}`;
      let inputId2 = `input-${Math.random().toString(16).slice(-8)}`;
      const $content = $(`<div style="padding: 20px 10px;"><div style="margin-bottom: 15px; margin-top: -25px;">插入网页</div><input class="form-control" placeholder="请输入网址(必填)" id=${inputId1} style="width: 100%; margin-bottom: 10px; text-indent: 10px;" /><input class="form-control" placeholder="请输入 rpa 脚本地址" id=${inputId2} style="width: 100%; margin-bottom: 10px; text-indent: 10px;" /></div>`);
      const $button = $('<button type="button" class="btn btn-primary btn-sm" style="margin-top: 10px;">确认插入</button>');
      $content.append($button);

      $button.off("click");
      $button.on('click', (e) => {
        e.preventDefault();
        
        let input1 = container.querySelector("#" + inputId1);
        let input2 = container.querySelector("#" + inputId2);
        if (input1.value) {
          let url = input1.value;
          if(input2.value) {
            url = WebTool.attachParams(url, {
              aScript: input2.value
            });
          }
          let iframe = `<iframe width="100%" src="${url}"></iframe>`
         
          let node = {
            type: "video",
            src: iframe,
            poster: "",
            width: 500,
            height: "auto",
            children: [{
              text: ''
            }]
          }
          editor.restoreSelection(); // 恢复选区
          // editor.dangerouslyInsertHtml("<div>（视频占位符）</div>")
          editor.insertNode(node);
        }
        return;
      });

      return $content[0] // 返回 DOM Element 类型

      // PS：也可以把 $content 缓存下来，这样不用每次重复创建、重复绑定事件，优化性能
    }
  }

  class LocalImageItem {
    constructor() {
      this.title = '本地图片' // 自定义菜单标题
      this.iconSvg = '<svg viewBox="0 0 1024 1024"><path d="M828.708571 585.045333a48.761905 48.761905 0 0 0-48.737523 48.761905v18.529524l-72.143238-72.167619a135.972571 135.972571 0 0 0-191.585524 0l-34.133334 34.133333-120.880762-120.953905a138.898286 138.898286 0 0 0-191.585523 0l-72.167619 72.167619V292.400762a48.786286 48.786286 0 0 1 48.761904-48.761905h341.23581a48.737524 48.737524 0 0 0 34.474667-83.285333 48.737524 48.737524 0 0 0-34.474667-14.287238H146.236952A146.212571 146.212571 0 0 0 0 292.400762v585.289143A146.358857 146.358857 0 0 0 146.236952 1024h584.996572a146.212571 146.212571 0 0 0 146.236952-146.310095V633.807238a48.786286 48.786286 0 0 0-48.761905-48.761905zM146.261333 926.45181a48.737524 48.737524 0 0 1-48.761904-48.761905v-174.128762l141.409523-141.458286a38.497524 38.497524 0 0 1 53.126096 0l154.526476 154.624 209.627428 209.724953H146.236952z m633.734096-48.761905c-0.073143 9.337905-3.145143 18.383238-8.777143 25.843809l-219.843048-220.94019 34.133333-34.133334a37.546667 37.546667 0 0 1 53.613715 0l140.873143 141.897143V877.714286zM1009.615238 160.231619L863.329524 13.897143a48.737524 48.737524 0 0 0-16.091429-10.24c-11.849143-4.87619-25.161143-4.87619-37.059047 0a48.761905 48.761905 0 0 0-16.067048 10.24l-146.236952 146.334476a49.005714 49.005714 0 0 0 69.217523 69.241905l62.902858-63.390476v272.627809a48.761905 48.761905 0 1 0 97.475047 0V166.083048l62.902857 63.390476a48.737524 48.737524 0 0 0 69.217524 0 48.761905 48.761905 0 0 0 0-69.241905z"></path></svg>'
      this.tag = 'button'
    }

    getValue(editor) { // JS 语法
      return ''
    }

    // 菜单是否需要激活（如选中加粗文本，“加粗”菜单会激活），用不到则返回 false
    isActive(editor) { // JS 语法
      return false
    }

    isDisabled(editor) { // JS 语法
      return false
    }
    // 点击菜单时触发的函数
    exec(editor, value) { // JS 语法
      if (this.isDisabled(editor)) return
      // 创建一个input，用于选择本地视频文件
      const imageInput = document.createElement('input');
      imageInput.type = 'file';
      imageInput.accept = 'image/*';
      imageInput.style.display = 'none';

      // 监听change事件，当文件选择后触发
      imageInput.addEventListener('change', function (e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            const base64String = e.target.result;
            let node = {
              type: "image",
              src: base64String,
              poster: "",
              width: 300,
              height: "auto",
              children: [{
                text: ''
              }]
            }
            // editor.dangerouslyInsertHtml("<div>（视频占位符）</div>")
            editor.insertNode(node);
          };
          reader.readAsDataURL(file);
        }
      });

      // 触发input点击，打开文件选择对话框
      imageInput.click();
    }
  }

  class LocalVideoItem {
    constructor() {
      this.title = '本地视频' // 自定义菜单标题
      this.iconSvg = '<svg viewBox="0 0 1056 1024"><path d="M805.902261 521.819882a251.441452 251.441452 0 0 0-251.011972 246.600033 251.051015 251.051015 0 1 0 502.023944 8.823877 253.237463 253.237463 0 0 0-251.011972-255.42391z m59.463561 240.001647v129.898403h-116.701631v-129.898403h-44.041298l101.279368-103.504859 101.279368 103.504859z"></path><path d="M788.254507 0.000781H99.094092A98.663439 98.663439 0 0 0 0.001171 99.093701v590.067495a98.663439 98.663439 0 0 0 99.092921 99.092921h411.7549a266.434235 266.434235 0 0 1-2.186448-41.815807 275.843767 275.843767 0 0 1 275.180024-270.729042 270.650955 270.650955 0 0 1 103.504859 19.834201V99.093701A101.51363 101.51363 0 0 0 788.254507 0.000781zM295.054441 640.747004V147.507894l394.146189 246.600033z"></path></svg>'
      this.tag = 'button'
    }

    getValue(editor) { // JS 语法
      return ''
    }

    // 菜单是否需要激活（如选中加粗文本，“加粗”菜单会激活），用不到则返回 false
    isActive(editor) { // JS 语法
      return false
    }

    isDisabled(editor) { // JS 语法
      return false
    }
    // 点击菜单时触发的函数
    exec(editor, value) { // JS 语法
      if (this.isDisabled(editor)) return
      // 创建一个input，用于选择本地视频文件
      const videoInput = document.createElement('input');
      videoInput.type = 'file';
      videoInput.accept = 'video/*';
      videoInput.style.display = 'none';

      // 监听change事件，当文件选择后触发
      videoInput.addEventListener('change', function (e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            const base64String = e.target.result;

            let node = {
              type: "video",
              src: base64String,
              poster: "",
              width: 300,
              height: "auto",
              children: [{
                text: ''
              }]
            }
            // editor.dangerouslyInsertHtml("<div>（视频占位符）</div>")
            editor.insertNode(node);
          };
          reader.readAsDataURL(file);
        }
      });

      // 触发input点击，打开文件选择对话框
      videoInput.click();
    }
  }

  let toolItem = container.querySelector(".toolbar-container");
  toolItem.id = "tool_" + new Date().getTime();
  let editorItem = container.querySelector(".editor-container");
  editorItem.id = "editor_" + new Date().getTime();

  task.data = task.data || "";
  if (typeof task.data !== "string") {
    task.data = "";
  }
  let loadingText = "加载内容...";
  setTimeout(function () {
    const editor = createEditor({
      selector: '#' + editorItem.id,
      html: loadingText,
      config: {
        placeholder: '请在此处开始输入内容',
        onChange(editor) {
          const html = editor.getHtml();
          if (html) {
            task.data = html;
            if (loadingText !== html && typeof task.changeCallback === "function") {
              task.changeCallback(task.data);
            }
          }
        },
        customPaste(editor, event) {
          pasteCallback(event);
          return true
        }
      },
      mode: 'simple', // or 'simple'
    });

    task.editor = editor;
    window.theEditor = editor;

    let config = editor.getConfig();

    if (!config.MENU_CONF['localVideo']) {
      const localVideoConf = {
        key: 'localVideo', // 
        factory() {
          return new LocalVideoItem() // 把 `YourMenuClass` 替换为你菜单的 class
        },
      }

      Boot.registerMenu(localVideoConf)
    }

    if (!config.MENU_CONF['webPage']) {
      const webPageConf = {
        key: 'webPage', // 
        factory() {
          return new WebPageItem() // 把 `YourMenuClass` 替换为你菜单的 class
        },
      }

      Boot.registerMenu(webPageConf)
    }

    if (!config.MENU_CONF['localImage']) {
      const localImageConf = {
        key: 'localImage', // 
        factory() {
          return new LocalImageItem() // 把 `YourMenuClass` 替换为你菜单的 class
        },
      }

      Boot.registerMenu(localImageConf)
    }


    config.MENU_CONF.codeSelectLang.codeLangs = [{
      text: 'DSL',
      value: 'dsl'
    }, {
      text: 'Javascript',
      value: 'javascript'
    }, {
      text: 'HTML',
      value: 'html'
    }]

    // 配置字体
    config.MENU_CONF.fontFamily.fontFamilyList = [{
        name: "方正黑体",
        value: "方正黑体"
      },
      '汉仪仿宋',
      '方正楷体',
      '方正书宋',
      '微软雅黑',
      '粉笔字',
      'Arial',
      'Fredericka',
      'FrankRuhl'
    ]

    config.MENU_CONF['uploadImage'] = {
      // 小于该值就插入 base64 格式（而不上传），默认为 0
      base64LimitSize: 10 * 1024 * 1024 // 5mb
    }

    const toolbar = createToolbar({
      editor,
      selector: '#' + toolItem.id,
      config: toolbarConfig,
      mode: 'default', // or 'simple'
    })

    let tConfig = toolbar.getConfig();
    console.log("toolbar config", tConfig);
    window.tConfig = tConfig;


    let tempHtml = task.data || "";
    setTimeout(function () {
      let h = $(container).find("#" + toolItem.id).height();
      $(container).find("#" + editorItem.id).css({
        height: `calc( 100% - ${h + 15}px )`
      });
      if (task.typingStyleOutput) {
        webCpu.ArticleEditor.typingStyleOutput(task, tempHtml);
      } else {
        editor.setHtml(tempHtml || "");
      }
    }, 200)

  }, 500);

  let pasteCallback = (event) => {
    const d = (event.clipboardData || event.originalEvent.clipboardData || window.clipboardData);
    const items = d.items;
    for (let i = 0; i < items.length; i++) {
      const item = items[i];
      // 判断是否为图片

      if (item.kind === "file") {
        const blob = item.getAsFile();
        const reader = new FileReader();
        let type = item.type;
        // 读取图片文件
        reader.onload = function (e) {
          let content = e.target.result;
          if (type.indexOf('image') !== -1) {
            const img = new Image();
            img.src = content;
            // 将图片添加到粘贴区域
            // container.appendChild(img);
            task.editor.dangerouslyInsertHtml(`<img src="${img.src}" width="700px" height="auto" />`);
          }
        };
        if (blob) {
          reader.readAsDataURL(blob);
        }
        event.preventDefault();
      }
    }
  }
});

webCpu.ArticleEditor.typingStyleOutput = function (card, content, n) {
  let t = card.task || card;
  let container = document.createElement("div");
  container.innerHTML = content;
  let arr = container.childNodes;
  n = n || 100;
  var i = 0;
  t.editor.setHtml("");
  clearInterval(webCpu.ArticleEditor.typingInterval);
  webCpu.ArticleEditor.typingInterval = setInterval(function () {

    let count = arr.length - 1;
    if (i > count) {
      clearInterval(webCpu.ArticleEditor.typingInterval);
      return false;
    }
    let tContainer = document.createElement("div");
    let tNode = arr[i].cloneNode(true);
    tContainer.appendChild(tNode);
    let eItem = $(t.container).find(".w-e-scroll")[0];
    // 将光标移动到内容末尾
    const range = document.createRange();
    const selection = window.getSelection();
    range.selectNodeContents(eItem.childNodes[0]);
    range.collapse(false); // 移动到末尾
    selection.removeAllRanges();
    selection.addRange(range);

    t.editor.dangerouslyInsertHtml(tContainer.innerHTML || "");

    let height = eItem.scrollHeight;
    eItem.scrollTop = height;

    // 
    i++;
  }, n); // 每500毫秒添加一行
}